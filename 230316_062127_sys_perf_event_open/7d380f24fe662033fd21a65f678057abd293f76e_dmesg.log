c[?7l[2J[0mSeaBIOS (version rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org)


iPXE (http://ipxe.org) 00:03.0 CA00 PCI2.10 PnP PMM+7FF91000+7FEF1000 CA00
Press Ctrl-B to configure iPXE (PCI 00:03.0)...                                                                               


Booting from ROM...
c[?7l[2J[    0.000000] Linux version 5.15.0-rc4-7d380f24fe66+ (root@p-adln01) (gcc (GCC) 8.5.0 20210514 (Red Hat 8.5.0-18), GNU ld version 2.36.1-2.el8) #1 SMP PREEMPT Fri Mar 10 10:00:31 CST 2023
[    0.000000] Command line: console=ttyS0 root=/dev/sda earlyprintk=serial net.ifnames=0
[    0.000000] KERNEL supported cpus:
[    0.000000]   Intel GenuineIntel
[    0.000000]   AMD AuthenticAMD
[    0.000000]   Hygon HygonGenuine
[    0.000000]   Centaur CentaurHauls
[    0.000000]   zhaoxin   Shanghai  
[    0.000000] x86/fpu: Supporting XSAVE feature 0x001: 'x87 floating point registers'
[    0.000000] x86/fpu: Supporting XSAVE feature 0x002: 'SSE registers'
[    0.000000] x86/fpu: Supporting XSAVE feature 0x004: 'AVX registers'
[    0.000000] x86/fpu: Supporting XSAVE feature 0x200: 'Protection Keys User registers'
[    0.000000] x86/fpu: xstate_offset[2]:  576, xstate_sizes[2]:  256
[    0.000000] x86/fpu: xstate_offset[9]:  832, xstate_sizes[9]:    8
[    0.000000] x86/fpu: Enabled xstate features 0x207, context size is 840 bytes, using 'compacted' format.
[    0.000000] signal: max sigframe size: 3632
[    0.000000] BIOS-provided physical RAM map:
[    0.000000] BIOS-e820: [mem 0x0000000000000000-0x000000000009fbff] usable
[    0.000000] BIOS-e820: [mem 0x000000000009fc00-0x000000000009ffff] reserved
[    0.000000] BIOS-e820: [mem 0x00000000000f0000-0x00000000000fffff] reserved
[    0.000000] BIOS-e820: [mem 0x0000000000100000-0x000000007ffdffff] usable
[    0.000000] BIOS-e820: [mem 0x000000007ffe0000-0x000000007fffffff] reserved
[    0.000000] BIOS-e820: [mem 0x00000000feffc000-0x00000000feffffff] reserved
[    0.000000] BIOS-e820: [mem 0x00000000fffc0000-0x00000000ffffffff] reserved
[    0.000000] printk: bootconsole [earlyser0] enabled
[    0.000000] NX (Execute Disable) protection: active
[    0.000000] SMBIOS 2.8 present.
[    0.000000] DMI: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[    0.000000] Hypervisor detected: KVM
[    0.000000] kvm-clock: Using msrs 4b564d01 and 4b564d00
[    0.000000] kvm-clock: cpu 0, msr 5401001, primary cpu clock
[    0.000005] kvm-clock: using sched offset of 477748174 cycles
[    0.000782] clocksource: kvm-clock: mask: 0xffffffffffffffff max_cycles: 0x1cd42e4dffb, max_idle_ns: 881590591483 ns
[    0.003000] tsc: Detected 1804.800 MHz processor
[    0.011136] last_pfn = 0x7ffe0 max_arch_pfn = 0x400000000
[    0.012025] x86/PAT: Configuration [0-7]: WB  WC  UC- UC  WB  WP  UC- WT  
[    0.021413] found SMP MP-table at [mem 0x000f5ba0-0x000f5baf]
[    0.022464] Using GB pages for direct mapping
[    0.024806] ACPI: Early table checksum verification disabled
[    0.025655] ACPI: RSDP 0x00000000000F59C0 000014 (v00 BOCHS )
[    0.026468] ACPI: RSDT 0x000000007FFE1951 000034 (v01 BOCHS  BXPC     00000001 BXPC 00000001)
[    0.027685] ACPI: FACP 0x000000007FFE17FD 000074 (v01 BOCHS  BXPC     00000001 BXPC 00000001)
[    0.028880] ACPI: DSDT 0x000000007FFE0040 0017BD (v01 BOCHS  BXPC     00000001 BXPC 00000001)
[    0.030056] ACPI: FACS 0x000000007FFE0000 000040
[    0.030699] ACPI: APIC 0x000000007FFE1871 000080 (v01 BOCHS  BXPC     00000001 BXPC 00000001)
[    0.031887] ACPI: HPET 0x000000007FFE18F1 000038 (v01 BOCHS  BXPC     00000001 BXPC 00000001)
[    0.033061] ACPI: WAET 0x000000007FFE1929 000028 (v01 BOCHS  BXPC     00000001 BXPC 00000001)
[    0.034230] ACPI: Reserving FACP table memory at [mem 0x7ffe17fd-0x7ffe1870]
[    0.035198] ACPI: Reserving DSDT table memory at [mem 0x7ffe0040-0x7ffe17fc]
[    0.036164] ACPI: Reserving FACS table memory at [mem 0x7ffe0000-0x7ffe003f]
[    0.037115] ACPI: Reserving APIC table memory at [mem 0x7ffe1871-0x7ffe18f0]
[    0.038089] ACPI: Reserving HPET table memory at [mem 0x7ffe18f1-0x7ffe1928]
[    0.039047] ACPI: Reserving WAET table memory at [mem 0x7ffe1929-0x7ffe1950]
[    0.041326] No NUMA configuration found
[    0.041870] Faking a node at [mem 0x0000000000000000-0x000000007ffdffff]
[    0.042878] NODE_DATA(0) allocated [mem 0x7ffb5000-0x7ffdffff]
[    0.048070] Zone ranges:
[    0.048446]   DMA      [mem 0x0000000000001000-0x0000000000ffffff]
[    0.049285]   DMA32    [mem 0x0000000001000000-0x000000007ffdffff]
[    0.050130]   Normal   empty
[    0.050526]   Device   empty
[    0.050923] Movable zone start for each node
[    0.051511] Early memory node ranges
[    0.052000]   node   0: [mem 0x0000000000001000-0x000000000009efff]
[    0.052858]   node   0: [mem 0x0000000000100000-0x000000007ffdffff]
[    0.053710] Initmem setup node 0 [mem 0x0000000000001000-0x000000007ffdffff]
[    0.061222] On node 0, zone DMA: 1 pages in unavailable ranges
[    0.061460] On node 0, zone DMA: 97 pages in unavailable ranges
[    0.099173] On node 0, zone DMA32: 32 pages in unavailable ranges
[    0.100443] ACPI: PM-Timer IO Port: 0x608
[    0.101806] ACPI: LAPIC_NMI (acpi_id[0xff] dfl dfl lint[0x1])
[    0.102649] IOAPIC[0]: apic_id 0, version 17, address 0xfec00000, GSI 0-23
[    0.103574] ACPI: INT_SRC_OVR (bus 0 bus_irq 0 global_irq 2 dfl dfl)
[    0.104373] ACPI: INT_SRC_OVR (bus 0 bus_irq 5 global_irq 5 high level)
[    0.105212] ACPI: INT_SRC_OVR (bus 0 bus_irq 9 global_irq 9 high level)
[    0.106052] ACPI: INT_SRC_OVR (bus 0 bus_irq 10 global_irq 10 high level)
[    0.106946] ACPI: INT_SRC_OVR (bus 0 bus_irq 11 global_irq 11 high level)
[    0.107870] ACPI: Using ACPI (MADT) for SMP configuration information
[    0.108720] ACPI: HPET id: 0x8086a201 base: 0xfed00000
[    0.109421] TSC deadline timer available
[    0.109929] smpboot: Allowing 2 CPUs, 0 hotplug CPUs
[    0.110731] kvm-guest: KVM setup pv remote TLB flush
[    0.111415] kvm-guest: setup PV sched yield
[    0.112113] PM: hibernation: Registered nosave memory: [mem 0x00000000-0x00000fff]
[    0.113132] PM: hibernation: Registered nosave memory: [mem 0x0009f000-0x0009ffff]
[    0.114138] PM: hibernation: Registered nosave memory: [mem 0x000a0000-0x000effff]
[    0.115157] PM: hibernation: Registered nosave memory: [mem 0x000f0000-0x000fffff]
[    0.116198] [mem 0x80000000-0xfeffbfff] available for PCI devices
[    0.117027] Booting paravirtualized kernel on KVM
[    0.117715] clocksource: refined-jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 7645519600211568 ns
[    0.119162] setup_percpu: NR_CPUS:8192 nr_cpumask_bits:2 nr_cpu_ids:2 nr_node_ids:1
[    0.122854] percpu: Embedded 55 pages/cpu s188416 r8192 d28672 u1048576
[    0.124109] kvm-guest: setup async PF for cpu 0
[    0.124763] kvm-guest: stealtime: cpu 0, msr 7dc2d080
[    0.125489] kvm-guest: PV spinlocks enabled
[    0.126096] PV qspinlock hash table entries: 256 (order: 0, 4096 bytes, linear)
[    0.127168] Built 1 zonelists, mobility grouping on.  Total pages: 515808
[    0.128130] Policy zone: DMA32
[    0.128557] Kernel command line: net.ifnames=0 console=ttyS0 root=/dev/sda earlyprintk=serial net.ifnames=0
[    0.132743] Dentry cache hash table entries: 262144 (order: 9, 2097152 bytes, linear)
[    0.134796] Inode-cache hash table entries: 131072 (order: 8, 1048576 bytes, linear)
[    0.136007] mem auto-init: stack:off, heap alloc:off, heap free:off
[    0.141361] Memory: 1987504K/2096632K available (30737K kernel code, 5254K rwdata, 7736K rodata, 3240K init, 22004K bss, 108872K reserved, 0K cma-reserved)
[    0.143266] random: get_random_u64 called from __kmem_cache_create+0x2f/0x4c0 with crng_init=0
[    0.144151] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=2, Nodes=1
[    0.146143] kmemleak: Kernel memory leak detector disabled
[    0.146943] ftrace: allocating 64793 entries in 254 pages
[    0.246231] ftrace: allocated 254 pages with 7 groups
[    0.250682] Dynamic Preempt: none
[    0.251467] Running RCU self tests
[    0.251972] rcu: Preemptible hierarchical RCU implementation.
[    0.252784] rcu: 	RCU lockdep checking is enabled.
[    0.253463] rcu: 	RCU restricting CPUs from NR_CPUS=8192 to nr_cpu_ids=2.
[    0.254426] 	Trampoline variant of Tasks RCU enabled.
[    0.255142] 	Rude variant of Tasks RCU enabled.
[    0.255800] 	Tracing variant of Tasks RCU enabled.
[    0.256468] rcu: RCU calculated value of scheduler-enlistment delay is 25 jiffies.
[    0.257542] rcu: Adjusting geometry for rcu_fanout_leaf=16, nr_cpu_ids=2
[    0.286382] NR_IRQS: 524544, nr_irqs: 440, preallocated irqs: 16
[    0.301027] Console: colour VGA+ 80x25
[    0.301678] printk: console [ttyS0] enabled
[    0.301678] printk: console [ttyS0] enabled
[    0.302873] printk: bootconsole [earlyser0] disabled
[    0.302873] printk: bootconsole [earlyser0] disabled
[    0.304313] Lock dependency validator: Copyright (c) 2006 Red Hat, Inc., Ingo Molnar
[    0.305426] ... MAX_LOCKDEP_SUBCLASSES:  8
[    0.306029] ... MAX_LOCK_DEPTH:          48
[    0.306646] ... MAX_LOCKDEP_KEYS:        8192
[    0.307307] ... CLASSHASH_SIZE:          4096
[    0.307930] ... MAX_LOCKDEP_ENTRIES:     32768
[    0.308570] ... MAX_LOCKDEP_CHAINS:      65536
[    0.309199] ... CHAINHASH_SIZE:          32768
[    0.309857]  memory used by lock dependency info: 6365 kB
[    0.310609]  memory used for stack traces: 4224 kB
[    0.311354]  per task-struct memory footprint: 1920 bytes
[    0.312268] ACPI: Core revision 20210730
[    0.313268] clocksource: hpet: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604467 ns
[    0.314824] APIC: Switch to symmetric I/O mode setup
[    0.315895] x2apic enabled
[    0.316648] Switched APIC routing to physical x2apic.
[    0.317402] kvm-guest: setup PV IPIs
[    0.319428] ..TIMER: vector=0x30 apic1=0 pin1=2 apic2=-1 pin2=-1
[    0.320394] clocksource: tsc-early: mask: 0xffffffffffffffff max_cycles: 0x1a03dfe73b3, max_idle_ns: 440795256845 ns
[    0.321983] Calibrating delay loop (skipped) preset value.. 3609.60 BogoMIPS (lpj=7219200)
[    0.325970] pid_max: default: 32768 minimum: 301
[    0.326801] LSM: Security Framework initializing
[    0.327559] Yama: becoming mindful.
[    0.328313] Mount-cache hash table entries: 4096 (order: 3, 32768 bytes, linear)
[    0.330002] Mountpoint-cache hash table entries: 4096 (order: 3, 32768 bytes, linear)
[    0.338627] x86/cpu: User Mode Instruction Prevention (UMIP) activated
[    0.342019] Last level iTLB entries: 4KB 0, 2MB 0, 4MB 0
[    0.342976] Last level dTLB entries: 4KB 0, 2MB 0, 4MB 0, 1GB 0
[    0.343934] Spectre V1 : Mitigation: usercopy/swapgs barriers and __user pointer sanitization
[    0.345159] Spectre V2 : Mitigation: Enhanced IBRS
[    0.345968] Spectre V2 : Spectre v2 / SpectreRSB mitigation: Filling RSB on context switch
[    0.347114] Spectre V2 : mitigation: Enabling conditional Indirect Branch Prediction Barrier
[    0.348266] Speculative Store Bypass: Mitigation: Speculative Store Bypass disabled via prctl and seccomp
[    0.391687] Freeing SMP alternatives memory: 56K
[    0.393136] smpboot: CPU0: Intel(R) Core(TM) i3-N305 (family: 0x6, model: 0xbe, stepping: 0x0)
[    0.393959] Running RCU-tasks wait API self tests
[    0.494206] Performance Events: generic architected perfmon, full-width counters, Intel PMU driver.
[    0.495554] ... version:                2
[    0.496097] ... bit width:              48
[    0.496648] ... generic registers:      6
[    0.497189] ... value mask:             0000ffffffffffff
[    0.497906] ... max period:             00007fffffffffff
[    0.497972] ... fixed-purpose events:   3
[    0.498515] ... event mask:             000000070000003f
[    0.499878] rcu: Hierarchical SRCU implementation.
[    0.504291] Callback from call_rcu_tasks_trace() invoked.
[    0.505663] smp: Bringing up secondary CPUs ...
[    0.506892] x86: Booting SMP configuration:
[    0.507504] .... node  #0, CPUs:      #1
[    0.034295] kvm-clock: cpu 1, msr 5401041, secondary cpu clock
[    0.508611] kvm-guest: setup async PF for cpu 1
[    0.508611] kvm-guest: stealtime: cpu 1, msr 7dd2d080
[    0.510063] smp: Brought up 1 node, 2 CPUs
[    0.510656] smpboot: Max logical packages: 1
[    0.511251] smpboot: Total of 2 processors activated (7219.20 BogoMIPS)
[    0.518722] devtmpfs: initialized
[    0.519002] x86/mm: Memory block size: 128MB
[    0.522577] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 7645041785100000 ns
[    0.526019] futex hash table entries: 512 (order: 4, 65536 bytes, linear)
[    0.528829] pinctrl core: initialized pinctrl subsystem
[    0.530777] 
[    0.531024] *************************************************************
[    0.531950] **     NOTICE NOTICE NOTICE NOTICE NOTICE NOTICE NOTICE    **
[    0.532870] **                                                         **
[    0.533791] **  IOMMU DebugFS SUPPORT HAS BEEN ENABLED IN THIS KERNEL  **
[    0.533972] **                                                         **
[    0.534917] ** This means that this kernel is built to expose internal **
[    0.535842] ** IOMMU data structures, which may compromise security on **
[    0.536767] ** your system.                                            **
[    0.537669] **                                                         **
[    0.537970] ** If you see this message and you are not debugging the   **
[    0.538894] ** kernel, report this immediately to your vendor!         **
[    0.539786] **                                                         **
[    0.540674] **     NOTICE NOTICE NOTICE NOTICE NOTICE NOTICE NOTICE    **
[    0.541576] *************************************************************
[    0.542096] PM: RTC time: 08:00:46, date: 2023-03-16
[    0.544622] NET: Registered PF_NETLINK/PF_ROUTE protocol family
[    0.546274] DMA: preallocated 256 KiB GFP_KERNEL pool for atomic allocations
[    0.547242] DMA: preallocated 256 KiB GFP_KERNEL|GFP_DMA pool for atomic allocations
[    0.548299] DMA: preallocated 256 KiB GFP_KERNEL|GFP_DMA32 pool for atomic allocations
[    0.549449] audit: initializing netlink subsys (disabled)
[    0.550095] audit: type=2000 audit(1678953646.915:1): state=initialized audit_enabled=0 res=1
[    0.551303] thermal_sys: Registered thermal governor 'fair_share'
[    0.551314] thermal_sys: Registered thermal governor 'bang_bang'
[    0.552152] thermal_sys: Registered thermal governor 'step_wise'
[    0.552981] thermal_sys: Registered thermal governor 'user_space'
[    0.554095] cpuidle: using governor ladder
[    0.555514] cpuidle: using governor menu
[    0.556496] ACPI: bus type PCI registered
[    0.557086] acpiphp: ACPI Hot Plug PCI Controller Driver version: 0.5
[    0.559041] PCI: Using configuration type 1 for base access
[    0.573960] Kprobes globally optimized
[    0.578176] HugeTLB registered 1.00 GiB page size, pre-allocated 0 pages
[    0.579002] HugeTLB registered 2.00 MiB page size, pre-allocated 0 pages
[    0.591391] ACPI: Added _OSI(Module Device)
[    0.591391] ACPI: Added _OSI(Processor Device)
[    0.591922] ACPI: Added _OSI(3.0 _SCP Extensions)
[    0.593976] ACPI: Added _OSI(Processor Aggregator Device)
[    0.594718] ACPI: Added _OSI(Linux-Dell-Video)
[    0.595344] ACPI: Added _OSI(Linux-Lenovo-NV-HDMI-Audio)
[    0.596074] ACPI: Added _OSI(Linux-HPI-Hybrid-Graphics)
[    0.604322] ACPI: 1 ACPI AML tables successfully acquired and loaded
[    0.608169] Callback from call_rcu_tasks_rude() invoked.
[    0.610836] ACPI: Interpreter enabled
[    0.611504] ACPI: PM: (supports S0 S3 S4 S5)
[    0.612123] ACPI: Using IOAPIC for interrupt routing
[    0.612901] PCI: Using host bridge windows from ACPI; if necessary, use "pci=nocrs" and report a bug
[    0.614979] ACPI: Enabled 2 GPEs in block 00 to 0F
[    0.639051] ACPI: PCI Root Bridge [PCI0] (domain 0000 [bus 00-ff])
[    0.639922] acpi PNP0A03:00: _OSC: OS supports [ASPM ClockPM Segments MSI EDR HPX-Type3]
[    0.640985] acpi PNP0A03:00: fail to add MMCONFIG information, can't access extended PCI configuration space under this bridge.
[    0.644968] acpiphp: Slot [3] registered
[    0.645628] acpiphp: Slot [4] registered
[    0.646076] acpiphp: Slot [5] registered
[    0.646758] acpiphp: Slot [6] registered
[    0.647465] acpiphp: Slot [7] registered
[    0.648132] acpiphp: Slot [8] registered
[    0.648787] acpiphp: Slot [9] registered
[    0.649439] acpiphp: Slot [10] registered
[    0.650074] acpiphp: Slot [11] registered
[    0.650783] acpiphp: Slot [12] registered
[    0.651471] acpiphp: Slot [13] registered
[    0.652141] acpiphp: Slot [14] registered
[    0.652803] acpiphp: Slot [15] registered
[    0.653457] acpiphp: Slot [16] registered
[    0.654108] acpiphp: Slot [17] registered
[    0.654796] acpiphp: Slot [18] registered
[    0.655464] acpiphp: Slot [19] registered
[    0.656128] acpiphp: Slot [20] registered
[    0.656798] acpiphp: Slot [21] registered
[    0.657632] acpiphp: Slot [22] registered
[    0.658088] acpiphp: Slot [23] registered
[    0.658788] acpiphp: Slot [24] registered
[    0.659450] acpiphp: Slot [25] registered
[    0.660125] acpiphp: Slot [26] registered
[    0.660855] acpiphp: Slot [27] registered
[    0.661537] acpiphp: Slot [28] registered
[    0.662106] acpiphp: Slot [29] registered
[    0.662811] acpiphp: Slot [30] registered
[    0.663513] acpiphp: Slot [31] registered
[    0.664138] PCI host bridge to bus 0000:00
[    0.664726] pci_bus 0000:00: root bus resource [io  0x0000-0x0cf7 window]
[    0.665674] pci_bus 0000:00: root bus resource [io  0x0d00-0xffff window]
[    0.665976] pci_bus 0000:00: root bus resource [mem 0x000a0000-0x000bffff window]
[    0.667047] pci_bus 0000:00: root bus resource [mem 0x80000000-0xfebfffff window]
[    0.668080] pci_bus 0000:00: root bus resource [mem 0x100000000-0x17fffffff window]
[    0.669126] pci_bus 0000:00: root bus resource [bus 00-ff]
[    0.671082] pci 0000:00:00.0: [8086:1237] type 00 class 0x060000
[    0.678035] pci 0000:00:01.0: [8086:7000] type 00 class 0x060100
[    0.680622] pci 0000:00:01.1: [8086:7010] type 00 class 0x010180
[    0.683462] pci 0000:00:01.1: reg 0x20: [io  0xc040-0xc04f]
[    0.685012] pci 0000:00:01.1: legacy IDE quirk: reg 0x10: [io  0x01f0-0x01f7]
[    0.685974] pci 0000:00:01.1: legacy IDE quirk: reg 0x14: [io  0x03f6]
[    0.686846] pci 0000:00:01.1: legacy IDE quirk: reg 0x18: [io  0x0170-0x0177]
[    0.687854] pci 0000:00:01.1: legacy IDE quirk: reg 0x1c: [io  0x0376]
[    0.690261] pci 0000:00:01.3: [8086:7113] type 00 class 0x068000
[    0.691726] pci 0000:00:01.3: quirk: [io  0x0600-0x063f] claimed by PIIX4 ACPI
[    0.692931] pci 0000:00:01.3: quirk: [io  0x0700-0x070f] claimed by PIIX4 SMB
[    0.696367] pci 0000:00:02.0: [1234:1111] type 00 class 0x030000
[    0.702454] pci 0000:00:02.0: reg 0x10: [mem 0xfd000000-0xfdffffff pref]
[    0.705901] pci 0000:00:02.0: reg 0x18: [mem 0xfebf0000-0xfebf0fff]
[    0.710550] pci 0000:00:02.0: reg 0x30: [mem 0xfebe0000-0xfebeffff pref]
[    0.718803] pci 0000:00:03.0: [8086:100e] type 00 class 0x020000
[    0.720385] pci 0000:00:03.0: reg 0x10: [mem 0xfebc0000-0xfebdffff]
[    0.721940] pci 0000:00:03.0: reg 0x14: [io  0xc000-0xc03f]
[    0.725344] pci 0000:00:03.0: reg 0x30: [mem 0xfeb80000-0xfebbffff pref]
[    0.730104] Callback from call_rcu_tasks() invoked.
[    0.745851] ACPI: PCI: Interrupt link LNKA configured for IRQ 10
[    0.746530] ACPI: PCI: Interrupt link LNKB configured for IRQ 10
[    0.747883] ACPI: PCI: Interrupt link LNKC configured for IRQ 11
[    0.749243] ACPI: PCI: Interrupt link LNKD configured for IRQ 11
[    0.750260] ACPI: PCI: Interrupt link LNKS configured for IRQ 9
[    0.754240] iommu: Default domain type: Translated 
[    0.754691] iommu: DMA domain TLB invalidation policy: lazy mode 
[    0.758279] pci 0000:00:02.0: vgaarb: setting as boot VGA device
[    0.758908] pci 0000:00:02.0: vgaarb: VGA device added: decodes=io+mem,owns=io+mem,locks=none
[    0.760051] pci 0000:00:02.0: vgaarb: bridge control possible
[    0.760821] vgaarb: loaded
[    0.763783] SCSI subsystem initialized
[    0.764372] ACPI: bus type USB registered
[    0.764372] usbcore: registered new interface driver usbfs
[    0.764372] usbcore: registered new interface driver hub
[    0.764372] usbcore: registered new device driver usb
[    0.764546] pps_core: LinuxPPS API ver. 1 registered
[    0.765223] pps_core: Software ver. 5.3.6 - Copyright 2005-2007 Rodolfo Giometti <giometti@linux.it>
[    0.770002] PTP clock support registered
[    0.770642] EDAC MC: Ver: 3.0.0
[    0.774195] NetLabel: Initializing
[    0.774706] NetLabel:  domain hash size = 128
[    0.775294] NetLabel:  protocols = UNLABELED CIPSOv4 CALIPSO
[    0.776178] NetLabel:  unlabeled traffic allowed by default
[    0.777123] PCI: Using ACPI for IRQ routing
[    0.778621] hpet0: at MMIO 0xfed00000, IRQs 2, 8, 0
[    0.779352] hpet0: 3 comparators, 64-bit 100.000000 MHz counter
[    0.784394] clocksource: Switched to clocksource kvm-clock
[    0.965858] VFS: Disk quotas dquot_6.6.0
[    0.966617] VFS: Dquot-cache hash table entries: 512 (order 0, 4096 bytes)
[    0.968145] pnp: PnP ACPI init
[    0.971361] pnp: PnP ACPI: found 6 devices
[    0.986255] clocksource: acpi_pm: mask: 0xffffff max_cycles: 0xffffff, max_idle_ns: 2085701024 ns
[    0.987986] NET: Registered PF_INET protocol family
[    0.989098] IP idents hash table entries: 32768 (order: 6, 262144 bytes, linear)
[    0.991345] tcp_listen_portaddr_hash hash table entries: 1024 (order: 4, 81920 bytes, linear)
[    0.992717] TCP established hash table entries: 16384 (order: 5, 131072 bytes, linear)
[    0.994324] TCP bind hash table entries: 16384 (order: 8, 1179648 bytes, linear)
[    0.997193] TCP: Hash tables configured (established 16384 bind 16384)
[    0.998528] UDP hash table entries: 1024 (order: 5, 163840 bytes, linear)
[    0.999783] UDP-Lite hash table entries: 1024 (order: 5, 163840 bytes, linear)
[    1.001658] NET: Registered PF_UNIX/PF_LOCAL protocol family
[    1.003844] RPC: Registered named UNIX socket transport module.
[    1.004740] RPC: Registered udp transport module.
[    1.005420] RPC: Registered tcp transport module.
[    1.006153] RPC: Registered tcp NFSv4.1 backchannel transport module.
[    1.007149] pci_bus 0000:00: resource 4 [io  0x0000-0x0cf7 window]
[    1.008058] pci_bus 0000:00: resource 5 [io  0x0d00-0xffff window]
[    1.008959] pci_bus 0000:00: resource 6 [mem 0x000a0000-0x000bffff window]
[    1.009952] pci_bus 0000:00: resource 7 [mem 0x80000000-0xfebfffff window]
[    1.010988] pci_bus 0000:00: resource 8 [mem 0x100000000-0x17fffffff window]
[    1.012393] pci 0000:00:01.0: PIIX3: Enabling Passive Release
[    1.013256] pci 0000:00:00.0: Limiting direct PCI/PCI transfers
[    1.014234] pci 0000:00:01.0: Activating ISA DMA hang workarounds
[    1.015260] pci 0000:00:02.0: Video device with shadowed ROM at [mem 0x000c0000-0x000dffff]
[    1.016505] PCI: CLS 0 bytes, default 64
[    1.017198] ACPI: bus type thunderbolt registered
[    1.018393] clocksource: tsc: mask: 0xffffffffffffffff max_cycles: 0x1a03dfe73b3, max_idle_ns: 440795256845 ns
[    3.886585] Initialise system trusted keyrings
[    3.887339] Key type blacklist registered
[    3.888208] workingset: timestamp_bits=36 max_order=19 bucket_order=0
[    3.902728] zbud: loaded
[    3.905791] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    3.908788] NFS: Registering the id_resolver key type
[    3.909535] Key type id_resolver registered
[    3.910175] Key type id_legacy registered
[    3.910936] nfs4filelayout_init: NFSv4 File Layout Driver Registering...
[    3.911922] nfs4flexfilelayout_init: NFSv4 Flexfile Layout Driver Registering...
[    3.913424] fuse: init (API version 7.34)
[    3.914571] SGI XFS with ACLs, security attributes, realtime, quota, no debug enabled
[    3.917955] 9p: Installing v9fs 9p2000 file system support
[    3.928427] Key type asymmetric registered
[    3.929057] Asymmetric key parser 'x509' registered
[    3.929907] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 244)
[    3.931253] io scheduler mq-deadline registered
[    3.932077] io scheduler bfq registered
[    3.933307] shpchp: Standard Hot Plug PCI Controller Driver version: 0.4
[    3.934959] IPMI message handler: version 39.2
[    3.935692] ipmi device interface
[    3.938651] input: Power Button as /devices/LNXSYSTM:00/LNXPWRBN:00/input/input0
[    3.940168] ACPI: button: Power Button [PWRF]
[    3.942328] ERST DBG: ERST support is disabled.
[    3.943881] Serial: 8250/16550 driver, 32 ports, IRQ sharing enabled
[    3.945656] 00:04: ttyS0 at I/O 0x3f8 (irq = 4, base_baud = 115200) is a 16550A
[    3.960553] Linux agpgart interface v0.103
[    3.980847] brd: module loaded
[    3.993646] loop: module loaded
[    4.000704] scsi host0: ata_piix
[    4.002207] scsi host1: ata_piix
[    4.002966] ata1: PATA max MWDMA2 cmd 0x1f0 ctl 0x3f6 bmdma 0xc040 irq 14
[    4.003926] ata2: PATA max MWDMA2 cmd 0x170 ctl 0x376 bmdma 0xc048 irq 15
[    4.006063] libphy: Fixed MDIO Bus: probed
[    4.007104] tun: Universal TUN/TAP device driver, 1.6
[    4.008107] e100: Intel(R) PRO/100 Network Driver
[    4.008775] e100: Copyright(c) 1999-2006 Intel Corporation
[    4.009604] e1000: Intel(R) PRO/1000 Network Driver
[    4.010333] e1000: Copyright (c) 1999-2006 Intel Corporation.
[    4.163027] ata1.00: ATA-7: QEMU HARDDISK, 2.5+, max UDMA/100
[    4.164333] ata1.00: 16777216 sectors, multi 16: LBA48 
[    4.166928] ata2.00: ATAPI: QEMU DVD-ROM, 2.5+, max UDMA/100
[    4.169232] scsi 0:0:0:0: Direct-Access     ATA      QEMU HARDDISK    2.5+ PQ: 0 ANSI: 5
[    4.171572] scsi 0:0:0:0: Attached scsi generic sg0 type 0
[    4.173526] sd 0:0:0:0: [sda] 16777216 512-byte logical blocks: (8.59 GB/8.00 GiB)
[    4.175219] sd 0:0:0:0: [sda] Write Protect is off
[    4.176627] sd 0:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA
[    4.177908] scsi 1:0:0:0: CD-ROM            QEMU     QEMU DVD-ROM     2.5+ PQ: 0 ANSI: 5
[    4.180527] scsi 1:0:0:0: Attached scsi generic sg1 type 5
[    4.222310] sd 0:0:0:0: [sda] Attached SCSI disk
[    4.263961] ACPI: \_SB_.LNKC: Enabled at IRQ 11
[    4.615629] e1000 0000:00:03.0 eth0: (PCI:33MHz:32-bit) 52:54:00:12:34:56
[    4.616629] e1000 0000:00:03.0 eth0: Intel(R) PRO/1000 Network Connection
[    4.617641] e1000e: Intel(R) PRO/1000 Network Driver
[    4.618378] e1000e: Copyright(c) 1999 - 2015 Intel Corporation.
[    4.619343] igb: Intel(R) Gigabit Ethernet Network Driver
[    4.620099] igb: Copyright (c) 2007-2014 Intel Corporation.
[    4.621020] PPP generic driver version 2.4.2
[    4.622374] VFIO - User Level meta-driver version: 0.3
[    4.623211] ehci_hcd: USB 2.0 'Enhanced' Host Controller (EHCI) Driver
[    4.624152] ehci-pci: EHCI PCI platform driver
[    4.624862] ehci-platform: EHCI generic platform driver
[    4.625613] ohci_hcd: USB 1.1 'Open' Host Controller (OHCI) Driver
[    4.626561] ohci-pci: OHCI PCI platform driver
[    4.627240] ohci-platform: OHCI generic platform driver
[    4.627967] uhci_hcd: USB Universal Host Controller Interface driver
[    4.629376] usbcore: registered new interface driver uas
[    4.630251] usbcore: registered new interface driver usb-storage
[    4.631298] i8042: PNP: PS/2 Controller [PNP0303:KBD,PNP0f13:MOU] at 0x60,0x64 irq 1,12
[    4.633588] serio: i8042 KBD port at 0x60,0x64 irq 1
[    4.634458] serio: i8042 AUX port at 0x60,0x64 irq 12
[    4.635765] mousedev: PS/2 mouse device common for all mice
[    4.638111] input: AT Translated Set 2 keyboard as /devices/platform/i8042/serio0/input/input1
[    4.638356] rtc_cmos 00:05: RTC can wake from S4
[    4.641468] input: VirtualPS/2 VMware VMMouse as /devices/platform/i8042/serio1/input/input4
[    4.642018] rtc_cmos 00:05: registered as rtc0
[    4.643617] rtc_cmos 00:05: setting system clock to 2023-03-16T08:00:50 UTC (1678953650)
[    4.644994] rtc_cmos 00:05: alarms up to one day, y3k, 242 bytes nvram, hpet irqs
[    4.646174] i2c_dev: i2c /dev entries driver
[    4.647012] device-mapper: core: CONFIG_IMA_DISABLE_HTABLE is disabled. Duplicate IMA measurements will not be recorded in the IMA log.
[    4.649007] device-mapper: uevent: version 1.0.3
[    4.649147] input: VirtualPS/2 VMware VMMouse as /devices/platform/i8042/serio1/input/input3
[    4.650165] device-mapper: ioctl: 4.45.0-ioctl (2021-03-22) initialised: dm-devel@redhat.com
[    4.652100] intel_pstate: CPU model not supported
[    4.652952] sdhci: Secure Digital Host Controller Interface driver
[    4.653802] sdhci: Copyright(c) Pierre Ossman
[    4.654652] sdhci-pltfm: SDHCI platform and OF driver helper
[    4.655626] ledtrig-cpu: registered to indicate activity on CPUs
[    4.657073] drop_monitor: Initializing network drop monitor service
[    4.658773] NET: Registered PF_INET6 protocol family
[    4.664415] Segment Routing with IPv6
[    4.665007] In-situ OAM (IOAM) with IPv6
[    4.665628] NET: Registered PF_PACKET protocol family
[    4.666789] 9pnet: Installing 9P2000 support
[    4.667499] Key type dns_resolver registered
[    4.669197] IPI shorthand broadcast: enabled
[    4.669862] sched_clock: Marking stable (4638614499, 30295545)->(4682000599, -13090555)
[    4.672013] registered taskstats version 1
[    4.672803] Loading compiled-in X.509 certificates
[    4.673774] zswap: loaded using pool lzo/zbud
[    4.675282] Key type ._fscrypt registered
[    4.675874] Key type .fscrypt registered
[    4.676418] Key type fscrypt-provisioning registered
[    4.678596] Key type encrypted registered
[    4.679269] ima: No TPM chip found, activating TPM-bypass!
[    4.680061] ima: Allocated hash algorithm: sha1
[    4.680792] ima: No architecture policies found
[    4.681553] evm: Initialising EVM extended attributes:
[    4.682335] evm: security.selinux
[    4.682815] evm: security.SMACK64
[    4.683299] evm: security.SMACK64EXEC
[    4.683819] evm: security.SMACK64TRANSMUTE
[    4.684390] evm: security.SMACK64MMAP
[    4.684899] evm: security.apparmor
[    4.685381] evm: security.ima
[    4.685804] evm: security.capability
[    4.686344] evm: HMAC attrs: 0x1
[    4.688754] PM:   Magic number: 15:989:17
[    4.690029] RAS: Correctable Errors collector initialized.
[    4.692381] md: Waiting for all devices to be available before autodetect
[    4.693341] md: If you don't use raid, use raid=noautodetect
[    4.694189] md: Autodetecting RAID arrays.
[    4.694787] md: autorun ...
[    4.695187] md: ... autorun DONE.
[    4.703130] EXT4-fs (sda): mounted filesystem with ordered data mode. Opts: (null). Quota mode: none.
[    4.704578] VFS: Mounted root (ext4 filesystem) readonly on device 8:0.
[    4.707966] devtmpfs: mounted
[    4.714918] Freeing unused decrypted memory: 2036K
[    4.718403] Freeing unused kernel image (initmem) memory: 3240K
[    4.726112] Write protecting the kernel read-only data: 40960k
[    4.731140] Freeing unused kernel image (text/rodata gap) memory: 2028K
[    4.732782] Freeing unused kernel image (rodata/data gap) memory: 456K
[    4.849224] x86/mm: Checked W+X mappings: passed, no W+X pages found.
[    4.850172] Run /sbin/init as init process
[    4.942323] random: fast init done
[    4.974564] systemd[1]: RTC configured in localtime, applying delta of 0 minutes to system time.
[    5.027208] systemd[1]: systemd 239 (239-49.el8) running in system mode. (+PAM +AUDIT +SELINUX +IMA -APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 +SECCOMP +BLKID +ELFUTILS +KMOD +IDN2 -IDN +PCRE2 default-hierarchy=legacy)
[    5.030369] systemd[1]: Detected virtualization kvm.
[    5.031002] systemd[1]: Detected architecture x86-64.

Welcome to [0;31mCentOS Stream 8[0m!

[    5.058201] systemd[1]: Set hostname to <test>.
[    5.249336] random: lvmconfig: uninitialized urandom read (4 bytes read)
[    5.399643] random: systemd: uninitialized urandom read (16 bytes read)
[    5.403960] systemd[1]: Created slice User and Session Slice.
[[0;32m  OK  [0m] Created slice User and Session Slice.
[    5.405678] random: systemd: uninitialized urandom read (16 bytes read)
[    5.406808] systemd[1]: Listening on initctl Compatibility Named Pipe.
[[0;32m  OK  [0m] Listening on initctl Compatibility Named Pipe.
[    5.420052] systemd[1]: Listening on Process Core Dump Socket.
[[0;32m  OK  [0m] Listening on Process Core Dump Socket.
[    5.421738] systemd[1]: Reached target Slices.
[[0;32m  OK  [0m] Reached target Slices.
[    5.425161] systemd[1]: Created slice system-serial\x2dgetty.slice.
[[0;32m  OK  [0m] Created slice system-serial\x2dgetty.slice.
[    5.427168] systemd[1]: Listening on udev Kernel Socket.
[[0;32m  OK  [0m] Listening on udev Kernel Socket.
[[0;32m  OK  [0m] Listening on Journal Socket (/dev/log).
[[0;32m  OK  [0m] Set up automount Arbitrary Executab…rmats File System Automount Point.
[[0;32m  OK  [0m] Started Forward Password Requests to Wall Directory Watch.
[[0;32m  OK  [0m] Listening on RPCbind Server Activation Socket.
[[0;32m  OK  [0m] Listening on Journal Socket.
         Mounting POSIX Message Queue File System...
         Starting Load Kernel Modules...
         Starting Setup Virtual Console...
         Starting Journal Service...
         Mounting Kernel Debug File System...
         Starting Remount Root and Kernel File Systems...
[[0;32m  OK  [0m] Reached target RPC Port Mapper.
[[0;32m  OK  [0m] Listening on Device-mapper event daemon FIFOs.
[[0;32m  OK  [0m] Reached target Swap.
         Mounting Huge Pages File System...
[[0;32m  OK  [0m] Listening on multipathd control socket.
[[0;32m  OK  [0m] Listening on udev Control Socket.
         Starting Monitoring of LVM2 mirrors…ng dmeventd or progress polling...
[[0;32m  OK  [0m] Listening on LVM2 poll daemon socket.
[[0;32m  OK  [0m] Created slice system-sshd\x2dkeygen.slice.
         Starting udev Coldplug all Devices...
[[0;32m  OK  [0m] Created slice system-getty.slice.
[[0;32m  OK  [0m] Started Journal Service.
[[0;32m  OK  [0m] Mounted POSIX Message Queue File System.
[[0;1;31mFAILED[0m] Failed to start Load Kernel Modules.
See 'systemctl status systemd-modules-load.service' for details.
[[0;32m  OK  [0m] Mounted Kernel Debug File System.
[[0;32m  OK  [0m] Mounted Huge Pages File System.
         Mounting FUSE Control File System...
         Mounting Kernel Configuration File System...
[    5.902493] EXT4-fs (sda): re-mounted. Opts: (null). Quota mode: none.
         Starting Apply Kernel Variables...
[[0;32m  OK  [0m] Started Remount Root and Kernel File Systems.
[[0;32m  OK  [0m] Started Setup Virtual Console.
[[0;32m  OK  [0m] Mounted FUSE Control File System.
[[0;32m  OK  [0m] Mounted Kernel Configuration File System.
[[0;32m  OK  [0m] Started Apply Kernel Variables.
         Starting Flush Journal to Persistent Storage...
         Starting Load/Save Random Seed...
         Starting Create Static Device Nodes in /dev...
[[0;32m  OK  [0m] Started Load/Save Random Seed.
[[0;32m  OK  [0m] Started Flush Journal to Persistent Storage.
[[0;32m  OK  [0m] Started Create Static Device Nodes in /dev.
         Starting udev Kernel Device Manager...
[[0;32m  OK  [0m] Started udev Kernel Device Manager.
[[0;32m  OK  [0m] Started udev Coldplug all Devices.
         Starting Show Plymouth Boot Screen...
         Starting udev Wait for Complete Device Initialization...
[[0;32m  OK  [0m] Started Show Plymouth Boot Screen.
[[0;32m  OK  [0m] Started Forward Password Requests to Plymouth Directory Watch.
[[0;32m  OK  [0m] Reached target Paths.
[[0;32m  OK  [0m] Reached target Local Encrypted Volumes.
[[0;32m  OK  [0m] Found device /dev/ttyS0.
[[0;32m  OK  [0m] Started Monitoring of LVM2 mirrors,…sing dmeventd or progress polling.
[[0;32m  OK  [0m] Started udev Wait for Complete Device Initialization.
[[0;32m  OK  [0m] Listening on Load/Save RF Kill Switch Status /dev/rfkill Watch.
[[0;32m  OK  [0m] Reached target Local File Systems (Pre).
[[0;32m  OK  [0m] Reached target Local File Systems.
         Starting Tell Plymouth To Write Out Runtime Data...
         Starting Create Volatile Files and Directories...
         Starting Restore /run/initramfs on shutdown...
[[0;32m  OK  [0m] Started Tell Plymouth To Write Out Runtime Data.
[[0;32m  OK  [0m] Started Create Volatile Files and Directories.
[[0;32m  OK  [0m] Started Restore /run/initramfs on shutdown.
         Starting RPC Bind...
         Mounting RPC Pipe File System...
         Starting Security Auditing Service...
[[0;32m  OK  [0m] Mounted RPC Pipe File System.
[[0;32m  OK  [0m] Reached target rpc_pipefs.target.
[[0;32m  OK  [0m] Started RPC Bind.
[[0;32m  OK  [0m] Started Security Auditing Service.
         Starting Update UTMP about System Boot/Shutdown...
[[0;32m  OK  [0m] Started Update UTMP about System Boot/Shutdown.
[[0;32m  OK  [0m] Reached target System Initialization.
[[0;32m  OK  [0m] Listening on SSSD Kerberos Cache Manager responder socket.
[[0;32m  OK  [0m] Listening on D-Bus System Message Bus Socket.
[[0;32m  OK  [0m] Reached target Sockets.
[[0;32m  OK  [0m] Started Daily Cleanup of Temporary Directories.
[[0;32m  OK  [0m] Started daily update of the root trust anchor for DNSSEC.
[[0;32m  OK  [0m] Started dnf makecache --timer.
[[0;32m  OK  [0m] Reached target Timers.
[[0;32m  OK  [0m] Reached target Basic System.
         Starting Auto-connect to subsystems…-NVME devices found during boot...
[[0;32m  OK  [0m] Started D-Bus System Message Bus.
[[0;32m  OK  [0m] Reached target sshd-keygen.target.
[[0;32m  OK  [0m] Started Machine Check Exception Logging Daemon.
         Starting NTP client/server...
         Starting Self Monitoring and Reporting Technology (SMART) Daemon...
[[0;32m  OK  [0m] Started irqbalance daemon.
         Starting Network Manager...
         Starting Login Service...
         Starting Authorization Manager...
[[0;32m  OK  [0m] Started Self Monitoring and Reporting Technology (SMART) Daemon.
[[0;32m  OK  [0m] Started Auto-connect to subsystems …FC-NVME devices found during boot.
         Starting update of the root trust a…or DNSSEC validation in unbound...
[[0;32m  OK  [0m] Started Login Service.
[[0;32m  OK  [0m] Started Network Manager.
         Starting Network Manager Wait Online...
[[0;32m  OK  [0m] Reached target Network.
         Starting OpenSSH server daemon...
         Starting Dynamic System Tuning Daemon...
         Starting GSSAPI Proxy Daemon...
[[0;32m  OK  [0m] Started Authorization Manager.
         Starting Hostname Service...
[[0;32m  OK  [0m] Started NTP client/server.
[[0;32m  OK  [0m] Started Hostname Service.
         Starting Network Manager Script Dispatcher Service...
[    8.386310] e1000: eth0 NIC Link is Up 1000 Mbps Full Duplex, Flow Control: RX
[    8.387822] IPv6: ADDRCONF(NETDEV_CHANGE): eth0: link becomes ready
[[0;32m  OK  [0m] Started Network Manager Script Dispatcher Service.
[[0;32m  OK  [0m] Started Dynamic System Tuning Daemon.
[    8.966313] random: crng init done
[    8.966854] random: 7 urandom warning(s) missed due to ratelimiting
[[0;32m  OK  [0m] Started OpenSSH server daemon.
[[0;32m  OK  [0m] Started GSSAPI Proxy Daemon.
[[0;32m  OK  [0m] Reached target NFS client services.
[[0;32m  OK  [0m] Reached target Remote File Systems (Pre).
[[0;32m  OK  [0m] Reached target Remote File Systems.
         Starting Permit User Sessions...
[[0;32m  OK  [0m] Started update of the root trust an… for DNSSEC validation in unbound.
[[0;32m  OK  [0m] Started Permit User Sessions.
         Starting Terminate Plymouth Boot Screen...
[[0;32m  OK  [0m] Started Command Scheduler.
         Starting Hold until boot process finishes up...

CentOS Stream 8
Kernel 5.15.0-rc4-7d380f24fe66+ on an x86_64

test login: [   28.683598] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   28.684585] caller is debug_smp_processor_id+0x1c/0x20
[   28.685229] CPU: 1 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   28.686093] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.687433] Call Trace:
[   28.687736]  dump_stack_lvl+0xa4/0xd3
[   28.688186]  dump_stack+0x15/0x17
[   28.688575]  check_preemption_disabled+0x167/0x180
[   28.689131]  ? text_poke+0x2b/0x60
[   28.689537]  ? do_sync_core+0x30/0x30
[   28.689963]  debug_smp_processor_id+0x1c/0x20
[   28.690482]  perf_ftrace_function_call+0x7c/0x360
[   28.691035]  ? 0xffffffffa00dc099
[   28.691433]  ? __this_cpu_preempt_check+0x1c/0x20
[   28.691981]  ? lock_is_held_type+0xe2/0x140
[   28.692467]  ? __text_poke+0x4e0/0x4e0
[   28.692917]  0xffffffffa00dc099
[   28.693286]  ? __text_poke+0x4e0/0x4e0
[   28.693728]  ? __text_poke+0x4e0/0x4e0
[   28.694192]  ? __text_poke+0x5/0x4e0
[   28.694612]  __text_poke+0x5/0x4e0
[   28.695019]  text_poke+0x2b/0x60
[   28.695398]  ? __text_poke+0x5/0x4e0
[   28.695814]  ? text_poke+0x2b/0x60
[   28.696225]  text_poke_bp_batch+0x93/0x2c0
[   28.696701]  ? 0xffffffffa00dc000
[   28.697086]  ? user_disable_single_step+0x50/0x50
[   28.697644]  text_poke_queue+0xa7/0xc0
[   28.698083]  ftrace_replace_code+0xfd/0x170
[   28.698600]  ftrace_modify_all_code+0x1b1/0x270
[   28.699130]  arch_ftrace_update_code+0x9/0x10
[   28.699639]  ftrace_run_update_code+0x30/0xa0
[   28.700144]  ftrace_startup_enable+0x5e/0xa0
[   28.700636]  ftrace_startup+0x16d/0x240
[   28.701096]  register_ftrace_function+0x43/0x90
[   28.701618]  perf_ftrace_event_register+0xc1/0xf0
[   28.702181]  perf_trace_event_init+0xa0/0x4c0
[   28.702688]  perf_trace_init+0xda/0x160
[   28.703140]  perf_tp_event_init+0x57/0xa0
[   28.703616]  perf_try_init_event+0x83/0x270
[   28.704104]  perf_event_alloc+0xe3f/0x1c10
[   28.704590]  ? _raw_spin_unlock+0x2c/0x50
[   28.705061]  ? alloc_fd+0x20d/0x320
[   28.705478]  __do_sys_perf_event_open+0x3bf/0x1de0
[   28.706047]  ? write_comp_data+0x2f/0x90
[   28.706551]  __x64_sys_perf_event_open+0x26/0x30
[   28.707091]  do_syscall_64+0x37/0x80
[   28.707512]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   28.708102] RIP: 0033:0x7fac0740459d
[   28.708517] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   28.710608] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   28.711465] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   28.712266] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   28.713074] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   28.713880] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   28.714698] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   28.715688] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   28.716592] caller is debug_smp_processor_id+0x1c/0x20
[   28.717214] CPU: 1 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   28.718080] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.719414] Call Trace:
[   28.719717]  dump_stack_lvl+0xa4/0xd3
[   28.720169]  dump_stack+0x15/0x17
[   28.720578]  check_preemption_disabled+0x167/0x180
[   28.721159]  ? text_poke+0x2b/0x60
[   28.721722]  ? do_sync_core+0x30/0x30
[   28.722183]  debug_smp_processor_id+0x1c/0x20
[   28.722768]  perf_ftrace_function_call+0x7c/0x360
[   28.723389]  ? 0xffffffffa00dc099
[   28.723802]  ? __this_cpu_preempt_check+0x1c/0x20
[   28.724371]  ? lock_is_held_type+0xe2/0x140
[   28.724926]  ? alternatives_smp_module_del+0x90/0x90
[   28.725528]  0xffffffffa00dc099
[   28.725968]  ? alternatives_smp_module_del+0x90/0x90
[   28.726622]  ? alternatives_smp_module_del+0x90/0x90
[   28.727276]  ? __text_poke+0x5/0x4e0
[   28.727724]  __text_poke+0x5/0x4e0
[   28.728142]  text_poke+0x2b/0x60
[   28.728539]  ? __text_poke+0x5/0x4e0
[   28.728975]  ? text_poke+0x2b/0x60
[   28.729393]  text_poke_bp_batch+0x93/0x2c0
[   28.729891]  ? 0xffffffffa00dc000
[   28.730305]  ? user_disable_single_step+0x50/0x50
[   28.730873]  text_poke_queue+0xa7/0xc0
[   28.731335]  ftrace_replace_code+0xfd/0x170
[   28.731845]  ftrace_modify_all_code+0x1b1/0x270
[   28.732394]  arch_ftrace_update_code+0x9/0x10
[   28.732920]  ftrace_run_update_code+0x30/0xa0
[   28.733448]  ftrace_startup_enable+0x5e/0xa0
[   28.733965]  ftrace_startup+0x16d/0x240
[   28.734449]  register_ftrace_function+0x43/0x90
[   28.734996]  perf_ftrace_event_register+0xc1/0xf0
[   28.735566]  perf_trace_event_init+0xa0/0x4c0
[   28.736096]  perf_trace_init+0xda/0x160
[   28.736566]  perf_tp_event_init+0x57/0xa0
[   28.737054]  perf_try_init_event+0x83/0x270
[   28.737567]  perf_event_alloc+0xe3f/0x1c10
[   28.738065]  ? _raw_spin_unlock+0x2c/0x50
[   28.738564]  ? alloc_fd+0x20d/0x320
[   28.738996]  __do_sys_perf_event_open+0x3bf/0x1de0
[   28.739576]  ? write_comp_data+0x2f/0x90
[   28.740072]  __x64_sys_perf_event_open+0x26/0x30
[   28.740628]  do_syscall_64+0x37/0x80
[   28.741065]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   28.741674] RIP: 0033:0x7fac0740459d
[   28.742108] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   28.744275] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   28.745163] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   28.745997] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   28.746846] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   28.747681] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   28.748516] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   28.749399] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   28.750326] caller is debug_smp_processor_id+0x1c/0x20
[   28.750943] CPU: 1 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   28.751805] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.753127] Call Trace:
[   28.753427]  dump_stack_lvl+0xa4/0xd3
[   28.753878]  dump_stack+0x15/0x17
[   28.754302]  check_preemption_disabled+0x167/0x180
[   28.754881]  ? text_poke+0x2b/0x60
[   28.755298]  ? do_sync_core+0x30/0x30
[   28.755746]  debug_smp_processor_id+0x1c/0x20
[   28.756280]  perf_ftrace_function_call+0x7c/0x360
[   28.756859]  ? 0xffffffffa00dc099
[   28.757266]  ? __this_cpu_preempt_check+0x1c/0x20
[   28.757832]  ? lock_is_held_type+0xe2/0x140
[   28.758348]  ? alternatives_text_reserved+0xa0/0xa0
[   28.758937]  0xffffffffa00dc099
[   28.759322]  ? alternatives_text_reserved+0xa0/0xa0
[   28.759903]  ? alternatives_text_reserved+0xa0/0xa0
[   28.760459]  ? __text_poke+0x5/0x4e0
[   28.760889]  __text_poke+0x5/0x4e0
[   28.761284]  text_poke+0x2b/0x60
[   28.761662]  ? __text_poke+0x5/0x4e0
[   28.762095]  ? text_poke+0x2b/0x60
[   28.762502]  text_poke_bp_batch+0x93/0x2c0
[   28.762979]  ? 0xffffffffa00dc000
[   28.763375]  ? user_disable_single_step+0x50/0x50
[   28.763925]  text_poke_queue+0xa7/0xc0
[   28.764374]  ftrace_replace_code+0xfd/0x170
[   28.764856]  ftrace_modify_all_code+0x1b1/0x270
[   28.765385]  arch_ftrace_update_code+0x9/0x10
[   28.765910]  ftrace_run_update_code+0x30/0xa0
[   28.766440]  ftrace_startup_enable+0x5e/0xa0
[   28.766931]  ftrace_startup+0x16d/0x240
[   28.767378]  register_ftrace_function+0x43/0x90
[   28.767908]  perf_ftrace_event_register+0xc1/0xf0
[   28.768448]  perf_trace_event_init+0xa0/0x4c0
[   28.768964]  perf_trace_init+0xda/0x160
[   28.769411]  perf_tp_event_init+0x57/0xa0
[   28.769878]  perf_try_init_event+0x83/0x270
[   28.770385]  perf_event_alloc+0xe3f/0x1c10
[   28.770855]  ? _raw_spin_unlock+0x2c/0x50
[   28.771330]  ? alloc_fd+0x20d/0x320
[   28.771741]  __do_sys_perf_event_open+0x3bf/0x1de0
[   28.772295]  ? write_comp_data+0x2f/0x90
[   28.772770]  __x64_sys_perf_event_open+0x26/0x30
[   28.773306]  do_syscall_64+0x37/0x80
[   28.773741]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   28.774361] RIP: 0033:0x7fac0740459d
[   28.774795] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   28.776900] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   28.777743] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   28.778561] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   28.779364] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   28.780158] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   28.780962] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   28.781822] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   28.782749] caller is debug_smp_processor_id+0x1c/0x20
[   28.783368] CPU: 1 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   28.784228] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.785553] Call Trace:
[   28.785854]  dump_stack_lvl+0xa4/0xd3
[   28.786311]  dump_stack+0x15/0x17
[   28.786720]  check_preemption_disabled+0x167/0x180
[   28.787289]  ? text_poke+0x2b/0x60
[   28.787686]  ? do_sync_core+0x30/0x30
[   28.788116]  debug_smp_processor_id+0x1c/0x20
[   28.788626]  perf_ftrace_function_call+0x7c/0x360
[   28.789178]  ? 0xffffffffa00dc099
[   28.789588]  ? __this_cpu_preempt_check+0x1c/0x20
[   28.790161]  ? lock_is_held_type+0xe2/0x140
[   28.790665]  ? text_poke_early+0xc0/0xc0
[   28.791122]  0xffffffffa00dc099
[   28.791490]  ? text_poke_early+0xc0/0xc0
[   28.791956]  ? text_poke_early+0xc0/0xc0
[   28.792410]  ? __text_poke+0x5/0x4e0
[   28.792837]  __text_poke+0x5/0x4e0
[   28.793237]  text_poke+0x2b/0x60
[   28.793616]  ? __text_poke+0x5/0x4e0
[   28.794042]  ? text_poke+0x2b/0x60
[   28.794453]  text_poke_bp_batch+0x93/0x2c0
[   28.794927]  ? 0xffffffffa00dc000
[   28.795323]  ? user_disable_single_step+0x50/0x50
[   28.795863]  text_poke_queue+0xa7/0xc0
[   28.796306]  ftrace_replace_code+0xfd/0x170
[   28.796799]  ftrace_modify_all_code+0x1b1/0x270
[   28.797321]  arch_ftrace_update_code+0x9/0x10
[   28.797845]  ftrace_run_update_code+0x30/0xa0
[   28.798376]  ftrace_startup_enable+0x5e/0xa0
[   28.798887]  ftrace_startup+0x16d/0x240
[   28.799338]  register_ftrace_function+0x43/0x90
[   28.799870]  perf_ftrace_event_register+0xc1/0xf0
[   28.800416]  perf_trace_event_init+0xa0/0x4c0
[   28.800922]  perf_trace_init+0xda/0x160
[   28.801392]  perf_tp_event_init+0x57/0xa0
[   28.801863]  perf_try_init_event+0x83/0x270
[   28.802371]  perf_event_alloc+0xe3f/0x1c10
[   28.802846]  ? _raw_spin_unlock+0x2c/0x50
[   28.803324]  ? alloc_fd+0x20d/0x320
[   28.803736]  __do_sys_perf_event_open+0x3bf/0x1de0
[   28.804287]  ? write_comp_data+0x2f/0x90
[   28.804772]  __x64_sys_perf_event_open+0x26/0x30
[   28.805302]  do_syscall_64+0x37/0x80
[   28.805732]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   28.806376] RIP: 0033:0x7fac0740459d
[   28.806811] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   28.808873] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   28.809729] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   28.810536] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   28.811345] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   28.812141] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   28.812944] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   28.813786] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   28.814708] caller is debug_smp_processor_id+0x1c/0x20
[   28.815324] CPU: 1 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   28.816182] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.817507] Call Trace:
[   28.817808]  dump_stack_lvl+0xa4/0xd3
[   28.818265]  dump_stack+0x15/0x17
[   28.818656]  check_preemption_disabled+0x167/0x180
[   28.819217]  ? text_poke+0x2b/0x60
[   28.819615]  ? do_sync_core+0x30/0x30
[   28.820042]  debug_smp_processor_id+0x1c/0x20
[   28.820557]  perf_ftrace_function_call+0x7c/0x360
[   28.821103]  ? 0xffffffffa00dc099
[   28.821499]  ? __this_cpu_preempt_check+0x1c/0x20
[   28.822069]  ? lock_is_held_type+0xe2/0x140
[   28.822585]  ? apply_alternatives+0x370/0x370
[   28.823094]  0xffffffffa00dc099
[   28.823463]  ? apply_alternatives+0x370/0x370
[   28.823977]  ? apply_alternatives+0x370/0x370
[   28.824479]  ? __text_poke+0x5/0x4e0
[   28.824903]  __text_poke+0x5/0x4e0
[   28.825309]  text_poke+0x2b/0x60
[   28.825687]  ? __text_poke+0x5/0x4e0
[   28.826110]  ? text_poke+0x2b/0x60
[   28.826659]  text_poke_bp_batch+0x93/0x2c0
[   28.827365]  ? 0xffffffffa00dc000
[   28.827853]  ? user_disable_single_step+0x50/0x50
[   28.828682]  text_poke_queue+0xa7/0xc0
[   28.829303]  ftrace_replace_code+0xfd/0x170
[   28.829942]  ftrace_modify_all_code+0x1b1/0x270
[   28.830748]  arch_ftrace_update_code+0x9/0x10
[   28.831336]  ftrace_run_update_code+0x30/0xa0
[   28.831841]  ftrace_startup_enable+0x5e/0xa0
[   28.832346]  ftrace_startup+0x16d/0x240
[   28.832795]  register_ftrace_function+0x43/0x90
[   28.833328]  perf_ftrace_event_register+0xc1/0xf0
[   28.833900]  perf_trace_event_init+0xa0/0x4c0
[   28.834437]  perf_trace_init+0xda/0x160
[   28.834894]  perf_tp_event_init+0x57/0xa0
[   28.835371]  perf_try_init_event+0x83/0x270
[   28.835864]  perf_event_alloc+0xe3f/0x1c10
[   28.836336]  ? _raw_spin_unlock+0x2c/0x50
[   28.836818]  ? alloc_fd+0x20d/0x320
[   28.837231]  __do_sys_perf_event_open+0x3bf/0x1de0
[   28.837785]  ? write_comp_data+0x2f/0x90
[   28.838281]  __x64_sys_perf_event_open+0x26/0x30
[   28.838810]  do_syscall_64+0x37/0x80
[   28.839236]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   28.839814] RIP: 0033:0x7fac0740459d
[   28.840241] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   28.842353] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   28.843210] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   28.844020] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   28.844815] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   28.845624] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   28.846445] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   28.847351] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   28.848252] caller is debug_smp_processor_id+0x1c/0x20
[   28.848868] CPU: 1 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   28.849726] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.851059] Call Trace:
[   28.851359]  dump_stack_lvl+0xa4/0xd3
[   28.851809]  dump_stack+0x15/0x17
[   28.852217]  check_preemption_disabled+0x167/0x180
[   28.852794]  ? text_poke+0x2b/0x60
[   28.853191]  ? do_sync_core+0x30/0x30
[   28.853617]  debug_smp_processor_id+0x1c/0x20
[   28.854137]  perf_ftrace_function_call+0x7c/0x360
[   28.854684]  ? 0xffffffffa00dc099
[   28.855073]  ? __this_cpu_preempt_check+0x1c/0x20
[   28.855620]  ? lock_is_held_type+0xe2/0x140
[   28.856106]  ? apply_paravirt+0x150/0x150
[   28.856584]  0xffffffffa00dc099
[   28.856952]  ? apply_paravirt+0x150/0x150
[   28.857419]  ? apply_paravirt+0x150/0x150
[   28.857905]  ? __text_poke+0x5/0x4e0
[   28.858350]  __text_poke+0x5/0x4e0
[   28.858764]  text_poke+0x2b/0x60
[   28.859143]  ? __text_poke+0x5/0x4e0
[   28.859557]  ? text_poke+0x2b/0x60
[   28.859969]  text_poke_bp_batch+0x93/0x2c0
[   28.860442]  ? 0xffffffffa00dc000
[   28.860826]  ? user_disable_single_step+0x50/0x50
[   28.861380]  text_poke_queue+0xa7/0xc0
[   28.861817]  ftrace_replace_code+0xfd/0x170
[   28.862326]  ftrace_modify_all_code+0x1b1/0x270
[   28.862846]  arch_ftrace_update_code+0x9/0x10
[   28.863357]  ftrace_run_update_code+0x30/0xa0
[   28.863860]  ftrace_startup_enable+0x5e/0xa0
[   28.864352]  ftrace_startup+0x16d/0x240
[   28.864810]  register_ftrace_function+0x43/0x90
[   28.865332]  perf_ftrace_event_register+0xc1/0xf0
[   28.865885]  perf_trace_event_init+0xa0/0x4c0
[   28.866420]  perf_trace_init+0xda/0x160
[   28.866889]  perf_tp_event_init+0x57/0xa0
[   28.867354]  perf_try_init_event+0x83/0x270
[   28.867839]  perf_event_alloc+0xe3f/0x1c10
[   28.868323]  ? _raw_spin_unlock+0x2c/0x50
[   28.868787]  ? alloc_fd+0x20d/0x320
[   28.869205]  __do_sys_perf_event_open+0x3bf/0x1de0
[   28.869758]  ? write_comp_data+0x2f/0x90
[   28.870246]  __x64_sys_perf_event_open+0x26/0x30
[   28.870781]  do_syscall_64+0x37/0x80
[   28.871196]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   28.871782] RIP: 0033:0x7fac0740459d
[   28.872195] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   28.874291] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   28.875141] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   28.875940] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   28.876769] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   28.877602] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   28.878440] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   28.879297] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   28.880201] caller is debug_smp_processor_id+0x1c/0x20
[   28.880819] CPU: 1 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   28.881686] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.883021] Call Trace:
[   28.883322]  dump_stack_lvl+0xa4/0xd3
[   28.883771]  dump_stack+0x15/0x17
[   28.884177]  check_preemption_disabled+0x167/0x180
[   28.884727]  ? text_poke_bp_batch+0x93/0x2c0
[   28.885229]  ? apply_paravirt+0x150/0x150
[   28.885694]  debug_smp_processor_id+0x1c/0x20
[   28.886215]  perf_ftrace_function_call+0x7c/0x360
[   28.886768]  ? 0xffffffffa00dc099
[   28.887158]  ? __this_cpu_preempt_check+0x1c/0x20
[   28.887712]  ? lock_is_held_type+0xe2/0x140
[   28.888198]  ? __text_poke+0x2f2/0x4e0
[   28.888646]  ? __this_cpu_preempt_check+0x1c/0x20
[   28.889191]  0xffffffffa00dc099
[   28.889566]  ? text_poke+0x60/0x60
[   28.890005]  ? text_poke+0x5/0x60
[   28.890420]  text_poke+0x5/0x60
[   28.890809]  text_poke_bp_batch+0x93/0x2c0
[   28.891285]  ? text_poke+0x5/0x60
[   28.891672]  ? text_poke_bp_batch+0x93/0x2c0
[   28.892182]  ? 0xffffffffa00dc000
[   28.892568]  ? user_disable_single_step+0x50/0x50
[   28.893114]  text_poke_queue+0xa7/0xc0
[   28.893560]  ftrace_replace_code+0xfd/0x170
[   28.894051]  ftrace_modify_all_code+0x1b1/0x270
[   28.894592]  arch_ftrace_update_code+0x9/0x10
[   28.895094]  ftrace_run_update_code+0x30/0xa0
[   28.895609]  ftrace_startup_enable+0x5e/0xa0
[   28.896102]  ftrace_startup+0x16d/0x240
[   28.896555]  register_ftrace_function+0x43/0x90
[   28.897084]  perf_ftrace_event_register+0xc1/0xf0
[   28.897626]  perf_trace_event_init+0xa0/0x4c0
[   28.898157]  perf_trace_init+0xda/0x160
[   28.898610]  perf_tp_event_init+0x57/0xa0
[   28.899084]  perf_try_init_event+0x83/0x270
[   28.899572]  perf_event_alloc+0xe3f/0x1c10
[   28.900048]  ? _raw_spin_unlock+0x2c/0x50
[   28.900525]  ? alloc_fd+0x20d/0x320
[   28.900939]  __do_sys_perf_event_open+0x3bf/0x1de0
[   28.901503]  ? write_comp_data+0x2f/0x90
[   28.902002]  __x64_sys_perf_event_open+0x26/0x30
[   28.902564]  do_syscall_64+0x37/0x80
[   28.902983]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   28.903566] RIP: 0033:0x7fac0740459d
[   28.903990] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   28.906060] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   28.906917] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   28.907727] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   28.908537] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   28.909332] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   28.910163] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   28.911034] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   28.911947] caller is debug_smp_processor_id+0x1c/0x20
[   28.912561] CPU: 1 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   28.913418] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.914746] Call Trace:
[   28.915047]  dump_stack_lvl+0xa4/0xd3
[   28.915496]  dump_stack+0x15/0x17
[   28.915903]  check_preemption_disabled+0x167/0x180
[   28.916468]  ? text_poke+0x2b/0x60
[   28.916864]  ? do_sync_core+0x30/0x30
[   28.917303]  debug_smp_processor_id+0x1c/0x20
[   28.917836]  perf_ftrace_function_call+0x7c/0x360
[   28.918406]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   28.918945]  ? text_poke_bp_batch+0x93/0x2c0
[   28.919437]  ? perf_ftrace_function_call+0x4c/0x360
[   28.920009]  ? 0xffffffffa00dc099
[   28.920396]  ? __this_cpu_preempt_check+0x1c/0x20
[   28.920946]  ? lock_is_held_type+0xe2/0x140
[   28.921430]  ? text_poke+0x60/0x60
[   28.921829]  0xffffffffa00dc099
[   28.922219]  ? text_poke+0x60/0x60
[   28.922619]  ? text_poke+0x60/0x60
[   28.923015]  ? __text_poke+0x5/0x4e0
[   28.923443]  __text_poke+0x5/0x4e0
[   28.923839]  text_poke+0x2b/0x60
[   28.924216]  ? __text_poke+0x5/0x4e0
[   28.924642]  ? text_poke+0x2b/0x60
[   28.925039]  text_poke_bp_batch+0x93/0x2c0
[   28.925518]  ? 0xffffffffa00dc000
[   28.925922]  ? user_disable_single_step+0x50/0x50
[   28.926493]  text_poke_queue+0xa7/0xc0
[   28.926948]  ftrace_replace_code+0xfd/0x170
[   28.927435]  ftrace_modify_all_code+0x1b1/0x270
[   28.927967]  arch_ftrace_update_code+0x9/0x10
[   28.928467]  ftrace_run_update_code+0x30/0xa0
[   28.928973]  ftrace_startup_enable+0x5e/0xa0
[   28.929472]  ftrace_startup+0x16d/0x240
[   28.929919]  register_ftrace_function+0x43/0x90
[   28.930462]  perf_ftrace_event_register+0xc1/0xf0
[   28.931002]  perf_trace_event_init+0xa0/0x4c0
[   28.931521]  perf_trace_init+0xda/0x160
[   28.931967]  perf_tp_event_init+0x57/0xa0
[   28.932437]  perf_try_init_event+0x83/0x270
[   28.932931]  perf_event_alloc+0xe3f/0x1c10
[   28.933404]  ? _raw_spin_unlock+0x2c/0x50
[   28.933887]  ? alloc_fd+0x20d/0x320
[   28.934322]  __do_sys_perf_event_open+0x3bf/0x1de0
[   28.934898]  ? write_comp_data+0x2f/0x90
[   28.935397]  __x64_sys_perf_event_open+0x26/0x30
[   28.935955]  do_syscall_64+0x37/0x80
[   28.936371]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   28.936947] RIP: 0033:0x7fac0740459d
[   28.937373] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   28.939455] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   28.940350] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   28.941187] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   28.942021] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   28.942868] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   28.943707] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   28.944620] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   28.945572] caller is debug_smp_processor_id+0x1c/0x20
[   28.946253] CPU: 1 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   28.947167] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.948569] Call Trace:
[   28.948888]  dump_stack_lvl+0xa4/0xd3
[   28.949372]  dump_stack+0x15/0x17
[   28.949811]  check_preemption_disabled+0x167/0x180
[   28.950440]  ? text_poke_bp_batch+0x93/0x2c0
[   28.950973]  ? apply_paravirt+0x150/0x150
[   28.951463]  debug_smp_processor_id+0x1c/0x20
[   28.952005]  perf_ftrace_function_call+0x7c/0x360
[   28.952579]  ? 0xffffffffa00dc099
[   28.952998]  ? __this_cpu_preempt_check+0x1c/0x20
[   28.953574]  ? lock_is_held_type+0xe2/0x140
[   28.954095]  ? __text_poke+0x2f2/0x4e0
[   28.954573]  ? __this_cpu_preempt_check+0x1c/0x20
[   28.955150]  0xffffffffa00dc099
[   28.955579]  ? alternatives_smp_module_add+0x160/0x160
[   28.956198]  ? text_poke+0x5/0x60
[   28.956623]  text_poke+0x5/0x60
[   28.957014]  text_poke_bp_batch+0x93/0x2c0
[   28.957515]  ? text_poke+0x5/0x60
[   28.957957]  ? text_poke_bp_batch+0x93/0x2c0
[   28.958529]  ? 0xffffffffa00dc000
[   28.958974]  ? user_disable_single_step+0x50/0x50
[   28.959576]  text_poke_queue+0xa7/0xc0
[   28.960073]  ftrace_replace_code+0xfd/0x170
[   28.960614]  ftrace_modify_all_code+0x1b1/0x270
[   28.961199]  arch_ftrace_update_code+0x9/0x10
[   28.961762]  ftrace_run_update_code+0x30/0xa0
[   28.962347]  ftrace_startup_enable+0x5e/0xa0
[   28.962899]  ftrace_startup+0x16d/0x240
[   28.963408]  register_ftrace_function+0x43/0x90
[   28.963996]  perf_ftrace_event_register+0xc1/0xf0
[   28.964610]  perf_trace_event_init+0xa0/0x4c0
[   28.965177]  perf_trace_init+0xda/0x160
[   28.965684]  perf_tp_event_init+0x57/0xa0
[   28.966228]  perf_try_init_event+0x83/0x270
[   28.966788]  perf_event_alloc+0xe3f/0x1c10
[   28.967317]  ? _raw_spin_unlock+0x2c/0x50
[   28.967848]  ? alloc_fd+0x20d/0x320
[   28.968312]  __do_sys_perf_event_open+0x3bf/0x1de0
[   28.968923]  ? write_comp_data+0x2f/0x90
[   28.969454]  __x64_sys_perf_event_open+0x26/0x30
[   28.970055]  do_syscall_64+0x37/0x80
[   28.970534]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   28.971175] RIP: 0033:0x7fac0740459d
[   28.971640] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   28.973930] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   28.974878] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   28.975713] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   28.976563] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   28.977414] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   28.978276] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   28.979177] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   28.980128] caller is debug_smp_processor_id+0x1c/0x20
[   28.980779] CPU: 1 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   28.981684] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.983105] Call Trace:
[   28.983425]  dump_stack_lvl+0xa4/0xd3
[   28.983901]  dump_stack+0x15/0x17
[   28.984337]  check_preemption_disabled+0x167/0x180
[   28.984948]  ? text_poke+0x2b/0x60
[   28.985365]  ? do_sync_core+0x30/0x30
[   28.985825]  debug_smp_processor_id+0x1c/0x20
[   28.986398]  perf_ftrace_function_call+0x7c/0x360
[   28.986991]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   28.987556]  ? text_poke_bp_batch+0x93/0x2c0
[   28.988082]  ? perf_ftrace_function_call+0x4c/0x360
[   28.988670]  ? 0xffffffffa00dc099
[   28.989078]  ? __this_cpu_preempt_check+0x1c/0x20
[   28.989655]  ? lock_is_held_type+0xe2/0x140
[   28.990183]  ? alternatives_smp_module_add+0x160/0x160
[   28.990804]  0xffffffffa00dc099
[   28.991191]  ? alternatives_smp_module_add+0x160/0x160
[   28.991812]  ? alternatives_smp_module_add+0x160/0x160
[   28.992427]  ? __text_poke+0x5/0x4e0
[   28.992868]  __text_poke+0x5/0x4e0
[   28.993285]  text_poke+0x2b/0x60
[   28.993683]  ? __text_poke+0x5/0x4e0
[   28.994124]  ? text_poke+0x2b/0x60
[   28.994548]  text_poke_bp_batch+0x93/0x2c0
[   28.995057]  ? 0xffffffffa00dc000
[   28.995462]  ? user_disable_single_step+0x50/0x50
[   28.996030]  text_poke_queue+0xa7/0xc0
[   28.996491]  ftrace_replace_code+0xfd/0x170
[   28.997001]  ftrace_modify_all_code+0x1b1/0x270
[   28.997550]  arch_ftrace_update_code+0x9/0x10
[   28.998080]  ftrace_run_update_code+0x30/0xa0
[   28.998611]  ftrace_startup_enable+0x5e/0xa0
[   28.999128]  ftrace_startup+0x16d/0x240
[   28.999605]  register_ftrace_function+0x43/0x90
[   29.000154]  perf_ftrace_event_register+0xc1/0xf0
[   29.000723]  perf_trace_event_init+0xa0/0x4c0
[   29.001254]  perf_trace_init+0xda/0x160
[   29.001726]  perf_tp_event_init+0x57/0xa0
[   29.002219]  perf_try_init_event+0x83/0x270
[   29.002730]  perf_event_alloc+0xe3f/0x1c10
[   29.003238]  ? _raw_spin_unlock+0x2c/0x50
[   29.003726]  ? alloc_fd+0x20d/0x320
[   29.004158]  __do_sys_perf_event_open+0x3bf/0x1de0
[   29.004734]  ? write_comp_data+0x2f/0x90
[   29.005231]  __x64_sys_perf_event_open+0x26/0x30
[   29.005788]  do_syscall_64+0x37/0x80
[   29.006231]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   29.006839] RIP: 0033:0x7fac0740459d
[   29.007273] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   29.009371] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   29.010234] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   29.011156] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   29.012051] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   29.012954] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   29.013790] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   33.686069] check_preemption_disabled: 2323745 callbacks suppressed
[   33.686090] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   33.686954] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[   33.686978] caller is debug_smp_processor_id+0x1c/0x20
[   33.687938] caller is debug_smp_processor_id+0x1c/0x20
[   33.688879] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   33.691050] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   33.692422] Call Trace:
[   33.692754]  dump_stack_lvl+0xa4/0xd3
[   33.693244]  dump_stack+0x15/0x17
[   33.693683]  check_preemption_disabled+0x167/0x180
[   33.694299]  ? do_nanosleep+0x155/0x2a0
[   33.694792]  ? hrtimer_wakeup+0x40/0x40
[   33.695316]  debug_smp_processor_id+0x1c/0x20
[   33.695878]  perf_ftrace_function_call+0x7c/0x360
[   33.696492]  ? ftrace_call+0x5/0x44
[   33.696952]  ? write_comp_data+0x2f/0x90
[   33.697466]  ? perf_trace_buf_update+0x70/0x70
[   33.698037]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   33.698654]  ? ftrace_ops_list_func+0x1d2/0x2e0
[   33.699233]  ? __might_sleep+0x48/0x70
[   33.699732]  ? sched_show_task+0x70/0x70
[   33.700251]  ? do_nanosleep+0x9c/0x2a0
[   33.700749]  ? do_nanosleep+0x9c/0x2a0
[   33.701250]  0xffffffffa00dc099
[   33.701675]  ? __this_cpu_preempt_check+0x1c/0x20
[   33.702292]  ? lock_is_held_type+0xe2/0x140
[   33.702848]  ? do_nanosleep+0x140/0x2a0
[   33.703357]  ? hrtimer_try_to_cancel+0x5/0x290
[   33.703930]  ? write_comp_data+0x2f/0x90
[   33.704446]  hrtimer_try_to_cancel+0x5/0x290
[   33.704999]  do_nanosleep+0x155/0x2a0
[   33.705480]  ? hrtimer_try_to_cancel+0x5/0x290
[   33.706050]  ? do_nanosleep+0x155/0x2a0
[   33.706556]  ? write_comp_data+0x2f/0x90
[   33.707084]  hrtimer_nanosleep+0xf7/0x1b0
[   33.707635]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[   33.708247]  __x64_sys_nanosleep+0xfc/0x150
[   33.708807]  do_syscall_64+0x37/0x80
[   33.709280]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   33.709921] RIP: 0033:0x7fac073cca18
[   33.710397] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[   33.712622] RSP: 002b:00007ffebadbfe28 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[   33.713563] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[   33.714445] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbfe30
[   33.715318] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[   33.716191] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[   33.717065] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   33.718063] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   33.718083] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[   33.719023] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   33.719938] caller is debug_smp_processor_id+0x1c/0x20
[   33.721366] Call Trace:
[   33.722352]  dump_stack_lvl+0xa4/0xd3
[   33.722893]  dump_stack+0x15/0x17
[   33.723371]  check_preemption_disabled+0x167/0x180
[   33.724065]  debug_smp_processor_id+0x1c/0x20
[   33.724673]  perf_swevent_put_recursion_context+0x1b/0x40
[   33.725422]  perf_tp_event+0x331/0x4e0
[   33.726084]  ? preempt_count_sub+0x5/0xa0
[   33.726678]  ? preempt_count_sub+0x5/0xa0
[   33.727240]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[   33.727935]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   33.728594]  ? ___ratelimit+0x36/0x1e0
[   33.729179]  ? __printk_ratelimit+0x21/0x30
[   33.729790]  ? insn_get_sib+0x122/0x140
[   33.730331]  ? insn_get_opcode+0x3b0/0x3b0
[   33.730914]  perf_ftrace_function_call+0x248/0x360
[   33.731569]  ? perf_trace_buf_alloc+0xb0/0x100
[   33.732185]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   33.732832]  ? perf_ftrace_function_call+0x248/0x360
[   33.733648]  ? 0xffffffffa00dc099
[   33.734198]  0xffffffffa00dc099
[   33.734687]  ? 0xffffffffa00dc099
[   33.735190]  ? insn_get_sib+0x43/0x140
[   33.735737]  ? insn_get_modrm+0x5/0x2a0
[   33.736274]  ? write_comp_data+0x2f/0x90
[   33.736836]  insn_get_modrm+0x5/0x2a0
[   33.737352]  insn_get_sib+0x122/0x140
[   33.737869]  ? insn_get_modrm+0x5/0x2a0
[   33.738408]  ? insn_get_sib+0x122/0x140
[   33.738970]  insn_get_displacement+0x157/0x270
[   33.739609]  insn_get_immediate+0x181/0x570
[   33.740223]  insn_get_length+0x75/0x90
[   33.740770]  insn_decode+0x9b/0x170
[   33.741284]  ? probe_irq_off+0x190/0x190
[   33.741842]  text_poke_loc_init+0x63/0x140
[   33.742514]  ? probe_irq_off+0x190/0x190
[   33.743092]  text_poke_queue+0x84/0xc0
[   33.743650]  ftrace_replace_code+0xfd/0x170
[   33.744263]  ftrace_modify_all_code+0x1b1/0x270
[   33.744914]  arch_ftrace_update_code+0x9/0x10
[   33.745518]  ftrace_run_update_code+0x30/0xa0
[   33.746139]  ftrace_startup_enable+0x5e/0xa0
[   33.746747]  ftrace_startup+0x16d/0x240
[   33.747330]  register_ftrace_function+0x43/0x90
[   33.747969]  perf_ftrace_event_register+0xc1/0xf0
[   33.748629]  perf_trace_event_init+0xa0/0x4c0
[   33.749265]  perf_trace_init+0xda/0x160
[   33.749832]  perf_tp_event_init+0x57/0xa0
[   33.750409]  perf_try_init_event+0x83/0x270
[   33.751031]  perf_event_alloc+0xe3f/0x1c10
[   33.751597]  ? _raw_spin_unlock+0x2c/0x50
[   33.752164]  ? alloc_fd+0x20d/0x320
[   33.752724]  __do_sys_perf_event_open+0x3bf/0x1de0
[   33.753395]  ? write_comp_data+0x2f/0x90
[   33.754147]  __x64_sys_perf_event_open+0x26/0x30
[   33.754788]  do_syscall_64+0x37/0x80
[   33.755303]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   33.755991] RIP: 0033:0x7fac0740459d
[   33.756495] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   33.758839] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   33.759841] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   33.760765] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   33.761685] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   33.762615] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   33.763542] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   33.764605] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   33.764763] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   33.765506] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   33.766665] caller is debug_smp_processor_id+0x1c/0x20
[   33.767919] Call Trace:
[   33.767938]  dump_stack_lvl+0xa4/0xd3
[   33.769416]  dump_stack+0x15/0x17
[   33.769857]  check_preemption_disabled+0x167/0x180
[   33.770475]  ? hrtimer_try_to_cancel+0x38/0x290
[   33.771056]  ? __hrtimer_get_remaining+0x80/0x80
[   33.771654]  debug_smp_processor_id+0x1c/0x20
[   33.772218]  perf_ftrace_function_call+0x7c/0x360
[   33.772822]  ? do_nanosleep+0x155/0x2a0
[   33.773320]  ? hrtimer_wakeup+0x40/0x40
[   33.773822]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   33.774428]  ? do_nanosleep+0x155/0x2a0
[   33.774929]  ? perf_ftrace_function_call+0x4c/0x360
[   33.775563]  ? ftrace_call+0x5/0x44
[   33.776023]  ? write_comp_data+0x2f/0x90
[   33.776534]  ? perf_trace_buf_update+0x70/0x70
[   33.777106]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   33.777725]  ? do_nanosleep+0x9c/0x2a0
[   33.778223]  0xffffffffa00dc099
[   33.778638]  ? do_nanosleep+0x9c/0x2a0
[   33.779135]  ? do_nanosleep+0x9c/0x2a0
[   33.779637]  ? do_nanosleep+0x140/0x2a0
[   33.780146]  ? hrtimer_active+0x5/0xb0
[   33.780642]  ? do_nanosleep+0x140/0x2a0
[   33.781143]  hrtimer_active+0x5/0xb0
[   33.781616]  hrtimer_try_to_cancel+0x38/0x290
[   33.782183]  ? hrtimer_active+0x5/0xb0
[   33.782672]  ? hrtimer_try_to_cancel+0x38/0x290
[   33.783266]  ? do_nanosleep+0x9c/0x2a0
[   33.783760]  do_nanosleep+0x155/0x2a0
[   33.784238]  ? write_comp_data+0x2f/0x90
[   33.784767]  hrtimer_nanosleep+0xf7/0x1b0
[   33.785303]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[   33.785910]  __x64_sys_nanosleep+0xfc/0x150
[   33.786474]  do_syscall_64+0x37/0x80
[   33.786948]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   33.787591] RIP: 0033:0x7fac073cca18
[   33.788059] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[   33.790293] RSP: 002b:00007ffebadbfe28 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[   33.791235] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[   33.792110] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbfe30
[   33.792986] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[   33.793861] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[   33.794749] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   33.795683] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   33.795801] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[   33.796715] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   33.797631] caller is debug_smp_processor_id+0x1c/0x20
[   33.799187] Call Trace:
[   33.799229]  dump_stack_lvl+0xa4/0xd3
[   33.800788]  dump_stack+0x15/0x17
[   33.801323]  check_preemption_disabled+0x167/0x180
[   33.802052]  ? insn_get_modrm+0x12b/0x2a0
[   33.802667]  ? insn_get_prefixes+0x50/0x50
[   33.803325]  debug_smp_processor_id+0x1c/0x20
[   33.803998]  perf_ftrace_function_call+0x7c/0x360
[   33.804701]  ? perf_trace_buf_alloc+0xb0/0x100
[   33.805391]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   33.806107]  ? insn_get_sib+0x122/0x140
[   33.806711]  ? perf_ftrace_function_call+0x4c/0x360
[   33.807737]  0xffffffffa00dc099
[   33.808318]  ? 0xffffffffa00dc099
[   33.808893]  ? insn_get_modrm+0x49/0x2a0
[   33.809541]  ? insn_get_opcode+0x5/0x3b0
[   33.810156]  ? write_comp_data+0x2f/0x90
[   33.810793]  insn_get_opcode+0x5/0x3b0
[   33.811384]  insn_get_modrm+0x12b/0x2a0
[   33.811986]  ? insn_get_opcode+0x5/0x3b0
[   33.812585]  ? insn_get_modrm+0x12b/0x2a0
[   33.813264]  insn_get_sib+0x122/0x140
[   33.813891]  insn_get_displacement+0x157/0x270
[   33.814626]  insn_get_immediate+0x181/0x570
[   33.815333]  insn_get_length+0x75/0x90
[   33.815961]  insn_decode+0x9b/0x170
[   33.816544]  ? probe_irq_off+0x190/0x190
[   33.817160]  text_poke_loc_init+0x63/0x140
[   33.817964]  ? probe_irq_off+0x190/0x190
[   33.818629]  text_poke_queue+0x84/0xc0
[   33.819270]  ftrace_replace_code+0xfd/0x170
[   33.819978]  ftrace_modify_all_code+0x1b1/0x270
[   33.820721]  arch_ftrace_update_code+0x9/0x10
[   33.821394]  ftrace_run_update_code+0x30/0xa0
[   33.822088]  ftrace_startup_enable+0x5e/0xa0
[   33.822779]  ftrace_startup+0x16d/0x240
[   33.823467]  register_ftrace_function+0x43/0x90
[   33.824188]  perf_ftrace_event_register+0xc1/0xf0
[   33.824932]  perf_trace_event_init+0xa0/0x4c0
[   33.825665]  perf_trace_init+0xda/0x160
[   33.826322]  perf_tp_event_init+0x57/0xa0
[   33.826978]  perf_try_init_event+0x83/0x270
[   33.827699]  perf_event_alloc+0xe3f/0x1c10
[   33.828328]  ? _raw_spin_unlock+0x2c/0x50
[   33.828967]  ? alloc_fd+0x20d/0x320
[   33.829641]  __do_sys_perf_event_open+0x3bf/0x1de0
[   33.830397]  ? write_comp_data+0x2f/0x90
[   33.831387]  __x64_sys_perf_event_open+0x26/0x30
[   33.832104]  do_syscall_64+0x37/0x80
[   33.832686]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   33.833509] RIP: 0033:0x7fac0740459d
[   33.834077] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   33.836610] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   33.837709] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   33.838722] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   33.839729] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   33.840736] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   33.841744] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   33.843000] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   33.843159] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   33.843900] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   33.844950] caller is debug_smp_processor_id+0x1c/0x20
[   33.846309] Call Trace:
[   33.846328]  dump_stack_lvl+0xa4/0xd3
[   33.846361]  dump_stack+0x15/0x17
[   33.846384]  check_preemption_disabled+0x167/0x180
[   33.846411]  ? syscall_exit_to_user_mode+0xd/0x60
[   33.846433]  ? __bpf_trace_sys_enter+0x10/0x10
[   33.850025]  debug_smp_processor_id+0x1c/0x20
[   33.850594]  perf_ftrace_function_call+0x7c/0x360
[   33.851206]  ? write_comp_data+0x2f/0x90
[   33.851728]  ? write_comp_data+0x2f/0x90
[   33.852246]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   33.852854]  ? write_comp_data+0x2f/0x90
[   33.853373]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   33.853993]  0xffffffffa00dc099
[   33.854413]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   33.855051]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[   33.855745]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   33.856353]  syscall_exit_to_user_mode_prepare+0x5/0x240
[   33.857027]  syscall_exit_to_user_mode+0xd/0x60
[   33.857611]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[   33.858305]  ? syscall_exit_to_user_mode+0xd/0x60
[   33.858910]  do_syscall_64+0x46/0x80
[   33.859384]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   33.860027] RIP: 0033:0x7fac073cca18
[   33.860494] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[   33.862734] RSP: 002b:00007ffebadbfe28 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[   33.863681] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac073cca18
[   33.864557] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbfe30
[   33.865434] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[   33.866315] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[   33.867193] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   33.868161] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   33.868217] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[   33.869200] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   33.870156] caller is debug_smp_processor_id+0x1c/0x20
[   33.871676] Call Trace:
[   33.872693]  dump_stack_lvl+0xa4/0xd3
[   33.873313]  dump_stack+0x15/0x17
[   33.873848]  check_preemption_disabled+0x167/0x180
[   33.874846]  debug_smp_processor_id+0x1c/0x20
[   33.875606]  perf_swevent_get_recursion_context+0x1e/0xd0
[   33.876479]  perf_trace_buf_alloc+0x3d/0x100
[   33.877140]  ? insn_get_modrm+0x12b/0x2a0
[   33.877753]  ? insn_get_prefixes+0x50/0x50
[   33.878433]  perf_ftrace_function_call+0x209/0x360
[   33.879180]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   33.880093]  ? 0xffffffffa00dc099
[   33.880761]  0xffffffffa00dc099
[   33.881345]  ? 0xffffffffa00dc099
[   33.881924]  ? insn_get_modrm+0x49/0x2a0
[   33.882586]  ? insn_get_opcode+0x5/0x3b0
[   33.883203]  ? write_comp_data+0x2f/0x90
[   33.883841]  insn_get_opcode+0x5/0x3b0
[   33.884435]  insn_get_modrm+0x12b/0x2a0
[   33.885040]  ? insn_get_opcode+0x5/0x3b0
[   33.885643]  ? insn_get_modrm+0x12b/0x2a0
[   33.886352]  insn_get_sib+0x122/0x140
[   33.886982]  insn_get_displacement+0x157/0x270
[   33.887714]  insn_get_immediate+0x181/0x570
[   33.888424]  insn_get_length+0x75/0x90
[   33.889052]  insn_decode+0x9b/0x170
[   33.889636]  ? probe_irq_off+0x190/0x190
[   33.890260]  text_poke_loc_init+0x63/0x140
[   33.891065]  ? probe_irq_off+0x190/0x190
[   33.891731]  text_poke_queue+0x84/0xc0
[   33.892375]  ftrace_replace_code+0xfd/0x170
[   33.893086]  ftrace_modify_all_code+0x1b1/0x270
[   33.893830]  arch_ftrace_update_code+0x9/0x10
[   33.894512]  ftrace_run_update_code+0x30/0xa0
[   33.895218]  ftrace_startup_enable+0x5e/0xa0
[   33.895905]  ftrace_startup+0x16d/0x240
[   33.896595]  register_ftrace_function+0x43/0x90
[   33.897321]  perf_ftrace_event_register+0xc1/0xf0
[   33.898065]  perf_trace_event_init+0xa0/0x4c0
[   33.898807]  perf_trace_init+0xda/0x160
[   33.899460]  perf_tp_event_init+0x57/0xa0
[   33.900113]  perf_try_init_event+0x83/0x270
[   33.900838]  perf_event_alloc+0xe3f/0x1c10
[   33.901469]  ? _raw_spin_unlock+0x2c/0x50
[   33.902109]  ? alloc_fd+0x20d/0x320
[   33.902793]  __do_sys_perf_event_open+0x3bf/0x1de0
[   33.903549]  ? write_comp_data+0x2f/0x90
[   33.904546]  __x64_sys_perf_event_open+0x26/0x30
[   33.905267]  do_syscall_64+0x37/0x80
[   33.905851]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   33.906616] RIP: 0033:0x7fac0740459d
[   33.907179] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   33.909722] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   33.910830] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   33.911845] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   33.912859] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   33.913873] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   33.914889] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   33.916155] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   33.916311] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   33.917056] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   33.918131] caller is debug_smp_processor_id+0x1c/0x20
[   33.919392] Call Trace:
[   33.920373]  dump_stack_lvl+0xa4/0xd3
[   33.920863]  dump_stack+0x15/0x17
[   33.921303]  check_preemption_disabled+0x167/0x180
[   33.921916]  ? syscall_exit_to_user_mode_prepare+0x1c8/0x240
[   33.922631]  ? __audit_syscall_entry+0x1e0/0x1e0
[   33.923237]  debug_smp_processor_id+0x1c/0x20
[   33.923800]  perf_ftrace_function_call+0x7c/0x360
[   33.924402]  ? syscall_exit_to_user_mode+0xd/0x60
[   33.925004]  ? perf_ftrace_function_call+0x4c/0x360
[   33.925632]  ? write_comp_data+0x2f/0x90
[   33.926156]  ? write_comp_data+0x2f/0x90
[   33.926674]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   33.927281]  ? write_comp_data+0x2f/0x90
[   33.927813]  0xffffffffa00dc099
[   33.928239]  ? 0xffffffffa00dc099
[   33.928705]  ? __audit_syscall_exit+0x5/0x400
[   33.929274]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[   33.929966]  __audit_syscall_exit+0x5/0x400
[   33.930514]  syscall_exit_to_user_mode_prepare+0x1c8/0x240
[   33.931206]  ? __audit_syscall_exit+0x5/0x400
[   33.931767]  ? syscall_exit_to_user_mode_prepare+0x1c8/0x240
[   33.932492]  syscall_exit_to_user_mode+0xd/0x60
[   33.933079]  do_syscall_64+0x46/0x80
[   33.933552]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   33.934197] RIP: 0033:0x7fac073cca18
[   33.934663] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[   33.936913] RSP: 002b:00007ffebadbfe28 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[   33.937854] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac073cca18
[   33.938739] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbfe30
[   33.939613] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[   33.940487] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[   33.941360] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   33.942296] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   33.942383] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[   33.943248] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   33.944169] caller is debug_smp_processor_id+0x1c/0x20
[   33.945601] Call Trace:
[   33.946584]  dump_stack_lvl+0xa4/0xd3
[   33.947124]  dump_stack+0x15/0x17
[   33.947601]  check_preemption_disabled+0x167/0x180
[   33.948293]  debug_smp_processor_id+0x1c/0x20
[   33.948901]  perf_trace_buf_alloc+0x98/0x100
[   33.949498]  ? insn_get_modrm+0x12b/0x2a0
[   33.950053]  ? insn_get_prefixes+0x50/0x50
[   33.950636]  perf_ftrace_function_call+0x209/0x360
[   33.951418]  ? 0xffffffffa00dc099
[   33.951961]  0xffffffffa00dc099
[   33.952452]  ? 0xffffffffa00dc099
[   33.952949]  ? insn_get_modrm+0x49/0x2a0
[   33.953519]  ? insn_get_opcode+0x5/0x3b0
[   33.954070]  ? write_comp_data+0x2f/0x90
[   33.954637]  insn_get_opcode+0x5/0x3b0
[   33.955168]  insn_get_modrm+0x12b/0x2a0
[   33.955709]  ? insn_get_opcode+0x5/0x3b0
[   33.956253]  ? insn_get_modrm+0x12b/0x2a0
[   33.956846]  insn_get_sib+0x122/0x140
[   33.957390]  insn_get_displacement+0x157/0x270
[   33.958033]  insn_get_immediate+0x181/0x570
[   33.958650]  insn_get_length+0x75/0x90
[   33.959200]  insn_decode+0x9b/0x170
[   33.959711]  ? probe_irq_off+0x190/0x190
[   33.960264]  text_poke_loc_init+0x63/0x140
[   33.960926]  ? probe_irq_off+0x190/0x190
[   33.961505]  text_poke_queue+0x84/0xc0
[   33.962063]  ftrace_replace_code+0xfd/0x170
[   33.962686]  ftrace_modify_all_code+0x1b1/0x270
[   33.963339]  arch_ftrace_update_code+0x9/0x10
[   33.963952]  ftrace_run_update_code+0x30/0xa0
[   33.964569]  ftrace_startup_enable+0x5e/0xa0
[   33.965176]  ftrace_startup+0x16d/0x240
[   33.965762]  register_ftrace_function+0x43/0x90
[   33.966405]  perf_ftrace_event_register+0xc1/0xf0
[   33.967070]  perf_trace_event_init+0xa0/0x4c0
[   33.967708]  perf_trace_init+0xda/0x160
[   33.968276]  perf_tp_event_init+0x57/0xa0
[   33.968852]  perf_try_init_event+0x83/0x270
[   33.969488]  perf_event_alloc+0xe3f/0x1c10
[   33.970085]  ? _raw_spin_unlock+0x2c/0x50
[   33.970693]  ? alloc_fd+0x20d/0x320
[   33.971291]  __do_sys_perf_event_open+0x3bf/0x1de0
[   33.972000]  ? write_comp_data+0x2f/0x90
[   33.972795]  __x64_sys_perf_event_open+0x26/0x30
[   33.973476]  do_syscall_64+0x37/0x80
[   33.974022]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   33.974750] RIP: 0033:0x7fac0740459d
[   33.975283] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   33.977762] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   33.978832] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   33.979815] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   33.980797] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   33.981778] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   33.982761] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   33.983886] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   33.984048] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   33.984840] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   33.985865] caller is debug_smp_processor_id+0x1c/0x20
[   33.987246] Call Trace:
[   33.987264]  dump_stack_lvl+0xa4/0xd3
[   33.987297]  dump_stack+0x15/0x17
[   33.987320]  check_preemption_disabled+0x167/0x180
[   33.987347]  ? __audit_syscall_exit+0x190/0x400
[   33.990343]  ? path_get+0x40/0x40
[   33.990802]  debug_smp_processor_id+0x1c/0x20
[   33.991365]  perf_ftrace_function_call+0x7c/0x360
[   33.991969]  ? syscall_exit_to_user_mode_prepare+0x1c8/0x240
[   33.992680]  ? __audit_syscall_entry+0x1e0/0x1e0
[   33.993274]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   33.993877]  ? syscall_exit_to_user_mode_prepare+0x1c8/0x240
[   33.994597]  ? perf_ftrace_function_call+0x4c/0x360
[   33.995227]  ? syscall_exit_to_user_mode+0xd/0x60
[   33.995831]  ? perf_ftrace_function_call+0x4c/0x360
[   33.996459]  ? write_comp_data+0x2f/0x90
[   33.996978]  ? write_comp_data+0x2f/0x90
[   33.997513]  0xffffffffa00dc099
[   33.997955]  ? 0xffffffffa00dc099
[   33.998409]  ? __audit_syscall_exit+0xbb/0x400
[   33.998991]  ? path_put+0x5/0x30
[   33.999420]  ? write_comp_data+0x2f/0x90
[   33.999936]  path_put+0x5/0x30
[   34.000347]  __audit_syscall_exit+0x190/0x400
[   34.000912]  ? path_put+0x5/0x30
[   34.001339]  ? __audit_syscall_exit+0x190/0x400
[   34.001921]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[   34.002636]  syscall_exit_to_user_mode_prepare+0x1c8/0x240
[   34.003335]  syscall_exit_to_user_mode+0xd/0x60
[   34.003920]  do_syscall_64+0x46/0x80
[   34.004394]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   34.005037] RIP: 0033:0x7fac073cca18
[   34.005508] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[   34.007743] RSP: 002b:00007ffebadbfe28 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[   34.008687] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac073cca18
[   34.009561] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbfe30
[   34.010440] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[   34.011315] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[   34.012190] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   34.013123] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   34.014097] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   34.015578] Call Trace:
[   34.015944]  dump_stack_lvl+0xa4/0xd3
[   34.016484]  dump_stack+0x15/0x17
[   34.016963]  check_preemption_disabled+0x167/0x180
[   34.017656]  debug_smp_processor_id+0x1c/0x20
[   34.018274]  perf_swevent_put_recursion_context+0x1b/0x40
[   34.019035]  perf_tp_event+0x331/0x4e0
[   34.019680]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[   34.020515]  ? arch_local_irq_enable+0x10/0x12
[   34.021140]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   34.021813]  ? dump_stack_lvl+0xcc/0xd3
[   34.022386]  ? dump_stack+0x15/0x17
[   34.022903]  ? insn_get_modrm+0x12b/0x2a0
[   34.023598]  ? insn_get_prefixes+0x50/0x50
[   34.024191]  perf_ftrace_function_call+0x248/0x360
[   34.024854]  ? perf_trace_buf_alloc+0xb0/0x100
[   34.025472]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   34.026126]  ? perf_ftrace_function_call+0x248/0x360
[   34.026940]  ? 0xffffffffa00dc099
[   34.027483]  0xffffffffa00dc099
[   34.027973]  ? 0xffffffffa00dc099
[   34.028468]  ? insn_get_modrm+0x49/0x2a0
[   34.029037]  ? insn_get_opcode+0x5/0x3b0
[   34.029585]  ? write_comp_data+0x2f/0x90
[   34.030160]  insn_get_opcode+0x5/0x3b0
[   34.030692]  insn_get_modrm+0x12b/0x2a0
[   34.031230]  ? insn_get_opcode+0x5/0x3b0
[   34.031772]  ? insn_get_modrm+0x12b/0x2a0
[   34.032364]  insn_get_sib+0x122/0x140
[   34.032907]  insn_get_displacement+0x157/0x270
[   34.033544]  insn_get_immediate+0x181/0x570
[   34.034161]  insn_get_length+0x75/0x90
[   34.034710]  insn_decode+0x9b/0x170
[   34.035219]  ? probe_irq_off+0x190/0x190
[   34.035774]  text_poke_loc_init+0x63/0x140
[   34.036449]  ? probe_irq_off+0x190/0x190
[   34.037045]  text_poke_queue+0x84/0xc0
[   34.037616]  ftrace_replace_code+0xfd/0x170
[   34.038284]  ftrace_modify_all_code+0x1b1/0x270
[   34.038978]  arch_ftrace_update_code+0x9/0x10
[   34.039628]  ftrace_run_update_code+0x30/0xa0
[   34.040285]  ftrace_startup_enable+0x5e/0xa0
[   34.040926]  ftrace_startup+0x16d/0x240
[   34.041548]  register_ftrace_function+0x43/0x90
[   34.042237]  perf_ftrace_event_register+0xc1/0xf0
[   34.042938]  perf_trace_event_init+0xa0/0x4c0
[   34.043611]  perf_trace_init+0xda/0x160
[   34.044213]  perf_tp_event_init+0x57/0xa0
[   34.044811]  perf_try_init_event+0x83/0x270
[   34.045457]  perf_event_alloc+0xe3f/0x1c10
[   34.046046]  ? _raw_spin_unlock+0x2c/0x50
[   34.046655]  ? alloc_fd+0x20d/0x320
[   34.047234]  __do_sys_perf_event_open+0x3bf/0x1de0
[   34.047931]  ? write_comp_data+0x2f/0x90
[   34.048705]  __x64_sys_perf_event_open+0x26/0x30
[   34.049373]  do_syscall_64+0x37/0x80
[   34.049907]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   34.050641] RIP: 0033:0x7fac0740459d
[   34.051170] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   34.053643] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   34.054718] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   34.055688] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   34.056652] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   34.057615] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   34.058601] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   38.690107] check_preemption_disabled: 934093 callbacks suppressed
[   38.690134] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   38.691987] caller is debug_smp_processor_id+0x1c/0x20
[   38.692683] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   38.693633] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   38.695109] Call Trace:
[   38.695482]  dump_stack_lvl+0xa4/0xd3
[   38.696043]  dump_stack+0x15/0x17
[   38.696529]  check_preemption_disabled+0x167/0x180
[   38.697257]  debug_smp_processor_id+0x1c/0x20
[   38.697870]  perf_trace_buf_alloc+0x98/0x100
[   38.698493]  ? insn_get_opcode+0x20b/0x3b0
[   38.699060]  ? bad_get_user+0xd/0xd
[   38.699577]  perf_ftrace_function_call+0x209/0x360
[   38.700462]  ? 0xffffffffa00dc099
[   38.701069]  0xffffffffa00dc099
[   38.701534]  ? insn_get_prefixes.part.1+0x39b/0x650
[   38.702256]  ? inat_get_opcode_attribute+0x5/0x20
[   38.702911]  ? write_comp_data+0x2f/0x90
[   38.703493]  ? insn_get_opcode+0xaa/0x3b0
[   38.704095]  ? inat_get_opcode_attribute+0x5/0x20
[   38.704750]  ? write_comp_data+0x2f/0x90
[   38.705330]  inat_get_opcode_attribute+0x5/0x20
[   38.705971]  insn_get_opcode+0x20b/0x3b0
[   38.706546]  ? inat_get_opcode_attribute+0x5/0x20
[   38.707188]  ? insn_get_opcode+0x20b/0x3b0
[   38.707823]  insn_get_modrm+0x12b/0x2a0
[   38.708434]  insn_get_sib+0x122/0x140
[   38.709006]  insn_get_displacement+0x157/0x270
[   38.709678]  insn_get_immediate+0x181/0x570
[   38.710342]  insn_get_length+0x75/0x90
[   38.710913]  insn_decode+0x9b/0x170
[   38.711441]  ? grace_ender+0x30/0x30
[   38.711972]  text_poke_loc_init+0x63/0x140
[   38.712712]  ? grace_ender+0x30/0x30
[   38.713276]  text_poke_queue+0x84/0xc0
[   38.713861]  ftrace_replace_code+0xfd/0x170
[   38.714526]  ftrace_modify_all_code+0x1b1/0x270
[   38.715205]  arch_ftrace_update_code+0x9/0x10
[   38.715818]  ftrace_run_update_code+0x30/0xa0
[   38.716452]  ftrace_startup_enable+0x5e/0xa0
[   38.717075]  ftrace_startup+0x16d/0x240
[   38.717702]  register_ftrace_function+0x43/0x90
[   38.718375]  perf_ftrace_event_register+0xc1/0xf0
[   38.719053]  perf_trace_event_init+0xa0/0x4c0
[   38.719723]  perf_trace_init+0xda/0x160
[   38.720319]  perf_tp_event_init+0x57/0xa0
[   38.720912]  perf_try_init_event+0x83/0x270
[   38.721573]  perf_event_alloc+0xe3f/0x1c10
[   38.722161]  ? _raw_spin_unlock+0x2c/0x50
[   38.722746]  ? alloc_fd+0x20d/0x320
[   38.723378]  __do_sys_perf_event_open+0x3bf/0x1de0
[   38.724071]  ? write_comp_data+0x2f/0x90
[   38.724993]  __x64_sys_perf_event_open+0x26/0x30
[   38.725649]  do_syscall_64+0x37/0x80
[   38.726193]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   38.726880] RIP: 0033:0x7fac0740459d
[   38.727392] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   38.729744] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   38.730763] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   38.731688] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   38.732612] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   38.733535] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   38.734477] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   38.735908] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   38.735923] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   38.736944] caller is debug_smp_processor_id+0x1c/0x20
[   38.738189] caller is debug_smp_processor_id+0x1c/0x20
[   38.738874] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   38.740486] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   38.742005] Call Trace:
[   38.742398]  dump_stack_lvl+0xa4/0xd3
[   38.742989]  dump_stack+0x15/0x17
[   38.743498]  check_preemption_disabled+0x167/0x180
[   38.744263]  debug_smp_processor_id+0x1c/0x20
[   38.744909]  perf_swevent_put_recursion_context+0x1b/0x40
[   38.745708]  perf_tp_event+0x331/0x4e0
[   38.746486]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[   38.747429]  ? arch_local_irq_enable+0x10/0x12
[   38.748094]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   38.748804]  ? dump_stack_lvl+0xcc/0xd3
[   38.749452]  ? insn_get_opcode+0x20b/0x3b0
[   38.750047]  ? bad_get_user+0xd/0xd
[   38.750608]  perf_ftrace_function_call+0x248/0x360
[   38.751319]  ? perf_trace_buf_alloc+0xb0/0x100
[   38.751972]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   38.752657]  ? perf_ftrace_function_call+0x248/0x360
[   38.753632]  ? 0xffffffffa00dc099
[   38.754271]  0xffffffffa00dc099
[   38.754753]  ? insn_get_prefixes.part.1+0x39b/0x650
[   38.755516]  ? inat_get_opcode_attribute+0x5/0x20
[   38.756222]  ? write_comp_data+0x2f/0x90
[   38.756832]  ? insn_get_opcode+0xaa/0x3b0
[   38.757464]  ? inat_get_opcode_attribute+0x5/0x20
[   38.758156]  ? write_comp_data+0x2f/0x90
[   38.758859]  inat_get_opcode_attribute+0x5/0x20
[   38.759633]  insn_get_opcode+0x20b/0x3b0
[   38.760273]  ? inat_get_opcode_attribute+0x5/0x20
[   38.760956]  ? insn_get_opcode+0x20b/0x3b0
[   38.761650]  insn_get_modrm+0x12b/0x2a0
[   38.762310]  insn_get_sib+0x122/0x140
[   38.762910]  insn_get_displacement+0x157/0x270
[   38.763609]  insn_get_immediate+0x181/0x570
[   38.764288]  insn_get_length+0x75/0x90
[   38.764899]  insn_decode+0x9b/0x170
[   38.765457]  ? grace_ender+0x30/0x30
[   38.766007]  text_poke_loc_init+0x63/0x140
[   38.766800]  ? grace_ender+0x30/0x30
[   38.767487]  text_poke_queue+0x84/0xc0
[   38.768202]  ftrace_replace_code+0xfd/0x170
[   38.768961]  ftrace_modify_all_code+0x1b1/0x270
[   38.769713]  arch_ftrace_update_code+0x9/0x10
[   38.770391]  ftrace_run_update_code+0x30/0xa0
[   38.771056]  ftrace_startup_enable+0x5e/0xa0
[   38.771710]  ftrace_startup+0x16d/0x240
[   38.772370]  register_ftrace_function+0x43/0x90
[   38.773058]  perf_ftrace_event_register+0xc1/0xf0
[   38.773784]  perf_trace_event_init+0xa0/0x4c0
[   38.774519]  perf_trace_init+0xda/0x160
[   38.775144]  perf_tp_event_init+0x57/0xa0
[   38.775766]  perf_try_init_event+0x83/0x270
[   38.776469]  perf_event_alloc+0xe3f/0x1c10
[   38.777066]  ? _raw_spin_unlock+0x2c/0x50
[   38.777676]  ? alloc_fd+0x20d/0x320
[   38.778338]  __do_sys_perf_event_open+0x3bf/0x1de0
[   38.779062]  ? write_comp_data+0x2f/0x90
[   38.780033]  __x64_sys_perf_event_open+0x26/0x30
[   38.780720]  do_syscall_64+0x37/0x80
[   38.781275]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   38.781996] RIP: 0033:0x7fac0740459d
[   38.782586] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   38.785039] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   38.786093] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   38.787078] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   38.788055] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   38.789026] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   38.789996] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   38.791242] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   38.791420] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   38.792271] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   38.793370] caller is debug_smp_processor_id+0x1c/0x20
[   38.794764] Call Trace:
[   38.794794]  dump_stack_lvl+0xa4/0xd3
[   38.794859]  dump_stack+0x15/0x17
[   38.794894]  check_preemption_disabled+0x167/0x180
[   38.794943]  ? do_epoll_wait+0x3b3/0xd80
[   38.797986]  ? __mutex_lock+0x9f0/0x9f0
[   38.798548]  debug_smp_processor_id+0x1c/0x20
[   38.799137]  perf_ftrace_function_call+0x7c/0x360
[   38.799822]  ? ftrace_call+0x5/0x44
[   38.800296]  ? trace_hardirqs_on+0x6a/0x170
[   38.800906]  ? finish_task_switch+0xb0/0x2a0
[   38.801480]  ? finish_task_switch+0x70/0x2a0
[   38.802075]  ? trace_hardirqs_on+0x3f/0x170
[   38.802639]  ? finish_task_switch+0x70/0x2a0
[   38.803234]  ? preempt_count_sub+0x5/0xa0
[   38.803837]  0xffffffffa00dc099
[   38.804283]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   38.804929]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   38.805678]  ? do_epoll_wait+0x36b/0xd80
[   38.806251]  ? mutex_lock_nested+0x5/0x20
[   38.806797]  ? write_comp_data+0x2f/0x90
[   38.807350]  mutex_lock_nested+0x5/0x20
[   38.807875]  do_epoll_wait+0x3b3/0xd80
[   38.808391]  ? mutex_lock_nested+0x5/0x20
[   38.808928]  ? do_epoll_wait+0x3b3/0xd80
[   38.809620]  ? wait_woken+0x90/0x90
[   38.810190]  __x64_sys_epoll_wait+0x8d/0xd0
[   38.810824]  do_syscall_64+0x37/0x80
[   38.811328]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   38.811990] RIP: 0033:0x7f8a39143ae0
[   38.812481] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   38.814753] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   38.815721] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   38.816617] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   38.817514] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   38.818415] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   38.819313] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   38.820414] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   38.820545] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   38.821497] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   38.822600] caller is debug_smp_processor_id+0x1c/0x20
[   38.824149] Call Trace:
[   38.825206]  dump_stack_lvl+0xa4/0xd3
[   38.825878]  dump_stack+0x15/0x17
[   38.826454]  check_preemption_disabled+0x167/0x180
[   38.827230]  ? ftrace_replace_code+0xfd/0x170
[   38.827923]  ? jump_label_transform+0x70/0x70
[   38.828671]  debug_smp_processor_id+0x1c/0x20
[   38.829385]  perf_ftrace_function_call+0x7c/0x360
[   38.830132]  ? write_comp_data+0x2f/0x90
[   38.830847]  ? write_comp_data+0x2f/0x90
[   38.831551]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   38.832310]  ? write_comp_data+0x2f/0x90
[   38.833014]  ? write_comp_data+0x2f/0x90
[   38.833717]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   38.834623]  0xffffffffa00dc099
[   38.835213]  ? write_comp_data+0x2f/0x90
[   38.836022]  ? param_set_grace_period+0xc0/0xc0
[   38.836759]  ? text_poke_queue+0x5/0xc0
[   38.837399]  ? __fentry__+0x10/0x10
[   38.838025]  text_poke_queue+0x5/0xc0
[   38.838647]  ftrace_replace_code+0xfd/0x170
[   38.839335]  ? text_poke_queue+0x5/0xc0
[   38.839955]  ? ftrace_replace_code+0xfd/0x170
[   38.840752]  ftrace_modify_all_code+0x1b1/0x270
[   38.841559]  arch_ftrace_update_code+0x9/0x10
[   38.842273]  ftrace_run_update_code+0x30/0xa0
[   38.843022]  ftrace_startup_enable+0x5e/0xa0
[   38.843757]  ftrace_startup+0x16d/0x240
[   38.844522]  register_ftrace_function+0x43/0x90
[   38.845293]  perf_ftrace_event_register+0xc1/0xf0
[   38.846087]  perf_trace_event_init+0xa0/0x4c0
[   38.846894]  perf_trace_init+0xda/0x160
[   38.847608]  perf_tp_event_init+0x57/0xa0
[   38.848308]  perf_try_init_event+0x83/0x270
[   38.849103]  perf_event_alloc+0xe3f/0x1c10
[   38.849763]  ? _raw_spin_unlock+0x2c/0x50
[   38.850454]  ? alloc_fd+0x20d/0x320
[   38.851222]  __do_sys_perf_event_open+0x3bf/0x1de0
[   38.852030]  ? write_comp_data+0x2f/0x90
[   38.853250]  __x64_sys_perf_event_open+0x26/0x30
[   38.854019]  do_syscall_64+0x37/0x80
[   38.854653]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   38.855446] RIP: 0033:0x7fac0740459d
[   38.856044] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   38.858690] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   38.859844] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   38.860900] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   38.861956] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   38.863021] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   38.864079] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   38.865510] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   38.865681] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   38.866535] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   38.866555] Call Trace:
[   38.866581]  dump_stack_lvl+0xa4/0xd3
[   38.866646]  dump_stack+0x15/0x17
[   38.866687]  check_preemption_disabled+0x167/0x180
[   38.867776] caller is debug_smp_processor_id+0x1c/0x20
[   38.869161]  ? mutex_lock_nested+0x1b/0x20
[   38.872165]  ? mutex_lock_io_nested+0x940/0x940
[   38.872792]  debug_smp_processor_id+0x1c/0x20
[   38.873379]  perf_ftrace_function_call+0x7c/0x360
[   38.874009]  ? perf_ftrace_function_call+0x4c/0x360
[   38.874714]  ? ftrace_call+0x5/0x44
[   38.875186]  ? trace_hardirqs_on+0x6a/0x170
[   38.875789]  ? finish_task_switch+0xb0/0x2a0
[   38.876355]  ? finish_task_switch+0x70/0x2a0
[   38.876949]  ? trace_hardirqs_on+0x3f/0x170
[   38.877505]  ? finish_task_switch+0x70/0x2a0
[   38.878160]  0xffffffffa00dc099
[   38.878609]  ? 0xffffffffa00dc099
[   38.879075]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   38.879726]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   38.880435]  ? do_epoll_wait+0x3b3/0xd80
[   38.881017]  ? __mutex_lock+0x5/0x9f0
[   38.881520]  ? mutex_lock_nested+0x5/0x20
[   38.882064]  ? write_comp_data+0x2f/0x90
[   38.882602]  __mutex_lock+0x5/0x9f0
[   38.883085]  mutex_lock_nested+0x1b/0x20
[   38.883620]  ? __mutex_lock+0x5/0x9f0
[   38.884113]  ? mutex_lock_nested+0x1b/0x20
[   38.884667]  do_epoll_wait+0x3b3/0xd80
[   38.885340]  ? wait_woken+0x90/0x90
[   38.885896]  __x64_sys_epoll_wait+0x8d/0xd0
[   38.886533]  do_syscall_64+0x37/0x80
[   38.887035]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   38.887701] RIP: 0033:0x7f8a39143ae0
[   38.888189] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   38.890453] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   38.891415] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   38.892310] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   38.893200] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   38.894092] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   38.894988] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   38.896078] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   38.896207] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   38.897166] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   38.898323] caller is debug_smp_processor_id+0x1c/0x20
[   38.899878] Call Trace:
[   38.900938]  dump_stack_lvl+0xa4/0xd3
[   38.901613]  dump_stack+0x15/0x17
[   38.902190]  check_preemption_disabled+0x167/0x180
[   38.903061]  debug_smp_processor_id+0x1c/0x20
[   38.903779]  perf_swevent_get_recursion_context+0x1e/0xd0
[   38.904725]  perf_trace_buf_alloc+0x3d/0x100
[   38.905428]  ? ftrace_replace_code+0xfd/0x170
[   38.906129]  ? jump_label_transform+0x70/0x70
[   38.906863]  perf_ftrace_function_call+0x209/0x360
[   38.907981]  ? 0xffffffffa00dc099
[   38.908743]  0xffffffffa00dc099
[   38.909336]  ? write_comp_data+0x2f/0x90
[   38.910153]  ? param_set_grace_period+0xc0/0xc0
[   38.910895]  ? text_poke_queue+0x5/0xc0
[   38.911540]  ? __fentry__+0x10/0x10
[   38.912170]  text_poke_queue+0x5/0xc0
[   38.912793]  ftrace_replace_code+0xfd/0x170
[   38.913486]  ? text_poke_queue+0x5/0xc0
[   38.914113]  ? ftrace_replace_code+0xfd/0x170
[   38.914926]  ftrace_modify_all_code+0x1b1/0x270
[   38.915738]  arch_ftrace_update_code+0x9/0x10
[   38.916455]  ftrace_run_update_code+0x30/0xa0
[   38.917205]  ftrace_startup_enable+0x5e/0xa0
[   38.917945]  ftrace_startup+0x16d/0x240
[   38.918716]  register_ftrace_function+0x43/0x90
[   38.919492]  perf_ftrace_event_register+0xc1/0xf0
[   38.920292]  perf_trace_event_init+0xa0/0x4c0
[   38.921096]  perf_trace_init+0xda/0x160
[   38.921811]  perf_tp_event_init+0x57/0xa0
[   38.922518]  perf_try_init_event+0x83/0x270
[   38.923319]  perf_event_alloc+0xe3f/0x1c10
[   38.923981]  ? _raw_spin_unlock+0x2c/0x50
[   38.924667]  ? alloc_fd+0x20d/0x320
[   38.925436]  __do_sys_perf_event_open+0x3bf/0x1de0
[   38.926249]  ? write_comp_data+0x2f/0x90
[   38.927467]  __x64_sys_perf_event_open+0x26/0x30
[   38.928235]  do_syscall_64+0x37/0x80
[   38.928861]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   38.929655] RIP: 0033:0x7fac0740459d
[   38.930257] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   38.932917] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   38.934076] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   38.935144] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   38.936208] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   38.937268] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   38.938346] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   38.939780] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   38.939949] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   38.940802] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   38.941819] caller is debug_smp_processor_id+0x1c/0x20
[   38.943211] Call Trace:
[   38.943238]  dump_stack_lvl+0xa4/0xd3
[   38.943303]  dump_stack+0x15/0x17
[   38.943338]  check_preemption_disabled+0x167/0x180
[   38.943377]  ? ep_start_scan+0x68/0x100
[   38.946371]  ? _raw_read_lock_irq+0xa0/0xa0
[   38.946957]  debug_smp_processor_id+0x1c/0x20
[   38.947548]  perf_ftrace_function_call+0x7c/0x360
[   38.948184]  ? ftrace_ops_test+0x71/0xc0
[   38.948727]  ? preempt_notifier_dec+0x20/0x20
[   38.949369]  ? ftrace_call+0x5/0x44
[   38.949888]  ? write_comp_data+0x2f/0x90
[   38.950441]  ? perf_trace_buf_update+0x70/0x70
[   38.951038]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   38.951731]  0xffffffffa00dc099
[   38.952212]  ? ftrace_call+0x5/0x44
[   38.952694]  ? __mutex_lock+0xfe/0x9f0
[   38.953208]  ? do_epoll_wait+0x3b3/0xd80
[   38.953746]  ? ep_start_scan+0xe0/0x100
[   38.954310]  ? _raw_write_lock_irq+0x5/0x60
[   38.954879]  ? write_comp_data+0x2f/0x90
[   38.955431]  _raw_write_lock_irq+0x5/0x60
[   38.955985]  ep_start_scan+0x68/0x100
[   38.956492]  ? _raw_write_lock_irq+0x5/0x60
[   38.957050]  ? ep_start_scan+0x68/0x100
[   38.957613]  do_epoll_wait+0x3bf/0xd80
[   38.958294]  ? wait_woken+0x90/0x90
[   38.958852]  __x64_sys_epoll_wait+0x8d/0xd0
[   38.959485]  do_syscall_64+0x37/0x80
[   38.959989]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   38.960650] RIP: 0033:0x7f8a39143ae0
[   38.961138] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   38.963412] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   38.964378] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   38.965271] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   38.966185] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   38.967080] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   38.968004] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   38.969159] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   38.969299] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   38.970222] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   38.970247] Call Trace:
[   38.970284]  dump_stack_lvl+0xa4/0xd3
[   38.971389] caller is debug_smp_processor_id+0x1c/0x20
[   38.973025]  dump_stack+0x15/0x17
[   38.974988]  check_preemption_disabled+0x167/0x180
[   38.975759]  debug_smp_processor_id+0x1c/0x20
[   38.976425]  perf_trace_buf_alloc+0x98/0x100
[   38.977094]  ? ftrace_replace_code+0xfd/0x170
[   38.977762]  ? jump_label_transform+0x70/0x70
[   38.978463]  perf_ftrace_function_call+0x209/0x360
[   38.979455]  ? 0xffffffffa00dc099
[   38.980132]  0xffffffffa00dc099
[   38.980683]  ? write_comp_data+0x2f/0x90
[   38.981422]  ? param_set_grace_period+0xc0/0xc0
[   38.982135]  ? text_poke_queue+0x5/0xc0
[   38.982749]  ? __fentry__+0x10/0x10
[   38.983339]  text_poke_queue+0x5/0xc0
[   38.983930]  ftrace_replace_code+0xfd/0x170
[   38.984589]  ? text_poke_queue+0x5/0xc0
[   38.985188]  ? ftrace_replace_code+0xfd/0x170
[   38.985933]  ftrace_modify_all_code+0x1b1/0x270
[   38.986668]  arch_ftrace_update_code+0x9/0x10
[   38.987316]  ftrace_run_update_code+0x30/0xa0
[   38.987992]  ftrace_startup_enable+0x5e/0xa0
[   38.988651]  ftrace_startup+0x16d/0x240
[   38.989316]  register_ftrace_function+0x43/0x90
[   38.990011]  perf_ftrace_event_register+0xc1/0xf0
[   38.990730]  perf_trace_event_init+0xa0/0x4c0
[   38.991436]  perf_trace_init+0xda/0x160
[   38.992066]  perf_tp_event_init+0x57/0xa0
[   38.992691]  perf_try_init_event+0x83/0x270
[   38.993393]  perf_event_alloc+0xe3f/0x1c10
[   38.993996]  ? _raw_spin_unlock+0x2c/0x50
[   38.994621]  ? alloc_fd+0x20d/0x320
[   38.995274]  __do_sys_perf_event_open+0x3bf/0x1de0
[   38.995999]  ? write_comp_data+0x2f/0x90
[   38.996973]  __x64_sys_perf_event_open+0x26/0x30
[   38.997666]  do_syscall_64+0x37/0x80
[   38.998257]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   38.999015] RIP: 0033:0x7fac0740459d
[   38.999555] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   39.002032] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   39.003104] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   39.004083] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   39.005061] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   39.006039] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   39.007025] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   39.008256] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   39.008423] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   39.009277] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   39.010453] caller is debug_smp_processor_id+0x1c/0x20
[   39.011690] Call Trace:
[   39.012725]  dump_stack_lvl+0xa4/0xd3
[   39.013258]  dump_stack+0x15/0x17
[   39.013722]  check_preemption_disabled+0x167/0x180
[   39.014367]  ? timerfd_poll+0x68/0xa0
[   39.014861]  ? _raw_read_lock_irqsave+0x90/0x90
[   39.015490]  debug_smp_processor_id+0x1c/0x20
[   39.016078]  perf_ftrace_function_call+0x7c/0x360
[   39.016717]  ? ftrace_ops_test+0x71/0xc0
[   39.017262]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   39.017909]  ? ftrace_ops_test+0x71/0xc0
[   39.018483]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   39.019129]  ? write_comp_data+0x2f/0x90
[   39.019675]  ? perf_trace_buf_update+0x70/0x70
[   39.020273]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   39.020963]  0xffffffffa00dc099
[   39.021428]  ? signalfd_cleanup+0x50/0x50
[   39.021982]  ? ftrace_call+0x5/0x44
[   39.022545]  ? _raw_spin_lock_irqsave+0x5/0x70
[   39.023181]  _raw_spin_lock_irqsave+0x5/0x70
[   39.023759]  timerfd_poll+0x68/0xa0
[   39.024242]  ? _raw_spin_lock_irqsave+0x5/0x70
[   39.024831]  ? timerfd_poll+0x68/0xa0
[   39.025352]  ? signalfd_cleanup+0x50/0x50
[   39.025906]  ep_item_poll.isra.21+0x54/0x90
[   39.026523]  do_epoll_wait+0x490/0xd80
[   39.027198]  ? wait_woken+0x90/0x90
[   39.027756]  __x64_sys_epoll_wait+0x8d/0xd0
[   39.028390]  do_syscall_64+0x37/0x80
[   39.028893]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   39.029557] RIP: 0033:0x7f8a39143ae0
[   39.030046] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   39.032317] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   39.033281] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   39.034180] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   39.035077] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   39.035971] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   39.036867] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   39.037962] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   39.038988] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   39.040529] Call Trace:
[   39.040921]  dump_stack_lvl+0xa4/0xd3
[   39.041515]  dump_stack+0x15/0x17
[   39.042029]  check_preemption_disabled+0x167/0x180
[   39.042799]  debug_smp_processor_id+0x1c/0x20
[   39.043450]  perf_swevent_put_recursion_context+0x1b/0x40
[   39.044259]  perf_tp_event+0x331/0x4e0
[   39.045033]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[   39.045988]  ? arch_local_irq_enable+0x10/0x12
[   39.046664]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   39.047388]  ? dump_stack_lvl+0xcc/0xd3
[   39.048040]  ? ftrace_replace_code+0xfd/0x170
[   39.048675]  ? jump_label_transform+0x70/0x70
[   39.049347]  perf_ftrace_function_call+0x248/0x360
[   39.050065]  ? perf_trace_buf_alloc+0xb0/0x100
[   39.050728]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   39.051422]  ? perf_ftrace_function_call+0x248/0x360
[   39.052404]  ? 0xffffffffa00dc099
[   39.053046]  0xffffffffa00dc099
[   39.053567]  ? write_comp_data+0x2f/0x90
[   39.054270]  ? param_set_grace_period+0xc0/0xc0
[   39.054943]  ? text_poke_queue+0x5/0xc0
[   39.055525]  ? __fentry__+0x10/0x10
[   39.056085]  text_poke_queue+0x5/0xc0
[   39.056645]  ftrace_replace_code+0xfd/0x170
[   39.057271]  ? text_poke_queue+0x5/0xc0
[   39.057840]  ? ftrace_replace_code+0xfd/0x170
[   39.058551]  ftrace_modify_all_code+0x1b1/0x270
[   39.059270]  arch_ftrace_update_code+0x9/0x10
[   39.059918]  ftrace_run_update_code+0x30/0xa0
[   39.060590]  ftrace_startup_enable+0x5e/0xa0
[   39.061252]  ftrace_startup+0x16d/0x240
[   39.061916]  register_ftrace_function+0x43/0x90
[   39.062616]  perf_ftrace_event_register+0xc1/0xf0
[   39.063336]  perf_trace_event_init+0xa0/0x4c0
[   39.064044]  perf_trace_init+0xda/0x160
[   39.064674]  perf_tp_event_init+0x57/0xa0
[   39.065299]  perf_try_init_event+0x83/0x270
[   39.065998]  perf_event_alloc+0xe3f/0x1c10
[   39.066605]  ? _raw_spin_unlock+0x2c/0x50
[   39.067221]  ? alloc_fd+0x20d/0x320
[   39.067875]  __do_sys_perf_event_open+0x3bf/0x1de0
[   39.068602]  ? write_comp_data+0x2f/0x90
[   39.069576]  __x64_sys_perf_event_open+0x26/0x30
[   39.070274]  do_syscall_64+0x37/0x80
[   39.070834]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   39.071562] RIP: 0033:0x7fac0740459d
[   39.072102] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   39.074570] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   39.075627] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   39.076605] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   39.077585] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   39.078568] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   39.079547] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   43.694124] check_preemption_disabled: 735076 callbacks suppressed
[   43.694157] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   43.696162] caller is debug_smp_processor_id+0x1c/0x20
[   43.696926] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   43.697961] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   43.699548] Call Trace:
[   43.699966]  dump_stack_lvl+0xa4/0xd3
[   43.700601]  dump_stack+0x15/0x17
[   43.701141]  check_preemption_disabled+0x167/0x180
[   43.701874]  ? __get_locked_pte+0x1a2/0x290
[   43.702538]  ? __lock_text_start+0x8/0x8
[   43.703202]  debug_smp_processor_id+0x1c/0x20
[   43.703942]  perf_ftrace_function_call+0x7c/0x360
[   43.704978]  ? ftrace_ops_list_func+0x259/0x2e0
[   43.705737]  ? write_comp_data+0x2f/0x90
[   43.706437]  ? perf_trace_buf_update+0x70/0x70
[   43.707287]  0xffffffffa00dc099
[   43.707886]  ? intel_guc_wait_for_idle+0x1/0x90
[   43.708678]  ? ftrace_call+0x5/0x44
[   43.709309]  ? pmd_page_vaddr+0x2b/0x70
[   43.710006]  ? _raw_spin_lock+0x5/0x50
[   43.710722]  _raw_spin_lock+0x5/0x50
[   43.711339]  __get_locked_pte+0x1a2/0x290
[   43.712009]  ? _raw_spin_lock+0x5/0x50
[   43.712626]  ? __get_locked_pte+0x1a2/0x290
[   43.713352]  ? intel_guc_wait_for_idle+0x1/0x90
[   43.714142]  __text_poke+0xea/0x4e0
[   43.714743]  ? intel_guc_wait_for_idle+0x1/0x90
[   43.715521]  ? lock_is_held_type+0xe2/0x140
[   43.716234]  ? intel_guc_wait_for_idle+0x1/0x90
[   43.717044]  text_poke+0x2b/0x60
[   43.717655]  text_poke_bp_batch+0xf5/0x2c0
[   43.718427]  ? intel_huc_fini+0x50/0x50
[   43.719141]  text_poke_queue+0xa7/0xc0
[   43.719845]  ftrace_replace_code+0xfd/0x170
[   43.720624]  ftrace_modify_all_code+0x1b1/0x270
[   43.721439]  arch_ftrace_update_code+0x9/0x10
[   43.722172]  ftrace_run_update_code+0x30/0xa0
[   43.722923]  ftrace_startup_enable+0x5e/0xa0
[   43.723661]  ftrace_startup+0x16d/0x240
[   43.724423]  register_ftrace_function+0x43/0x90
[   43.725198]  perf_ftrace_event_register+0xc1/0xf0
[   43.726001]  perf_trace_event_init+0xa0/0x4c0
[   43.726818]  perf_trace_init+0xda/0x160
[   43.727532]  perf_tp_event_init+0x57/0xa0
[   43.728236]  perf_try_init_event+0x83/0x270
[   43.729032]  perf_event_alloc+0xe3f/0x1c10
[   43.729711]  ? _raw_spin_unlock+0x2c/0x50
[   43.730416]  ? alloc_fd+0x20d/0x320
[   43.731181]  __do_sys_perf_event_open+0x3bf/0x1de0
[   43.731995]  ? write_comp_data+0x2f/0x90
[   43.733184]  __x64_sys_perf_event_open+0x26/0x30
[   43.733956]  do_syscall_64+0x37/0x80
[   43.734600]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   43.735401] RIP: 0033:0x7fac0740459d
[   43.736008] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   43.738721] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   43.739888] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   43.740966] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   43.742041] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   43.743126] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   43.744199] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   43.745893] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   43.745910] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   43.745938] caller is debug_smp_processor_id+0x1c/0x20
[   43.747246] caller is debug_smp_processor_id+0x1c/0x20
[   43.748267] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   43.750877] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   43.752421] Call Trace:
[   43.752805]  dump_stack_lvl+0xa4/0xd3
[   43.753383]  dump_stack+0x15/0x17
[   43.753888]  check_preemption_disabled+0x167/0x180
[   43.754588]  ? do_epoll_wait+0x3b3/0xd80
[   43.755163]  ? __mutex_lock+0x9f0/0x9f0
[   43.755751]  debug_smp_processor_id+0x1c/0x20
[   43.756392]  perf_ftrace_function_call+0x7c/0x360
[   43.757132]  ? ftrace_call+0x5/0x44
[   43.757649]  ? trace_hardirqs_on+0x6a/0x170
[   43.758313]  ? finish_task_switch+0xb0/0x2a0
[   43.758933]  ? finish_task_switch+0x70/0x2a0
[   43.759579]  ? trace_hardirqs_on+0x3f/0x170
[   43.760187]  ? finish_task_switch+0x70/0x2a0
[   43.760833]  ? preempt_count_sub+0x5/0xa0
[   43.761483]  0xffffffffa00dc099
[   43.761968]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   43.762673]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   43.763486]  ? do_epoll_wait+0x36b/0xd80
[   43.764097]  ? mutex_lock_nested+0x5/0x20
[   43.764690]  ? write_comp_data+0x2f/0x90
[   43.765288]  mutex_lock_nested+0x5/0x20
[   43.765860]  do_epoll_wait+0x3b3/0xd80
[   43.766426]  ? mutex_lock_nested+0x5/0x20
[   43.767021]  ? do_epoll_wait+0x3b3/0xd80
[   43.767766]  ? wait_woken+0x90/0x90
[   43.768365]  __x64_sys_epoll_wait+0x8d/0xd0
[   43.769047]  do_syscall_64+0x37/0x80
[   43.769601]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   43.770348] RIP: 0033:0x7f8a39143ae0
[   43.770888] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   43.773376] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   43.774437] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   43.775419] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   43.776395] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   43.777371] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   43.778356] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   43.779536] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   43.779653] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   43.780707] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   43.781839] caller is debug_smp_processor_id+0x1c/0x20
[   43.783587] Call Trace:
[   43.783638]  dump_stack_lvl+0xa4/0xd3
[   43.785441]  dump_stack+0x15/0x17
[   43.786045]  check_preemption_disabled+0x167/0x180
[   43.786964]  debug_smp_processor_id+0x1c/0x20
[   43.787731]  perf_swevent_get_recursion_context+0x1e/0xd0
[   43.788731]  perf_trace_buf_alloc+0x3d/0x100
[   43.789476]  ? __get_locked_pte+0x1a2/0x290
[   43.790200]  ? __lock_text_start+0x8/0x8
[   43.790912]  perf_ftrace_function_call+0x209/0x360
[   43.792073]  ? 0xffffffffa00dc099
[   43.792868]  0xffffffffa00dc099
[   43.793493]  ? intel_guc_wait_for_idle+0x1/0x90
[   43.794333]  ? ftrace_call+0x5/0x44
[   43.794998]  ? pmd_page_vaddr+0x2b/0x70
[   43.795730]  ? _raw_spin_lock+0x5/0x50
[   43.796469]  _raw_spin_lock+0x5/0x50
[   43.797114]  __get_locked_pte+0x1a2/0x290
[   43.797822]  ? _raw_spin_lock+0x5/0x50
[   43.798483]  ? __get_locked_pte+0x1a2/0x290
[   43.799249]  ? intel_guc_wait_for_idle+0x1/0x90
[   43.800070]  __text_poke+0xea/0x4e0
[   43.800701]  ? intel_guc_wait_for_idle+0x1/0x90
[   43.801519]  ? lock_is_held_type+0xe2/0x140
[   43.802281]  ? intel_guc_wait_for_idle+0x1/0x90
[   43.803137]  text_poke+0x2b/0x60
[   43.803782]  text_poke_bp_batch+0xf5/0x2c0
[   43.804574]  ? intel_huc_fini+0x50/0x50
[   43.805328]  text_poke_queue+0xa7/0xc0
[   43.806069]  ftrace_replace_code+0xfd/0x170
[   43.806909]  ftrace_modify_all_code+0x1b1/0x270
[   43.807773]  arch_ftrace_update_code+0x9/0x10
[   43.808537]  ftrace_run_update_code+0x30/0xa0
[   43.809331]  ftrace_startup_enable+0x5e/0xa0
[   43.810111]  ftrace_startup+0x16d/0x240
[   43.810926]  register_ftrace_function+0x43/0x90
[   43.811746]  perf_ftrace_event_register+0xc1/0xf0
[   43.812595]  perf_trace_event_init+0xa0/0x4c0
[   43.813444]  perf_trace_init+0xda/0x160
[   43.814206]  perf_tp_event_init+0x57/0xa0
[   43.814951]  perf_try_init_event+0x83/0x270
[   43.815793]  perf_event_alloc+0xe3f/0x1c10
[   43.816499]  ? _raw_spin_unlock+0x2c/0x50
[   43.817225]  ? alloc_fd+0x20d/0x320
[   43.818030]  __do_sys_perf_event_open+0x3bf/0x1de0
[   43.818901]  ? write_comp_data+0x2f/0x90
[   43.820160]  __x64_sys_perf_event_open+0x26/0x30
[   43.820978]  do_syscall_64+0x37/0x80
[   43.821640]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   43.822496] RIP: 0033:0x7fac0740459d
[   43.823134] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   43.825974] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   43.827221] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   43.828357] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   43.829495] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   43.830642] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   43.831782] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   43.833290] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   43.833458] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   43.834423] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   43.834442] Call Trace:
[   43.834469]  dump_stack_lvl+0xa4/0xd3
[   43.834534]  dump_stack+0x15/0x17
[   43.834569]  check_preemption_disabled+0x167/0x180
[   43.835658] caller is debug_smp_processor_id+0x1c/0x20
[   43.837184]  ? mutex_lock_nested+0x1b/0x20
[   43.840440]  ? mutex_lock_io_nested+0x940/0x940
[   43.841119]  debug_smp_processor_id+0x1c/0x20
[   43.841760]  perf_ftrace_function_call+0x7c/0x360
[   43.842453]  ? perf_ftrace_function_call+0x4c/0x360
[   43.843220]  ? ftrace_call+0x5/0x44
[   43.843736]  ? trace_hardirqs_on+0x6a/0x170
[   43.844388]  ? finish_task_switch+0xb0/0x2a0
[   43.845005]  ? finish_task_switch+0x70/0x2a0
[   43.845656]  ? trace_hardirqs_on+0x3f/0x170
[   43.846264]  ? finish_task_switch+0x70/0x2a0
[   43.846966]  0xffffffffa00dc099
[   43.847456]  ? 0xffffffffa00dc099
[   43.847961]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   43.848665]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   43.849438]  ? do_epoll_wait+0x3b3/0xd80
[   43.850068]  ? __mutex_lock+0x5/0x9f0
[   43.850619]  ? mutex_lock_nested+0x5/0x20
[   43.851211]  ? write_comp_data+0x2f/0x90
[   43.851791]  __mutex_lock+0x5/0x9f0
[   43.852318]  mutex_lock_nested+0x1b/0x20
[   43.852900]  ? __mutex_lock+0x5/0x9f0
[   43.853438]  ? mutex_lock_nested+0x1b/0x20
[   43.854042]  do_epoll_wait+0x3b3/0xd80
[   43.854762]  ? wait_woken+0x90/0x90
[   43.855359]  __x64_sys_epoll_wait+0x8d/0xd0
[   43.856041]  do_syscall_64+0x37/0x80
[   43.856585]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   43.857305] RIP: 0033:0x7f8a39143ae0
[   43.857835] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   43.860323] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   43.861373] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   43.862356] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   43.863331] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   43.864306] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   43.865281] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   43.866455] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   43.866573] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   43.867533] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   43.868665] caller is debug_smp_processor_id+0x1c/0x20
[   43.870293] Call Trace:
[   43.870328]  dump_stack_lvl+0xa4/0xd3
[   43.870409]  dump_stack+0x15/0x17
[   43.872508]  check_preemption_disabled+0x167/0x180
[   43.873323]  debug_smp_processor_id+0x1c/0x20
[   43.874019]  perf_trace_buf_alloc+0x98/0x100
[   43.874705]  ? __get_locked_pte+0x1a2/0x290
[   43.875361]  ? __lock_text_start+0x8/0x8
[   43.876013]  perf_ftrace_function_call+0x209/0x360
[   43.876997]  ? 0xffffffffa00dc099
[   43.877671]  0xffffffffa00dc099
[   43.878233]  ? intel_guc_wait_for_idle+0x1/0x90
[   43.878976]  ? ftrace_call+0x5/0x44
[   43.879571]  ? pmd_page_vaddr+0x2b/0x70
[   43.880224]  ? _raw_spin_lock+0x5/0x50
[   43.880881]  _raw_spin_lock+0x5/0x50
[   43.881465]  __get_locked_pte+0x1a2/0x290
[   43.882109]  ? _raw_spin_lock+0x5/0x50
[   43.882709]  ? __get_locked_pte+0x1a2/0x290
[   43.883406]  ? intel_guc_wait_for_idle+0x1/0x90
[   43.884149]  __text_poke+0xea/0x4e0
[   43.884721]  ? intel_guc_wait_for_idle+0x1/0x90
[   43.885463]  ? lock_is_held_type+0xe2/0x140
[   43.886147]  ? intel_guc_wait_for_idle+0x1/0x90
[   43.886911]  text_poke+0x2b/0x60
[   43.887481]  text_poke_bp_batch+0xf5/0x2c0
[   43.888184]  ? intel_huc_fini+0x50/0x50
[   43.888853]  text_poke_queue+0xa7/0xc0
[   43.889511]  ftrace_replace_code+0xfd/0x170
[   43.890242]  ftrace_modify_all_code+0x1b1/0x270
[   43.891005]  arch_ftrace_update_code+0x9/0x10
[   43.891696]  ftrace_run_update_code+0x30/0xa0
[   43.892410]  ftrace_startup_enable+0x5e/0xa0
[   43.893115]  ftrace_startup+0x16d/0x240
[   43.893821]  register_ftrace_function+0x43/0x90
[   43.894566]  perf_ftrace_event_register+0xc1/0xf0
[   43.895333]  perf_trace_event_init+0xa0/0x4c0
[   43.896087]  perf_trace_init+0xda/0x160
[   43.896757]  perf_tp_event_init+0x57/0xa0
[   43.897424]  perf_try_init_event+0x83/0x270
[   43.898169]  perf_event_alloc+0xe3f/0x1c10
[   43.898814]  ? _raw_spin_unlock+0x2c/0x50
[   43.899469]  ? alloc_fd+0x20d/0x320
[   43.900157]  __do_sys_perf_event_open+0x3bf/0x1de0
[   43.900932]  ? write_comp_data+0x2f/0x90
[   43.901946]  __x64_sys_perf_event_open+0x26/0x30
[   43.902688]  do_syscall_64+0x37/0x80
[   43.903283]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   43.904061] RIP: 0033:0x7fac0740459d
[   43.904646] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   43.907325] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   43.908464] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   43.909518] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   43.910573] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   43.911626] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   43.912678] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   43.914027] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   43.914158] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   43.915146] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   43.916242] caller is debug_smp_processor_id+0x1c/0x20
[   43.917750] Call Trace:
[   43.918874]  dump_stack_lvl+0xa4/0xd3
[   43.919451]  dump_stack+0x15/0x17
[   43.919953]  check_preemption_disabled+0x167/0x180
[   43.920649]  ? ep_start_scan+0x68/0x100
[   43.921218]  ? _raw_read_lock_irq+0xa0/0xa0
[   43.921853]  debug_smp_processor_id+0x1c/0x20
[   43.922495]  perf_ftrace_function_call+0x7c/0x360
[   43.923179]  ? ftrace_ops_test+0x71/0xc0
[   43.923769]  ? preempt_notifier_dec+0x20/0x20
[   43.924461]  ? ftrace_call+0x5/0x44
[   43.925020]  ? write_comp_data+0x2f/0x90
[   43.925609]  ? perf_trace_buf_update+0x70/0x70
[   43.926262]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   43.927010]  0xffffffffa00dc099
[   43.927531]  ? ftrace_call+0x5/0x44
[   43.928057]  ? __mutex_lock+0xfe/0x9f0
[   43.928614]  ? do_epoll_wait+0x3b3/0xd80
[   43.929196]  ? ep_start_scan+0xe0/0x100
[   43.929795]  ? _raw_write_lock_irq+0x5/0x60
[   43.930415]  ? write_comp_data+0x2f/0x90
[   43.931014]  _raw_write_lock_irq+0x5/0x60
[   43.931608]  ep_start_scan+0x68/0x100
[   43.932157]  ? _raw_write_lock_irq+0x5/0x60
[   43.932763]  ? ep_start_scan+0x68/0x100
[   43.933370]  do_epoll_wait+0x3bf/0xd80
[   43.934089]  ? wait_woken+0x90/0x90
[   43.934691]  __x64_sys_epoll_wait+0x8d/0xd0
[   43.935373]  do_syscall_64+0x37/0x80
[   43.935917]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   43.936636] RIP: 0033:0x7f8a39143ae0
[   43.937165] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   43.939665] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   43.940718] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   43.941693] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   43.942672] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   43.943647] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   43.944621] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   43.945793] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   43.945956] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   43.946885] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   43.948023] caller is debug_smp_processor_id+0x1c/0x20
[   43.949651] Call Trace:
[   43.950758]  dump_stack_lvl+0xa4/0xd3
[   43.951390]  dump_stack+0x15/0x17
[   43.951938]  check_preemption_disabled+0x167/0x180
[   43.952751]  debug_smp_processor_id+0x1c/0x20
[   43.953447]  perf_swevent_put_recursion_context+0x1b/0x40
[   43.954314]  perf_tp_event+0x331/0x4e0
[   43.955257]  ? arch_local_irq_enable+0x10/0x12
[   43.955973]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   43.956738]  ? dump_stack_lvl+0xcc/0xd3
[   43.957404]  ? dump_stack+0x15/0x17
[   43.957975]  ? check_preemption_disabled+0x167/0x180
[   43.958821]  ? __get_locked_pte+0x1a2/0x290
[   43.959477]  ? __lock_text_start+0x8/0x8
[   43.960134]  perf_ftrace_function_call+0x248/0x360
[   43.960877]  ? perf_ftrace_function_call+0x248/0x360
[   43.961914]  ? 0xffffffffa00dc099
[   43.962594]  0xffffffffa00dc099
[   43.963146]  ? intel_guc_wait_for_idle+0x1/0x90
[   43.963888]  ? ftrace_call+0x5/0x44
[   43.964480]  ? pmd_page_vaddr+0x2b/0x70
[   43.965133]  ? _raw_spin_lock+0x5/0x50
[   43.965788]  _raw_spin_lock+0x5/0x50
[   43.966379]  __get_locked_pte+0x1a2/0x290
[   43.967023]  ? _raw_spin_lock+0x5/0x50
[   43.967617]  ? __get_locked_pte+0x1a2/0x290
[   43.968307]  ? intel_guc_wait_for_idle+0x1/0x90
[   43.969048]  __text_poke+0xea/0x4e0
[   43.969620]  ? intel_guc_wait_for_idle+0x1/0x90
[   43.970364]  ? lock_is_held_type+0xe2/0x140
[   43.971043]  ? intel_guc_wait_for_idle+0x1/0x90
[   43.971807]  text_poke+0x2b/0x60
[   43.972379]  text_poke_bp_batch+0xf5/0x2c0
[   43.973084]  ? intel_huc_fini+0x50/0x50
[   43.973755]  text_poke_queue+0xa7/0xc0
[   43.974415]  ftrace_replace_code+0xfd/0x170
[   43.975142]  ftrace_modify_all_code+0x1b1/0x270
[   43.975911]  arch_ftrace_update_code+0x9/0x10
[   43.976602]  ftrace_run_update_code+0x30/0xa0
[   43.977318]  ftrace_startup_enable+0x5e/0xa0
[   43.978023]  ftrace_startup+0x16d/0x240
[   43.978732]  register_ftrace_function+0x43/0x90
[   43.979473]  perf_ftrace_event_register+0xc1/0xf0
[   43.980247]  perf_trace_event_init+0xa0/0x4c0
[   43.980998]  perf_trace_init+0xda/0x160
[   43.981666]  perf_tp_event_init+0x57/0xa0
[   43.982338]  perf_try_init_event+0x83/0x270
[   43.983083]  perf_event_alloc+0xe3f/0x1c10
[   43.983730]  ? _raw_spin_unlock+0x2c/0x50
[   43.984386]  ? alloc_fd+0x20d/0x320
[   43.985075]  __do_sys_perf_event_open+0x3bf/0x1de0
[   43.985850]  ? write_comp_data+0x2f/0x90
[   43.986866]  __x64_sys_perf_event_open+0x26/0x30
[   43.987605]  do_syscall_64+0x37/0x80
[   43.988201]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   43.988979] RIP: 0033:0x7fac0740459d
[   43.989561] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   43.992218] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   43.993357] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   43.994413] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   43.995467] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   43.996519] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   43.997573] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   43.998884] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   43.999075] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   44.000006] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   44.001189] caller is debug_smp_processor_id+0x1c/0x20
[   44.002709] Call Trace:
[   44.002737]  dump_stack_lvl+0xa4/0xd3
[   44.002802]  dump_stack+0x15/0x17
[   44.002837]  check_preemption_disabled+0x167/0x180
[   44.002875]  ? ep_done_scan+0x3b/0x240
[   44.006190]  ? _raw_read_lock_irq+0xa0/0xa0
[   44.006826]  debug_smp_processor_id+0x1c/0x20
[   44.007470]  perf_ftrace_function_call+0x7c/0x360
[   44.008162]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   44.008895]  ? ftrace_ops_test+0x71/0xc0
[   44.009512]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   44.010220]  ? _prb_read_valid+0x3ad/0x3f0
[   44.010873]  ? write_comp_data+0x2f/0x90
[   44.011529]  0xffffffffa00dc099
[   44.012013]  ? ep_destroy_wakeup_source+0xe0/0xe0
[   44.012771]  ? do_epoll_wait+0x85a/0xd80
[   44.013380]  ? _raw_write_lock_irq+0x5/0x60
[   44.014034]  _raw_write_lock_irq+0x5/0x60
[   44.014638]  ep_done_scan+0x3b/0x240
[   44.015177]  ? _raw_write_lock_irq+0x5/0x60
[   44.015784]  ? ep_done_scan+0x3b/0x240
[   44.016419]  do_epoll_wait+0xabb/0xd80
[   44.017137]  ? wait_woken+0x90/0x90
[   44.017736]  __x64_sys_epoll_wait+0x8d/0xd0
[   44.018429]  do_syscall_64+0x37/0x80
[   44.018976]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   44.019697] RIP: 0033:0x7f8a39143ae0
[   44.020228] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   44.022744] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   44.023818] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   44.024796] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   44.025770] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   44.026767] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   44.027744] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   44.028919] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   44.029038] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   44.030110] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   44.030153] Call Trace:
[   44.030206]  dump_stack_lvl+0xa4/0xd3
[   44.031331] caller is debug_smp_processor_id+0x1c/0x20
[   44.033143]  dump_stack+0x15/0x17
[   44.035419]  check_preemption_disabled+0x167/0x180
[   44.036245]  ? __get_locked_pte+0x1a2/0x290
[   44.036961]  ? __lock_text_start+0x8/0x8
[   44.037693]  debug_smp_processor_id+0x1c/0x20
[   44.038468]  perf_ftrace_function_call+0x7c/0x360
[   44.039565]  ? ftrace_ops_list_func+0x259/0x2e0
[   44.040368]  ? write_comp_data+0x2f/0x90
[   44.041081]  ? perf_trace_buf_update+0x70/0x70
[   44.041980]  0xffffffffa00dc099
[   44.042619]  ? intel_guc_submission_reset_prepare+0x1/0x510
[   44.043597]  ? ftrace_call+0x5/0x44
[   44.044263]  ? pmd_page_vaddr+0x2b/0x70
[   44.044997]  ? _raw_spin_lock+0x5/0x50
[   44.045738]  _raw_spin_lock+0x5/0x50
[   44.046389]  __get_locked_pte+0x1a2/0x290
[   44.047099]  ? _raw_spin_lock+0x5/0x50
[   44.047751]  ? __get_locked_pte+0x1a2/0x290
[   44.048519]  ? intel_guc_submission_reset_prepare+0x1/0x510
[   44.049496]  __text_poke+0xea/0x4e0
[   44.050132]  ? intel_guc_submission_reset_prepare+0x1/0x510
[   44.051107]  ? lock_is_held_type+0xe2/0x140
[   44.051860]  ? intel_guc_submission_reset_prepare+0x1/0x510
[   44.052871]  text_poke+0x2b/0x60
[   44.053519]  text_poke_bp_batch+0xf5/0x2c0
[   44.054317]  ? intel_huc_fini+0x50/0x50
[   44.055073]  text_poke_queue+0xa7/0xc0
[   44.055818]  ftrace_replace_code+0xfd/0x170
[   44.056641]  ftrace_modify_all_code+0x1b1/0x270
[   44.057500]  arch_ftrace_update_code+0x9/0x10
[   44.058270]  ftrace_run_update_code+0x30/0xa0
[   44.059066]  ftrace_startup_enable+0x5e/0xa0
[   44.059848]  ftrace_startup+0x16d/0x240
[   44.060657]  register_ftrace_function+0x43/0x90
[   44.061478]  perf_ftrace_event_register+0xc1/0xf0
[   44.062332]  perf_trace_event_init+0xa0/0x4c0
[   44.063180]  perf_trace_init+0xda/0x160
[   44.063934]  perf_tp_event_init+0x57/0xa0
[   44.064679]  perf_try_init_event+0x83/0x270
[   44.065521]  perf_event_alloc+0xe3f/0x1c10
[   44.066230]  ? _raw_spin_unlock+0x2c/0x50
[   44.066957]  ? alloc_fd+0x20d/0x320
[   44.067763]  __do_sys_perf_event_open+0x3bf/0x1de0
[   44.068628]  ? write_comp_data+0x2f/0x90
[   44.069917]  __x64_sys_perf_event_open+0x26/0x30
[   44.070742]  do_syscall_64+0x37/0x80
[   44.071404]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   44.072252] RIP: 0033:0x7fac0740459d
[   44.072888] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   44.075738] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   44.076975] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   44.078111] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   44.079256] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   44.080394] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   44.081525] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   44.083042] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   44.084176] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   44.085715] Call Trace:
[   44.086099]  dump_stack_lvl+0xa4/0xd3
[   44.086695]  dump_stack+0x15/0x17
[   44.087200]  check_preemption_disabled+0x167/0x180
[   44.087898]  ? do_epoll_wait+0xac3/0xd80
[   44.088474]  ? __mutex_unlock_slowpath+0x2e0/0x2e0
[   44.089188]  debug_smp_processor_id+0x1c/0x20
[   44.089829]  perf_ftrace_function_call+0x7c/0x360
[   44.090530]  ? perf_trace_buf_update+0x70/0x70
[   44.091181]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   44.091884]  ? ftrace_ops_list_func+0x1d2/0x2e0
[   44.092537]  ? _raw_write_unlock_irq+0x38/0x50
[   44.093188]  ? preempt_notifier_dec+0x20/0x20
[   44.093883]  ? ftrace_call+0x5/0x44
[   44.094425]  ? __this_cpu_preempt_check+0x1c/0x20
[   44.095208]  0xffffffffa00dc099
[   44.095713]  ? preempt_count_sub+0x5/0xa0
[   44.096408]  ? mutex_unlock+0x5/0x20
[   44.096984]  mutex_unlock+0x5/0x20
[   44.097500]  do_epoll_wait+0xac3/0xd80
[   44.098063]  ? mutex_unlock+0x5/0x20
[   44.098594]  ? do_epoll_wait+0xac3/0xd80
[   44.099336]  ? wait_woken+0x90/0x90
[   44.099937]  __x64_sys_epoll_wait+0x8d/0xd0
[   44.100622]  do_syscall_64+0x37/0x80
[   44.101169]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   44.101893] RIP: 0033:0x7f8a39143ae0
[   44.102429] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   44.104922] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   44.105978] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   44.106964] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   44.107948] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   44.108935] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   44.109914] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   48.698055] check_preemption_disabled: 653074 callbacks suppressed
[   48.698077] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   48.700214] caller is debug_smp_processor_id+0x1c/0x20
[   48.700992] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   48.702057] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   48.703687] Call Trace:
[   48.704092]  dump_stack_lvl+0xa4/0xd3
[   48.704703]  dump_stack+0x15/0x17
[   48.705234]  check_preemption_disabled+0x167/0x180
[   48.706024]  debug_smp_processor_id+0x1c/0x20
[   48.706721]  perf_swevent_get_recursion_context+0x1e/0xd0
[   48.707590]  perf_trace_buf_alloc+0x3d/0x100
[   48.708255]  ? _raw_spin_lock+0x17/0x50
[   48.708849]  ? trace_sched_waking+0xc0/0xc0
[   48.709509]  perf_ftrace_function_call+0x209/0x360
[   48.710455]  ? 0xffffffffa00dc099
[   48.711098]  0xffffffffa00dc099
[   48.711621]  ? ftrace_call+0x5/0x44
[   48.712196]  ? bpf_map_update_elem+0x90/0x90
[   48.712903]  ? pmd_page_vaddr+0x2b/0x70
[   48.713535]  ? preempt_count_add+0x5/0xc0
[   48.714219]  preempt_count_add+0x5/0xc0
[   48.714821]  _raw_spin_lock+0x17/0x50
[   48.715401]  ? preempt_count_add+0x5/0xc0
[   48.716025]  ? _raw_spin_lock+0x17/0x50
[   48.716665]  __get_locked_pte+0x1a2/0x290
[   48.717344]  ? bpf_map_update_elem+0x90/0x90
[   48.718061]  __text_poke+0xea/0x4e0
[   48.718655]  ? bpf_map_update_elem+0x90/0x90
[   48.719373]  ? lock_is_held_type+0xe2/0x140
[   48.720068]  ? bpf_map_update_elem+0x90/0x90
[   48.720809]  text_poke+0x2b/0x60
[   48.721390]  text_poke_bp_batch+0x1dc/0x2c0
[   48.722122]  ? array_of_map_free+0x30/0x30
[   48.722844]  text_poke_queue+0xa7/0xc0
[   48.723512]  ftrace_replace_code+0xfd/0x170
[   48.724249]  ftrace_modify_all_code+0x1b1/0x270
[   48.725025]  arch_ftrace_update_code+0x9/0x10
[   48.725733]  ftrace_run_update_code+0x30/0xa0
[   48.726469]  ftrace_shutdown+0x2b8/0x4a0
[   48.727179]  unregister_ftrace_function+0x25/0x50
[   48.727948]  perf_ftrace_event_register+0x89/0xf0
[   48.728707]  ? perf_tp_event_init+0xa0/0xa0
[   48.729391]  perf_trace_destroy+0x37/0x60
[   48.730063]  tp_perf_event_destroy+0x15/0x20
[   48.730782]  _free_event+0xfc/0x7d0
[   48.731420]  put_event+0x37/0x50
[   48.731989]  perf_event_release_kernel+0x2f4/0x370
[   48.732825]  ? perf_event_release_kernel+0x370/0x370
[   48.733649]  perf_release+0x19/0x20
[   48.734250]  __fput+0x12d/0x460
[   48.734885]  ____fput+0x1a/0x20
[   48.735431]  task_work_run+0x8e/0xf0
[   48.736089]  do_exit+0x616/0x1310
[   48.736713]  ? write_comp_data+0x2f/0x90
[   48.737436]  do_group_exit+0x7e/0x130
[   48.738102]  get_signal+0x249/0x13c0
[   48.738753]  ? get_signal+0x5/0x13c0
[   48.739447]  arch_do_signal_or_restart+0xb7/0x7e0
[   48.740330]  ? arch_do_signal_or_restart+0x5/0x7e0
[   48.741199]  exit_to_user_mode_prepare+0x154/0x240
[   48.741993]  syscall_exit_to_user_mode+0x2b/0x60
[   48.742755]  do_syscall_64+0x46/0x80
[   48.743362]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   48.744162] RIP: 0033:0x7fac0740459d
[   48.744752] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   48.745742] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   48.746918] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   48.748000] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   48.749065] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   48.750098] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   48.751134] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   48.752558] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   48.752584] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   48.753626] caller is debug_smp_processor_id+0x1c/0x20
[   48.754812] caller is debug_smp_processor_id+0x1c/0x20
[   48.754833] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   48.754849] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   48.754859] Call Trace:
[   48.759069]  dump_stack_lvl+0xa4/0xd3
[   48.759573]  dump_stack+0x15/0x17
[   48.760019]  check_preemption_disabled+0x167/0x180
[   48.760660]  ? __mutex_lock+0x56/0x9f0
[   48.761167]  ? ___might_sleep+0x170/0x170
[   48.761717]  debug_smp_processor_id+0x1c/0x20
[   48.762311]  perf_ftrace_function_call+0x7c/0x360
[   48.762940]  ? perf_ftrace_function_call+0x4c/0x360
[   48.763594]  ? write_comp_data+0x2f/0x90
[   48.764123]  ? mutex_lock_nested+0x1b/0x20
[   48.764679]  ? mutex_lock_io_nested+0x940/0x940
[   48.765296]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   48.765928]  ? mutex_lock_nested+0x1b/0x20
[   48.766488]  ? perf_ftrace_function_call+0x4c/0x360
[   48.767140]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   48.767770]  ? ftrace_ops_test+0x71/0xc0
[   48.768316]  0xffffffffa00dc099
[   48.768744]  ? 0xffffffffa00dc099
[   48.769192]  ? trace_hardirqs_on+0x6a/0x170
[   48.769755]  ? write_comp_data+0x2f/0x90
[   48.770294]  ? perf_trace_buf_update+0x70/0x70
[   48.770894]  ? do_epoll_wait+0x3b3/0xd80
[   48.771435]  ? __might_sleep+0x5/0x70
[   48.771946]  __might_sleep+0x5/0x70
[   48.772423]  __mutex_lock+0x56/0x9f0
[   48.772909]  ? __might_sleep+0x5/0x70
[   48.773411]  ? __mutex_lock+0x56/0x9f0
[   48.773922]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   48.774647]  ? do_epoll_wait+0x3b3/0xd80
[   48.775205]  ? do_epoll_wait+0x3b3/0xd80
[   48.775742]  ? __mutex_lock+0x5/0x9f0
[   48.776249]  mutex_lock_nested+0x1b/0x20
[   48.776785]  ? __mutex_lock+0x5/0x9f0
[   48.777280]  ? mutex_lock_nested+0x1b/0x20
[   48.777831]  do_epoll_wait+0x3b3/0xd80
[   48.778379]  ? wait_woken+0x90/0x90
[   48.778868]  __x64_sys_epoll_wait+0x8d/0xd0
[   48.779445]  do_syscall_64+0x37/0x80
[   48.779934]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   48.780613] RIP: 0033:0x7f8a39143ae0
[   48.781098] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   48.783510] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   48.784494] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   48.785416] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   48.786346] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   48.787268] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   48.788197] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   48.789152] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   48.789200] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   48.790197] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   48.790214] Call Trace:
[   48.791304] caller is debug_smp_processor_id+0x1c/0x20
[   48.792876]  dump_stack_lvl+0xa4/0xd3
[   48.794468]  dump_stack+0x15/0x17
[   48.794970]  check_preemption_disabled+0x167/0x180
[   48.795698]  debug_smp_processor_id+0x1c/0x20
[   48.796340]  perf_trace_buf_alloc+0x98/0x100
[   48.796971]  ? _raw_spin_lock+0x17/0x50
[   48.797541]  ? trace_sched_waking+0xc0/0xc0
[   48.798187]  perf_ftrace_function_call+0x209/0x360
[   48.798992]  ? 0xffffffffa00dc099
[   48.799549]  0xffffffffa00dc099
[   48.800034]  ? ftrace_call+0x5/0x44
[   48.800570]  ? bpf_map_update_elem+0x90/0x90
[   48.801226]  ? pmd_page_vaddr+0x2b/0x70
[   48.801812]  ? preempt_count_add+0x5/0xc0
[   48.802437]  preempt_count_add+0x5/0xc0
[   48.803010]  _raw_spin_lock+0x17/0x50
[   48.803561]  ? preempt_count_add+0x5/0xc0
[   48.804151]  ? _raw_spin_lock+0x17/0x50
[   48.804729]  __get_locked_pte+0x1a2/0x290
[   48.805336]  ? bpf_map_update_elem+0x90/0x90
[   48.805978]  __text_poke+0xea/0x4e0
[   48.806522]  ? bpf_map_update_elem+0x90/0x90
[   48.807164]  ? lock_is_held_type+0xe2/0x140
[   48.807790]  ? bpf_map_update_elem+0x90/0x90
[   48.808443]  text_poke+0x2b/0x60
[   48.808950]  text_poke_bp_batch+0x1dc/0x2c0
[   48.809591]  ? array_of_map_free+0x30/0x30
[   48.810224]  text_poke_queue+0xa7/0xc0
[   48.810808]  ftrace_replace_code+0xfd/0x170
[   48.811453]  ftrace_modify_all_code+0x1b1/0x270
[   48.812140]  arch_ftrace_update_code+0x9/0x10
[   48.812782]  ftrace_run_update_code+0x30/0xa0
[   48.813436]  ftrace_shutdown+0x2b8/0x4a0
[   48.814053]  unregister_ftrace_function+0x25/0x50
[   48.814751]  perf_ftrace_event_register+0x89/0xf0
[   48.815442]  ? perf_tp_event_init+0xa0/0xa0
[   48.816062]  perf_trace_destroy+0x37/0x60
[   48.816665]  tp_perf_event_destroy+0x15/0x20
[   48.817302]  _free_event+0xfc/0x7d0
[   48.817854]  put_event+0x37/0x50
[   48.818361]  perf_event_release_kernel+0x2f4/0x370
[   48.819095]  ? perf_event_release_kernel+0x370/0x370
[   48.819830]  perf_release+0x19/0x20
[   48.820361]  __fput+0x12d/0x460
[   48.820889]  ____fput+0x1a/0x20
[   48.821374]  task_work_run+0x8e/0xf0
[   48.821939]  do_exit+0x616/0x1310
[   48.822473]  ? write_comp_data+0x2f/0x90
[   48.823092]  do_group_exit+0x7e/0x130
[   48.823670]  get_signal+0x249/0x13c0
[   48.824229]  ? get_signal+0x5/0x13c0
[   48.824814]  arch_do_signal_or_restart+0xb7/0x7e0
[   48.825561]  ? arch_do_signal_or_restart+0x5/0x7e0
[   48.826319]  exit_to_user_mode_prepare+0x154/0x240
[   48.827028]  syscall_exit_to_user_mode+0x2b/0x60
[   48.827710]  do_syscall_64+0x46/0x80
[   48.828250]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   48.828980] RIP: 0033:0x7fac0740459d
[   48.829513] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   48.830434] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   48.831509] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   48.832510] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   48.833511] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   48.834517] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   48.835523] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   48.836650] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   48.836760] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   48.837712] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   48.838874] caller is debug_smp_processor_id+0x1c/0x20
[   48.840232] Call Trace:
[   48.840241]  dump_stack_lvl+0xa4/0xd3
[   48.841798]  dump_stack+0x15/0x17
[   48.842261]  check_preemption_disabled+0x167/0x180
[   48.842899]  ? __might_sleep+0x48/0x70
[   48.843403]  ? sched_show_task+0x70/0x70
[   48.843943]  debug_smp_processor_id+0x1c/0x20
[   48.844527]  perf_ftrace_function_call+0x7c/0x360
[   48.845152]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   48.845779]  ? __mutex_lock+0x56/0x9f0
[   48.846294]  ? perf_ftrace_function_call+0x4c/0x360
[   48.846941]  ? perf_ftrace_function_call+0x4c/0x360
[   48.847591]  ? write_comp_data+0x2f/0x90
[   48.848124]  ? mutex_lock_nested+0x1b/0x20
[   48.848672]  ? mutex_lock_io_nested+0x940/0x940
[   48.849275]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   48.849900]  ? mutex_lock_nested+0x1b/0x20
[   48.850459]  ? perf_ftrace_function_call+0x4c/0x360
[   48.851109]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   48.851738]  ? ftrace_ops_test+0x71/0xc0
[   48.852276]  0xffffffffa00dc099
[   48.852711]  ? 0xffffffffa00dc099
[   48.853158]  ? trace_hardirqs_on+0x6a/0x170
[   48.853721]  ? do_epoll_wait+0x3b3/0xd80
[   48.854270]  ? ___might_sleep+0x5/0x170
[   48.854792]  ___might_sleep+0x5/0x170
[   48.855288]  __might_sleep+0x48/0x70
[   48.855774]  ? ___might_sleep+0x5/0x170
[   48.856289]  ? __might_sleep+0x48/0x70
[   48.856800]  __mutex_lock+0x56/0x9f0
[   48.857288]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   48.858009]  ? do_epoll_wait+0x3b3/0xd80
[   48.858546]  ? do_epoll_wait+0x3b3/0xd80
[   48.859081]  ? __mutex_lock+0x5/0x9f0
[   48.859589]  mutex_lock_nested+0x1b/0x20
[   48.860116]  ? __mutex_lock+0x5/0x9f0
[   48.860610]  ? mutex_lock_nested+0x1b/0x20
[   48.861159]  do_epoll_wait+0x3b3/0xd80
[   48.861698]  ? wait_woken+0x90/0x90
[   48.862191]  __x64_sys_epoll_wait+0x8d/0xd0
[   48.862764]  do_syscall_64+0x37/0x80
[   48.863250]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   48.863920] RIP: 0033:0x7f8a39143ae0
[   48.864407] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   48.866787] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   48.867770] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   48.868692] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   48.869612] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   48.870540] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   48.871460] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   48.872414] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   48.872449] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   48.873444] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   48.874549] caller is debug_smp_processor_id+0x1c/0x20
[   48.876093] Call Trace:
[   48.877128]  dump_stack_lvl+0xa4/0xd3
[   48.877694]  dump_stack+0x15/0x17
[   48.878200]  check_preemption_disabled+0x167/0x180
[   48.878926]  debug_smp_processor_id+0x1c/0x20
[   48.879570]  perf_swevent_put_recursion_context+0x1b/0x40
[   48.880361]  perf_tp_event+0x331/0x4e0
[   48.881089]  ? arch_local_irq_enable+0x10/0x12
[   48.881743]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   48.882446]  ? dump_stack_lvl+0xcc/0xd3
[   48.883034]  ? dump_stack+0x15/0x17
[   48.883558]  ? check_preemption_disabled+0x167/0x180
[   48.884304]  ? _raw_spin_lock+0x17/0x50
[   48.884872]  ? trace_sched_waking+0xc0/0xc0
[   48.885503]  perf_ftrace_function_call+0x248/0x360
[   48.886209]  ? perf_ftrace_function_call+0x248/0x360
[   48.887045]  ? 0xffffffffa00dc099
[   48.887601]  0xffffffffa00dc099
[   48.888086]  ? ftrace_call+0x5/0x44
[   48.888620]  ? bpf_map_update_elem+0x90/0x90
[   48.889265]  ? pmd_page_vaddr+0x2b/0x70
[   48.889851]  ? preempt_count_add+0x5/0xc0
[   48.890473]  preempt_count_add+0x5/0xc0
[   48.891050]  _raw_spin_lock+0x17/0x50
[   48.891601]  ? preempt_count_add+0x5/0xc0
[   48.892189]  ? _raw_spin_lock+0x17/0x50
[   48.892767]  __get_locked_pte+0x1a2/0x290
[   48.893373]  ? bpf_map_update_elem+0x90/0x90
[   48.894013]  __text_poke+0xea/0x4e0
[   48.894542]  ? bpf_map_update_elem+0x90/0x90
[   48.895183]  ? lock_is_held_type+0xe2/0x140
[   48.895807]  ? bpf_map_update_elem+0x90/0x90
[   48.896458]  text_poke+0x2b/0x60
[   48.896970]  text_poke_bp_batch+0x1dc/0x2c0
[   48.897611]  ? array_of_map_free+0x30/0x30
[   48.898246]  text_poke_queue+0xa7/0xc0
[   48.898831]  ftrace_replace_code+0xfd/0x170
[   48.899476]  ftrace_modify_all_code+0x1b1/0x270
[   48.900162]  arch_ftrace_update_code+0x9/0x10
[   48.900805]  ftrace_run_update_code+0x30/0xa0
[   48.901458]  ftrace_shutdown+0x2b8/0x4a0
[   48.902074]  unregister_ftrace_function+0x25/0x50
[   48.902772]  perf_ftrace_event_register+0x89/0xf0
[   48.903463]  ? perf_tp_event_init+0xa0/0xa0
[   48.904081]  perf_trace_destroy+0x37/0x60
[   48.904683]  tp_perf_event_destroy+0x15/0x20
[   48.905319]  _free_event+0xfc/0x7d0
[   48.905869]  put_event+0x37/0x50
[   48.906375]  perf_event_release_kernel+0x2f4/0x370
[   48.907107]  ? perf_event_release_kernel+0x370/0x370
[   48.907840]  perf_release+0x19/0x20
[   48.908370]  __fput+0x12d/0x460
[   48.908898]  ____fput+0x1a/0x20
[   48.909382]  task_work_run+0x8e/0xf0
[   48.909946]  do_exit+0x616/0x1310
[   48.910481]  ? write_comp_data+0x2f/0x90
[   48.911101]  do_group_exit+0x7e/0x130
[   48.911677]  get_signal+0x249/0x13c0
[   48.912234]  ? get_signal+0x5/0x13c0
[   48.912818]  arch_do_signal_or_restart+0xb7/0x7e0
[   48.913565]  ? arch_do_signal_or_restart+0x5/0x7e0
[   48.914317]  exit_to_user_mode_prepare+0x154/0x240
[   48.915026]  syscall_exit_to_user_mode+0x2b/0x60
[   48.915709]  do_syscall_64+0x46/0x80
[   48.916246]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   48.916977] RIP: 0033:0x7fac0740459d
[   48.917507] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   48.918430] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   48.919500] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   48.920497] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   48.921499] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   48.922505] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   48.923504] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   48.924616] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   48.924739] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   48.925679] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   48.926922] caller is debug_smp_processor_id+0x1c/0x20
[   48.928284] Call Trace:
[   48.928292]  dump_stack_lvl+0xa4/0xd3
[   48.929870]  dump_stack+0x15/0x17
[   48.930333]  check_preemption_disabled+0x167/0x180
[   48.930980]  ? __mutex_lock+0x7b/0x9f0
[   48.931488]  ? trace_sched_waking+0xc0/0xc0
[   48.932054]  debug_smp_processor_id+0x1c/0x20
[   48.932641]  perf_ftrace_function_call+0x7c/0x360
[   48.933269]  ? perf_ftrace_function_call+0x4c/0x360
[   48.933921]  ? write_comp_data+0x2f/0x90
[   48.934460]  ? mutex_lock_nested+0x1b/0x20
[   48.935012]  ? mutex_lock_io_nested+0x940/0x940
[   48.935618]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   48.936247]  ? mutex_lock_nested+0x1b/0x20
[   48.936799]  ? perf_ftrace_function_call+0x4c/0x360
[   48.937453]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   48.938085]  ? ftrace_ops_test+0x71/0xc0
[   48.938639]  0xffffffffa00dc099
[   48.939072]  ? __this_cpu_preempt_check+0x1c/0x20
[   48.939705]  ? lock_is_held_type+0xe2/0x140
[   48.940270]  ? do_epoll_wait+0x3b3/0xd80
[   48.940816]  ? preempt_count_add+0x5/0xc0
[   48.941366]  preempt_count_add+0x5/0xc0
[   48.941887]  __mutex_lock+0x7b/0x9f0
[   48.942383]  ? preempt_count_add+0x5/0xc0
[   48.942923]  ? __mutex_lock+0x7b/0x9f0
[   48.943434]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   48.944153]  ? do_epoll_wait+0x3b3/0xd80
[   48.944686]  ? do_epoll_wait+0x3b3/0xd80
[   48.945223]  ? __mutex_lock+0x5/0x9f0
[   48.945732]  mutex_lock_nested+0x1b/0x20
[   48.946271]  ? __mutex_lock+0x5/0x9f0
[   48.946768]  ? mutex_lock_nested+0x1b/0x20
[   48.947321]  do_epoll_wait+0x3b3/0xd80
[   48.947863]  ? wait_woken+0x90/0x90
[   48.948351]  __x64_sys_epoll_wait+0x8d/0xd0
[   48.948928]  do_syscall_64+0x37/0x80
[   48.949416]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   48.950088] RIP: 0033:0x7f8a39143ae0
[   48.950586] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   48.952969] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   48.953955] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   48.954886] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   48.955809] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   48.956732] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   48.957656] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   48.958633] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   48.958670] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   48.959743] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   48.960825] caller is debug_smp_processor_id+0x1c/0x20
[   48.962517] Call Trace:
[   48.962550]  dump_stack_lvl+0xa4/0xd3
[   48.964225]  dump_stack+0x15/0x17
[   48.964788]  check_preemption_disabled+0x167/0x180
[   48.965560]  ? text_poke_bp_batch+0x1dc/0x2c0
[   48.966267]  ? apply_paravirt+0x150/0x150
[   48.966945]  debug_smp_processor_id+0x1c/0x20
[   48.967678]  perf_ftrace_function_call+0x7c/0x360
[   48.968515]  ? bpf_map_update_elem+0x90/0x90
[   48.969276]  ? 0xffffffffa00dc099
[   48.969842]  ? __this_cpu_preempt_check+0x1c/0x20
[   48.970823]  0xffffffffa00dc099
[   48.971362]  ? _raw_spin_unlock+0x2c/0x50
[   48.972066]  ? __text_poke+0x2f2/0x4e0
[   48.972697]  ? bpf_map_update_elem+0x90/0x90
[   48.973421]  ? bpf_map_delete_elem+0x80/0x80
[   48.974122]  ? text_poke+0x5/0x60
[   48.974730]  text_poke+0x5/0x60
[   48.975265]  text_poke_bp_batch+0x1dc/0x2c0
[   48.975949]  ? text_poke+0x5/0x60
[   48.976497]  ? text_poke_bp_batch+0x1dc/0x2c0
[   48.977249]  ? array_of_map_free+0x30/0x30
[   48.977963]  text_poke_queue+0xa7/0xc0
[   48.978643]  ftrace_replace_code+0xfd/0x170
[   48.979381]  ftrace_modify_all_code+0x1b1/0x270
[   48.980158]  arch_ftrace_update_code+0x9/0x10
[   48.980867]  ftrace_run_update_code+0x30/0xa0
[   48.981603]  ftrace_shutdown+0x2b8/0x4a0
[   48.982318]  unregister_ftrace_function+0x25/0x50
[   48.983086]  perf_ftrace_event_register+0x89/0xf0
[   48.983846]  ? perf_tp_event_init+0xa0/0xa0
[   48.984528]  perf_trace_destroy+0x37/0x60
[   48.985198]  tp_perf_event_destroy+0x15/0x20
[   48.985905]  _free_event+0xfc/0x7d0
[   48.986547]  put_event+0x37/0x50
[   48.987114]  perf_event_release_kernel+0x2f4/0x370
[   48.987958]  ? perf_event_release_kernel+0x370/0x370
[   48.988773]  perf_release+0x19/0x20
[   48.989367]  __fput+0x12d/0x460
[   48.989999]  ____fput+0x1a/0x20
[   48.990551]  task_work_run+0x8e/0xf0
[   48.991201]  do_exit+0x616/0x1310
[   48.991815]  ? write_comp_data+0x2f/0x90
[   48.992534]  do_group_exit+0x7e/0x130
[   48.993197]  get_signal+0x249/0x13c0
[   48.993836]  ? get_signal+0x5/0x13c0
[   48.994531]  arch_do_signal_or_restart+0xb7/0x7e0
[   48.995406]  ? arch_do_signal_or_restart+0x5/0x7e0
[   48.996291]  exit_to_user_mode_prepare+0x154/0x240
[   48.997082]  syscall_exit_to_user_mode+0x2b/0x60
[   48.997843]  do_syscall_64+0x46/0x80
[   48.998458]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   48.999258] RIP: 0033:0x7fac0740459d
[   48.999848] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   49.000841] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   49.002011] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   49.003100] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   49.004187] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   49.005270] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   49.006356] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   49.007662] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   49.007776] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   49.008724] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   49.009863] caller is debug_smp_processor_id+0x1c/0x20
[   49.011320] Call Trace:
[   49.011329]  dump_stack_lvl+0xa4/0xd3
[   49.011350]  dump_stack+0x15/0x17
[   49.011365]  check_preemption_disabled+0x167/0x180
[   49.011383]  ? ep_item_poll.isra.21+0x54/0x90
[   49.011399]  ? devkmsg_llseek+0x110/0x110
[   49.011419]  debug_smp_processor_id+0x1c/0x20
[   49.015718]  perf_ftrace_function_call+0x7c/0x360
[   49.016346]  ? ftrace_ops_test+0x71/0xc0
[   49.016883]  ? ep_start_scan+0xc0/0x100
[   49.017407]  ? 0xffffffffa00dc099
[   49.017860]  ? 0xffffffffa00dc099
[   49.018323]  ? write_comp_data+0x2f/0x90
[   49.018854]  ? perf_trace_buf_update+0x70/0x70
[   49.019450]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   49.020085]  ? devkmsg_llseek+0x110/0x110
[   49.020630]  0xffffffffa00dc099
[   49.021067]  ? ftrace_call+0x5/0x44
[   49.021555]  ? devkmsg_poll+0x5/0x100
[   49.022067]  devkmsg_poll+0x5/0x100
[   49.022553]  ep_item_poll.isra.21+0x54/0x90
[   49.023119]  ? devkmsg_poll+0x5/0x100
[   49.023615]  ? ep_item_poll.isra.21+0x54/0x90
[   49.024209]  do_epoll_wait+0x490/0xd80
[   49.024753]  ? wait_woken+0x90/0x90
[   49.025241]  __x64_sys_epoll_wait+0x8d/0xd0
[   49.025817]  do_syscall_64+0x37/0x80
[   49.026313]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   49.026987] RIP: 0033:0x7f8a39143ae0
[   49.027471] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   49.029844] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   49.030838] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   49.031767] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   49.032689] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   49.033612] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   49.034545] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   49.035503] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   49.035553] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   49.036612] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   49.037694] caller is debug_smp_processor_id+0x1c/0x20
[   49.039383] Call Trace:
[   49.039417]  dump_stack_lvl+0xa4/0xd3
[   49.041072]  dump_stack+0x15/0x17
[   49.041631]  check_preemption_disabled+0x167/0x180
[   49.042468]  debug_smp_processor_id+0x1c/0x20
[   49.043178]  perf_swevent_get_recursion_context+0x1e/0xd0
[   49.044092]  perf_trace_buf_alloc+0x3d/0x100
[   49.044791]  ? text_poke_bp_batch+0x1dc/0x2c0
[   49.045490]  ? apply_paravirt+0x150/0x150
[   49.046166]  perf_ftrace_function_call+0x209/0x360
[   49.047151]  ? 0xffffffffa00dc099
[   49.047827]  0xffffffffa00dc099
[   49.048373]  ? _raw_spin_unlock+0x2c/0x50
[   49.049078]  ? __text_poke+0x2f2/0x4e0
[   49.049712]  ? bpf_map_update_elem+0x90/0x90
[   49.050441]  ? bpf_map_delete_elem+0x80/0x80
[   49.051140]  ? text_poke+0x5/0x60
[   49.051742]  text_poke+0x5/0x60
[   49.052277]  text_poke_bp_batch+0x1dc/0x2c0
[   49.052964]  ? text_poke+0x5/0x60
[   49.053513]  ? text_poke_bp_batch+0x1dc/0x2c0
[   49.054270]  ? array_of_map_free+0x30/0x30
[   49.054987]  text_poke_queue+0xa7/0xc0
[   49.055656]  ftrace_replace_code+0xfd/0x170
[   49.056395]  ftrace_modify_all_code+0x1b1/0x270
[   49.057182]  arch_ftrace_update_code+0x9/0x10
[   49.057892]  ftrace_run_update_code+0x30/0xa0
[   49.058628]  ftrace_shutdown+0x2b8/0x4a0
[   49.059343]  unregister_ftrace_function+0x25/0x50
[   49.060109]  perf_ftrace_event_register+0x89/0xf0
[   49.060872]  ? perf_tp_event_init+0xa0/0xa0
[   49.061562]  perf_trace_destroy+0x37/0x60
[   49.062265]  tp_perf_event_destroy+0x15/0x20
[   49.062976]  _free_event+0xfc/0x7d0
[   49.063616]  put_event+0x37/0x50
[   49.064186]  perf_event_release_kernel+0x2f4/0x370
[   49.065066]  ? perf_event_release_kernel+0x370/0x370
[   49.065883]  perf_release+0x19/0x20
[   49.066491]  __fput+0x12d/0x460
[   49.067127]  ____fput+0x1a/0x20
[   49.067674]  task_work_run+0x8e/0xf0
[   49.068327]  do_exit+0x616/0x1310
[   49.068945]  ? write_comp_data+0x2f/0x90
[   49.069677]  do_group_exit+0x7e/0x130
[   49.070354]  get_signal+0x249/0x13c0
[   49.070997]  ? get_signal+0x5/0x13c0
[   49.071717]  arch_do_signal_or_restart+0xb7/0x7e0
[   49.072598]  ? arch_do_signal_or_restart+0x5/0x7e0
[   49.073473]  exit_to_user_mode_prepare+0x154/0x240
[   49.074280]  syscall_exit_to_user_mode+0x2b/0x60
[   49.075040]  do_syscall_64+0x46/0x80
[   49.075649]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   49.076450] RIP: 0033:0x7fac0740459d
[   49.077041] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   49.078033] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   49.079465] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   49.080551] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   49.081640] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   49.082734] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   49.083821] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   49.085132] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   49.086208] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   49.087670] Call Trace:
[   49.088008]  dump_stack_lvl+0xa4/0xd3
[   49.088511]  dump_stack+0x15/0x17
[   49.088966]  check_preemption_disabled+0x167/0x180
[   49.089607]  ? devkmsg_poll+0x8a/0x100
[   49.090114]  ? prb_read_valid+0x40/0x40
[   49.090658]  debug_smp_processor_id+0x1c/0x20
[   49.091244]  perf_ftrace_function_call+0x7c/0x360
[   49.091874]  ? dump_stack_lvl+0xcc/0xd3
[   49.092398]  ? dump_stack+0x15/0x17
[   49.092881]  ? write_comp_data+0x2f/0x90
[   49.093413]  ? ep_item_poll.isra.21+0x54/0x90
[   49.093997]  ? devkmsg_llseek+0x110/0x110
[   49.094548]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   49.095178]  ? ep_item_poll.isra.21+0x54/0x90
[   49.095766]  ? perf_ftrace_function_call+0x4c/0x360
[   49.096419]  ? ftrace_ops_test+0x71/0xc0
[   49.096966]  0xffffffffa00dc099
[   49.097396]  ? 0xffffffffa00dc099
[   49.097854]  ? perf_trace_buf_update+0x70/0x70
[   49.098466]  ? prb_read_valid_info+0x5/0x80
[   49.099038]  prb_read_valid_info+0x5/0x80
[   49.099581]  devkmsg_poll+0x8a/0x100
[   49.100070]  ? prb_read_valid_info+0x5/0x80
[   49.100634]  ? devkmsg_poll+0x8a/0x100
[   49.101152]  ? devkmsg_poll+0x5/0x100
[   49.101662]  ? devkmsg_llseek+0x110/0x110
[   49.102209]  ep_item_poll.isra.21+0x54/0x90
[   49.102783]  do_epoll_wait+0x490/0xd80
[   49.103321]  ? wait_woken+0x90/0x90
[   49.103809]  __x64_sys_epoll_wait+0x8d/0xd0
[   49.104386]  do_syscall_64+0x37/0x80
[   49.104875]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   49.105548] RIP: 0033:0x7f8a39143ae0
[   49.106032] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   49.108411] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   49.109395] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   49.110322] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   49.111244] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   49.112170] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   49.113093] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   53.702049] check_preemption_disabled: 1389146 callbacks suppressed
[   53.702067] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   53.702133] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[   53.702947] caller is debug_smp_processor_id+0x1c/0x20
[   53.703886] caller is debug_smp_processor_id+0x1c/0x20
[   53.704916] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   53.707148] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   53.708554] Call Trace:
[   53.708890]  dump_stack_lvl+0xa4/0xd3
[   53.709395]  dump_stack+0x15/0x17
[   53.709841]  check_preemption_disabled+0x167/0x180
[   53.710504]  debug_smp_processor_id+0x1c/0x20
[   53.711094]  perf_trace_buf_alloc+0x98/0x100
[   53.711705]  ? __text_poke+0xea/0x4e0
[   53.712235]  ? __pmd_alloc+0x420/0x420
[   53.712786]  perf_ftrace_function_call+0x209/0x360
[   53.713564]  ? 0xffffffffa00dc099
[   53.714081]  ? acpi_ev_add_gpe_reference+0x130/0x130
[   53.714811]  0xffffffffa00dc099
[   53.715281]  ? 0xffffffffa00dc099
[   53.715828]  ? __get_locked_pte+0x5/0x290
[   53.716424]  __get_locked_pte+0x5/0x290
[   53.716977]  __text_poke+0xea/0x4e0
[   53.717484]  ? __get_locked_pte+0x5/0x290
[   53.718053]  ? __text_poke+0xea/0x4e0
[   53.718586]  ? acpi_ev_add_gpe_reference+0x130/0x130
[   53.719296]  ? lock_is_held_type+0xe2/0x140
[   53.719899]  ? acpi_ev_add_gpe_reference+0x130/0x130
[   53.720619]  text_poke+0x2b/0x60
[   53.721109]  text_poke_bp_batch+0x1dc/0x2c0
[   53.721727]  ? acpi_hw_get_gpe_status+0x199/0x199
[   53.722424]  text_poke_queue+0xa7/0xc0
[   53.722987]  ftrace_replace_code+0xfd/0x170
[   53.723610]  ftrace_modify_all_code+0x1b1/0x270
[   53.724274]  arch_ftrace_update_code+0x9/0x10
[   53.724894]  ftrace_run_update_code+0x30/0xa0
[   53.725525]  ftrace_shutdown+0x2b8/0x4a0
[   53.726127]  unregister_ftrace_function+0x25/0x50
[   53.726797]  perf_ftrace_event_register+0x89/0xf0
[   53.727462]  ? perf_tp_event_init+0xa0/0xa0
[   53.728059]  perf_trace_destroy+0x37/0x60
[   53.728641]  tp_perf_event_destroy+0x15/0x20
[   53.729256]  _free_event+0xfc/0x7d0
[   53.729789]  put_event+0x37/0x50
[   53.730277]  perf_event_release_kernel+0x2f4/0x370
[   53.730984]  ? perf_event_release_kernel+0x370/0x370
[   53.731693]  perf_release+0x19/0x20
[   53.732206]  __fput+0x12d/0x460
[   53.732718]  ____fput+0x1a/0x20
[   53.733186]  task_work_run+0x8e/0xf0
[   53.733733]  do_exit+0x616/0x1310
[   53.734249]  ? write_comp_data+0x2f/0x90
[   53.734850]  do_group_exit+0x7e/0x130
[   53.735407]  get_signal+0x249/0x13c0
[   53.735945]  ? get_signal+0x5/0x13c0
[   53.736510]  arch_do_signal_or_restart+0xb7/0x7e0
[   53.737236]  ? arch_do_signal_or_restart+0x5/0x7e0
[   53.737959]  exit_to_user_mode_prepare+0x154/0x240
[   53.738652]  syscall_exit_to_user_mode+0x2b/0x60
[   53.739313]  do_syscall_64+0x46/0x80
[   53.739838]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   53.740547] RIP: 0033:0x7fac0740459d
[   53.741065] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   53.741947] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   53.742981] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   53.743940] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   53.744899] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   53.745860] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   53.746821] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   53.747893] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   53.748010] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   53.748895] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   53.749913] caller is debug_smp_processor_id+0x1c/0x20
[   53.751351] Call Trace:
[   53.751361]  dump_stack_lvl+0xa4/0xd3
[   53.751383]  dump_stack+0x15/0x17
[   53.751398]  check_preemption_disabled+0x167/0x180
[   53.751416]  ? schedule_timeout+0x34e/0x610
[   53.751431]  ? do_init_timer+0xa0/0xa0
[   53.751451]  debug_smp_processor_id+0x1c/0x20
[   53.755567]  perf_ftrace_function_call+0x7c/0x360
[   53.756194]  ? 0xffffffffa00dc099
[   53.756642]  ? __this_cpu_preempt_check+0x1c/0x20
[   53.757279]  ? finish_task_switch+0xab/0x2a0
[   53.757846]  ? __schedule+0x46e/0xb20
[   53.758357]  0xffffffffa00dc099
[   53.758785]  ? finish_task_switch+0xb0/0x2a0
[   53.759368]  ? del_timer_sync+0x5/0x130
[   53.759889]  del_timer_sync+0x5/0x130
[   53.760382]  schedule_timeout+0x34e/0x610
[   53.760918]  ? del_timer_sync+0x5/0x130
[   53.761431]  ? schedule_timeout+0x34e/0x610
[   53.761998]  ? del_timer_sync+0x130/0x130
[   53.762544]  ? i915_init_ggtt+0x40/0x6b0
[   53.763099]  rcu_gp_fqs_loop+0x2a0/0x410
[   53.763641]  ? rcu_gp_init+0x730/0x730
[   53.764142]  rcu_gp_kthread+0xdd/0x170
[   53.764658]  kthread+0x1e7/0x230
[   53.765099]  ? set_kthread_struct+0x80/0x80
[   53.765663]  ret_from_fork+0x1f/0x30
[   53.766188] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   53.766236] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[   53.767170] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   53.768191] caller is debug_smp_processor_id+0x1c/0x20
[   53.769689] Call Trace:
[   53.770707]  dump_stack_lvl+0xa4/0xd3
[   53.771253]  dump_stack+0x15/0x17
[   53.771736]  check_preemption_disabled+0x167/0x180
[   53.772447]  debug_smp_processor_id+0x1c/0x20
[   53.773066]  perf_swevent_put_recursion_context+0x1b/0x40
[   53.773827]  perf_tp_event+0x331/0x4e0
[   53.774448]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[   53.775265]  ? arch_local_irq_enable+0x10/0x12
[   53.775897]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   53.776570]  ? dump_stack_lvl+0xcc/0xd3
[   53.777136]  ? dump_stack+0x15/0x17
[   53.777656]  ? __text_poke+0xea/0x4e0
[   53.778182]  ? __pmd_alloc+0x420/0x420
[   53.778731]  perf_ftrace_function_call+0x248/0x360
[   53.779400]  ? perf_trace_buf_alloc+0xb0/0x100
[   53.780029]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   53.780731]  ? perf_ftrace_function_call+0x248/0x360
[   53.781554]  ? 0xffffffffa00dc099
[   53.782071]  ? acpi_ev_add_gpe_reference+0x130/0x130
[   53.782795]  0xffffffffa00dc099
[   53.783261]  ? 0xffffffffa00dc099
[   53.783807]  ? __get_locked_pte+0x5/0x290
[   53.784400]  __get_locked_pte+0x5/0x290
[   53.784958]  __text_poke+0xea/0x4e0
[   53.785464]  ? __get_locked_pte+0x5/0x290
[   53.786031]  ? __text_poke+0xea/0x4e0
[   53.786571]  ? acpi_ev_add_gpe_reference+0x130/0x130
[   53.787277]  ? lock_is_held_type+0xe2/0x140
[   53.787877]  ? acpi_ev_add_gpe_reference+0x130/0x130
[   53.788596]  text_poke+0x2b/0x60
[   53.789091]  text_poke_bp_batch+0x1dc/0x2c0
[   53.789707]  ? acpi_hw_get_gpe_status+0x199/0x199
[   53.790402]  text_poke_queue+0xa7/0xc0
[   53.790964]  ftrace_replace_code+0xfd/0x170
[   53.791586]  ftrace_modify_all_code+0x1b1/0x270
[   53.792246]  arch_ftrace_update_code+0x9/0x10
[   53.792872]  ftrace_run_update_code+0x30/0xa0
[   53.793499]  ftrace_shutdown+0x2b8/0x4a0
[   53.794091]  unregister_ftrace_function+0x25/0x50
[   53.794766]  perf_ftrace_event_register+0x89/0xf0
[   53.795431]  ? perf_tp_event_init+0xa0/0xa0
[   53.796026]  perf_trace_destroy+0x37/0x60
[   53.796606]  tp_perf_event_destroy+0x15/0x20
[   53.797222]  _free_event+0xfc/0x7d0
[   53.797755]  put_event+0x37/0x50
[   53.798242]  perf_event_release_kernel+0x2f4/0x370
[   53.798945]  ? perf_event_release_kernel+0x370/0x370
[   53.799650]  perf_release+0x19/0x20
[   53.800159]  __fput+0x12d/0x460
[   53.800668]  ____fput+0x1a/0x20
[   53.801145]  task_work_run+0x8e/0xf0
[   53.801688]  do_exit+0x616/0x1310
[   53.802202]  ? write_comp_data+0x2f/0x90
[   53.802800]  do_group_exit+0x7e/0x130
[   53.803355]  get_signal+0x249/0x13c0
[   53.803892]  ? get_signal+0x5/0x13c0
[   53.804454]  arch_do_signal_or_restart+0xb7/0x7e0
[   53.805174]  ? arch_do_signal_or_restart+0x5/0x7e0
[   53.805894]  exit_to_user_mode_prepare+0x154/0x240
[   53.806582]  syscall_exit_to_user_mode+0x2b/0x60
[   53.807240]  do_syscall_64+0x46/0x80
[   53.807760]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   53.808462] RIP: 0033:0x7fac0740459d
[   53.808972] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   53.809846] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   53.810878] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   53.811836] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   53.812792] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   53.813751] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   53.814710] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   53.815778] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   53.815892] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   53.816774] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   53.817868] caller is debug_smp_processor_id+0x1c/0x20
[   53.819298] Call Trace:
[   53.819306]  dump_stack_lvl+0xa4/0xd3
[   53.819328]  dump_stack+0x15/0x17
[   53.819342]  check_preemption_disabled+0x167/0x180
[   53.819360]  ? del_timer_sync+0xd3/0x130
[   53.819375]  ? detach_if_pending+0x270/0x270
[   53.819400]  debug_smp_processor_id+0x1c/0x20
[   53.823594]  perf_ftrace_function_call+0x7c/0x360
[   53.824212]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   53.824836]  ? register_lock_class+0x42/0x440
[   53.825422]  ? del_timer_sync+0x40/0x130
[   53.825949]  ? 0xffffffffa00dc099
[   53.826398]  ? 0xffffffffa00dc099
[   53.826845]  ? 0xffffffffa00dc099
[   53.827300]  0xffffffffa00dc099
[   53.827723]  ? __this_cpu_preempt_check+0x1c/0x20
[   53.828357]  ? del_timer_sync+0xa5/0x130
[   53.828884]  ? try_to_del_timer_sync+0x5/0x90
[   53.829461]  ? write_comp_data+0x2f/0x90
[   53.829986]  try_to_del_timer_sync+0x5/0x90
[   53.830550]  del_timer_sync+0xd3/0x130
[   53.831051]  ? try_to_del_timer_sync+0x5/0x90
[   53.831631]  ? del_timer_sync+0xd3/0x130
[   53.832160]  schedule_timeout+0x34e/0x610
[   53.832704]  ? del_timer_sync+0x130/0x130
[   53.833242]  ? i915_init_ggtt+0x40/0x6b0
[   53.833775]  rcu_gp_fqs_loop+0x2a0/0x410
[   53.834311]  ? rcu_gp_init+0x730/0x730
[   53.834810]  rcu_gp_kthread+0xdd/0x170
[   53.835318]  kthread+0x1e7/0x230
[   53.835758]  ? set_kthread_struct+0x80/0x80
[   53.836319]  ret_from_fork+0x1f/0x30
[   53.836833] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   53.836880] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[   53.837903] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   53.838941] caller is debug_smp_processor_id+0x1c/0x20
[   53.840548] Call Trace:
[   53.841603]  dump_stack_lvl+0xa4/0xd3
[   53.842232]  dump_stack+0x15/0x17
[   53.842775]  check_preemption_disabled+0x167/0x180
[   53.843523]  ? _raw_spin_lock+0x17/0x50
[   53.844127]  ? trace_sched_waking+0xc0/0xc0
[   53.844812]  debug_smp_processor_id+0x1c/0x20
[   53.845499]  perf_ftrace_function_call+0x7c/0x360
[   53.846356]  ? ftrace_ops_list_func+0x259/0x2e0
[   53.847076]  ? write_comp_data+0x2f/0x90
[   53.847713]  ? perf_trace_buf_update+0x70/0x70
[   53.848412]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   53.849166]  ? ftrace_ops_list_func+0x1d2/0x2e0
[   53.849941]  0xffffffffa00dc099
[   53.850480]  ? ftrace_call+0x5/0x44
[   53.851066]  ? acpi_ev_add_gpe_reference+0x130/0x130
[   53.851871]  ? pmd_page_vaddr+0x2b/0x70
[   53.852516]  ? preempt_count_add+0x5/0xc0
[   53.853196]  preempt_count_add+0x5/0xc0
[   53.853811]  _raw_spin_lock+0x17/0x50
[   53.854406]  ? preempt_count_add+0x5/0xc0
[   53.855032]  ? _raw_spin_lock+0x17/0x50
[   53.855657]  __get_locked_pte+0x1a2/0x290
[   53.856316]  ? acpi_ev_add_gpe_reference+0x130/0x130
[   53.857110]  __text_poke+0xea/0x4e0
[   53.857678]  ? acpi_ev_add_gpe_reference+0x130/0x130
[   53.858474]  ? lock_is_held_type+0xe2/0x140
[   53.859148]  ? acpi_ev_add_gpe_reference+0x130/0x130
[   53.859964]  text_poke+0x2b/0x60
[   53.860526]  text_poke_bp_batch+0x1dc/0x2c0
[   53.861233]  ? acpi_hw_get_gpe_status+0x199/0x199
[   53.862010]  text_poke_queue+0xa7/0xc0
[   53.862659]  ftrace_replace_code+0xfd/0x170
[   53.863381]  ftrace_modify_all_code+0x1b1/0x270
[   53.864135]  arch_ftrace_update_code+0x9/0x10
[   53.864822]  ftrace_run_update_code+0x30/0xa0
[   53.865529]  ftrace_shutdown+0x2b8/0x4a0
[   53.866223]  unregister_ftrace_function+0x25/0x50
[   53.866969]  perf_ftrace_event_register+0x89/0xf0
[   53.867708]  ? perf_tp_event_init+0xa0/0xa0
[   53.868369]  perf_trace_destroy+0x37/0x60
[   53.869020]  tp_perf_event_destroy+0x15/0x20
[   53.869706]  _free_event+0xfc/0x7d0
[   53.870334]  put_event+0x37/0x50
[   53.870885]  perf_event_release_kernel+0x2f4/0x370
[   53.871696]  ? perf_event_release_kernel+0x370/0x370
[   53.872487]  perf_release+0x19/0x20
[   53.873065]  __fput+0x12d/0x460
[   53.873681]  ____fput+0x1a/0x20
[   53.874215]  task_work_run+0x8e/0xf0
[   53.874848]  do_exit+0x616/0x1310
[   53.875445]  ? write_comp_data+0x2f/0x90
[   53.876146]  do_group_exit+0x7e/0x130
[   53.876792]  get_signal+0x249/0x13c0
[   53.877413]  ? get_signal+0x5/0x13c0
[   53.878092]  arch_do_signal_or_restart+0xb7/0x7e0
[   53.878950]  ? arch_do_signal_or_restart+0x5/0x7e0
[   53.879792]  exit_to_user_mode_prepare+0x154/0x240
[   53.880559]  syscall_exit_to_user_mode+0x2b/0x60
[   53.881294]  do_syscall_64+0x46/0x80
[   53.881883]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   53.882662] RIP: 0033:0x7fac0740459d
[   53.883233] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   53.884192] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   53.885320] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   53.886368] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   53.887412] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   53.888453] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   53.889496] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   53.890772] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   53.890883] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   53.891764] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   53.892867] caller is debug_smp_processor_id+0x1c/0x20
[   53.894298] Call Trace:
[   53.894306]  dump_stack_lvl+0xa4/0xd3
[   53.894327]  dump_stack+0x15/0x17
[   53.894342]  check_preemption_disabled+0x167/0x180
[   53.894359]  ? try_to_del_timer_sync+0x33/0x90
[   53.894375]  ? calc_wheel_index+0x2d0/0x2d0
[   53.894400]  debug_smp_processor_id+0x1c/0x20
[   53.898660]  perf_ftrace_function_call+0x7c/0x360
[   53.899284]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   53.899905]  ? del_timer_sync+0xd3/0x130
[   53.900429]  ? perf_ftrace_function_call+0x4c/0x360
[   53.901070]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   53.901697]  ? register_lock_class+0x42/0x440
[   53.902284]  ? del_timer_sync+0x40/0x130
[   53.902811]  ? 0xffffffffa00dc099
[   53.903259]  ? 0xffffffffa00dc099
[   53.903715]  0xffffffffa00dc099
[   53.904145]  ? 0xffffffffa00dc099
[   53.904591]  ? __this_cpu_preempt_check+0x1c/0x20
[   53.905217]  ? del_timer_sync+0xa5/0x130
[   53.905746]  ? lock_timer_base+0x5/0x100
[   53.906280]  lock_timer_base+0x5/0x100
[   53.906783]  try_to_del_timer_sync+0x33/0x90
[   53.907350]  ? lock_timer_base+0x5/0x100
[   53.907872]  ? try_to_del_timer_sync+0x33/0x90
[   53.908459]  ? try_to_del_timer_sync+0x5/0x90
[   53.909043]  del_timer_sync+0xd3/0x130
[   53.909551]  schedule_timeout+0x34e/0x610
[   53.910096]  ? del_timer_sync+0x130/0x130
[   53.910638]  ? i915_init_ggtt+0x40/0x6b0
[   53.911179]  rcu_gp_fqs_loop+0x2a0/0x410
[   53.911715]  ? rcu_gp_init+0x730/0x730
[   53.912217]  rcu_gp_kthread+0xdd/0x170
[   53.912727]  kthread+0x1e7/0x230
[   53.913168]  ? set_kthread_struct+0x80/0x80
[   53.913734]  ret_from_fork+0x1f/0x30
[   53.914254] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   53.914282] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[   53.915325] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   53.916340] caller is debug_smp_processor_id+0x1c/0x20
[   53.917951] Call Trace:
[   53.919011]  dump_stack_lvl+0xa4/0xd3
[   53.919635]  dump_stack+0x15/0x17
[   53.920177]  check_preemption_disabled+0x167/0x180
[   53.920977]  debug_smp_processor_id+0x1c/0x20
[   53.921665]  perf_swevent_get_recursion_context+0x1e/0xd0
[   53.922551]  perf_trace_buf_alloc+0x3d/0x100
[   53.923224]  ? _raw_spin_lock+0x17/0x50
[   53.923827]  ? trace_sched_waking+0xc0/0xc0
[   53.924497]  perf_ftrace_function_call+0x209/0x360
[   53.925451]  ? 0xffffffffa00dc099
[   53.926106]  0xffffffffa00dc099
[   53.926646]  ? ftrace_call+0x5/0x44
[   53.927236]  ? acpi_ev_add_gpe_reference+0x130/0x130
[   53.928038]  ? pmd_page_vaddr+0x2b/0x70
[   53.928682]  ? preempt_count_add+0x5/0xc0
[   53.929361]  preempt_count_add+0x5/0xc0
[   53.929973]  _raw_spin_lock+0x17/0x50
[   53.930567]  ? preempt_count_add+0x5/0xc0
[   53.931192]  ? _raw_spin_lock+0x17/0x50
[   53.931817]  __get_locked_pte+0x1a2/0x290
[   53.932475]  ? acpi_ev_add_gpe_reference+0x130/0x130
[   53.933265]  __text_poke+0xea/0x4e0
[   53.933837]  ? acpi_ev_add_gpe_reference+0x130/0x130
[   53.934632]  ? lock_is_held_type+0xe2/0x140
[   53.935303]  ? acpi_ev_add_gpe_reference+0x130/0x130
[   53.936118]  text_poke+0x2b/0x60
[   53.936684]  text_poke_bp_batch+0x1dc/0x2c0
[   53.937388]  ? acpi_hw_get_gpe_status+0x199/0x199
[   53.938169]  text_poke_queue+0xa7/0xc0
[   53.938815]  ftrace_replace_code+0xfd/0x170
[   53.939530]  ftrace_modify_all_code+0x1b1/0x270
[   53.940281]  arch_ftrace_update_code+0x9/0x10
[   53.940965]  ftrace_run_update_code+0x30/0xa0
[   53.941671]  ftrace_shutdown+0x2b8/0x4a0
[   53.942374]  unregister_ftrace_function+0x25/0x50
[   53.943118]  perf_ftrace_event_register+0x89/0xf0
[   53.943850]  ? perf_tp_event_init+0xa0/0xa0
[   53.944510]  perf_trace_destroy+0x37/0x60
[   53.945160]  tp_perf_event_destroy+0x15/0x20
[   53.945845]  _free_event+0xfc/0x7d0
[   53.946468]  put_event+0x37/0x50
[   53.947018]  perf_event_release_kernel+0x2f4/0x370
[   53.947826]  ? perf_event_release_kernel+0x370/0x370
[   53.948614]  perf_release+0x19/0x20
[   53.949188]  __fput+0x12d/0x460
[   53.949804]  ____fput+0x1a/0x20
[   53.950337]  task_work_run+0x8e/0xf0
[   53.950969]  do_exit+0x616/0x1310
[   53.951565]  ? write_comp_data+0x2f/0x90
[   53.952265]  do_group_exit+0x7e/0x130
[   53.952909]  get_signal+0x249/0x13c0
[   53.953529]  ? get_signal+0x5/0x13c0
[   53.954205]  arch_do_signal_or_restart+0xb7/0x7e0
[   53.955058]  ? arch_do_signal_or_restart+0x5/0x7e0
[   53.955901]  exit_to_user_mode_prepare+0x154/0x240
[   53.956668]  syscall_exit_to_user_mode+0x2b/0x60
[   53.957402]  do_syscall_64+0x46/0x80
[   53.957990]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   53.958769] RIP: 0033:0x7fac0740459d
[   53.959347] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   53.960302] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   53.961429] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   53.962474] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   53.963516] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   53.964555] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   53.965594] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   53.966866] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   53.966974] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   53.967859] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   53.968872] caller is debug_smp_processor_id+0x1c/0x20
[   53.970307] Call Trace:
[   53.970315]  dump_stack_lvl+0xa4/0xd3
[   53.970336]  dump_stack+0x15/0x17
[   53.970351]  check_preemption_disabled+0x167/0x180
[   53.970369]  ? rcu_gp_fqs_loop+0x2b4/0x410
[   53.970382]  ? prepare_to_swait_exclusive+0x90/0x90
[   53.970403]  debug_smp_processor_id+0x1c/0x20
[   53.974661]  perf_ftrace_function_call+0x7c/0x360
[   53.975292]  ? trace_hardirqs_on+0x3f/0x170
[   53.975855]  ? preempt_count_sub+0x5/0xa0
[   53.976397]  ? preempt_count_sub+0x5/0xa0
[   53.976931]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[   53.977589]  ? write_comp_data+0x2f/0x90
[   53.978127]  0xffffffffa00dc099
[   53.978551]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   53.979186]  ? del_timer_sync+0xde/0x130
[   53.979715]  ? prepare_to_swait_event+0x5/0xf0
[   53.980304]  ? i915_init_ggtt+0x40/0x6b0
[   53.980832]  prepare_to_swait_event+0x5/0xf0
[   53.981401]  rcu_gp_fqs_loop+0x2b4/0x410
[   53.981924]  ? prepare_to_swait_event+0x5/0xf0
[   53.982516]  ? rcu_gp_fqs_loop+0x2b4/0x410
[   53.983072]  ? rcu_gp_init+0x730/0x730
[   53.983575]  rcu_gp_kthread+0xdd/0x170
[   53.984084]  kthread+0x1e7/0x230
[   53.984525]  ? set_kthread_struct+0x80/0x80
[   53.985088]  ret_from_fork+0x1f/0x30
[   53.985602] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   53.985633] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[   53.986594] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   53.986610] Call Trace:
[   53.987627] caller is debug_smp_processor_id+0x1c/0x20
[   53.989131]  dump_stack_lvl+0xa4/0xd3
[   53.990663]  dump_stack+0x15/0x17
[   53.991147]  check_preemption_disabled+0x167/0x180
[   53.991852]  debug_smp_processor_id+0x1c/0x20
[   53.992469]  perf_trace_buf_alloc+0x98/0x100
[   53.993076]  ? _raw_spin_lock+0x17/0x50
[   53.993621]  ? trace_sched_waking+0xc0/0xc0
[   53.994224]  perf_ftrace_function_call+0x209/0x360
[   53.994997]  ? 0xffffffffa00dc099
[   53.995532]  0xffffffffa00dc099
[   53.995998]  ? ftrace_call+0x5/0x44
[   53.996512]  ? acpi_ev_add_gpe_reference+0x130/0x130
[   53.997224]  ? pmd_page_vaddr+0x2b/0x70
[   53.997788]  ? preempt_count_add+0x5/0xc0
[   53.998384]  preempt_count_add+0x5/0xc0
[   53.998932]  _raw_spin_lock+0x17/0x50
[   53.999460]  ? preempt_count_add+0x5/0xc0
[   54.000024]  ? _raw_spin_lock+0x17/0x50
[   54.000580]  __get_locked_pte+0x1a2/0x290
[   54.001162]  ? acpi_ev_add_gpe_reference+0x130/0x130
[   54.001868]  __text_poke+0xea/0x4e0
[   54.002377]  ? acpi_ev_add_gpe_reference+0x130/0x130
[   54.003084]  ? lock_is_held_type+0xe2/0x140
[   54.003683]  ? acpi_ev_add_gpe_reference+0x130/0x130
[   54.004399]  text_poke+0x2b/0x60
[   54.004886]  text_poke_bp_batch+0x1dc/0x2c0
[   54.005501]  ? acpi_hw_get_gpe_status+0x199/0x199
[   54.006187]  text_poke_queue+0xa7/0xc0
[   54.006749]  ftrace_replace_code+0xfd/0x170
[   54.007373]  ftrace_modify_all_code+0x1b1/0x270
[   54.008035]  arch_ftrace_update_code+0x9/0x10
[   54.008653]  ftrace_run_update_code+0x30/0xa0
[   54.009280]  ftrace_shutdown+0x2b8/0x4a0
[   54.009874]  unregister_ftrace_function+0x25/0x50
[   54.010545]  perf_ftrace_event_register+0x89/0xf0
[   54.011210]  ? perf_tp_event_init+0xa0/0xa0
[   54.011806]  perf_trace_destroy+0x37/0x60
[   54.012387]  tp_perf_event_destroy+0x15/0x20
[   54.013001]  _free_event+0xfc/0x7d0
[   54.013533]  put_event+0x37/0x50
[   54.014016]  perf_event_release_kernel+0x2f4/0x370
[   54.014725]  ? perf_event_release_kernel+0x370/0x370
[   54.015432]  perf_release+0x19/0x20
[   54.015944]  __fput+0x12d/0x460
[   54.016455]  ____fput+0x1a/0x20
[   54.016922]  task_work_run+0x8e/0xf0
[   54.017467]  do_exit+0x616/0x1310
[   54.017978]  ? write_comp_data+0x2f/0x90
[   54.018584]  do_group_exit+0x7e/0x130
[   54.019143]  get_signal+0x249/0x13c0
[   54.019686]  ? get_signal+0x5/0x13c0
[   54.020248]  arch_do_signal_or_restart+0xb7/0x7e0
[   54.020969]  ? arch_do_signal_or_restart+0x5/0x7e0
[   54.021689]  exit_to_user_mode_prepare+0x154/0x240
[   54.022377]  syscall_exit_to_user_mode+0x2b/0x60
[   54.023036]  do_syscall_64+0x46/0x80
[   54.023557]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   54.024262] RIP: 0033:0x7fac0740459d
[   54.024773] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   54.025651] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   54.026683] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   54.027639] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   54.028597] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   54.029555] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   54.030523] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   54.031592] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   54.032588] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   54.034032] Call Trace:
[   54.034369]  dump_stack_lvl+0xa4/0xd3
[   54.034865]  dump_stack+0x15/0x17
[   54.035313]  check_preemption_disabled+0x167/0x180
[   54.035945]  ? rcu_gp_fqs_loop+0x2bd/0x410
[   54.036487]  ? rcu_pm_notify+0x40/0x40
[   54.036990]  debug_smp_processor_id+0x1c/0x20
[   54.037568]  perf_ftrace_function_call+0x7c/0x360
[   54.038193]  ? prepare_to_swait_event+0xbb/0xf0
[   54.038795]  ? 0xffffffffa00dc099
[   54.039241]  ? 0xffffffffa00dc099
[   54.039688]  ? 0xffffffffa00dc099
[   54.040145]  ? 0xffffffffa00dc099
[   54.040600]  0xffffffffa00dc099
[   54.041024]  ? trace_hardirqs_on+0x3f/0x170
[   54.041583]  ? preempt_count_sub+0x5/0xa0
[   54.042130]  ? rcu_gp_fqs_check_wake+0x5/0x50
[   54.042709]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[   54.043365]  rcu_gp_fqs_check_wake+0x5/0x50
[   54.043920]  rcu_gp_fqs_loop+0x2bd/0x410
[   54.044443]  ? rcu_gp_fqs_check_wake+0x5/0x50
[   54.045025]  ? rcu_gp_fqs_loop+0x2bd/0x410
[   54.045581]  ? rcu_gp_init+0x730/0x730
[   54.046082]  rcu_gp_kthread+0xdd/0x170
[   54.046593]  kthread+0x1e7/0x230
[   54.047033]  ? set_kthread_struct+0x80/0x80
[   54.047595]  ret_from_fork+0x1f/0x30
[   58.706049] check_preemption_disabled: 1556164 callbacks suppressed
[   58.706072] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   58.706116] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[   58.706924] caller is debug_smp_processor_id+0x1c/0x20
[   58.707853] caller is debug_smp_processor_id+0x1c/0x20
[   58.708876] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   58.711082] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   58.712528] Call Trace:
[   58.712878]  dump_stack_lvl+0xa4/0xd3
[   58.713402]  dump_stack+0x15/0x17
[   58.713865]  check_preemption_disabled+0x167/0x180
[   58.714543]  debug_smp_processor_id+0x1c/0x20
[   58.715136]  perf_trace_buf_alloc+0x98/0x100
[   58.715721]  ? text_poke_queue+0x84/0xc0
[   58.716254]  ? cpumask_weight+0x20/0x20
[   58.716787]  perf_ftrace_function_call+0x209/0x360
[   58.717534]  ? 0xffffffffa00dc099
[   58.718020]  ? sdev_show_evt_inquiry_change_reported+0x50/0x50
[   58.718840]  0xffffffffa00dc099
[   58.719304]  ? ftrace_call+0x5/0x44
[   58.719822]  ? sdev_show_evt_inquiry_change_reported+0x50/0x50
[   58.720602]  ? text_poke_loc_init+0x5/0x140
[   58.721183]  ? sdev_show_evt_inquiry_change_reported+0x50/0x50
[   58.721957]  text_poke_loc_init+0x5/0x140
[   58.722514]  text_poke_queue+0x84/0xc0
[   58.723034]  ? text_poke_loc_init+0x5/0x140
[   58.723600]  ? text_poke_queue+0x84/0xc0
[   58.724160]  ftrace_replace_code+0xfd/0x170
[   58.724757]  ftrace_modify_all_code+0x1b1/0x270
[   58.725393]  arch_ftrace_update_code+0x9/0x10
[   58.725986]  ftrace_run_update_code+0x30/0xa0
[   58.726594]  ftrace_shutdown+0x2b8/0x4a0
[   58.727164]  unregister_ftrace_function+0x25/0x50
[   58.727804]  perf_ftrace_event_register+0x89/0xf0
[   58.728441]  ? perf_tp_event_init+0xa0/0xa0
[   58.729015]  perf_trace_destroy+0x37/0x60
[   58.729571]  tp_perf_event_destroy+0x15/0x20
[   58.730163]  _free_event+0xfc/0x7d0
[   58.730675]  put_event+0x37/0x50
[   58.731139]  perf_event_release_kernel+0x2f4/0x370
[   58.731817]  ? perf_event_release_kernel+0x370/0x370
[   58.732495]  perf_release+0x19/0x20
[   58.732986]  __fput+0x12d/0x460
[   58.733478]  ____fput+0x1a/0x20
[   58.733928]  task_work_run+0x8e/0xf0
[   58.734456]  do_exit+0x616/0x1310
[   58.734949]  ? write_comp_data+0x2f/0x90
[   58.735526]  do_group_exit+0x7e/0x130
[   58.736061]  get_signal+0x249/0x13c0
[   58.736584]  ? get_signal+0x5/0x13c0
[   58.737127]  arch_do_signal_or_restart+0xb7/0x7e0
[   58.737826]  ? arch_do_signal_or_restart+0x5/0x7e0
[   58.738531]  exit_to_user_mode_prepare+0x154/0x240
[   58.739189]  syscall_exit_to_user_mode+0x2b/0x60
[   58.739820]  do_syscall_64+0x46/0x80
[   58.740322]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   58.741000] RIP: 0033:0x7fac0740459d
[   58.741503] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   58.742356] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   58.743346] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   58.744267] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   58.745186] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   58.746105] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   58.747032] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   58.748068] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   58.748186] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   58.749010] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   58.750067] caller is debug_smp_processor_id+0x1c/0x20
[   58.751345] Call Trace:
[   58.751354]  dump_stack_lvl+0xa4/0xd3
[   58.752763]  dump_stack+0x15/0x17
[   58.753187]  check_preemption_disabled+0x167/0x180
[   58.753786]  ? schedule_timeout+0x34e/0x610
[   58.754329]  ? do_init_timer+0xa0/0xa0
[   58.754808]  debug_smp_processor_id+0x1c/0x20
[   58.755354]  perf_ftrace_function_call+0x7c/0x360
[   58.755948]  ? 0xffffffffa00dc099
[   58.756369]  ? __this_cpu_preempt_check+0x1c/0x20
[   58.756970]  ? finish_task_switch+0xab/0x2a0
[   58.757503]  ? __schedule+0x46e/0xb20
[   58.757983]  0xffffffffa00dc099
[   58.758395]  ? finish_task_switch+0xb0/0x2a0
[   58.758946]  ? del_timer_sync+0x5/0x130
[   58.759437]  del_timer_sync+0x5/0x130
[   58.759902]  schedule_timeout+0x34e/0x610
[   58.760408]  ? del_timer_sync+0x5/0x130
[   58.760892]  ? schedule_timeout+0x34e/0x610
[   58.761426]  ? del_timer_sync+0x130/0x130
[   58.761938]  ? i915_init_ggtt+0x40/0x6b0
[   58.762455]  rcu_gp_fqs_loop+0x2a0/0x410
[   58.762961]  ? rcu_gp_init+0x730/0x730
[   58.763434]  rcu_gp_kthread+0xdd/0x170
[   58.763915]  kthread+0x1e7/0x230
[   58.764332]  ? set_kthread_struct+0x80/0x80
[   58.764865]  ret_from_fork+0x1f/0x30
[   58.765360] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   58.765393] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[   58.766318] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   58.766334] Call Trace:
[   58.767297] caller is debug_smp_processor_id+0x1c/0x20
[   58.768738]  dump_stack_lvl+0xa4/0xd3
[   58.770206]  dump_stack+0x15/0x17
[   58.770687]  check_preemption_disabled+0x167/0x180
[   58.771361]  debug_smp_processor_id+0x1c/0x20
[   58.771955]  perf_swevent_put_recursion_context+0x1b/0x40
[   58.772686]  perf_tp_event+0x331/0x4e0
[   58.773282]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[   58.774070]  ? arch_local_irq_enable+0x10/0x12
[   58.774682]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   58.775326]  ? dump_stack_lvl+0xcc/0xd3
[   58.775870]  ? dump_stack+0x15/0x17
[   58.776371]  ? text_poke_queue+0x84/0xc0
[   58.776906]  ? cpumask_weight+0x20/0x20
[   58.777445]  perf_ftrace_function_call+0x248/0x360
[   58.778087]  ? perf_trace_buf_alloc+0xb0/0x100
[   58.778689]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   58.779325]  ? perf_ftrace_function_call+0x248/0x360
[   58.780112]  ? 0xffffffffa00dc099
[   58.780598]  ? sdev_show_evt_inquiry_change_reported+0x50/0x50
[   58.781396]  0xffffffffa00dc099
[   58.781861]  ? ftrace_call+0x5/0x44
[   58.782398]  ? sdev_show_evt_inquiry_change_reported+0x50/0x50
[   58.783179]  ? text_poke_loc_init+0x5/0x140
[   58.783761]  ? sdev_show_evt_inquiry_change_reported+0x50/0x50
[   58.784542]  text_poke_loc_init+0x5/0x140
[   58.785092]  text_poke_queue+0x84/0xc0
[   58.785611]  ? text_poke_loc_init+0x5/0x140
[   58.786182]  ? text_poke_queue+0x84/0xc0
[   58.786743]  ftrace_replace_code+0xfd/0x170
[   58.787341]  ftrace_modify_all_code+0x1b1/0x270
[   58.787976]  arch_ftrace_update_code+0x9/0x10
[   58.788569]  ftrace_run_update_code+0x30/0xa0
[   58.789169]  ftrace_shutdown+0x2b8/0x4a0
[   58.789740]  unregister_ftrace_function+0x25/0x50
[   58.790386]  perf_ftrace_event_register+0x89/0xf0
[   58.791024]  ? perf_tp_event_init+0xa0/0xa0
[   58.791596]  perf_trace_destroy+0x37/0x60
[   58.792153]  tp_perf_event_destroy+0x15/0x20
[   58.792740]  _free_event+0xfc/0x7d0
[   58.793251]  put_event+0x37/0x50
[   58.793712]  perf_event_release_kernel+0x2f4/0x370
[   58.794400]  ? perf_event_release_kernel+0x370/0x370
[   58.795087]  perf_release+0x19/0x20
[   58.795584]  __fput+0x12d/0x460
[   58.796075]  ____fput+0x1a/0x20
[   58.796524]  task_work_run+0x8e/0xf0
[   58.797046]  do_exit+0x616/0x1310
[   58.797537]  ? write_comp_data+0x2f/0x90
[   58.798117]  do_group_exit+0x7e/0x130
[   58.798661]  get_signal+0x249/0x13c0
[   58.799177]  ? get_signal+0x5/0x13c0
[   58.799719]  arch_do_signal_or_restart+0xb7/0x7e0
[   58.800413]  ? arch_do_signal_or_restart+0x5/0x7e0
[   58.801106]  exit_to_user_mode_prepare+0x154/0x240
[   58.801761]  syscall_exit_to_user_mode+0x2b/0x60
[   58.802401]  do_syscall_64+0x46/0x80
[   58.802901]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   58.803576] RIP: 0033:0x7fac0740459d
[   58.804067] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   58.804910] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   58.805902] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   58.806836] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   58.807755] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   58.808675] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   58.809594] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   58.810631] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   58.810740] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   58.811575] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   58.812624] caller is debug_smp_processor_id+0x1c/0x20
[   58.813973] Call Trace:
[   58.813981]  dump_stack_lvl+0xa4/0xd3
[   58.814002]  dump_stack+0x15/0x17
[   58.814023]  check_preemption_disabled+0x167/0x180
[   58.814041]  ? del_timer_sync+0xd3/0x130
[   58.814056]  ? detach_if_pending+0x270/0x270
[   58.814076]  debug_smp_processor_id+0x1c/0x20
[   58.818066]  perf_ftrace_function_call+0x7c/0x360
[   58.818657]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   58.819250]  ? register_lock_class+0x42/0x440
[   58.819803]  ? del_timer_sync+0x40/0x130
[   58.820303]  ? 0xffffffffa00dc099
[   58.820727]  ? 0xffffffffa00dc099
[   58.821153]  ? 0xffffffffa00dc099
[   58.821588]  0xffffffffa00dc099
[   58.821989]  ? __this_cpu_preempt_check+0x1c/0x20
[   58.822594]  ? del_timer_sync+0xa5/0x130
[   58.823095]  ? try_to_del_timer_sync+0x5/0x90
[   58.823643]  ? write_comp_data+0x2f/0x90
[   58.824145]  try_to_del_timer_sync+0x5/0x90
[   58.824672]  del_timer_sync+0xd3/0x130
[   58.825148]  ? try_to_del_timer_sync+0x5/0x90
[   58.825693]  ? del_timer_sync+0xd3/0x130
[   58.826197]  schedule_timeout+0x34e/0x610
[   58.826714]  ? del_timer_sync+0x130/0x130
[   58.827227]  ? i915_init_ggtt+0x40/0x6b0
[   58.827733]  rcu_gp_fqs_loop+0x2a0/0x410
[   58.828239]  ? rcu_gp_init+0x730/0x730
[   58.828713]  rcu_gp_kthread+0xdd/0x170
[   58.829197]  kthread+0x1e7/0x230
[   58.829613]  ? set_kthread_struct+0x80/0x80
[   58.830148]  ret_from_fork+0x1f/0x30
[   58.830638] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   58.830667] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[   58.831662] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   58.832621] caller is debug_smp_processor_id+0x1c/0x20
[   58.834169] Call Trace:
[   58.834202]  dump_stack_lvl+0xa4/0xd3
[   58.835740]  dump_stack+0x15/0x17
[   58.836260]  check_preemption_disabled+0x167/0x180
[   58.836976]  ? text_poke_loc_init+0x63/0x140
[   58.837610]  ? insn_get_length+0x90/0x90
[   58.838234]  debug_smp_processor_id+0x1c/0x20
[   58.838893]  perf_ftrace_function_call+0x7c/0x360
[   58.839630]  ? dump_stack+0x15/0x17
[   58.840204]  ? text_poke_queue+0x84/0xc0
[   58.840794]  ? cpumask_weight+0x20/0x20
[   58.841402]  ? perf_ftrace_function_call+0x248/0x360
[   58.842132]  ? perf_trace_buf_alloc+0xb0/0x100
[   58.842802]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   58.843504]  ? text_poke_queue+0x84/0xc0
[   58.844104]  ? perf_ftrace_function_call+0x4c/0x360
[   58.844895]  ? sdev_show_evt_inquiry_change_reported+0x50/0x50
[   58.845759]  0xffffffffa00dc099
[   58.846427]  ? insn_decode+0x5/0x170
[   58.847025]  insn_decode+0x5/0x170
[   58.847556]  text_poke_loc_init+0x63/0x140
[   58.848181]  ? insn_decode+0x5/0x170
[   58.848722]  ? text_poke_loc_init+0x63/0x140
[   58.849433]  ? sdev_show_evt_inquiry_change_reported+0x50/0x50
[   58.850299]  ? text_poke_loc_init+0x5/0x140
[   58.850965]  ? sdev_show_evt_inquiry_change_reported+0x50/0x50
[   58.851860]  text_poke_queue+0x84/0xc0
[   58.852483]  ftrace_replace_code+0xfd/0x170
[   58.853173]  ftrace_modify_all_code+0x1b1/0x270
[   58.853896]  arch_ftrace_update_code+0x9/0x10
[   58.854565]  ftrace_run_update_code+0x30/0xa0
[   58.855245]  ftrace_shutdown+0x2b8/0x4a0
[   58.855910]  unregister_ftrace_function+0x25/0x50
[   58.856625]  perf_ftrace_event_register+0x89/0xf0
[   58.857333]  ? perf_tp_event_init+0xa0/0xa0
[   58.857969]  perf_trace_destroy+0x37/0x60
[   58.858598]  tp_perf_event_destroy+0x15/0x20
[   58.859256]  _free_event+0xfc/0x7d0
[   58.859859]  put_event+0x37/0x50
[   58.860389]  perf_event_release_kernel+0x2f4/0x370
[   58.861168]  ? perf_event_release_kernel+0x370/0x370
[   58.861926]  perf_release+0x19/0x20
[   58.862483]  __fput+0x12d/0x460
[   58.863079]  ____fput+0x1a/0x20
[   58.863588]  task_work_run+0x8e/0xf0
[   58.864197]  do_exit+0x616/0x1310
[   58.864773]  ? write_comp_data+0x2f/0x90
[   58.865449]  do_group_exit+0x7e/0x130
[   58.866072]  get_signal+0x249/0x13c0
[   58.866673]  ? get_signal+0x5/0x13c0
[   58.867322]  arch_do_signal_or_restart+0xb7/0x7e0
[   58.868143]  ? arch_do_signal_or_restart+0x5/0x7e0
[   58.868954]  exit_to_user_mode_prepare+0x154/0x240
[   58.869691]  syscall_exit_to_user_mode+0x2b/0x60
[   58.870401]  do_syscall_64+0x46/0x80
[   58.870967]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   58.871708] RIP: 0033:0x7fac0740459d
[   58.872255] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   58.873171] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   58.874255] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   58.875254] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   58.876255] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   58.877253] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   58.878258] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   58.879483] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   58.879593] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   58.880423] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   58.881476] caller is debug_smp_processor_id+0x1c/0x20
[   58.882837] Call Trace:
[   58.882845]  dump_stack_lvl+0xa4/0xd3
[   58.882865]  dump_stack+0x15/0x17
[   58.882880]  check_preemption_disabled+0x167/0x180
[   58.882898]  ? try_to_del_timer_sync+0x33/0x90
[   58.882913]  ? calc_wheel_index+0x2d0/0x2d0
[   58.882933]  debug_smp_processor_id+0x1c/0x20
[   58.882950]  perf_ftrace_function_call+0x7c/0x360
[   58.887525]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   58.888113]  ? del_timer_sync+0xd3/0x130
[   58.888610]  ? perf_ftrace_function_call+0x4c/0x360
[   58.889215]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   58.889809]  ? register_lock_class+0x42/0x440
[   58.890365]  ? del_timer_sync+0x40/0x130
[   58.890866]  ? 0xffffffffa00dc099
[   58.891290]  ? 0xffffffffa00dc099
[   58.891721]  0xffffffffa00dc099
[   58.892128]  ? 0xffffffffa00dc099
[   58.892548]  ? __this_cpu_preempt_check+0x1c/0x20
[   58.893138]  ? del_timer_sync+0xa5/0x130
[   58.893639]  ? lock_timer_base+0x5/0x100
[   58.894143]  lock_timer_base+0x5/0x100
[   58.894619]  try_to_del_timer_sync+0x33/0x90
[   58.895156]  ? lock_timer_base+0x5/0x100
[   58.895649]  ? try_to_del_timer_sync+0x33/0x90
[   58.896204]  ? try_to_del_timer_sync+0x5/0x90
[   58.896756]  del_timer_sync+0xd3/0x130
[   58.897235]  schedule_timeout+0x34e/0x610
[   58.897751]  ? del_timer_sync+0x130/0x130
[   58.898273]  ? i915_init_ggtt+0x40/0x6b0
[   58.898782]  rcu_gp_fqs_loop+0x2a0/0x410
[   58.899286]  ? rcu_gp_init+0x730/0x730
[   58.899759]  rcu_gp_kthread+0xdd/0x170
[   58.900240]  kthread+0x1e7/0x230
[   58.900657]  ? set_kthread_struct+0x80/0x80
[   58.901190]  ret_from_fork+0x1f/0x30
[   58.901678] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   58.901708] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[   58.902715] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   58.903689] caller is debug_smp_processor_id+0x1c/0x20
[   58.905242] Call Trace:
[   58.906248]  dump_stack_lvl+0xa4/0xd3
[   58.906851]  dump_stack+0x15/0x17
[   58.907374]  check_preemption_disabled+0x167/0x180
[   58.908148]  debug_smp_processor_id+0x1c/0x20
[   58.908810]  perf_swevent_get_recursion_context+0x1e/0xd0
[   58.909663]  perf_trace_buf_alloc+0x3d/0x100
[   58.910317]  ? text_poke_loc_init+0x63/0x140
[   58.910954]  ? insn_get_length+0x90/0x90
[   58.911568]  perf_ftrace_function_call+0x209/0x360
[   58.912496]  ? 0xffffffffa00dc099
[   58.913100]  ? sdev_show_evt_inquiry_change_reported+0x50/0x50
[   58.913977]  0xffffffffa00dc099
[   58.914649]  ? insn_decode+0x5/0x170
[   58.915250]  insn_decode+0x5/0x170
[   58.915805]  text_poke_loc_init+0x63/0x140
[   58.916445]  ? insn_decode+0x5/0x170
[   58.916989]  ? text_poke_loc_init+0x63/0x140
[   58.917703]  ? sdev_show_evt_inquiry_change_reported+0x50/0x50
[   58.918577]  ? text_poke_loc_init+0x5/0x140
[   58.919247]  ? sdev_show_evt_inquiry_change_reported+0x50/0x50
[   58.920149]  text_poke_queue+0x84/0xc0
[   58.920777]  ftrace_replace_code+0xfd/0x170
[   58.921500]  ftrace_modify_all_code+0x1b1/0x270
[   58.922238]  arch_ftrace_update_code+0x9/0x10
[   58.922900]  ftrace_run_update_code+0x30/0xa0
[   58.923582]  ftrace_shutdown+0x2b8/0x4a0
[   58.924250]  unregister_ftrace_function+0x25/0x50
[   58.924969]  perf_ftrace_event_register+0x89/0xf0
[   58.925684]  ? perf_tp_event_init+0xa0/0xa0
[   58.926328]  perf_trace_destroy+0x37/0x60
[   58.926956]  tp_perf_event_destroy+0x15/0x20
[   58.927618]  _free_event+0xfc/0x7d0
[   58.928218]  put_event+0x37/0x50
[   58.928752]  perf_event_release_kernel+0x2f4/0x370
[   58.929536]  ? perf_event_release_kernel+0x370/0x370
[   58.930302]  perf_release+0x19/0x20
[   58.930858]  __fput+0x12d/0x460
[   58.931456]  ____fput+0x1a/0x20
[   58.931969]  task_work_run+0x8e/0xf0
[   58.932581]  do_exit+0x616/0x1310
[   58.933161]  ? write_comp_data+0x2f/0x90
[   58.933841]  do_group_exit+0x7e/0x130
[   58.934472]  get_signal+0x249/0x13c0
[   58.935072]  ? get_signal+0x5/0x13c0
[   58.935725]  arch_do_signal_or_restart+0xb7/0x7e0
[   58.936552]  ? arch_do_signal_or_restart+0x5/0x7e0
[   58.937368]  exit_to_user_mode_prepare+0x154/0x240
[   58.938108]  syscall_exit_to_user_mode+0x2b/0x60
[   58.938821]  do_syscall_64+0x46/0x80
[   58.939389]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   58.940134] RIP: 0033:0x7fac0740459d
[   58.940684] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   58.941605] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   58.942696] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   58.943706] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   58.944714] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   58.945716] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   58.946725] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   58.947955] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   58.948065] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   58.948899] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   58.949867] caller is debug_smp_processor_id+0x1c/0x20
[   58.951232] Call Trace:
[   58.951240]  dump_stack_lvl+0xa4/0xd3
[   58.951262]  dump_stack+0x15/0x17
[   58.951276]  check_preemption_disabled+0x167/0x180
[   58.951294]  ? rcu_gp_fqs_loop+0x2b4/0x410
[   58.951307]  ? prepare_to_swait_exclusive+0x90/0x90
[   58.951328]  debug_smp_processor_id+0x1c/0x20
[   58.955347]  perf_ftrace_function_call+0x7c/0x360
[   58.955944]  ? trace_hardirqs_on+0x3f/0x170
[   58.956476]  ? preempt_count_sub+0x5/0xa0
[   58.956988]  ? preempt_count_sub+0x5/0xa0
[   58.957494]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[   58.958115]  ? write_comp_data+0x2f/0x90
[   58.958628]  0xffffffffa00dc099
[   58.959028]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   58.959629]  ? del_timer_sync+0xde/0x130
[   58.960131]  ? prepare_to_swait_event+0x5/0xf0
[   58.960688]  ? i915_init_ggtt+0x40/0x6b0
[   58.961187]  prepare_to_swait_event+0x5/0xf0
[   58.961723]  rcu_gp_fqs_loop+0x2b4/0x410
[   58.962221]  ? prepare_to_swait_event+0x5/0xf0
[   58.962777]  ? rcu_gp_fqs_loop+0x2b4/0x410
[   58.963302]  ? rcu_gp_init+0x730/0x730
[   58.963778]  rcu_gp_kthread+0xdd/0x170
[   58.964260]  kthread+0x1e7/0x230
[   58.964678]  ? set_kthread_struct+0x80/0x80
[   58.965210]  ret_from_fork+0x1f/0x30
[   58.965699] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   58.965733] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[   58.966650] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   58.967625] caller is debug_smp_processor_id+0x1c/0x20
[   58.969059] Call Trace:
[   58.970018]  dump_stack_lvl+0xa4/0xd3
[   58.970546]  dump_stack+0x15/0x17
[   58.971012]  check_preemption_disabled+0x167/0x180
[   58.971687]  debug_smp_processor_id+0x1c/0x20
[   58.972281]  perf_trace_buf_alloc+0x98/0x100
[   58.972865]  ? text_poke_loc_init+0x63/0x140
[   58.973447]  ? insn_get_length+0x90/0x90
[   58.973997]  perf_ftrace_function_call+0x209/0x360
[   58.974750]  ? 0xffffffffa00dc099
[   58.975253]  ? sdev_show_evt_inquiry_change_reported+0x50/0x50
[   58.976035]  0xffffffffa00dc099
[   58.976557]  ? insn_decode+0x5/0x170
[   58.977074]  insn_decode+0x5/0x170
[   58.977553]  text_poke_loc_init+0x63/0x140
[   58.978114]  ? insn_decode+0x5/0x170
[   58.978609]  ? text_poke_loc_init+0x63/0x140
[   58.979221]  ? sdev_show_evt_inquiry_change_reported+0x50/0x50
[   58.980000]  ? text_poke_loc_init+0x5/0x140
[   58.980587]  ? sdev_show_evt_inquiry_change_reported+0x50/0x50
[   58.981382]  text_poke_queue+0x84/0xc0
[   58.981921]  ftrace_replace_code+0xfd/0x170
[   58.982526]  ftrace_modify_all_code+0x1b1/0x270
[   58.983161]  arch_ftrace_update_code+0x9/0x10
[   58.983752]  ftrace_run_update_code+0x30/0xa0
[   58.984355]  ftrace_shutdown+0x2b8/0x4a0
[   58.984922]  unregister_ftrace_function+0x25/0x50
[   58.985563]  perf_ftrace_event_register+0x89/0xf0
[   58.986205]  ? perf_tp_event_init+0xa0/0xa0
[   58.986777]  perf_trace_destroy+0x37/0x60
[   58.987334]  tp_perf_event_destroy+0x15/0x20
[   58.987923]  _free_event+0xfc/0x7d0
[   58.988437]  put_event+0x37/0x50
[   58.988902]  perf_event_release_kernel+0x2f4/0x370
[   58.989581]  ? perf_event_release_kernel+0x370/0x370
[   58.990264]  perf_release+0x19/0x20
[   58.990755]  __fput+0x12d/0x460
[   58.991247]  ____fput+0x1a/0x20
[   58.991698]  task_work_run+0x8e/0xf0
[   58.992221]  do_exit+0x616/0x1310
[   58.992714]  ? write_comp_data+0x2f/0x90
[   58.993289]  do_group_exit+0x7e/0x130
[   58.993824]  get_signal+0x249/0x13c0
[   58.994345]  ? get_signal+0x5/0x13c0
[   58.994889]  arch_do_signal_or_restart+0xb7/0x7e0
[   58.995583]  ? arch_do_signal_or_restart+0x5/0x7e0
[   58.996277]  exit_to_user_mode_prepare+0x154/0x240
[   58.996934]  syscall_exit_to_user_mode+0x2b/0x60
[   58.997569]  do_syscall_64+0x46/0x80
[   58.998071]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   58.998751] RIP: 0033:0x7fac0740459d
[   58.999243] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   59.000082] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   59.001067] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   59.001986] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   59.002909] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   59.003829] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   59.004749] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   59.005780] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   59.006727] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   59.008092] Call Trace:
[   59.008414]  dump_stack_lvl+0xa4/0xd3
[   59.008884]  dump_stack+0x15/0x17
[   59.009307]  check_preemption_disabled+0x167/0x180
[   59.009906]  ? rcu_gp_fqs_loop+0x2bd/0x410
[   59.010423]  ? rcu_pm_notify+0x40/0x40
[   59.010901]  debug_smp_processor_id+0x1c/0x20
[   59.011449]  perf_ftrace_function_call+0x7c/0x360
[   59.012038]  ? prepare_to_swait_event+0xbb/0xf0
[   59.012608]  ? 0xffffffffa00dc099
[   59.013031]  ? 0xffffffffa00dc099
[   59.013455]  ? 0xffffffffa00dc099
[   59.013888]  ? 0xffffffffa00dc099
[   59.014322]  0xffffffffa00dc099
[   59.014725]  ? trace_hardirqs_on+0x3f/0x170
[   59.015256]  ? preempt_count_sub+0x5/0xa0
[   59.015772]  ? rcu_gp_fqs_check_wake+0x5/0x50
[   59.016317]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[   59.016938]  rcu_gp_fqs_check_wake+0x5/0x50
[   59.017463]  rcu_gp_fqs_loop+0x2bd/0x410
[   59.017958]  ? rcu_gp_fqs_check_wake+0x5/0x50
[   59.018504]  ? rcu_gp_fqs_loop+0x2bd/0x410
[   59.019029]  ? rcu_gp_init+0x730/0x730
[   59.019503]  rcu_gp_kthread+0xdd/0x170
[   59.019984]  kthread+0x1e7/0x230
[   59.020407]  ? set_kthread_struct+0x80/0x80
[   59.020940]  ret_from_fork+0x1f/0x30
[   63.710053] check_preemption_disabled: 1550106 callbacks suppressed
[   63.710070] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   63.711758] caller is debug_smp_processor_id+0x1c/0x20
[   63.712394] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   63.713257] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   63.714598] Call Trace:
[   63.714918]  dump_stack_lvl+0xa4/0xd3
[   63.715398]  dump_stack+0x15/0x17
[   63.715823]  check_preemption_disabled+0x167/0x180
[   63.716438]  debug_smp_processor_id+0x1c/0x20
[   63.716980]  perf_swevent_put_recursion_context+0x1b/0x40
[   63.717647]  perf_tp_event+0x331/0x4e0
[   63.718220]  ? preempt_count_sub+0x5/0xa0
[   63.718743]  ? preempt_count_sub+0x5/0xa0
[   63.719275]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[   63.719924]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   63.720534]  ? ___ratelimit+0x36/0x1e0
[   63.721053]  ? __printk_ratelimit+0x21/0x30
[   63.721604]  ? check_preemption_disabled+0x10e/0x180
[   63.722294]  ? insn_get_sib+0x122/0x140
[   63.722794]  ? insn_get_opcode+0x3b0/0x3b0
[   63.723334]  perf_ftrace_function_call+0x248/0x360
[   63.723943]  ? perf_ftrace_function_call+0x248/0x360
[   63.724681]  ? 0xffffffffa00dc099
[   63.725173]  0xffffffffa00dc099
[   63.725613]  ? 0xffffffffa00dc099
[   63.726081]  ? insn_get_sib+0x43/0x140
[   63.726594]  ? insn_get_modrm+0x5/0x2a0
[   63.727098]  ? write_comp_data+0x2f/0x90
[   63.727619]  insn_get_modrm+0x5/0x2a0
[   63.728097]  insn_get_sib+0x122/0x140
[   63.728577]  ? insn_get_modrm+0x5/0x2a0
[   63.729071]  ? insn_get_sib+0x122/0x140
[   63.729591]  insn_get_displacement+0x157/0x270
[   63.730196]  insn_get_immediate+0x181/0x570
[   63.730763]  insn_get_length+0x75/0x90
[   63.731268]  insn_decode+0x9b/0x170
[   63.731737]  ? fib_validate_source+0x220/0x220
[   63.732319]  text_poke_loc_init+0x63/0x140
[   63.732922]  ? fib_validate_source+0x220/0x220
[   63.733522]  text_poke_queue+0x84/0xc0
[   63.734041]  ftrace_replace_code+0xfd/0x170
[   63.734623]  ftrace_modify_all_code+0x1b1/0x270
[   63.735224]  arch_ftrace_update_code+0x9/0x10
[   63.735786]  ftrace_run_update_code+0x30/0xa0
[   63.736356]  ftrace_shutdown+0x2b8/0x4a0
[   63.736896]  unregister_ftrace_function+0x25/0x50
[   63.737502]  perf_ftrace_event_register+0x89/0xf0
[   63.738114]  ? perf_tp_event_init+0xa0/0xa0
[   63.738666]  perf_trace_destroy+0x37/0x60
[   63.739194]  tp_perf_event_destroy+0x15/0x20
[   63.739752]  _free_event+0xfc/0x7d0
[   63.740238]  put_event+0x37/0x50
[   63.740678]  perf_event_release_kernel+0x2f4/0x370
[   63.741321]  ? perf_event_release_kernel+0x370/0x370
[   63.741964]  perf_release+0x19/0x20
[   63.742441]  __fput+0x12d/0x460
[   63.742908]  ____fput+0x1a/0x20
[   63.743334]  task_work_run+0x8e/0xf0
[   63.743830]  do_exit+0x616/0x1310
[   63.744297]  ? write_comp_data+0x2f/0x90
[   63.744842]  do_group_exit+0x7e/0x130
[   63.745349]  get_signal+0x249/0x13c0
[   63.745839]  ? get_signal+0x5/0x13c0
[   63.746373]  arch_do_signal_or_restart+0xb7/0x7e0
[   63.747031]  ? arch_do_signal_or_restart+0x5/0x7e0
[   63.747688]  exit_to_user_mode_prepare+0x154/0x240
[   63.748318]  syscall_exit_to_user_mode+0x2b/0x60
[   63.748918]  do_syscall_64+0x46/0x80
[   63.749393]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   63.750041] RIP: 0033:0x7fac0740459d
[   63.750520] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   63.751318] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   63.752252] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   63.753121] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   63.753994] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   63.754882] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   63.755753] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   63.756930] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   63.756933] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   63.756962] caller is debug_smp_processor_id+0x1c/0x20
[   63.757903] caller is debug_smp_processor_id+0x1c/0x20
[   63.759186] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   63.761489] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   63.763070] Call Trace:
[   63.763466]  dump_stack_lvl+0xa4/0xd3
[   63.764065]  dump_stack+0x15/0x17
[   63.764586]  check_preemption_disabled+0x167/0x180
[   63.765301]  ? insn_get_modrm+0x12b/0x2a0
[   63.765900]  ? insn_get_prefixes+0x50/0x50
[   63.766547]  debug_smp_processor_id+0x1c/0x20
[   63.767205]  perf_ftrace_function_call+0x7c/0x360
[   63.767922]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   63.768625]  ? insn_get_sib+0x122/0x140
[   63.769212]  ? perf_ftrace_function_call+0x4c/0x360
[   63.770207]  0xffffffffa00dc099
[   63.770765]  ? 0xffffffffa00dc099
[   63.771321]  ? insn_get_modrm+0x49/0x2a0
[   63.771954]  ? insn_get_opcode+0x5/0x3b0
[   63.772554]  ? write_comp_data+0x2f/0x90
[   63.773177]  insn_get_opcode+0x5/0x3b0
[   63.773754]  insn_get_modrm+0x12b/0x2a0
[   63.774347]  ? insn_get_opcode+0x5/0x3b0
[   63.774937]  ? insn_get_modrm+0x12b/0x2a0
[   63.775602]  insn_get_sib+0x122/0x140
[   63.776211]  insn_get_displacement+0x157/0x270
[   63.776924]  insn_get_immediate+0x181/0x570
[   63.777612]  insn_get_length+0x75/0x90
[   63.778227]  insn_decode+0x9b/0x170
[   63.778791]  ? fib_validate_source+0x220/0x220
[   63.779461]  text_poke_loc_init+0x63/0x140
[   63.780235]  ? fib_validate_source+0x220/0x220
[   63.780948]  text_poke_queue+0x84/0xc0
[   63.781578]  ftrace_replace_code+0xfd/0x170
[   63.782270]  ftrace_modify_all_code+0x1b1/0x270
[   63.782993]  arch_ftrace_update_code+0x9/0x10
[   63.783652]  ftrace_run_update_code+0x30/0xa0
[   63.784332]  ftrace_shutdown+0x2b8/0x4a0
[   63.784997]  unregister_ftrace_function+0x25/0x50
[   63.785713]  perf_ftrace_event_register+0x89/0xf0
[   63.786422]  ? perf_tp_event_init+0xa0/0xa0
[   63.787058]  perf_trace_destroy+0x37/0x60
[   63.787682]  tp_perf_event_destroy+0x15/0x20
[   63.788340]  _free_event+0xfc/0x7d0
[   63.788937]  put_event+0x37/0x50
[   63.789467]  perf_event_release_kernel+0x2f4/0x370
[   63.790250]  ? perf_event_release_kernel+0x370/0x370
[   63.791009]  perf_release+0x19/0x20
[   63.791564]  __fput+0x12d/0x460
[   63.792160]  ____fput+0x1a/0x20
[   63.792670]  task_work_run+0x8e/0xf0
[   63.793280]  do_exit+0x616/0x1310
[   63.793857]  ? write_comp_data+0x2f/0x90
[   63.794535]  do_group_exit+0x7e/0x130
[   63.795162]  get_signal+0x249/0x13c0
[   63.795760]  ? get_signal+0x5/0x13c0
[   63.796413]  arch_do_signal_or_restart+0xb7/0x7e0
[   63.797239]  ? arch_do_signal_or_restart+0x5/0x7e0
[   63.798058]  exit_to_user_mode_prepare+0x154/0x240
[   63.798806]  syscall_exit_to_user_mode+0x2b/0x60
[   63.799514]  do_syscall_64+0x46/0x80
[   63.800082]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   63.800829] RIP: 0033:0x7fac0740459d
[   63.801379] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   63.802321] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   63.803413] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   63.804416] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   63.805419] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   63.806427] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   63.807428] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   63.808655] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   63.808767] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   63.809660] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   63.809671] Call Trace:
[   63.810815] caller is debug_smp_processor_id+0x1c/0x20
[   63.812096]  dump_stack_lvl+0xa4/0xd3
[   63.813544]  dump_stack+0x15/0x17
[   63.813975]  check_preemption_disabled+0x167/0x180
[   63.814586]  ? __mutex_lock+0x56/0x9f0
[   63.815065]  ? ___might_sleep+0x170/0x170
[   63.815592]  debug_smp_processor_id+0x1c/0x20
[   63.816146]  perf_ftrace_function_call+0x7c/0x360
[   63.816741]  ? perf_ftrace_function_call+0x4c/0x360
[   63.817364]  ? write_comp_data+0x2f/0x90
[   63.817865]  ? mutex_lock_nested+0x1b/0x20
[   63.818395]  ? mutex_lock_io_nested+0x940/0x940
[   63.818969]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   63.819563]  ? mutex_lock_nested+0x1b/0x20
[   63.820085]  ? perf_ftrace_function_call+0x4c/0x360
[   63.820704]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   63.821300]  ? ftrace_ops_test+0x71/0xc0
[   63.821818]  0xffffffffa00dc099
[   63.822233]  ? 0xffffffffa00dc099
[   63.822658]  ? trace_hardirqs_on+0x6a/0x170
[   63.823192]  ? write_comp_data+0x2f/0x90
[   63.823695]  ? perf_trace_buf_update+0x70/0x70
[   63.824260]  ? do_epoll_wait+0x3b3/0xd80
[   63.824772]  ? __might_sleep+0x5/0x70
[   63.825248]  __might_sleep+0x5/0x70
[   63.825698]  __mutex_lock+0x56/0x9f0
[   63.826161]  ? __might_sleep+0x5/0x70
[   63.826630]  ? __mutex_lock+0x56/0x9f0
[   63.827114]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   63.827791]  ? do_epoll_wait+0x3b3/0xd80
[   63.828295]  ? do_epoll_wait+0x3b3/0xd80
[   63.828802]  ? __mutex_lock+0x5/0x9f0
[   63.829283]  mutex_lock_nested+0x1b/0x20
[   63.829783]  ? __mutex_lock+0x5/0x9f0
[   63.830255]  ? mutex_lock_nested+0x1b/0x20
[   63.830778]  do_epoll_wait+0x3b3/0xd80
[   63.831292]  ? wait_woken+0x90/0x90
[   63.831755]  __x64_sys_epoll_wait+0x8d/0xd0
[   63.832300]  do_syscall_64+0x37/0x80
[   63.832761]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   63.833399] RIP: 0033:0x7f8a39143ae0
[   63.833857] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   63.836101] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   63.837027] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   63.837897] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   63.838771] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   63.839643] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   63.840513] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   63.841418] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   63.841475] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   63.842461] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   63.843502] caller is debug_smp_processor_id+0x1c/0x20
[   63.845056] Call Trace:
[   63.846067]  dump_stack_lvl+0xa4/0xd3
[   63.846672]  dump_stack+0x15/0x17
[   63.847194]  check_preemption_disabled+0x167/0x180
[   63.847969]  debug_smp_processor_id+0x1c/0x20
[   63.848632]  perf_swevent_get_recursion_context+0x1e/0xd0
[   63.849484]  perf_trace_buf_alloc+0x3d/0x100
[   63.850137]  ? insn_get_modrm+0x12b/0x2a0
[   63.850739]  ? insn_get_prefixes+0x50/0x50
[   63.851373]  perf_ftrace_function_call+0x209/0x360
[   63.852104]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   63.852983]  ? 0xffffffffa00dc099
[   63.853620]  0xffffffffa00dc099
[   63.854183]  ? 0xffffffffa00dc099
[   63.854743]  ? insn_get_modrm+0x49/0x2a0
[   63.855376]  ? insn_get_opcode+0x5/0x3b0
[   63.855977]  ? write_comp_data+0x2f/0x90
[   63.856603]  insn_get_opcode+0x5/0x3b0
[   63.857182]  insn_get_modrm+0x12b/0x2a0
[   63.857774]  ? insn_get_opcode+0x5/0x3b0
[   63.858368]  ? insn_get_modrm+0x12b/0x2a0
[   63.859034]  insn_get_sib+0x122/0x140
[   63.859644]  insn_get_displacement+0x157/0x270
[   63.860359]  insn_get_immediate+0x181/0x570
[   63.861050]  insn_get_length+0x75/0x90
[   63.861663]  insn_decode+0x9b/0x170
[   63.862233]  ? fib_validate_source+0x220/0x220
[   63.862906]  text_poke_loc_init+0x63/0x140
[   63.863685]  ? fib_validate_source+0x220/0x220
[   63.864399]  text_poke_queue+0x84/0xc0
[   63.865024]  ftrace_replace_code+0xfd/0x170
[   63.865714]  ftrace_modify_all_code+0x1b1/0x270
[   63.866444]  arch_ftrace_update_code+0x9/0x10
[   63.867103]  ftrace_run_update_code+0x30/0xa0
[   63.867784]  ftrace_shutdown+0x2b8/0x4a0
[   63.868450]  unregister_ftrace_function+0x25/0x50
[   63.869167]  perf_ftrace_event_register+0x89/0xf0
[   63.869875]  ? perf_tp_event_init+0xa0/0xa0
[   63.870517]  perf_trace_destroy+0x37/0x60
[   63.871154]  tp_perf_event_destroy+0x15/0x20
[   63.871815]  _free_event+0xfc/0x7d0
[   63.872416]  put_event+0x37/0x50
[   63.872948]  perf_event_release_kernel+0x2f4/0x370
[   63.873731]  ? perf_event_release_kernel+0x370/0x370
[   63.874501]  perf_release+0x19/0x20
[   63.875057]  __fput+0x12d/0x460
[   63.875655]  ____fput+0x1a/0x20
[   63.876172]  task_work_run+0x8e/0xf0
[   63.876784]  do_exit+0x616/0x1310
[   63.877363]  ? write_comp_data+0x2f/0x90
[   63.878042]  do_group_exit+0x7e/0x130
[   63.878672]  get_signal+0x249/0x13c0
[   63.879272]  ? get_signal+0x5/0x13c0
[   63.879925]  arch_do_signal_or_restart+0xb7/0x7e0
[   63.880750]  ? arch_do_signal_or_restart+0x5/0x7e0
[   63.881565]  exit_to_user_mode_prepare+0x154/0x240
[   63.882307]  syscall_exit_to_user_mode+0x2b/0x60
[   63.883014]  do_syscall_64+0x46/0x80
[   63.883582]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   63.884327] RIP: 0033:0x7fac0740459d
[   63.884877] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   63.885799] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   63.886890] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   63.887893] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   63.888897] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   63.889902] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   63.890909] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   63.892141] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   63.892251] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   63.893143] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   63.894212] caller is debug_smp_processor_id+0x1c/0x20
[   63.895491] Call Trace:
[   63.895500]  dump_stack_lvl+0xa4/0xd3
[   63.896925]  dump_stack+0x15/0x17
[   63.897354]  check_preemption_disabled+0x167/0x180
[   63.897958]  ? __might_sleep+0x48/0x70
[   63.898447]  ? sched_show_task+0x70/0x70
[   63.898950]  debug_smp_processor_id+0x1c/0x20
[   63.899502]  perf_ftrace_function_call+0x7c/0x360
[   63.900094]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   63.900688]  ? __mutex_lock+0x56/0x9f0
[   63.901168]  ? perf_ftrace_function_call+0x4c/0x360
[   63.901780]  ? perf_ftrace_function_call+0x4c/0x360
[   63.902399]  ? write_comp_data+0x2f/0x90
[   63.902899]  ? mutex_lock_nested+0x1b/0x20
[   63.903419]  ? mutex_lock_io_nested+0x940/0x940
[   63.903992]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   63.904586]  ? mutex_lock_nested+0x1b/0x20
[   63.905108]  ? perf_ftrace_function_call+0x4c/0x360
[   63.905724]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   63.906323]  ? ftrace_ops_test+0x71/0xc0
[   63.906833]  0xffffffffa00dc099
[   63.907245]  ? 0xffffffffa00dc099
[   63.907677]  ? trace_hardirqs_on+0x6a/0x170
[   63.908210]  ? do_epoll_wait+0x3b3/0xd80
[   63.908720]  ? ___might_sleep+0x5/0x170
[   63.909216]  ___might_sleep+0x5/0x170
[   63.909686]  __might_sleep+0x48/0x70
[   63.910148]  ? ___might_sleep+0x5/0x170
[   63.910637]  ? __might_sleep+0x48/0x70
[   63.911122]  __mutex_lock+0x56/0x9f0
[   63.911585]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   63.912260]  ? do_epoll_wait+0x3b3/0xd80
[   63.912762]  ? do_epoll_wait+0x3b3/0xd80
[   63.913269]  ? __mutex_lock+0x5/0x9f0
[   63.913751]  mutex_lock_nested+0x1b/0x20
[   63.914252]  ? __mutex_lock+0x5/0x9f0
[   63.914720]  ? mutex_lock_nested+0x1b/0x20
[   63.915242]  do_epoll_wait+0x3b3/0xd80
[   63.915750]  ? wait_woken+0x90/0x90
[   63.916212]  __x64_sys_epoll_wait+0x8d/0xd0
[   63.916756]  do_syscall_64+0x37/0x80
[   63.917218]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   63.917852] RIP: 0033:0x7f8a39143ae0
[   63.918312] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   63.920547] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   63.921475] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   63.922349] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   63.923226] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   63.924096] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   63.924966] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   63.925871] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   63.925902] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   63.926827] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   63.926843] Call Trace:
[   63.927869] caller is debug_smp_processor_id+0x1c/0x20
[   63.929316]  dump_stack_lvl+0xa4/0xd3
[   63.930785]  dump_stack+0x15/0x17
[   63.931251]  check_preemption_disabled+0x167/0x180
[   63.931926]  debug_smp_processor_id+0x1c/0x20
[   63.932522]  perf_trace_buf_alloc+0x98/0x100
[   63.933107]  ? insn_get_modrm+0x12b/0x2a0
[   63.933652]  ? insn_get_prefixes+0x50/0x50
[   63.934220]  perf_ftrace_function_call+0x209/0x360
[   63.934970]  ? 0xffffffffa00dc099
[   63.935489]  0xffffffffa00dc099
[   63.935961]  ? 0xffffffffa00dc099
[   63.936442]  ? insn_get_modrm+0x49/0x2a0
[   63.936996]  ? insn_get_opcode+0x5/0x3b0
[   63.937537]  ? write_comp_data+0x2f/0x90
[   63.938095]  insn_get_opcode+0x5/0x3b0
[   63.938618]  insn_get_modrm+0x12b/0x2a0
[   63.939149]  ? insn_get_opcode+0x5/0x3b0
[   63.939683]  ? insn_get_modrm+0x12b/0x2a0
[   63.940260]  insn_get_sib+0x122/0x140
[   63.940790]  insn_get_displacement+0x157/0x270
[   63.941416]  insn_get_immediate+0x181/0x570
[   63.942015]  insn_get_length+0x75/0x90
[   63.942553]  insn_decode+0x9b/0x170
[   63.943049]  ? fib_validate_source+0x220/0x220
[   63.943652]  text_poke_loc_init+0x63/0x140
[   63.944287]  ? fib_validate_source+0x220/0x220
[   63.944938]  text_poke_queue+0x84/0xc0
[   63.945484]  ftrace_replace_code+0xfd/0x170
[   63.946087]  ftrace_modify_all_code+0x1b1/0x270
[   63.946729]  arch_ftrace_update_code+0x9/0x10
[   63.947326]  ftrace_run_update_code+0x30/0xa0
[   63.947930]  ftrace_shutdown+0x2b8/0x4a0
[   63.948501]  unregister_ftrace_function+0x25/0x50
[   63.949143]  perf_ftrace_event_register+0x89/0xf0
[   63.949781]  ? perf_tp_event_init+0xa0/0xa0
[   63.950356]  perf_trace_destroy+0x37/0x60
[   63.950912]  tp_perf_event_destroy+0x15/0x20
[   63.951500]  _free_event+0xfc/0x7d0
[   63.952012]  put_event+0x37/0x50
[   63.952477]  perf_event_release_kernel+0x2f4/0x370
[   63.953156]  ? perf_event_release_kernel+0x370/0x370
[   63.953834]  perf_release+0x19/0x20
[   63.954329]  __fput+0x12d/0x460
[   63.954821]  ____fput+0x1a/0x20
[   63.955270]  task_work_run+0x8e/0xf0
[   63.955794]  do_exit+0x616/0x1310
[   63.956286]  ? write_comp_data+0x2f/0x90
[   63.956863]  do_group_exit+0x7e/0x130
[   63.957399]  get_signal+0x249/0x13c0
[   63.957916]  ? get_signal+0x5/0x13c0
[   63.958461]  arch_do_signal_or_restart+0xb7/0x7e0
[   63.959155]  ? arch_do_signal_or_restart+0x5/0x7e0
[   63.959849]  exit_to_user_mode_prepare+0x154/0x240
[   63.960506]  syscall_exit_to_user_mode+0x2b/0x60
[   63.961138]  do_syscall_64+0x46/0x80
[   63.961640]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   63.962319] RIP: 0033:0x7fac0740459d
[   63.962812] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   63.963655] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   63.964643] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   63.965564] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   63.966494] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   63.967415] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   63.968336] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   63.969367] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   63.969474] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   63.970375] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   63.970385] Call Trace:
[   63.970393]  dump_stack_lvl+0xa4/0xd3
[   63.970414]  dump_stack+0x15/0x17
[   63.970429]  check_preemption_disabled+0x167/0x180
[   63.970447]  ? __mutex_lock+0x7b/0x9f0
[   63.971436] caller is debug_smp_processor_id+0x1c/0x20
[   63.972807]  ? trace_sched_waking+0xc0/0xc0
[   63.976197]  debug_smp_processor_id+0x1c/0x20
[   63.976762]  perf_ftrace_function_call+0x7c/0x360
[   63.977359]  ? perf_ftrace_function_call+0x4c/0x360
[   63.977976]  ? write_comp_data+0x2f/0x90
[   63.978484]  ? mutex_lock_nested+0x1b/0x20
[   63.979005]  ? mutex_lock_io_nested+0x940/0x940
[   63.979579]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   63.980174]  ? mutex_lock_nested+0x1b/0x20
[   63.980697]  ? perf_ftrace_function_call+0x4c/0x360
[   63.981314]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   63.981912]  ? ftrace_ops_test+0x71/0xc0
[   63.982432]  0xffffffffa00dc099
[   63.982843]  ? __this_cpu_preempt_check+0x1c/0x20
[   63.983441]  ? lock_is_held_type+0xe2/0x140
[   63.983980]  ? do_epoll_wait+0x3b3/0xd80
[   63.984493]  ? preempt_count_add+0x5/0xc0
[   63.985011]  preempt_count_add+0x5/0xc0
[   63.985502]  __mutex_lock+0x7b/0x9f0
[   63.985964]  ? preempt_count_add+0x5/0xc0
[   63.986477]  ? __mutex_lock+0x7b/0x9f0
[   63.986962]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   63.987640]  ? do_epoll_wait+0x3b3/0xd80
[   63.988145]  ? do_epoll_wait+0x3b3/0xd80
[   63.988653]  ? __mutex_lock+0x5/0x9f0
[   63.989138]  mutex_lock_nested+0x1b/0x20
[   63.989639]  ? __mutex_lock+0x5/0x9f0
[   63.990111]  ? mutex_lock_nested+0x1b/0x20
[   63.990639]  do_epoll_wait+0x3b3/0xd80
[   63.991149]  ? wait_woken+0x90/0x90
[   63.991612]  __x64_sys_epoll_wait+0x8d/0xd0
[   63.992159]  do_syscall_64+0x37/0x80
[   63.992621]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   63.993258] RIP: 0033:0x7f8a39143ae0
[   63.993722] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   63.995976] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   63.996908] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   63.997780] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   63.998656] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   63.999528] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   64.000400] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   64.001306] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   64.001340] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   64.002267] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   64.002283] Call Trace:
[   64.003313] caller is debug_smp_processor_id+0x1c/0x20
[   64.004772]  dump_stack_lvl+0xa4/0xd3
[   64.006257]  dump_stack+0x15/0x17
[   64.006724]  check_preemption_disabled+0x167/0x180
[   64.007397]  debug_smp_processor_id+0x1c/0x20
[   64.007991]  perf_swevent_put_recursion_context+0x1b/0x40
[   64.008723]  perf_tp_event+0x331/0x4e0
[   64.009397]  ? arch_local_irq_enable+0x10/0x12
[   64.010000]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   64.010655]  ? dump_stack_lvl+0xcc/0xd3
[   64.011199]  ? dump_stack+0x15/0x17
[   64.011683]  ? check_preemption_disabled+0x167/0x180
[   64.012373]  ? insn_get_modrm+0x12b/0x2a0
[   64.012916]  ? insn_get_prefixes+0x50/0x50
[   64.013486]  perf_ftrace_function_call+0x248/0x360
[   64.014139]  ? perf_ftrace_function_call+0x248/0x360
[   64.014925]  ? 0xffffffffa00dc099
[   64.015444]  0xffffffffa00dc099
[   64.015913]  ? 0xffffffffa00dc099
[   64.016392]  ? insn_get_modrm+0x49/0x2a0
[   64.016945]  ? insn_get_opcode+0x5/0x3b0
[   64.017482]  ? write_comp_data+0x2f/0x90
[   64.018030]  insn_get_opcode+0x5/0x3b0
[   64.018556]  insn_get_modrm+0x12b/0x2a0
[   64.019083]  ? insn_get_opcode+0x5/0x3b0
[   64.019615]  ? insn_get_modrm+0x12b/0x2a0
[   64.020188]  insn_get_sib+0x122/0x140
[   64.020714]  insn_get_displacement+0x157/0x270
[   64.021335]  insn_get_immediate+0x181/0x570
[   64.021931]  insn_get_length+0x75/0x90
[   64.022466]  insn_decode+0x9b/0x170
[   64.022960]  ? fib_validate_source+0x220/0x220
[   64.023561]  text_poke_loc_init+0x63/0x140
[   64.024194]  ? fib_validate_source+0x220/0x220
[   64.024817]  text_poke_queue+0x84/0xc0
[   64.025357]  ftrace_replace_code+0xfd/0x170
[   64.025967]  ftrace_modify_all_code+0x1b1/0x270
[   64.026606]  arch_ftrace_update_code+0x9/0x10
[   64.027198]  ftrace_run_update_code+0x30/0xa0
[   64.027800]  ftrace_shutdown+0x2b8/0x4a0
[   64.028369]  unregister_ftrace_function+0x25/0x50
[   64.029009]  perf_ftrace_event_register+0x89/0xf0
[   64.029645]  ? perf_tp_event_init+0xa0/0xa0
[   64.030218]  perf_trace_destroy+0x37/0x60
[   64.030907]  tp_perf_event_destroy+0x15/0x20
[   64.031541]  _free_event+0xfc/0x7d0
[   64.032055]  put_event+0x37/0x50
[   64.032519]  perf_event_release_kernel+0x2f4/0x370
[   64.033198]  ? perf_event_release_kernel+0x370/0x370
[   64.033877]  perf_release+0x19/0x20
[   64.034372]  __fput+0x12d/0x460
[   64.034863]  ____fput+0x1a/0x20
[   64.035313]  task_work_run+0x8e/0xf0
[   64.035836]  do_exit+0x616/0x1310
[   64.036329]  ? write_comp_data+0x2f/0x90
[   64.036906]  do_group_exit+0x7e/0x130
[   64.037440]  get_signal+0x249/0x13c0
[   64.037956]  ? get_signal+0x5/0x13c0
[   64.038503]  arch_do_signal_or_restart+0xb7/0x7e0
[   64.039198]  ? arch_do_signal_or_restart+0x5/0x7e0
[   64.039893]  exit_to_user_mode_prepare+0x154/0x240
[   64.040550]  syscall_exit_to_user_mode+0x2b/0x60
[   64.041182]  do_syscall_64+0x46/0x80
[   64.041684]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   64.042361] RIP: 0033:0x7fac0740459d
[   64.042851] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   64.043689] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   64.044673] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   64.045590] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   64.046511] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   64.047426] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   64.048338] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   64.049364] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   64.049480] BUG: using smp_processor_id() in preemptible [00000000] code: repro/572
[   64.050376] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   64.050387] Call Trace:
[   64.050395]  dump_stack_lvl+0xa4/0xd3
[   64.050417]  dump_stack+0x15/0x17
[   64.050431]  check_preemption_disabled+0x167/0x180
[   64.050449]  ? do_epoll_wait+0x3bf/0xd80
[   64.050465]  ? __ia32_sys_fanotify_init+0x5c0/0x5c0
[   64.051513] caller is debug_smp_processor_id+0x1c/0x20
[   64.052885]  debug_smp_processor_id+0x1c/0x20
[   64.056931]  perf_ftrace_function_call+0x7c/0x360
[   64.057534]  ? 0xffffffffa00dc099
[   64.057972]  ? do_epoll_wait+0x3b3/0xd80
[   64.058486]  ? preempt_count_sub+0x5/0xa0
[   64.059008]  0xffffffffa00dc099
[   64.059413]  ? __mutex_lock+0xfe/0x9f0
[   64.059896]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   64.060574]  ? do_epoll_wait+0x3b3/0xd80
[   64.061083]  ? ep_start_scan+0x5/0x100
[   64.061571]  ep_start_scan+0x5/0x100
[   64.062033]  do_epoll_wait+0x3bf/0xd80
[   64.062519]  ? ep_start_scan+0x5/0x100
[   64.062998]  ? do_epoll_wait+0x3bf/0xd80
[   64.063526]  ? wait_woken+0x90/0x90
[   64.063987]  __x64_sys_epoll_wait+0x8d/0xd0
[   64.064531]  do_syscall_64+0x37/0x80
[   64.064992]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   64.065628] RIP: 0033:0x7f8a39143ae0
[   64.066084] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   64.068326] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   64.069257] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   64.070132] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   64.071002] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   64.071870] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   64.072740] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   64.073647] CPU: 0 PID: 572 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   64.074711] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   64.076294] Call Trace:
[   64.076692]  dump_stack_lvl+0xa4/0xd3
[   64.077292]  dump_stack+0x15/0x17
[   64.077812]  check_preemption_disabled+0x167/0x180
[   64.078534]  ? insn_get_opcode+0x1d5/0x3b0
[   64.079144]  ? insn_decode_from_regs+0x110/0x110
[   64.079854]  debug_smp_processor_id+0x1c/0x20
[   64.080513]  perf_ftrace_function_call+0x7c/0x360
[   64.081231]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   64.081932]  ? insn_get_modrm+0x12b/0x2a0
[   64.082547]  ? perf_ftrace_function_call+0x4c/0x360
[   64.083542]  0xffffffffa00dc099
[   64.084103]  ? 0xffffffffa00dc099
[   64.084658]  ? insn_get_opcode+0x49/0x3b0
[   64.085305]  ? insn_get_prefixes.part.1+0x5/0x650
[   64.086006]  ? write_comp_data+0x2f/0x90
[   64.086633]  insn_get_prefixes.part.1+0x5/0x650
[   64.087316]  insn_get_opcode+0x1d5/0x3b0
[   64.087916]  ? insn_get_prefixes.part.1+0x5/0x650
[   64.088612]  ? insn_get_opcode+0x1d5/0x3b0
[   64.089287]  insn_get_modrm+0x12b/0x2a0
[   64.089931]  insn_get_sib+0x122/0x140
[   64.090544]  insn_get_displacement+0x157/0x270
[   64.091255]  insn_get_immediate+0x181/0x570
[   64.091943]  insn_get_length+0x75/0x90
[   64.092552]  insn_decode+0x9b/0x170
[   64.093116]  ? fib_validate_source+0x220/0x220
[   64.093786]  text_poke_loc_init+0x63/0x140
[   64.094567]  ? fib_validate_source+0x220/0x220
[   64.095279]  text_poke_queue+0x84/0xc0
[   64.095903]  ftrace_replace_code+0xfd/0x170
[   64.096593]  ftrace_modify_all_code+0x1b1/0x270
[   64.097317]  arch_ftrace_update_code+0x9/0x10
[   64.097975]  ftrace_run_update_code+0x30/0xa0
[   64.098659]  ftrace_shutdown+0x2b8/0x4a0
[   64.099327]  unregister_ftrace_function+0x25/0x50
[   64.100042]  perf_ftrace_event_register+0x89/0xf0
[   64.100748]  ? perf_tp_event_init+0xa0/0xa0
[   64.101383]  perf_trace_destroy+0x37/0x60
[   64.102008]  tp_perf_event_destroy+0x15/0x20
[   64.102673]  _free_event+0xfc/0x7d0
[   64.103272]  put_event+0x37/0x50
[   64.103803]  perf_event_release_kernel+0x2f4/0x370
[   64.104585]  ? perf_event_release_kernel+0x370/0x370
[   64.105346]  perf_release+0x19/0x20
[   64.105901]  __fput+0x12d/0x460
[   64.106501]  ____fput+0x1a/0x20
[   64.107013]  task_work_run+0x8e/0xf0
[   64.107624]  do_exit+0x616/0x1310
[   64.108201]  ? write_comp_data+0x2f/0x90
[   64.108878]  do_group_exit+0x7e/0x130
[   64.109501]  get_signal+0x249/0x13c0
[   64.110101]  ? get_signal+0x5/0x13c0
[   64.110757]  arch_do_signal_or_restart+0xb7/0x7e0
[   64.111581]  ? arch_do_signal_or_restart+0x5/0x7e0
[   64.112395]  exit_to_user_mode_prepare+0x154/0x240
[   64.113137]  syscall_exit_to_user_mode+0x2b/0x60
[   64.113847]  do_syscall_64+0x46/0x80
[   64.114418]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   64.115162] RIP: 0033:0x7fac0740459d
[   64.115713] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   64.116632] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   64.117720] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   64.118728] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   64.119740] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   64.120748] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   64.121751] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   68.714069] check_preemption_disabled: 3352082 callbacks suppressed
[   68.714089] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   68.714513] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[   68.715035] caller is debug_smp_processor_id+0x1c/0x20
[   68.715963] caller is debug_smp_processor_id+0x1c/0x20
[   68.717031] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   68.719407] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   68.721004] Call Trace:
[   68.721407]  dump_stack_lvl+0xa4/0xd3
[   68.722017]  dump_stack+0x15/0x17
[   68.722553]  check_preemption_disabled+0x167/0x180
[   68.723336]  debug_smp_processor_id+0x1c/0x20
[   68.724005]  perf_swevent_get_recursion_context+0x1e/0xd0
[   68.724871]  perf_trace_buf_alloc+0x3d/0x100
[   68.725531]  ? copy_from_kernel_nofault+0x2f/0x220
[   68.726275]  ? cea_set_pte+0x140/0x140
[   68.726879]  perf_ftrace_function_call+0x209/0x360
[   68.727814]  ? 0xffffffffa0098099
[   68.728423]  ? memdup_user+0xc0/0xc0
[   68.729002]  0xffffffffa0098099
[   68.729598]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[   68.730399]  ? ftrace_get_addr_curr+0x1a8/0x280
[   68.731100]  ? memdup_user+0xc0/0xc0
[   68.731661]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[   68.732456]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[   68.733251]  ? ftrace_get_addr_curr+0x1a8/0x280
[   68.733940]  copy_from_kernel_nofault_allowed+0x5/0x80
[   68.734716]  copy_from_kernel_nofault+0x2f/0x220
[   68.735420]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[   68.736203]  ? copy_from_kernel_nofault+0x2f/0x220
[   68.737007]  ftrace_verify_code+0x2c/0x70
[   68.737660]  ftrace_replace_code+0x69/0x170
[   68.738367]  ftrace_modify_all_code+0x1b1/0x270
[   68.739100]  arch_ftrace_update_code+0x9/0x10
[   68.739767]  ftrace_run_update_code+0x30/0xa0
[   68.740457]  ftrace_startup_enable+0x5e/0xa0
[   68.741134]  ftrace_startup+0x16d/0x240
[   68.741809]  register_ftrace_function+0x43/0x90
[   68.742524]  perf_ftrace_event_register+0xc1/0xf0
[   68.743261]  perf_trace_event_init+0xa0/0x4c0
[   68.743984]  perf_trace_init+0xda/0x160
[   68.744627]  perf_tp_event_init+0x57/0xa0
[   68.745270]  perf_try_init_event+0x83/0x270
[   68.745980]  perf_event_alloc+0xe3f/0x1c10
[   68.746607]  ? _raw_spin_unlock+0x2c/0x50
[   68.747245]  ? alloc_fd+0x20d/0x320
[   68.747906]  __do_sys_perf_event_open+0x3bf/0x1de0
[   68.748656]  ? write_comp_data+0x2f/0x90
[   68.749613]  __x64_sys_perf_event_open+0x26/0x30
[   68.750331]  do_syscall_64+0x37/0x80
[   68.750905]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   68.751660] RIP: 0033:0x7fac0740459d
[   68.752219] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   68.754786] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   68.755886] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   68.756903] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   68.757920] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   68.758936] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   68.759950] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   68.761193] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   68.761423] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   68.762092] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   68.762103] Call Trace:
[   68.762111]  dump_stack_lvl+0xa4/0xd3
[   68.762137]  dump_stack+0x15/0x17
[   68.762151]  check_preemption_disabled+0x167/0x180
[   68.762169]  ? do_nanosleep+0x123/0x2a0
[   68.762183]  ? ___might_sleep+0x170/0x170
[   68.763164] caller is debug_smp_processor_id+0x1c/0x20
[   68.764525]  debug_smp_processor_id+0x1c/0x20
[   68.768391]  perf_ftrace_function_call+0x7c/0x360
[   68.768984]  ? 0xffffffffa0098099
[   68.769406]  ? __this_cpu_preempt_check+0x1c/0x20
[   68.770007]  ? finish_task_switch+0xab/0x2a0
[   68.770545]  ? __schedule+0x46e/0xb20
[   68.771031]  ? do_nanosleep+0x9c/0x2a0
[   68.771508]  0xffffffffa0098099
[   68.771912]  ? finish_task_switch+0xb0/0x2a0
[   68.772456]  ? do_nanosleep+0x107/0x2a0
[   68.772945]  ? __might_sleep+0x5/0x70
[   68.773409]  ? write_comp_data+0x2f/0x90
[   68.773906]  __might_sleep+0x5/0x70
[   68.774353]  do_nanosleep+0x123/0x2a0
[   68.774817]  ? __might_sleep+0x5/0x70
[   68.775278]  ? do_nanosleep+0x123/0x2a0
[   68.775762]  ? write_comp_data+0x2f/0x90
[   68.776266]  hrtimer_nanosleep+0xf7/0x1b0
[   68.776780]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[   68.777362]  __x64_sys_nanosleep+0xfc/0x150
[   68.777899]  do_syscall_64+0x37/0x80
[   68.778358]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   68.778992] RIP: 0033:0x7fac073cca18
[   68.779444] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[   68.781655] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[   68.782578] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[   68.783438] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[   68.784298] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[   68.785157] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[   68.786018] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   68.786916] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   68.786955] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[   68.787876] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   68.788782] caller is debug_smp_processor_id+0x1c/0x20
[   68.790243] Call Trace:
[   68.790260]  dump_stack_lvl+0xa4/0xd3
[   68.791719]  dump_stack+0x15/0x17
[   68.792190]  check_preemption_disabled+0x167/0x180
[   68.792875]  debug_smp_processor_id+0x1c/0x20
[   68.793478]  perf_trace_buf_alloc+0x98/0x100
[   68.794070]  ? copy_from_kernel_nofault+0x2f/0x220
[   68.794724]  ? cea_set_pte+0x140/0x140
[   68.795254]  perf_ftrace_function_call+0x209/0x360
[   68.796012]  ? 0xffffffffa0098099
[   68.796520]  ? memdup_user+0xc0/0xc0
[   68.797029]  0xffffffffa0098099
[   68.797521]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[   68.798247]  ? ftrace_get_addr_curr+0x1a8/0x280
[   68.798877]  ? memdup_user+0xc0/0xc0
[   68.799380]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[   68.800103]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[   68.800825]  ? ftrace_get_addr_curr+0x1a8/0x280
[   68.801448]  copy_from_kernel_nofault_allowed+0x5/0x80
[   68.802151]  copy_from_kernel_nofault+0x2f/0x220
[   68.802787]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[   68.803504]  ? copy_from_kernel_nofault+0x2f/0x220
[   68.804199]  ftrace_verify_code+0x2c/0x70
[   68.804774]  ftrace_replace_code+0x69/0x170
[   68.805381]  ftrace_modify_all_code+0x1b1/0x270
[   68.806028]  arch_ftrace_update_code+0x9/0x10
[   68.806635]  ftrace_run_update_code+0x30/0xa0
[   68.807247]  ftrace_startup_enable+0x5e/0xa0
[   68.807849]  ftrace_startup+0x16d/0x240
[   68.808424]  register_ftrace_function+0x43/0x90
[   68.809059]  perf_ftrace_event_register+0xc1/0xf0
[   68.809719]  perf_trace_event_init+0xa0/0x4c0
[   68.810351]  perf_trace_init+0xda/0x160
[   68.810912]  perf_tp_event_init+0x57/0xa0
[   68.811479]  perf_try_init_event+0x83/0x270
[   68.812101]  perf_event_alloc+0xe3f/0x1c10
[   68.812664]  ? _raw_spin_unlock+0x2c/0x50
[   68.813228]  ? alloc_fd+0x20d/0x320
[   68.813772]  __do_sys_perf_event_open+0x3bf/0x1de0
[   68.814441]  ? write_comp_data+0x2f/0x90
[   68.815160]  __x64_sys_perf_event_open+0x26/0x30
[   68.815800]  do_syscall_64+0x37/0x80
[   68.816308]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   68.816995] RIP: 0033:0x7fac0740459d
[   68.817495] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   68.819887] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   68.820888] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   68.821821] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   68.822756] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   68.823690] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   68.824625] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   68.825670] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   68.825842] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   68.826560] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   68.826569] Call Trace:
[   68.826576]  dump_stack_lvl+0xa4/0xd3
[   68.826597]  dump_stack+0x15/0x17
[   68.826611]  check_preemption_disabled+0x167/0x180
[   68.826628]  ? __might_sleep+0x48/0x70
[   68.826641]  ? sched_show_task+0x70/0x70
[   68.827627] caller is debug_smp_processor_id+0x1c/0x20
[   68.828982]  debug_smp_processor_id+0x1c/0x20
[   68.832810]  perf_ftrace_function_call+0x7c/0x360
[   68.833394]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   68.833978]  ? do_nanosleep+0x123/0x2a0
[   68.834471]  ? perf_ftrace_function_call+0x4c/0x360
[   68.835084]  ? 0xffffffffa0098099
[   68.835504]  ? __this_cpu_preempt_check+0x1c/0x20
[   68.836104]  ? finish_task_switch+0xab/0x2a0
[   68.836636]  ? __schedule+0x46e/0xb20
[   68.837104]  ? do_nanosleep+0x9c/0x2a0
[   68.837580]  0xffffffffa0098099
[   68.837979]  ? do_nanosleep+0x9c/0x2a0
[   68.838475]  ? do_nanosleep+0x107/0x2a0
[   68.838963]  ? ___might_sleep+0x5/0x170
[   68.839452]  ___might_sleep+0x5/0x170
[   68.839913]  __might_sleep+0x48/0x70
[   68.840365]  ? ___might_sleep+0x5/0x170
[   68.840846]  ? __might_sleep+0x48/0x70
[   68.841322]  do_nanosleep+0x123/0x2a0
[   68.841784]  ? write_comp_data+0x2f/0x90
[   68.842298]  hrtimer_nanosleep+0xf7/0x1b0
[   68.842813]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[   68.843392]  __x64_sys_nanosleep+0xfc/0x150
[   68.843927]  do_syscall_64+0x37/0x80
[   68.844381]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   68.845005] RIP: 0033:0x7fac073cca18
[   68.845455] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[   68.847667] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[   68.848581] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[   68.849439] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[   68.850300] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[   68.851157] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[   68.852016] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   68.852909] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   68.852934] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[   68.853869] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   68.854797] caller is debug_smp_processor_id+0x1c/0x20
[   68.856240] Call Trace:
[   68.857201]  dump_stack_lvl+0xa4/0xd3
[   68.857733]  dump_stack+0x15/0x17
[   68.858207]  check_preemption_disabled+0x167/0x180
[   68.858893]  debug_smp_processor_id+0x1c/0x20
[   68.859495]  perf_swevent_put_recursion_context+0x1b/0x40
[   68.860236]  perf_tp_event+0x331/0x4e0
[   68.860911]  ? arch_local_irq_enable+0x10/0x12
[   68.861527]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   68.862187]  ? dump_stack_lvl+0xcc/0xd3
[   68.862738]  ? dump_stack+0x15/0x17
[   68.863228]  ? check_preemption_disabled+0x167/0x180
[   68.863934]  ? copy_from_kernel_nofault+0x2f/0x220
[   68.864584]  ? cea_set_pte+0x140/0x140
[   68.865119]  perf_ftrace_function_call+0x248/0x360
[   68.865771]  ? perf_ftrace_function_call+0x248/0x360
[   68.866569]  ? 0xffffffffa0098099
[   68.867077]  ? memdup_user+0xc0/0xc0
[   68.867586]  0xffffffffa0098099
[   68.868075]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[   68.868796]  ? ftrace_get_addr_curr+0x1a8/0x280
[   68.869422]  ? memdup_user+0xc0/0xc0
[   68.869923]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[   68.870646]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[   68.871366]  ? ftrace_get_addr_curr+0x1a8/0x280
[   68.871987]  copy_from_kernel_nofault_allowed+0x5/0x80
[   68.872685]  copy_from_kernel_nofault+0x2f/0x220
[   68.873320]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[   68.874035]  ? copy_from_kernel_nofault+0x2f/0x220
[   68.874733]  ftrace_verify_code+0x2c/0x70
[   68.875311]  ftrace_replace_code+0x69/0x170
[   68.875914]  ftrace_modify_all_code+0x1b1/0x270
[   68.876557]  arch_ftrace_update_code+0x9/0x10
[   68.877158]  ftrace_run_update_code+0x30/0xa0
[   68.877770]  ftrace_startup_enable+0x5e/0xa0
[   68.878374]  ftrace_startup+0x16d/0x240
[   68.878947]  register_ftrace_function+0x43/0x90
[   68.879581]  perf_ftrace_event_register+0xc1/0xf0
[   68.880236]  perf_trace_event_init+0xa0/0x4c0
[   68.880865]  perf_trace_init+0xda/0x160
[   68.881423]  perf_tp_event_init+0x57/0xa0
[   68.881992]  perf_try_init_event+0x83/0x270
[   68.882614]  perf_event_alloc+0xe3f/0x1c10
[   68.883178]  ? _raw_spin_unlock+0x2c/0x50
[   68.883747]  ? alloc_fd+0x20d/0x320
[   68.884292]  __do_sys_perf_event_open+0x3bf/0x1de0
[   68.884957]  ? write_comp_data+0x2f/0x90
[   68.885676]  __x64_sys_perf_event_open+0x26/0x30
[   68.886319]  do_syscall_64+0x37/0x80
[   68.886827]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   68.887513] RIP: 0033:0x7fac0740459d
[   68.888011] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   68.890396] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   68.891396] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   68.892327] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   68.893259] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   68.894196] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   68.895128] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   68.896174] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   68.896283] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   68.897058] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   68.898217] caller is debug_smp_processor_id+0x1c/0x20
[   68.899473] Call Trace:
[   68.899481]  dump_stack_lvl+0xa4/0xd3
[   68.900955]  dump_stack+0x15/0x17
[   68.901377]  check_preemption_disabled+0x167/0x180
[   68.901973]  ? do_nanosleep+0x155/0x2a0
[   68.902459]  ? hrtimer_wakeup+0x40/0x40
[   68.902948]  debug_smp_processor_id+0x1c/0x20
[   68.903494]  perf_ftrace_function_call+0x7c/0x360
[   68.904087]  ? 0xffffffffa0098099
[   68.904507]  ? __this_cpu_preempt_check+0x1c/0x20
[   68.905106]  ? finish_task_switch+0xab/0x2a0
[   68.905638]  ? __schedule+0x46e/0xb20
[   68.906106]  ? do_nanosleep+0x9c/0x2a0
[   68.906589]  ? do_nanosleep+0x9c/0x2a0
[   68.907065]  0xffffffffa0098099
[   68.907475]  ? __this_cpu_preempt_check+0x1c/0x20
[   68.908063]  ? lock_is_held_type+0xe2/0x140
[   68.908591]  ? do_nanosleep+0x140/0x2a0
[   68.909081]  ? hrtimer_try_to_cancel+0x5/0x290
[   68.909637]  ? write_comp_data+0x2f/0x90
[   68.910136]  hrtimer_try_to_cancel+0x5/0x290
[   68.910678]  do_nanosleep+0x155/0x2a0
[   68.911141]  ? hrtimer_try_to_cancel+0x5/0x290
[   68.911695]  ? do_nanosleep+0x155/0x2a0
[   68.912176]  ? write_comp_data+0x2f/0x90
[   68.912679]  hrtimer_nanosleep+0xf7/0x1b0
[   68.913193]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[   68.913773]  __x64_sys_nanosleep+0xfc/0x150
[   68.914313]  do_syscall_64+0x37/0x80
[   68.914767]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   68.915391] RIP: 0033:0x7fac073cca18
[   68.915840] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[   68.918045] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[   68.918969] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[   68.919829] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[   68.920685] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[   68.921543] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[   68.922403] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   68.923297] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   68.923335] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[   68.924335] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   68.925244] caller is debug_smp_processor_id+0x1c/0x20
[   68.926815] Call Trace:
[   68.926847]  dump_stack_lvl+0xa4/0xd3
[   68.928392]  dump_stack+0x15/0x17
[   68.928919]  check_preemption_disabled+0x167/0x180
[   68.929644]  ? ftrace_verify_code+0x2c/0x70
[   68.930282]  ? copy_to_user_nofault+0x150/0x150
[   68.930994]  debug_smp_processor_id+0x1c/0x20
[   68.931667]  perf_ftrace_function_call+0x7c/0x360
[   68.932490]  ? 0xffffffffa0098099
[   68.933095]  ? memdup_user+0xc0/0xc0
[   68.933667]  ? 0xffffffffa0098099
[   68.934278]  0xffffffffa0098099
[   68.934774]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[   68.935566]  ? ftrace_get_addr_curr+0x1a8/0x280
[   68.936265]  ? memdup_user+0xc0/0xc0
[   68.936815]  ? memdup_user+0xc0/0xc0
[   68.937385]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[   68.938181]  ? ftrace_get_addr_curr+0x1a8/0x280
[   68.938866]  ? strndup_user+0xb0/0xb0
[   68.939454]  ? copy_from_kernel_nofault+0x5/0x220
[   68.940210]  copy_from_kernel_nofault+0x5/0x220
[   68.940901]  ftrace_verify_code+0x2c/0x70
[   68.941520]  ? copy_from_kernel_nofault+0x5/0x220
[   68.942224]  ? ftrace_verify_code+0x2c/0x70
[   68.942897]  ftrace_replace_code+0x69/0x170
[   68.943593]  ftrace_modify_all_code+0x1b1/0x270
[   68.944324]  arch_ftrace_update_code+0x9/0x10
[   68.944990]  ftrace_run_update_code+0x30/0xa0
[   68.945677]  ftrace_startup_enable+0x5e/0xa0
[   68.946364]  ftrace_startup+0x16d/0x240
[   68.947040]  register_ftrace_function+0x43/0x90
[   68.947749]  perf_ftrace_event_register+0xc1/0xf0
[   68.948485]  perf_trace_event_init+0xa0/0x4c0
[   68.949205]  perf_trace_init+0xda/0x160
[   68.949844]  perf_tp_event_init+0x57/0xa0
[   68.950489]  perf_try_init_event+0x83/0x270
[   68.951197]  perf_event_alloc+0xe3f/0x1c10
[   68.951819]  ? _raw_spin_unlock+0x2c/0x50
[   68.952450]  ? alloc_fd+0x20d/0x320
[   68.953105]  __do_sys_perf_event_open+0x3bf/0x1de0
[   68.953848]  ? write_comp_data+0x2f/0x90
[   68.954800]  __x64_sys_perf_event_open+0x26/0x30
[   68.955510]  do_syscall_64+0x37/0x80
[   68.956082]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   68.956832] RIP: 0033:0x7fac0740459d
[   68.957385] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   68.959945] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   68.961040] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   68.962052] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   68.963068] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   68.964089] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   68.965104] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   68.966353] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   68.966569] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   68.967246] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   68.967256] Call Trace:
[   68.968326] caller is debug_smp_processor_id+0x1c/0x20
[   68.969681]  dump_stack_lvl+0xa4/0xd3
[   68.971126]  dump_stack+0x15/0x17
[   68.971550]  check_preemption_disabled+0x167/0x180
[   68.972148]  ? hrtimer_try_to_cancel+0x38/0x290
[   68.972714]  ? __hrtimer_get_remaining+0x80/0x80
[   68.973294]  debug_smp_processor_id+0x1c/0x20
[   68.973842]  perf_ftrace_function_call+0x7c/0x360
[   68.974433]  ? do_nanosleep+0x155/0x2a0
[   68.974918]  ? hrtimer_wakeup+0x40/0x40
[   68.975411]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   68.975998]  ? do_nanosleep+0x155/0x2a0
[   68.976483]  ? perf_ftrace_function_call+0x4c/0x360
[   68.977096]  ? 0xffffffffa0098099
[   68.977517]  ? __this_cpu_preempt_check+0x1c/0x20
[   68.978125]  ? do_nanosleep+0x9c/0x2a0
[   68.978610]  0xffffffffa0098099
[   68.979009]  ? do_nanosleep+0x9c/0x2a0
[   68.979488]  ? do_nanosleep+0x9c/0x2a0
[   68.979970]  ? do_nanosleep+0x140/0x2a0
[   68.980460]  ? hrtimer_active+0x5/0xb0
[   68.980938]  ? do_nanosleep+0x140/0x2a0
[   68.981424]  hrtimer_active+0x5/0xb0
[   68.981880]  hrtimer_try_to_cancel+0x38/0x290
[   68.982436]  ? hrtimer_active+0x5/0xb0
[   68.982908]  ? hrtimer_try_to_cancel+0x38/0x290
[   68.983482]  ? do_nanosleep+0x9c/0x2a0
[   68.983961]  do_nanosleep+0x155/0x2a0
[   68.984425]  ? write_comp_data+0x2f/0x90
[   68.984931]  hrtimer_nanosleep+0xf7/0x1b0
[   68.985446]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[   68.986027]  __x64_sys_nanosleep+0xfc/0x150
[   68.986567]  do_syscall_64+0x37/0x80
[   68.987022]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   68.987649] RIP: 0033:0x7fac073cca18
[   68.988100] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[   68.990317] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[   68.991234] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[   68.992097] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[   68.992960] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[   68.993821] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[   68.994686] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   68.995594] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   68.995621] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[   68.996649] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   68.997562] caller is debug_smp_processor_id+0x1c/0x20
[   68.999159] Call Trace:
[   68.999193]  dump_stack_lvl+0xa4/0xd3
[   69.000756]  dump_stack+0x15/0x17
[   69.001341]  check_preemption_disabled+0x167/0x180
[   69.002140]  debug_smp_processor_id+0x1c/0x20
[   69.002815]  perf_swevent_get_recursion_context+0x1e/0xd0
[   69.003693]  perf_trace_buf_alloc+0x3d/0x100
[   69.004350]  ? ftrace_verify_code+0x2c/0x70
[   69.004992]  ? copy_to_user_nofault+0x150/0x150
[   69.005704]  perf_ftrace_function_call+0x209/0x360
[   69.006649]  ? 0xffffffffa0098099
[   69.007292]  0xffffffffa0098099
[   69.007789]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[   69.008582]  ? ftrace_get_addr_curr+0x1a8/0x280
[   69.009282]  ? memdup_user+0xc0/0xc0
[   69.009831]  ? memdup_user+0xc0/0xc0
[   69.010405]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[   69.011206]  ? ftrace_get_addr_curr+0x1a8/0x280
[   69.011894]  ? strndup_user+0xb0/0xb0
[   69.012477]  ? copy_from_kernel_nofault+0x5/0x220
[   69.013237]  copy_from_kernel_nofault+0x5/0x220
[   69.013928]  ftrace_verify_code+0x2c/0x70
[   69.014553]  ? copy_from_kernel_nofault+0x5/0x220
[   69.015256]  ? ftrace_verify_code+0x2c/0x70
[   69.015932]  ftrace_replace_code+0x69/0x170
[   69.016628]  ftrace_modify_all_code+0x1b1/0x270
[   69.017362]  arch_ftrace_update_code+0x9/0x10
[   69.018115]  ftrace_run_update_code+0x30/0xa0
[   69.018965]  ftrace_startup_enable+0x5e/0xa0
[   69.019687]  ftrace_startup+0x16d/0x240
[   69.020363]  register_ftrace_function+0x43/0x90
[   69.021076]  perf_ftrace_event_register+0xc1/0xf0
[   69.021811]  perf_trace_event_init+0xa0/0x4c0
[   69.022541]  perf_trace_init+0xda/0x160
[   69.023182]  perf_tp_event_init+0x57/0xa0
[   69.023826]  perf_try_init_event+0x83/0x270
[   69.024536]  perf_event_alloc+0xe3f/0x1c10
[   69.025159]  ? _raw_spin_unlock+0x2c/0x50
[   69.025793]  ? alloc_fd+0x20d/0x320
[   69.026457]  __do_sys_perf_event_open+0x3bf/0x1de0
[   69.027206]  ? write_comp_data+0x2f/0x90
[   69.028163]  __x64_sys_perf_event_open+0x26/0x30
[   69.028877]  do_syscall_64+0x37/0x80
[   69.029450]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   69.030207] RIP: 0033:0x7fac0740459d
[   69.030766] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   69.033331] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   69.034435] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   69.035452] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   69.036466] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   69.037480] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   69.038504] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   69.039751] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   69.040648] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   69.042015] Call Trace:
[   69.042333]  dump_stack_lvl+0xa4/0xd3
[   69.042804]  dump_stack+0x15/0x17
[   69.043237]  check_preemption_disabled+0x167/0x180
[   69.043835]  ? syscall_exit_to_user_mode+0xd/0x60
[   69.044421]  ? __bpf_trace_sys_enter+0x10/0x10
[   69.044980]  debug_smp_processor_id+0x1c/0x20
[   69.045527]  perf_ftrace_function_call+0x7c/0x360
[   69.046121]  ? write_comp_data+0x2f/0x90
[   69.046623]  ? write_comp_data+0x2f/0x90
[   69.047123]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   69.047712]  ? write_comp_data+0x2f/0x90
[   69.048211]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   69.048811]  0xffffffffa0098099
[   69.049212]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   69.049820]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[   69.050500]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   69.051090]  syscall_exit_to_user_mode_prepare+0x5/0x240
[   69.051748]  syscall_exit_to_user_mode+0xd/0x60
[   69.052314]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[   69.052988]  ? syscall_exit_to_user_mode+0xd/0x60
[   69.053576]  do_syscall_64+0x46/0x80
[   69.054031]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   69.054662] RIP: 0033:0x7fac073cca18
[   69.055112] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[   69.057327] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[   69.058245] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac073cca18
[   69.059108] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[   69.059977] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[   69.060871] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[   69.061777] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   73.718116] check_preemption_disabled: 1558518 callbacks suppressed
[   73.718148] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   73.719972] caller is debug_smp_processor_id+0x1c/0x20
[   73.720674] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   73.721617] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   73.723078] Call Trace:
[   73.723474]  dump_stack_lvl+0xa4/0xd3
[   73.724077]  dump_stack+0x15/0x17
[   73.724584]  check_preemption_disabled+0x167/0x180
[   73.725361]  debug_smp_processor_id+0x1c/0x20
[   73.726001]  perf_swevent_get_recursion_context+0x1e/0xd0
[   73.726855]  perf_trace_buf_alloc+0x3d/0x100
[   73.727534]  ? __get_locked_pte+0x1a2/0x290
[   73.728156]  ? __lock_text_start+0x8/0x8
[   73.728782]  perf_ftrace_function_call+0x209/0x360
[   73.729819]  ? 0xffffffffa0098099
[   73.730550]  0xffffffffa0098099
[   73.731102]  ? copy_from_user_nofault+0x1/0x130
[   73.731842]  ? 0xffffffffa0098099
[   73.732415]  ? pmd_page_vaddr+0x2b/0x70
[   73.733059]  ? _raw_spin_lock+0x5/0x50
[   73.733722]  _raw_spin_lock+0x5/0x50
[   73.734301]  __get_locked_pte+0x1a2/0x290
[   73.734924]  ? _raw_spin_lock+0x5/0x50
[   73.735509]  ? __get_locked_pte+0x1a2/0x290
[   73.736183]  ? copy_from_user_nofault+0x1/0x130
[   73.736902]  __text_poke+0xea/0x4e0
[   73.737455]  ? copy_from_user_nofault+0x1/0x130
[   73.738181]  ? lock_is_held_type+0xe2/0x140
[   73.738840]  ? copy_from_user_nofault+0x1/0x130
[   73.739593]  text_poke+0x2b/0x60
[   73.740161]  text_poke_bp_batch+0xf5/0x2c0
[   73.740858]  ? shmem_enabled_show+0x180/0x180
[   73.741588]  text_poke_queue+0xa7/0xc0
[   73.742250]  ftrace_replace_code+0xfd/0x170
[   73.742975]  ftrace_modify_all_code+0x1b1/0x270
[   73.743728]  arch_ftrace_update_code+0x9/0x10
[   73.744391]  ftrace_run_update_code+0x30/0xa0
[   73.745086]  ftrace_startup_enable+0x5e/0xa0
[   73.745771]  ftrace_startup+0x16d/0x240
[   73.746494]  register_ftrace_function+0x43/0x90
[   73.747214]  perf_ftrace_event_register+0xc1/0xf0
[   73.747956]  perf_trace_event_init+0xa0/0x4c0
[   73.748703]  perf_trace_init+0xda/0x160
[   73.749367]  perf_tp_event_init+0x57/0xa0
[   73.750019]  perf_try_init_event+0x83/0x270
[   73.750771]  perf_event_alloc+0xe3f/0x1c10
[   73.751385]  ? _raw_spin_unlock+0x2c/0x50
[   73.752020]  ? alloc_fd+0x20d/0x320
[   73.752739]  __do_sys_perf_event_open+0x3bf/0x1de0
[   73.753500]  ? write_comp_data+0x2f/0x90
[   73.754646]  __x64_sys_perf_event_open+0x26/0x30
[   73.755359]  do_syscall_64+0x37/0x80
[   73.755940]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   73.756683] RIP: 0033:0x7fac0740459d
[   73.757243] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   73.759711] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   73.760785] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   73.761770] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   73.762762] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   73.763745] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   73.764729] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   73.766340] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   73.766360] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   73.767357] caller is debug_smp_processor_id+0x1c/0x20
[   73.768414] caller is debug_smp_processor_id+0x1c/0x20
[   73.769096] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   73.770694] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   73.772175] Call Trace:
[   73.772556]  dump_stack_lvl+0xa4/0xd3
[   73.773135]  dump_stack+0x15/0x17
[   73.773633]  check_preemption_disabled+0x167/0x180
[   73.774381]  debug_smp_processor_id+0x1c/0x20
[   73.775009]  perf_trace_buf_alloc+0x98/0x100
[   73.775629]  ? __get_locked_pte+0x1a2/0x290
[   73.776222]  ? __lock_text_start+0x8/0x8
[   73.776809]  perf_ftrace_function_call+0x209/0x360
[   73.777720]  ? 0xffffffffa0098099
[   73.778349]  0xffffffffa0098099
[   73.778854]  ? copy_from_user_nofault+0x1/0x130
[   73.779531]  ? 0xffffffffa0098099
[   73.780058]  ? pmd_page_vaddr+0x2b/0x70
[   73.780653]  ? _raw_spin_lock+0x5/0x50
[   73.781254]  _raw_spin_lock+0x5/0x50
[   73.781787]  __get_locked_pte+0x1a2/0x290
[   73.782376]  ? _raw_spin_lock+0x5/0x50
[   73.782917]  ? __get_locked_pte+0x1a2/0x290
[   73.783548]  ? copy_from_user_nofault+0x1/0x130
[   73.784224]  __text_poke+0xea/0x4e0
[   73.784744]  ? copy_from_user_nofault+0x1/0x130
[   73.785418]  ? lock_is_held_type+0xe2/0x140
[   73.786038]  ? copy_from_user_nofault+0x1/0x130
[   73.786750]  text_poke+0x2b/0x60
[   73.787275]  text_poke_bp_batch+0xf5/0x2c0
[   73.787919]  ? shmem_enabled_show+0x180/0x180
[   73.788604]  text_poke_queue+0xa7/0xc0
[   73.789207]  ftrace_replace_code+0xfd/0x170
[   73.789875]  ftrace_modify_all_code+0x1b1/0x270
[   73.790577]  arch_ftrace_update_code+0x9/0x10
[   73.791206]  ftrace_run_update_code+0x30/0xa0
[   73.791859]  ftrace_startup_enable+0x5e/0xa0
[   73.792500]  ftrace_startup+0x16d/0x240
[   73.793148]  register_ftrace_function+0x43/0x90
[   73.793824]  perf_ftrace_event_register+0xc1/0xf0
[   73.794525]  perf_trace_event_init+0xa0/0x4c0
[   73.795214]  perf_trace_init+0xda/0x160
[   73.795827]  perf_tp_event_init+0x57/0xa0
[   73.796436]  perf_try_init_event+0x83/0x270
[   73.797116]  perf_event_alloc+0xe3f/0x1c10
[   73.797701]  ? _raw_spin_unlock+0x2c/0x50
[   73.798302]  ? alloc_fd+0x20d/0x320
[   73.798945]  __do_sys_perf_event_open+0x3bf/0x1de0
[   73.799651]  ? write_comp_data+0x2f/0x90
[   73.800607]  __x64_sys_perf_event_open+0x26/0x30
[   73.801280]  do_syscall_64+0x37/0x80
[   73.801823]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   73.802533] RIP: 0033:0x7fac0740459d
[   73.803060] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   73.805452] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   73.806486] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   73.807436] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   73.808386] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   73.809337] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   73.810290] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   73.811493] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   73.811658] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   73.812518] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   73.813510] caller is debug_smp_processor_id+0x1c/0x20
[   73.814897] Call Trace:
[   73.814926]  dump_stack_lvl+0xa4/0xd3
[   73.814992]  dump_stack+0x15/0x17
[   73.815027]  check_preemption_disabled+0x167/0x180
[   73.815066]  ? do_epoll_wait+0x3b3/0xd80
[   73.818035]  ? __mutex_lock+0x9f0/0x9f0
[   73.818591]  debug_smp_processor_id+0x1c/0x20
[   73.819181]  perf_ftrace_function_call+0x7c/0x360
[   73.819868]  ? ftrace_call+0x5/0x44
[   73.820343]  ? trace_hardirqs_on+0x6a/0x170
[   73.820948]  ? finish_task_switch+0xb0/0x2a0
[   73.821517]  ? finish_task_switch+0x70/0x2a0
[   73.822113]  ? trace_hardirqs_on+0x3f/0x170
[   73.822678]  ? finish_task_switch+0x70/0x2a0
[   73.823274]  ? preempt_count_sub+0x5/0xa0
[   73.823874]  0xffffffffa0098099
[   73.824321]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   73.824966]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   73.825714]  ? do_epoll_wait+0x36b/0xd80
[   73.826292]  ? mutex_lock_nested+0x5/0x20
[   73.826836]  ? write_comp_data+0x2f/0x90
[   73.827388]  mutex_lock_nested+0x5/0x20
[   73.827914]  do_epoll_wait+0x3b3/0xd80
[   73.828430]  ? mutex_lock_nested+0x5/0x20
[   73.828966]  ? do_epoll_wait+0x3b3/0xd80
[   73.829659]  ? wait_woken+0x90/0x90
[   73.830222]  __x64_sys_epoll_wait+0x8d/0xd0
[   73.830856]  do_syscall_64+0x37/0x80
[   73.831360]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   73.832022] RIP: 0033:0x7f8a39143ae0
[   73.832525] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   73.834798] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   73.835765] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   73.836661] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   73.837557] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   73.838456] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   73.839352] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   73.840444] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   73.840612] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   73.841421] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   73.842530] caller is debug_smp_processor_id+0x1c/0x20
[   73.843930] Call Trace:
[   73.844939]  dump_stack_lvl+0xa4/0xd3
[   73.845521]  dump_stack+0x15/0x17
[   73.846022]  check_preemption_disabled+0x167/0x180
[   73.846774]  debug_smp_processor_id+0x1c/0x20
[   73.847408]  perf_swevent_put_recursion_context+0x1b/0x40
[   73.848194]  perf_tp_event+0x331/0x4e0
[   73.849083]  ? arch_local_irq_enable+0x10/0x12
[   73.849737]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   73.850447]  ? dump_stack_lvl+0xcc/0xd3
[   73.851046]  ? dump_stack+0x15/0x17
[   73.851565]  ? check_preemption_disabled+0x167/0x180
[   73.852330]  ? __get_locked_pte+0x1a2/0x290
[   73.852925]  ? __lock_text_start+0x8/0x8
[   73.853524]  perf_ftrace_function_call+0x248/0x360
[   73.854206]  ? perf_ftrace_function_call+0x248/0x360
[   73.855164]  ? 0xffffffffa0098099
[   73.855790]  0xffffffffa0098099
[   73.856298]  ? copy_from_user_nofault+0x1/0x130
[   73.856977]  ? 0xffffffffa0098099
[   73.857506]  ? pmd_page_vaddr+0x2b/0x70
[   73.858105]  ? _raw_spin_lock+0x5/0x50
[   73.858712]  _raw_spin_lock+0x5/0x50
[   73.859247]  __get_locked_pte+0x1a2/0x290
[   73.859834]  ? _raw_spin_lock+0x5/0x50
[   73.860376]  ? __get_locked_pte+0x1a2/0x290
[   73.861007]  ? copy_from_user_nofault+0x1/0x130
[   73.861683]  __text_poke+0xea/0x4e0
[   73.862208]  ? copy_from_user_nofault+0x1/0x130
[   73.862883]  ? lock_is_held_type+0xe2/0x140
[   73.863502]  ? copy_from_user_nofault+0x1/0x130
[   73.864202]  text_poke+0x2b/0x60
[   73.864726]  text_poke_bp_batch+0xf5/0x2c0
[   73.865370]  ? shmem_enabled_show+0x180/0x180
[   73.866048]  text_poke_queue+0xa7/0xc0
[   73.866665]  ftrace_replace_code+0xfd/0x170
[   73.867333]  ftrace_modify_all_code+0x1b1/0x270
[   73.868033]  arch_ftrace_update_code+0x9/0x10
[   73.868662]  ftrace_run_update_code+0x30/0xa0
[   73.869316]  ftrace_startup_enable+0x5e/0xa0
[   73.869960]  ftrace_startup+0x16d/0x240
[   73.870614]  register_ftrace_function+0x43/0x90
[   73.871290]  perf_ftrace_event_register+0xc1/0xf0
[   73.871987]  perf_trace_event_init+0xa0/0x4c0
[   73.872678]  perf_trace_init+0xda/0x160
[   73.873292]  perf_tp_event_init+0x57/0xa0
[   73.873903]  perf_try_init_event+0x83/0x270
[   73.874588]  perf_event_alloc+0xe3f/0x1c10
[   73.875176]  ? _raw_spin_unlock+0x2c/0x50
[   73.875777]  ? alloc_fd+0x20d/0x320
[   73.876415]  __do_sys_perf_event_open+0x3bf/0x1de0
[   73.877125]  ? write_comp_data+0x2f/0x90
[   73.878083]  __x64_sys_perf_event_open+0x26/0x30
[   73.878761]  do_syscall_64+0x37/0x80
[   73.879305]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   73.880011] RIP: 0033:0x7fac0740459d
[   73.880535] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   73.882931] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   73.883960] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   73.884908] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   73.885860] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   73.886821] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   73.887772] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   73.888977] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   73.889162] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   73.890000] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   73.890020] Call Trace:
[   73.890048]  dump_stack_lvl+0xa4/0xd3
[   73.890112]  dump_stack+0x15/0x17
[   73.890152]  check_preemption_disabled+0x167/0x180
[   73.891219] caller is debug_smp_processor_id+0x1c/0x20
[   73.892609]  ? mutex_lock_nested+0x1b/0x20
[   73.895611]  ? mutex_lock_io_nested+0x940/0x940
[   73.896236]  debug_smp_processor_id+0x1c/0x20
[   73.896824]  perf_ftrace_function_call+0x7c/0x360
[   73.897455]  ? perf_ftrace_function_call+0x4c/0x360
[   73.898165]  ? ftrace_call+0x5/0x44
[   73.898638]  ? trace_hardirqs_on+0x6a/0x170
[   73.899242]  ? finish_task_switch+0xb0/0x2a0
[   73.899808]  ? finish_task_switch+0x70/0x2a0
[   73.900403]  ? trace_hardirqs_on+0x3f/0x170
[   73.900958]  ? finish_task_switch+0x70/0x2a0
[   73.901616]  0xffffffffa0098099
[   73.902063]  ? 0xffffffffa0098099
[   73.902533]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   73.903181]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   73.903892]  ? do_epoll_wait+0x3b3/0xd80
[   73.904476]  ? __mutex_lock+0x5/0x9f0
[   73.904980]  ? mutex_lock_nested+0x5/0x20
[   73.905526]  ? write_comp_data+0x2f/0x90
[   73.906061]  __mutex_lock+0x5/0x9f0
[   73.906549]  mutex_lock_nested+0x1b/0x20
[   73.907087]  ? __mutex_lock+0x5/0x9f0
[   73.907582]  ? mutex_lock_nested+0x1b/0x20
[   73.908139]  do_epoll_wait+0x3b3/0xd80
[   73.908814]  ? wait_woken+0x90/0x90
[   73.909375]  __x64_sys_epoll_wait+0x8d/0xd0
[   73.910010]  do_syscall_64+0x37/0x80
[   73.910518]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   73.911179] RIP: 0033:0x7f8a39143ae0
[   73.911669] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   73.913939] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   73.914909] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   73.915807] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   73.916702] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   73.917599] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   73.918499] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   73.919592] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   73.919708] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   73.920648] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   73.921682] caller is debug_smp_processor_id+0x1c/0x20
[   73.923264] Call Trace:
[   73.923315]  dump_stack_lvl+0xa4/0xd3
[   73.924969]  dump_stack+0x15/0x17
[   73.925527]  check_preemption_disabled+0x167/0x180
[   73.926288]  ? __text_poke+0xea/0x4e0
[   73.926874]  ? __pmd_alloc+0x420/0x420
[   73.927523]  debug_smp_processor_id+0x1c/0x20
[   73.928221]  perf_ftrace_function_call+0x7c/0x360
[   73.928966]  ? text_poke+0x2b/0x60
[   73.929534]  ? perf_ftrace_function_call+0x4c/0x360
[   73.930640]  ? ftrace_ops_list_func+0x259/0x2e0
[   73.931394]  ? copy_to_user_nofault+0x131/0x150
[   73.932152]  0xffffffffa0098099
[   73.932733]  ? ftrace_ops_list_func+0x1d2/0x2e0
[   73.933470]  ? do_sync_core+0x30/0x30
[   73.934218]  ? __get_locked_pte+0x5/0x290
[   73.934939]  __get_locked_pte+0x5/0x290
[   73.935565]  __text_poke+0xea/0x4e0
[   73.936154]  ? __get_locked_pte+0x5/0x290
[   73.936785]  ? __text_poke+0xea/0x4e0
[   73.937387]  ? copy_to_user_nofault+0x131/0x150
[   73.938148]  ? lock_is_held_type+0xe2/0x140
[   73.938839]  ? copy_to_user_nofault+0x131/0x150
[   73.939629]  text_poke+0x2b/0x60
[   73.940226]  text_poke_bp_batch+0xf5/0x2c0
[   73.940957]  ? shmem_enabled_show+0x180/0x180
[   73.941726]  text_poke_queue+0xa7/0xc0
[   73.942416]  ftrace_replace_code+0xfd/0x170
[   73.943178]  ftrace_modify_all_code+0x1b1/0x270
[   73.943969]  arch_ftrace_update_code+0x9/0x10
[   73.944665]  ftrace_run_update_code+0x30/0xa0
[   73.945397]  ftrace_startup_enable+0x5e/0xa0
[   73.946116]  ftrace_startup+0x16d/0x240
[   73.946871]  register_ftrace_function+0x43/0x90
[   73.947631]  perf_ftrace_event_register+0xc1/0xf0
[   73.948410]  perf_trace_event_init+0xa0/0x4c0
[   73.949197]  perf_trace_init+0xda/0x160
[   73.949895]  perf_tp_event_init+0x57/0xa0
[   73.950584]  perf_try_init_event+0x83/0x270
[   73.951366]  perf_event_alloc+0xe3f/0x1c10
[   73.952011]  ? _raw_spin_unlock+0x2c/0x50
[   73.952680]  ? alloc_fd+0x20d/0x320
[   73.953435]  __do_sys_perf_event_open+0x3bf/0x1de0
[   73.954231]  ? write_comp_data+0x2f/0x90
[   73.955433]  __x64_sys_perf_event_open+0x26/0x30
[   73.956183]  do_syscall_64+0x37/0x80
[   73.956793]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   73.957570] RIP: 0033:0x7fac0740459d
[   73.958158] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   73.960737] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   73.961866] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   73.962906] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   73.963942] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   73.964979] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   73.966015] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   73.967425] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   73.967592] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   73.968447] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   73.969522] caller is debug_smp_processor_id+0x1c/0x20
[   73.970991] Call Trace:
[   73.971020]  dump_stack_lvl+0xa4/0xd3
[   73.971085]  dump_stack+0x15/0x17
[   73.971120]  check_preemption_disabled+0x167/0x180
[   73.971159]  ? do_epoll_wait+0x3bf/0xd80
[   73.974227]  ? __ia32_sys_fanotify_init+0x5c0/0x5c0
[   73.974897]  debug_smp_processor_id+0x1c/0x20
[   73.975486]  perf_ftrace_function_call+0x7c/0x360
[   73.976169]  ? ftrace_call+0x5/0x44
[   73.976735]  ? do_epoll_wait+0x3b3/0xd80
[   73.977319]  ? preempt_count_sub+0x5/0xa0
[   73.977931]  0xffffffffa0098099
[   73.978387]  ? __mutex_lock+0xfe/0x9f0
[   73.978921]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   73.979652]  ? do_epoll_wait+0x3b3/0xd80
[   73.980236]  ? ep_start_scan+0x5/0x100
[   73.980800]  ep_start_scan+0x5/0x100
[   73.981298]  do_epoll_wait+0x3bf/0xd80
[   73.981815]  ? ep_start_scan+0x5/0x100
[   73.982331]  ? do_epoll_wait+0x3bf/0xd80
[   73.983025]  ? wait_woken+0x90/0x90
[   73.983590]  __x64_sys_epoll_wait+0x8d/0xd0
[   73.984223]  do_syscall_64+0x37/0x80
[   73.984731]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   73.985465] RIP: 0033:0x7f8a39143ae0
[   73.986004] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   73.988457] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   73.989479] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   73.990441] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   73.991388] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   73.992335] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   73.993281] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   73.994445] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   73.994577] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   73.995531] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   73.996633] caller is debug_smp_processor_id+0x1c/0x20
[   73.998348] Call Trace:
[   73.998405]  dump_stack_lvl+0xa4/0xd3
[   74.000170]  dump_stack+0x15/0x17
[   74.000769]  check_preemption_disabled+0x167/0x180
[   74.001674]  debug_smp_processor_id+0x1c/0x20
[   74.002563]  perf_swevent_get_recursion_context+0x1e/0xd0
[   74.003627]  perf_trace_buf_alloc+0x3d/0x100
[   74.004383]  ? __text_poke+0xea/0x4e0
[   74.005028]  ? __pmd_alloc+0x420/0x420
[   74.005727]  perf_ftrace_function_call+0x209/0x360
[   74.006885]  ? 0xffffffffa0098099
[   74.007567]  ? copy_to_user_nofault+0x131/0x150
[   74.008328]  0xffffffffa0098099
[   74.008913]  ? ftrace_ops_list_func+0x1d2/0x2e0
[   74.009655]  ? do_sync_core+0x30/0x30
[   74.010424]  ? __get_locked_pte+0x5/0x290
[   74.011161]  __get_locked_pte+0x5/0x290
[   74.011790]  __text_poke+0xea/0x4e0
[   74.012373]  ? __get_locked_pte+0x5/0x290
[   74.013004]  ? __text_poke+0xea/0x4e0
[   74.013608]  ? copy_to_user_nofault+0x131/0x150
[   74.014369]  ? lock_is_held_type+0xe2/0x140
[   74.015062]  ? copy_to_user_nofault+0x131/0x150
[   74.015854]  text_poke+0x2b/0x60
[   74.016455]  text_poke_bp_batch+0xf5/0x2c0
[   74.017189]  ? shmem_enabled_show+0x180/0x180
[   74.017957]  text_poke_queue+0xa7/0xc0
[   74.018650]  ftrace_replace_code+0xfd/0x170
[   74.019413]  ftrace_modify_all_code+0x1b1/0x270
[   74.020206]  arch_ftrace_update_code+0x9/0x10
[   74.020905]  ftrace_run_update_code+0x30/0xa0
[   74.021639]  ftrace_startup_enable+0x5e/0xa0
[   74.022364]  ftrace_startup+0x16d/0x240
[   74.023114]  register_ftrace_function+0x43/0x90
[   74.023871]  perf_ftrace_event_register+0xc1/0xf0
[   74.024651]  perf_trace_event_init+0xa0/0x4c0
[   74.025437]  perf_trace_init+0xda/0x160
[   74.026143]  perf_tp_event_init+0x57/0xa0
[   74.026831]  perf_try_init_event+0x83/0x270
[   74.027617]  perf_event_alloc+0xe3f/0x1c10
[   74.028265]  ? _raw_spin_unlock+0x2c/0x50
[   74.028937]  ? alloc_fd+0x20d/0x320
[   74.029692]  __do_sys_perf_event_open+0x3bf/0x1de0
[   74.030494]  ? write_comp_data+0x2f/0x90
[   74.031699]  __x64_sys_perf_event_open+0x26/0x30
[   74.032452]  do_syscall_64+0x37/0x80
[   74.033064]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   74.033840] RIP: 0033:0x7fac0740459d
[   74.034439] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   74.037032] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   74.038168] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   74.039207] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   74.040244] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   74.041281] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   74.042323] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   74.043730] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   74.043905] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   74.044758] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   74.045750] caller is debug_smp_processor_id+0x1c/0x20
[   74.047135] Call Trace:
[   74.047164]  dump_stack_lvl+0xa4/0xd3
[   74.047240]  dump_stack+0x15/0x17
[   74.047280]  check_preemption_disabled+0x167/0x180
[   74.049792]  ? ep_start_scan+0x68/0x100
[   74.050313]  ? _raw_read_lock_irq+0xa0/0xa0
[   74.050900]  debug_smp_processor_id+0x1c/0x20
[   74.051495]  perf_ftrace_function_call+0x7c/0x360
[   74.052125]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   74.052752]  ? do_epoll_wait+0x3bf/0xd80
[   74.053288]  ? perf_ftrace_function_call+0x4c/0x360
[   74.053985]  ? ftrace_call+0x5/0x44
[   74.054551]  ? do_epoll_wait+0x3b3/0xd80
[   74.055163]  0xffffffffa0098099
[   74.055647]  ? 0xffffffffa0098099
[   74.056114]  ? __mutex_lock+0xfe/0x9f0
[   74.056633]  ? do_epoll_wait+0x3b3/0xd80
[   74.057170]  ? ep_start_scan+0xe0/0x100
[   74.057725]  ? _raw_write_lock_irq+0x5/0x60
[   74.058295]  ? write_comp_data+0x2f/0x90
[   74.058849]  _raw_write_lock_irq+0x5/0x60
[   74.059397]  ep_start_scan+0x68/0x100
[   74.059904]  ? _raw_write_lock_irq+0x5/0x60
[   74.060462]  ? ep_start_scan+0x68/0x100
[   74.061025]  do_epoll_wait+0x3bf/0xd80
[   74.061700]  ? wait_woken+0x90/0x90
[   74.062262]  __x64_sys_epoll_wait+0x8d/0xd0
[   74.062897]  do_syscall_64+0x37/0x80
[   74.063400]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   74.064059] RIP: 0033:0x7f8a39143ae0
[   74.064549] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   74.066814] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   74.067777] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   74.068669] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   74.069562] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   74.070461] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   74.071355] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   74.072448] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   74.073444] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   74.074949] Call Trace:
[   74.075334]  dump_stack_lvl+0xa4/0xd3
[   74.075914]  dump_stack+0x15/0x17
[   74.076413]  check_preemption_disabled+0x167/0x180
[   74.077159]  debug_smp_processor_id+0x1c/0x20
[   74.077792]  perf_trace_buf_alloc+0x98/0x100
[   74.078417]  ? __text_poke+0xea/0x4e0
[   74.078947]  ? __pmd_alloc+0x420/0x420
[   74.079513]  perf_ftrace_function_call+0x209/0x360
[   74.080429]  ? 0xffffffffa0098099
[   74.081006]  ? copy_to_user_nofault+0x131/0x150
[   74.081695]  0xffffffffa0098099
[   74.082206]  ? ftrace_ops_list_func+0x1d2/0x2e0
[   74.082870]  ? do_sync_core+0x30/0x30
[   74.083515]  ? __get_locked_pte+0x5/0x290
[   74.084156]  __get_locked_pte+0x5/0x290
[   74.084722]  __text_poke+0xea/0x4e0
[   74.085244]  ? __get_locked_pte+0x5/0x290
[   74.085821]  ? __text_poke+0xea/0x4e0
[   74.086375]  ? copy_to_user_nofault+0x131/0x150
[   74.087053]  ? lock_is_held_type+0xe2/0x140
[   74.087674]  ? copy_to_user_nofault+0x131/0x150
[   74.088374]  text_poke+0x2b/0x60
[   74.088900]  text_poke_bp_batch+0xf5/0x2c0
[   74.089545]  ? shmem_enabled_show+0x180/0x180
[   74.090228]  text_poke_queue+0xa7/0xc0
[   74.090833]  ftrace_replace_code+0xfd/0x170
[   74.091502]  ftrace_modify_all_code+0x1b1/0x270
[   74.092201]  arch_ftrace_update_code+0x9/0x10
[   74.092831]  ftrace_run_update_code+0x30/0xa0
[   74.093485]  ftrace_startup_enable+0x5e/0xa0
[   74.094133]  ftrace_startup+0x16d/0x240
[   74.094782]  register_ftrace_function+0x43/0x90
[   74.095458]  perf_ftrace_event_register+0xc1/0xf0
[   74.096162]  perf_trace_event_init+0xa0/0x4c0
[   74.096854]  perf_trace_init+0xda/0x160
[   74.097470]  perf_tp_event_init+0x57/0xa0
[   74.098082]  perf_try_init_event+0x83/0x270
[   74.098769]  perf_event_alloc+0xe3f/0x1c10
[   74.099356]  ? _raw_spin_unlock+0x2c/0x50
[   74.099956]  ? alloc_fd+0x20d/0x320
[   74.100596]  __do_sys_perf_event_open+0x3bf/0x1de0
[   74.101308]  ? write_comp_data+0x2f/0x90
[   74.102271]  __x64_sys_perf_event_open+0x26/0x30
[   74.102947]  do_syscall_64+0x37/0x80
[   74.103492]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   74.104200] RIP: 0033:0x7fac0740459d
[   74.104726] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   74.107128] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   74.108161] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   74.109112] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   74.110063] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   74.111017] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   74.111968] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   78.722104] check_preemption_disabled: 878738 callbacks suppressed
[   78.722141] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   78.722251] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[   78.723039] caller is debug_smp_processor_id+0x1c/0x20
[   78.723903] caller is debug_smp_processor_id+0x1c/0x20
[   78.724926] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   78.727100] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   78.728556] Call Trace:
[   78.728952]  dump_stack_lvl+0xa4/0xd3
[   78.729553]  dump_stack+0x15/0x17
[   78.730060]  check_preemption_disabled+0x167/0x180
[   78.730760]  ? insn_get_opcode+0x1d5/0x3b0
[   78.731373]  ? insn_decode_from_regs+0x110/0x110
[   78.732138]  debug_smp_processor_id+0x1c/0x20
[   78.732838]  perf_ftrace_function_call+0x7c/0x360
[   78.733566]  ? perf_trace_buf_alloc+0xb0/0x100
[   78.734281]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   78.735025]  ? insn_get_modrm+0x12b/0x2a0
[   78.735673]  ? perf_ftrace_function_call+0x4c/0x360
[   78.736867]  0xffffffffa0098099
[   78.737505]  ? 0xffffffffa0098099
[   78.738131]  ? insn_get_opcode+0x49/0x3b0
[   78.738834]  ? insn_get_prefixes.part.1+0x5/0x650
[   78.739576]  ? write_comp_data+0x2f/0x90
[   78.740250]  insn_get_prefixes.part.1+0x5/0x650
[   78.740971]  insn_get_opcode+0x1d5/0x3b0
[   78.741610]  ? insn_get_prefixes.part.1+0x5/0x650
[   78.742339]  ? insn_get_opcode+0x1d5/0x3b0
[   78.743086]  insn_get_modrm+0x12b/0x2a0
[   78.743801]  insn_get_sib+0x122/0x140
[   78.744474]  insn_get_displacement+0x157/0x270
[   78.745252]  insn_get_immediate+0x181/0x570
[   78.746012]  insn_get_length+0x75/0x90
[   78.746689]  insn_decode+0x9b/0x170
[   78.747303]  ? selinux_inode_listxattr+0x90/0x90
[   78.748051]  text_poke_loc_init+0x63/0x140
[   78.748961]  ? selinux_inode_listxattr+0x90/0x90
[   78.749764]  text_poke_queue+0x84/0xc0
[   78.750454]  ftrace_replace_code+0xfd/0x170
[   78.751217]  ftrace_modify_all_code+0x1b1/0x270
[   78.752009]  arch_ftrace_update_code+0x9/0x10
[   78.752705]  ftrace_run_update_code+0x30/0xa0
[   78.753436]  ftrace_startup_enable+0x5e/0xa0
[   78.754160]  ftrace_startup+0x16d/0x240
[   78.754911]  register_ftrace_function+0x43/0x90
[   78.755667]  perf_ftrace_event_register+0xc1/0xf0
[   78.756448]  perf_trace_event_init+0xa0/0x4c0
[   78.757234]  perf_trace_init+0xda/0x160
[   78.757933]  perf_tp_event_init+0x57/0xa0
[   78.758624]  perf_try_init_event+0x83/0x270
[   78.759409]  perf_event_alloc+0xe3f/0x1c10
[   78.760056]  ? _raw_spin_unlock+0x2c/0x50
[   78.760724]  ? alloc_fd+0x20d/0x320
[   78.761481]  __do_sys_perf_event_open+0x3bf/0x1de0
[   78.762274]  ? write_comp_data+0x2f/0x90
[   78.763475]  __x64_sys_perf_event_open+0x26/0x30
[   78.764223]  do_syscall_64+0x37/0x80
[   78.764832]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   78.765604] RIP: 0033:0x7fac0740459d
[   78.766195] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   78.768773] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   78.769899] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   78.770938] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   78.771973] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   78.773007] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   78.774042] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   78.775453] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   78.775635] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   78.776421] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   78.777497] caller is debug_smp_processor_id+0x1c/0x20
[   78.778872] Call Trace:
[   78.778901]  dump_stack_lvl+0xa4/0xd3
[   78.778966]  dump_stack+0x15/0x17
[   78.779002]  check_preemption_disabled+0x167/0x180
[   78.779040]  ? lock_timer_base+0x34/0x100
[   78.782057]  ? _raw_read_lock_irqsave+0x90/0x90
[   78.782683]  debug_smp_processor_id+0x1c/0x20
[   78.783267]  perf_ftrace_function_call+0x7c/0x360
[   78.783908]  ? ftrace_ops_test+0x71/0xc0
[   78.784473]  ? ftrace_ops_test+0x71/0xc0
[   78.785019]  ? perf_trace_buf_update+0x70/0x70
[   78.785610]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   78.786255]  ? ftrace_ops_list_func+0x1d2/0x2e0
[   78.786855]  ? write_comp_data+0x2f/0x90
[   78.787394]  ? perf_trace_buf_update+0x70/0x70
[   78.788051]  0xffffffffa0098099
[   78.788549]  ? ftrace_call+0x5/0x44
[   78.789045]  ? lock_timer_base+0xc0/0x100
[   78.789612]  ? _raw_spin_lock_irqsave+0x5/0x70
[   78.790206]  ? write_comp_data+0x2f/0x90
[   78.790752]  _raw_spin_lock_irqsave+0x5/0x70
[   78.791325]  lock_timer_base+0x34/0x100
[   78.791846]  ? _raw_spin_lock_irqsave+0x5/0x70
[   78.792428]  ? lock_timer_base+0x34/0x100
[   78.793022]  try_to_del_timer_sync+0x33/0x90
[   78.793586]  ? try_to_del_timer_sync+0x5/0x90
[   78.794204]  del_timer_sync+0xd3/0x130
[   78.794742]  schedule_timeout+0x34e/0x610
[   78.795337]  ? del_timer_sync+0x130/0x130
[   78.795913]  ? i915_init_ggtt+0x40/0x6b0
[   78.796508]  rcu_gp_fqs_loop+0x2a0/0x410
[   78.797101]  ? rcu_gp_init+0x730/0x730
[   78.797609]  rcu_gp_kthread+0xdd/0x170
[   78.798168]  kthread+0x1e7/0x230
[   78.798629]  ? set_kthread_struct+0x80/0x80
[   78.799227]  ret_from_fork+0x1f/0x30
[   78.799905] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   78.800020] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[   78.800962] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   78.801932] caller is debug_smp_processor_id+0x1c/0x20
[   78.803518] Call Trace:
[   78.803568]  dump_stack_lvl+0xa4/0xd3
[   78.805212]  dump_stack+0x15/0x17
[   78.805772]  check_preemption_disabled+0x167/0x180
[   78.806624]  debug_smp_processor_id+0x1c/0x20
[   78.807324]  perf_swevent_get_recursion_context+0x1e/0xd0
[   78.808250]  perf_trace_buf_alloc+0x3d/0x100
[   78.808938]  ? insn_get_opcode+0x1d5/0x3b0
[   78.809580]  ? insn_decode_from_regs+0x110/0x110
[   78.810332]  perf_ftrace_function_call+0x209/0x360
[   78.811108]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   78.812138]  ? 0xffffffffa0098099
[   78.812884]  0xffffffffa0098099
[   78.813522]  ? 0xffffffffa0098099
[   78.814147]  ? insn_get_opcode+0x49/0x3b0
[   78.814850]  ? insn_get_prefixes.part.1+0x5/0x650
[   78.815594]  ? write_comp_data+0x2f/0x90
[   78.816269]  insn_get_prefixes.part.1+0x5/0x650
[   78.816991]  insn_get_opcode+0x1d5/0x3b0
[   78.817631]  ? insn_get_prefixes.part.1+0x5/0x650
[   78.818359]  ? insn_get_opcode+0x1d5/0x3b0
[   78.819107]  insn_get_modrm+0x12b/0x2a0
[   78.819823]  insn_get_sib+0x122/0x140
[   78.820498]  insn_get_displacement+0x157/0x270
[   78.821277]  insn_get_immediate+0x181/0x570
[   78.822040]  insn_get_length+0x75/0x90
[   78.822714]  insn_decode+0x9b/0x170
[   78.823331]  ? selinux_inode_listxattr+0x90/0x90
[   78.824066]  text_poke_loc_init+0x63/0x140
[   78.824977]  ? selinux_inode_listxattr+0x90/0x90
[   78.825783]  text_poke_queue+0x84/0xc0
[   78.826476]  ftrace_replace_code+0xfd/0x170
[   78.827239]  ftrace_modify_all_code+0x1b1/0x270
[   78.828040]  arch_ftrace_update_code+0x9/0x10
[   78.828739]  ftrace_run_update_code+0x30/0xa0
[   78.829472]  ftrace_startup_enable+0x5e/0xa0
[   78.830199]  ftrace_startup+0x16d/0x240
[   78.830951]  register_ftrace_function+0x43/0x90
[   78.831709]  perf_ftrace_event_register+0xc1/0xf0
[   78.832492]  perf_trace_event_init+0xa0/0x4c0
[   78.833279]  perf_trace_init+0xda/0x160
[   78.833980]  perf_tp_event_init+0x57/0xa0
[   78.834674]  perf_try_init_event+0x83/0x270
[   78.835457]  perf_event_alloc+0xe3f/0x1c10
[   78.836105]  ? _raw_spin_unlock+0x2c/0x50
[   78.836775]  ? alloc_fd+0x20d/0x320
[   78.837532]  __do_sys_perf_event_open+0x3bf/0x1de0
[   78.838327]  ? write_comp_data+0x2f/0x90
[   78.839530]  __x64_sys_perf_event_open+0x26/0x30
[   78.840280]  do_syscall_64+0x37/0x80
[   78.840892]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   78.841667] RIP: 0033:0x7fac0740459d
[   78.842258] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   78.844842] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   78.845969] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   78.847008] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   78.848044] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   78.849080] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   78.850114] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   78.851527] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   78.851694] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   78.852485] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   78.853475] caller is debug_smp_processor_id+0x1c/0x20
[   78.854847] Call Trace:
[   78.854874]  dump_stack_lvl+0xa4/0xd3
[   78.854938]  dump_stack+0x15/0x17
[   78.854974]  check_preemption_disabled+0x167/0x180
[   78.855012]  ? prepare_to_swait_event+0x1b/0xf0
[   78.858019]  ? _raw_read_lock_irqsave+0x90/0x90
[   78.858641]  debug_smp_processor_id+0x1c/0x20
[   78.859222]  perf_ftrace_function_call+0x7c/0x360
[   78.859834]  ? ftrace_ops_test+0x71/0xc0
[   78.860444]  ? trace_hardirqs_on+0x3f/0x170
[   78.861041]  ? write_comp_data+0x2f/0x90
[   78.861579]  ? perf_trace_buf_update+0x70/0x70
[   78.862171]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   78.862867]  0xffffffffa0098099
[   78.863346]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   78.864005]  ? del_timer_sync+0xde/0x130
[   78.864570]  ? _raw_spin_lock_irqsave+0x5/0x70
[   78.865198]  _raw_spin_lock_irqsave+0x5/0x70
[   78.865771]  prepare_to_swait_event+0x1b/0xf0
[   78.866354]  ? _raw_spin_lock_irqsave+0x5/0x70
[   78.866935]  ? prepare_to_swait_event+0x1b/0xf0
[   78.867562]  rcu_gp_fqs_loop+0x2b4/0x410
[   78.868154]  ? rcu_gp_init+0x730/0x730
[   78.868662]  rcu_gp_kthread+0xdd/0x170
[   78.869217]  kthread+0x1e7/0x230
[   78.869675]  ? set_kthread_struct+0x80/0x80
[   78.870277]  ret_from_fork+0x1f/0x30
[   78.870951] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   78.871064] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[   78.871923] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   78.872897] caller is debug_smp_processor_id+0x1c/0x20
[   78.874359] Call Trace:
[   78.874395]  dump_stack_lvl+0xa4/0xd3
[   78.874476]  dump_stack+0x15/0x17
[   78.876360]  check_preemption_disabled+0x167/0x180
[   78.877105]  debug_smp_processor_id+0x1c/0x20
[   78.877736]  perf_trace_buf_alloc+0x98/0x100
[   78.878360]  ? insn_get_opcode+0x1d5/0x3b0
[   78.878943]  ? insn_decode_from_regs+0x110/0x110
[   78.879614]  perf_ftrace_function_call+0x209/0x360
[   78.880527]  ? 0xffffffffa0098099
[   78.881153]  0xffffffffa0098099
[   78.881698]  ? 0xffffffffa0098099
[   78.882241]  ? insn_get_opcode+0x49/0x3b0
[   78.882863]  ? insn_get_prefixes.part.1+0x5/0x650
[   78.883535]  ? write_comp_data+0x2f/0x90
[   78.884132]  insn_get_prefixes.part.1+0x5/0x650
[   78.884782]  insn_get_opcode+0x1d5/0x3b0
[   78.885356]  ? insn_get_prefixes.part.1+0x5/0x650
[   78.886014]  ? insn_get_opcode+0x1d5/0x3b0
[   78.886673]  insn_get_modrm+0x12b/0x2a0
[   78.887296]  insn_get_sib+0x122/0x140
[   78.887887]  insn_get_displacement+0x157/0x270
[   78.888574]  insn_get_immediate+0x181/0x570
[   78.889241]  insn_get_length+0x75/0x90
[   78.889829]  insn_decode+0x9b/0x170
[   78.890375]  ? selinux_inode_listxattr+0x90/0x90
[   78.891038]  text_poke_loc_init+0x63/0x140
[   78.891802]  ? selinux_inode_listxattr+0x90/0x90
[   78.892514]  text_poke_queue+0x84/0xc0
[   78.893117]  ftrace_replace_code+0xfd/0x170
[   78.893785]  ftrace_modify_all_code+0x1b1/0x270
[   78.894486]  arch_ftrace_update_code+0x9/0x10
[   78.895121]  ftrace_run_update_code+0x30/0xa0
[   78.895777]  ftrace_startup_enable+0x5e/0xa0
[   78.896420]  ftrace_startup+0x16d/0x240
[   78.897069]  register_ftrace_function+0x43/0x90
[   78.897745]  perf_ftrace_event_register+0xc1/0xf0
[   78.898452]  perf_trace_event_init+0xa0/0x4c0
[   78.899142]  perf_trace_init+0xda/0x160
[   78.899756]  perf_tp_event_init+0x57/0xa0
[   78.900368]  perf_try_init_event+0x83/0x270
[   78.901048]  perf_event_alloc+0xe3f/0x1c10
[   78.901636]  ? _raw_spin_unlock+0x2c/0x50
[   78.902239]  ? alloc_fd+0x20d/0x320
[   78.902879]  __do_sys_perf_event_open+0x3bf/0x1de0
[   78.903586]  ? write_comp_data+0x2f/0x90
[   78.904548]  __x64_sys_perf_event_open+0x26/0x30
[   78.905222]  do_syscall_64+0x37/0x80
[   78.905766]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   78.906475] RIP: 0033:0x7fac0740459d
[   78.906999] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   78.909392] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   78.910425] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   78.911372] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   78.912320] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   78.913270] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   78.914224] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   78.915426] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   78.915591] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   78.916381] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   78.917367] caller is debug_smp_processor_id+0x1c/0x20
[   78.918730] Call Trace:
[   78.918757]  dump_stack_lvl+0xa4/0xd3
[   78.918822]  dump_stack+0x15/0x17
[   78.918857]  check_preemption_disabled+0x167/0x180
[   78.918895]  ? finish_swait+0x41/0x80
[   78.921796]  ? _raw_read_lock_irqsave+0x90/0x90
[   78.922417]  debug_smp_processor_id+0x1c/0x20
[   78.922998]  perf_ftrace_function_call+0x7c/0x360
[   78.923609]  ? ftrace_ops_test+0x71/0xc0
[   78.924144]  ? rcu_advance_cbs+0x70/0x70
[   78.924698]  ? write_comp_data+0x2f/0x90
[   78.925234]  ? perf_trace_buf_update+0x70/0x70
[   78.925823]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   78.926463]  ? write_comp_data+0x2f/0x90
[   78.927000]  ? perf_trace_buf_update+0x70/0x70
[   78.927588]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   78.928280]  0xffffffffa0098099
[   78.928775]  ? trace_hardirqs_on+0x3f/0x170
[   78.929403]  ? _raw_spin_lock_irqsave+0x5/0x70
[   78.930030]  _raw_spin_lock_irqsave+0x5/0x70
[   78.930604]  finish_swait+0x41/0x80
[   78.931081]  ? _raw_spin_lock_irqsave+0x5/0x70
[   78.931660]  ? finish_swait+0x41/0x80
[   78.932184]  rcu_gp_fqs_loop+0x2da/0x410
[   78.932774]  ? rcu_gp_init+0x730/0x730
[   78.933280]  rcu_gp_kthread+0xdd/0x170
[   78.933833]  kthread+0x1e7/0x230
[   78.934300]  ? set_kthread_struct+0x80/0x80
[   78.934895]  ret_from_fork+0x1f/0x30
[   78.935568] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   78.935681] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[   78.936540] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   78.937510] caller is debug_smp_processor_id+0x1c/0x20
[   78.939000] Call Trace:
[   78.939037]  dump_stack_lvl+0xa4/0xd3
[   78.939119]  dump_stack+0x15/0x17
[   78.941026]  check_preemption_disabled+0x167/0x180
[   78.941785]  debug_smp_processor_id+0x1c/0x20
[   78.942436]  perf_swevent_put_recursion_context+0x1b/0x40
[   78.943227]  perf_tp_event+0x331/0x4e0
[   78.943986]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[   78.944914]  ? arch_local_irq_enable+0x10/0x12
[   78.945566]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   78.946275]  ? dump_stack_lvl+0xcc/0xd3
[   78.946912]  ? insn_get_opcode+0x1d5/0x3b0
[   78.947495]  ? insn_decode_from_regs+0x110/0x110
[   78.948181]  perf_ftrace_function_call+0x248/0x360
[   78.948889]  ? perf_trace_buf_alloc+0xb0/0x100
[   78.949532]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   78.950218]  ? perf_ftrace_function_call+0x248/0x360
[   78.951178]  ? 0xffffffffa0098099
[   78.951829]  0xffffffffa0098099
[   78.952399]  ? 0xffffffffa0098099
[   78.952947]  ? insn_get_opcode+0x49/0x3b0
[   78.953578]  ? insn_get_prefixes.part.1+0x5/0x650
[   78.954277]  ? write_comp_data+0x2f/0x90
[   78.954882]  insn_get_prefixes.part.1+0x5/0x650
[   78.955540]  insn_get_opcode+0x1d5/0x3b0
[   78.956121]  ? insn_get_prefixes.part.1+0x5/0x650
[   78.956790]  ? insn_get_opcode+0x1d5/0x3b0
[   78.957462]  insn_get_modrm+0x12b/0x2a0
[   78.958096]  insn_get_sib+0x122/0x140
[   78.958702]  insn_get_displacement+0x157/0x270
[   78.959392]  insn_get_immediate+0x181/0x570
[   78.960074]  insn_get_length+0x75/0x90
[   78.960665]  insn_decode+0x9b/0x170
[   78.961211]  ? selinux_inode_listxattr+0x90/0x90
[   78.961874]  text_poke_loc_init+0x63/0x140
[   78.962650]  ? selinux_inode_listxattr+0x90/0x90
[   78.963363]  text_poke_queue+0x84/0xc0
[   78.963968]  ftrace_replace_code+0xfd/0x170
[   78.964638]  ftrace_modify_all_code+0x1b1/0x270
[   78.965341]  arch_ftrace_update_code+0x9/0x10
[   78.965973]  ftrace_run_update_code+0x30/0xa0
[   78.966639]  ftrace_startup_enable+0x5e/0xa0
[   78.967282]  ftrace_startup+0x16d/0x240
[   78.967932]  register_ftrace_function+0x43/0x90
[   78.968609]  perf_ftrace_event_register+0xc1/0xf0
[   78.969309]  perf_trace_event_init+0xa0/0x4c0
[   78.970000]  perf_trace_init+0xda/0x160
[   78.970622]  perf_tp_event_init+0x57/0xa0
[   78.971246]  perf_try_init_event+0x83/0x270
[   78.971932]  perf_event_alloc+0xe3f/0x1c10
[   78.972519]  ? _raw_spin_unlock+0x2c/0x50
[   78.973119]  ? alloc_fd+0x20d/0x320
[   78.973760]  __do_sys_perf_event_open+0x3bf/0x1de0
[   78.974481]  ? write_comp_data+0x2f/0x90
[   78.975442]  __x64_sys_perf_event_open+0x26/0x30
[   78.976117]  do_syscall_64+0x37/0x80
[   78.976661]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   78.977370] RIP: 0033:0x7fac0740459d
[   78.977897] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   78.980262] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   78.981303] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   78.982257] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   78.983206] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   78.984154] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   78.985103] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   78.986427] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   78.986616] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   78.987404] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   78.988485] caller is debug_smp_processor_id+0x1c/0x20
[   78.989847] Call Trace:
[   78.990927]  dump_stack_lvl+0xa4/0xd3
[   78.991456]  dump_stack+0x15/0x17
[   78.991914]  check_preemption_disabled+0x167/0x180
[   78.992546]  ? force_qs_rnp+0xd0/0x2c0
[   78.993044]  ? preempt_schedule+0x30/0x30
[   78.993601]  debug_smp_processor_id+0x1c/0x20
[   78.994186]  perf_ftrace_function_call+0x7c/0x360
[   78.994799]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   78.995447]  ? ftrace_ops_test+0x71/0xc0
[   78.995984]  ? rcu_advance_cbs+0x70/0x70
[   78.996539]  ? write_comp_data+0x2f/0x90
[   78.997077]  ? perf_trace_buf_update+0x70/0x70
[   78.997666]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   78.998306]  ? ftrace_ops_list_func+0x1d2/0x2e0
[   78.998899]  ? force_qs_rnp+0xcb/0x2c0
[   78.999406]  ? sched_show_task+0x70/0x70
[   78.999962]  ? rcu_gp_torture_wait+0x20/0x20
[   79.000544]  0xffffffffa0098099
[   79.000977]  ? rcu_exp_wait_wake+0x4c0/0x4c0
[   79.001674]  ? __cond_resched+0x5/0x30
[   79.002204]  ? ___might_sleep+0x143/0x170
[   79.002742]  __cond_resched+0x5/0x30
[   79.003230]  force_qs_rnp+0xd0/0x2c0
[   79.003718]  ? __cond_resched+0x5/0x30
[   79.004216]  ? force_qs_rnp+0xd0/0x2c0
[   79.004787]  rcu_gp_fqs_loop+0x2eb/0x410
[   79.005378]  ? rcu_gp_init+0x730/0x730
[   79.005887]  rcu_gp_kthread+0xdd/0x170
[   79.006444]  kthread+0x1e7/0x230
[   79.006904]  ? set_kthread_struct+0x80/0x80
[   79.007502]  ret_from_fork+0x1f/0x30
[   79.008182] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   79.008338] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   79.009249] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   79.010384] caller is debug_smp_processor_id+0x1c/0x20
[   79.011909] Call Trace:
[   79.012967]  dump_stack_lvl+0xa4/0xd3
[   79.013628]  dump_stack+0x15/0x17
[   79.014197]  check_preemption_disabled+0x167/0x180
[   79.014954]  ? insn_get_prefixes.part.1+0x114/0x650
[   79.015703]  ? bad_get_user+0xd/0xd
[   79.016323]  debug_smp_processor_id+0x1c/0x20
[   79.017023]  perf_ftrace_function_call+0x7c/0x360
[   79.017769]  ? perf_ftrace_function_call+0x248/0x360
[   79.018569]  ? perf_trace_buf_alloc+0xb0/0x100
[   79.019280]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   79.020025]  ? insn_get_opcode+0x1d5/0x3b0
[   79.020685]  ? perf_ftrace_function_call+0x4c/0x360
[   79.021807]  0xffffffffa0098099
[   79.022533]  ? insn_get_prefixes.part.1+0xb3/0x650
[   79.023342]  ? inat_get_opcode_attribute+0x5/0x20
[   79.024087]  ? write_comp_data+0x2f/0x90
[   79.024763]  inat_get_opcode_attribute+0x5/0x20
[   79.025495]  insn_get_prefixes.part.1+0x114/0x650
[   79.026248]  ? inat_get_opcode_attribute+0x5/0x20
[   79.026975]  ? insn_get_prefixes.part.1+0x114/0x650
[   79.027740]  ? write_comp_data+0x2f/0x90
[   79.028502]  insn_get_opcode+0x1d5/0x3b0
[   79.029228]  insn_get_modrm+0x12b/0x2a0
[   79.029944]  insn_get_sib+0x122/0x140
[   79.030623]  insn_get_displacement+0x157/0x270
[   79.031403]  insn_get_immediate+0x181/0x570
[   79.032164]  insn_get_length+0x75/0x90
[   79.032836]  insn_decode+0x9b/0x170
[   79.033452]  ? selinux_inode_listxattr+0x90/0x90
[   79.034196]  text_poke_loc_init+0x63/0x140
[   79.035106]  ? selinux_inode_listxattr+0x90/0x90
[   79.035911]  text_poke_queue+0x84/0xc0
[   79.036603]  ftrace_replace_code+0xfd/0x170
[   79.037367]  ftrace_modify_all_code+0x1b1/0x270
[   79.038165]  arch_ftrace_update_code+0x9/0x10
[   79.038863]  ftrace_run_update_code+0x30/0xa0
[   79.039594]  ftrace_startup_enable+0x5e/0xa0
[   79.040315]  ftrace_startup+0x16d/0x240
[   79.041069]  register_ftrace_function+0x43/0x90
[   79.041826]  perf_ftrace_event_register+0xc1/0xf0
[   79.042612]  perf_trace_event_init+0xa0/0x4c0
[   79.043401]  perf_trace_init+0xda/0x160
[   79.044104]  perf_tp_event_init+0x57/0xa0
[   79.044792]  perf_try_init_event+0x83/0x270
[   79.045578]  perf_event_alloc+0xe3f/0x1c10
[   79.046230]  ? _raw_spin_unlock+0x2c/0x50
[   79.046899]  ? alloc_fd+0x20d/0x320
[   79.047654]  __do_sys_perf_event_open+0x3bf/0x1de0
[   79.048444]  ? write_comp_data+0x2f/0x90
[   79.049647]  __x64_sys_perf_event_open+0x26/0x30
[   79.050401]  do_syscall_64+0x37/0x80
[   79.051013]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   79.051790] RIP: 0033:0x7fac0740459d
[   79.052376] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   79.054963] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   79.056091] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   79.057125] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   79.058163] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   79.059197] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   79.060233] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   79.061639] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   79.062687] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   79.064107] Call Trace:
[   79.064463]  dump_stack_lvl+0xa4/0xd3
[   79.065002]  dump_stack+0x15/0x17
[   79.065477]  check_preemption_disabled+0x167/0x180
[   79.066127]  ? do_epoll_wait+0x3b3/0xd80
[   79.066664]  ? __mutex_lock+0x9f0/0x9f0
[   79.067211]  debug_smp_processor_id+0x1c/0x20
[   79.067805]  perf_ftrace_function_call+0x7c/0x360
[   79.068495]  ? ftrace_call+0x5/0x44
[   79.068973]  ? trace_hardirqs_on+0x6a/0x170
[   79.069580]  ? finish_task_switch+0xb0/0x2a0
[   79.070155]  ? finish_task_switch+0x70/0x2a0
[   79.070754]  ? trace_hardirqs_on+0x3f/0x170
[   79.071314]  ? finish_task_switch+0x70/0x2a0
[   79.071913]  ? preempt_count_sub+0x5/0xa0
[   79.072518]  0xffffffffa0098099
[   79.072969]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   79.073618]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   79.074376]  ? do_epoll_wait+0x36b/0xd80
[   79.074945]  ? mutex_lock_nested+0x5/0x20
[   79.075512]  ? write_comp_data+0x2f/0x90
[   79.076100]  mutex_lock_nested+0x5/0x20
[   79.076632]  do_epoll_wait+0x3b3/0xd80
[   79.077152]  ? mutex_lock_nested+0x5/0x20
[   79.077693]  ? do_epoll_wait+0x3b3/0xd80
[   79.078402]  ? wait_woken+0x90/0x90
[   79.078965]  __x64_sys_epoll_wait+0x8d/0xd0
[   79.079603]  do_syscall_64+0x37/0x80
[   79.080111]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   79.080794] RIP: 0033:0x7f8a39143ae0
[   79.081344] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   79.083644] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   79.084618] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   79.085530] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   79.086444] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   79.087350] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   79.088257] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   83.726107] check_preemption_disabled: 642064 callbacks suppressed
[   83.726138] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   83.728274] caller is debug_smp_processor_id+0x1c/0x20
[   83.729080] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   83.730193] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   83.731853] Call Trace:
[   83.732291]  dump_stack_lvl+0xa4/0xd3
[   83.732957]  dump_stack+0x15/0x17
[   83.733524]  check_preemption_disabled+0x167/0x180
[   83.734397]  debug_smp_processor_id+0x1c/0x20
[   83.735117]  perf_swevent_get_recursion_context+0x1e/0xd0
[   83.736058]  perf_trace_buf_alloc+0x3d/0x100
[   83.736775]  ? __get_locked_pte+0x1a2/0x290
[   83.737443]  ? __lock_text_start+0x8/0x8
[   83.738125]  perf_ftrace_function_call+0x209/0x360
[   83.739226]  ? 0xffffffffa0098099
[   83.740020]  0xffffffffa0098099
[   83.740668]  ? can_clear_store+0x1/0xf0
[   83.741426]  ? ftrace_call+0x5/0x44
[   83.742139]  ? pmd_page_vaddr+0x2b/0x70
[   83.742891]  ? _raw_spin_lock+0x5/0x50
[   83.743652]  _raw_spin_lock+0x5/0x50
[   83.744364]  __get_locked_pte+0x1a2/0x290
[   83.745155]  ? _raw_spin_lock+0x5/0x50
[   83.745881]  ? __get_locked_pte+0x1a2/0x290
[   83.746655]  ? can_clear_store+0x1/0xf0
[   83.747399]  __text_poke+0xea/0x4e0
[   83.748052]  ? can_clear_store+0x1/0xf0
[   83.748758]  ? lock_is_held_type+0xe2/0x140
[   83.749497]  ? can_clear_store+0x1/0xf0
[   83.750242]  text_poke+0x2b/0x60
[   83.750879]  text_poke_bp_batch+0xf5/0x2c0
[   83.751660]  ? md_bitmap_create+0xd30/0xd30
[   83.752452]  text_poke_queue+0xa7/0xc0
[   83.753183]  ftrace_replace_code+0xfd/0x170
[   83.753994]  ftrace_modify_all_code+0x1b1/0x270
[   83.754842]  arch_ftrace_update_code+0x9/0x10
[   83.755587]  ftrace_run_update_code+0x30/0xa0
[   83.756369]  ftrace_startup_enable+0x5e/0xa0
[   83.757138]  ftrace_startup+0x16d/0x240
[   83.757933]  register_ftrace_function+0x43/0x90
[   83.758743]  perf_ftrace_event_register+0xc1/0xf0
[   83.759577]  perf_trace_event_init+0xa0/0x4c0
[   83.760412]  perf_trace_init+0xda/0x160
[   83.761152]  perf_tp_event_init+0x57/0xa0
[   83.761883]  perf_try_init_event+0x83/0x270
[   83.762717]  perf_event_alloc+0xe3f/0x1c10
[   83.763409]  ? _raw_spin_unlock+0x2c/0x50
[   83.764122]  ? alloc_fd+0x20d/0x320
[   83.764918]  __do_sys_perf_event_open+0x3bf/0x1de0
[   83.765761]  ? write_comp_data+0x2f/0x90
[   83.767016]  __x64_sys_perf_event_open+0x26/0x30
[   83.767817]  do_syscall_64+0x37/0x80
[   83.768470]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   83.769300] RIP: 0033:0x7fac0740459d
[   83.769932] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   83.772724] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   83.773936] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   83.775051] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   83.776182] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   83.777288] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   83.778361] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   83.780095] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   83.780119] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   83.781198] caller is debug_smp_processor_id+0x1c/0x20
[   83.782537] caller is debug_smp_processor_id+0x1c/0x20
[   83.783274] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   83.785006] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   83.786626] Call Trace:
[   83.787034]  dump_stack_lvl+0xa4/0xd3
[   83.787655]  dump_stack+0x15/0x17
[   83.788188]  check_preemption_disabled+0x167/0x180
[   83.788985]  debug_smp_processor_id+0x1c/0x20
[   83.789664]  perf_trace_buf_alloc+0x98/0x100
[   83.790335]  ? __get_locked_pte+0x1a2/0x290
[   83.790974]  ? __lock_text_start+0x8/0x8
[   83.791603]  perf_ftrace_function_call+0x209/0x360
[   83.792567]  ? 0xffffffffa0098099
[   83.793229]  0xffffffffa0098099
[   83.793770]  ? can_clear_store+0x1/0xf0
[   83.794401]  ? ftrace_call+0x5/0x44
[   83.794982]  ? pmd_page_vaddr+0x2b/0x70
[   83.795622]  ? _raw_spin_lock+0x5/0x50
[   83.796265]  _raw_spin_lock+0x5/0x50
[   83.796837]  __get_locked_pte+0x1a2/0x290
[   83.797465]  ? _raw_spin_lock+0x5/0x50
[   83.798046]  ? __get_locked_pte+0x1a2/0x290
[   83.798725]  ? can_clear_store+0x1/0xf0
[   83.799352]  __text_poke+0xea/0x4e0
[   83.799917]  ? can_clear_store+0x1/0xf0
[   83.800544]  ? lock_is_held_type+0xe2/0x140
[   83.801208]  ? can_clear_store+0x1/0xf0
[   83.801859]  text_poke+0x2b/0x60
[   83.802422]  text_poke_bp_batch+0xf5/0x2c0
[   83.803111]  ? md_bitmap_create+0xd30/0xd30
[   83.803808]  text_poke_queue+0xa7/0xc0
[   83.804450]  ftrace_replace_code+0xfd/0x170
[   83.805161]  ftrace_modify_all_code+0x1b1/0x270
[   83.805907]  arch_ftrace_update_code+0x9/0x10
[   83.806586]  ftrace_run_update_code+0x30/0xa0
[   83.807287]  ftrace_startup_enable+0x5e/0xa0
[   83.807974]  ftrace_startup+0x16d/0x240
[   83.808663]  register_ftrace_function+0x43/0x90
[   83.809386]  perf_ftrace_event_register+0xc1/0xf0
[   83.810138]  perf_trace_event_init+0xa0/0x4c0
[   83.810881]  perf_trace_init+0xda/0x160
[   83.811537]  perf_tp_event_init+0x57/0xa0
[   83.812189]  perf_try_init_event+0x83/0x270
[   83.812914]  perf_event_alloc+0xe3f/0x1c10
[   83.813543]  ? _raw_spin_unlock+0x2c/0x50
[   83.814188]  ? alloc_fd+0x20d/0x320
[   83.814864]  __do_sys_perf_event_open+0x3bf/0x1de0
[   83.815621]  ? write_comp_data+0x2f/0x90
[   83.816623]  __x64_sys_perf_event_open+0x26/0x30
[   83.817345]  do_syscall_64+0x37/0x80
[   83.817926]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   83.818688] RIP: 0033:0x7fac0740459d
[   83.819252] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   83.821841] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   83.822956] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   83.823982] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   83.825008] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   83.826033] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   83.827066] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   83.828348] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   83.828519] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   83.829469] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   83.830708] caller is debug_smp_processor_id+0x1c/0x20
[   83.832081] Call Trace:
[   83.833188]  dump_stack_lvl+0xa4/0xd3
[   83.833765]  dump_stack+0x15/0x17
[   83.834272]  check_preemption_disabled+0x167/0x180
[   83.834970]  ? do_epoll_wait+0x3b3/0xd80
[   83.835548]  ? __mutex_lock+0x9f0/0x9f0
[   83.836138]  debug_smp_processor_id+0x1c/0x20
[   83.836780]  perf_ftrace_function_call+0x7c/0x360
[   83.837522]  ? ftrace_call+0x5/0x44
[   83.838037]  ? trace_hardirqs_on+0x6a/0x170
[   83.838696]  ? finish_task_switch+0xb0/0x2a0
[   83.839318]  ? finish_task_switch+0x70/0x2a0
[   83.839965]  ? trace_hardirqs_on+0x3f/0x170
[   83.840573]  ? finish_task_switch+0x70/0x2a0
[   83.841219]  ? preempt_count_sub+0x5/0xa0
[   83.841870]  0xffffffffa0098099
[   83.842359]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   83.843061]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   83.843873]  ? do_epoll_wait+0x36b/0xd80
[   83.844486]  ? mutex_lock_nested+0x5/0x20
[   83.845080]  ? write_comp_data+0x2f/0x90
[   83.845680]  mutex_lock_nested+0x5/0x20
[   83.846255]  do_epoll_wait+0x3b3/0xd80
[   83.846818]  ? mutex_lock_nested+0x5/0x20
[   83.847415]  ? do_epoll_wait+0x3b3/0xd80
[   83.848155]  ? wait_woken+0x90/0x90
[   83.848753]  __x64_sys_epoll_wait+0x8d/0xd0
[   83.849441]  do_syscall_64+0x37/0x80
[   83.849987]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   83.850717] RIP: 0033:0x7f8a39143ae0
[   83.851251] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   83.853737] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   83.854801] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   83.855780] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   83.856759] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   83.857745] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   83.858732] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   83.859909] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   83.860072] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   83.860965] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   83.862182] caller is debug_smp_processor_id+0x1c/0x20
[   83.863713] Call Trace:
[   83.864809]  dump_stack_lvl+0xa4/0xd3
[   83.865429]  dump_stack+0x15/0x17
[   83.865967]  check_preemption_disabled+0x167/0x180
[   83.866781]  debug_smp_processor_id+0x1c/0x20
[   83.867461]  perf_swevent_put_recursion_context+0x1b/0x40
[   83.868307]  perf_tp_event+0x331/0x4e0
[   83.869241]  ? arch_local_irq_enable+0x10/0x12
[   83.869943]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   83.870701]  ? dump_stack_lvl+0xcc/0xd3
[   83.871344]  ? dump_stack+0x15/0x17
[   83.871903]  ? check_preemption_disabled+0x167/0x180
[   83.872725]  ? __get_locked_pte+0x1a2/0x290
[   83.873367]  ? __lock_text_start+0x8/0x8
[   83.874012]  perf_ftrace_function_call+0x248/0x360
[   83.874748]  ? perf_ftrace_function_call+0x248/0x360
[   83.875764]  ? 0xffffffffa0098099
[   83.876428]  0xffffffffa0098099
[   83.876971]  ? can_clear_store+0x1/0xf0
[   83.877601]  ? ftrace_call+0x5/0x44
[   83.878190]  ? pmd_page_vaddr+0x2b/0x70
[   83.878830]  ? _raw_spin_lock+0x5/0x50
[   83.879476]  _raw_spin_lock+0x5/0x50
[   83.880051]  __get_locked_pte+0x1a2/0x290
[   83.880682]  ? _raw_spin_lock+0x5/0x50
[   83.881266]  ? __get_locked_pte+0x1a2/0x290
[   83.881945]  ? can_clear_store+0x1/0xf0
[   83.882580]  __text_poke+0xea/0x4e0
[   83.883142]  ? can_clear_store+0x1/0xf0
[   83.883781]  ? lock_is_held_type+0xe2/0x140
[   83.884447]  ? can_clear_store+0x1/0xf0
[   83.885101]  text_poke+0x2b/0x60
[   83.885663]  text_poke_bp_batch+0xf5/0x2c0
[   83.886361]  ? md_bitmap_create+0xd30/0xd30
[   83.887064]  text_poke_queue+0xa7/0xc0
[   83.887711]  ftrace_replace_code+0xfd/0x170
[   83.888426]  ftrace_modify_all_code+0x1b1/0x270
[   83.889176]  arch_ftrace_update_code+0x9/0x10
[   83.889854]  ftrace_run_update_code+0x30/0xa0
[   83.890564]  ftrace_startup_enable+0x5e/0xa0
[   83.891254]  ftrace_startup+0x16d/0x240
[   83.891948]  register_ftrace_function+0x43/0x90
[   83.892677]  perf_ftrace_event_register+0xc1/0xf0
[   83.893430]  perf_trace_event_init+0xa0/0x4c0
[   83.894178]  perf_trace_init+0xda/0x160
[   83.894836]  perf_tp_event_init+0x57/0xa0
[   83.895490]  perf_try_init_event+0x83/0x270
[   83.896218]  perf_event_alloc+0xe3f/0x1c10
[   83.896849]  ? _raw_spin_unlock+0x2c/0x50
[   83.897494]  ? alloc_fd+0x20d/0x320
[   83.898176]  __do_sys_perf_event_open+0x3bf/0x1de0
[   83.898938]  ? write_comp_data+0x2f/0x90
[   83.899941]  __x64_sys_perf_event_open+0x26/0x30
[   83.900666]  do_syscall_64+0x37/0x80
[   83.901251]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   83.902014] RIP: 0033:0x7fac0740459d
[   83.902584] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   83.905183] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   83.906307] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   83.907337] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   83.908364] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   83.909394] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   83.910426] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   83.911709] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   83.911906] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   83.912826] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   83.914143] caller is debug_smp_processor_id+0x1c/0x20
[   83.915505] Call Trace:
[   83.916666]  dump_stack_lvl+0xa4/0xd3
[   83.917244]  dump_stack+0x15/0x17
[   83.917746]  check_preemption_disabled+0x167/0x180
[   83.918447]  ? mutex_lock_nested+0x1b/0x20
[   83.919043]  ? mutex_lock_io_nested+0x940/0x940
[   83.919724]  debug_smp_processor_id+0x1c/0x20
[   83.920364]  perf_ftrace_function_call+0x7c/0x360
[   83.921050]  ? perf_ftrace_function_call+0x4c/0x360
[   83.921820]  ? ftrace_call+0x5/0x44
[   83.922340]  ? trace_hardirqs_on+0x6a/0x170
[   83.922994]  ? finish_task_switch+0xb0/0x2a0
[   83.923612]  ? finish_task_switch+0x70/0x2a0
[   83.924258]  ? trace_hardirqs_on+0x3f/0x170
[   83.924865]  ? finish_task_switch+0x70/0x2a0
[   83.925568]  0xffffffffa0098099
[   83.926053]  ? 0xffffffffa0098099
[   83.926563]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   83.927265]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   83.928041]  ? do_epoll_wait+0x3b3/0xd80
[   83.928671]  ? __mutex_lock+0x5/0x9f0
[   83.929218]  ? mutex_lock_nested+0x5/0x20
[   83.929811]  ? write_comp_data+0x2f/0x90
[   83.930400]  __mutex_lock+0x5/0x9f0
[   83.930928]  mutex_lock_nested+0x1b/0x20
[   83.931511]  ? __mutex_lock+0x5/0x9f0
[   83.932049]  ? mutex_lock_nested+0x1b/0x20
[   83.932654]  do_epoll_wait+0x3b3/0xd80
[   83.933373]  ? wait_woken+0x90/0x90
[   83.933971]  __x64_sys_epoll_wait+0x8d/0xd0
[   83.934657]  do_syscall_64+0x37/0x80
[   83.935202]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   83.935922] RIP: 0033:0x7f8a39143ae0
[   83.936454] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   83.938942] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   83.940004] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   83.940984] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   83.941984] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   83.942976] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   83.943956] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   83.945147] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   83.945264] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   83.946294] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   83.946328] Call Trace:
[   83.946378]  dump_stack_lvl+0xa4/0xd3
[   83.947494] caller is debug_smp_processor_id+0x1c/0x20
[   83.949273]  dump_stack+0x15/0x17
[   83.951492]  check_preemption_disabled+0x167/0x180
[   83.952304]  ? __get_locked_pte+0x1a2/0x290
[   83.953005]  ? __lock_text_start+0x8/0x8
[   83.953725]  debug_smp_processor_id+0x1c/0x20
[   83.954479]  perf_ftrace_function_call+0x7c/0x360
[   83.955561]  ? ftrace_ops_list_func+0x259/0x2e0
[   83.956349]  ? write_comp_data+0x2f/0x90
[   83.957048]  ? perf_trace_buf_update+0x70/0x70
[   83.957933]  0xffffffffa0098099
[   83.958563]  ? metadata_store+0x1/0x140
[   83.959268]  ? ftrace_call+0x5/0x44
[   83.959923]  ? pmd_page_vaddr+0x2b/0x70
[   83.960645]  ? _raw_spin_lock+0x5/0x50
[   83.961376]  _raw_spin_lock+0x5/0x50
[   83.962011]  __get_locked_pte+0x1a2/0x290
[   83.962711]  ? _raw_spin_lock+0x5/0x50
[   83.963352]  ? __get_locked_pte+0x1a2/0x290
[   83.964107]  ? metadata_store+0x1/0x140
[   83.964811]  __text_poke+0xea/0x4e0
[   83.965434]  ? metadata_store+0x1/0x140
[   83.966142]  ? lock_is_held_type+0xe2/0x140
[   83.966881]  ? metadata_store+0x1/0x140
[   83.967620]  text_poke+0x2b/0x60
[   83.968255]  text_poke_bp_batch+0xf5/0x2c0
[   83.969034]  ? md_bitmap_create+0xd30/0xd30
[   83.969824]  text_poke_queue+0xa7/0xc0
[   83.970684]  ftrace_replace_code+0xfd/0x170
[   83.971542]  ftrace_modify_all_code+0x1b1/0x270
[   83.972385]  arch_ftrace_update_code+0x9/0x10
[   83.973130]  ftrace_run_update_code+0x30/0xa0
[   83.973913]  ftrace_startup_enable+0x5e/0xa0
[   83.974687]  ftrace_startup+0x16d/0x240
[   83.975480]  register_ftrace_function+0x43/0x90
[   83.976287]  perf_ftrace_event_register+0xc1/0xf0
[   83.977120]  perf_trace_event_init+0xa0/0x4c0
[   83.977955]  perf_trace_init+0xda/0x160
[   83.978701]  perf_tp_event_init+0x57/0xa0
[   83.979434]  perf_try_init_event+0x83/0x270
[   83.980262]  perf_event_alloc+0xe3f/0x1c10
[   83.980955]  ? _raw_spin_unlock+0x2c/0x50
[   83.981669]  ? alloc_fd+0x20d/0x320
[   83.982468]  __do_sys_perf_event_open+0x3bf/0x1de0
[   83.983315]  ? write_comp_data+0x2f/0x90
[   83.984564]  __x64_sys_perf_event_open+0x26/0x30
[   83.985366]  do_syscall_64+0x37/0x80
[   83.986017]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   83.986850] RIP: 0033:0x7fac0740459d
[   83.987476] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   83.990260] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   83.991471] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   83.992583] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   83.993694] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   83.994811] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   83.995923] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   83.997408] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   83.997584] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   83.998537] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   83.998558] Call Trace:
[   83.998585]  dump_stack_lvl+0xa4/0xd3
[   83.998649]  dump_stack+0x15/0x17
[   83.998684]  check_preemption_disabled+0x167/0x180
[   83.999837] caller is debug_smp_processor_id+0x1c/0x20
[   84.001354]  ? ep_start_scan+0x68/0x100
[   84.004598]  ? _raw_read_lock_irq+0xa0/0xa0
[   84.005233]  debug_smp_processor_id+0x1c/0x20
[   84.005873]  perf_ftrace_function_call+0x7c/0x360
[   84.006561]  ? ftrace_ops_test+0x71/0xc0
[   84.007150]  ? preempt_notifier_dec+0x20/0x20
[   84.007842]  ? ftrace_call+0x5/0x44
[   84.008403]  ? write_comp_data+0x2f/0x90
[   84.008994]  ? perf_trace_buf_update+0x70/0x70
[   84.009642]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   84.010392]  0xffffffffa0098099
[   84.010913]  ? ftrace_call+0x5/0x44
[   84.011436]  ? __mutex_lock+0xfe/0x9f0
[   84.011994]  ? do_epoll_wait+0x3b3/0xd80
[   84.012576]  ? ep_start_scan+0xe0/0x100
[   84.013174]  ? _raw_write_lock_irq+0x5/0x60
[   84.013790]  ? write_comp_data+0x2f/0x90
[   84.014399]  _raw_write_lock_irq+0x5/0x60
[   84.014993]  ep_start_scan+0x68/0x100
[   84.015542]  ? _raw_write_lock_irq+0x5/0x60
[   84.016149]  ? ep_start_scan+0x68/0x100
[   84.016757]  do_epoll_wait+0x3bf/0xd80
[   84.017475]  ? wait_woken+0x90/0x90
[   84.018072]  __x64_sys_epoll_wait+0x8d/0xd0
[   84.018762]  do_syscall_64+0x37/0x80
[   84.019307]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   84.020026] RIP: 0033:0x7f8a39143ae0
[   84.020555] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   84.023038] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   84.024089] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   84.025066] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   84.026044] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   84.027024] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   84.027998] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   84.029172] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   84.029296] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   84.030318] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   84.030352] Call Trace:
[   84.030402]  dump_stack_lvl+0xa4/0xd3
[   84.031516] caller is debug_smp_processor_id+0x1c/0x20
[   84.033290]  dump_stack+0x15/0x17
[   84.035494]  check_preemption_disabled+0x167/0x180
[   84.036394]  debug_smp_processor_id+0x1c/0x20
[   84.037140]  perf_swevent_get_recursion_context+0x1e/0xd0
[   84.038132]  perf_trace_buf_alloc+0x3d/0x100
[   84.038868]  ? __get_locked_pte+0x1a2/0x290
[   84.039572]  ? __lock_text_start+0x8/0x8
[   84.040274]  perf_ftrace_function_call+0x209/0x360
[   84.041446]  ? 0xffffffffa0098099
[   84.042236]  0xffffffffa0098099
[   84.042853]  ? metadata_store+0x1/0x140
[   84.043557]  ? ftrace_call+0x5/0x44
[   84.044212]  ? pmd_page_vaddr+0x2b/0x70
[   84.044934]  ? _raw_spin_lock+0x5/0x50
[   84.045664]  _raw_spin_lock+0x5/0x50
[   84.046303]  __get_locked_pte+0x1a2/0x290
[   84.046998]  ? _raw_spin_lock+0x5/0x50
[   84.047638]  ? __get_locked_pte+0x1a2/0x290
[   84.048394]  ? metadata_store+0x1/0x140
[   84.049098]  __text_poke+0xea/0x4e0
[   84.049720]  ? metadata_store+0x1/0x140
[   84.050427]  ? lock_is_held_type+0xe2/0x140
[   84.051166]  ? metadata_store+0x1/0x140
[   84.051906]  text_poke+0x2b/0x60
[   84.052543]  text_poke_bp_batch+0xf5/0x2c0
[   84.053323]  ? md_bitmap_create+0xd30/0xd30
[   84.054115]  text_poke_queue+0xa7/0xc0
[   84.054850]  ftrace_replace_code+0xfd/0x170
[   84.055659]  ftrace_modify_all_code+0x1b1/0x270
[   84.056500]  arch_ftrace_update_code+0x9/0x10
[   84.057246]  ftrace_run_update_code+0x30/0xa0
[   84.058028]  ftrace_startup_enable+0x5e/0xa0
[   84.058800]  ftrace_startup+0x16d/0x240
[   84.059596]  register_ftrace_function+0x43/0x90
[   84.060405]  perf_ftrace_event_register+0xc1/0xf0
[   84.061242]  perf_trace_event_init+0xa0/0x4c0
[   84.062078]  perf_trace_init+0xda/0x160
[   84.062824]  perf_tp_event_init+0x57/0xa0
[   84.063557]  perf_try_init_event+0x83/0x270
[   84.064387]  perf_event_alloc+0xe3f/0x1c10
[   84.065081]  ? _raw_spin_unlock+0x2c/0x50
[   84.065795]  ? alloc_fd+0x20d/0x320
[   84.066595]  __do_sys_perf_event_open+0x3bf/0x1de0
[   84.067441]  ? write_comp_data+0x2f/0x90
[   84.068690]  __x64_sys_perf_event_open+0x26/0x30
[   84.069501]  do_syscall_64+0x37/0x80
[   84.070163]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   84.070993] RIP: 0033:0x7fac0740459d
[   84.071618] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   84.074412] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   84.075623] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   84.076735] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   84.077848] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   84.078966] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   84.080078] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   84.081564] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   84.081735] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   84.082685] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   84.082705] Call Trace:
[   84.082732]  dump_stack_lvl+0xa4/0xd3
[   84.082797]  dump_stack+0x15/0x17
[   84.082832]  check_preemption_disabled+0x167/0x180
[   84.083901] caller is debug_smp_processor_id+0x1c/0x20
[   84.085428]  ? ep_done_scan+0x3b/0x240
[   84.088625]  ? _raw_read_lock_irq+0xa0/0xa0
[   84.089260]  debug_smp_processor_id+0x1c/0x20
[   84.089899]  perf_ftrace_function_call+0x7c/0x360
[   84.090587]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   84.091288]  ? ftrace_ops_test+0x71/0xc0
[   84.091906]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   84.092607]  ? _prb_read_valid+0x3ad/0x3f0
[   84.093259]  ? write_comp_data+0x2f/0x90
[   84.093915]  0xffffffffa0098099
[   84.094408]  ? ep_destroy_wakeup_source+0xe0/0xe0
[   84.095167]  ? do_epoll_wait+0x85a/0xd80
[   84.095776]  ? _raw_write_lock_irq+0x5/0x60
[   84.096430]  _raw_write_lock_irq+0x5/0x60
[   84.097024]  ep_done_scan+0x3b/0x240
[   84.097571]  ? _raw_write_lock_irq+0x5/0x60
[   84.098181]  ? ep_done_scan+0x3b/0x240
[   84.098815]  do_epoll_wait+0xabb/0xd80
[   84.099533]  ? wait_woken+0x90/0x90
[   84.100131]  __x64_sys_epoll_wait+0x8d/0xd0
[   84.100815]  do_syscall_64+0x37/0x80
[   84.101360]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   84.102081] RIP: 0033:0x7f8a39143ae0
[   84.102615] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   84.105095] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   84.106151] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   84.107129] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   84.108110] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   84.109087] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   84.110065] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   84.111250] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   84.112330] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   84.113964] Call Trace:
[   84.114380]  dump_stack_lvl+0xa4/0xd3
[   84.115000]  dump_stack+0x15/0x17
[   84.115537]  check_preemption_disabled+0x167/0x180
[   84.116335]  debug_smp_processor_id+0x1c/0x20
[   84.117014]  perf_trace_buf_alloc+0x98/0x100
[   84.117683]  ? __get_locked_pte+0x1a2/0x290
[   84.118326]  ? __lock_text_start+0x8/0x8
[   84.118961]  perf_ftrace_function_call+0x209/0x360
[   84.119929]  ? 0xffffffffa0098099
[   84.120593]  0xffffffffa0098099
[   84.121135]  ? metadata_store+0x1/0x140
[   84.121764]  ? ftrace_call+0x5/0x44
[   84.122355]  ? pmd_page_vaddr+0x2b/0x70
[   84.122998]  ? _raw_spin_lock+0x5/0x50
[   84.123643]  _raw_spin_lock+0x5/0x50
[   84.124217]  __get_locked_pte+0x1a2/0x290
[   84.124848]  ? _raw_spin_lock+0x5/0x50
[   84.125435]  ? __get_locked_pte+0x1a2/0x290
[   84.126113]  ? metadata_store+0x1/0x140
[   84.126751]  __text_poke+0xea/0x4e0
[   84.127310]  ? metadata_store+0x1/0x140
[   84.127940]  ? lock_is_held_type+0xe2/0x140
[   84.128603]  ? metadata_store+0x1/0x140
[   84.129256]  text_poke+0x2b/0x60
[   84.129816]  text_poke_bp_batch+0xf5/0x2c0
[   84.130514]  ? md_bitmap_create+0xd30/0xd30
[   84.131215]  text_poke_queue+0xa7/0xc0
[   84.131861]  ftrace_replace_code+0xfd/0x170
[   84.132577]  ftrace_modify_all_code+0x1b1/0x270
[   84.133327]  arch_ftrace_update_code+0x9/0x10
[   84.134006]  ftrace_run_update_code+0x30/0xa0
[   84.134714]  ftrace_startup_enable+0x5e/0xa0
[   84.135404]  ftrace_startup+0x16d/0x240
[   84.136095]  register_ftrace_function+0x43/0x90
[   84.136822]  perf_ftrace_event_register+0xc1/0xf0
[   84.137575]  perf_trace_event_init+0xa0/0x4c0
[   84.138319]  perf_trace_init+0xda/0x160
[   84.138974]  perf_tp_event_init+0x57/0xa0
[   84.139632]  perf_try_init_event+0x83/0x270
[   84.140361]  perf_event_alloc+0xe3f/0x1c10
[   84.141072]  ? _raw_spin_unlock+0x2c/0x50
[   84.141720]  ? alloc_fd+0x20d/0x320
[   84.142404]  __do_sys_perf_event_open+0x3bf/0x1de0
[   84.143171]  ? write_comp_data+0x2f/0x90
[   84.144168]  __x64_sys_perf_event_open+0x26/0x30
[   84.144891]  do_syscall_64+0x37/0x80
[   84.145471]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   84.146234] RIP: 0033:0x7fac0740459d
[   84.146798] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[   84.149396] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   84.150518] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[   84.151541] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   84.152564] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   84.153586] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   84.154623] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   88.730068] check_preemption_disabled: 883209 callbacks suppressed
[   88.730092] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   88.731960] caller is debug_smp_processor_id+0x1c/0x20
[   88.732660] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   88.733612] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   88.734156] BUG: using smp_processor_id() in preemptible [00000000] code: kworker/u4:2/92
[   88.735102] Call Trace:
[   88.736057] caller is debug_smp_processor_id+0x1c/0x20
[   88.736428]  dump_stack_lvl+0xa4/0xd3
[   88.737573]  dump_stack+0x15/0x17
[   88.738073]  check_preemption_disabled+0x167/0x180
[   88.738818]  debug_smp_processor_id+0x1c/0x20
[   88.739492]  perf_swevent_get_recursion_context+0x1e/0xd0
[   88.740385]  perf_trace_buf_alloc+0x3d/0x100
[   88.741068]  ? __text_poke+0xea/0x4e0
[   88.741652]  ? __pmd_alloc+0x420/0x420
[   88.742274]  perf_ftrace_function_call+0x209/0x360
[   88.743236]  ? 0xffffffffa0098099
[   88.743852]  ? nfs3_xdr_enc_readdir3args+0x70/0x70
[   88.744645]  0xffffffffa0098099
[   88.745184]  ? 0xffffffffa0098099
[   88.745865]  ? __get_locked_pte+0x5/0x290
[   88.746554]  __get_locked_pte+0x5/0x290
[   88.747173]  __text_poke+0xea/0x4e0
[   88.747742]  ? __get_locked_pte+0x5/0x290
[   88.748373]  ? __text_poke+0xea/0x4e0
[   88.748966]  ? nfs3_xdr_enc_readdir3args+0x70/0x70
[   88.749737]  ? lock_is_held_type+0xe2/0x140
[   88.750420]  ? nfs3_xdr_enc_readdir3args+0x70/0x70
[   88.751214]  text_poke+0x2b/0x60
[   88.751781]  text_poke_bp_batch+0x1dc/0x2c0
[   88.752490]  ? nfs4_xattr_get_nfs4_user+0x110/0x110
[   88.753299]  text_poke_queue+0xa7/0xc0
[   88.753949]  ftrace_replace_code+0xfd/0x170
[   88.754678]  ftrace_modify_all_code+0x1b1/0x270
[   88.755443]  arch_ftrace_update_code+0x9/0x10
[   88.756134]  ftrace_run_update_code+0x30/0xa0
[   88.756847]  ftrace_shutdown+0x2b8/0x4a0
[   88.757542]  unregister_ftrace_function+0x25/0x50
[   88.758295]  perf_ftrace_event_register+0x89/0xf0
[   88.759035]  ? perf_tp_event_init+0xa0/0xa0
[   88.759700]  perf_trace_destroy+0x37/0x60
[   88.760354]  tp_perf_event_destroy+0x15/0x20
[   88.761045]  _free_event+0xfc/0x7d0
[   88.761671]  put_event+0x37/0x50
[   88.762232]  perf_event_release_kernel+0x2f4/0x370
[   88.763049]  ? perf_event_release_kernel+0x370/0x370
[   88.763847]  perf_release+0x19/0x20
[   88.764427]  __fput+0x12d/0x460
[   88.765049]  ____fput+0x1a/0x20
[   88.765583]  task_work_run+0x8e/0xf0
[   88.766225]  do_exit+0x616/0x1310
[   88.766827]  ? write_comp_data+0x2f/0x90
[   88.767534]  do_group_exit+0x7e/0x130
[   88.768182]  get_signal+0x249/0x13c0
[   88.768808]  ? get_signal+0x5/0x13c0
[   88.769485]  arch_do_signal_or_restart+0xb7/0x7e0
[   88.770350]  ? arch_do_signal_or_restart+0x5/0x7e0
[   88.771199]  exit_to_user_mode_prepare+0x154/0x240
[   88.771974]  syscall_exit_to_user_mode+0x2b/0x60
[   88.772712]  do_syscall_64+0x46/0x80
[   88.773305]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   88.774087] RIP: 0033:0x7fac0740459d
[   88.774669] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   88.775635] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   88.776783] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   88.777837] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   88.778896] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   88.779948] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   88.780999] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   88.782286] CPU: 1 PID: 92 Comm: kworker/u4:2 Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   88.782426] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   88.783297] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   88.784323] caller is debug_smp_processor_id+0x1c/0x20
[   88.785755] Workqueue:  0x0 (events_unbound)
[   88.787023] Call Trace:
[   88.787358]  dump_stack_lvl+0xa4/0xd3
[   88.787855]  dump_stack+0x15/0x17
[   88.788302]  check_preemption_disabled+0x167/0x180
[   88.788933]  ? schedule+0x75/0xd0
[   88.789378]  ? max_active_store+0xc0/0xc0
[   88.789928]  debug_smp_processor_id+0x1c/0x20
[   88.790511]  perf_ftrace_function_call+0x7c/0x360
[   88.791142]  ? 0xffffffffa0098099
[   88.791586]  ? __this_cpu_preempt_check+0x1c/0x20
[   88.792221]  ? finish_task_switch+0xab/0x2a0
[   88.792785]  ? __schedule+0x46e/0xb20
[   88.793288]  0xffffffffa0098099
[   88.793709]  ? trace_hardirqs_on+0x6a/0x170
[   88.794275]  ? finish_task_switch+0xb0/0x2a0
[   88.794839]  ? finish_task_switch+0x70/0x2a0
[   88.795414]  ? wq_worker_running+0x5/0x80
[   88.795952]  wq_worker_running+0x5/0x80
[   88.796463]  schedule+0x75/0xd0
[   88.796887]  ? wq_worker_running+0x5/0x80
[   88.797418]  ? schedule+0x75/0xd0
[   88.797866]  worker_thread+0x12a/0x680
[   88.798385]  ? process_one_work+0x9a0/0x9a0
[   88.798940]  kthread+0x1e7/0x230
[   88.799380]  ? set_kthread_struct+0x80/0x80
[   88.799942]  ret_from_fork+0x1f/0x30
[   88.800457] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   88.800489] BUG: using smp_processor_id() in preemptible [00000000] code: kworker/u4:2/92
[   88.801460] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   88.802510] caller is debug_smp_processor_id+0x1c/0x20
[   88.804017] Call Trace:
[   88.805035]  dump_stack_lvl+0xa4/0xd3
[   88.805587]  dump_stack+0x15/0x17
[   88.806076]  check_preemption_disabled+0x167/0x180
[   88.806793]  debug_smp_processor_id+0x1c/0x20
[   88.807422]  perf_trace_buf_alloc+0x98/0x100
[   88.808038]  ? __text_poke+0xea/0x4e0
[   88.808569]  ? __pmd_alloc+0x420/0x420
[   88.809121]  perf_ftrace_function_call+0x209/0x360
[   88.809908]  ? 0xffffffffa0098099
[   88.810434]  ? nfs3_xdr_enc_readdir3args+0x70/0x70
[   88.811129]  0xffffffffa0098099
[   88.811603]  ? 0xffffffffa0098099
[   88.812156]  ? __get_locked_pte+0x5/0x290
[   88.812758]  __get_locked_pte+0x5/0x290
[   88.813316]  __text_poke+0xea/0x4e0
[   88.813828]  ? __get_locked_pte+0x5/0x290
[   88.814406]  ? __text_poke+0xea/0x4e0
[   88.814941]  ? nfs3_xdr_enc_readdir3args+0x70/0x70
[   88.815635]  ? lock_is_held_type+0xe2/0x140
[   88.816244]  ? nfs3_xdr_enc_readdir3args+0x70/0x70
[   88.816947]  text_poke+0x2b/0x60
[   88.817439]  text_poke_bp_batch+0x1dc/0x2c0
[   88.818075]  ? nfs4_xattr_get_nfs4_user+0x110/0x110
[   88.818797]  text_poke_queue+0xa7/0xc0
[   88.819366]  ftrace_replace_code+0xfd/0x170
[   88.819995]  ftrace_modify_all_code+0x1b1/0x270
[   88.820665]  arch_ftrace_update_code+0x9/0x10
[   88.821292]  ftrace_run_update_code+0x30/0xa0
[   88.821929]  ftrace_shutdown+0x2b8/0x4a0
[   88.822535]  unregister_ftrace_function+0x25/0x50
[   88.823213]  perf_ftrace_event_register+0x89/0xf0
[   88.823886]  ? perf_tp_event_init+0xa0/0xa0
[   88.824490]  perf_trace_destroy+0x37/0x60
[   88.825077]  tp_perf_event_destroy+0x15/0x20
[   88.825699]  _free_event+0xfc/0x7d0
[   88.826241]  put_event+0x37/0x50
[   88.826730]  perf_event_release_kernel+0x2f4/0x370
[   88.827446]  ? perf_event_release_kernel+0x370/0x370
[   88.828163]  perf_release+0x19/0x20
[   88.828682]  __fput+0x12d/0x460
[   88.829196]  ____fput+0x1a/0x20
[   88.829670]  task_work_run+0x8e/0xf0
[   88.830224]  do_exit+0x616/0x1310
[   88.830743]  ? write_comp_data+0x2f/0x90
[   88.831349]  do_group_exit+0x7e/0x130
[   88.831915]  get_signal+0x249/0x13c0
[   88.832459]  ? get_signal+0x5/0x13c0
[   88.833030]  arch_do_signal_or_restart+0xb7/0x7e0
[   88.833761]  ? arch_do_signal_or_restart+0x5/0x7e0
[   88.834497]  exit_to_user_mode_prepare+0x154/0x240
[   88.835191]  syscall_exit_to_user_mode+0x2b/0x60
[   88.835861]  do_syscall_64+0x46/0x80
[   88.836390]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   88.837108] RIP: 0033:0x7fac0740459d
[   88.837629] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   88.838526] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   88.839572] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   88.840546] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   88.841522] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   88.842499] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   88.843471] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   88.844554] CPU: 1 PID: 92 Comm: kworker/u4:2 Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   88.844724] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   88.845559] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   88.846682] caller is debug_smp_processor_id+0x1c/0x20
[   88.848032] Workqueue:  0x0 (events_unbound)
[   88.849292] Call Trace:
[   88.849624]  dump_stack_lvl+0xa4/0xd3
[   88.850132]  dump_stack+0x15/0x17
[   88.850580]  check_preemption_disabled+0x167/0x180
[   88.851210]  ? wq_worker_running+0x1c/0x80
[   88.851751]  ? kthread_func+0x70/0x70
[   88.852245]  debug_smp_processor_id+0x1c/0x20
[   88.852821]  perf_ftrace_function_call+0x7c/0x360
[   88.853442]  ? schedule+0x75/0xd0
[   88.853889]  ? perf_ftrace_function_call+0x4c/0x360
[   88.854546]  ? 0xffffffffa0098099
[   88.854991]  ? __this_cpu_preempt_check+0x1c/0x20
[   88.855636]  0xffffffffa0098099
[   88.856062]  ? 0xffffffffa0098099
[   88.856523]  ? kthread_data+0x5/0x50
[   88.857005]  ? wq_worker_running+0x5/0x80
[   88.857537]  kthread_data+0x5/0x50
[   88.857996]  wq_worker_running+0x1c/0x80
[   88.858522]  ? kthread_data+0x5/0x50
[   88.859001]  ? wq_worker_running+0x1c/0x80
[   88.859547]  schedule+0x75/0xd0
[   88.859974]  worker_thread+0x12a/0x680
[   88.860482]  ? process_one_work+0x9a0/0x9a0
[   88.861036]  kthread+0x1e7/0x230
[   88.861476]  ? set_kthread_struct+0x80/0x80
[   88.862037]  ret_from_fork+0x1f/0x30
[   88.862553] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   88.862589] BUG: using smp_processor_id() in preemptible [00000000] code: kworker/u4:2/92
[   88.863553] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   88.863569] Call Trace:
[   88.864624] caller is debug_smp_processor_id+0x1c/0x20
[   88.866160]  dump_stack_lvl+0xa4/0xd3
[   88.867727]  dump_stack+0x15/0x17
[   88.868218]  check_preemption_disabled+0x167/0x180
[   88.868930]  debug_smp_processor_id+0x1c/0x20
[   88.869560]  perf_swevent_put_recursion_context+0x1b/0x40
[   88.870340]  perf_tp_event+0x331/0x4e0
[   88.870966]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[   88.871797]  ? arch_local_irq_enable+0x10/0x12
[   88.872438]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   88.873121]  ? dump_stack_lvl+0xcc/0xd3
[   88.873696]  ? dump_stack+0x15/0x17
[   88.874227]  ? __text_poke+0xea/0x4e0
[   88.874757]  ? __pmd_alloc+0x420/0x420
[   88.875315]  perf_ftrace_function_call+0x248/0x360
[   88.875995]  ? perf_trace_buf_alloc+0xb0/0x100
[   88.876635]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   88.877309]  ? perf_ftrace_function_call+0x248/0x360
[   88.878134]  ? 0xffffffffa0098099
[   88.878666]  ? nfs3_xdr_enc_readdir3args+0x70/0x70
[   88.879362]  0xffffffffa0098099
[   88.879836]  ? 0xffffffffa0098099
[   88.880391]  ? __get_locked_pte+0x5/0x290
[   88.880993]  __get_locked_pte+0x5/0x290
[   88.881552]  __text_poke+0xea/0x4e0
[   88.882064]  ? __get_locked_pte+0x5/0x290
[   88.882651]  ? __text_poke+0xea/0x4e0
[   88.883187]  ? nfs3_xdr_enc_readdir3args+0x70/0x70
[   88.883881]  ? lock_is_held_type+0xe2/0x140
[   88.884491]  ? nfs3_xdr_enc_readdir3args+0x70/0x70
[   88.885196]  text_poke+0x2b/0x60
[   88.885689]  text_poke_bp_batch+0x1dc/0x2c0
[   88.886316]  ? nfs4_xattr_get_nfs4_user+0x110/0x110
[   88.887038]  text_poke_queue+0xa7/0xc0
[   88.887611]  ftrace_replace_code+0xfd/0x170
[   88.888241]  ftrace_modify_all_code+0x1b1/0x270
[   88.888912]  arch_ftrace_update_code+0x9/0x10
[   88.889539]  ftrace_run_update_code+0x30/0xa0
[   88.890179]  ftrace_shutdown+0x2b8/0x4a0
[   88.890780]  unregister_ftrace_function+0x25/0x50
[   88.891456]  perf_ftrace_event_register+0x89/0xf0
[   88.892130]  ? perf_tp_event_init+0xa0/0xa0
[   88.892732]  perf_trace_destroy+0x37/0x60
[   88.893319]  tp_perf_event_destroy+0x15/0x20
[   88.893941]  _free_event+0xfc/0x7d0
[   88.894484]  put_event+0x37/0x50
[   88.894972]  perf_event_release_kernel+0x2f4/0x370
[   88.895687]  ? perf_event_release_kernel+0x370/0x370
[   88.896403]  perf_release+0x19/0x20
[   88.896922]  __fput+0x12d/0x460
[   88.897438]  ____fput+0x1a/0x20
[   88.897913]  task_work_run+0x8e/0xf0
[   88.898473]  do_exit+0x616/0x1310
[   88.898992]  ? write_comp_data+0x2f/0x90
[   88.899599]  do_group_exit+0x7e/0x130
[   88.900167]  get_signal+0x249/0x13c0
[   88.900712]  ? get_signal+0x5/0x13c0
[   88.901282]  arch_do_signal_or_restart+0xb7/0x7e0
[   88.902011]  ? arch_do_signal_or_restart+0x5/0x7e0
[   88.902744]  exit_to_user_mode_prepare+0x154/0x240
[   88.903439]  syscall_exit_to_user_mode+0x2b/0x60
[   88.904106]  do_syscall_64+0x46/0x80
[   88.904638]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   88.905354] RIP: 0033:0x7fac0740459d
[   88.905874] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   88.906765] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   88.907815] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   88.908791] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   88.909769] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   88.910748] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   88.911722] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   88.912808] CPU: 1 PID: 92 Comm: kworker/u4:2 Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   88.912942] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   88.913814] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   88.915020] caller is debug_smp_processor_id+0x1c/0x20
[   88.916365] Workqueue: events_unbound flush_memcg_stats_dwork
[   88.917857] Call Trace:
[   88.918192]  dump_stack_lvl+0xa4/0xd3
[   88.918688]  dump_stack+0x15/0x17
[   88.919136]  check_preemption_disabled+0x167/0x180
[   88.919767]  ? process_one_work+0x3e6/0x9a0
[   88.920319]  ? mem_cgroup_flush_stats+0x40/0x40
[   88.920921]  debug_smp_processor_id+0x1c/0x20
[   88.921498]  perf_ftrace_function_call+0x7c/0x360
[   88.922130]  ? register_lock_class+0x42/0x440
[   88.922712]  ? 0xffffffffa0098099
[   88.923159]  ? 0xffffffffa0098099
[   88.923633]  0xffffffffa0098099
[   88.924070]  ? mem_cgroup_flush_stats+0x40/0x40
[   88.924667]  ? process_one_work+0x769/0x9a0
[   88.925225]  ? flush_memcg_stats_dwork+0x5/0x30
[   88.925824]  ? write_comp_data+0x2f/0x90
[   88.926353]  flush_memcg_stats_dwork+0x5/0x30
[   88.926931]  process_one_work+0x3e6/0x9a0
[   88.927465]  ? flush_memcg_stats_dwork+0x5/0x30
[   88.928062]  ? process_one_work+0x3e6/0x9a0
[   88.928614]  ? worker_thread+0x2c3/0x680
[   88.929157]  worker_thread+0x4e/0x680
[   88.929654]  ? process_one_work+0x9a0/0x9a0
[   88.930214]  kthread+0x1e7/0x230
[   88.930655]  ? set_kthread_struct+0x80/0x80
[   88.931218]  ret_from_fork+0x1f/0x30
[   88.931736] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   88.931767] BUG: using smp_processor_id() in preemptible [00000000] code: kworker/u4:2/92
[   88.932819] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   88.933842] caller is debug_smp_processor_id+0x1c/0x20
[   88.935483] Call Trace:
[   88.935516]  dump_stack_lvl+0xa4/0xd3
[   88.937133]  dump_stack+0x15/0x17
[   88.937679]  check_preemption_disabled+0x167/0x180
[   88.938440]  ? _raw_spin_lock+0x17/0x50
[   88.939048]  ? trace_sched_waking+0xc0/0xc0
[   88.939744]  debug_smp_processor_id+0x1c/0x20
[   88.940436]  perf_ftrace_function_call+0x7c/0x360
[   88.941296]  ? ftrace_ops_list_func+0x259/0x2e0
[   88.942021]  ? write_comp_data+0x2f/0x90
[   88.942667]  ? perf_trace_buf_update+0x70/0x70
[   88.943371]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   88.944132]  ? ftrace_ops_list_func+0x1d2/0x2e0
[   88.944913]  0xffffffffa0098099
[   88.945452]  ? ftrace_call+0x5/0x44
[   88.946044]  ? nfs3_xdr_enc_readdir3args+0x70/0x70
[   88.946835]  ? pmd_page_vaddr+0x2b/0x70
[   88.947485]  ? preempt_count_add+0x5/0xc0
[   88.948168]  preempt_count_add+0x5/0xc0
[   88.948787]  _raw_spin_lock+0x17/0x50
[   88.949386]  ? preempt_count_add+0x5/0xc0
[   88.950021]  ? _raw_spin_lock+0x17/0x50
[   88.950657]  __get_locked_pte+0x1a2/0x290
[   88.951322]  ? nfs3_xdr_enc_readdir3args+0x70/0x70
[   88.952102]  __text_poke+0xea/0x4e0
[   88.952672]  ? nfs3_xdr_enc_readdir3args+0x70/0x70
[   88.953444]  ? lock_is_held_type+0xe2/0x140
[   88.954126]  ? nfs3_xdr_enc_readdir3args+0x70/0x70
[   88.955086]  text_poke+0x2b/0x60
[   88.955663]  text_poke_bp_batch+0x1dc/0x2c0
[   88.956378]  ? nfs4_xattr_get_nfs4_user+0x110/0x110
[   88.957191]  text_poke_queue+0xa7/0xc0
[   88.957847]  ftrace_replace_code+0xfd/0x170
[   88.958576]  ftrace_modify_all_code+0x1b1/0x270
[   88.959336]  arch_ftrace_update_code+0x9/0x10
[   88.960031]  ftrace_run_update_code+0x30/0xa0
[   88.960749]  ftrace_shutdown+0x2b8/0x4a0
[   88.961447]  unregister_ftrace_function+0x25/0x50
[   88.962208]  perf_ftrace_event_register+0x89/0xf0
[   88.962955]  ? perf_tp_event_init+0xa0/0xa0
[   88.963627]  perf_trace_destroy+0x37/0x60
[   88.964286]  tp_perf_event_destroy+0x15/0x20
[   88.964980]  _free_event+0xfc/0x7d0
[   88.965608]  put_event+0x37/0x50
[   88.966171]  perf_event_release_kernel+0x2f4/0x370
[   88.966991]  ? perf_event_release_kernel+0x370/0x370
[   88.967805]  perf_release+0x19/0x20
[   88.968391]  __fput+0x12d/0x460
[   88.969012]  ____fput+0x1a/0x20
[   88.969548]  task_work_run+0x8e/0xf0
[   88.970192]  do_exit+0x616/0x1310
[   88.970797]  ? write_comp_data+0x2f/0x90
[   88.971504]  do_group_exit+0x7e/0x130
[   88.972164]  get_signal+0x249/0x13c0
[   88.972791]  ? get_signal+0x5/0x13c0
[   88.973471]  arch_do_signal_or_restart+0xb7/0x7e0
[   88.974336]  ? arch_do_signal_or_restart+0x5/0x7e0
[   88.975185]  exit_to_user_mode_prepare+0x154/0x240
[   88.975959]  syscall_exit_to_user_mode+0x2b/0x60
[   88.976701]  do_syscall_64+0x46/0x80
[   88.977294]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   88.978076] RIP: 0033:0x7fac0740459d
[   88.978660] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   88.979627] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   88.980769] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   88.981824] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   88.982883] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   88.983938] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   88.984994] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   88.986279] CPU: 1 PID: 92 Comm: kworker/u4:2 Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   88.986420] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   88.987330] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   88.988443] caller is debug_smp_processor_id+0x1c/0x20
[   88.989932] Workqueue: events_unbound flush_memcg_stats_dwork
[   88.991464] Call Trace:
[   88.991812]  dump_stack_lvl+0xa4/0xd3
[   88.992329]  dump_stack+0x15/0x17
[   88.992796]  check_preemption_disabled+0x167/0x180
[   88.993454]  ? flush_memcg_stats_dwork+0xe/0x30
[   88.994078]  ? mem_cgroup_from_id+0x30/0x30
[   88.994666]  debug_smp_processor_id+0x1c/0x20
[   88.995269]  perf_ftrace_function_call+0x7c/0x360
[   88.995917]  ? perf_ftrace_function_call+0x4c/0x360
[   88.996593]  ? register_lock_class+0x42/0x440
[   88.997197]  ? 0xffffffffa0098099
[   88.997662]  ? 0xffffffffa0098099
[   88.998155]  0xffffffffa0098099
[   88.998603]  ? 0xffffffffa0098099
[   88.999077]  ? mem_cgroup_flush_stats+0x40/0x40
[   88.999700]  ? process_one_work+0x769/0x9a0
[   89.000282]  ? mem_cgroup_flush_stats+0x5/0x40
[   89.000894]  ? flush_memcg_stats_dwork+0x5/0x30
[   89.001518]  ? write_comp_data+0x2f/0x90
[   89.002061]  mem_cgroup_flush_stats+0x5/0x40
[   89.002661]  flush_memcg_stats_dwork+0xe/0x30
[   89.003265]  ? mem_cgroup_flush_stats+0x5/0x40
[   89.003883]  ? flush_memcg_stats_dwork+0xe/0x30
[   89.004508]  process_one_work+0x3e6/0x9a0
[   89.005072]  ? worker_thread+0x2c3/0x680
[   89.005642]  worker_thread+0x4e/0x680
[   89.006164]  ? process_one_work+0x9a0/0x9a0
[   89.006745]  kthread+0x1e7/0x230
[   89.007205]  ? set_kthread_struct+0x80/0x80
[   89.007793]  ret_from_fork+0x1f/0x30
[   89.008330] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   89.008363] BUG: using smp_processor_id() in preemptible [00000000] code: kworker/u4:2/92
[   89.009422] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   89.010515] caller is debug_smp_processor_id+0x1c/0x20
[   89.012148] Call Trace:
[   89.013235]  dump_stack_lvl+0xa4/0xd3
[   89.013867]  dump_stack+0x15/0x17
[   89.014420]  check_preemption_disabled+0x167/0x180
[   89.015231]  debug_smp_processor_id+0x1c/0x20
[   89.015927]  perf_swevent_get_recursion_context+0x1e/0xd0
[   89.016821]  perf_trace_buf_alloc+0x3d/0x100
[   89.017505]  ? _raw_spin_lock+0x17/0x50
[   89.018121]  ? trace_sched_waking+0xc0/0xc0
[   89.018809]  perf_ftrace_function_call+0x209/0x360
[   89.019773]  ? 0xffffffffa0098099
[   89.020435]  0xffffffffa0098099
[   89.020975]  ? ftrace_call+0x5/0x44
[   89.021569]  ? nfs3_xdr_enc_readdir3args+0x70/0x70
[   89.022365]  ? pmd_page_vaddr+0x2b/0x70
[   89.023017]  ? preempt_count_add+0x5/0xc0
[   89.023704]  preempt_count_add+0x5/0xc0
[   89.024325]  _raw_spin_lock+0x17/0x50
[   89.024924]  ? preempt_count_add+0x5/0xc0
[   89.025560]  ? _raw_spin_lock+0x17/0x50
[   89.026201]  __get_locked_pte+0x1a2/0x290
[   89.026870]  ? nfs3_xdr_enc_readdir3args+0x70/0x70
[   89.027646]  __text_poke+0xea/0x4e0
[   89.028219]  ? nfs3_xdr_enc_readdir3args+0x70/0x70
[   89.028997]  ? lock_is_held_type+0xe2/0x140
[   89.029679]  ? nfs3_xdr_enc_readdir3args+0x70/0x70
[   89.030485]  text_poke+0x2b/0x60
[   89.031055]  text_poke_bp_batch+0x1dc/0x2c0
[   89.031769]  ? nfs4_xattr_get_nfs4_user+0x110/0x110
[   89.032583]  text_poke_queue+0xa7/0xc0
[   89.033238]  ftrace_replace_code+0xfd/0x170
[   89.033962]  ftrace_modify_all_code+0x1b1/0x270
[   89.034728]  arch_ftrace_update_code+0x9/0x10
[   89.035422]  ftrace_run_update_code+0x30/0xa0
[   89.036137]  ftrace_shutdown+0x2b8/0x4a0
[   89.036835]  unregister_ftrace_function+0x25/0x50
[   89.037589]  perf_ftrace_event_register+0x89/0xf0
[   89.038341]  ? perf_tp_event_init+0xa0/0xa0
[   89.039018]  perf_trace_destroy+0x37/0x60
[   89.039676]  tp_perf_event_destroy+0x15/0x20
[   89.040369]  _free_event+0xfc/0x7d0
[   89.040994]  put_event+0x37/0x50
[   89.041553]  perf_event_release_kernel+0x2f4/0x370
[   89.042377]  ? perf_event_release_kernel+0x370/0x370
[   89.043176]  perf_release+0x19/0x20
[   89.043761]  __fput+0x12d/0x460
[   89.044383]  ____fput+0x1a/0x20
[   89.044919]  task_work_run+0x8e/0xf0
[   89.045559]  do_exit+0x616/0x1310
[   89.046169]  ? write_comp_data+0x2f/0x90
[   89.046879]  do_group_exit+0x7e/0x130
[   89.047532]  get_signal+0x249/0x13c0
[   89.048160]  ? get_signal+0x5/0x13c0
[   89.048843]  arch_do_signal_or_restart+0xb7/0x7e0
[   89.049706]  ? arch_do_signal_or_restart+0x5/0x7e0
[   89.050560]  exit_to_user_mode_prepare+0x154/0x240
[   89.051335]  syscall_exit_to_user_mode+0x2b/0x60
[   89.052084]  do_syscall_64+0x46/0x80
[   89.052681]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   89.053464] RIP: 0033:0x7fac0740459d
[   89.054042] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   89.055017] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   89.056164] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   89.057220] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   89.058283] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   89.059339] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   89.060396] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   89.061680] CPU: 1 PID: 92 Comm: kworker/u4:2 Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   89.062741] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   89.064257] Workqueue: events_unbound flush_memcg_stats_dwork
[   89.065045] Call Trace:
[   89.065392]  dump_stack_lvl+0xa4/0xd3
[   89.065908]  dump_stack+0x15/0x17
[   89.066378]  check_preemption_disabled+0x167/0x180
[   89.067036]  ? _raw_spin_trylock+0x19/0x80
[   89.067603]  ? trace_sched_waking+0xc0/0xc0
[   89.068183]  debug_smp_processor_id+0x1c/0x20
[   89.068786]  perf_ftrace_function_call+0x7c/0x360
[   89.069436]  ? flush_memcg_stats_dwork+0xe/0x30
[   89.070062]  ? perf_ftrace_function_call+0x4c/0x360
[   89.070734]  ? perf_ftrace_function_call+0x4c/0x360
[   89.071413]  ? register_lock_class+0x42/0x440
[   89.072015]  ? write_comp_data+0x2f/0x90
[   89.072561]  ? perf_trace_buf_update+0x70/0x70
[   89.073182]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   89.073843]  0xffffffffa0098099
[   89.074291]  ? ftrace_call+0x5/0x44
[   89.074779]  ? 0xffffffffa0098099
[   89.075244]  ? 0xffffffffa0098099
[   89.075709]  ? mem_cgroup_flush_stats+0x40/0x40
[   89.076330]  ? process_one_work+0x769/0x9a0
[   89.076911]  ? preempt_count_add+0x5/0xc0
[   89.077470]  ? _raw_spin_trylock+0x5/0x80
[   89.078027]  preempt_count_add+0x5/0xc0
[   89.078563]  _raw_spin_trylock+0x19/0x80
[   89.079109]  ? preempt_count_add+0x5/0xc0
[   89.079662]  ? _raw_spin_trylock+0x19/0x80
[   89.080233]  mem_cgroup_flush_stats+0x15/0x40
[   89.080834]  flush_memcg_stats_dwork+0xe/0x30
[   89.081436]  process_one_work+0x3e6/0x9a0
[   89.081989]  ? worker_thread+0x2c3/0x680
[   89.082558]  worker_thread+0x4e/0x680
[   89.083075]  ? process_one_work+0x9a0/0x9a0
[   89.083653]  kthread+0x1e7/0x230
[   89.084111]  ? set_kthread_struct+0x80/0x80
[   89.084696]  ret_from_fork+0x1f/0x30
[   93.734069] check_preemption_disabled: 1511142 callbacks suppressed
[   93.734088] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   93.735772] caller is debug_smp_processor_id+0x1c/0x20
[   93.736384] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   93.737221] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   93.738521] Call Trace:
[   93.738837]  dump_stack_lvl+0xa4/0xd3
[   93.739303]  dump_stack+0x15/0x17
[   93.739715]  check_preemption_disabled+0x167/0x180
[   93.740312]  debug_smp_processor_id+0x1c/0x20
[   93.740839]  perf_swevent_put_recursion_context+0x1b/0x40
[   93.741488]  perf_tp_event+0x331/0x4e0
[   93.742064]  ? preempt_count_sub+0x5/0xa0
[   93.742583]  ? preempt_count_sub+0x5/0xa0
[   93.743072]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[   93.743729]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   93.744355]  ? ___ratelimit+0x36/0x1e0
[   93.744891]  ? insn_get_prefixes.part.1+0x3d8/0x650
[   93.745509]  ? bad_get_user+0xd/0xd
[   93.745983]  perf_ftrace_function_call+0x248/0x360
[   93.746619]  ? perf_trace_buf_alloc+0xb0/0x100
[   93.747196]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   93.747801]  ? perf_ftrace_function_call+0x248/0x360
[   93.748546]  ? 0xffffffffa0098099
[   93.749042]  0xffffffffa0098099
[   93.749530]  ? insn_get_prefixes.part.1+0x39b/0x650
[   93.750185]  ? inat_get_opcode_attribute+0x5/0x20
[   93.750794]  ? write_comp_data+0x2f/0x90
[   93.751323]  inat_get_opcode_attribute+0x5/0x20
[   93.751911]  insn_get_prefixes.part.1+0x3d8/0x650
[   93.752517]  ? inat_get_opcode_attribute+0x5/0x20
[   93.753126]  ? insn_get_prefixes.part.1+0x3d8/0x650
[   93.753751]  ? write_comp_data+0x20/0x90
[   93.754309]  insn_get_opcode+0x1d5/0x3b0
[   93.754848]  insn_get_modrm+0x12b/0x2a0
[   93.755377]  insn_get_sib+0x122/0x140
[   93.755879]  insn_get_displacement+0x157/0x270
[   93.756474]  insn_get_immediate+0x181/0x570
[   93.757045]  insn_get_length+0x75/0x90
[   93.757556]  insn_decode+0x9b/0x170
[   93.758028]  ? drm_fb_helper_hotplug_event.part.28+0x150/0x150
[   93.758801]  text_poke_loc_init+0x63/0x140
[   93.759410]  ? drm_fb_helper_hotplug_event.part.28+0x150/0x150
[   93.760173]  text_poke_queue+0x84/0xc0
[   93.760688]  ftrace_replace_code+0xfd/0x170
[   93.761258]  ftrace_modify_all_code+0x1b1/0x270
[   93.761864]  arch_ftrace_update_code+0x9/0x10
[   93.762443]  ftrace_run_update_code+0x30/0xa0
[   93.763018]  ftrace_shutdown+0x2b8/0x4a0
[   93.763561]  unregister_ftrace_function+0x25/0x50
[   93.764170]  perf_ftrace_event_register+0x89/0xf0
[   93.764778]  ? perf_tp_event_init+0xa0/0xa0
[   93.765323]  perf_trace_destroy+0x37/0x60
[   93.765853]  tp_perf_event_destroy+0x15/0x20
[   93.766423]  _free_event+0xfc/0x7d0
[   93.766916]  put_event+0x37/0x50
[   93.767358]  perf_event_release_kernel+0x2f4/0x370
[   93.768004]  ? perf_event_release_kernel+0x370/0x370
[   93.768650]  perf_release+0x19/0x20
[   93.769118]  __fput+0x12d/0x460
[   93.769588]  ____fput+0x1a/0x20
[   93.770016]  task_work_run+0x8e/0xf0
[   93.770521]  do_exit+0x616/0x1310
[   93.770992]  ? write_comp_data+0x2f/0x90
[   93.771541]  do_group_exit+0x7e/0x130
[   93.772050]  get_signal+0x249/0x13c0
[   93.772544]  ? get_signal+0x5/0x13c0
[   93.773060]  arch_do_signal_or_restart+0xb7/0x7e0
[   93.773723]  ? arch_do_signal_or_restart+0x5/0x7e0
[   93.774392]  exit_to_user_mode_prepare+0x154/0x240
[   93.775018]  syscall_exit_to_user_mode+0x2b/0x60
[   93.775626]  do_syscall_64+0x46/0x80
[   93.776105]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   93.776752] RIP: 0033:0x7fac0740459d
[   93.777222] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   93.778027] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   93.778977] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   93.779857] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   93.780744] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   93.781624] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   93.782512] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   93.783685] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   93.783710] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   93.784768] caller is debug_smp_processor_id+0x1c/0x20
[   93.785816] caller is debug_smp_processor_id+0x1c/0x20
[   93.786662] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   93.788250] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   93.789836] Call Trace:
[   93.790242]  dump_stack_lvl+0xa4/0xd3
[   93.790847]  dump_stack+0x15/0x17
[   93.791373]  check_preemption_disabled+0x167/0x180
[   93.792097]  ? insn_get_opcode+0x20b/0x3b0
[   93.792714]  ? bad_get_user+0xd/0xd
[   93.793285]  debug_smp_processor_id+0x1c/0x20
[   93.793952]  perf_ftrace_function_call+0x7c/0x360
[   93.794756]  ? 0xffffffffa0098099
[   93.795393]  ? 0xffffffffa0098099
[   93.796019]  0xffffffffa0098099
[   93.796515]  ? insn_get_prefixes.part.1+0x39b/0x650
[   93.797278]  ? inat_get_opcode_attribute+0x5/0x20
[   93.797989]  ? write_comp_data+0x2f/0x90
[   93.798618]  ? insn_get_opcode+0xaa/0x3b0
[   93.799268]  ? inat_get_opcode_attribute+0x5/0x20
[   93.799981]  ? write_comp_data+0x2f/0x90
[   93.800608]  inat_get_opcode_attribute+0x5/0x20
[   93.801300]  insn_get_opcode+0x20b/0x3b0
[   93.801906]  ? inat_get_opcode_attribute+0x5/0x20
[   93.802615]  ? insn_get_opcode+0x20b/0x3b0
[   93.803299]  insn_get_modrm+0x12b/0x2a0
[   93.803948]  insn_get_sib+0x122/0x140
[   93.804562]  insn_get_displacement+0x157/0x270
[   93.805280]  insn_get_immediate+0x181/0x570
[   93.805975]  insn_get_length+0x75/0x90
[   93.806593]  insn_decode+0x9b/0x170
[   93.807162]  ? drm_fb_helper_hotplug_event.part.28+0x150/0x150
[   93.808027]  text_poke_loc_init+0x63/0x140
[   93.808806]  ? drm_fb_helper_hotplug_event.part.28+0x150/0x150
[   93.809712]  text_poke_queue+0x84/0xc0
[   93.810351]  ftrace_replace_code+0xfd/0x170
[   93.811047]  ftrace_modify_all_code+0x1b1/0x270
[   93.811777]  arch_ftrace_update_code+0x9/0x10
[   93.812442]  ftrace_run_update_code+0x30/0xa0
[   93.813128]  ftrace_shutdown+0x2b8/0x4a0
[   93.813800]  unregister_ftrace_function+0x25/0x50
[   93.814526]  perf_ftrace_event_register+0x89/0xf0
[   93.815240]  ? perf_tp_event_init+0xa0/0xa0
[   93.815882]  perf_trace_destroy+0x37/0x60
[   93.816515]  tp_perf_event_destroy+0x15/0x20
[   93.817182]  _free_event+0xfc/0x7d0
[   93.817786]  put_event+0x37/0x50
[   93.818330]  perf_event_release_kernel+0x2f4/0x370
[   93.819118]  ? perf_event_release_kernel+0x370/0x370
[   93.819885]  perf_release+0x19/0x20
[   93.820446]  __fput+0x12d/0x460
[   93.821046]  ____fput+0x1a/0x20
[   93.821560]  task_work_run+0x8e/0xf0
[   93.822180]  do_exit+0x616/0x1310
[   93.822762]  ? write_comp_data+0x2f/0x90
[   93.823443]  do_group_exit+0x7e/0x130
[   93.824072]  get_signal+0x249/0x13c0
[   93.824676]  ? get_signal+0x5/0x13c0
[   93.825333]  arch_do_signal_or_restart+0xb7/0x7e0
[   93.826170]  ? arch_do_signal_or_restart+0x5/0x7e0
[   93.826991]  exit_to_user_mode_prepare+0x154/0x240
[   93.827755]  syscall_exit_to_user_mode+0x2b/0x60
[   93.828468]  do_syscall_64+0x46/0x80
[   93.829041]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   93.829793] RIP: 0033:0x7fac0740459d
[   93.830355] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   93.831286] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   93.832382] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   93.833392] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   93.834410] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   93.835425] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   93.836438] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   93.837678] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   93.837788] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   93.838689] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   93.838700] Call Trace:
[   93.838710]  dump_stack_lvl+0xa4/0xd3
[   93.838733]  dump_stack+0x15/0x17
[   93.838747]  check_preemption_disabled+0x167/0x180
[   93.838765]  ? __mutex_lock+0x56/0x9f0
[   93.838779]  ? ___might_sleep+0x170/0x170
[   93.839840] caller is debug_smp_processor_id+0x1c/0x20
[   93.841210]  debug_smp_processor_id+0x1c/0x20
[   93.845129]  perf_ftrace_function_call+0x7c/0x360
[   93.845723]  ? perf_ftrace_function_call+0x4c/0x360
[   93.846341]  ? write_comp_data+0x2f/0x90
[   93.846843]  ? mutex_lock_nested+0x1b/0x20
[   93.847363]  ? mutex_lock_io_nested+0x940/0x940
[   93.847937]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   93.848530]  ? mutex_lock_nested+0x1b/0x20
[   93.849052]  ? perf_ftrace_function_call+0x4c/0x360
[   93.849667]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   93.850266]  ? ftrace_ops_test+0x71/0xc0
[   93.850784]  0xffffffffa0098099
[   93.851189]  ? 0xffffffffa0098099
[   93.851612]  ? trace_hardirqs_on+0x6a/0x170
[   93.852145]  ? write_comp_data+0x2f/0x90
[   93.852647]  ? perf_trace_buf_update+0x70/0x70
[   93.853213]  ? do_epoll_wait+0x3b3/0xd80
[   93.853725]  ? __might_sleep+0x5/0x70
[   93.854213]  __might_sleep+0x5/0x70
[   93.854664]  __mutex_lock+0x56/0x9f0
[   93.855124]  ? __might_sleep+0x5/0x70
[   93.855594]  ? __mutex_lock+0x56/0x9f0
[   93.856077]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   93.856754]  ? do_epoll_wait+0x3b3/0xd80
[   93.857257]  ? do_epoll_wait+0x3b3/0xd80
[   93.857765]  ? __mutex_lock+0x5/0x9f0
[   93.858250]  mutex_lock_nested+0x1b/0x20
[   93.858751]  ? __mutex_lock+0x5/0x9f0
[   93.859220]  ? mutex_lock_nested+0x1b/0x20
[   93.859742]  do_epoll_wait+0x3b3/0xd80
[   93.860251]  ? wait_woken+0x90/0x90
[   93.860715]  __x64_sys_epoll_wait+0x8d/0xd0
[   93.861261]  do_syscall_64+0x37/0x80
[   93.861722]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   93.862368] RIP: 0033:0x7f8a39143ae0
[   93.862827] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   93.865068] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   93.866001] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   93.866876] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   93.867747] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   93.868618] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   93.869490] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   93.870400] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   93.870433] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   93.871441] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   93.872463] caller is debug_smp_processor_id+0x1c/0x20
[   93.874029] Call Trace:
[   93.874063]  dump_stack_lvl+0xa4/0xd3
[   93.875626]  dump_stack+0x15/0x17
[   93.876156]  check_preemption_disabled+0x167/0x180
[   93.876941]  debug_smp_processor_id+0x1c/0x20
[   93.877609]  perf_swevent_get_recursion_context+0x1e/0xd0
[   93.878475]  perf_trace_buf_alloc+0x3d/0x100
[   93.879135]  ? insn_get_opcode+0x20b/0x3b0
[   93.879756]  ? bad_get_user+0xd/0xd
[   93.880321]  perf_ftrace_function_call+0x209/0x360
[   93.881260]  ? 0xffffffffa0098099
[   93.881904]  0xffffffffa0098099
[   93.882405]  ? insn_get_prefixes.part.1+0x39b/0x650
[   93.883175]  ? inat_get_opcode_attribute+0x5/0x20
[   93.883898]  ? write_comp_data+0x2f/0x90
[   93.884530]  ? insn_get_opcode+0xaa/0x3b0
[   93.885182]  ? inat_get_opcode_attribute+0x5/0x20
[   93.885899]  ? write_comp_data+0x2f/0x90
[   93.886533]  inat_get_opcode_attribute+0x5/0x20
[   93.887228]  insn_get_opcode+0x20b/0x3b0
[   93.887838]  ? inat_get_opcode_attribute+0x5/0x20
[   93.888543]  ? insn_get_opcode+0x20b/0x3b0
[   93.889230]  insn_get_modrm+0x12b/0x2a0
[   93.889883]  insn_get_sib+0x122/0x140
[   93.890505]  insn_get_displacement+0x157/0x270
[   93.891227]  insn_get_immediate+0x181/0x570
[   93.891925]  insn_get_length+0x75/0x90
[   93.892542]  insn_decode+0x9b/0x170
[   93.893114]  ? drm_fb_helper_hotplug_event.part.28+0x150/0x150
[   93.893981]  text_poke_loc_init+0x63/0x140
[   93.894772]  ? drm_fb_helper_hotplug_event.part.28+0x150/0x150
[   93.895684]  text_poke_queue+0x84/0xc0
[   93.896316]  ftrace_replace_code+0xfd/0x170
[   93.897014]  ftrace_modify_all_code+0x1b1/0x270
[   93.897748]  arch_ftrace_update_code+0x9/0x10
[   93.898419]  ftrace_run_update_code+0x30/0xa0
[   93.899109]  ftrace_shutdown+0x2b8/0x4a0
[   93.899783]  unregister_ftrace_function+0x25/0x50
[   93.900508]  perf_ftrace_event_register+0x89/0xf0
[   93.901222]  ? perf_tp_event_init+0xa0/0xa0
[   93.901866]  perf_trace_destroy+0x37/0x60
[   93.902510]  tp_perf_event_destroy+0x15/0x20
[   93.903180]  _free_event+0xfc/0x7d0
[   93.903787]  put_event+0x37/0x50
[   93.904325]  perf_event_release_kernel+0x2f4/0x370
[   93.905117]  ? perf_event_release_kernel+0x370/0x370
[   93.905887]  perf_release+0x19/0x20
[   93.906458]  __fput+0x12d/0x460
[   93.907063]  ____fput+0x1a/0x20
[   93.907581]  task_work_run+0x8e/0xf0
[   93.908200]  do_exit+0x616/0x1310
[   93.908785]  ? write_comp_data+0x2f/0x90
[   93.909471]  do_group_exit+0x7e/0x130
[   93.910101]  get_signal+0x249/0x13c0
[   93.910711]  ? get_signal+0x5/0x13c0
[   93.911370]  arch_do_signal_or_restart+0xb7/0x7e0
[   93.912205]  ? arch_do_signal_or_restart+0x5/0x7e0
[   93.913028]  exit_to_user_mode_prepare+0x154/0x240
[   93.913774]  syscall_exit_to_user_mode+0x2b/0x60
[   93.914493]  do_syscall_64+0x46/0x80
[   93.915066]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   93.915819] RIP: 0033:0x7fac0740459d
[   93.916375] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   93.917307] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   93.918410] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   93.919425] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   93.920440] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   93.921452] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   93.922467] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   93.923711] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   93.923817] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   93.924715] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   93.925696] caller is debug_smp_processor_id+0x1c/0x20
[   93.927068] Call Trace:
[   93.927077]  dump_stack_lvl+0xa4/0xd3
[   93.927098]  dump_stack+0x15/0x17
[   93.927113]  check_preemption_disabled+0x167/0x180
[   93.927131]  ? __might_sleep+0x48/0x70
[   93.927145]  ? sched_show_task+0x70/0x70
[   93.927163]  debug_smp_processor_id+0x1c/0x20
[   93.931072]  perf_ftrace_function_call+0x7c/0x360
[   93.931665]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   93.932259]  ? __mutex_lock+0x56/0x9f0
[   93.932738]  ? perf_ftrace_function_call+0x4c/0x360
[   93.933350]  ? perf_ftrace_function_call+0x4c/0x360
[   93.933966]  ? write_comp_data+0x2f/0x90
[   93.934473]  ? mutex_lock_nested+0x1b/0x20
[   93.934999]  ? mutex_lock_io_nested+0x940/0x940
[   93.935571]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   93.936164]  ? mutex_lock_nested+0x1b/0x20
[   93.936685]  ? perf_ftrace_function_call+0x4c/0x360
[   93.937301]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   93.937897]  ? ftrace_ops_test+0x71/0xc0
[   93.938416]  0xffffffffa0098099
[   93.938829]  ? 0xffffffffa0098099
[   93.939253]  ? trace_hardirqs_on+0x6a/0x170
[   93.939786]  ? do_epoll_wait+0x3b3/0xd80
[   93.940295]  ? ___might_sleep+0x5/0x170
[   93.940791]  ___might_sleep+0x5/0x170
[   93.941261]  __might_sleep+0x48/0x70
[   93.941720]  ? ___might_sleep+0x5/0x170
[   93.942215]  ? __might_sleep+0x48/0x70
[   93.942700]  __mutex_lock+0x56/0x9f0
[   93.943176]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   93.943852]  ? do_epoll_wait+0x3b3/0xd80
[   93.944355]  ? do_epoll_wait+0x3b3/0xd80
[   93.944862]  ? __mutex_lock+0x5/0x9f0
[   93.945342]  mutex_lock_nested+0x1b/0x20
[   93.945842]  ? __mutex_lock+0x5/0x9f0
[   93.946313]  ? mutex_lock_nested+0x1b/0x20
[   93.946835]  do_epoll_wait+0x3b3/0xd80
[   93.947343]  ? wait_woken+0x90/0x90
[   93.947805]  __x64_sys_epoll_wait+0x8d/0xd0
[   93.948349]  do_syscall_64+0x37/0x80
[   93.948809]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   93.949443] RIP: 0033:0x7f8a39143ae0
[   93.949898] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   93.952140] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   93.953076] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   93.953950] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   93.954827] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   93.955699] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   93.956572] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   93.957478] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   93.957510] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   93.958444] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   93.958461] Call Trace:
[   93.959485] caller is debug_smp_processor_id+0x1c/0x20
[   93.960948]  dump_stack_lvl+0xa4/0xd3
[   93.962433]  dump_stack+0x15/0x17
[   93.962906]  check_preemption_disabled+0x167/0x180
[   93.963591]  debug_smp_processor_id+0x1c/0x20
[   93.964194]  perf_trace_buf_alloc+0x98/0x100
[   93.964786]  ? insn_get_opcode+0x20b/0x3b0
[   93.965349]  ? bad_get_user+0xd/0xd
[   93.965849]  perf_ftrace_function_call+0x209/0x360
[   93.966611]  ? 0xffffffffa0098099
[   93.967135]  0xffffffffa0098099
[   93.967580]  ? insn_get_prefixes.part.1+0x39b/0x650
[   93.968262]  ? inat_get_opcode_attribute+0x5/0x20
[   93.968917]  ? write_comp_data+0x2f/0x90
[   93.969476]  ? insn_get_opcode+0xaa/0x3b0
[   93.970048]  ? inat_get_opcode_attribute+0x5/0x20
[   93.970699]  ? write_comp_data+0x2f/0x90
[   93.971257]  inat_get_opcode_attribute+0x5/0x20
[   93.971883]  insn_get_opcode+0x20b/0x3b0
[   93.972428]  ? inat_get_opcode_attribute+0x5/0x20
[   93.973069]  ? insn_get_opcode+0x20b/0x3b0
[   93.973664]  insn_get_modrm+0x12b/0x2a0
[   93.974228]  insn_get_sib+0x122/0x140
[   93.974763]  insn_get_displacement+0x157/0x270
[   93.975396]  insn_get_immediate+0x181/0x570
[   93.976002]  insn_get_length+0x75/0x90
[   93.976543]  insn_decode+0x9b/0x170
[   93.977046]  ? drm_fb_helper_hotplug_event.part.28+0x150/0x150
[   93.977835]  text_poke_loc_init+0x63/0x140
[   93.978481]  ? drm_fb_helper_hotplug_event.part.28+0x150/0x150
[   93.979293]  text_poke_queue+0x84/0xc0
[   93.979841]  ftrace_replace_code+0xfd/0x170
[   93.980447]  ftrace_modify_all_code+0x1b1/0x270
[   93.981093]  arch_ftrace_update_code+0x9/0x10
[   93.981694]  ftrace_run_update_code+0x30/0xa0
[   93.982310]  ftrace_shutdown+0x2b8/0x4a0
[   93.982890]  unregister_ftrace_function+0x25/0x50
[   93.983542]  perf_ftrace_event_register+0x89/0xf0
[   93.984189]  ? perf_tp_event_init+0xa0/0xa0
[   93.984770]  perf_trace_destroy+0x37/0x60
[   93.985335]  tp_perf_event_destroy+0x15/0x20
[   93.985932]  _free_event+0xfc/0x7d0
[   93.986454]  put_event+0x37/0x50
[   93.986926]  perf_event_release_kernel+0x2f4/0x370
[   93.987615]  ? perf_event_release_kernel+0x370/0x370
[   93.988304]  perf_release+0x19/0x20
[   93.988803]  __fput+0x12d/0x460
[   93.989301]  ____fput+0x1a/0x20
[   93.989757]  task_work_run+0x8e/0xf0
[   93.990292]  do_exit+0x616/0x1310
[   93.990792]  ? write_comp_data+0x2f/0x90
[   93.991375]  do_group_exit+0x7e/0x130
[   93.991918]  get_signal+0x249/0x13c0
[   93.992442]  ? get_signal+0x5/0x13c0
[   93.992993]  arch_do_signal_or_restart+0xb7/0x7e0
[   93.993697]  ? arch_do_signal_or_restart+0x5/0x7e0
[   93.994405]  exit_to_user_mode_prepare+0x154/0x240
[   93.995073]  syscall_exit_to_user_mode+0x2b/0x60
[   93.995719]  do_syscall_64+0x46/0x80
[   93.996232]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   93.996918] RIP: 0033:0x7fac0740459d
[   93.997417] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   93.998277] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   93.999278] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   94.000211] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   94.001144] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   94.002076] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   94.003010] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   94.004055] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   94.004161] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   94.005053] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   94.006132] caller is debug_smp_processor_id+0x1c/0x20
[   94.007410] Call Trace:
[   94.007418]  dump_stack_lvl+0xa4/0xd3
[   94.008850]  dump_stack+0x15/0x17
[   94.009279]  check_preemption_disabled+0x167/0x180
[   94.009884]  ? __mutex_lock+0x7b/0x9f0
[   94.010368]  ? trace_sched_waking+0xc0/0xc0
[   94.010904]  debug_smp_processor_id+0x1c/0x20
[   94.011458]  perf_ftrace_function_call+0x7c/0x360
[   94.012051]  ? perf_ftrace_function_call+0x4c/0x360
[   94.012668]  ? write_comp_data+0x2f/0x90
[   94.013169]  ? mutex_lock_nested+0x1b/0x20
[   94.013690]  ? mutex_lock_io_nested+0x940/0x940
[   94.014267]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   94.014861]  ? mutex_lock_nested+0x1b/0x20
[   94.015383]  ? perf_ftrace_function_call+0x4c/0x360
[   94.015999]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   94.016596]  ? ftrace_ops_test+0x71/0xc0
[   94.017114]  0xffffffffa0098099
[   94.017523]  ? __this_cpu_preempt_check+0x1c/0x20
[   94.018122]  ? lock_is_held_type+0xe2/0x140
[   94.018656]  ? do_epoll_wait+0x3b3/0xd80
[   94.019169]  ? preempt_count_add+0x5/0xc0
[   94.019686]  preempt_count_add+0x5/0xc0
[   94.020175]  __mutex_lock+0x7b/0x9f0
[   94.020635]  ? preempt_count_add+0x5/0xc0
[   94.021143]  ? __mutex_lock+0x7b/0x9f0
[   94.021626]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   94.022309]  ? do_epoll_wait+0x3b3/0xd80
[   94.022812]  ? do_epoll_wait+0x3b3/0xd80
[   94.023319]  ? __mutex_lock+0x5/0x9f0
[   94.023801]  mutex_lock_nested+0x1b/0x20
[   94.024308]  ? __mutex_lock+0x5/0x9f0
[   94.024791]  ? mutex_lock_nested+0x1b/0x20
[   94.025312]  do_epoll_wait+0x3b3/0xd80
[   94.025829]  ? wait_woken+0x90/0x90
[   94.026299]  __x64_sys_epoll_wait+0x8d/0xd0
[   94.026844]  do_syscall_64+0x37/0x80
[   94.027305]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   94.027939] RIP: 0033:0x7f8a39143ae0
[   94.028396] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   94.030645] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   94.031575] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   94.032447] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   94.033319] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   94.034199] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   94.035070] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   94.035974] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   94.036007] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   94.036937] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   94.037982] caller is debug_smp_processor_id+0x1c/0x20
[   94.039428] Call Trace:
[   94.040396]  dump_stack_lvl+0xa4/0xd3
[   94.040921]  dump_stack+0x15/0x17
[   94.041386]  check_preemption_disabled+0x167/0x180
[   94.042061]  debug_smp_processor_id+0x1c/0x20
[   94.042658]  perf_swevent_put_recursion_context+0x1b/0x40
[   94.043389]  perf_tp_event+0x331/0x4e0
[   94.044065]  ? arch_local_irq_enable+0x10/0x12
[   94.044672]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   94.045317]  ? dump_stack_lvl+0xcc/0xd3
[   94.045859]  ? dump_stack+0x15/0x17
[   94.046347]  ? check_preemption_disabled+0x167/0x180
[   94.047030]  ? insn_get_opcode+0x20b/0x3b0
[   94.047581]  ? bad_get_user+0xd/0xd
[   94.048080]  perf_ftrace_function_call+0x248/0x360
[   94.048720]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   94.049354]  ? perf_ftrace_function_call+0x248/0x360
[   94.050138]  ? 0xffffffffa0098099
[   94.050656]  0xffffffffa0098099
[   94.051093]  ? insn_get_prefixes.part.1+0x39b/0x650
[   94.051768]  ? inat_get_opcode_attribute+0x5/0x20
[   94.052407]  ? write_comp_data+0x2f/0x90
[   94.052957]  ? insn_get_opcode+0xaa/0x3b0
[   94.053522]  ? inat_get_opcode_attribute+0x5/0x20
[   94.054169]  ? write_comp_data+0x2f/0x90
[   94.054719]  inat_get_opcode_attribute+0x5/0x20
[   94.055335]  insn_get_opcode+0x20b/0x3b0
[   94.055873]  ? inat_get_opcode_attribute+0x5/0x20
[   94.056506]  ? insn_get_opcode+0x20b/0x3b0
[   94.057090]  insn_get_modrm+0x12b/0x2a0
[   94.057651]  insn_get_sib+0x122/0x140
[   94.058182]  insn_get_displacement+0x157/0x270
[   94.058807]  insn_get_immediate+0x181/0x570
[   94.059404]  insn_get_length+0x75/0x90
[   94.059936]  insn_decode+0x9b/0x170
[   94.060431]  ? drm_fb_helper_hotplug_event.part.28+0x150/0x150
[   94.061207]  text_poke_loc_init+0x63/0x140
[   94.061841]  ? drm_fb_helper_hotplug_event.part.28+0x150/0x150
[   94.062643]  text_poke_queue+0x84/0xc0
[   94.063184]  ftrace_replace_code+0xfd/0x170
[   94.063781]  ftrace_modify_all_code+0x1b1/0x270
[   94.064414]  arch_ftrace_update_code+0x9/0x10
[   94.065006]  ftrace_run_update_code+0x30/0xa0
[   94.065609]  ftrace_shutdown+0x2b8/0x4a0
[   94.066182]  unregister_ftrace_function+0x25/0x50
[   94.066823]  perf_ftrace_event_register+0x89/0xf0
[   94.067459]  ? perf_tp_event_init+0xa0/0xa0
[   94.068030]  perf_trace_destroy+0x37/0x60
[   94.068586]  tp_perf_event_destroy+0x15/0x20
[   94.069174]  _free_event+0xfc/0x7d0
[   94.069687]  put_event+0x37/0x50
[   94.070152]  perf_event_release_kernel+0x2f4/0x370
[   94.070830]  ? perf_event_release_kernel+0x370/0x370
[   94.071506]  perf_release+0x19/0x20
[   94.071995]  __fput+0x12d/0x460
[   94.072485]  ____fput+0x1a/0x20
[   94.072933]  task_work_run+0x8e/0xf0
[   94.073455]  do_exit+0x616/0x1310
[   94.073947]  ? write_comp_data+0x2f/0x90
[   94.074552]  do_group_exit+0x7e/0x130
[   94.075088]  get_signal+0x249/0x13c0
[   94.075604]  ? get_signal+0x5/0x13c0
[   94.076146]  arch_do_signal_or_restart+0xb7/0x7e0
[   94.076837]  ? arch_do_signal_or_restart+0x5/0x7e0
[   94.077529]  exit_to_user_mode_prepare+0x154/0x240
[   94.078191]  syscall_exit_to_user_mode+0x2b/0x60
[   94.078822]  do_syscall_64+0x46/0x80
[   94.079321]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   94.079996] RIP: 0033:0x7fac0740459d
[   94.080488] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   94.081336] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   94.082331] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   94.083253] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   94.084173] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   94.085095] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   94.086016] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   94.087054] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   94.087172] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   94.088068] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   94.089135] caller is debug_smp_processor_id+0x1c/0x20
[   94.090506] Call Trace:
[   94.090515]  dump_stack_lvl+0xa4/0xd3
[   94.090537]  dump_stack+0x15/0x17
[   94.090551]  check_preemption_disabled+0x167/0x180
[   94.090569]  ? do_epoll_wait+0x3bf/0xd80
[   94.090586]  ? __ia32_sys_fanotify_init+0x5c0/0x5c0
[   94.090607]  debug_smp_processor_id+0x1c/0x20
[   94.094703]  perf_ftrace_function_call+0x7c/0x360
[   94.095308]  ? 0xffffffffa0098099
[   94.095747]  ? do_epoll_wait+0x3b3/0xd80
[   94.096258]  ? preempt_count_sub+0x5/0xa0
[   94.096779]  0xffffffffa0098099
[   94.097185]  ? __mutex_lock+0xfe/0x9f0
[   94.097668]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   94.098351]  ? do_epoll_wait+0x3b3/0xd80
[   94.098862]  ? ep_start_scan+0x5/0x100
[   94.099350]  ep_start_scan+0x5/0x100
[   94.099812]  do_epoll_wait+0x3bf/0xd80
[   94.100295]  ? ep_start_scan+0x5/0x100
[   94.100776]  ? do_epoll_wait+0x3bf/0xd80
[   94.101305]  ? wait_woken+0x90/0x90
[   94.101767]  __x64_sys_epoll_wait+0x8d/0xd0
[   94.102320]  do_syscall_64+0x37/0x80
[   94.102781]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   94.103416] RIP: 0033:0x7f8a39143ae0
[   94.103873] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   94.106172] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   94.107109] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   94.107993] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   94.108870] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   94.109741] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   94.110621] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   94.111528] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   94.112588] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   94.114198] Call Trace:
[   94.114601]  dump_stack_lvl+0xa4/0xd3
[   94.115209]  dump_stack+0x15/0x17
[   94.115744]  check_preemption_disabled+0x167/0x180
[   94.116472]  ? text_poke_queue+0x84/0xc0
[   94.117097]  ? cpumask_weight+0x20/0x20
[   94.117739]  debug_smp_processor_id+0x1c/0x20
[   94.118438]  perf_ftrace_function_call+0x7c/0x360
[   94.119310]  ? ftrace_ops_list_func+0x259/0x2e0
[   94.120028]  ? write_comp_data+0x2f/0x90
[   94.120650]  ? perf_trace_buf_update+0x70/0x70
[   94.121336]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   94.122073]  ? drm_fb_helper_hotplug_event+0x60/0x60
[   94.122907]  0xffffffffa0098099
[   94.123470]  ? ftrace_call+0x5/0x44
[   94.124092]  ? drm_fb_helper_hotplug_event+0x60/0x60
[   94.124861]  ? text_poke_loc_init+0x5/0x140
[   94.125537]  ? drm_fb_helper_hotplug_event+0x60/0x60
[   94.126306]  text_poke_loc_init+0x5/0x140
[   94.126924]  text_poke_queue+0x84/0xc0
[   94.127511]  ? text_poke_loc_init+0x5/0x140
[   94.128139]  ? text_poke_queue+0x84/0xc0
[   94.128791]  ftrace_replace_code+0xfd/0x170
[   94.129487]  ftrace_modify_all_code+0x1b1/0x270
[   94.130241]  arch_ftrace_update_code+0x9/0x10
[   94.130907]  ftrace_run_update_code+0x30/0xa0
[   94.131594]  ftrace_shutdown+0x2b8/0x4a0
[   94.132266]  unregister_ftrace_function+0x25/0x50
[   94.132989]  perf_ftrace_event_register+0x89/0xf0
[   94.133703]  ? perf_tp_event_init+0xa0/0xa0
[   94.134358]  perf_trace_destroy+0x37/0x60
[   94.134991]  tp_perf_event_destroy+0x15/0x20
[   94.135657]  _free_event+0xfc/0x7d0
[   94.136261]  put_event+0x37/0x50
[   94.136797]  perf_event_release_kernel+0x2f4/0x370
[   94.137586]  ? perf_event_release_kernel+0x370/0x370
[   94.138359]  perf_release+0x19/0x20
[   94.138921]  __fput+0x12d/0x460
[   94.139528]  ____fput+0x1a/0x20
[   94.140046]  task_work_run+0x8e/0xf0
[   94.140664]  do_exit+0x616/0x1310
[   94.141248]  ? write_comp_data+0x2f/0x90
[   94.141931]  do_group_exit+0x7e/0x130
[   94.142574]  get_signal+0x249/0x13c0
[   94.143179]  ? get_signal+0x5/0x13c0
[   94.143835]  arch_do_signal_or_restart+0xb7/0x7e0
[   94.144667]  ? arch_do_signal_or_restart+0x5/0x7e0
[   94.145487]  exit_to_user_mode_prepare+0x154/0x240
[   94.146246]  syscall_exit_to_user_mode+0x2b/0x60
[   94.146960]  do_syscall_64+0x46/0x80
[   94.147532]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   94.148284] RIP: 0033:0x7fac0740459d
[   94.148840] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   94.149770] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   94.150878] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   94.151892] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   94.152916] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   94.153933] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   94.154959] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   98.738072] check_preemption_disabled: 1594211 callbacks suppressed
[   98.738096] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   98.739904] caller is debug_smp_processor_id+0x1c/0x20
[   98.740577] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   98.741493] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   98.742906] Call Trace:
[   98.743265]  dump_stack_lvl+0xa4/0xd3
[   98.743804]  dump_stack+0x15/0x17
[   98.744271]  check_preemption_disabled+0x167/0x180
[   98.744912]  ? _raw_spin_lock+0x17/0x50
[   98.745430]  ? trace_sched_waking+0xc0/0xc0
[   98.746022]  debug_smp_processor_id+0x1c/0x20
[   98.746628]  perf_ftrace_function_call+0x7c/0x360
[   98.747416]  ? ftrace_ops_list_func+0x259/0x2e0
[   98.748090]  ? write_comp_data+0x2f/0x90
[   98.748680]  ? perf_trace_buf_update+0x70/0x70
[   98.749324]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   98.750023]  ? ftrace_ops_list_func+0x1d2/0x2e0
[   98.750752]  0xffffffffa0098099
[   98.751247]  ? ftrace_call+0x5/0x44
[   98.751789]  ? ehci_platform_suspend+0xf0/0xf0
[   98.752483]  ? pmd_page_vaddr+0x2b/0x70
[   98.753081]  ? preempt_count_add+0x5/0xc0
[   98.753714]  preempt_count_add+0x5/0xc0
[   98.754296]  _raw_spin_lock+0x17/0x50
[   98.754842]  ? preempt_count_add+0x5/0xc0
[   98.755421]  ? _raw_spin_lock+0x17/0x50
[   98.755998]  __get_locked_pte+0x1a2/0x290
[   98.756607]  ? ehci_platform_suspend+0xf0/0xf0
[   98.757269]  __text_poke+0xea/0x4e0
[   98.757791]  ? ehci_platform_suspend+0xf0/0xf0
[   98.758470]  ? lock_is_held_type+0xe2/0x140
[   98.759102]  ? ehci_platform_suspend+0xf0/0xf0
[   98.759784]  text_poke+0x2b/0x60
[   98.760303]  text_poke_bp_batch+0x93/0x2c0
[   98.760943]  ? xhci_get_endpoint_index.part.27+0x40/0x40
[   98.761739]  text_poke_queue+0xa7/0xc0
[   98.762357]  ftrace_replace_code+0xfd/0x170
[   98.763018]  ftrace_modify_all_code+0x1b1/0x270
[   98.763715]  arch_ftrace_update_code+0x9/0x10
[   98.764348]  ftrace_run_update_code+0x30/0xa0
[   98.765000]  ftrace_shutdown+0x2b8/0x4a0
[   98.765638]  unregister_ftrace_function+0x25/0x50
[   98.766343]  perf_ftrace_event_register+0x89/0xf0
[   98.767022]  ? perf_tp_event_init+0xa0/0xa0
[   98.767633]  perf_trace_destroy+0x37/0x60
[   98.768234]  tp_perf_event_destroy+0x15/0x20
[   98.768870]  _free_event+0xfc/0x7d0
[   98.769442]  put_event+0x37/0x50
[   98.769951]  perf_event_release_kernel+0x2f4/0x370
[   98.770714]  ? perf_event_release_kernel+0x370/0x370
[   98.771444]  perf_release+0x19/0x20
[   98.771975]  __fput+0x12d/0x460
[   98.772547]  ____fput+0x1a/0x20
[   98.773035]  task_work_run+0x8e/0xf0
[   98.773619]  do_exit+0x616/0x1310
[   98.774189]  ? write_comp_data+0x2f/0x90
[   98.774837]  do_group_exit+0x7e/0x130
[   98.775433]  get_signal+0x249/0x13c0
[   98.776008]  ? get_signal+0x5/0x13c0
[   98.776632]  arch_do_signal_or_restart+0xb7/0x7e0
[   98.777420]  ? arch_do_signal_or_restart+0x5/0x7e0
[   98.778214]  exit_to_user_mode_prepare+0x154/0x240
[   98.778924]  syscall_exit_to_user_mode+0x2b/0x60
[   98.779602]  do_syscall_64+0x46/0x80
[   98.780147]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   98.780863] RIP: 0033:0x7fac0740459d
[   98.781392] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   98.782294] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   98.783334] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   98.784294] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   98.785256] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   98.786240] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   98.787209] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   98.788567] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   98.788597] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   98.789652] caller is debug_smp_processor_id+0x1c/0x20
[   98.790770] caller is debug_smp_processor_id+0x1c/0x20
[   98.790792] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   98.790807] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   98.790817] Call Trace:
[   98.790827]  dump_stack_lvl+0xa4/0xd3
[   98.795314]  dump_stack+0x15/0x17
[   98.795745]  check_preemption_disabled+0x167/0x180
[   98.796353]  ? __mutex_lock+0x56/0x9f0
[   98.796835]  ? ___might_sleep+0x170/0x170
[   98.797350]  debug_smp_processor_id+0x1c/0x20
[   98.797906]  perf_ftrace_function_call+0x7c/0x360
[   98.798522]  ? perf_ftrace_function_call+0x4c/0x360
[   98.799143]  ? write_comp_data+0x2f/0x90
[   98.799649]  ? mutex_lock_nested+0x1b/0x20
[   98.800175]  ? mutex_lock_io_nested+0x940/0x940
[   98.800753]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   98.801350]  ? mutex_lock_nested+0x1b/0x20
[   98.801873]  ? perf_ftrace_function_call+0x4c/0x360
[   98.802510]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   98.803110]  ? ftrace_ops_test+0x71/0xc0
[   98.803630]  0xffffffffa0098099
[   98.804042]  ? 0xffffffffa0098099
[   98.804470]  ? trace_hardirqs_on+0x6a/0x170
[   98.805006]  ? write_comp_data+0x2f/0x90
[   98.805511]  ? perf_trace_buf_update+0x70/0x70
[   98.806080]  ? do_epoll_wait+0x3b3/0xd80
[   98.806607]  ? __might_sleep+0x5/0x70
[   98.807086]  __might_sleep+0x5/0x70
[   98.807537]  __mutex_lock+0x56/0x9f0
[   98.808000]  ? __might_sleep+0x5/0x70
[   98.808471]  ? __mutex_lock+0x56/0x9f0
[   98.808957]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   98.809637]  ? do_epoll_wait+0x3b3/0xd80
[   98.810146]  ? do_epoll_wait+0x3b3/0xd80
[   98.810660]  ? __mutex_lock+0x5/0x9f0
[   98.811141]  mutex_lock_nested+0x1b/0x20
[   98.811642]  ? __mutex_lock+0x5/0x9f0
[   98.812111]  ? mutex_lock_nested+0x1b/0x20
[   98.812635]  do_epoll_wait+0x3b3/0xd80
[   98.813143]  ? wait_woken+0x90/0x90
[   98.813608]  __x64_sys_epoll_wait+0x8d/0xd0
[   98.814157]  do_syscall_64+0x37/0x80
[   98.814621]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   98.815259] RIP: 0033:0x7f8a39143ae0
[   98.815719] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   98.817963] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   98.818897] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   98.819769] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   98.820642] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   98.821515] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   98.822391] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   98.823301] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   98.823350] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   98.824355] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   98.825385] caller is debug_smp_processor_id+0x1c/0x20
[   98.826962] Call Trace:
[   98.826998]  dump_stack_lvl+0xa4/0xd3
[   98.828558]  dump_stack+0x15/0x17
[   98.829088]  check_preemption_disabled+0x167/0x180
[   98.829873]  debug_smp_processor_id+0x1c/0x20
[   98.830548]  perf_swevent_get_recursion_context+0x1e/0xd0
[   98.831414]  perf_trace_buf_alloc+0x3d/0x100
[   98.832076]  ? _raw_spin_lock+0x17/0x50
[   98.832666]  ? trace_sched_waking+0xc0/0xc0
[   98.833323]  perf_ftrace_function_call+0x209/0x360
[   98.834269]  ? 0xffffffffa0098099
[   98.834914]  0xffffffffa0098099
[   98.835436]  ? ftrace_call+0x5/0x44
[   98.836011]  ? ehci_platform_suspend+0xf0/0xf0
[   98.836725]  ? pmd_page_vaddr+0x2b/0x70
[   98.837357]  ? preempt_count_add+0x5/0xc0
[   98.838022]  preempt_count_add+0x5/0xc0
[   98.838626]  _raw_spin_lock+0x17/0x50
[   98.839205]  ? preempt_count_add+0x5/0xc0
[   98.839817]  ? _raw_spin_lock+0x17/0x50
[   98.840430]  __get_locked_pte+0x1a2/0x290
[   98.841075]  ? ehci_platform_suspend+0xf0/0xf0
[   98.841777]  __text_poke+0xea/0x4e0
[   98.842336]  ? ehci_platform_suspend+0xf0/0xf0
[   98.843037]  ? lock_is_held_type+0xe2/0x140
[   98.843695]  ? ehci_platform_suspend+0xf0/0xf0
[   98.844418]  text_poke+0x2b/0x60
[   98.844970]  text_poke_bp_batch+0x93/0x2c0
[   98.845648]  ? xhci_get_endpoint_index.part.27+0x40/0x40
[   98.846495]  text_poke_queue+0xa7/0xc0
[   98.847127]  ftrace_replace_code+0xfd/0x170
[   98.847828]  ftrace_modify_all_code+0x1b1/0x270
[   98.848566]  arch_ftrace_update_code+0x9/0x10
[   98.849237]  ftrace_run_update_code+0x30/0xa0
[   98.849929]  ftrace_shutdown+0x2b8/0x4a0
[   98.850608]  unregister_ftrace_function+0x25/0x50
[   98.851337]  perf_ftrace_event_register+0x89/0xf0
[   98.852055]  ? perf_tp_event_init+0xa0/0xa0
[   98.852702]  perf_trace_destroy+0x37/0x60
[   98.853337]  tp_perf_event_destroy+0x15/0x20
[   98.854009]  _free_event+0xfc/0x7d0
[   98.854621]  put_event+0x37/0x50
[   98.855161]  perf_event_release_kernel+0x2f4/0x370
[   98.855956]  ? perf_event_release_kernel+0x370/0x370
[   98.856731]  perf_release+0x19/0x20
[   98.857296]  __fput+0x12d/0x460
[   98.857903]  ____fput+0x1a/0x20
[   98.858424]  task_work_run+0x8e/0xf0
[   98.859046]  do_exit+0x616/0x1310
[   98.859634]  ? write_comp_data+0x2f/0x90
[   98.860320]  do_group_exit+0x7e/0x130
[   98.860953]  get_signal+0x249/0x13c0
[   98.861562]  ? get_signal+0x5/0x13c0
[   98.862228]  arch_do_signal_or_restart+0xb7/0x7e0
[   98.863066]  ? arch_do_signal_or_restart+0x5/0x7e0
[   98.863893]  exit_to_user_mode_prepare+0x154/0x240
[   98.864644]  syscall_exit_to_user_mode+0x2b/0x60
[   98.865362]  do_syscall_64+0x46/0x80
[   98.865937]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   98.866698] RIP: 0033:0x7fac0740459d
[   98.867256] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   98.868186] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   98.869284] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   98.870304] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   98.871323] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   98.872342] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   98.873361] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   98.874612] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   98.874722] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   98.875619] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   98.876600] caller is debug_smp_processor_id+0x1c/0x20
[   98.877968] Call Trace:
[   98.877979]  dump_stack_lvl+0xa4/0xd3
[   98.878001]  dump_stack+0x15/0x17
[   98.878016]  check_preemption_disabled+0x167/0x180
[   98.878034]  ? __might_sleep+0x48/0x70
[   98.878048]  ? sched_show_task+0x70/0x70
[   98.878067]  debug_smp_processor_id+0x1c/0x20
[   98.881989]  perf_ftrace_function_call+0x7c/0x360
[   98.882589]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   98.883186]  ? __mutex_lock+0x56/0x9f0
[   98.883669]  ? perf_ftrace_function_call+0x4c/0x360
[   98.884285]  ? perf_ftrace_function_call+0x4c/0x360
[   98.884903]  ? write_comp_data+0x2f/0x90
[   98.885405]  ? mutex_lock_nested+0x1b/0x20
[   98.885927]  ? mutex_lock_io_nested+0x940/0x940
[   98.886505]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   98.887099]  ? mutex_lock_nested+0x1b/0x20
[   98.887623]  ? perf_ftrace_function_call+0x4c/0x360
[   98.888241]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   98.888838]  ? ftrace_ops_test+0x71/0xc0
[   98.889348]  0xffffffffa0098099
[   98.889763]  ? 0xffffffffa0098099
[   98.890191]  ? trace_hardirqs_on+0x6a/0x170
[   98.890728]  ? do_epoll_wait+0x3b3/0xd80
[   98.891241]  ? ___might_sleep+0x5/0x170
[   98.891740]  ___might_sleep+0x5/0x170
[   98.892212]  __might_sleep+0x48/0x70
[   98.892673]  ? ___might_sleep+0x5/0x170
[   98.893164]  ? __might_sleep+0x48/0x70
[   98.893651]  __mutex_lock+0x56/0x9f0
[   98.894120]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   98.894800]  ? do_epoll_wait+0x3b3/0xd80
[   98.895305]  ? do_epoll_wait+0x3b3/0xd80
[   98.895813]  ? __mutex_lock+0x5/0x9f0
[   98.896296]  mutex_lock_nested+0x1b/0x20
[   98.896797]  ? __mutex_lock+0x5/0x9f0
[   98.897267]  ? mutex_lock_nested+0x1b/0x20
[   98.897790]  do_epoll_wait+0x3b3/0xd80
[   98.898303]  ? wait_woken+0x90/0x90
[   98.898767]  __x64_sys_epoll_wait+0x8d/0xd0
[   98.899314]  do_syscall_64+0x37/0x80
[   98.899777]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   98.900415] RIP: 0033:0x7f8a39143ae0
[   98.900873] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   98.903122] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   98.904055] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   98.904929] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   98.905803] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   98.906686] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   98.907561] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   98.908470] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   98.908501] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   98.909429] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   98.910480] caller is debug_smp_processor_id+0x1c/0x20
[   98.911924] Call Trace:
[   98.912899]  dump_stack_lvl+0xa4/0xd3
[   98.913431]  dump_stack+0x15/0x17
[   98.913903]  check_preemption_disabled+0x167/0x180
[   98.914591]  debug_smp_processor_id+0x1c/0x20
[   98.915194]  perf_trace_buf_alloc+0x98/0x100
[   98.915786]  ? _raw_spin_lock+0x17/0x50
[   98.916317]  ? trace_sched_waking+0xc0/0xc0
[   98.916903]  perf_ftrace_function_call+0x209/0x360
[   98.917661]  ? 0xffffffffa0098099
[   98.918188]  0xffffffffa0098099
[   98.918645]  ? ftrace_call+0x5/0x44
[   98.919147]  ? ehci_platform_suspend+0xf0/0xf0
[   98.919778]  ? pmd_page_vaddr+0x2b/0x70
[   98.920328]  ? preempt_count_add+0x5/0xc0
[   98.920907]  preempt_count_add+0x5/0xc0
[   98.921444]  _raw_spin_lock+0x17/0x50
[   98.921959]  ? preempt_count_add+0x5/0xc0
[   98.922514]  ? _raw_spin_lock+0x17/0x50
[   98.923056]  __get_locked_pte+0x1a2/0x290
[   98.923624]  ? ehci_platform_suspend+0xf0/0xf0
[   98.924245]  __text_poke+0xea/0x4e0
[   98.924738]  ? ehci_platform_suspend+0xf0/0xf0
[   98.925361]  ? lock_is_held_type+0xe2/0x140
[   98.925946]  ? ehci_platform_suspend+0xf0/0xf0
[   98.926715]  text_poke+0x2b/0x60
[   98.927233]  text_poke_bp_batch+0x93/0x2c0
[   98.927825]  ? xhci_get_endpoint_index.part.27+0x40/0x40
[   98.928568]  text_poke_queue+0xa7/0xc0
[   98.929116]  ftrace_replace_code+0xfd/0x170
[   98.929721]  ftrace_modify_all_code+0x1b1/0x270
[   98.930368]  arch_ftrace_update_code+0x9/0x10
[   98.930968]  ftrace_run_update_code+0x30/0xa0
[   98.931579]  ftrace_shutdown+0x2b8/0x4a0
[   98.932156]  unregister_ftrace_function+0x25/0x50
[   98.932803]  perf_ftrace_event_register+0x89/0xf0
[   98.933448]  ? perf_tp_event_init+0xa0/0xa0
[   98.934026]  perf_trace_destroy+0x37/0x60
[   98.934595]  tp_perf_event_destroy+0x15/0x20
[   98.935188]  _free_event+0xfc/0x7d0
[   98.935705]  put_event+0x37/0x50
[   98.936174]  perf_event_release_kernel+0x2f4/0x370
[   98.936859]  ? perf_event_release_kernel+0x370/0x370
[   98.937544]  perf_release+0x19/0x20
[   98.938041]  __fput+0x12d/0x460
[   98.938542]  ____fput+0x1a/0x20
[   98.938998]  task_work_run+0x8e/0xf0
[   98.939528]  do_exit+0x616/0x1310
[   98.940027]  ? write_comp_data+0x2f/0x90
[   98.940611]  do_group_exit+0x7e/0x130
[   98.941153]  get_signal+0x249/0x13c0
[   98.941677]  ? get_signal+0x5/0x13c0
[   98.942230]  arch_do_signal_or_restart+0xb7/0x7e0
[   98.942932]  ? arch_do_signal_or_restart+0x5/0x7e0
[   98.943635]  exit_to_user_mode_prepare+0x154/0x240
[   98.944300]  syscall_exit_to_user_mode+0x2b/0x60
[   98.944938]  do_syscall_64+0x46/0x80
[   98.945445]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   98.946135] RIP: 0033:0x7fac0740459d
[   98.946637] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   98.947504] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   98.948509] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   98.949444] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   98.950383] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   98.951315] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   98.952248] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   98.953294] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   98.953402] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   98.954314] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   98.954325] Call Trace:
[   98.954333]  dump_stack_lvl+0xa4/0xd3
[   98.954355]  dump_stack+0x15/0x17
[   98.954370]  check_preemption_disabled+0x167/0x180
[   98.954389]  ? __mutex_lock+0x7b/0x9f0
[   98.954403]  ? trace_sched_waking+0xc0/0xc0
[   98.955385] caller is debug_smp_processor_id+0x1c/0x20
[   98.956762]  debug_smp_processor_id+0x1c/0x20
[   98.960686]  perf_ftrace_function_call+0x7c/0x360
[   98.961282]  ? perf_ftrace_function_call+0x4c/0x360
[   98.961900]  ? write_comp_data+0x2f/0x90
[   98.962410]  ? mutex_lock_nested+0x1b/0x20
[   98.962932]  ? mutex_lock_io_nested+0x940/0x940
[   98.963511]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   98.964107]  ? mutex_lock_nested+0x1b/0x20
[   98.964630]  ? perf_ftrace_function_call+0x4c/0x360
[   98.965247]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   98.965846]  ? ftrace_ops_test+0x71/0xc0
[   98.966368]  0xffffffffa0098099
[   98.966779]  ? __this_cpu_preempt_check+0x1c/0x20
[   98.967376]  ? lock_is_held_type+0xe2/0x140
[   98.967912]  ? do_epoll_wait+0x3b3/0xd80
[   98.968424]  ? preempt_count_add+0x5/0xc0
[   98.968943]  preempt_count_add+0x5/0xc0
[   98.969435]  __mutex_lock+0x7b/0x9f0
[   98.969897]  ? preempt_count_add+0x5/0xc0
[   98.970411]  ? __mutex_lock+0x7b/0x9f0
[   98.970896]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   98.971573]  ? do_epoll_wait+0x3b3/0xd80
[   98.972077]  ? do_epoll_wait+0x3b3/0xd80
[   98.972586]  ? __mutex_lock+0x5/0x9f0
[   98.973069]  mutex_lock_nested+0x1b/0x20
[   98.973570]  ? __mutex_lock+0x5/0x9f0
[   98.974039]  ? mutex_lock_nested+0x1b/0x20
[   98.974565]  do_epoll_wait+0x3b3/0xd80
[   98.975075]  ? wait_woken+0x90/0x90
[   98.975538]  __x64_sys_epoll_wait+0x8d/0xd0
[   98.976084]  do_syscall_64+0x37/0x80
[   98.976546]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   98.977184] RIP: 0033:0x7f8a39143ae0
[   98.977643] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   98.979894] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   98.980823] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   98.981697] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   98.982573] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   98.983448] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   98.984322] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   98.985231] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   98.985267] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   98.986198] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   98.986216] Call Trace:
[   98.987243] caller is debug_smp_processor_id+0x1c/0x20
[   98.988705]  dump_stack_lvl+0xa4/0xd3
[   98.990193]  dump_stack+0x15/0x17
[   98.990665]  check_preemption_disabled+0x167/0x180
[   98.991349]  debug_smp_processor_id+0x1c/0x20
[   98.991952]  perf_swevent_put_recursion_context+0x1b/0x40
[   98.992694]  perf_tp_event+0x331/0x4e0
[   98.993379]  ? arch_local_irq_enable+0x10/0x12
[   98.993992]  ? __sanitizer_cov_trace_pc+0x21/0x50
[   98.994653]  ? dump_stack_lvl+0xcc/0xd3
[   98.995204]  ? dump_stack+0x15/0x17
[   98.995697]  ? check_preemption_disabled+0x167/0x180
[   98.996398]  ? _raw_spin_lock+0x17/0x50
[   98.996931]  ? trace_sched_waking+0xc0/0xc0
[   98.997521]  perf_ftrace_function_call+0x248/0x360
[   98.998182]  ? perf_ftrace_function_call+0x248/0x360
[   98.998974]  ? 0xffffffffa0098099
[   98.999500]  0xffffffffa0098099
[   98.999955]  ? ftrace_call+0x5/0x44
[   99.000458]  ? ehci_platform_suspend+0xf0/0xf0
[   99.001086]  ? pmd_page_vaddr+0x2b/0x70
[   99.001638]  ? preempt_count_add+0x5/0xc0
[   99.002221]  preempt_count_add+0x5/0xc0
[   99.002757]  _raw_spin_lock+0x17/0x50
[   99.003274]  ? preempt_count_add+0x5/0xc0
[   99.003826]  ? _raw_spin_lock+0x17/0x50
[   99.004369]  __get_locked_pte+0x1a2/0x290
[   99.004937]  ? ehci_platform_suspend+0xf0/0xf0
[   99.005559]  __text_poke+0xea/0x4e0
[   99.006053]  ? ehci_platform_suspend+0xf0/0xf0
[   99.006685]  ? lock_is_held_type+0xe2/0x140
[   99.007272]  ? ehci_platform_suspend+0xf0/0xf0
[   99.007906]  text_poke+0x2b/0x60
[   99.008384]  text_poke_bp_batch+0x93/0x2c0
[   99.008976]  ? xhci_get_endpoint_index.part.27+0x40/0x40
[   99.009720]  text_poke_queue+0xa7/0xc0
[   99.010274]  ftrace_replace_code+0xfd/0x170
[   99.010880]  ftrace_modify_all_code+0x1b1/0x270
[   99.011527]  arch_ftrace_update_code+0x9/0x10
[   99.012129]  ftrace_run_update_code+0x30/0xa0
[   99.012742]  ftrace_shutdown+0x2b8/0x4a0
[   99.013322]  unregister_ftrace_function+0x25/0x50
[   99.013973]  perf_ftrace_event_register+0x89/0xf0
[   99.014624]  ? perf_tp_event_init+0xa0/0xa0
[   99.015204]  perf_trace_destroy+0x37/0x60
[   99.015770]  tp_perf_event_destroy+0x15/0x20
[   99.016368]  _free_event+0xfc/0x7d0
[   99.016888]  put_event+0x37/0x50
[   99.017358]  perf_event_release_kernel+0x2f4/0x370
[   99.018047]  ? perf_event_release_kernel+0x370/0x370
[   99.018738]  perf_release+0x19/0x20
[   99.019237]  __fput+0x12d/0x460
[   99.019736]  ____fput+0x1a/0x20
[   99.020191]  task_work_run+0x8e/0xf0
[   99.020723]  do_exit+0x616/0x1310
[   99.021222]  ? write_comp_data+0x2f/0x90
[   99.021806]  do_group_exit+0x7e/0x130
[   99.022353]  get_signal+0x249/0x13c0
[   99.022878]  ? get_signal+0x5/0x13c0
[   99.023430]  arch_do_signal_or_restart+0xb7/0x7e0
[   99.024134]  ? arch_do_signal_or_restart+0x5/0x7e0
[   99.024838]  exit_to_user_mode_prepare+0x154/0x240
[   99.025504]  syscall_exit_to_user_mode+0x2b/0x60
[   99.026148]  do_syscall_64+0x46/0x80
[   99.026658]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   99.027344] RIP: 0033:0x7fac0740459d
[   99.027836] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   99.028685] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   99.029686] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   99.030630] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   99.031562] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   99.032495] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   99.033429] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   99.034481] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   99.034609] BUG: using smp_processor_id() in preemptible [00000000] code: repro/577
[   99.035481] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   99.036546] caller is debug_smp_processor_id+0x1c/0x20
[   99.037909] Call Trace:
[   99.037918]  dump_stack_lvl+0xa4/0xd3
[   99.039409]  dump_stack+0x15/0x17
[   99.039838]  check_preemption_disabled+0x167/0x180
[   99.040442]  ? do_epoll_wait+0x3bf/0xd80
[   99.040942]  ? __ia32_sys_fanotify_init+0x5c0/0x5c0
[   99.041560]  debug_smp_processor_id+0x1c/0x20
[   99.042112]  perf_ftrace_function_call+0x7c/0x360
[   99.042720]  ? 0xffffffffa0098099
[   99.043158]  ? do_epoll_wait+0x3b3/0xd80
[   99.043668]  ? preempt_count_sub+0x5/0xa0
[   99.044189]  0xffffffffa0098099
[   99.044593]  ? __mutex_lock+0xfe/0x9f0
[   99.045082]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[   99.045761]  ? do_epoll_wait+0x3b3/0xd80
[   99.046283]  ? ep_start_scan+0x5/0x100
[   99.046771]  ep_start_scan+0x5/0x100
[   99.047233]  do_epoll_wait+0x3bf/0xd80
[   99.047714]  ? ep_start_scan+0x5/0x100
[   99.048194]  ? do_epoll_wait+0x3bf/0xd80
[   99.048723]  ? wait_woken+0x90/0x90
[   99.049185]  __x64_sys_epoll_wait+0x8d/0xd0
[   99.049729]  do_syscall_64+0x37/0x80
[   99.050199]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   99.050834] RIP: 0033:0x7f8a39143ae0
[   99.051290] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   99.053531] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   99.054471] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   99.055341] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   99.056211] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   99.057080] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   99.057950] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[   99.058866] CPU: 0 PID: 577 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   99.058898] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[   99.059918] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   99.060940] caller is debug_smp_processor_id+0x1c/0x20
[   99.062514] Call Trace:
[   99.062549]  dump_stack_lvl+0xa4/0xd3
[   99.064104]  dump_stack+0x15/0x17
[   99.064632]  check_preemption_disabled+0x167/0x180
[   99.065359]  ? text_poke_bp_batch+0x93/0x2c0
[   99.066002]  ? apply_paravirt+0x150/0x150
[   99.066647]  debug_smp_processor_id+0x1c/0x20
[   99.067316]  perf_ftrace_function_call+0x7c/0x360
[   99.068074]  ? ehci_platform_suspend+0xf0/0xf0
[   99.068775]  ? 0xffffffffa0098099
[   99.069308]  ? __this_cpu_preempt_check+0x1c/0x20
[   99.070233]  0xffffffffa0098099
[   99.070743]  ? _raw_spin_unlock+0x2c/0x50
[   99.071408]  ? __text_poke+0x2f2/0x4e0
[   99.072047]  ? ehci_platform_remove+0x110/0x110
[   99.072738]  ? text_poke+0x5/0x60
[   99.073309]  text_poke+0x5/0x60
[   99.073814]  text_poke_bp_batch+0x93/0x2c0
[   99.074454]  ? text_poke+0x5/0x60
[   99.074971]  ? text_poke_bp_batch+0x93/0x2c0
[   99.075669]  ? xhci_get_endpoint_index.part.27+0x40/0x40
[   99.076509]  text_poke_queue+0xa7/0xc0
[   99.077140]  ftrace_replace_code+0xfd/0x170
[   99.077838]  ftrace_modify_all_code+0x1b1/0x270
[   99.078575]  arch_ftrace_update_code+0x9/0x10
[   99.079243]  ftrace_run_update_code+0x30/0xa0
[   99.079931]  ftrace_shutdown+0x2b8/0x4a0
[   99.080606]  unregister_ftrace_function+0x25/0x50
[   99.081333]  perf_ftrace_event_register+0x89/0xf0
[   99.082049]  ? perf_tp_event_init+0xa0/0xa0
[   99.082701]  perf_trace_destroy+0x37/0x60
[   99.083335]  tp_perf_event_destroy+0x15/0x20
[   99.084003]  _free_event+0xfc/0x7d0
[   99.084608]  put_event+0x37/0x50
[   99.085145]  perf_event_release_kernel+0x2f4/0x370
[   99.085935]  ? perf_event_release_kernel+0x370/0x370
[   99.086710]  perf_release+0x19/0x20
[   99.087271]  __fput+0x12d/0x460
[   99.087874]  ____fput+0x1a/0x20
[   99.088391]  task_work_run+0x8e/0xf0
[   99.089007]  do_exit+0x616/0x1310
[   99.089590]  ? write_comp_data+0x2f/0x90
[   99.090279]  do_group_exit+0x7e/0x130
[   99.090911]  get_signal+0x249/0x13c0
[   99.091516]  ? get_signal+0x5/0x13c0
[   99.092173]  arch_do_signal_or_restart+0xb7/0x7e0
[   99.093005]  ? arch_do_signal_or_restart+0x5/0x7e0
[   99.093825]  exit_to_user_mode_prepare+0x154/0x240
[   99.094573]  syscall_exit_to_user_mode+0x2b/0x60
[   99.095287]  do_syscall_64+0x46/0x80
[   99.095860]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   99.096611] RIP: 0033:0x7fac0740459d
[   99.097167] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[   99.098097] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[   99.099199] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[   99.100212] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[   99.101226] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[   99.102244] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[   99.103258] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[   99.104498] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[   99.105502] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   99.106898] Call Trace:
[   99.107218]  dump_stack_lvl+0xa4/0xd3
[   99.107693]  dump_stack+0x15/0x17
[   99.108124]  check_preemption_disabled+0x167/0x180
[   99.108731]  ? do_epoll_wait+0x490/0xd80
[   99.109232]  ? ep_eventpoll_poll+0x30/0x30
[   99.109759]  debug_smp_processor_id+0x1c/0x20
[   99.110317]  perf_ftrace_function_call+0x7c/0x360
[   99.110915]  ? ep_start_scan+0xc0/0x100
[   99.111411]  ? 0xffffffffa0098099
[   99.111840]  ? 0xffffffffa0098099
[   99.112270]  ? 0xffffffffa0098099
[   99.112710]  ? 0xffffffffa0098099
[   99.113148]  0xffffffffa0098099
[   99.113563]  ? preempt_count_sub+0x5/0xa0
[   99.114085]  ? ep_item_poll.isra.21+0x5/0x90
[   99.114634]  ? write_comp_data+0x2f/0x90
[   99.115139]  ep_item_poll.isra.21+0x5/0x90
[   99.115664]  do_epoll_wait+0x490/0xd80
[   99.116147]  ? ep_item_poll.isra.21+0x5/0x90
[   99.116689]  ? do_epoll_wait+0x490/0xd80
[   99.117218]  ? wait_woken+0x90/0x90
[   99.117681]  __x64_sys_epoll_wait+0x8d/0xd0
[   99.118229]  do_syscall_64+0x37/0x80
[   99.118692]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   99.119328] RIP: 0033:0x7f8a39143ae0
[   99.119786] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[   99.122027] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[   99.122958] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[   99.123831] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[   99.124702] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[   99.125571] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[   99.126445] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[  103.742112] check_preemption_disabled: 1562637 callbacks suppressed
[  103.742134] BUG: using smp_processor_id() in preemptible [00000000] code: kcompactd0/32
[  103.742151] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[  103.742921] caller is debug_smp_processor_id+0x1c/0x20
[  103.743983] caller is debug_smp_processor_id+0x1c/0x20
[  103.744964] CPU: 1 PID: 32 Comm: kcompactd0 Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  103.747158] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  103.748523] Call Trace:
[  103.748838]  dump_stack_lvl+0xa4/0xd3
[  103.749310]  dump_stack+0x15/0x17
[  103.749734]  check_preemption_disabled+0x167/0x180
[  103.750334]  ? schedule_timeout+0x34e/0x610
[  103.750859]  ? do_init_timer+0xa0/0xa0
[  103.751338]  debug_smp_processor_id+0x1c/0x20
[  103.751885]  perf_ftrace_function_call+0x7c/0x360
[  103.752479]  ? 0xffffffffa0098099
[  103.752898]  ? __this_cpu_preempt_check+0x1c/0x20
[  103.753498]  ? finish_task_switch+0xab/0x2a0
[  103.754030]  ? __schedule+0x46e/0xb20
[  103.754515]  0xffffffffa0098099
[  103.754919]  ? finish_task_switch+0xb0/0x2a0
[  103.755472]  ? del_timer_sync+0x5/0x130
[  103.755963]  del_timer_sync+0x5/0x130
[  103.756428]  schedule_timeout+0x34e/0x610
[  103.756935]  ? del_timer_sync+0x5/0x130
[  103.757419]  ? schedule_timeout+0x34e/0x610
[  103.757953]  ? del_timer_sync+0x130/0x130
[  103.758467]  ? 0xffffffff81000000
[  103.758899]  kcompactd+0x4bf/0x6c0
[  103.759353]  ? wait_woken+0x90/0x90
[  103.759806]  ? kcompactd_do_work+0xa00/0xa00
[  103.760343]  kthread+0x1e7/0x230
[  103.760761]  ? set_kthread_struct+0x80/0x80
[  103.761294]  ret_from_fork+0x1f/0x30
[  103.761782] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  103.761823] BUG: using smp_processor_id() in preemptible [00000000] code: kcompactd0/32
[  103.762812] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  103.762829] Call Trace:
[  103.763780] caller is debug_smp_processor_id+0x1c/0x20
[  103.765219]  dump_stack_lvl+0xa4/0xd3
[  103.766676]  dump_stack+0x15/0x17
[  103.767139]  check_preemption_disabled+0x167/0x180
[  103.767811]  debug_smp_processor_id+0x1c/0x20
[  103.768402]  perf_trace_buf_alloc+0x98/0x100
[  103.768983]  ? ext4_fc_track_inode+0x43/0x210
[  103.769590]  ? ext4_journal_abort_handle.isra.9+0x110/0x110
[  103.770346]  perf_ftrace_function_call+0x209/0x360
[  103.771091]  ? 0xffffffffa0098099
[  103.771608]  0xffffffffa0098099
[  103.772102]  ? ext4_fc_track_inode+0x2f/0x210
[  103.772710]  ? ext4_inode_journal_mode+0x5/0x180
[  103.773332]  ? write_comp_data+0x2f/0x90
[  103.773879]  ext4_inode_journal_mode+0x5/0x180
[  103.774489]  ext4_fc_track_inode+0x43/0x210
[  103.775060]  ? ext4_inode_journal_mode+0x5/0x180
[  103.775675]  ? ext4_fc_track_inode+0x43/0x210
[  103.776281]  ext4_mark_iloc_dirty+0x63/0x1490
[  103.776888]  ? __ext4_mark_inode_dirty+0xdd/0x460
[  103.777538]  ? ext4_mark_iloc_dirty+0x5/0x1490
[  103.778192]  __ext4_mark_inode_dirty+0xf6/0x460
[  103.778842]  ? write_comp_data+0x2f/0x90
[  103.779415]  __ext4_ext_dirty.isra.34+0xb2/0xc0
[  103.780069]  ext4_ext_remove_space+0x1624/0x2260
[  103.780862]  ext4_ext_truncate+0x124/0x150
[  103.781449]  ext4_truncate+0x6db/0x940
[  103.781965]  ? write_comp_data+0x2f/0x90
[  103.782543]  ext4_evict_inode+0x512/0xfb0
[  103.783122]  ? ext4_da_write_begin+0x560/0x560
[  103.783738]  evict+0x102/0x210
[  103.784184]  iput+0x2e0/0x4f0
[  103.784632]  dentry_unlink_inode+0x125/0x1b0
[  103.785233]  __dentry_kill+0x179/0x280
[  103.785764]  ? dput.part.36+0x3a/0x870
[  103.786287]  dput.part.36+0x51e/0x870
[  103.786833]  dput+0x1a/0x20
[  103.787236]  do_renameat2+0x601/0x8e0
[  103.787901]  __x64_sys_rename+0x49/0x50
[  103.788440]  do_syscall_64+0x37/0x80
[  103.788939]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  103.789612] RIP: 0033:0x7f3db8cecaab
[  103.790102] Code: e8 8a 4a 09 00 85 c0 0f 95 c0 0f b6 c0 f7 d8 5b c3 66 0f 1f 44 00 00 b8 ff ff ff ff 5b c3 90 f3 0f 1e fa b8 52 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 05 c3 0f 1f 40 00 48 8b 15 c1 e3 16 00 f7 d8
[  103.792430] RSP: 002b:00007f3db61bfae8 EFLAGS: 00000206 ORIG_RAX: 0000000000000052
[  103.793411] RAX: ffffffffffffffda RBX: 0000557e3e36d5b0 RCX: 00007f3db8cecaab
[  103.794329] RDX: 0000000000000000 RSI: 0000557e3e36dd80 RDI: 00007f3db61bfaf0
[  103.795242] RBP: 00007f3db61bfaf0 R08: 0000000000000000 R09: 00007f3db61c1700
[  103.796156] R10: 00007f3db0000080 R11: 0000000000000206 R12: 0000000000000000
[  103.797070] R13: 00007f3db0007f50 R14: 0000000000000024 R15: 00007f3db69bea10
[  103.798096] CPU: 1 PID: 32 Comm: kcompactd0 Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  103.798272] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[  103.799031] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  103.800069] caller is debug_smp_processor_id+0x1c/0x20
[  103.801418] Call Trace:
[  103.802391]  dump_stack_lvl+0xa4/0xd3
[  103.802862]  dump_stack+0x15/0x17
[  103.803286]  check_preemption_disabled+0x167/0x180
[  103.803884]  ? del_timer_sync+0xd3/0x130
[  103.804377]  ? detach_if_pending+0x270/0x270
[  103.804918]  debug_smp_processor_id+0x1c/0x20
[  103.805466]  perf_ftrace_function_call+0x7c/0x360
[  103.806053]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  103.806674]  ? register_lock_class+0x42/0x440
[  103.807227]  ? del_timer_sync+0x40/0x130
[  103.807728]  ? 0xffffffffa0098099
[  103.808150]  ? 0xffffffffa0098099
[  103.808574]  ? 0xffffffffa0098099
[  103.809007]  0xffffffffa0098099
[  103.809407]  ? __this_cpu_preempt_check+0x1c/0x20
[  103.810008]  ? del_timer_sync+0xa5/0x130
[  103.810517]  ? try_to_del_timer_sync+0x5/0x90
[  103.811064]  ? write_comp_data+0x2f/0x90
[  103.811563]  try_to_del_timer_sync+0x5/0x90
[  103.812089]  del_timer_sync+0xd3/0x130
[  103.812566]  ? try_to_del_timer_sync+0x5/0x90
[  103.813112]  ? del_timer_sync+0xd3/0x130
[  103.813612]  schedule_timeout+0x34e/0x610
[  103.814131]  ? del_timer_sync+0x130/0x130
[  103.814643]  ? 0xffffffff81000000
[  103.815075]  kcompactd+0x4bf/0x6c0
[  103.815512]  ? wait_woken+0x90/0x90
[  103.815964]  ? kcompactd_do_work+0xa00/0xa00
[  103.816502]  kthread+0x1e7/0x230
[  103.816919]  ? set_kthread_struct+0x80/0x80
[  103.817453]  ret_from_fork+0x1f/0x30
[  103.817941] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  103.818016] BUG: using smp_processor_id() in preemptible [00000000] code: kcompactd0/32
[  103.818966] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  103.819922] caller is debug_smp_processor_id+0x1c/0x20
[  103.821350] Call Trace:
[  103.822312]  dump_stack_lvl+0xa4/0xd3
[  103.822834]  dump_stack+0x15/0x17
[  103.823296]  check_preemption_disabled+0x167/0x180
[  103.823969]  debug_smp_processor_id+0x1c/0x20
[  103.824561]  perf_swevent_put_recursion_context+0x1b/0x40
[  103.825291]  perf_tp_event+0x331/0x4e0
[  103.825955]  ? arch_local_irq_enable+0x10/0x12
[  103.826564]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  103.827209]  ? dump_stack_lvl+0xcc/0xd3
[  103.827750]  ? dump_stack+0x15/0x17
[  103.828232]  ? check_preemption_disabled+0x167/0x180
[  103.828924]  ? ext4_fc_track_inode+0x43/0x210
[  103.829511]  ? ext4_journal_abort_handle.isra.9+0x110/0x110
[  103.830265]  perf_ftrace_function_call+0x248/0x360
[  103.830904]  ? perf_ftrace_function_call+0x248/0x360
[  103.831682]  ? 0xffffffffa0098099
[  103.832197]  0xffffffffa0098099
[  103.832690]  ? ext4_fc_track_inode+0x2f/0x210
[  103.833299]  ? ext4_inode_journal_mode+0x5/0x180
[  103.833922]  ? write_comp_data+0x2f/0x90
[  103.834478]  ext4_inode_journal_mode+0x5/0x180
[  103.835081]  ext4_fc_track_inode+0x43/0x210
[  103.835651]  ? ext4_inode_journal_mode+0x5/0x180
[  103.836267]  ? ext4_fc_track_inode+0x43/0x210
[  103.836874]  ext4_mark_iloc_dirty+0x63/0x1490
[  103.837476]  ? __ext4_mark_inode_dirty+0xdd/0x460
[  103.838128]  ? ext4_mark_iloc_dirty+0x5/0x1490
[  103.838778]  __ext4_mark_inode_dirty+0xf6/0x460
[  103.839427]  ? write_comp_data+0x2f/0x90
[  103.840001]  __ext4_ext_dirty.isra.34+0xb2/0xc0
[  103.840653]  ext4_ext_remove_space+0x1624/0x2260
[  103.841449]  ext4_ext_truncate+0x124/0x150
[  103.842037]  ext4_truncate+0x6db/0x940
[  103.842556]  ? write_comp_data+0x2f/0x90
[  103.843131]  ext4_evict_inode+0x512/0xfb0
[  103.843710]  ? ext4_da_write_begin+0x560/0x560
[  103.844327]  evict+0x102/0x210
[  103.844772]  iput+0x2e0/0x4f0
[  103.845220]  dentry_unlink_inode+0x125/0x1b0
[  103.845821]  __dentry_kill+0x179/0x280
[  103.846357]  ? dput.part.36+0x3a/0x870
[  103.846879]  dput.part.36+0x51e/0x870
[  103.847425]  dput+0x1a/0x20
[  103.847828]  do_renameat2+0x601/0x8e0
[  103.848493]  __x64_sys_rename+0x49/0x50
[  103.849030]  do_syscall_64+0x37/0x80
[  103.849528]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  103.850203] RIP: 0033:0x7f3db8cecaab
[  103.850691] Code: e8 8a 4a 09 00 85 c0 0f 95 c0 0f b6 c0 f7 d8 5b c3 66 0f 1f 44 00 00 b8 ff ff ff ff 5b c3 90 f3 0f 1e fa b8 52 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 05 c3 0f 1f 40 00 48 8b 15 c1 e3 16 00 f7 d8
[  103.853025] RSP: 002b:00007f3db61bfae8 EFLAGS: 00000206 ORIG_RAX: 0000000000000052
[  103.854006] RAX: ffffffffffffffda RBX: 0000557e3e36d5b0 RCX: 00007f3db8cecaab
[  103.854924] RDX: 0000000000000000 RSI: 0000557e3e36dd80 RDI: 00007f3db61bfaf0
[  103.855839] RBP: 00007f3db61bfaf0 R08: 0000000000000000 R09: 00007f3db61c1700
[  103.856754] R10: 00007f3db0000080 R11: 0000000000000206 R12: 0000000000000000
[  103.857670] R13: 00007f3db0007f50 R14: 0000000000000024 R15: 00007f3db69bea10
[  103.858698] CPU: 1 PID: 32 Comm: kcompactd0 Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  103.859009] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[  103.859629] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  103.860752] caller is debug_smp_processor_id+0x1c/0x20
[  103.862104] Call Trace:
[  103.862112]  dump_stack_lvl+0xa4/0xd3
[  103.862138]  dump_stack+0x15/0x17
[  103.862152]  check_preemption_disabled+0x167/0x180
[  103.862170]  ? try_to_del_timer_sync+0x33/0x90
[  103.862185]  ? calc_wheel_index+0x2d0/0x2d0
[  103.862205]  debug_smp_processor_id+0x1c/0x20
[  103.866232]  perf_ftrace_function_call+0x7c/0x360
[  103.866821]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  103.867409]  ? del_timer_sync+0xd3/0x130
[  103.867905]  ? perf_ftrace_function_call+0x4c/0x360
[  103.868511]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  103.869105]  ? register_lock_class+0x42/0x440
[  103.869657]  ? del_timer_sync+0x40/0x130
[  103.870161]  ? 0xffffffffa0098099
[  103.870584]  ? 0xffffffffa0098099
[  103.871015]  0xffffffffa0098099
[  103.871423]  ? 0xffffffffa0098099
[  103.871844]  ? __this_cpu_preempt_check+0x1c/0x20
[  103.872434]  ? del_timer_sync+0xa5/0x130
[  103.872934]  ? lock_timer_base+0x5/0x100
[  103.873435]  lock_timer_base+0x5/0x100
[  103.873911]  try_to_del_timer_sync+0x33/0x90
[  103.874452]  ? lock_timer_base+0x5/0x100
[  103.874944]  ? try_to_del_timer_sync+0x33/0x90
[  103.875501]  ? try_to_del_timer_sync+0x5/0x90
[  103.876053]  del_timer_sync+0xd3/0x130
[  103.876533]  schedule_timeout+0x34e/0x610
[  103.877050]  ? del_timer_sync+0x130/0x130
[  103.877563]  ? 0xffffffff81000000
[  103.877995]  kcompactd+0x4bf/0x6c0
[  103.878437]  ? wait_woken+0x90/0x90
[  103.878889]  ? kcompactd_do_work+0xa00/0xa00
[  103.879428]  kthread+0x1e7/0x230
[  103.879844]  ? set_kthread_struct+0x80/0x80
[  103.880379]  ret_from_fork+0x1f/0x30
[  103.880869] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  103.880887] BUG: using smp_processor_id() in preemptible [00000000] code: kcompactd0/32
[  103.880900] caller is debug_smp_processor_id+0x1c/0x20
[  103.881971] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  103.885214] Call Trace:
[  103.885609]  dump_stack_lvl+0xa4/0xd3
[  103.886213]  dump_stack+0x15/0x17
[  103.886734]  check_preemption_disabled+0x167/0x180
[  103.887452]  ? ext4_fc_track_inode+0x74/0x210
[  103.888099]  ? ext4_fc_replay_link_internal+0x1c0/0x1c0
[  103.888895]  debug_smp_processor_id+0x1c/0x20
[  103.889554]  perf_ftrace_function_call+0x7c/0x360
[  103.890473]  ? 0xffffffffa0098099
[  103.891107]  0xffffffffa0098099
[  103.891727]  ? ext4_xattr_user_get+0x80/0x80
[  103.892395]  ? ext4_fc_track_template.isra.19+0x5/0x250
[  103.893169]  ? write_comp_data+0x2f/0x90
[  103.893788]  ext4_fc_track_template.isra.19+0x5/0x250
[  103.894545]  ext4_fc_track_inode+0x74/0x210
[  103.895183]  ? ext4_fc_track_template.isra.19+0x5/0x250
[  103.895944]  ? ext4_fc_track_inode+0x74/0x210
[  103.896635]  ext4_mark_iloc_dirty+0x63/0x1490
[  103.897315]  ? __ext4_mark_inode_dirty+0xdd/0x460
[  103.898050]  ? ext4_mark_iloc_dirty+0x5/0x1490
[  103.898822]  __ext4_mark_inode_dirty+0xf6/0x460
[  103.899579]  ? write_comp_data+0x2f/0x90
[  103.900254]  __ext4_ext_dirty.isra.34+0xb2/0xc0
[  103.901012]  ext4_ext_remove_space+0x1624/0x2260
[  103.902050]  ext4_ext_truncate+0x124/0x150
[  103.902733]  ext4_truncate+0x6db/0x940
[  103.903313]  ? write_comp_data+0x2f/0x90
[  103.903987]  ext4_evict_inode+0x512/0xfb0
[  103.904672]  ? ext4_da_write_begin+0x560/0x560
[  103.905374]  evict+0x102/0x210
[  103.905894]  iput+0x2e0/0x4f0
[  103.906430]  dentry_unlink_inode+0x125/0x1b0
[  103.907123]  __dentry_kill+0x179/0x280
[  103.907764]  ? dput.part.36+0x3a/0x870
[  103.908357]  dput.part.36+0x51e/0x870
[  103.909010]  dput+0x1a/0x20
[  103.909473]  do_renameat2+0x601/0x8e0
[  103.910492]  __x64_sys_rename+0x49/0x50
[  103.911167]  do_syscall_64+0x37/0x80
[  103.911735]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  103.912477] RIP: 0033:0x7f3db8cecaab
[  103.913034] Code: e8 8a 4a 09 00 85 c0 0f 95 c0 0f b6 c0 f7 d8 5b c3 66 0f 1f 44 00 00 b8 ff ff ff ff 5b c3 90 f3 0f 1e fa b8 52 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 05 c3 0f 1f 40 00 48 8b 15 c1 e3 16 00 f7 d8
[  103.915570] RSP: 002b:00007f3db61bfae8 EFLAGS: 00000206 ORIG_RAX: 0000000000000052
[  103.916653] RAX: ffffffffffffffda RBX: 0000557e3e36d5b0 RCX: 00007f3db8cecaab
[  103.917653] RDX: 0000000000000000 RSI: 0000557e3e36dd80 RDI: 00007f3db61bfaf0
[  103.918661] RBP: 00007f3db61bfaf0 R08: 0000000000000000 R09: 00007f3db61c1700
[  103.919663] R10: 00007f3db0000080 R11: 0000000000000206 R12: 0000000000000000
[  103.920666] R13: 00007f3db0007f50 R14: 0000000000000024 R15: 00007f3db69bea10
[  103.921894] CPU: 1 PID: 32 Comm: kcompactd0 Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  103.922109] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[  103.922834] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  103.923968] caller is debug_smp_processor_id+0x1c/0x20
[  103.925320] Call Trace:
[  103.925328]  dump_stack_lvl+0xa4/0xd3
[  103.926801]  dump_stack+0x15/0x17
[  103.927226]  check_preemption_disabled+0x167/0x180
[  103.927824]  ? lock_timer_base+0x34/0x100
[  103.928329]  ? _raw_read_lock_irqsave+0x90/0x90
[  103.928900]  debug_smp_processor_id+0x1c/0x20
[  103.929447]  perf_ftrace_function_call+0x7c/0x360
[  103.930033]  ? try_to_del_timer_sync+0x33/0x90
[  103.930592]  ? calc_wheel_index+0x2d0/0x2d0
[  103.931119]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  103.931704]  ? try_to_del_timer_sync+0x33/0x90
[  103.932262]  ? perf_ftrace_function_call+0x4c/0x360
[  103.932869]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  103.933456]  ? del_timer_sync+0xd3/0x130
[  103.933951]  ? perf_ftrace_function_call+0x4c/0x360
[  103.934560]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  103.935155]  ? register_lock_class+0x42/0x440
[  103.935717]  0xffffffffa0098099
[  103.936128]  ? 0xffffffffa0098099
[  103.936552]  ? lock_timer_base+0xc0/0x100
[  103.937063]  ? _raw_spin_lock_irqsave+0x5/0x70
[  103.937622]  ? write_comp_data+0x2f/0x90
[  103.938124]  _raw_spin_lock_irqsave+0x5/0x70
[  103.938664]  lock_timer_base+0x34/0x100
[  103.939151]  ? _raw_spin_lock_irqsave+0x5/0x70
[  103.939708]  ? lock_timer_base+0x34/0x100
[  103.940223]  try_to_del_timer_sync+0x33/0x90
[  103.940759]  ? try_to_del_timer_sync+0x5/0x90
[  103.941312]  del_timer_sync+0xd3/0x130
[  103.941792]  schedule_timeout+0x34e/0x610
[  103.942312]  ? del_timer_sync+0x130/0x130
[  103.942825]  ? 0xffffffff81000000
[  103.943256]  kcompactd+0x4bf/0x6c0
[  103.943695]  ? wait_woken+0x90/0x90
[  103.944146]  ? kcompactd_do_work+0xa00/0xa00
[  103.944686]  kthread+0x1e7/0x230
[  103.945103]  ? set_kthread_struct+0x80/0x80
[  103.945635]  ret_from_fork+0x1f/0x30
[  103.946130] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  103.946151] BUG: using smp_processor_id() in preemptible [00000000] code: kcompactd0/32
[  103.947244] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  103.948192] caller is debug_smp_processor_id+0x1c/0x20
[  103.949744] Call Trace:
[  103.950755]  dump_stack_lvl+0xa4/0xd3
[  103.951359]  dump_stack+0x15/0x17
[  103.951881]  check_preemption_disabled+0x167/0x180
[  103.952655]  debug_smp_processor_id+0x1c/0x20
[  103.953317]  perf_swevent_get_recursion_context+0x1e/0xd0
[  103.954178]  perf_trace_buf_alloc+0x3d/0x100
[  103.954831]  ? ext4_fc_track_inode+0x74/0x210
[  103.955481]  ? ext4_fc_replay_link_internal+0x1c0/0x1c0
[  103.956280]  perf_ftrace_function_call+0x209/0x360
[  103.957210]  ? 0xffffffffa0098099
[  103.957848]  0xffffffffa0098099
[  103.958481]  ? ext4_xattr_user_get+0x80/0x80
[  103.959153]  ? ext4_fc_track_template.isra.19+0x5/0x250
[  103.959929]  ? write_comp_data+0x2f/0x90
[  103.960551]  ext4_fc_track_template.isra.19+0x5/0x250
[  103.961305]  ext4_fc_track_inode+0x74/0x210
[  103.961943]  ? ext4_fc_track_template.isra.19+0x5/0x250
[  103.962724]  ? ext4_fc_track_inode+0x74/0x210
[  103.963420]  ext4_mark_iloc_dirty+0x63/0x1490
[  103.964103]  ? __ext4_mark_inode_dirty+0xdd/0x460
[  103.964843]  ? ext4_mark_iloc_dirty+0x5/0x1490
[  103.965613]  __ext4_mark_inode_dirty+0xf6/0x460
[  103.966385]  ? write_comp_data+0x2f/0x90
[  103.967065]  __ext4_ext_dirty.isra.34+0xb2/0xc0
[  103.967829]  ext4_ext_remove_space+0x1624/0x2260
[  103.968875]  ext4_ext_truncate+0x124/0x150
[  103.969558]  ext4_truncate+0x6db/0x940
[  103.970141]  ? write_comp_data+0x2f/0x90
[  103.970822]  ext4_evict_inode+0x512/0xfb0
[  103.971504]  ? ext4_da_write_begin+0x560/0x560
[  103.972210]  evict+0x102/0x210
[  103.972734]  iput+0x2e0/0x4f0
[  103.973267]  dentry_unlink_inode+0x125/0x1b0
[  103.973961]  __dentry_kill+0x179/0x280
[  103.974578]  ? dput.part.36+0x3a/0x870
[  103.975169]  dput.part.36+0x51e/0x870
[  103.975825]  dput+0x1a/0x20
[  103.976291]  do_renameat2+0x601/0x8e0
[  103.977188]  __x64_sys_rename+0x49/0x50
[  103.977804]  do_syscall_64+0x37/0x80
[  103.978376]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  103.979120] RIP: 0033:0x7f3db8cecaab
[  103.979672] Code: e8 8a 4a 09 00 85 c0 0f 95 c0 0f b6 c0 f7 d8 5b c3 66 0f 1f 44 00 00 b8 ff ff ff ff 5b c3 90 f3 0f 1e fa b8 52 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 05 c3 0f 1f 40 00 48 8b 15 c1 e3 16 00 f7 d8
[  103.982209] RSP: 002b:00007f3db61bfae8 EFLAGS: 00000206 ORIG_RAX: 0000000000000052
[  103.983291] RAX: ffffffffffffffda RBX: 0000557e3e36d5b0 RCX: 00007f3db8cecaab
[  103.984294] RDX: 0000000000000000 RSI: 0000557e3e36dd80 RDI: 00007f3db61bfaf0
[  103.985298] RBP: 00007f3db61bfaf0 R08: 0000000000000000 R09: 00007f3db61c1700
[  103.986305] R10: 00007f3db0000080 R11: 0000000000000206 R12: 0000000000000000
[  103.987307] R13: 00007f3db0007f50 R14: 0000000000000024 R15: 00007f3db69bea10
[  103.988540] CPU: 1 PID: 32 Comm: kcompactd0 Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  103.988676] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[  103.989473] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  103.990613] caller is debug_smp_processor_id+0x1c/0x20
[  103.991878] Call Trace:
[  103.991886]  dump_stack_lvl+0xa4/0xd3
[  103.993294]  dump_stack+0x15/0x17
[  103.993717]  check_preemption_disabled+0x167/0x180
[  103.994318]  ? kcompactd+0x502/0x6c0
[  103.994770]  ? ___might_sleep+0x170/0x170
[  103.995276]  debug_smp_processor_id+0x1c/0x20
[  103.995822]  perf_ftrace_function_call+0x7c/0x360
[  103.996415]  ? trace_hardirqs_on+0x3f/0x170
[  103.996945]  ? preempt_count_sub+0x5/0xa0
[  103.997454]  ? preempt_count_sub+0x5/0xa0
[  103.997955]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[  103.998579]  ? write_comp_data+0x2f/0x90
[  103.999084]  0xffffffffa0098099
[  103.999482]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  104.000080]  ? kcompactd+0x4e5/0x6c0
[  104.000538]  ? __might_sleep+0x5/0x70
[  104.001001]  ? write_comp_data+0x2f/0x90
[  104.001496]  __might_sleep+0x5/0x70
[  104.001938]  kcompactd+0x502/0x6c0
[  104.002374]  ? __might_sleep+0x5/0x70
[  104.002836]  ? kcompactd+0x502/0x6c0
[  104.003292]  ? wait_woken+0x90/0x90
[  104.003750]  ? kcompactd_do_work+0xa00/0xa00
[  104.004287]  kthread+0x1e7/0x230
[  104.004702]  ? set_kthread_struct+0x80/0x80
[  104.005234]  ret_from_fork+0x1f/0x30
[  104.005721] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  104.006771] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  104.008226] Call Trace:
[  104.008576]  dump_stack_lvl+0xa4/0xd3
[  104.009100]  dump_stack+0x15/0x17
[  104.009564]  check_preemption_disabled+0x167/0x180
[  104.010252]  debug_smp_processor_id+0x1c/0x20
[  104.010850]  perf_trace_buf_alloc+0x98/0x100
[  104.011437]  ? ext4_fc_track_inode+0x74/0x210
[  104.012028]  ? ext4_fc_replay_link_internal+0x1c0/0x1c0
[  104.012737]  perf_ftrace_function_call+0x209/0x360
[  104.013488]  ? 0xffffffffa0098099
[  104.014007]  0xffffffffa0098099
[  104.014514]  ? ext4_xattr_user_get+0x80/0x80
[  104.015110]  ? ext4_fc_track_template.isra.19+0x5/0x250
[  104.015813]  ? write_comp_data+0x2f/0x90
[  104.016362]  ext4_fc_track_template.isra.19+0x5/0x250
[  104.017045]  ext4_fc_track_inode+0x74/0x210
[  104.017619]  ? ext4_fc_track_template.isra.19+0x5/0x250
[  104.018319]  ? ext4_fc_track_inode+0x74/0x210
[  104.018932]  ext4_mark_iloc_dirty+0x63/0x1490
[  104.019538]  ? __ext4_mark_inode_dirty+0xdd/0x460
[  104.020189]  ? ext4_mark_iloc_dirty+0x5/0x1490
[  104.020842]  __ext4_mark_inode_dirty+0xf6/0x460
[  104.021496]  ? write_comp_data+0x2f/0x90
[  104.022072]  __ext4_ext_dirty.isra.34+0xb2/0xc0
[  104.022728]  ext4_ext_remove_space+0x1624/0x2260
[  104.023527]  ext4_ext_truncate+0x124/0x150
[  104.024117]  ext4_truncate+0x6db/0x940
[  104.024638]  ? write_comp_data+0x2f/0x90
[  104.025215]  ext4_evict_inode+0x512/0xfb0
[  104.025800]  ? ext4_da_write_begin+0x560/0x560
[  104.026425]  evict+0x102/0x210
[  104.026876]  iput+0x2e0/0x4f0
[  104.027325]  dentry_unlink_inode+0x125/0x1b0
[  104.027939]  __dentry_kill+0x179/0x280
[  104.028476]  ? dput.part.36+0x3a/0x870
[  104.029000]  dput.part.36+0x51e/0x870
[  104.029551]  dput+0x1a/0x20
[  104.029958]  do_renameat2+0x601/0x8e0
[  104.030634]  __x64_sys_rename+0x49/0x50
[  104.031177]  do_syscall_64+0x37/0x80
[  104.031679]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  104.032355] RIP: 0033:0x7f3db8cecaab
[  104.032847] Code: e8 8a 4a 09 00 85 c0 0f 95 c0 0f b6 c0 f7 d8 5b c3 66 0f 1f 44 00 00 b8 ff ff ff ff 5b c3 90 f3 0f 1e fa b8 52 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 05 c3 0f 1f 40 00 48 8b 15 c1 e3 16 00 f7 d8
[  104.035210] RSP: 002b:00007f3db61bfae8 EFLAGS: 00000206 ORIG_RAX: 0000000000000052
[  104.036197] RAX: ffffffffffffffda RBX: 0000557e3e36d5b0 RCX: 00007f3db8cecaab
[  104.037119] RDX: 0000000000000000 RSI: 0000557e3e36dd80 RDI: 00007f3db61bfaf0
[  104.038039] RBP: 00007f3db61bfaf0 R08: 0000000000000000 R09: 00007f3db61c1700
[  104.038969] R10: 00007f3db0000080 R11: 0000000000000206 R12: 0000000000000000
[  104.039888] R13: 00007f3db0007f50 R14: 0000000000000024 R15: 00007f3db69bea10
[  108.746081] check_preemption_disabled: 3155389 callbacks suppressed
[  108.746106] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  108.746181] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[  108.747060] caller is debug_smp_processor_id+0x1c/0x20
[  108.747991] caller is debug_smp_processor_id+0x1c/0x20
[  108.749045] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  108.751388] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  108.752967] Call Trace:
[  108.753370]  dump_stack_lvl+0xa4/0xd3
[  108.753975]  dump_stack+0x15/0x17
[  108.754502]  check_preemption_disabled+0x167/0x180
[  108.755274]  debug_smp_processor_id+0x1c/0x20
[  108.755933]  perf_swevent_get_recursion_context+0x1e/0xd0
[  108.756785]  perf_trace_buf_alloc+0x3d/0x100
[  108.757437]  ? __get_locked_pte+0x1a2/0x290
[  108.758061]  ? __lock_text_start+0x8/0x8
[  108.758679]  perf_ftrace_function_call+0x209/0x360
[  108.759611]  ? 0xffffffffa0098099
[  108.760252]  0xffffffffa0098099
[  108.760779]  ? update_cache_mode_entry+0x80/0x80
[  108.761514]  ? 0xffffffffa0098099
[  108.762063]  ? pmd_page_vaddr+0x2b/0x70
[  108.762696]  ? _raw_spin_lock+0x5/0x50
[  108.763321]  _raw_spin_lock+0x5/0x50
[  108.763879]  __get_locked_pte+0x1a2/0x290
[  108.764492]  ? _raw_spin_lock+0x5/0x50
[  108.765060]  ? __get_locked_pte+0x1a2/0x290
[  108.765717]  ? update_cache_mode_entry+0x80/0x80
[  108.766438]  __text_poke+0xea/0x4e0
[  108.766983]  ? update_cache_mode_entry+0x80/0x80
[  108.767700]  ? lock_is_held_type+0xe2/0x140
[  108.768347]  ? update_cache_mode_entry+0x80/0x80
[  108.769087]  text_poke+0x2b/0x60
[  108.769631]  text_poke_bp_batch+0x1dc/0x2c0
[  108.770317]  ? mmap_base.isra.4+0x130/0x130
[  108.770996]  text_poke_queue+0xa7/0xc0
[  108.771622]  ftrace_replace_code+0xfd/0x170
[  108.772316]  ftrace_modify_all_code+0x1b1/0x270
[  108.773044]  arch_ftrace_update_code+0x9/0x10
[  108.773704]  ftrace_run_update_code+0x30/0xa0
[  108.774389]  ftrace_startup_enable+0x5e/0xa0
[  108.775059]  ftrace_startup+0x16d/0x240
[  108.775727]  register_ftrace_function+0x43/0x90
[  108.776430]  perf_ftrace_event_register+0xc1/0xf0
[  108.777159]  perf_trace_event_init+0xa0/0x4c0
[  108.777874]  perf_trace_init+0xda/0x160
[  108.778517]  perf_tp_event_init+0x57/0xa0
[  108.779151]  perf_try_init_event+0x83/0x270
[  108.779856]  perf_event_alloc+0xe3f/0x1c10
[  108.780473]  ? _raw_spin_unlock+0x2c/0x50
[  108.781165]  ? alloc_fd+0x20d/0x320
[  108.781818]  __do_sys_perf_event_open+0x3bf/0x1de0
[  108.782563]  ? write_comp_data+0x2f/0x90
[  108.783527]  __x64_sys_perf_event_open+0x26/0x30
[  108.784231]  do_syscall_64+0x37/0x80
[  108.784796]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  108.785538] RIP: 0033:0x7fac0740459d
[  108.786091] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  108.788612] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  108.789692] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  108.790693] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  108.791699] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  108.792698] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  108.793694] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  108.794931] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  108.795077] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  108.795827] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  108.796794] caller is debug_smp_processor_id+0x1c/0x20
[  108.798158] Call Trace:
[  108.798170]  dump_stack_lvl+0xa4/0xd3
[  108.798194]  dump_stack+0x15/0x17
[  108.798210]  check_preemption_disabled+0x167/0x180
[  108.798228]  ? do_nanosleep+0x123/0x2a0
[  108.798244]  ? ___might_sleep+0x170/0x170
[  108.798264]  debug_smp_processor_id+0x1c/0x20
[  108.802168]  perf_ftrace_function_call+0x7c/0x360
[  108.802767]  ? 0xffffffffa0098099
[  108.803191]  ? __this_cpu_preempt_check+0x1c/0x20
[  108.803796]  ? finish_task_switch+0xab/0x2a0
[  108.804336]  ? __schedule+0x46e/0xb20
[  108.804816]  ? do_nanosleep+0x9c/0x2a0
[  108.805295]  0xffffffffa0098099
[  108.805702]  ? finish_task_switch+0xb0/0x2a0
[  108.806257]  ? do_nanosleep+0x107/0x2a0
[  108.806750]  ? __might_sleep+0x5/0x70
[  108.807215]  ? write_comp_data+0x2f/0x90
[  108.807716]  __might_sleep+0x5/0x70
[  108.808163]  do_nanosleep+0x123/0x2a0
[  108.808631]  ? __might_sleep+0x5/0x70
[  108.809094]  ? do_nanosleep+0x123/0x2a0
[  108.809578]  ? write_comp_data+0x2f/0x90
[  108.810087]  hrtimer_nanosleep+0xf7/0x1b0
[  108.810615]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[  108.811201]  __x64_sys_nanosleep+0xfc/0x150
[  108.811742]  do_syscall_64+0x37/0x80
[  108.812199]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  108.812834] RIP: 0033:0x7fac073cca18
[  108.813288] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[  108.815520] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[  108.816446] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[  108.817313] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[  108.818181] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[  108.819046] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[  108.819910] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  108.820814] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  108.820856] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[  108.821753] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  108.822688] caller is debug_smp_processor_id+0x1c/0x20
[  108.824100] Call Trace:
[  108.825061]  dump_stack_lvl+0xa4/0xd3
[  108.825585]  dump_stack+0x15/0x17
[  108.826046]  check_preemption_disabled+0x167/0x180
[  108.826726]  debug_smp_processor_id+0x1c/0x20
[  108.827320]  perf_trace_buf_alloc+0x98/0x100
[  108.827904]  ? __get_locked_pte+0x1a2/0x290
[  108.828467]  ? __lock_text_start+0x8/0x8
[  108.829012]  perf_ftrace_function_call+0x209/0x360
[  108.829762]  ? 0xffffffffa0098099
[  108.830285]  0xffffffffa0098099
[  108.830738]  ? update_cache_mode_entry+0x80/0x80
[  108.831371]  ? 0xffffffffa0098099
[  108.831845]  ? pmd_page_vaddr+0x2b/0x70
[  108.832384]  ? _raw_spin_lock+0x5/0x50
[  108.832924]  _raw_spin_lock+0x5/0x50
[  108.833420]  __get_locked_pte+0x1a2/0x290
[  108.833965]  ? _raw_spin_lock+0x5/0x50
[  108.834480]  ? __get_locked_pte+0x1a2/0x290
[  108.835060]  ? update_cache_mode_entry+0x80/0x80
[  108.835695]  __text_poke+0xea/0x4e0
[  108.836179]  ? update_cache_mode_entry+0x80/0x80
[  108.836814]  ? lock_is_held_type+0xe2/0x140
[  108.837389]  ? update_cache_mode_entry+0x80/0x80
[  108.838033]  text_poke+0x2b/0x60
[  108.838505]  text_poke_bp_batch+0x1dc/0x2c0
[  108.839094]  ? mmap_base.isra.4+0x130/0x130
[  108.839681]  text_poke_queue+0xa7/0xc0
[  108.840218]  ftrace_replace_code+0xfd/0x170
[  108.840812]  ftrace_modify_all_code+0x1b1/0x270
[  108.841445]  arch_ftrace_update_code+0x9/0x10
[  108.842034]  ftrace_run_update_code+0x30/0xa0
[  108.842638]  ftrace_startup_enable+0x5e/0xa0
[  108.843229]  ftrace_startup+0x16d/0x240
[  108.843796]  register_ftrace_function+0x43/0x90
[  108.844419]  perf_ftrace_event_register+0xc1/0xf0
[  108.845063]  perf_trace_event_init+0xa0/0x4c0
[  108.845680]  perf_trace_init+0xda/0x160
[  108.846235]  perf_tp_event_init+0x57/0xa0
[  108.846795]  perf_try_init_event+0x83/0x270
[  108.847398]  perf_event_alloc+0xe3f/0x1c10
[  108.847952]  ? _raw_spin_unlock+0x2c/0x50
[  108.848506]  ? alloc_fd+0x20d/0x320
[  108.849043]  __do_sys_perf_event_open+0x3bf/0x1de0
[  108.849698]  ? write_comp_data+0x2f/0x90
[  108.850414]  __x64_sys_perf_event_open+0x26/0x30
[  108.851040]  do_syscall_64+0x37/0x80
[  108.851538]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  108.852209] RIP: 0033:0x7fac0740459d
[  108.852698] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  108.855024] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  108.856002] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  108.856916] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  108.857829] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  108.858758] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  108.859672] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  108.860700] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  108.860874] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  108.861592] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  108.862663] caller is debug_smp_processor_id+0x1c/0x20
[  108.863926] Call Trace:
[  108.864895]  dump_stack_lvl+0xa4/0xd3
[  108.865369]  dump_stack+0x15/0x17
[  108.865793]  check_preemption_disabled+0x167/0x180
[  108.866405]  ? __might_sleep+0x48/0x70
[  108.866878]  ? sched_show_task+0x70/0x70
[  108.867380]  debug_smp_processor_id+0x1c/0x20
[  108.867929]  perf_ftrace_function_call+0x7c/0x360
[  108.868516]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  108.869101]  ? do_nanosleep+0x123/0x2a0
[  108.869587]  ? perf_ftrace_function_call+0x4c/0x360
[  108.870214]  ? 0xffffffffa0098099
[  108.870637]  ? __this_cpu_preempt_check+0x1c/0x20
[  108.871240]  ? finish_task_switch+0xab/0x2a0
[  108.871775]  ? __schedule+0x46e/0xb20
[  108.872245]  ? do_nanosleep+0x9c/0x2a0
[  108.872726]  0xffffffffa0098099
[  108.873128]  ? do_nanosleep+0x9c/0x2a0
[  108.873619]  ? do_nanosleep+0x107/0x2a0
[  108.874111]  ? ___might_sleep+0x5/0x170
[  108.874617]  ___might_sleep+0x5/0x170
[  108.875087]  __might_sleep+0x48/0x70
[  108.875542]  ? ___might_sleep+0x5/0x170
[  108.876025]  ? __might_sleep+0x48/0x70
[  108.876505]  do_nanosleep+0x123/0x2a0
[  108.876969]  ? write_comp_data+0x2f/0x90
[  108.877477]  hrtimer_nanosleep+0xf7/0x1b0
[  108.877994]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[  108.878582]  __x64_sys_nanosleep+0xfc/0x150
[  108.879121]  do_syscall_64+0x37/0x80
[  108.879578]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  108.880206] RIP: 0033:0x7fac073cca18
[  108.880656] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[  108.882875] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[  108.883795] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[  108.884658] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[  108.885521] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[  108.886386] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[  108.887248] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  108.888147] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  108.888176] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[  108.889091] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  108.890023] caller is debug_smp_processor_id+0x1c/0x20
[  108.891434] Call Trace:
[  108.892398]  dump_stack_lvl+0xa4/0xd3
[  108.892922]  dump_stack+0x15/0x17
[  108.893384]  check_preemption_disabled+0x167/0x180
[  108.894055]  debug_smp_processor_id+0x1c/0x20
[  108.894652]  perf_swevent_put_recursion_context+0x1b/0x40
[  108.895382]  perf_tp_event+0x331/0x4e0
[  108.896052]  ? arch_local_irq_enable+0x10/0x12
[  108.896658]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  108.897301]  ? dump_stack_lvl+0xcc/0xd3
[  108.897843]  ? dump_stack+0x15/0x17
[  108.898330]  ? check_preemption_disabled+0x167/0x180
[  108.899023]  ? __get_locked_pte+0x1a2/0x290
[  108.899596]  ? __lock_text_start+0x8/0x8
[  108.900144]  perf_ftrace_function_call+0x248/0x360
[  108.900781]  ? perf_ftrace_function_call+0x248/0x360
[  108.901561]  ? 0xffffffffa0098099
[  108.902079]  0xffffffffa0098099
[  108.902538]  ? update_cache_mode_entry+0x80/0x80
[  108.903173]  ? 0xffffffffa0098099
[  108.903646]  ? pmd_page_vaddr+0x2b/0x70
[  108.904185]  ? _raw_spin_lock+0x5/0x50
[  108.904722]  _raw_spin_lock+0x5/0x50
[  108.905217]  __get_locked_pte+0x1a2/0x290
[  108.905763]  ? _raw_spin_lock+0x5/0x50
[  108.906276]  ? __get_locked_pte+0x1a2/0x290
[  108.906857]  ? update_cache_mode_entry+0x80/0x80
[  108.907491]  __text_poke+0xea/0x4e0
[  108.907975]  ? update_cache_mode_entry+0x80/0x80
[  108.908608]  ? lock_is_held_type+0xe2/0x140
[  108.909182]  ? update_cache_mode_entry+0x80/0x80
[  108.909827]  text_poke+0x2b/0x60
[  108.910299]  text_poke_bp_batch+0x1dc/0x2c0
[  108.910890]  ? mmap_base.isra.4+0x130/0x130
[  108.911479]  text_poke_queue+0xa7/0xc0
[  108.912018]  ftrace_replace_code+0xfd/0x170
[  108.912613]  ftrace_modify_all_code+0x1b1/0x270
[  108.913247]  arch_ftrace_update_code+0x9/0x10
[  108.913837]  ftrace_run_update_code+0x30/0xa0
[  108.914442]  ftrace_startup_enable+0x5e/0xa0
[  108.915033]  ftrace_startup+0x16d/0x240
[  108.915598]  register_ftrace_function+0x43/0x90
[  108.916221]  perf_ftrace_event_register+0xc1/0xf0
[  108.916866]  perf_trace_event_init+0xa0/0x4c0
[  108.917486]  perf_trace_init+0xda/0x160
[  108.918037]  perf_tp_event_init+0x57/0xa0
[  108.918600]  perf_try_init_event+0x83/0x270
[  108.919205]  perf_event_alloc+0xe3f/0x1c10
[  108.919759]  ? _raw_spin_unlock+0x2c/0x50
[  108.920313]  ? alloc_fd+0x20d/0x320
[  108.920850]  __do_sys_perf_event_open+0x3bf/0x1de0
[  108.921505]  ? write_comp_data+0x2f/0x90
[  108.922222]  __x64_sys_perf_event_open+0x26/0x30
[  108.922848]  do_syscall_64+0x37/0x80
[  108.923348]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  108.924018] RIP: 0033:0x7fac0740459d
[  108.924507] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  108.926834] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  108.927817] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  108.928732] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  108.929646] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  108.930562] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  108.931480] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  108.932514] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  108.932651] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  108.933409] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  108.934554] caller is debug_smp_processor_id+0x1c/0x20
[  108.935815] Call Trace:
[  108.935825]  dump_stack_lvl+0xa4/0xd3
[  108.937288]  dump_stack+0x15/0x17
[  108.937713]  check_preemption_disabled+0x167/0x180
[  108.938317]  ? do_nanosleep+0x155/0x2a0
[  108.938805]  ? hrtimer_wakeup+0x40/0x40
[  108.939298]  debug_smp_processor_id+0x1c/0x20
[  108.939848]  perf_ftrace_function_call+0x7c/0x360
[  108.940446]  ? 0xffffffffa0098099
[  108.940870]  ? __this_cpu_preempt_check+0x1c/0x20
[  108.941475]  ? finish_task_switch+0xab/0x2a0
[  108.942011]  ? __schedule+0x46e/0xb20
[  108.942486]  ? do_nanosleep+0x9c/0x2a0
[  108.942970]  ? do_nanosleep+0x9c/0x2a0
[  108.943450]  0xffffffffa0098099
[  108.943855]  ? __this_cpu_preempt_check+0x1c/0x20
[  108.944447]  ? lock_is_held_type+0xe2/0x140
[  108.944980]  ? do_nanosleep+0x140/0x2a0
[  108.945473]  ? hrtimer_try_to_cancel+0x5/0x290
[  108.946031]  ? write_comp_data+0x2f/0x90
[  108.946533]  hrtimer_try_to_cancel+0x5/0x290
[  108.947072]  do_nanosleep+0x155/0x2a0
[  108.947540]  ? hrtimer_try_to_cancel+0x5/0x290
[  108.948098]  ? do_nanosleep+0x155/0x2a0
[  108.948583]  ? write_comp_data+0x2f/0x90
[  108.949093]  hrtimer_nanosleep+0xf7/0x1b0
[  108.949612]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[  108.950201]  __x64_sys_nanosleep+0xfc/0x150
[  108.950741]  do_syscall_64+0x37/0x80
[  108.951199]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  108.951829] RIP: 0033:0x7fac073cca18
[  108.952280] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[  108.954508] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[  108.955430] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[  108.956295] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[  108.957161] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[  108.958032] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[  108.958898] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  108.959803] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  108.959828] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[  108.960828] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  108.961739] caller is debug_smp_processor_id+0x1c/0x20
[  108.963287] Call Trace:
[  108.963323]  dump_stack_lvl+0xa4/0xd3
[  108.964857]  dump_stack+0x15/0x17
[  108.965378]  check_preemption_disabled+0x167/0x180
[  108.966095]  ? _raw_spin_lock+0x17/0x50
[  108.966678]  ? trace_sched_waking+0xc0/0xc0
[  108.967333]  debug_smp_processor_id+0x1c/0x20
[  108.968004]  perf_ftrace_function_call+0x7c/0x360
[  108.968698]  ? __get_locked_pte+0x1a2/0x290
[  108.969330]  ? perf_ftrace_function_call+0x4c/0x360
[  108.970275]  ? 0xffffffffa0098099
[  108.970879]  0xffffffffa0098099
[  108.971397]  ? 0xffffffffa0098099
[  108.971946]  ? update_cache_mode_entry+0x80/0x80
[  108.972672]  ? pmd_page_vaddr+0x2b/0x70
[  108.973292]  ? preempt_count_add+0x5/0xc0
[  108.973946]  preempt_count_add+0x5/0xc0
[  108.974541]  _raw_spin_lock+0x17/0x50
[  108.975111]  ? preempt_count_add+0x5/0xc0
[  108.975711]  ? _raw_spin_lock+0x17/0x50
[  108.976314]  __get_locked_pte+0x1a2/0x290
[  108.976946]  ? update_cache_mode_entry+0x80/0x80
[  108.977661]  __text_poke+0xea/0x4e0
[  108.978209]  ? update_cache_mode_entry+0x80/0x80
[  108.978926]  ? lock_is_held_type+0xe2/0x140
[  108.979572]  ? update_cache_mode_entry+0x80/0x80
[  108.980310]  text_poke+0x2b/0x60
[  108.980854]  text_poke_bp_batch+0x1dc/0x2c0
[  108.981534]  ? mmap_base.isra.4+0x130/0x130
[  108.982215]  text_poke_queue+0xa7/0xc0
[  108.982839]  ftrace_replace_code+0xfd/0x170
[  108.983530]  ftrace_modify_all_code+0x1b1/0x270
[  108.984256]  arch_ftrace_update_code+0x9/0x10
[  108.984914]  ftrace_run_update_code+0x30/0xa0
[  108.985596]  ftrace_startup_enable+0x5e/0xa0
[  108.986270]  ftrace_startup+0x16d/0x240
[  108.986937]  register_ftrace_function+0x43/0x90
[  108.987638]  perf_ftrace_event_register+0xc1/0xf0
[  108.988364]  perf_trace_event_init+0xa0/0x4c0
[  108.989078]  perf_trace_init+0xda/0x160
[  108.989711]  perf_tp_event_init+0x57/0xa0
[  108.990350]  perf_try_init_event+0x83/0x270
[  108.991054]  perf_event_alloc+0xe3f/0x1c10
[  108.991667]  ? _raw_spin_unlock+0x2c/0x50
[  108.992293]  ? alloc_fd+0x20d/0x320
[  108.992944]  __do_sys_perf_event_open+0x3bf/0x1de0
[  108.993682]  ? write_comp_data+0x2f/0x90
[  108.994636]  __x64_sys_perf_event_open+0x26/0x30
[  108.995339]  do_syscall_64+0x37/0x80
[  108.995904]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  108.996643] RIP: 0033:0x7fac0740459d
[  108.997191] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  108.999716] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  109.000795] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  109.001796] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  109.002798] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  109.003813] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  109.004815] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  109.006047] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  109.006188] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  109.006947] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  109.007998] caller is debug_smp_processor_id+0x1c/0x20
[  109.009352] Call Trace:
[  109.009363]  dump_stack_lvl+0xa4/0xd3
[  109.010839]  dump_stack+0x15/0x17
[  109.011265]  check_preemption_disabled+0x167/0x180
[  109.011865]  ? hrtimer_try_to_cancel+0x38/0x290
[  109.012434]  ? __hrtimer_get_remaining+0x80/0x80
[  109.013017]  debug_smp_processor_id+0x1c/0x20
[  109.013565]  perf_ftrace_function_call+0x7c/0x360
[  109.014157]  ? do_nanosleep+0x155/0x2a0
[  109.014643]  ? hrtimer_wakeup+0x40/0x40
[  109.015131]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  109.015721]  ? do_nanosleep+0x155/0x2a0
[  109.016210]  ? perf_ftrace_function_call+0x4c/0x360
[  109.016828]  ? 0xffffffffa0098099
[  109.017252]  ? __this_cpu_preempt_check+0x1c/0x20
[  109.017862]  ? do_nanosleep+0x9c/0x2a0
[  109.018345]  0xffffffffa0098099
[  109.018747]  ? do_nanosleep+0x9c/0x2a0
[  109.019231]  ? do_nanosleep+0x9c/0x2a0
[  109.019716]  ? do_nanosleep+0x140/0x2a0
[  109.020209]  ? hrtimer_active+0x5/0xb0
[  109.020691]  ? do_nanosleep+0x140/0x2a0
[  109.021178]  hrtimer_active+0x5/0xb0
[  109.021637]  hrtimer_try_to_cancel+0x38/0x290
[  109.022192]  ? hrtimer_active+0x5/0xb0
[  109.022668]  ? hrtimer_try_to_cancel+0x38/0x290
[  109.023244]  ? do_nanosleep+0x9c/0x2a0
[  109.023723]  do_nanosleep+0x155/0x2a0
[  109.024188]  ? write_comp_data+0x2f/0x90
[  109.024696]  hrtimer_nanosleep+0xf7/0x1b0
[  109.025215]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[  109.025801]  __x64_sys_nanosleep+0xfc/0x150
[  109.026348]  do_syscall_64+0x37/0x80
[  109.026805]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  109.027436] RIP: 0033:0x7fac073cca18
[  109.027888] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[  109.030106] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[  109.031033] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[  109.031898] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[  109.032764] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[  109.033629] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[  109.034496] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  109.035403] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  109.035431] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[  109.036434] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  109.037347] caller is debug_smp_processor_id+0x1c/0x20
[  109.038914] Call Trace:
[  109.038951]  dump_stack_lvl+0xa4/0xd3
[  109.040493]  dump_stack+0x15/0x17
[  109.041018]  check_preemption_disabled+0x167/0x180
[  109.041795]  debug_smp_processor_id+0x1c/0x20
[  109.042471]  perf_swevent_get_recursion_context+0x1e/0xd0
[  109.043329]  perf_trace_buf_alloc+0x3d/0x100
[  109.043980]  ? _raw_spin_lock+0x17/0x50
[  109.044562]  ? trace_sched_waking+0xc0/0xc0
[  109.045211]  perf_ftrace_function_call+0x209/0x360
[  109.045942]  ? perf_ftrace_function_call+0x4c/0x360
[  109.046862]  ? 0xffffffffa0098099
[  109.047504]  0xffffffffa0098099
[  109.048024]  ? 0xffffffffa0098099
[  109.048574]  ? update_cache_mode_entry+0x80/0x80
[  109.049305]  ? pmd_page_vaddr+0x2b/0x70
[  109.049929]  ? preempt_count_add+0x5/0xc0
[  109.050592]  preempt_count_add+0x5/0xc0
[  109.051186]  _raw_spin_lock+0x17/0x50
[  109.051757]  ? preempt_count_add+0x5/0xc0
[  109.052360]  ? _raw_spin_lock+0x17/0x50
[  109.052964]  __get_locked_pte+0x1a2/0x290
[  109.053601]  ? update_cache_mode_entry+0x80/0x80
[  109.054321]  __text_poke+0xea/0x4e0
[  109.054869]  ? update_cache_mode_entry+0x80/0x80
[  109.055587]  ? lock_is_held_type+0xe2/0x140
[  109.056236]  ? update_cache_mode_entry+0x80/0x80
[  109.056975]  text_poke+0x2b/0x60
[  109.057520]  text_poke_bp_batch+0x1dc/0x2c0
[  109.058206]  ? mmap_base.isra.4+0x130/0x130
[  109.058887]  text_poke_queue+0xa7/0xc0
[  109.059513]  ftrace_replace_code+0xfd/0x170
[  109.060206]  ftrace_modify_all_code+0x1b1/0x270
[  109.060933]  arch_ftrace_update_code+0x9/0x10
[  109.061595]  ftrace_run_update_code+0x30/0xa0
[  109.062283]  ftrace_startup_enable+0x5e/0xa0
[  109.062956]  ftrace_startup+0x16d/0x240
[  109.063627]  register_ftrace_function+0x43/0x90
[  109.064334]  perf_ftrace_event_register+0xc1/0xf0
[  109.065064]  perf_trace_event_init+0xa0/0x4c0
[  109.065782]  perf_trace_init+0xda/0x160
[  109.066425]  perf_tp_event_init+0x57/0xa0
[  109.067062]  perf_try_init_event+0x83/0x270
[  109.067767]  perf_event_alloc+0xe3f/0x1c10
[  109.068383]  ? _raw_spin_unlock+0x2c/0x50
[  109.069009]  ? alloc_fd+0x20d/0x320
[  109.069664]  __do_sys_perf_event_open+0x3bf/0x1de0
[  109.070410]  ? write_comp_data+0x2f/0x90
[  109.071368]  __x64_sys_perf_event_open+0x26/0x30
[  109.072073]  do_syscall_64+0x37/0x80
[  109.072643]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  109.073388] RIP: 0033:0x7fac0740459d
[  109.073938] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  109.076474] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  109.077559] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  109.078562] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  109.079566] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  109.080571] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  109.081574] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  109.082815] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  109.083713] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  109.085085] Call Trace:
[  109.085403]  dump_stack_lvl+0xa4/0xd3
[  109.085876]  dump_stack+0x15/0x17
[  109.086310]  check_preemption_disabled+0x167/0x180
[  109.086912]  ? syscall_exit_to_user_mode+0xd/0x60
[  109.087501]  ? __bpf_trace_sys_enter+0x10/0x10
[  109.088063]  debug_smp_processor_id+0x1c/0x20
[  109.088614]  perf_ftrace_function_call+0x7c/0x360
[  109.089210]  ? write_comp_data+0x2f/0x90
[  109.089715]  ? write_comp_data+0x2f/0x90
[  109.090220]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  109.090813]  ? write_comp_data+0x2f/0x90
[  109.091315]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  109.091917]  0xffffffffa0098099
[  109.092320]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  109.092933]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[  109.093613]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  109.094209]  syscall_exit_to_user_mode_prepare+0x5/0x240
[  109.094869]  syscall_exit_to_user_mode+0xd/0x60
[  109.095440]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[  109.096117]  ? syscall_exit_to_user_mode+0xd/0x60
[  109.096709]  do_syscall_64+0x46/0x80
[  109.097168]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  109.097797] RIP: 0033:0x7fac073cca18
[  109.098253] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[  109.100473] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[  109.101394] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac073cca18
[  109.102262] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[  109.103125] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[  109.103988] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[  109.104852] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  113.750104] check_preemption_disabled: 1134137 callbacks suppressed
[  113.750140] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  113.750237] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[  113.751099] caller is debug_smp_processor_id+0x1c/0x20
[  113.752040] caller is debug_smp_processor_id+0x1c/0x20
[  113.753159] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  113.755543] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  113.757143] Call Trace:
[  113.757575]  dump_stack_lvl+0xa4/0xd3
[  113.758235]  dump_stack+0x15/0x17
[  113.758791]  check_preemption_disabled+0x167/0x180
[  113.759631]  debug_smp_processor_id+0x1c/0x20
[  113.760326]  perf_swevent_get_recursion_context+0x1e/0xd0
[  113.761246]  perf_trace_buf_alloc+0x3d/0x100
[  113.761927]  ? insn_get_modrm+0x12b/0x2a0
[  113.762564]  ? insn_get_prefixes+0x50/0x50
[  113.763237]  perf_ftrace_function_call+0x209/0x360
[  113.764003]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  113.765027]  ? 0xffffffffa0098099
[  113.765771]  0xffffffffa0098099
[  113.766416]  ? 0xffffffffa0098099
[  113.767033]  ? insn_get_modrm+0x49/0x2a0
[  113.767719]  ? insn_get_opcode+0x5/0x3b0
[  113.768352]  ? write_comp_data+0x2f/0x90
[  113.769020]  insn_get_opcode+0x5/0x3b0
[  113.769632]  insn_get_modrm+0x12b/0x2a0
[  113.770262]  ? insn_get_opcode+0x5/0x3b0
[  113.770878]  ? insn_get_modrm+0x12b/0x2a0
[  113.771610]  insn_get_sib+0x122/0x140
[  113.772280]  insn_get_displacement+0x157/0x270
[  113.773055]  insn_get_immediate+0x181/0x570
[  113.773812]  insn_get_length+0x75/0x90
[  113.774489]  insn_decode+0x9b/0x170
[  113.775101]  ? ext4_mb_release_group_pa+0x430/0x430
[  113.775865]  text_poke_loc_init+0x63/0x140
[  113.776773]  ? ext4_mb_release_group_pa+0x430/0x430
[  113.777607]  text_poke_queue+0x84/0xc0
[  113.778309]  ftrace_replace_code+0xfd/0x170
[  113.779074]  ftrace_modify_all_code+0x1b1/0x270
[  113.779860]  arch_ftrace_update_code+0x9/0x10
[  113.780552]  ftrace_run_update_code+0x30/0xa0
[  113.781276]  ftrace_startup_enable+0x5e/0xa0
[  113.781990]  ftrace_startup+0x16d/0x240
[  113.782749]  register_ftrace_function+0x43/0x90
[  113.783501]  perf_ftrace_event_register+0xc1/0xf0
[  113.784277]  perf_trace_event_init+0xa0/0x4c0
[  113.785058]  perf_trace_init+0xda/0x160
[  113.785753]  perf_tp_event_init+0x57/0xa0
[  113.786439]  perf_try_init_event+0x83/0x270
[  113.787216]  perf_event_alloc+0xe3f/0x1c10
[  113.787856]  ? _raw_spin_unlock+0x2c/0x50
[  113.788521]  ? alloc_fd+0x20d/0x320
[  113.789273]  __do_sys_perf_event_open+0x3bf/0x1de0
[  113.790060]  ? write_comp_data+0x2f/0x90
[  113.791268]  __x64_sys_perf_event_open+0x26/0x30
[  113.792011]  do_syscall_64+0x37/0x80
[  113.792618]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  113.793387] RIP: 0033:0x7fac0740459d
[  113.793969] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  113.796529] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  113.797649] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  113.798684] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  113.799708] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  113.800750] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  113.801794] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  113.803241] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  113.803421] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  113.804206] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  113.805186] caller is debug_smp_processor_id+0x1c/0x20
[  113.806553] Call Trace:
[  113.806583]  dump_stack_lvl+0xa4/0xd3
[  113.806649]  dump_stack+0x15/0x17
[  113.806686]  check_preemption_disabled+0x167/0x180
[  113.806725]  ? lock_timer_base+0x34/0x100
[  113.809666]  ? _raw_read_lock_irqsave+0x90/0x90
[  113.810290]  debug_smp_processor_id+0x1c/0x20
[  113.810872]  perf_ftrace_function_call+0x7c/0x360
[  113.811514]  ? ftrace_ops_test+0x71/0xc0
[  113.812078]  ? ftrace_ops_test+0x71/0xc0
[  113.812617]  ? perf_trace_buf_update+0x70/0x70
[  113.813208]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  113.813848]  ? ftrace_ops_list_func+0x1d2/0x2e0
[  113.814453]  ? write_comp_data+0x2f/0x90
[  113.814992]  ? perf_trace_buf_update+0x70/0x70
[  113.815648]  0xffffffffa0098099
[  113.816146]  ? ftrace_call+0x5/0x44
[  113.816643]  ? lock_timer_base+0xc0/0x100
[  113.817211]  ? _raw_spin_lock_irqsave+0x5/0x70
[  113.817804]  ? write_comp_data+0x2f/0x90
[  113.818355]  _raw_spin_lock_irqsave+0x5/0x70
[  113.818927]  lock_timer_base+0x34/0x100
[  113.819448]  ? _raw_spin_lock_irqsave+0x5/0x70
[  113.820030]  ? lock_timer_base+0x34/0x100
[  113.820627]  try_to_del_timer_sync+0x33/0x90
[  113.821190]  ? try_to_del_timer_sync+0x5/0x90
[  113.821800]  del_timer_sync+0xd3/0x130
[  113.822343]  schedule_timeout+0x34e/0x610
[  113.822940]  ? del_timer_sync+0x130/0x130
[  113.823517]  ? i915_init_ggtt+0x40/0x6b0
[  113.824113]  rcu_gp_fqs_loop+0x2a0/0x410
[  113.824708]  ? rcu_gp_init+0x730/0x730
[  113.825217]  rcu_gp_kthread+0xdd/0x170
[  113.825772]  kthread+0x1e7/0x230
[  113.826239]  ? set_kthread_struct+0x80/0x80
[  113.826837]  ret_from_fork+0x1f/0x30
[  113.827515] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  113.827631] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[  113.828480] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  113.829452] caller is debug_smp_processor_id+0x1c/0x20
[  113.830907] Call Trace:
[  113.830944]  dump_stack_lvl+0xa4/0xd3
[  113.831027]  dump_stack+0x15/0x17
[  113.832902]  check_preemption_disabled+0x167/0x180
[  113.833646]  debug_smp_processor_id+0x1c/0x20
[  113.834280]  perf_trace_buf_alloc+0x98/0x100
[  113.834898]  ? insn_get_modrm+0x12b/0x2a0
[  113.835468]  ? insn_get_prefixes+0x50/0x50
[  113.836074]  perf_ftrace_function_call+0x209/0x360
[  113.836986]  ? 0xffffffffa0098099
[  113.837612]  0xffffffffa0098099
[  113.838160]  ? 0xffffffffa0098099
[  113.838698]  ? insn_get_modrm+0x49/0x2a0
[  113.839303]  ? insn_get_opcode+0x5/0x3b0
[  113.839874]  ? write_comp_data+0x2f/0x90
[  113.840468]  insn_get_opcode+0x5/0x3b0
[  113.841017]  insn_get_modrm+0x12b/0x2a0
[  113.841577]  ? insn_get_opcode+0x5/0x3b0
[  113.842139]  ? insn_get_modrm+0x12b/0x2a0
[  113.842781]  insn_get_sib+0x122/0x140
[  113.843370]  insn_get_displacement+0x157/0x270
[  113.844054]  insn_get_immediate+0x181/0x570
[  113.844718]  insn_get_length+0x75/0x90
[  113.845305]  insn_decode+0x9b/0x170
[  113.845847]  ? ext4_mb_release_group_pa+0x430/0x430
[  113.846545]  text_poke_loc_init+0x63/0x140
[  113.847308]  ? ext4_mb_release_group_pa+0x430/0x430
[  113.848048]  text_poke_queue+0x84/0xc0
[  113.848649]  ftrace_replace_code+0xfd/0x170
[  113.849315]  ftrace_modify_all_code+0x1b1/0x270
[  113.850012]  arch_ftrace_update_code+0x9/0x10
[  113.850640]  ftrace_run_update_code+0x30/0xa0
[  113.851291]  ftrace_startup_enable+0x5e/0xa0
[  113.851930]  ftrace_startup+0x16d/0x240
[  113.852576]  register_ftrace_function+0x43/0x90
[  113.853250]  perf_ftrace_event_register+0xc1/0xf0
[  113.853945]  perf_trace_event_init+0xa0/0x4c0
[  113.854636]  perf_trace_init+0xda/0x160
[  113.855246]  perf_tp_event_init+0x57/0xa0
[  113.855855]  perf_try_init_event+0x83/0x270
[  113.856534]  perf_event_alloc+0xe3f/0x1c10
[  113.857117]  ? _raw_spin_unlock+0x2c/0x50
[  113.857714]  ? alloc_fd+0x20d/0x320
[  113.858358]  __do_sys_perf_event_open+0x3bf/0x1de0
[  113.859063]  ? write_comp_data+0x2f/0x90
[  113.860021]  __x64_sys_perf_event_open+0x26/0x30
[  113.860692]  do_syscall_64+0x37/0x80
[  113.861234]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  113.861935] RIP: 0033:0x7fac0740459d
[  113.862462] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  113.864844] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  113.865870] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  113.866816] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  113.867761] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  113.868706] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  113.869652] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  113.870856] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  113.871023] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  113.871819] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  113.872798] caller is debug_smp_processor_id+0x1c/0x20
[  113.874167] Call Trace:
[  113.874195]  dump_stack_lvl+0xa4/0xd3
[  113.874261]  dump_stack+0x15/0x17
[  113.874297]  check_preemption_disabled+0x167/0x180
[  113.874336]  ? prepare_to_swait_event+0x1b/0xf0
[  113.877344]  ? _raw_read_lock_irqsave+0x90/0x90
[  113.877968]  debug_smp_processor_id+0x1c/0x20
[  113.878555]  perf_ftrace_function_call+0x7c/0x360
[  113.879172]  ? ftrace_ops_test+0x71/0xc0
[  113.879783]  ? trace_hardirqs_on+0x3f/0x170
[  113.880382]  ? write_comp_data+0x2f/0x90
[  113.880922]  ? perf_trace_buf_update+0x70/0x70
[  113.881516]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  113.882216]  0xffffffffa0098099
[  113.882697]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  113.883355]  ? del_timer_sync+0xde/0x130
[  113.883913]  ? _raw_spin_lock_irqsave+0x5/0x70
[  113.884544]  _raw_spin_lock_irqsave+0x5/0x70
[  113.885117]  prepare_to_swait_event+0x1b/0xf0
[  113.885700]  ? _raw_spin_lock_irqsave+0x5/0x70
[  113.886288]  ? prepare_to_swait_event+0x1b/0xf0
[  113.886919]  rcu_gp_fqs_loop+0x2b4/0x410
[  113.887513]  ? rcu_gp_init+0x730/0x730
[  113.888023]  rcu_gp_kthread+0xdd/0x170
[  113.888579]  kthread+0x1e7/0x230
[  113.889038]  ? set_kthread_struct+0x80/0x80
[  113.889638]  ret_from_fork+0x1f/0x30
[  113.890319] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  113.890430] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[  113.891285] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  113.892257] caller is debug_smp_processor_id+0x1c/0x20
[  113.893701] Call Trace:
[  113.894698]  dump_stack_lvl+0xa4/0xd3
[  113.895272]  dump_stack+0x15/0x17
[  113.895768]  check_preemption_disabled+0x167/0x180
[  113.896510]  debug_smp_processor_id+0x1c/0x20
[  113.897138]  perf_swevent_put_recursion_context+0x1b/0x40
[  113.897914]  perf_tp_event+0x331/0x4e0
[  113.898671]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[  113.899594]  ? arch_local_irq_enable+0x10/0x12
[  113.900229]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  113.900920]  ? dump_stack_lvl+0xcc/0xd3
[  113.901516]  ? dump_stack+0x15/0x17
[  113.902057]  ? insn_get_modrm+0x12b/0x2a0
[  113.902626]  ? insn_get_prefixes+0x50/0x50
[  113.903241]  perf_ftrace_function_call+0x248/0x360
[  113.903919]  ? perf_trace_buf_alloc+0xb0/0x100
[  113.904554]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  113.905221]  ? perf_ftrace_function_call+0x248/0x360
[  113.906179]  ? 0xffffffffa0098099
[  113.906802]  0xffffffffa0098099
[  113.907342]  ? 0xffffffffa0098099
[  113.907880]  ? insn_get_modrm+0x49/0x2a0
[  113.908485]  ? insn_get_opcode+0x5/0x3b0
[  113.909055]  ? write_comp_data+0x2f/0x90
[  113.909649]  insn_get_opcode+0x5/0x3b0
[  113.910201]  insn_get_modrm+0x12b/0x2a0
[  113.910760]  ? insn_get_opcode+0x5/0x3b0
[  113.911318]  ? insn_get_modrm+0x12b/0x2a0
[  113.911956]  insn_get_sib+0x122/0x140
[  113.912541]  insn_get_displacement+0x157/0x270
[  113.913224]  insn_get_immediate+0x181/0x570
[  113.913886]  insn_get_length+0x75/0x90
[  113.914475]  insn_decode+0x9b/0x170
[  113.915016]  ? ext4_mb_release_group_pa+0x430/0x430
[  113.915707]  text_poke_loc_init+0x63/0x140
[  113.916468]  ? ext4_mb_release_group_pa+0x430/0x430
[  113.917206]  text_poke_queue+0x84/0xc0
[  113.917805]  ftrace_replace_code+0xfd/0x170
[  113.918470]  ftrace_modify_all_code+0x1b1/0x270
[  113.919165]  arch_ftrace_update_code+0x9/0x10
[  113.919790]  ftrace_run_update_code+0x30/0xa0
[  113.920440]  ftrace_startup_enable+0x5e/0xa0
[  113.921078]  ftrace_startup+0x16d/0x240
[  113.921722]  register_ftrace_function+0x43/0x90
[  113.922399]  perf_ftrace_event_register+0xc1/0xf0
[  113.923092]  perf_trace_event_init+0xa0/0x4c0
[  113.923778]  perf_trace_init+0xda/0x160
[  113.924387]  perf_tp_event_init+0x57/0xa0
[  113.924994]  perf_try_init_event+0x83/0x270
[  113.925671]  perf_event_alloc+0xe3f/0x1c10
[  113.926255]  ? _raw_spin_unlock+0x2c/0x50
[  113.926850]  ? alloc_fd+0x20d/0x320
[  113.927486]  __do_sys_perf_event_open+0x3bf/0x1de0
[  113.928188]  ? write_comp_data+0x2f/0x90
[  113.929222]  __x64_sys_perf_event_open+0x26/0x30
[  113.929888]  do_syscall_64+0x37/0x80
[  113.930436]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  113.931130] RIP: 0033:0x7fac0740459d
[  113.931649] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  113.933998] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  113.935013] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  113.935947] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  113.936882] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  113.937815] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  113.938756] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  113.939948] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  113.940120] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  113.940915] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  113.942114] caller is debug_smp_processor_id+0x1c/0x20
[  113.943340] Call Trace:
[  113.944398]  dump_stack_lvl+0xa4/0xd3
[  113.944927]  dump_stack+0x15/0x17
[  113.945387]  check_preemption_disabled+0x167/0x180
[  113.946021]  ? finish_swait+0x41/0x80
[  113.946516]  ? _raw_read_lock_irqsave+0x90/0x90
[  113.947139]  debug_smp_processor_id+0x1c/0x20
[  113.947722]  perf_ftrace_function_call+0x7c/0x360
[  113.948336]  ? ftrace_ops_test+0x71/0xc0
[  113.948875]  ? rcu_advance_cbs+0x70/0x70
[  113.949433]  ? write_comp_data+0x2f/0x90
[  113.949971]  ? perf_trace_buf_update+0x70/0x70
[  113.950568]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  113.951208]  ? write_comp_data+0x2f/0x90
[  113.951747]  ? perf_trace_buf_update+0x70/0x70
[  113.952339]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  113.953034]  0xffffffffa0098099
[  113.953532]  ? trace_hardirqs_on+0x3f/0x170
[  113.954162]  ? _raw_spin_lock_irqsave+0x5/0x70
[  113.954792]  _raw_spin_lock_irqsave+0x5/0x70
[  113.955365]  finish_swait+0x41/0x80
[  113.955845]  ? _raw_spin_lock_irqsave+0x5/0x70
[  113.956428]  ? finish_swait+0x41/0x80
[  113.956955]  rcu_gp_fqs_loop+0x2da/0x410
[  113.957549]  ? rcu_gp_init+0x730/0x730
[  113.958059]  rcu_gp_kthread+0xdd/0x170
[  113.958621]  kthread+0x1e7/0x230
[  113.959091]  ? set_kthread_struct+0x80/0x80
[  113.959690]  ret_from_fork+0x1f/0x30
[  113.960369] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  113.960480] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[  113.961414] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  113.962452] caller is debug_smp_processor_id+0x1c/0x20
[  113.963946] Call Trace:
[  113.964981]  dump_stack_lvl+0xa4/0xd3
[  113.965634]  dump_stack+0x15/0x17
[  113.966191]  check_preemption_disabled+0x167/0x180
[  113.966942]  ? insn_get_opcode+0x1d5/0x3b0
[  113.967579]  ? insn_decode_from_regs+0x110/0x110
[  113.968338]  debug_smp_processor_id+0x1c/0x20
[  113.969030]  perf_ftrace_function_call+0x7c/0x360
[  113.969750]  ? perf_trace_buf_alloc+0xb0/0x100
[  113.970459]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  113.971195]  ? insn_get_modrm+0x12b/0x2a0
[  113.971837]  ? perf_ftrace_function_call+0x4c/0x360
[  113.973021]  0xffffffffa0098099
[  113.973652]  ? 0xffffffffa0098099
[  113.974270]  ? insn_get_opcode+0x49/0x3b0
[  113.974966]  ? insn_get_prefixes.part.1+0x5/0x650
[  113.975701]  ? write_comp_data+0x2f/0x90
[  113.976368]  insn_get_prefixes.part.1+0x5/0x650
[  113.977079]  insn_get_opcode+0x1d5/0x3b0
[  113.977711]  ? insn_get_prefixes.part.1+0x5/0x650
[  113.978431]  ? insn_get_opcode+0x1d5/0x3b0
[  113.979176]  insn_get_modrm+0x12b/0x2a0
[  113.979885]  insn_get_sib+0x122/0x140
[  113.980554]  insn_get_displacement+0x157/0x270
[  113.981326]  insn_get_immediate+0x181/0x570
[  113.982081]  insn_get_length+0x75/0x90
[  113.982749]  insn_decode+0x9b/0x170
[  113.983360]  ? ext4_mb_release_group_pa+0x430/0x430
[  113.984118]  text_poke_loc_init+0x63/0x140
[  113.985020]  ? ext4_mb_release_group_pa+0x430/0x430
[  113.985848]  text_poke_queue+0x84/0xc0
[  113.986541]  ftrace_replace_code+0xfd/0x170
[  113.987304]  ftrace_modify_all_code+0x1b1/0x270
[  113.988116]  arch_ftrace_update_code+0x9/0x10
[  113.988806]  ftrace_run_update_code+0x30/0xa0
[  113.989530]  ftrace_startup_enable+0x5e/0xa0
[  113.990248]  ftrace_startup+0x16d/0x240
[  113.990997]  register_ftrace_function+0x43/0x90
[  113.991750]  perf_ftrace_event_register+0xc1/0xf0
[  113.992528]  perf_trace_event_init+0xa0/0x4c0
[  113.993310]  perf_trace_init+0xda/0x160
[  113.994004]  perf_tp_event_init+0x57/0xa0
[  113.994689]  perf_try_init_event+0x83/0x270
[  113.995464]  perf_event_alloc+0xe3f/0x1c10
[  113.996102]  ? _raw_spin_unlock+0x2c/0x50
[  113.996764]  ? alloc_fd+0x20d/0x320
[  113.997514]  __do_sys_perf_event_open+0x3bf/0x1de0
[  113.998301]  ? write_comp_data+0x2f/0x90
[  113.999497]  __x64_sys_perf_event_open+0x26/0x30
[  114.000240]  do_syscall_64+0x37/0x80
[  114.000844]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  114.001609] RIP: 0033:0x7fac0740459d
[  114.002191] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  114.004733] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  114.005845] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  114.006867] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  114.007893] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  114.008914] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  114.009932] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  114.011329] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  114.011499] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  114.012300] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  114.013361] caller is debug_smp_processor_id+0x1c/0x20
[  114.014728] Call Trace:
[  114.014757]  dump_stack_lvl+0xa4/0xd3
[  114.014823]  dump_stack+0x15/0x17
[  114.014859]  check_preemption_disabled+0x167/0x180
[  114.014899]  ? force_qs_rnp+0xd0/0x2c0
[  114.017864]  ? preempt_schedule+0x30/0x30
[  114.018427]  debug_smp_processor_id+0x1c/0x20
[  114.019009]  perf_ftrace_function_call+0x7c/0x360
[  114.019632]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  114.020281]  ? ftrace_ops_test+0x71/0xc0
[  114.020819]  ? rcu_advance_cbs+0x70/0x70
[  114.021376]  ? write_comp_data+0x2f/0x90
[  114.021915]  ? perf_trace_buf_update+0x70/0x70
[  114.022512]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  114.023154]  ? ftrace_ops_list_func+0x1d2/0x2e0
[  114.023746]  ? force_qs_rnp+0xcb/0x2c0
[  114.024256]  ? sched_show_task+0x70/0x70
[  114.024813]  ? rcu_gp_torture_wait+0x20/0x20
[  114.025397]  0xffffffffa0098099
[  114.025830]  ? rcu_exp_wait_wake+0x4c0/0x4c0
[  114.026534]  ? __cond_resched+0x5/0x30
[  114.027062]  ? ___might_sleep+0x143/0x170
[  114.027602]  __cond_resched+0x5/0x30
[  114.028092]  force_qs_rnp+0xd0/0x2c0
[  114.028582]  ? __cond_resched+0x5/0x30
[  114.029081]  ? force_qs_rnp+0xd0/0x2c0
[  114.029656]  rcu_gp_fqs_loop+0x2eb/0x410
[  114.030254]  ? rcu_gp_init+0x730/0x730
[  114.030763]  rcu_gp_kthread+0xdd/0x170
[  114.031319]  kthread+0x1e7/0x230
[  114.031779]  ? set_kthread_struct+0x80/0x80
[  114.032377]  ret_from_fork+0x1f/0x30
[  114.033054] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  114.033201] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[  114.034105] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  114.034144] Call Trace:
[  114.034196]  dump_stack_lvl+0xa4/0xd3
[  114.035234] caller is debug_smp_processor_id+0x1c/0x20
[  114.036870]  dump_stack+0x15/0x17
[  114.038891]  check_preemption_disabled+0x167/0x180
[  114.039730]  debug_smp_processor_id+0x1c/0x20
[  114.040422]  perf_swevent_get_recursion_context+0x1e/0xd0
[  114.041340]  perf_trace_buf_alloc+0x3d/0x100
[  114.042022]  ? insn_get_opcode+0x1d5/0x3b0
[  114.042663]  ? insn_decode_from_regs+0x110/0x110
[  114.043414]  perf_ftrace_function_call+0x209/0x360
[  114.044185]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  114.045208]  ? 0xffffffffa0098099
[  114.045950]  0xffffffffa0098099
[  114.046592]  ? 0xffffffffa0098099
[  114.047209]  ? insn_get_opcode+0x49/0x3b0
[  114.047906]  ? insn_get_prefixes.part.1+0x5/0x650
[  114.048643]  ? write_comp_data+0x2f/0x90
[  114.049312]  insn_get_prefixes.part.1+0x5/0x650
[  114.050027]  insn_get_opcode+0x1d5/0x3b0
[  114.050669]  ? insn_get_prefixes.part.1+0x5/0x650
[  114.051384]  ? insn_get_opcode+0x1d5/0x3b0
[  114.052128]  insn_get_modrm+0x12b/0x2a0
[  114.052838]  insn_get_sib+0x122/0x140
[  114.053507]  insn_get_displacement+0x157/0x270
[  114.054288]  insn_get_immediate+0x181/0x570
[  114.055042]  insn_get_length+0x75/0x90
[  114.055706]  insn_decode+0x9b/0x170
[  114.056319]  ? ext4_mb_release_group_pa+0x430/0x430
[  114.057081]  text_poke_loc_init+0x63/0x140
[  114.057991]  ? ext4_mb_release_group_pa+0x430/0x430
[  114.058834]  text_poke_queue+0x84/0xc0
[  114.059517]  ftrace_replace_code+0xfd/0x170
[  114.060275]  ftrace_modify_all_code+0x1b1/0x270
[  114.061061]  arch_ftrace_update_code+0x9/0x10
[  114.061754]  ftrace_run_update_code+0x30/0xa0
[  114.062490]  ftrace_startup_enable+0x5e/0xa0
[  114.063206]  ftrace_startup+0x16d/0x240
[  114.063952]  register_ftrace_function+0x43/0x90
[  114.064703]  perf_ftrace_event_register+0xc1/0xf0
[  114.065477]  perf_trace_event_init+0xa0/0x4c0
[  114.066265]  perf_trace_init+0xda/0x160
[  114.066962]  perf_tp_event_init+0x57/0xa0
[  114.067647]  perf_try_init_event+0x83/0x270
[  114.068425]  perf_event_alloc+0xe3f/0x1c10
[  114.069068]  ? _raw_spin_unlock+0x2c/0x50
[  114.069740]  ? alloc_fd+0x20d/0x320
[  114.070500]  __do_sys_perf_event_open+0x3bf/0x1de0
[  114.071285]  ? write_comp_data+0x2f/0x90
[  114.072483]  __x64_sys_perf_event_open+0x26/0x30
[  114.073228]  do_syscall_64+0x37/0x80
[  114.073833]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  114.074616] RIP: 0033:0x7fac0740459d
[  114.075195] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  114.077745] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  114.078900] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  114.079928] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  114.080954] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  114.081977] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  114.083013] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  114.084409] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  114.085448] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  114.086871] Call Trace:
[  114.087227]  dump_stack_lvl+0xa4/0xd3
[  114.087765]  dump_stack+0x15/0x17
[  114.088232]  check_preemption_disabled+0x167/0x180
[  114.088877]  ? do_epoll_wait+0x3b3/0xd80
[  114.089411]  ? __mutex_lock+0x9f0/0x9f0
[  114.089958]  debug_smp_processor_id+0x1c/0x20
[  114.090560]  perf_ftrace_function_call+0x7c/0x360
[  114.091250]  ? ftrace_call+0x5/0x44
[  114.091728]  ? trace_hardirqs_on+0x6a/0x170
[  114.092336]  ? finish_task_switch+0xb0/0x2a0
[  114.092907]  ? finish_task_switch+0x70/0x2a0
[  114.093507]  ? trace_hardirqs_on+0x3f/0x170
[  114.094068]  ? finish_task_switch+0x70/0x2a0
[  114.094674]  ? preempt_count_sub+0x5/0xa0
[  114.095279]  0xffffffffa0098099
[  114.095729]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  114.096380]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[  114.097134]  ? do_epoll_wait+0x36b/0xd80
[  114.097702]  ? mutex_lock_nested+0x5/0x20
[  114.098256]  ? write_comp_data+0x2f/0x90
[  114.098815]  mutex_lock_nested+0x5/0x20
[  114.099346]  do_epoll_wait+0x3b3/0xd80
[  114.099867]  ? mutex_lock_nested+0x5/0x20
[  114.100408]  ? do_epoll_wait+0x3b3/0xd80
[  114.101106]  ? wait_woken+0x90/0x90
[  114.101666]  __x64_sys_epoll_wait+0x8d/0xd0
[  114.102306]  do_syscall_64+0x37/0x80
[  114.102813]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  114.103480] RIP: 0033:0x7f8a39143ae0
[  114.103976] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[  114.106260] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[  114.107234] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[  114.108142] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[  114.109045] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[  114.109945] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[  114.110876] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[  118.754106] check_preemption_disabled: 795120 callbacks suppressed
[  118.754148] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  118.754255] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[  118.755040] caller is debug_smp_processor_id+0x1c/0x20
[  118.755894] caller is debug_smp_processor_id+0x1c/0x20
[  118.756925] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  118.759105] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  118.760564] Call Trace:
[  118.760971]  dump_stack_lvl+0xa4/0xd3
[  118.761577]  dump_stack+0x15/0x17
[  118.762085]  check_preemption_disabled+0x167/0x180
[  118.762778]  ? __get_locked_pte+0x1a2/0x290
[  118.763401]  ? __lock_text_start+0x8/0x8
[  118.764069]  debug_smp_processor_id+0x1c/0x20
[  118.764758]  perf_ftrace_function_call+0x7c/0x360
[  118.765778]  ? ftrace_ops_list_func+0x259/0x2e0
[  118.766512]  ? write_comp_data+0x2f/0x90
[  118.767162]  ? perf_trace_buf_update+0x70/0x70
[  118.767989]  0xffffffffa0098099
[  118.768566]  ? acpi_table_aml_read+0xa0/0xa0
[  118.769297]  ? ftrace_call+0x5/0x44
[  118.769907]  ? pmd_page_vaddr+0x2b/0x70
[  118.770584]  ? _raw_spin_lock+0x5/0x50
[  118.771266]  _raw_spin_lock+0x5/0x50
[  118.771856]  __get_locked_pte+0x1a2/0x290
[  118.772501]  ? _raw_spin_lock+0x5/0x50
[  118.773093]  ? __get_locked_pte+0x1a2/0x290
[  118.773794]  ? acpi_table_aml_read+0xa0/0xa0
[  118.774510]  __text_poke+0xea/0x4e0
[  118.775087]  ? acpi_table_aml_read+0xa0/0xa0
[  118.775799]  ? lock_is_held_type+0xe2/0x140
[  118.776482]  ? acpi_table_aml_read+0xa0/0xa0
[  118.777231]  text_poke+0x2b/0x60
[  118.777826]  text_poke_bp_batch+0x93/0x2c0
[  118.778562]  ? pnp_add_dma_resource+0x40/0x40
[  118.779330]  text_poke_queue+0xa7/0xc0
[  118.780013]  ftrace_replace_code+0xfd/0x170
[  118.780769]  ftrace_modify_all_code+0x1b1/0x270
[  118.781553]  arch_ftrace_update_code+0x9/0x10
[  118.782246]  ftrace_run_update_code+0x30/0xa0
[  118.782972]  ftrace_startup_enable+0x5e/0xa0
[  118.783684]  ftrace_startup+0x16d/0x240
[  118.784428]  register_ftrace_function+0x43/0x90
[  118.785176]  perf_ftrace_event_register+0xc1/0xf0
[  118.785946]  perf_trace_event_init+0xa0/0x4c0
[  118.786732]  perf_trace_init+0xda/0x160
[  118.787424]  perf_tp_event_init+0x57/0xa0
[  118.788104]  perf_try_init_event+0x83/0x270
[  118.788877]  perf_event_alloc+0xe3f/0x1c10
[  118.789516]  ? _raw_spin_unlock+0x2c/0x50
[  118.790184]  ? alloc_fd+0x20d/0x320
[  118.790935]  __do_sys_perf_event_open+0x3bf/0x1de0
[  118.791716]  ? write_comp_data+0x2f/0x90
[  118.792911]  __x64_sys_perf_event_open+0x26/0x30
[  118.793673]  do_syscall_64+0x37/0x80
[  118.794304]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  118.795069] RIP: 0033:0x7fac0740459d
[  118.795650] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  118.798207] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  118.799328] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  118.800347] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  118.801367] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  118.802396] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  118.803417] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  118.804812] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  118.804995] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  118.805779] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  118.806994] caller is debug_smp_processor_id+0x1c/0x20
[  118.808215] Call Trace:
[  118.809279]  dump_stack_lvl+0xa4/0xd3
[  118.809807]  dump_stack+0x15/0x17
[  118.810271]  check_preemption_disabled+0x167/0x180
[  118.810905]  ? lock_timer_base+0x34/0x100
[  118.811438]  ? _raw_read_lock_irqsave+0x90/0x90
[  118.812066]  debug_smp_processor_id+0x1c/0x20
[  118.812647]  perf_ftrace_function_call+0x7c/0x360
[  118.813287]  ? ftrace_ops_test+0x71/0xc0
[  118.813851]  ? ftrace_ops_test+0x71/0xc0
[  118.814398]  ? perf_trace_buf_update+0x70/0x70
[  118.815005]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  118.815689]  ? ftrace_ops_list_func+0x1d2/0x2e0
[  118.816330]  ? write_comp_data+0x2f/0x90
[  118.816904]  ? perf_trace_buf_update+0x70/0x70
[  118.817606]  0xffffffffa0098099
[  118.818150]  ? ftrace_call+0x5/0x44
[  118.818680]  ? lock_timer_base+0xc0/0x100
[  118.819285]  ? _raw_spin_lock_irqsave+0x5/0x70
[  118.819910]  ? write_comp_data+0x2f/0x90
[  118.820465]  _raw_spin_lock_irqsave+0x5/0x70
[  118.821044]  lock_timer_base+0x34/0x100
[  118.821580]  ? _raw_spin_lock_irqsave+0x5/0x70
[  118.822199]  ? lock_timer_base+0x34/0x100
[  118.822817]  try_to_del_timer_sync+0x33/0x90
[  118.823386]  ? try_to_del_timer_sync+0x5/0x90
[  118.823997]  del_timer_sync+0xd3/0x130
[  118.824538]  schedule_timeout+0x34e/0x610
[  118.825143]  ? del_timer_sync+0x130/0x130
[  118.825721]  ? i915_init_ggtt+0x40/0x6b0
[  118.826322]  rcu_gp_fqs_loop+0x2a0/0x410
[  118.826917]  ? rcu_gp_init+0x730/0x730
[  118.827426]  rcu_gp_kthread+0xdd/0x170
[  118.827981]  kthread+0x1e7/0x230
[  118.828443]  ? set_kthread_struct+0x80/0x80
[  118.829039]  ret_from_fork+0x1f/0x30
[  118.829718] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  118.829919] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[  118.830785] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  118.830822] Call Trace:
[  118.830874]  dump_stack_lvl+0xa4/0xd3
[  118.831819] caller is debug_smp_processor_id+0x1c/0x20
[  118.833458]  dump_stack+0x15/0x17
[  118.835469]  check_preemption_disabled+0x167/0x180
[  118.836305]  debug_smp_processor_id+0x1c/0x20
[  118.836997]  perf_swevent_get_recursion_context+0x1e/0xd0
[  118.837915]  perf_trace_buf_alloc+0x3d/0x100
[  118.838603]  ? __get_locked_pte+0x1a2/0x290
[  118.839253]  ? __lock_text_start+0x8/0x8
[  118.839906]  perf_ftrace_function_call+0x209/0x360
[  118.840995]  ? 0xffffffffa0098099
[  118.841739]  0xffffffffa0098099
[  118.842320]  ? acpi_table_aml_read+0xa0/0xa0
[  118.843035]  ? ftrace_call+0x5/0x44
[  118.843650]  ? pmd_page_vaddr+0x2b/0x70
[  118.844325]  ? _raw_spin_lock+0x5/0x50
[  118.845008]  _raw_spin_lock+0x5/0x50
[  118.845599]  __get_locked_pte+0x1a2/0x290
[  118.846249]  ? _raw_spin_lock+0x5/0x50
[  118.846844]  ? __get_locked_pte+0x1a2/0x290
[  118.847546]  ? acpi_table_aml_read+0xa0/0xa0
[  118.848261]  __text_poke+0xea/0x4e0
[  118.848842]  ? acpi_table_aml_read+0xa0/0xa0
[  118.849557]  ? lock_is_held_type+0xe2/0x140
[  118.850247]  ? acpi_table_aml_read+0xa0/0xa0
[  118.850997]  text_poke+0x2b/0x60
[  118.851594]  text_poke_bp_batch+0x93/0x2c0
[  118.852323]  ? pnp_add_dma_resource+0x40/0x40
[  118.853087]  text_poke_queue+0xa7/0xc0
[  118.853771]  ftrace_replace_code+0xfd/0x170
[  118.854534]  ftrace_modify_all_code+0x1b1/0x270
[  118.855321]  arch_ftrace_update_code+0x9/0x10
[  118.856015]  ftrace_run_update_code+0x30/0xa0
[  118.856745]  ftrace_startup_enable+0x5e/0xa0
[  118.857462]  ftrace_startup+0x16d/0x240
[  118.858214]  register_ftrace_function+0x43/0x90
[  118.858964]  perf_ftrace_event_register+0xc1/0xf0
[  118.859740]  perf_trace_event_init+0xa0/0x4c0
[  118.860523]  perf_trace_init+0xda/0x160
[  118.861220]  perf_tp_event_init+0x57/0xa0
[  118.861903]  perf_try_init_event+0x83/0x270
[  118.862684]  perf_event_alloc+0xe3f/0x1c10
[  118.863326]  ? _raw_spin_unlock+0x2c/0x50
[  118.863990]  ? alloc_fd+0x20d/0x320
[  118.864740]  __do_sys_perf_event_open+0x3bf/0x1de0
[  118.865525]  ? write_comp_data+0x2f/0x90
[  118.866727]  __x64_sys_perf_event_open+0x26/0x30
[  118.867468]  do_syscall_64+0x37/0x80
[  118.868074]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  118.868842] RIP: 0033:0x7fac0740459d
[  118.869422] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  118.871970] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  118.873090] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  118.874120] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  118.875146] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  118.876170] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  118.877192] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  118.878589] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  118.878759] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  118.879554] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  118.880530] caller is debug_smp_processor_id+0x1c/0x20
[  118.881894] Call Trace:
[  118.882905]  dump_stack_lvl+0xa4/0xd3
[  118.883435]  dump_stack+0x15/0x17
[  118.883894]  check_preemption_disabled+0x167/0x180
[  118.884527]  ? prepare_to_swait_event+0x1b/0xf0
[  118.885120]  ? _raw_read_lock_irqsave+0x90/0x90
[  118.885741]  debug_smp_processor_id+0x1c/0x20
[  118.886329]  perf_ftrace_function_call+0x7c/0x360
[  118.886942]  ? ftrace_ops_test+0x71/0xc0
[  118.887554]  ? trace_hardirqs_on+0x3f/0x170
[  118.888152]  ? write_comp_data+0x2f/0x90
[  118.888689]  ? perf_trace_buf_update+0x70/0x70
[  118.889281]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  118.889976]  0xffffffffa0098099
[  118.890458]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  118.891115]  ? del_timer_sync+0xde/0x130
[  118.891673]  ? _raw_spin_lock_irqsave+0x5/0x70
[  118.892301]  _raw_spin_lock_irqsave+0x5/0x70
[  118.892875]  prepare_to_swait_event+0x1b/0xf0
[  118.893457]  ? _raw_spin_lock_irqsave+0x5/0x70
[  118.894042]  ? prepare_to_swait_event+0x1b/0xf0
[  118.894678]  rcu_gp_fqs_loop+0x2b4/0x410
[  118.895273]  ? rcu_gp_init+0x730/0x730
[  118.895782]  rcu_gp_kthread+0xdd/0x170
[  118.896340]  kthread+0x1e7/0x230
[  118.896801]  ? set_kthread_struct+0x80/0x80
[  118.897400]  ret_from_fork+0x1f/0x30
[  118.898105] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  118.898244] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[  118.899071] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  118.900048] caller is debug_smp_processor_id+0x1c/0x20
[  118.901488] Call Trace:
[  118.902491]  dump_stack_lvl+0xa4/0xd3
[  118.903063]  dump_stack+0x15/0x17
[  118.903557]  check_preemption_disabled+0x167/0x180
[  118.904293]  debug_smp_processor_id+0x1c/0x20
[  118.904917]  perf_trace_buf_alloc+0x98/0x100
[  118.905531]  ? __get_locked_pte+0x1a2/0x290
[  118.906124]  ? __lock_text_start+0x8/0x8
[  118.906706]  perf_ftrace_function_call+0x209/0x360
[  118.907611]  ? 0xffffffffa0098099
[  118.908231]  0xffffffffa0098099
[  118.908732]  ? acpi_table_aml_read+0xa0/0xa0
[  118.909366]  ? ftrace_call+0x5/0x44
[  118.909905]  ? pmd_page_vaddr+0x2b/0x70
[  118.910500]  ? _raw_spin_lock+0x5/0x50
[  118.911095]  _raw_spin_lock+0x5/0x50
[  118.911621]  __get_locked_pte+0x1a2/0x290
[  118.912199]  ? _raw_spin_lock+0x5/0x50
[  118.912735]  ? __get_locked_pte+0x1a2/0x290
[  118.913358]  ? acpi_table_aml_read+0xa0/0xa0
[  118.913991]  __text_poke+0xea/0x4e0
[  118.914510]  ? acpi_table_aml_read+0xa0/0xa0
[  118.915144]  ? lock_is_held_type+0xe2/0x140
[  118.915757]  ? acpi_table_aml_read+0xa0/0xa0
[  118.916415]  text_poke+0x2b/0x60
[  118.916933]  text_poke_bp_batch+0x93/0x2c0
[  118.917571]  ? pnp_add_dma_resource+0x40/0x40
[  118.918244]  text_poke_queue+0xa7/0xc0
[  118.918841]  ftrace_replace_code+0xfd/0x170
[  118.919500]  ftrace_modify_all_code+0x1b1/0x270
[  118.920192]  arch_ftrace_update_code+0x9/0x10
[  118.920813]  ftrace_run_update_code+0x30/0xa0
[  118.921459]  ftrace_startup_enable+0x5e/0xa0
[  118.922093]  ftrace_startup+0x16d/0x240
[  118.922743]  register_ftrace_function+0x43/0x90
[  118.923410]  perf_ftrace_event_register+0xc1/0xf0
[  118.924101]  perf_trace_event_init+0xa0/0x4c0
[  118.924784]  perf_trace_init+0xda/0x160
[  118.925479]  perf_tp_event_init+0x57/0xa0
[  118.926088]  perf_try_init_event+0x83/0x270
[  118.926771]  perf_event_alloc+0xe3f/0x1c10
[  118.927349]  ? _raw_spin_unlock+0x2c/0x50
[  118.927943]  ? alloc_fd+0x20d/0x320
[  118.928573]  __do_sys_perf_event_open+0x3bf/0x1de0
[  118.929272]  ? write_comp_data+0x2f/0x90
[  118.930226]  __x64_sys_perf_event_open+0x26/0x30
[  118.930893]  do_syscall_64+0x37/0x80
[  118.931431]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  118.932128] RIP: 0033:0x7fac0740459d
[  118.932649] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  118.935015] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  118.936029] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  118.936964] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  118.937901] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  118.938838] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  118.939774] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  118.940964] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  118.941137] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  118.941928] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  118.943053] caller is debug_smp_processor_id+0x1c/0x20
[  118.944276] Call Trace:
[  118.945280]  dump_stack_lvl+0xa4/0xd3
[  118.945809]  dump_stack+0x15/0x17
[  118.946272]  check_preemption_disabled+0x167/0x180
[  118.946906]  ? finish_swait+0x41/0x80
[  118.947397]  ? _raw_read_lock_irqsave+0x90/0x90
[  118.948019]  debug_smp_processor_id+0x1c/0x20
[  118.948602]  perf_ftrace_function_call+0x7c/0x360
[  118.949216]  ? ftrace_ops_test+0x71/0xc0
[  118.949753]  ? rcu_advance_cbs+0x70/0x70
[  118.950312]  ? write_comp_data+0x2f/0x90
[  118.950852]  ? perf_trace_buf_update+0x70/0x70
[  118.951445]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  118.952085]  ? write_comp_data+0x2f/0x90
[  118.952623]  ? perf_trace_buf_update+0x70/0x70
[  118.953216]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  118.953914]  0xffffffffa0098099
[  118.954414]  ? trace_hardirqs_on+0x3f/0x170
[  118.955041]  ? _raw_spin_lock_irqsave+0x5/0x70
[  118.955671]  _raw_spin_lock_irqsave+0x5/0x70
[  118.956244]  finish_swait+0x41/0x80
[  118.956726]  ? _raw_spin_lock_irqsave+0x5/0x70
[  118.957309]  ? finish_swait+0x41/0x80
[  118.957837]  rcu_gp_fqs_loop+0x2da/0x410
[  118.958436]  ? rcu_gp_init+0x730/0x730
[  118.958945]  rcu_gp_kthread+0xdd/0x170
[  118.959502]  kthread+0x1e7/0x230
[  118.959962]  ? set_kthread_struct+0x80/0x80
[  118.960574]  ret_from_fork+0x1f/0x30
[  118.961254] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  118.961359] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[  118.962223] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  118.962250] Call Trace:
[  118.962286]  dump_stack_lvl+0xa4/0xd3
[  118.963263] caller is debug_smp_processor_id+0x1c/0x20
[  118.964758]  dump_stack+0x15/0x17
[  118.966644]  check_preemption_disabled+0x167/0x180
[  118.967380]  debug_smp_processor_id+0x1c/0x20
[  118.968003]  perf_swevent_put_recursion_context+0x1b/0x40
[  118.968775]  perf_tp_event+0x331/0x4e0
[  118.969657]  ? arch_local_irq_enable+0x10/0x12
[  118.970304]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  118.970987]  ? dump_stack_lvl+0xcc/0xd3
[  118.971577]  ? dump_stack+0x15/0x17
[  118.972089]  ? check_preemption_disabled+0x167/0x180
[  118.972845]  ? __get_locked_pte+0x1a2/0x290
[  118.973431]  ? __lock_text_start+0x8/0x8
[  118.974022]  perf_ftrace_function_call+0x248/0x360
[  118.974689]  ? perf_ftrace_function_call+0x248/0x360
[  118.975639]  ? 0xffffffffa0098099
[  118.976259]  0xffffffffa0098099
[  118.976760]  ? acpi_table_aml_read+0xa0/0xa0
[  118.977395]  ? ftrace_call+0x5/0x44
[  118.977931]  ? pmd_page_vaddr+0x2b/0x70
[  118.978525]  ? _raw_spin_lock+0x5/0x50
[  118.979120]  _raw_spin_lock+0x5/0x50
[  118.979647]  __get_locked_pte+0x1a2/0x290
[  118.980225]  ? _raw_spin_lock+0x5/0x50
[  118.980758]  ? __get_locked_pte+0x1a2/0x290
[  118.981380]  ? acpi_table_aml_read+0xa0/0xa0
[  118.982014]  __text_poke+0xea/0x4e0
[  118.982533]  ? acpi_table_aml_read+0xa0/0xa0
[  118.983166]  ? lock_is_held_type+0xe2/0x140
[  118.983779]  ? acpi_table_aml_read+0xa0/0xa0
[  118.984436]  text_poke+0x2b/0x60
[  118.984955]  text_poke_bp_batch+0x93/0x2c0
[  118.985592]  ? pnp_add_dma_resource+0x40/0x40
[  118.986276]  text_poke_queue+0xa7/0xc0
[  118.986872]  ftrace_replace_code+0xfd/0x170
[  118.987531]  ftrace_modify_all_code+0x1b1/0x270
[  118.988221]  arch_ftrace_update_code+0x9/0x10
[  118.988841]  ftrace_run_update_code+0x30/0xa0
[  118.989488]  ftrace_startup_enable+0x5e/0xa0
[  118.990127]  ftrace_startup+0x16d/0x240
[  118.990770]  register_ftrace_function+0x43/0x90
[  118.991436]  perf_ftrace_event_register+0xc1/0xf0
[  118.992125]  perf_trace_event_init+0xa0/0x4c0
[  118.992806]  perf_trace_init+0xda/0x160
[  118.993410]  perf_tp_event_init+0x57/0xa0
[  118.994013]  perf_try_init_event+0x83/0x270
[  118.994697]  perf_event_alloc+0xe3f/0x1c10
[  118.995276]  ? _raw_spin_unlock+0x2c/0x50
[  118.995865]  ? alloc_fd+0x20d/0x320
[  118.996497]  __do_sys_perf_event_open+0x3bf/0x1de0
[  118.997195]  ? write_comp_data+0x2f/0x90
[  118.998148]  __x64_sys_perf_event_open+0x26/0x30
[  118.998812]  do_syscall_64+0x37/0x80
[  118.999349]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  119.000044] RIP: 0033:0x7fac0740459d
[  119.000564] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  119.002924] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  119.003940] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  119.004878] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  119.005816] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  119.006759] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  119.007697] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  119.008887] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  119.009080] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  119.009852] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  119.011061] caller is debug_smp_processor_id+0x1c/0x20
[  119.012277] Call Trace:
[  119.013337]  dump_stack_lvl+0xa4/0xd3
[  119.013864]  dump_stack+0x15/0x17
[  119.014328]  check_preemption_disabled+0x167/0x180
[  119.014962]  ? force_qs_rnp+0xd0/0x2c0
[  119.015461]  ? preempt_schedule+0x30/0x30
[  119.016020]  debug_smp_processor_id+0x1c/0x20
[  119.016603]  perf_ftrace_function_call+0x7c/0x360
[  119.017218]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  119.017859]  ? ftrace_ops_test+0x71/0xc0
[  119.018411]  ? rcu_advance_cbs+0x70/0x70
[  119.018969]  ? write_comp_data+0x2f/0x90
[  119.019508]  ? perf_trace_buf_update+0x70/0x70
[  119.020101]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  119.020743]  ? ftrace_ops_list_func+0x1d2/0x2e0
[  119.021337]  ? force_qs_rnp+0xcb/0x2c0
[  119.021846]  ? sched_show_task+0x70/0x70
[  119.022415]  ? rcu_gp_torture_wait+0x20/0x20
[  119.022999]  0xffffffffa0098099
[  119.023433]  ? rcu_exp_wait_wake+0x4c0/0x4c0
[  119.024131]  ? __cond_resched+0x5/0x30
[  119.024659]  ? ___might_sleep+0x143/0x170
[  119.025197]  __cond_resched+0x5/0x30
[  119.025687]  force_qs_rnp+0xd0/0x2c0
[  119.026179]  ? __cond_resched+0x5/0x30
[  119.026680]  ? force_qs_rnp+0xd0/0x2c0
[  119.027253]  rcu_gp_fqs_loop+0x2eb/0x410
[  119.027848]  ? rcu_gp_init+0x730/0x730
[  119.028357]  rcu_gp_kthread+0xdd/0x170
[  119.028913]  kthread+0x1e7/0x230
[  119.029374]  ? set_kthread_struct+0x80/0x80
[  119.029974]  ret_from_fork+0x1f/0x30
[  119.030654] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  119.030792] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[  119.031700] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  119.032758] caller is debug_smp_processor_id+0x1c/0x20
[  119.034318] Call Trace:
[  119.034371]  dump_stack_lvl+0xa4/0xd3
[  119.036026]  dump_stack+0x15/0x17
[  119.036578]  check_preemption_disabled+0x167/0x180
[  119.037325]  ? __get_locked_pte+0x1a2/0x290
[  119.037970]  ? __lock_text_start+0x8/0x8
[  119.038641]  debug_smp_processor_id+0x1c/0x20
[  119.039332]  perf_ftrace_function_call+0x7c/0x360
[  119.040350]  ? ftrace_ops_list_func+0x259/0x2e0
[  119.041078]  ? write_comp_data+0x2f/0x90
[  119.041724]  ? perf_trace_buf_update+0x70/0x70
[  119.042553]  0xffffffffa0098099
[  119.043127]  ? acpi_table_asl_compiler_revision_show+0x90/0x90
[  119.044043]  ? ftrace_call+0x5/0x44
[  119.044651]  ? pmd_page_vaddr+0x2b/0x70
[  119.045321]  ? _raw_spin_lock+0x5/0x50
[  119.045999]  _raw_spin_lock+0x5/0x50
[  119.046601]  __get_locked_pte+0x1a2/0x290
[  119.047244]  ? _raw_spin_lock+0x5/0x50
[  119.047837]  ? __get_locked_pte+0x1a2/0x290
[  119.048565]  ? acpi_table_asl_compiler_revision_show+0x90/0x90
[  119.049495]  __text_poke+0xea/0x4e0
[  119.050069]  ? acpi_table_asl_compiler_revision_show+0x90/0x90
[  119.050996]  ? lock_is_held_type+0xe2/0x140
[  119.051678]  ? acpi_table_asl_compiler_revision_show+0x90/0x90
[  119.052630]  text_poke+0x2b/0x60
[  119.053223]  text_poke_bp_batch+0x93/0x2c0
[  119.053948]  ? pnp_add_dma_resource+0x40/0x40
[  119.054717]  text_poke_queue+0xa7/0xc0
[  119.055398]  ftrace_replace_code+0xfd/0x170
[  119.056151]  ftrace_modify_all_code+0x1b1/0x270
[  119.056930]  arch_ftrace_update_code+0x9/0x10
[  119.057618]  ftrace_run_update_code+0x30/0xa0
[  119.058349]  ftrace_startup_enable+0x5e/0xa0
[  119.059059]  ftrace_startup+0x16d/0x240
[  119.059803]  register_ftrace_function+0x43/0x90
[  119.060550]  perf_ftrace_event_register+0xc1/0xf0
[  119.061322]  perf_trace_event_init+0xa0/0x4c0
[  119.062100]  perf_trace_init+0xda/0x160
[  119.062796]  perf_tp_event_init+0x57/0xa0
[  119.063474]  perf_try_init_event+0x83/0x270
[  119.064246]  perf_event_alloc+0xe3f/0x1c10
[  119.064882]  ? _raw_spin_unlock+0x2c/0x50
[  119.065544]  ? alloc_fd+0x20d/0x320
[  119.066296]  __do_sys_perf_event_open+0x3bf/0x1de0
[  119.067078]  ? write_comp_data+0x2f/0x90
[  119.068272]  __x64_sys_perf_event_open+0x26/0x30
[  119.069013]  do_syscall_64+0x37/0x80
[  119.069616]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  119.070386] RIP: 0033:0x7fac0740459d
[  119.070967] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  119.073522] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  119.074642] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  119.075667] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  119.076691] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  119.077712] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  119.078739] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  119.080135] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  119.081174] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  119.082593] Call Trace:
[  119.082948]  dump_stack_lvl+0xa4/0xd3
[  119.083487]  dump_stack+0x15/0x17
[  119.083952]  check_preemption_disabled+0x167/0x180
[  119.084598]  ? do_epoll_wait+0x3b3/0xd80
[  119.085132]  ? __mutex_lock+0x9f0/0x9f0
[  119.085679]  debug_smp_processor_id+0x1c/0x20
[  119.086280]  perf_ftrace_function_call+0x7c/0x360
[  119.086971]  ? ftrace_call+0x5/0x44
[  119.087448]  ? trace_hardirqs_on+0x6a/0x170
[  119.088056]  ? finish_task_switch+0xb0/0x2a0
[  119.088627]  ? finish_task_switch+0x70/0x2a0
[  119.089225]  ? trace_hardirqs_on+0x3f/0x170
[  119.089786]  ? finish_task_switch+0x70/0x2a0
[  119.090389]  ? preempt_count_sub+0x5/0xa0
[  119.090994]  0xffffffffa0098099
[  119.091445]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  119.092097]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[  119.092850]  ? do_epoll_wait+0x36b/0xd80
[  119.093417]  ? mutex_lock_nested+0x5/0x20
[  119.093966]  ? write_comp_data+0x2f/0x90
[  119.094536]  mutex_lock_nested+0x5/0x20
[  119.095065]  do_epoll_wait+0x3b3/0xd80
[  119.095585]  ? mutex_lock_nested+0x5/0x20
[  119.096126]  ? do_epoll_wait+0x3b3/0xd80
[  119.096824]  ? wait_woken+0x90/0x90
[  119.097386]  __x64_sys_epoll_wait+0x8d/0xd0
[  119.098023]  do_syscall_64+0x37/0x80
[  119.098534]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  119.099202] RIP: 0033:0x7f8a39143ae0
[  119.099697] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[  119.101977] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[  119.102955] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[  119.103856] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[  119.104755] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[  119.105654] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[  119.106557] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[  123.758099] check_preemption_disabled: 567347 callbacks suppressed
[  123.758131] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  123.760005] caller is debug_smp_processor_id+0x1c/0x20
[  123.760715] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  123.761675] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  123.763145] Call Trace:
[  123.763527]  dump_stack_lvl+0xa4/0xd3
[  123.764105]  dump_stack+0x15/0x17
[  123.764601]  check_preemption_disabled+0x167/0x180
[  123.765346]  debug_smp_processor_id+0x1c/0x20
[  123.765970]  perf_swevent_get_recursion_context+0x1e/0xd0
[  123.766795]  perf_trace_buf_alloc+0x3d/0x100
[  123.767457]  ? text_poke+0x2b/0x60
[  123.767989]  ? do_sync_core+0x30/0x30
[  123.768573]  perf_ftrace_function_call+0x209/0x360
[  123.769305]  ? text_poke_bp_batch+0x93/0x2c0
[  123.770175]  ? 0xffffffffa0098099
[  123.770763]  ? prepare_signal+0x630/0x630
[  123.771435]  0xffffffffa0098099
[  123.772012]  ? _raw_spin_unlock+0x2c/0x50
[  123.772709]  ? prepare_signal+0x630/0x630
[  123.773325]  ? __text_poke+0x5/0x4e0
[  123.773882]  ? lock_is_held_type+0xe2/0x140
[  123.774557]  __text_poke+0x5/0x4e0
[  123.775096]  text_poke+0x2b/0x60
[  123.775609]  ? __text_poke+0x5/0x4e0
[  123.776154]  ? text_poke+0x2b/0x60
[  123.776729]  text_poke_bp_batch+0x93/0x2c0
[  123.777409]  ? __x64_sys_rt_sigsuspend+0xc0/0xc0
[  123.778168]  text_poke_queue+0xa7/0xc0
[  123.778808]  ftrace_replace_code+0xfd/0x170
[  123.779513]  ftrace_modify_all_code+0x1b1/0x270
[  123.780249]  arch_ftrace_update_code+0x9/0x10
[  123.780907]  ftrace_run_update_code+0x30/0xa0
[  123.781591]  ftrace_shutdown+0x2b8/0x4a0
[  123.782286]  unregister_ftrace_function+0x25/0x50
[  123.783002]  perf_ftrace_event_register+0x89/0xf0
[  123.783708]  ? perf_tp_event_init+0xa0/0xa0
[  123.784345]  perf_trace_destroy+0x37/0x60
[  123.784976]  tp_perf_event_destroy+0x15/0x20
[  123.785639]  _free_event+0xfc/0x7d0
[  123.786260]  put_event+0x37/0x50
[  123.786801]  perf_event_release_kernel+0x2f4/0x370
[  123.787598]  ? perf_event_release_kernel+0x370/0x370
[  123.788363]  perf_release+0x19/0x20
[  123.788924]  __fput+0x12d/0x460
[  123.789547]  ____fput+0x1a/0x20
[  123.790064]  task_work_run+0x8e/0xf0
[  123.790701]  do_exit+0x616/0x1310
[  123.791295]  ? write_comp_data+0x2f/0x90
[  123.791991]  do_group_exit+0x7e/0x130
[  123.792630]  get_signal+0x249/0x13c0
[  123.793249]  ? get_signal+0x5/0x13c0
[  123.793927]  arch_do_signal_or_restart+0xb7/0x7e0
[  123.794891]  ? arch_do_signal_or_restart+0x5/0x7e0
[  123.795741]  exit_to_user_mode_prepare+0x154/0x240
[  123.796489]  syscall_exit_to_user_mode+0x2b/0x60
[  123.797202]  do_syscall_64+0x46/0x80
[  123.797777]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  123.798531] RIP: 0033:0x7fac0740459d
[  123.799086] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  123.800006] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  123.801098] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  123.802096] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  123.803103] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  123.804107] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  123.805108] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  123.806644] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  123.806721] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[  123.807680] caller is debug_smp_processor_id+0x1c/0x20
[  123.808855] caller is debug_smp_processor_id+0x1c/0x20
[  123.809551] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  123.811211] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  123.812733] Call Trace:
[  123.813110]  dump_stack_lvl+0xa4/0xd3
[  123.813680]  dump_stack+0x15/0x17
[  123.814181]  check_preemption_disabled+0x167/0x180
[  123.814913]  debug_smp_processor_id+0x1c/0x20
[  123.815546]  perf_trace_buf_alloc+0x98/0x100
[  123.816169]  ? text_poke+0x2b/0x60
[  123.816668]  ? do_sync_core+0x30/0x30
[  123.817217]  perf_ftrace_function_call+0x209/0x360
[  123.818067]  ? 0xffffffffa0098099
[  123.818605]  ? prepare_signal+0x630/0x630
[  123.819229]  0xffffffffa0098099
[  123.819750]  ? _raw_spin_unlock+0x2c/0x50
[  123.820390]  ? prepare_signal+0x630/0x630
[  123.820980]  ? __text_poke+0x5/0x4e0
[  123.821511]  ? lock_is_held_type+0xe2/0x140
[  123.822142]  __text_poke+0x5/0x4e0
[  123.822650]  text_poke+0x2b/0x60
[  123.823136]  ? __text_poke+0x5/0x4e0
[  123.823658]  ? text_poke+0x2b/0x60
[  123.824190]  text_poke_bp_batch+0x93/0x2c0
[  123.824821]  ? __x64_sys_rt_sigsuspend+0xc0/0xc0
[  123.825521]  text_poke_queue+0xa7/0xc0
[  123.826110]  ftrace_replace_code+0xfd/0x170
[  123.826770]  ftrace_modify_all_code+0x1b1/0x270
[  123.827459]  arch_ftrace_update_code+0x9/0x10
[  123.828092]  ftrace_run_update_code+0x30/0xa0
[  123.828742]  ftrace_shutdown+0x2b8/0x4a0
[  123.829370]  unregister_ftrace_function+0x25/0x50
[  123.830056]  perf_ftrace_event_register+0x89/0xf0
[  123.830736]  ? perf_tp_event_init+0xa0/0xa0
[  123.831345]  perf_trace_destroy+0x37/0x60
[  123.831941]  tp_perf_event_destroy+0x15/0x20
[  123.832571]  _free_event+0xfc/0x7d0
[  123.833133]  put_event+0x37/0x50
[  123.833638]  perf_event_release_kernel+0x2f4/0x370
[  123.834380]  ? perf_event_release_kernel+0x370/0x370
[  123.835107]  perf_release+0x19/0x20
[  123.835635]  __fput+0x12d/0x460
[  123.836187]  ____fput+0x1a/0x20
[  123.836677]  task_work_run+0x8e/0xf0
[  123.837251]  do_exit+0x616/0x1310
[  123.837791]  ? write_comp_data+0x2f/0x90
[  123.838432]  do_group_exit+0x7e/0x130
[  123.839018]  get_signal+0x249/0x13c0
[  123.839580]  ? get_signal+0x5/0x13c0
[  123.840185]  arch_do_signal_or_restart+0xb7/0x7e0
[  123.840953]  ? arch_do_signal_or_restart+0x5/0x7e0
[  123.841714]  exit_to_user_mode_prepare+0x154/0x240
[  123.842419]  syscall_exit_to_user_mode+0x2b/0x60
[  123.843093]  do_syscall_64+0x46/0x80
[  123.843631]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  123.844346] RIP: 0033:0x7fac0740459d
[  123.844871] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  123.845756] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  123.846802] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  123.847768] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  123.848734] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  123.849700] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  123.850674] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  123.851822] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  123.852004] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  123.852890] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  123.853914] caller is debug_smp_processor_id+0x1c/0x20
[  123.855374] Call Trace:
[  123.855393]  dump_stack_lvl+0xa4/0xd3
[  123.855440]  dump_stack+0x15/0x17
[  123.855466]  check_preemption_disabled+0x167/0x180
[  123.855496]  ? __check_object_size+0xc7/0x310
[  123.858650]  ? pmd_free_pte_page+0xb0/0xb0
[  123.859232]  debug_smp_processor_id+0x1c/0x20
[  123.859837]  perf_ftrace_function_call+0x7c/0x360
[  123.860485]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  123.861143]  ? ftrace_ops_test+0x71/0xc0
[  123.861719]  ? write_comp_data+0x2f/0x90
[  123.862276]  ? perf_trace_buf_update+0x70/0x70
[  123.862890]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  123.863547]  ? ftrace_ops_list_func+0x1d2/0x2e0
[  123.864166]  ? __check_object_size+0x9f/0x310
[  123.864768]  ? page_idle_bitmap_write+0x270/0x270
[  123.865450]  0xffffffffa0098099
[  123.865901]  ? usercopy_warn+0x120/0x120
[  123.866498]  ? __check_object_size+0xb1/0x310
[  123.867120]  ? __virt_addr_valid+0x5/0x1b0
[  123.867701]  ? __sanitizer_cov_trace_switch+0x53/0x90
[  123.868392]  __virt_addr_valid+0x5/0x1b0
[  123.868940]  __check_object_size+0xc7/0x310
[  123.869523]  ? __virt_addr_valid+0x5/0x1b0
[  123.870088]  ? __check_object_size+0xc7/0x310
[  123.870691]  ? write_comp_data+0x2f/0x90
[  123.871280]  devkmsg_read+0x2bf/0x350
[  123.871809]  ? devkmsg_read+0x5/0x350
[  123.872326]  ? write_comp_data+0x2f/0x90
[  123.872890]  ? info_print_ext_header.constprop.38+0xe0/0xe0
[  123.873659]  vfs_read+0x14a/0x330
[  123.874179]  ksys_read+0x9e/0x170
[  123.874692]  __x64_sys_read+0x23/0x30
[  123.875213]  do_syscall_64+0x37/0x80
[  123.875724]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  123.876411] RIP: 0033:0x7f8a39227d72
[  123.876913] Code: a2 00 00 f7 d8 64 89 02 48 c7 c0 ff ff ff ff eb b6 0f 1f 80 00 00 00 00 f3 0f 1e fa 8b 05 f6 e3 00 00 85 c0 75 12 31 c0 0f 05 <48> 3d 00 f0 ff ff 77 56 c3 0f 1f 44 00 00 41 54 49 89 d4 55 48 89
[  123.879309] RSP: 002b:00007fff1b559468 EFLAGS: 00000246 ORIG_RAX: 0000000000000000
[  123.880314] RAX: ffffffffffffffda RBX: 00007fff1b55b580 RCX: 00007f8a39227d72
[  123.881285] RDX: 0000000000002000 RSI: 00007fff1b559470 RDI: 0000000000000007
[  123.882233] RBP: 0000000000000000 R08: 000000000760ad84 R09: 0000000000000000
[  123.883167] R10: 00007fff1b57c0f0 R11: 0000000000000246 R12: 00007fff1b559470
[  123.884102] R13: 00007fff1b55b4b8 R14: 00007fff1b55b4c0 R15: 0000000000000000
[  123.885165] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  123.885338] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[  123.886172] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  123.886194] Call Trace:
[  123.886220]  dump_stack_lvl+0xa4/0xd3
[  123.887310] caller is debug_smp_processor_id+0x1c/0x20
[  123.888853]  dump_stack+0x15/0x17
[  123.890829]  check_preemption_disabled+0x167/0x180
[  123.891565]  debug_smp_processor_id+0x1c/0x20
[  123.892199]  perf_swevent_put_recursion_context+0x1b/0x40
[  123.892984]  perf_tp_event+0x331/0x4e0
[  123.893668]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[  123.894560]  ? arch_local_irq_enable+0x10/0x12
[  123.895207]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  123.895902]  ? dump_stack_lvl+0xcc/0xd3
[  123.896493]  ? dump_stack+0x15/0x17
[  123.897014]  ? check_preemption_disabled+0x167/0x180
[  123.897745]  ? text_poke+0x2b/0x60
[  123.898251]  ? do_sync_core+0x30/0x30
[  123.898812]  perf_ftrace_function_call+0x248/0x360
[  123.899502]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  123.900181]  ? perf_ftrace_function_call+0x248/0x360
[  123.901072]  ? 0xffffffffa0098099
[  123.901608]  ? prepare_signal+0x630/0x630
[  123.902238]  0xffffffffa0098099
[  123.902761]  ? _raw_spin_unlock+0x2c/0x50
[  123.903403]  ? prepare_signal+0x630/0x630
[  123.903995]  ? __text_poke+0x5/0x4e0
[  123.904528]  ? lock_is_held_type+0xe2/0x140
[  123.905158]  __text_poke+0x5/0x4e0
[  123.905669]  text_poke+0x2b/0x60
[  123.906164]  ? __text_poke+0x5/0x4e0
[  123.906689]  ? text_poke+0x2b/0x60
[  123.907223]  text_poke_bp_batch+0x93/0x2c0
[  123.907859]  ? __x64_sys_rt_sigsuspend+0xc0/0xc0
[  123.908563]  text_poke_queue+0xa7/0xc0
[  123.909154]  ftrace_replace_code+0xfd/0x170
[  123.909807]  ftrace_modify_all_code+0x1b1/0x270
[  123.910501]  arch_ftrace_update_code+0x9/0x10
[  123.911135]  ftrace_run_update_code+0x30/0xa0
[  123.911786]  ftrace_shutdown+0x2b8/0x4a0
[  123.912415]  unregister_ftrace_function+0x25/0x50
[  123.913103]  perf_ftrace_event_register+0x89/0xf0
[  123.913785]  ? perf_tp_event_init+0xa0/0xa0
[  123.914399]  perf_trace_destroy+0x37/0x60
[  123.915000]  tp_perf_event_destroy+0x15/0x20
[  123.915631]  _free_event+0xfc/0x7d0
[  123.916195]  put_event+0x37/0x50
[  123.916699]  perf_event_release_kernel+0x2f4/0x370
[  123.917439]  ? perf_event_release_kernel+0x370/0x370
[  123.918171]  perf_release+0x19/0x20
[  123.918699]  __fput+0x12d/0x460
[  123.919253]  ____fput+0x1a/0x20
[  123.919739]  task_work_run+0x8e/0xf0
[  123.920316]  do_exit+0x616/0x1310
[  123.920861]  ? write_comp_data+0x2f/0x90
[  123.921497]  do_group_exit+0x7e/0x130
[  123.922086]  get_signal+0x249/0x13c0
[  123.922657]  ? get_signal+0x5/0x13c0
[  123.923267]  arch_do_signal_or_restart+0xb7/0x7e0
[  123.924042]  ? arch_do_signal_or_restart+0x5/0x7e0
[  123.924807]  exit_to_user_mode_prepare+0x154/0x240
[  123.925515]  syscall_exit_to_user_mode+0x2b/0x60
[  123.926203]  do_syscall_64+0x46/0x80
[  123.926746]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  123.927466] RIP: 0033:0x7fac0740459d
[  123.927994] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  123.928886] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  123.929934] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  123.930916] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  123.931888] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  123.932872] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  123.933845] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  123.935002] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  123.935188] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  123.936075] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  123.937177] caller is debug_smp_processor_id+0x1c/0x20
[  123.938638] Call Trace:
[  123.938657]  dump_stack_lvl+0xa4/0xd3
[  123.938702]  dump_stack+0x15/0x17
[  123.938728]  check_preemption_disabled+0x167/0x180
[  123.938758]  ? __check_object_size+0xc7/0x310
[  123.941972]  ? pmd_free_pte_page+0xb0/0xb0
[  123.942557]  debug_smp_processor_id+0x1c/0x20
[  123.943163]  perf_ftrace_function_call+0x7c/0x360
[  123.943812]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  123.944470]  ? ftrace_ops_test+0x71/0xc0
[  123.945026]  ? ftrace_ops_list_func+0x1d2/0x2e0
[  123.945647]  ? rcu_read_lock_held_common+0x2f/0x50
[  123.946315]  ? write_comp_data+0x2f/0x90
[  123.946872]  ? perf_trace_buf_update+0x70/0x70
[  123.947489]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  123.948147]  ? ftrace_ops_list_func+0x1d2/0x2e0
[  123.948768]  ? __check_object_size+0x9f/0x310
[  123.949374]  ? page_idle_bitmap_write+0x270/0x270
[  123.950057]  0xffffffffa0098099
[  123.950513]  ? usercopy_warn+0x120/0x120
[  123.951110]  ? __check_object_size+0xb1/0x310
[  123.951732]  ? __virt_addr_valid+0x5/0x1b0
[  123.952314]  ? __sanitizer_cov_trace_switch+0x53/0x90
[  123.953006]  __virt_addr_valid+0x5/0x1b0
[  123.953555]  __check_object_size+0xc7/0x310
[  123.954144]  ? __virt_addr_valid+0x5/0x1b0
[  123.954709]  ? __check_object_size+0xc7/0x310
[  123.955309]  ? write_comp_data+0x2f/0x90
[  123.955898]  strncpy_from_user+0x89/0x370
[  123.956486]  ? kmem_cache_alloc+0x283/0x300
[  123.957121]  getname_flags+0x8c/0x2d0
[  123.957681]  user_path_at_empty+0x34/0x90
[  123.958276]  do_faccessat+0xe3/0x450
[  123.958846]  __x64_sys_access+0x26/0x30
[  123.959392]  do_syscall_64+0x37/0x80
[  123.959904]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  123.960592] RIP: 0033:0x7f8a3913198b
[  123.961094] Code: 64 89 02 48 c7 c0 ff ff ff ff c3 66 2e 0f 1f 84 00 00 00 00 00 66 2e 0f 1f 84 00 00 00 00 00 f3 0f 1e fa b8 15 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 05 c3 0f 1f 40 00 48 8b 15 e1 b4 0d 00 f7 d8
[  123.963497] RSP: 002b:00007fff1b558a08 EFLAGS: 00000246 ORIG_RAX: 0000000000000015
[  123.964503] RAX: ffffffffffffffda RBX: 00007fff1b55b580 RCX: 00007f8a3913198b
[  123.965439] RDX: 00007f8a398269e8 RSI: 0000000000000000 RDI: 0000560a6f41c090
[  123.966392] RBP: 00007fff1b558a50 R08: 0000000000000000 R09: 0000000000000000
[  123.967331] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000000000
[  123.968269] R13: 0000000000000000 R14: 0000000000000009 R15: 0000560a70da6780
[  123.969329] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  123.969454] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[  123.970417] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  123.970449] Call Trace:
[  123.971557] caller is debug_smp_processor_id+0x1c/0x20
[  123.973190]  dump_stack_lvl+0xa4/0xd3
[  123.974867]  dump_stack+0x15/0x17
[  123.975423]  check_preemption_disabled+0x167/0x180
[  123.976182]  ? text_poke_bp_batch+0x93/0x2c0
[  123.976852]  ? apply_paravirt+0x150/0x150
[  123.977530]  debug_smp_processor_id+0x1c/0x20
[  123.978233]  perf_ftrace_function_call+0x7c/0x360
[  123.978978]  ? preempt_notifier_dec+0x20/0x20
[  123.979702]  ? prepare_signal+0x630/0x630
[  123.980382]  ? ftrace_call+0x5/0x44
[  123.980958]  ? __this_cpu_preempt_check+0x1c/0x20
[  123.981972]  0xffffffffa0098099
[  123.982517]  ? _raw_spin_unlock+0x2c/0x50
[  123.983227]  ? __text_poke+0x2f2/0x4e0
[  123.983912]  ? __send_signal+0xa70/0xa70
[  123.984552]  ? text_poke+0x5/0x60
[  123.985163]  text_poke+0x5/0x60
[  123.985696]  text_poke_bp_batch+0x93/0x2c0
[  123.986364]  ? text_poke+0x5/0x60
[  123.986904]  ? text_poke_bp_batch+0x93/0x2c0
[  123.987645]  ? __x64_sys_rt_sigsuspend+0xc0/0xc0
[  123.988436]  text_poke_queue+0xa7/0xc0
[  123.989109]  ftrace_replace_code+0xfd/0x170
[  123.989853]  ftrace_modify_all_code+0x1b1/0x270
[  123.990636]  arch_ftrace_update_code+0x9/0x10
[  123.991334]  ftrace_run_update_code+0x30/0xa0
[  123.992059]  ftrace_shutdown+0x2b8/0x4a0
[  123.992782]  unregister_ftrace_function+0x25/0x50
[  123.993545]  perf_ftrace_event_register+0x89/0xf0
[  123.994300]  ? perf_tp_event_init+0xa0/0xa0
[  123.994975]  perf_trace_destroy+0x37/0x60
[  123.995643]  tp_perf_event_destroy+0x15/0x20
[  123.996345]  _free_event+0xfc/0x7d0
[  123.996994]  put_event+0x37/0x50
[  123.997566]  perf_event_release_kernel+0x2f4/0x370
[  123.998413]  ? perf_event_release_kernel+0x370/0x370
[  123.999224]  perf_release+0x19/0x20
[  123.999817]  __fput+0x12d/0x460
[  124.000476]  ____fput+0x1a/0x20
[  124.001024]  task_work_run+0x8e/0xf0
[  124.001687]  do_exit+0x616/0x1310
[  124.002317]  ? write_comp_data+0x2f/0x90
[  124.003056]  do_group_exit+0x7e/0x130
[  124.003741]  get_signal+0x249/0x13c0
[  124.004388]  ? get_signal+0x5/0x13c0
[  124.005105]  arch_do_signal_or_restart+0xb7/0x7e0
[  124.006009]  ? arch_do_signal_or_restart+0x5/0x7e0
[  124.006899]  exit_to_user_mode_prepare+0x154/0x240
[  124.007687]  syscall_exit_to_user_mode+0x2b/0x60
[  124.008437]  do_syscall_64+0x46/0x80
[  124.009043]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  124.009827] RIP: 0033:0x7fac0740459d
[  124.010417] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  124.011384] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  124.012529] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  124.013583] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  124.014640] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  124.015692] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  124.016746] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  124.018097] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  124.018272] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  124.019176] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  124.020275] caller is debug_smp_processor_id+0x1c/0x20
[  124.021744] Call Trace:
[  124.022849]  dump_stack_lvl+0xa4/0xd3
[  124.023384]  dump_stack+0x15/0x17
[  124.023859]  check_preemption_disabled+0x167/0x180
[  124.024522]  ? put_cred_rcu+0xa2/0x170
[  124.025046]  ? find_user+0x60/0x60
[  124.025545]  debug_smp_processor_id+0x1c/0x20
[  124.026161]  perf_ftrace_function_call+0x7c/0x360
[  124.026816]  ? ftrace_ops_test+0x71/0xc0
[  124.027378]  ? ftrace_ops_test+0x71/0xc0
[  124.027939]  ? ftrace_ops_test+0x71/0xc0
[  124.028496]  ? write_comp_data+0x2f/0x90
[  124.029052]  ? perf_trace_buf_update+0x70/0x70
[  124.029669]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  124.030333]  ? ftrace_ops_list_func+0x1d2/0x2e0
[  124.030955]  ? put_cred_rcu+0x6a/0x170
[  124.031482]  ? key_reject_and_link+0x450/0x450
[  124.032140]  0xffffffffa0098099
[  124.032649]  ? put_cred_rcu+0x8b/0x170
[  124.033193]  ? free_uid+0x5/0x110
[  124.033690]  free_uid+0x5/0x110
[  124.034144]  put_cred_rcu+0xa2/0x170
[  124.034651]  ? free_uid+0x5/0x110
[  124.035119]  ? put_cred_rcu+0xa2/0x170
[  124.035669]  __put_cred+0x9a/0xc0
[  124.036153]  revert_creds+0x62/0x70
[  124.036659]  do_faccessat+0x238/0x450
[  124.037239]  __x64_sys_access+0x26/0x30
[  124.037786]  do_syscall_64+0x37/0x80
[  124.038300]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  124.038989] RIP: 0033:0x7f8a3913198b
[  124.039490] Code: 64 89 02 48 c7 c0 ff ff ff ff c3 66 2e 0f 1f 84 00 00 00 00 00 66 2e 0f 1f 84 00 00 00 00 00 f3 0f 1e fa b8 15 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 05 c3 0f 1f 40 00 48 8b 15 e1 b4 0d 00 f7 d8
[  124.041878] RSP: 002b:00007fff1b558a08 EFLAGS: 00000246 ORIG_RAX: 0000000000000015
[  124.042886] RAX: ffffffffffffffda RBX: 00007fff1b55b580 RCX: 00007f8a3913198b
[  124.043823] RDX: 00007f8a398269e8 RSI: 0000000000000000 RDI: 0000560a6f41c090
[  124.044760] RBP: 00007fff1b558a50 R08: 0000000000000000 R09: 0000000000000000
[  124.045696] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000000000
[  124.046635] R13: 0000000000000000 R14: 0000000000000009 R15: 0000560a70da6780
[  124.047694] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  124.047901] BUG: using smp_processor_id() in preemptible [00000000] code: gmain/288
[  124.048771] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  124.049759] caller is debug_smp_processor_id+0x1c/0x20
[  124.051385] Call Trace:
[  124.051428]  dump_stack_lvl+0xa4/0xd3
[  124.053105]  dump_stack+0x15/0x17
[  124.053664]  check_preemption_disabled+0x167/0x180
[  124.054502]  debug_smp_processor_id+0x1c/0x20
[  124.055204]  perf_swevent_get_recursion_context+0x1e/0xd0
[  124.056122]  perf_trace_buf_alloc+0x3d/0x100
[  124.056812]  ? text_poke_bp_batch+0x93/0x2c0
[  124.057487]  ? apply_paravirt+0x150/0x150
[  124.058167]  perf_ftrace_function_call+0x209/0x360
[  124.059199]  ? 0xffffffffa0098099
[  124.059906]  0xffffffffa0098099
[  124.060447]  ? _raw_spin_unlock+0x2c/0x50
[  124.061160]  ? __text_poke+0x2f2/0x4e0
[  124.061848]  ? __send_signal+0xa70/0xa70
[  124.062495]  ? text_poke+0x5/0x60
[  124.063108]  text_poke+0x5/0x60
[  124.063642]  text_poke_bp_batch+0x93/0x2c0
[  124.064308]  ? text_poke+0x5/0x60
[  124.064851]  ? text_poke_bp_batch+0x93/0x2c0
[  124.065597]  ? __x64_sys_rt_sigsuspend+0xc0/0xc0
[  124.066398]  text_poke_queue+0xa7/0xc0
[  124.067085]  ftrace_replace_code+0xfd/0x170
[  124.067869]  ftrace_modify_all_code+0x1b1/0x270
[  124.068655]  arch_ftrace_update_code+0x9/0x10
[  124.069358]  ftrace_run_update_code+0x30/0xa0
[  124.070090]  ftrace_shutdown+0x2b8/0x4a0
[  124.070827]  unregister_ftrace_function+0x25/0x50
[  124.071594]  perf_ftrace_event_register+0x89/0xf0
[  124.072346]  ? perf_tp_event_init+0xa0/0xa0
[  124.073022]  perf_trace_destroy+0x37/0x60
[  124.073688]  tp_perf_event_destroy+0x15/0x20
[  124.074397]  _free_event+0xfc/0x7d0
[  124.075049]  put_event+0x37/0x50
[  124.075623]  perf_event_release_kernel+0x2f4/0x370
[  124.076468]  ? perf_event_release_kernel+0x370/0x370
[  124.077283]  perf_release+0x19/0x20
[  124.077876]  __fput+0x12d/0x460
[  124.078541]  ____fput+0x1a/0x20
[  124.079089]  task_work_run+0x8e/0xf0
[  124.079755]  do_exit+0x616/0x1310
[  124.080384]  ? write_comp_data+0x2f/0x90
[  124.081123]  do_group_exit+0x7e/0x130
[  124.081799]  get_signal+0x249/0x13c0
[  124.082452]  ? get_signal+0x5/0x13c0
[  124.083171]  arch_do_signal_or_restart+0xb7/0x7e0
[  124.084072]  ? arch_do_signal_or_restart+0x5/0x7e0
[  124.084959]  exit_to_user_mode_prepare+0x154/0x240
[  124.085746]  syscall_exit_to_user_mode+0x2b/0x60
[  124.086505]  do_syscall_64+0x46/0x80
[  124.087113]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  124.087900] RIP: 0033:0x7fac0740459d
[  124.088487] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  124.089456] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  124.090607] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  124.091662] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  124.092719] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  124.093784] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  124.094854] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  124.096208] CPU: 1 PID: 288 Comm: gmain Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  124.096376] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  124.097174] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  124.098453] caller is debug_smp_processor_id+0x1c/0x20
[  124.099668] Call Trace:
[  124.100712]  dump_stack_lvl+0xa4/0xd3
[  124.101243]  dump_stack+0x15/0x17
[  124.101714]  check_preemption_disabled+0x167/0x180
[  124.102375]  ? __check_object_size+0xc7/0x310
[  124.102972]  ? pmd_free_pte_page+0xb0/0xb0
[  124.103550]  debug_smp_processor_id+0x1c/0x20
[  124.104152]  perf_ftrace_function_call+0x7c/0x360
[  124.104797]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  124.105451]  ? ftrace_ops_test+0x71/0xc0
[  124.106003]  ? ftrace_ops_list_func+0x1d2/0x2e0
[  124.106623]  ? rcu_read_lock_held_common+0x2f/0x50
[  124.107284]  ? write_comp_data+0x2f/0x90
[  124.107836]  ? perf_trace_buf_update+0x70/0x70
[  124.108451]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  124.109106]  ? ftrace_ops_list_func+0x1d2/0x2e0
[  124.109722]  ? __check_object_size+0x9f/0x310
[  124.110326]  ? page_idle_bitmap_write+0x270/0x270
[  124.111005]  0xffffffffa0098099
[  124.111454]  ? usercopy_warn+0x120/0x120
[  124.112059]  ? __check_object_size+0xb1/0x310
[  124.112678]  ? __virt_addr_valid+0x5/0x1b0
[  124.113254]  ? __sanitizer_cov_trace_switch+0x53/0x90
[  124.113938]  __virt_addr_valid+0x5/0x1b0
[  124.114487]  __check_object_size+0xc7/0x310
[  124.115067]  ? __virt_addr_valid+0x5/0x1b0
[  124.115628]  ? __check_object_size+0xc7/0x310
[  124.116220]  ? write_comp_data+0x2f/0x90
[  124.116803]  strncpy_from_user+0x89/0x370
[  124.117366]  ? kmem_cache_alloc+0x283/0x300
[  124.117989]  getname_flags+0x8c/0x2d0
[  124.118544]  user_path_at_empty+0x34/0x90
[  124.119130]  inotify_find_inode+0x37/0xd0
[  124.119711]  __x64_sys_inotify_add_watch+0x14c/0x1e0
[  124.120445]  do_syscall_64+0x37/0x80
[  124.120952]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  124.121634] RIP: 0033:0x7f983bab42bb
[  124.122135] Code: f0 ff ff 73 01 c3 48 8b 0d e2 8b 0c 00 f7 d8 64 89 01 48 83 c8 ff c3 0f 1f 84 00 00 00 00 00 f3 0f 1e fa b8 fe 00 00 00 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d b5 8b 0c 00 f7 d8 64 89 01 48
[  124.124506] RSP: 002b:00007f9837d658d8 EFLAGS: 00000206 ORIG_RAX: 00000000000000fe
[  124.125507] RAX: ffffffffffffffda RBX: 000055aee03ddbd0 RCX: 00007f983bab42bb
[  124.126446] RDX: 0000000001002fce RSI: 000055aee03ddc00 RDI: 0000000000000003
[  124.127377] RBP: 00007f9837d65904 R08: 0000000000000001 R09: 0000000000000000
[  124.128306] R10: 00007ffe5af6d090 R11: 0000000000000206 R12: 0000000000000000
[  124.129234] R13: 0000000000000000 R14: 00007f983df723f0 R15: 000055aee03dd820
[  124.130288] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  124.131309] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  124.132844] Call Trace:
[  124.133224]  dump_stack_lvl+0xa4/0xd3
[  124.133795]  dump_stack+0x15/0x17
[  124.134310]  check_preemption_disabled+0x167/0x180
[  124.135045]  debug_smp_processor_id+0x1c/0x20
[  124.135682]  perf_trace_buf_alloc+0x98/0x100
[  124.136305]  ? text_poke_bp_batch+0x93/0x2c0
[  124.136922]  ? apply_paravirt+0x150/0x150
[  124.137521]  perf_ftrace_function_call+0x209/0x360
[  124.138380]  ? 0xffffffffa0098099
[  124.138996]  0xffffffffa0098099
[  124.139502]  ? _raw_spin_unlock+0x2c/0x50
[  124.140155]  ? __text_poke+0x2f2/0x4e0
[  124.140760]  ? __send_signal+0xa70/0xa70
[  124.141344]  ? text_poke+0x5/0x60
[  124.141880]  text_poke+0x5/0x60
[  124.142390]  text_poke_bp_batch+0x93/0x2c0
[  124.142999]  ? text_poke+0x5/0x60
[  124.143493]  ? text_poke_bp_batch+0x93/0x2c0
[  124.144156]  ? __x64_sys_rt_sigsuspend+0xc0/0xc0
[  124.144868]  text_poke_queue+0xa7/0xc0
[  124.145471]  ftrace_replace_code+0xfd/0x170
[  124.146138]  ftrace_modify_all_code+0x1b1/0x270
[  124.146844]  arch_ftrace_update_code+0x9/0x10
[  124.147487]  ftrace_run_update_code+0x30/0xa0
[  124.148149]  ftrace_shutdown+0x2b8/0x4a0
[  124.148782]  unregister_ftrace_function+0x25/0x50
[  124.149472]  perf_ftrace_event_register+0x89/0xf0
[  124.150161]  ? perf_tp_event_init+0xa0/0xa0
[  124.150777]  perf_trace_destroy+0x37/0x60
[  124.151377]  tp_perf_event_destroy+0x15/0x20
[  124.152007]  _free_event+0xfc/0x7d0
[  124.152570]  put_event+0x37/0x50
[  124.153077]  perf_event_release_kernel+0x2f4/0x370
[  124.153818]  ? perf_event_release_kernel+0x370/0x370
[  124.154558]  perf_release+0x19/0x20
[  124.155089]  __fput+0x12d/0x460
[  124.155644]  ____fput+0x1a/0x20
[  124.156132]  task_work_run+0x8e/0xf0
[  124.156709]  do_exit+0x616/0x1310
[  124.157254]  ? write_comp_data+0x2f/0x90
[  124.157894]  do_group_exit+0x7e/0x130
[  124.158488]  get_signal+0x249/0x13c0
[  124.159054]  ? get_signal+0x5/0x13c0
[  124.159662]  arch_do_signal_or_restart+0xb7/0x7e0
[  124.160436]  ? arch_do_signal_or_restart+0x5/0x7e0
[  124.161201]  exit_to_user_mode_prepare+0x154/0x240
[  124.161908]  syscall_exit_to_user_mode+0x2b/0x60
[  124.162599]  do_syscall_64+0x46/0x80
[  124.163141]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  124.163860] RIP: 0033:0x7fac0740459d
[  124.164388] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  124.165277] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  124.166328] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  124.167302] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  124.168275] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  124.169247] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  124.170231] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  128.762073] check_preemption_disabled: 1168456 callbacks suppressed
[  128.762092] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  128.763837] caller is debug_smp_processor_id+0x1c/0x20
[  128.764477] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  128.765356] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  128.766724] Call Trace:
[  128.767051]  dump_stack_lvl+0xa4/0xd3
[  128.767540]  dump_stack+0x15/0x17
[  128.767974]  check_preemption_disabled+0x167/0x180
[  128.768604]  debug_smp_processor_id+0x1c/0x20
[  128.769158]  perf_trace_buf_alloc+0x98/0x100
[  128.769704]  ? insn_get_displacement+0x157/0x270
[  128.770298]  ? insn_rip_relative+0xb0/0xb0
[  128.770825]  perf_ftrace_function_call+0x209/0x360
[  128.771588]  ? 0xffffffffa0098099
[  128.772100]  0xffffffffa0098099
[  128.772560]  ? 0xffffffffa0098099
[  128.773040]  ? insn_get_displacement+0x47/0x270
[  128.773664]  ? insn_get_sib+0x5/0x140
[  128.774175]  ? write_comp_data+0x2f/0x90
[  128.774720]  insn_get_sib+0x5/0x140
[  128.775201]  insn_get_displacement+0x157/0x270
[  128.775798]  ? insn_get_sib+0x5/0x140
[  128.776294]  ? insn_get_displacement+0x157/0x270
[  128.776933]  insn_get_immediate+0x181/0x570
[  128.777525]  insn_get_length+0x75/0x90
[  128.778052]  insn_decode+0x9b/0x170
[  128.778551]  ? pcie_capability_clear_and_set_word+0xb0/0xb0
[  128.779313]  text_poke_loc_init+0x63/0x140
[  128.779942]  ? pcie_capability_clear_and_set_word+0xb0/0xb0
[  128.780700]  text_poke_queue+0x84/0xc0
[  128.781235]  ftrace_replace_code+0xfd/0x170
[  128.781828]  ftrace_modify_all_code+0x1b1/0x270
[  128.782468]  arch_ftrace_update_code+0x9/0x10
[  128.783057]  ftrace_run_update_code+0x30/0xa0
[  128.783657]  ftrace_shutdown+0x2b8/0x4a0
[  128.784221]  unregister_ftrace_function+0x25/0x50
[  128.784857]  perf_ftrace_event_register+0x89/0xf0
[  128.785489]  ? perf_tp_event_init+0xa0/0xa0
[  128.786058]  perf_trace_destroy+0x37/0x60
[  128.786625]  tp_perf_event_destroy+0x15/0x20
[  128.787210]  _free_event+0xfc/0x7d0
[  128.787716]  put_event+0x37/0x50
[  128.788176]  perf_event_release_kernel+0x2f4/0x370
[  128.788849]  ? perf_event_release_kernel+0x370/0x370
[  128.789522]  perf_release+0x19/0x20
[  128.790045]  __fput+0x12d/0x460
[  128.790544]  ____fput+0x1a/0x20
[  128.790990]  task_work_run+0x8e/0xf0
[  128.791509]  do_exit+0x616/0x1310
[  128.791997]  ? write_comp_data+0x2f/0x90
[  128.792567]  do_group_exit+0x7e/0x130
[  128.793098]  get_signal+0x249/0x13c0
[  128.793611]  ? get_signal+0x5/0x13c0
[  128.794155]  arch_do_signal_or_restart+0xb7/0x7e0
[  128.794844]  ? arch_do_signal_or_restart+0x5/0x7e0
[  128.795537]  exit_to_user_mode_prepare+0x154/0x240
[  128.796189]  syscall_exit_to_user_mode+0x2b/0x60
[  128.796815]  do_syscall_64+0x46/0x80
[  128.797313]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  128.797984] RIP: 0033:0x7fac0740459d
[  128.798481] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  128.799325] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  128.800313] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  128.801227] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  128.802147] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  128.803075] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  128.803996] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  128.805201] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  128.805227] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[  128.806330] caller is debug_smp_processor_id+0x1c/0x20
[  128.807387] caller is debug_smp_processor_id+0x1c/0x20
[  128.808087] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  128.809725] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  128.811254] Call Trace:
[  128.811619]  dump_stack_lvl+0xa4/0xd3
[  128.812167]  dump_stack+0x15/0x17
[  128.812652]  check_preemption_disabled+0x167/0x180
[  128.813354]  debug_smp_processor_id+0x1c/0x20
[  128.813976]  perf_swevent_put_recursion_context+0x1b/0x40
[  128.814746]  perf_tp_event+0x331/0x4e0
[  128.815376]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[  128.816198]  ? arch_local_irq_enable+0x10/0x12
[  128.816834]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  128.817510]  ? dump_stack_lvl+0xcc/0xd3
[  128.818095]  ? insn_get_displacement+0x157/0x270
[  128.818747]  ? insn_rip_relative+0xb0/0xb0
[  128.819343]  perf_ftrace_function_call+0x248/0x360
[  128.820028]  ? perf_trace_buf_alloc+0xb0/0x100
[  128.820660]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  128.821326]  ? perf_ftrace_function_call+0x248/0x360
[  128.822140]  ? 0xffffffffa0098099
[  128.822681]  0xffffffffa0098099
[  128.823167]  ? 0xffffffffa0098099
[  128.823675]  ? insn_get_displacement+0x47/0x270
[  128.824332]  ? insn_get_sib+0x5/0x140
[  128.824860]  ? write_comp_data+0x2f/0x90
[  128.825435]  insn_get_sib+0x5/0x140
[  128.825942]  insn_get_displacement+0x157/0x270
[  128.826575]  ? insn_get_sib+0x5/0x140
[  128.827098]  ? insn_get_displacement+0x157/0x270
[  128.827772]  insn_get_immediate+0x181/0x570
[  128.828396]  insn_get_length+0x75/0x90
[  128.828953]  insn_decode+0x9b/0x170
[  128.829470]  ? pcie_capability_clear_and_set_word+0xb0/0xb0
[  128.830256]  text_poke_loc_init+0x63/0x140
[  128.830915]  ? pcie_capability_clear_and_set_word+0xb0/0xb0
[  128.831715]  text_poke_queue+0x84/0xc0
[  128.832279]  ftrace_replace_code+0xfd/0x170
[  128.832903]  ftrace_modify_all_code+0x1b1/0x270
[  128.833568]  arch_ftrace_update_code+0x9/0x10
[  128.834191]  ftrace_run_update_code+0x30/0xa0
[  128.834821]  ftrace_shutdown+0x2b8/0x4a0
[  128.835418]  unregister_ftrace_function+0x25/0x50
[  128.836088]  perf_ftrace_event_register+0x89/0xf0
[  128.836755]  ? perf_tp_event_init+0xa0/0xa0
[  128.837354]  perf_trace_destroy+0x37/0x60
[  128.837937]  tp_perf_event_destroy+0x15/0x20
[  128.838556]  _free_event+0xfc/0x7d0
[  128.839090]  put_event+0x37/0x50
[  128.839574]  perf_event_release_kernel+0x2f4/0x370
[  128.840281]  ? perf_event_release_kernel+0x370/0x370
[  128.840991]  perf_release+0x19/0x20
[  128.841504]  __fput+0x12d/0x460
[  128.842015]  ____fput+0x1a/0x20
[  128.842490]  task_work_run+0x8e/0xf0
[  128.843036]  do_exit+0x616/0x1310
[  128.843549]  ? write_comp_data+0x2f/0x90
[  128.844149]  do_group_exit+0x7e/0x130
[  128.844707]  get_signal+0x249/0x13c0
[  128.845247]  ? get_signal+0x5/0x13c0
[  128.845813]  arch_do_signal_or_restart+0xb7/0x7e0
[  128.846539]  ? arch_do_signal_or_restart+0x5/0x7e0
[  128.847264]  exit_to_user_mode_prepare+0x154/0x240
[  128.847951]  syscall_exit_to_user_mode+0x2b/0x60
[  128.848611]  do_syscall_64+0x46/0x80
[  128.849136]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  128.849844] RIP: 0033:0x7fac0740459d
[  128.850362] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  128.851243] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  128.852273] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  128.853235] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  128.854200] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  128.855163] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  128.856126] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  128.857199] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  128.857308] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  128.858268] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  128.858280] Call Trace:
[  128.858290]  dump_stack_lvl+0xa4/0xd3
[  128.858312]  dump_stack+0x15/0x17
[  128.858328]  check_preemption_disabled+0x167/0x180
[  128.858346]  ? __mutex_lock+0x56/0x9f0
[  128.858360]  ? ___might_sleep+0x170/0x170
[  128.859451] caller is debug_smp_processor_id+0x1c/0x20
[  128.860904]  debug_smp_processor_id+0x1c/0x20
[  128.865049]  perf_ftrace_function_call+0x7c/0x360
[  128.865678]  ? perf_ftrace_function_call+0x4c/0x360
[  128.866332]  ? write_comp_data+0x2f/0x90
[  128.866862]  ? mutex_lock_nested+0x1b/0x20
[  128.867413]  ? mutex_lock_io_nested+0x940/0x940
[  128.868031]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  128.868659]  ? mutex_lock_nested+0x1b/0x20
[  128.869212]  ? perf_ftrace_function_call+0x4c/0x360
[  128.869865]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  128.870500]  ? ftrace_ops_test+0x71/0xc0
[  128.871045]  0xffffffffa0098099
[  128.871473]  ? 0xffffffffa0098099
[  128.871921]  ? trace_hardirqs_on+0x6a/0x170
[  128.872484]  ? write_comp_data+0x2f/0x90
[  128.873015]  ? perf_trace_buf_update+0x70/0x70
[  128.873612]  ? do_epoll_wait+0x3b3/0xd80
[  128.874154]  ? __might_sleep+0x5/0x70
[  128.874659]  __might_sleep+0x5/0x70
[  128.875135]  __mutex_lock+0x56/0x9f0
[  128.875623]  ? __might_sleep+0x5/0x70
[  128.876119]  ? __mutex_lock+0x56/0x9f0
[  128.876632]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[  128.877350]  ? do_epoll_wait+0x3b3/0xd80
[  128.877883]  ? do_epoll_wait+0x3b3/0xd80
[  128.878424]  ? __mutex_lock+0x5/0x9f0
[  128.878933]  mutex_lock_nested+0x1b/0x20
[  128.879463]  ? __mutex_lock+0x5/0x9f0
[  128.879960]  ? mutex_lock_nested+0x1b/0x20
[  128.880513]  do_epoll_wait+0x3b3/0xd80
[  128.881051]  ? wait_woken+0x90/0x90
[  128.881542]  __x64_sys_epoll_wait+0x8d/0xd0
[  128.882122]  do_syscall_64+0x37/0x80
[  128.882610]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  128.883283] RIP: 0033:0x7f8a39143ae0
[  128.883770] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[  128.886149] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[  128.887134] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[  128.888058] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[  128.888981] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[  128.889906] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[  128.890833] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[  128.891792] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  128.891840] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[  128.892863] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  128.893947] caller is debug_smp_processor_id+0x1c/0x20
[  128.895565] Call Trace:
[  128.896628]  dump_stack_lvl+0xa4/0xd3
[  128.897251]  dump_stack+0x15/0x17
[  128.897792]  check_preemption_disabled+0x167/0x180
[  128.898546]  ? insn_get_sib+0x122/0x140
[  128.899147]  ? insn_get_opcode+0x3b0/0x3b0
[  128.899816]  debug_smp_processor_id+0x1c/0x20
[  128.900503]  perf_ftrace_function_call+0x7c/0x360
[  128.901238]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  128.901969]  ? insn_get_displacement+0x157/0x270
[  128.902692]  ? perf_ftrace_function_call+0x4c/0x360
[  128.903720]  0xffffffffa0098099
[  128.904287]  ? 0xffffffffa0098099
[  128.904875]  ? insn_get_sib+0x43/0x140
[  128.905505]  ? insn_get_modrm+0x5/0x2a0
[  128.906122]  ? write_comp_data+0x2f/0x90
[  128.906767]  insn_get_modrm+0x5/0x2a0
[  128.907356]  insn_get_sib+0x122/0x140
[  128.907944]  ? insn_get_modrm+0x5/0x2a0
[  128.908545]  ? insn_get_sib+0x122/0x140
[  128.909200]  insn_get_displacement+0x157/0x270
[  128.909940]  insn_get_immediate+0x181/0x570
[  128.910657]  insn_get_length+0x75/0x90
[  128.911287]  insn_decode+0x9b/0x170
[  128.911871]  ? pcie_capability_clear_and_set_word+0xb0/0xb0
[  128.912724]  text_poke_loc_init+0x63/0x140
[  128.913520]  ? pcie_capability_clear_and_set_word+0xb0/0xb0
[  128.914419]  text_poke_queue+0x84/0xc0
[  128.915065]  ftrace_replace_code+0xfd/0x170
[  128.915779]  ftrace_modify_all_code+0x1b1/0x270
[  128.916529]  arch_ftrace_update_code+0x9/0x10
[  128.917212]  ftrace_run_update_code+0x30/0xa0
[  128.917915]  ftrace_shutdown+0x2b8/0x4a0
[  128.918607]  unregister_ftrace_function+0x25/0x50
[  128.919348]  perf_ftrace_event_register+0x89/0xf0
[  128.920081]  ? perf_tp_event_init+0xa0/0xa0
[  128.920740]  perf_trace_destroy+0x37/0x60
[  128.921389]  tp_perf_event_destroy+0x15/0x20
[  128.922074]  _free_event+0xfc/0x7d0
[  128.922696]  put_event+0x37/0x50
[  128.923248]  perf_event_release_kernel+0x2f4/0x370
[  128.924059]  ? perf_event_release_kernel+0x370/0x370
[  128.924849]  perf_release+0x19/0x20
[  128.925425]  __fput+0x12d/0x460
[  128.926039]  ____fput+0x1a/0x20
[  128.926571]  task_work_run+0x8e/0xf0
[  128.927201]  do_exit+0x616/0x1310
[  128.927797]  ? write_comp_data+0x2f/0x90
[  128.928495]  do_group_exit+0x7e/0x130
[  128.929139]  get_signal+0x249/0x13c0
[  128.929758]  ? get_signal+0x5/0x13c0
[  128.930442]  arch_do_signal_or_restart+0xb7/0x7e0
[  128.931292]  ? arch_do_signal_or_restart+0x5/0x7e0
[  128.932132]  exit_to_user_mode_prepare+0x154/0x240
[  128.932896]  syscall_exit_to_user_mode+0x2b/0x60
[  128.933630]  do_syscall_64+0x46/0x80
[  128.934221]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  128.934993] RIP: 0033:0x7fac0740459d
[  128.935563] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  128.936519] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  128.937645] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  128.938689] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  128.939731] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  128.940771] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  128.941814] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  128.943084] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  128.943194] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  128.944139] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  128.945234] caller is debug_smp_processor_id+0x1c/0x20
[  128.946682] Call Trace:
[  128.946692]  dump_stack_lvl+0xa4/0xd3
[  128.946713]  dump_stack+0x15/0x17
[  128.946728]  check_preemption_disabled+0x167/0x180
[  128.946747]  ? __might_sleep+0x48/0x70
[  128.946761]  ? sched_show_task+0x70/0x70
[  128.946779]  debug_smp_processor_id+0x1c/0x20
[  128.950961]  perf_ftrace_function_call+0x7c/0x360
[  128.951588]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  128.952215]  ? __mutex_lock+0x56/0x9f0
[  128.952723]  ? perf_ftrace_function_call+0x4c/0x360
[  128.953372]  ? perf_ftrace_function_call+0x4c/0x360
[  128.954024]  ? write_comp_data+0x2f/0x90
[  128.954558]  ? mutex_lock_nested+0x1b/0x20
[  128.955110]  ? mutex_lock_io_nested+0x940/0x940
[  128.955717]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  128.956344]  ? mutex_lock_nested+0x1b/0x20
[  128.956896]  ? perf_ftrace_function_call+0x4c/0x360
[  128.957548]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  128.958182]  ? ftrace_ops_test+0x71/0xc0
[  128.958721]  0xffffffffa0098099
[  128.959158]  ? 0xffffffffa0098099
[  128.959607]  ? trace_hardirqs_on+0x6a/0x170
[  128.960171]  ? do_epoll_wait+0x3b3/0xd80
[  128.960712]  ? ___might_sleep+0x5/0x170
[  128.961237]  ___might_sleep+0x5/0x170
[  128.961734]  __might_sleep+0x48/0x70
[  128.962228]  ? ___might_sleep+0x5/0x170
[  128.962746]  ? __might_sleep+0x48/0x70
[  128.963263]  __mutex_lock+0x56/0x9f0
[  128.963755]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[  128.964473]  ? do_epoll_wait+0x3b3/0xd80
[  128.965005]  ? do_epoll_wait+0x3b3/0xd80
[  128.965542]  ? __mutex_lock+0x5/0x9f0
[  128.966051]  mutex_lock_nested+0x1b/0x20
[  128.966583]  ? __mutex_lock+0x5/0x9f0
[  128.967078]  ? mutex_lock_nested+0x1b/0x20
[  128.967643]  do_epoll_wait+0x3b3/0xd80
[  128.968179]  ? wait_woken+0x90/0x90
[  128.968667]  __x64_sys_epoll_wait+0x8d/0xd0
[  128.969241]  do_syscall_64+0x37/0x80
[  128.969728]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  128.970405] RIP: 0033:0x7f8a39143ae0
[  128.970888] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[  128.973263] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[  128.974250] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[  128.975173] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[  128.976095] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[  128.977019] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[  128.977942] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[  128.978905] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  128.978937] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[  128.979979] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  128.981056] caller is debug_smp_processor_id+0x1c/0x20
[  128.982676] Call Trace:
[  128.982711]  dump_stack_lvl+0xa4/0xd3
[  128.984326]  dump_stack+0x15/0x17
[  128.984869]  check_preemption_disabled+0x167/0x180
[  128.985670]  debug_smp_processor_id+0x1c/0x20
[  128.986362]  perf_swevent_get_recursion_context+0x1e/0xd0
[  128.987244]  perf_trace_buf_alloc+0x3d/0x100
[  128.987919]  ? insn_get_sib+0x122/0x140
[  128.988520]  ? insn_get_opcode+0x3b0/0x3b0
[  128.989180]  perf_ftrace_function_call+0x209/0x360
[  128.990139]  ? 0xffffffffa0098099
[  128.990797]  0xffffffffa0098099
[  128.991365]  ? 0xffffffffa0098099
[  128.991954]  ? insn_get_sib+0x43/0x140
[  128.992587]  ? insn_get_modrm+0x5/0x2a0
[  128.993199]  ? write_comp_data+0x2f/0x90
[  128.993845]  insn_get_modrm+0x5/0x2a0
[  128.994438]  insn_get_sib+0x122/0x140
[  128.995027]  ? insn_get_modrm+0x5/0x2a0
[  128.995629]  ? insn_get_sib+0x122/0x140
[  128.996284]  insn_get_displacement+0x157/0x270
[  128.997023]  insn_get_immediate+0x181/0x570
[  128.997739]  insn_get_length+0x75/0x90
[  128.998378]  insn_decode+0x9b/0x170
[  128.998964]  ? pcie_capability_clear_and_set_word+0xb0/0xb0
[  128.999821]  text_poke_loc_init+0x63/0x140
[  129.000624]  ? pcie_capability_clear_and_set_word+0xb0/0xb0
[  129.001526]  text_poke_queue+0x84/0xc0
[  129.002182]  ftrace_replace_code+0xfd/0x170
[  129.002897]  ftrace_modify_all_code+0x1b1/0x270
[  129.003654]  arch_ftrace_update_code+0x9/0x10
[  129.004339]  ftrace_run_update_code+0x30/0xa0
[  129.005044]  ftrace_shutdown+0x2b8/0x4a0
[  129.005733]  unregister_ftrace_function+0x25/0x50
[  129.006481]  perf_ftrace_event_register+0x89/0xf0
[  129.007215]  ? perf_tp_event_init+0xa0/0xa0
[  129.007873]  perf_trace_destroy+0x37/0x60
[  129.008523]  tp_perf_event_destroy+0x15/0x20
[  129.009208]  _free_event+0xfc/0x7d0
[  129.009827]  put_event+0x37/0x50
[  129.010384]  perf_event_release_kernel+0x2f4/0x370
[  129.011193]  ? perf_event_release_kernel+0x370/0x370
[  129.011982]  perf_release+0x19/0x20
[  129.012559]  __fput+0x12d/0x460
[  129.013176]  ____fput+0x1a/0x20
[  129.013706]  task_work_run+0x8e/0xf0
[  129.014342]  do_exit+0x616/0x1310
[  129.014939]  ? write_comp_data+0x2f/0x90
[  129.015640]  do_group_exit+0x7e/0x130
[  129.016285]  get_signal+0x249/0x13c0
[  129.016905]  ? get_signal+0x5/0x13c0
[  129.017578]  arch_do_signal_or_restart+0xb7/0x7e0
[  129.018434]  ? arch_do_signal_or_restart+0x5/0x7e0
[  129.019276]  exit_to_user_mode_prepare+0x154/0x240
[  129.020041]  syscall_exit_to_user_mode+0x2b/0x60
[  129.020772]  do_syscall_64+0x46/0x80
[  129.021360]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  129.022135] RIP: 0033:0x7fac0740459d
[  129.022707] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  129.023663] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  129.024791] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  129.025834] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  129.026882] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  129.027923] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  129.028963] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  129.030239] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  129.030345] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  129.031300] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  129.032319] caller is debug_smp_processor_id+0x1c/0x20
[  129.033767] Call Trace:
[  129.033775]  dump_stack_lvl+0xa4/0xd3
[  129.035278]  dump_stack+0x15/0x17
[  129.035733]  check_preemption_disabled+0x167/0x180
[  129.036373]  ? __mutex_lock+0x7b/0x9f0
[  129.036880]  ? trace_sched_waking+0xc0/0xc0
[  129.037444]  debug_smp_processor_id+0x1c/0x20
[  129.038031]  perf_ftrace_function_call+0x7c/0x360
[  129.038661]  ? perf_ftrace_function_call+0x4c/0x360
[  129.039313]  ? write_comp_data+0x2f/0x90
[  129.039842]  ? mutex_lock_nested+0x1b/0x20
[  129.040390]  ? mutex_lock_io_nested+0x940/0x940
[  129.040997]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  129.041625]  ? mutex_lock_nested+0x1b/0x20
[  129.042181]  ? perf_ftrace_function_call+0x4c/0x360
[  129.042835]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  129.043465]  ? ftrace_ops_test+0x71/0xc0
[  129.044012]  0xffffffffa0098099
[  129.044443]  ? __this_cpu_preempt_check+0x1c/0x20
[  129.045074]  ? lock_is_held_type+0xe2/0x140
[  129.045638]  ? do_epoll_wait+0x3b3/0xd80
[  129.046182]  ? preempt_count_add+0x5/0xc0
[  129.046728]  preempt_count_add+0x5/0xc0
[  129.047246]  __mutex_lock+0x7b/0x9f0
[  129.047731]  ? preempt_count_add+0x5/0xc0
[  129.048268]  ? __mutex_lock+0x7b/0x9f0
[  129.048778]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[  129.049496]  ? do_epoll_wait+0x3b3/0xd80
[  129.050053]  ? do_epoll_wait+0x3b3/0xd80
[  129.050619]  ? __mutex_lock+0x5/0x9f0
[  129.051132]  mutex_lock_nested+0x1b/0x20
[  129.051662]  ? __mutex_lock+0x5/0x9f0
[  129.052156]  ? mutex_lock_nested+0x1b/0x20
[  129.052706]  do_epoll_wait+0x3b3/0xd80
[  129.053241]  ? wait_woken+0x90/0x90
[  129.053727]  __x64_sys_epoll_wait+0x8d/0xd0
[  129.054312]  do_syscall_64+0x37/0x80
[  129.054798]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  129.055469] RIP: 0033:0x7f8a39143ae0
[  129.055950] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[  129.058334] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[  129.059323] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[  129.060272] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[  129.061224] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[  129.062202] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[  129.063136] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[  129.064107] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  129.064160] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[  129.065124] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  129.066251] caller is debug_smp_processor_id+0x1c/0x20
[  129.067755] Call Trace:
[  129.068790]  dump_stack_lvl+0xa4/0xd3
[  129.069347]  dump_stack+0x15/0x17
[  129.069848]  check_preemption_disabled+0x167/0x180
[  129.070599]  debug_smp_processor_id+0x1c/0x20
[  129.071250]  perf_trace_buf_alloc+0x98/0x100
[  129.071863]  ? insn_get_sib+0x122/0x140
[  129.072409]  ? insn_get_opcode+0x3b0/0x3b0
[  129.072998]  perf_ftrace_function_call+0x209/0x360
[  129.073776]  ? 0xffffffffa0098099
[  129.074341]  0xffffffffa0098099
[  129.074827]  ? 0xffffffffa0098099
[  129.075333]  ? insn_get_sib+0x43/0x140
[  129.075889]  ? insn_get_modrm+0x5/0x2a0
[  129.076439]  ? write_comp_data+0x2f/0x90
[  129.077012]  insn_get_modrm+0x5/0x2a0
[  129.077541]  insn_get_sib+0x122/0x140
[  129.078075]  ? insn_get_modrm+0x5/0x2a0
[  129.078629]  ? insn_get_sib+0x122/0x140
[  129.079201]  insn_get_displacement+0x157/0x270
[  129.079852]  insn_get_immediate+0x181/0x570
[  129.080475]  insn_get_length+0x75/0x90
[  129.081032]  insn_decode+0x9b/0x170
[  129.081548]  ? pcie_capability_clear_and_set_word+0xb0/0xb0
[  129.082451]  text_poke_loc_init+0x63/0x140
[  129.083115]  ? pcie_capability_clear_and_set_word+0xb0/0xb0
[  129.083960]  text_poke_queue+0x84/0xc0
[  129.084524]  ftrace_replace_code+0xfd/0x170
[  129.085148]  ftrace_modify_all_code+0x1b1/0x270
[  129.085808]  arch_ftrace_update_code+0x9/0x10
[  129.086436]  ftrace_run_update_code+0x30/0xa0
[  129.087065]  ftrace_shutdown+0x2b8/0x4a0
[  129.087658]  unregister_ftrace_function+0x25/0x50
[  129.088325]  perf_ftrace_event_register+0x89/0xf0
[  129.088991]  ? perf_tp_event_init+0xa0/0xa0
[  129.089588]  perf_trace_destroy+0x37/0x60
[  129.090175]  tp_perf_event_destroy+0x15/0x20
[  129.090789]  _free_event+0xfc/0x7d0
[  129.091323]  put_event+0x37/0x50
[  129.091806]  perf_event_release_kernel+0x2f4/0x370
[  129.092512]  ? perf_event_release_kernel+0x370/0x370
[  129.093217]  perf_release+0x19/0x20
[  129.093728]  __fput+0x12d/0x460
[  129.094244]  ____fput+0x1a/0x20
[  129.094713]  task_work_run+0x8e/0xf0
[  129.095260]  do_exit+0x616/0x1310
[  129.095774]  ? write_comp_data+0x2f/0x90
[  129.096375]  do_group_exit+0x7e/0x130
[  129.096934]  get_signal+0x249/0x13c0
[  129.097474]  ? get_signal+0x5/0x13c0
[  129.098040]  arch_do_signal_or_restart+0xb7/0x7e0
[  129.098768]  ? arch_do_signal_or_restart+0x5/0x7e0
[  129.099499]  exit_to_user_mode_prepare+0x154/0x240
[  129.100188]  syscall_exit_to_user_mode+0x2b/0x60
[  129.100850]  do_syscall_64+0x46/0x80
[  129.101376]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  129.102085] RIP: 0033:0x7fac0740459d
[  129.102604] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  129.103487] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  129.104524] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  129.105489] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  129.106456] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  129.107421] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  129.108383] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  129.109459] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  129.109584] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  129.110537] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  129.110549] Call Trace:
[  129.110558]  dump_stack_lvl+0xa4/0xd3
[  129.110580]  dump_stack+0x15/0x17
[  129.110595]  check_preemption_disabled+0x167/0x180
[  129.110614]  ? do_epoll_wait+0x3bf/0xd80
[  129.111644] caller is debug_smp_processor_id+0x1c/0x20
[  129.113091]  ? __ia32_sys_fanotify_init+0x5c0/0x5c0
[  129.116785]  debug_smp_processor_id+0x1c/0x20
[  129.117372]  perf_ftrace_function_call+0x7c/0x360
[  129.118009]  ? 0xffffffffa0098099
[  129.118475]  ? do_epoll_wait+0x3b3/0xd80
[  129.119016]  ? preempt_count_sub+0x5/0xa0
[  129.119568]  0xffffffffa0098099
[  129.119998]  ? __mutex_lock+0xfe/0x9f0
[  129.120511]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[  129.121232]  ? do_epoll_wait+0x3b3/0xd80
[  129.121772]  ? ep_start_scan+0x5/0x100
[  129.122291]  ep_start_scan+0x5/0x100
[  129.122779]  do_epoll_wait+0x3bf/0xd80
[  129.123290]  ? ep_start_scan+0x5/0x100
[  129.123797]  ? do_epoll_wait+0x3bf/0xd80
[  129.124354]  ? wait_woken+0x90/0x90
[  129.124842]  __x64_sys_epoll_wait+0x8d/0xd0
[  129.125419]  do_syscall_64+0x37/0x80
[  129.125906]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  129.126582] RIP: 0033:0x7f8a39143ae0
[  129.127067] Code: 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 c5 f5 0c 00 41 89 ca 8b 00 85 c0 75 1c 2e 2e 2e 2e 2e b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 41 55 41 89 cd
[  129.129448] RSP: 002b:00007fff1b55b2f8 EFLAGS: 00000246 ORIG_RAX: 00000000000000e8
[  129.130441] RAX: ffffffffffffffda RBX: 0000560a70da3ed0 RCX: 00007f8a39143ae0
[  129.131366] RDX: 000000000000001a RSI: 00007fff1b55b300 RDI: 0000000000000006
[  129.132290] RBP: 00007fff1b55b530 R08: 00007fff1b55b300 R09: 00007fff1b55b578
[  129.133215] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000560a70da3ed0
[  129.134144] R13: ffffffffffffffff R14: 00007fff1b55b300 R15: 0000000000000001
[  129.135104] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  129.136110] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  129.137634] Call Trace:
[  129.138003]  dump_stack_lvl+0xa4/0xd3
[  129.138558]  dump_stack+0x15/0x17
[  129.139043]  check_preemption_disabled+0x167/0x180
[  129.139749]  debug_smp_processor_id+0x1c/0x20
[  129.140371]  perf_swevent_put_recursion_context+0x1b/0x40
[  129.141138]  perf_tp_event+0x331/0x4e0
[  129.141829]  ? arch_local_irq_enable+0x10/0x12
[  129.142471]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  129.143149]  ? dump_stack_lvl+0xcc/0xd3
[  129.143718]  ? dump_stack+0x15/0x17
[  129.144227]  ? check_preemption_disabled+0x167/0x180
[  129.144954]  ? insn_get_sib+0x122/0x140
[  129.145501]  ? insn_get_opcode+0x3b0/0x3b0
[  129.146100]  perf_ftrace_function_call+0x248/0x360
[  129.146779]  ? perf_ftrace_function_call+0x248/0x360
[  129.147592]  ? 0xffffffffa0098099
[  129.148132]  0xffffffffa0098099
[  129.148617]  ? 0xffffffffa0098099
[  129.149125]  ? insn_get_sib+0x43/0x140
[  129.149683]  ? insn_get_modrm+0x5/0x2a0
[  129.150239]  ? write_comp_data+0x2f/0x90
[  129.150813]  insn_get_modrm+0x5/0x2a0
[  129.151343]  insn_get_sib+0x122/0x140
[  129.151872]  ? insn_get_modrm+0x5/0x2a0
[  129.152417]  ? insn_get_sib+0x122/0x140
[  129.152988]  insn_get_displacement+0x157/0x270
[  129.153639]  insn_get_immediate+0x181/0x570
[  129.154267]  insn_get_length+0x75/0x90
[  129.154823]  insn_decode+0x9b/0x170
[  129.155340]  ? pcie_capability_clear_and_set_word+0xb0/0xb0
[  129.156117]  text_poke_loc_init+0x63/0x140
[  129.156776]  ? pcie_capability_clear_and_set_word+0xb0/0xb0
[  129.157575]  text_poke_queue+0x84/0xc0
[  129.158144]  ftrace_replace_code+0xfd/0x170
[  129.158769]  ftrace_modify_all_code+0x1b1/0x270
[  129.159432]  arch_ftrace_update_code+0x9/0x10
[  129.160054]  ftrace_run_update_code+0x30/0xa0
[  129.160685]  ftrace_shutdown+0x2b8/0x4a0
[  129.161279]  unregister_ftrace_function+0x25/0x50
[  129.161950]  perf_ftrace_event_register+0x89/0xf0
[  129.162620]  ? perf_tp_event_init+0xa0/0xa0
[  129.163218]  perf_trace_destroy+0x37/0x60
[  129.163801]  tp_perf_event_destroy+0x15/0x20
[  129.164416]  _free_event+0xfc/0x7d0
[  129.164951]  put_event+0x37/0x50
[  129.165437]  perf_event_release_kernel+0x2f4/0x370
[  129.166152]  ? perf_event_release_kernel+0x370/0x370
[  129.166863]  perf_release+0x19/0x20
[  129.167375]  __fput+0x12d/0x460
[  129.167888]  ____fput+0x1a/0x20
[  129.168358]  task_work_run+0x8e/0xf0
[  129.168904]  do_exit+0x616/0x1310
[  129.169417]  ? write_comp_data+0x2f/0x90
[  129.170017]  do_group_exit+0x7e/0x130
[  129.170580]  get_signal+0x249/0x13c0
[  129.171119]  ? get_signal+0x5/0x13c0
[  129.171685]  arch_do_signal_or_restart+0xb7/0x7e0
[  129.172409]  ? arch_do_signal_or_restart+0x5/0x7e0
[  129.173134]  exit_to_user_mode_prepare+0x154/0x240
[  129.173820]  syscall_exit_to_user_mode+0x2b/0x60
[  129.174485]  do_syscall_64+0x46/0x80
[  129.175010]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  129.175723] RIP: 0033:0x7fac0740459d
[  129.176239] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  129.177122] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  129.178157] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  129.179120] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  129.180082] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  129.181048] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  129.182013] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  133.766044] check_preemption_disabled: 1588750 callbacks suppressed
[  133.766059] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[  133.766062] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  133.766826] caller is debug_smp_processor_id+0x1c/0x20
[  133.767774] caller is debug_smp_processor_id+0x1c/0x20
[  133.768606] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  133.770623] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  133.771865] Call Trace:
[  133.772155]  dump_stack_lvl+0xa4/0xd3
[  133.772586]  dump_stack+0x15/0x17
[  133.772974]  check_preemption_disabled+0x167/0x180
[  133.773522]  ? schedule_timeout+0x34e/0x610
[  133.774004]  ? do_init_timer+0xa0/0xa0
[  133.774454]  debug_smp_processor_id+0x1c/0x20
[  133.774965]  perf_ftrace_function_call+0x7c/0x360
[  133.775563]  ? 0xffffffffa0098099
[  133.775987]  ? __this_cpu_preempt_check+0x1c/0x20
[  133.776588]  ? finish_task_switch+0xab/0x2a0
[  133.777123]  ? __schedule+0x46e/0xb20
[  133.777605]  0xffffffffa0098099
[  133.778010]  ? finish_task_switch+0xb0/0x2a0
[  133.778571]  ? del_timer_sync+0x5/0x130
[  133.779065]  del_timer_sync+0x5/0x130
[  133.779534]  schedule_timeout+0x34e/0x610
[  133.780042]  ? del_timer_sync+0x5/0x130
[  133.780526]  ? schedule_timeout+0x34e/0x610
[  133.781063]  ? del_timer_sync+0x130/0x130
[  133.781579]  ? i915_init_ggtt+0x40/0x6b0
[  133.782092]  rcu_gp_fqs_loop+0x2a0/0x410
[  133.782603]  ? rcu_gp_init+0x730/0x730
[  133.783080]  rcu_gp_kthread+0xdd/0x170
[  133.783564]  kthread+0x1e7/0x230
[  133.783984]  ? set_kthread_struct+0x80/0x80
[  133.784518]  ret_from_fork+0x1f/0x30
[  133.785010] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  133.785043] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[  133.785989] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  133.786006] Call Trace:
[  133.786971] caller is debug_smp_processor_id+0x1c/0x20
[  133.788410]  dump_stack_lvl+0xa4/0xd3
[  133.789863]  dump_stack+0x15/0x17
[  133.790335]  check_preemption_disabled+0x167/0x180
[  133.791008]  debug_smp_processor_id+0x1c/0x20
[  133.791602]  perf_trace_buf_alloc+0x98/0x100
[  133.792185]  ? _raw_spin_lock+0x17/0x50
[  133.792708]  ? trace_sched_waking+0xc0/0xc0
[  133.793282]  perf_ftrace_function_call+0x209/0x360
[  133.794028]  ? 0xffffffffa0098099
[  133.794551]  0xffffffffa0098099
[  133.794998]  ? ftrace_call+0x5/0x44
[  133.795493]  ? __i915_printfn_error+0x1/0x30
[  133.796111]  ? pmd_page_vaddr+0x2b/0x70
[  133.796655]  ? preempt_count_add+0x5/0xc0
[  133.797225]  preempt_count_add+0x5/0xc0
[  133.797753]  _raw_spin_lock+0x17/0x50
[  133.798266]  ? preempt_count_add+0x5/0xc0
[  133.798809]  ? _raw_spin_lock+0x17/0x50
[  133.799344]  __get_locked_pte+0x1a2/0x290
[  133.799905]  ? __i915_printfn_error+0x1/0x30
[  133.800501]  __text_poke+0xea/0x4e0
[  133.800988]  ? __i915_printfn_error+0x1/0x30
[  133.801584]  ? lock_is_held_type+0xe2/0x140
[  133.802166]  ? __i915_printfn_error+0x1/0x30
[  133.802770]  text_poke+0x2b/0x60
[  133.803238]  text_poke_bp_batch+0xf5/0x2c0
[  133.803819]  ? failsafe_emulate_mmio_rw.part.5+0x180/0x180
[  133.804574]  text_poke_queue+0xa7/0xc0
[  133.805112]  ftrace_replace_code+0xfd/0x170
[  133.805707]  ftrace_modify_all_code+0x1b1/0x270
[  133.806345]  arch_ftrace_update_code+0x9/0x10
[  133.806939]  ftrace_run_update_code+0x30/0xa0
[  133.807542]  ftrace_shutdown+0x2b8/0x4a0
[  133.808114]  unregister_ftrace_function+0x25/0x50
[  133.808756]  perf_ftrace_event_register+0x89/0xf0
[  133.809392]  ? perf_tp_event_init+0xa0/0xa0
[  133.809966]  perf_trace_destroy+0x37/0x60
[  133.810528]  tp_perf_event_destroy+0x15/0x20
[  133.811116]  _free_event+0xfc/0x7d0
[  133.811628]  put_event+0x37/0x50
[  133.812092]  perf_event_release_kernel+0x2f4/0x370
[  133.812770]  ? perf_event_release_kernel+0x370/0x370
[  133.813448]  perf_release+0x19/0x20
[  133.813940]  __fput+0x12d/0x460
[  133.814437]  ____fput+0x1a/0x20
[  133.814887]  task_work_run+0x8e/0xf0
[  133.815411]  do_exit+0x616/0x1310
[  133.815904]  ? write_comp_data+0x2f/0x90
[  133.816481]  do_group_exit+0x7e/0x130
[  133.817015]  get_signal+0x249/0x13c0
[  133.817533]  ? get_signal+0x5/0x13c0
[  133.818075]  arch_do_signal_or_restart+0xb7/0x7e0
[  133.818772]  ? arch_do_signal_or_restart+0x5/0x7e0
[  133.819465]  exit_to_user_mode_prepare+0x154/0x240
[  133.820122]  syscall_exit_to_user_mode+0x2b/0x60
[  133.820754]  do_syscall_64+0x46/0x80
[  133.821254]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  133.821930] RIP: 0033:0x7fac0740459d
[  133.822426] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  133.823267] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  133.824252] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  133.825169] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  133.826084] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  133.827001] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  133.827918] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  133.828945] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  133.829053] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  133.829889] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  133.830953] caller is debug_smp_processor_id+0x1c/0x20
[  133.832216] Call Trace:
[  133.833184]  dump_stack_lvl+0xa4/0xd3
[  133.833655]  dump_stack+0x15/0x17
[  133.834080]  check_preemption_disabled+0x167/0x180
[  133.834689]  ? del_timer_sync+0xd3/0x130
[  133.835185]  ? detach_if_pending+0x270/0x270
[  133.835726]  debug_smp_processor_id+0x1c/0x20
[  133.836275]  perf_ftrace_function_call+0x7c/0x360
[  133.836863]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  133.837458]  ? register_lock_class+0x42/0x440
[  133.838010]  ? del_timer_sync+0x40/0x130
[  133.838515]  ? 0xffffffffa0098099
[  133.838939]  ? 0xffffffffa0098099
[  133.839366]  ? 0xffffffffa0098099
[  133.839801]  0xffffffffa0098099
[  133.840203]  ? __this_cpu_preempt_check+0x1c/0x20
[  133.840805]  ? del_timer_sync+0xa5/0x130
[  133.841308]  ? try_to_del_timer_sync+0x5/0x90
[  133.841856]  ? write_comp_data+0x2f/0x90
[  133.842358]  try_to_del_timer_sync+0x5/0x90
[  133.842886]  del_timer_sync+0xd3/0x130
[  133.843363]  ? try_to_del_timer_sync+0x5/0x90
[  133.843910]  ? del_timer_sync+0xd3/0x130
[  133.844412]  schedule_timeout+0x34e/0x610
[  133.844929]  ? del_timer_sync+0x130/0x130
[  133.845443]  ? i915_init_ggtt+0x40/0x6b0
[  133.845951]  rcu_gp_fqs_loop+0x2a0/0x410
[  133.846461]  ? rcu_gp_init+0x730/0x730
[  133.846938]  rcu_gp_kthread+0xdd/0x170
[  133.847421]  kthread+0x1e7/0x230
[  133.847839]  ? set_kthread_struct+0x80/0x80
[  133.848373]  ret_from_fork+0x1f/0x30
[  133.848863] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  133.848893] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[  133.849807] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  133.850794] caller is debug_smp_processor_id+0x1c/0x20
[  133.852215] Call Trace:
[  133.853177]  dump_stack_lvl+0xa4/0xd3
[  133.853700]  dump_stack+0x15/0x17
[  133.854168]  check_preemption_disabled+0x167/0x180
[  133.854843]  debug_smp_processor_id+0x1c/0x20
[  133.855438]  perf_swevent_put_recursion_context+0x1b/0x40
[  133.856170]  perf_tp_event+0x331/0x4e0
[  133.856846]  ? arch_local_irq_enable+0x10/0x12
[  133.857451]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  133.858097]  ? dump_stack_lvl+0xcc/0xd3
[  133.858646]  ? dump_stack+0x15/0x17
[  133.859132]  ? check_preemption_disabled+0x167/0x180
[  133.859823]  ? _raw_spin_lock+0x17/0x50
[  133.860346]  ? trace_sched_waking+0xc0/0xc0
[  133.860927]  perf_ftrace_function_call+0x248/0x360
[  133.861574]  ? perf_ftrace_function_call+0x248/0x360
[  133.862357]  ? 0xffffffffa0098099
[  133.862875]  0xffffffffa0098099
[  133.863323]  ? ftrace_call+0x5/0x44
[  133.863818]  ? __i915_printfn_error+0x1/0x30
[  133.864417]  ? pmd_page_vaddr+0x2b/0x70
[  133.864959]  ? preempt_count_add+0x5/0xc0
[  133.865529]  preempt_count_add+0x5/0xc0
[  133.866057]  _raw_spin_lock+0x17/0x50
[  133.866570]  ? preempt_count_add+0x5/0xc0
[  133.867113]  ? _raw_spin_lock+0x17/0x50
[  133.867645]  __get_locked_pte+0x1a2/0x290
[  133.868205]  ? __i915_printfn_error+0x1/0x30
[  133.868798]  __text_poke+0xea/0x4e0
[  133.869283]  ? __i915_printfn_error+0x1/0x30
[  133.869877]  ? lock_is_held_type+0xe2/0x140
[  133.870457]  ? __i915_printfn_error+0x1/0x30
[  133.871062]  text_poke+0x2b/0x60
[  133.871531]  text_poke_bp_batch+0xf5/0x2c0
[  133.872112]  ? failsafe_emulate_mmio_rw.part.5+0x180/0x180
[  133.872862]  text_poke_queue+0xa7/0xc0
[  133.873401]  ftrace_replace_code+0xfd/0x170
[  133.873998]  ftrace_modify_all_code+0x1b1/0x270
[  133.874633]  arch_ftrace_update_code+0x9/0x10
[  133.875225]  ftrace_run_update_code+0x30/0xa0
[  133.875826]  ftrace_shutdown+0x2b8/0x4a0
[  133.876396]  unregister_ftrace_function+0x25/0x50
[  133.877036]  perf_ftrace_event_register+0x89/0xf0
[  133.877674]  ? perf_tp_event_init+0xa0/0xa0
[  133.878249]  perf_trace_destroy+0x37/0x60
[  133.878807]  tp_perf_event_destroy+0x15/0x20
[  133.879396]  _free_event+0xfc/0x7d0
[  133.879908]  put_event+0x37/0x50
[  133.880371]  perf_event_release_kernel+0x2f4/0x370
[  133.881050]  ? perf_event_release_kernel+0x370/0x370
[  133.881728]  perf_release+0x19/0x20
[  133.882223]  __fput+0x12d/0x460
[  133.882714]  ____fput+0x1a/0x20
[  133.883164]  task_work_run+0x8e/0xf0
[  133.883687]  do_exit+0x616/0x1310
[  133.884179]  ? write_comp_data+0x2f/0x90
[  133.884755]  do_group_exit+0x7e/0x130
[  133.885288]  get_signal+0x249/0x13c0
[  133.885804]  ? get_signal+0x5/0x13c0
[  133.886350]  arch_do_signal_or_restart+0xb7/0x7e0
[  133.887043]  ? arch_do_signal_or_restart+0x5/0x7e0
[  133.887734]  exit_to_user_mode_prepare+0x154/0x240
[  133.888389]  syscall_exit_to_user_mode+0x2b/0x60
[  133.889020]  do_syscall_64+0x46/0x80
[  133.889521]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  133.890202] RIP: 0033:0x7fac0740459d
[  133.890691] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  133.891530] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  133.892512] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  133.893428] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  133.894347] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  133.895261] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  133.896175] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  133.897201] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  133.897320] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  133.898143] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  133.898154] Call Trace:
[  133.898162]  dump_stack_lvl+0xa4/0xd3
[  133.898183]  dump_stack+0x15/0x17
[  133.898198]  check_preemption_disabled+0x167/0x180
[  133.898216]  ? try_to_del_timer_sync+0x33/0x90
[  133.898232]  ? calc_wheel_index+0x2d0/0x2d0
[  133.899280] caller is debug_smp_processor_id+0x1c/0x20
[  133.900636]  debug_smp_processor_id+0x1c/0x20
[  133.904616]  perf_ftrace_function_call+0x7c/0x360
[  133.905206]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  133.905795]  ? del_timer_sync+0xd3/0x130
[  133.906297]  ? perf_ftrace_function_call+0x4c/0x360
[  133.906905]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  133.907501]  ? register_lock_class+0x42/0x440
[  133.908054]  ? del_timer_sync+0x40/0x130
[  133.908556]  ? 0xffffffffa0098099
[  133.908980]  ? 0xffffffffa0098099
[  133.909411]  0xffffffffa0098099
[  133.909819]  ? 0xffffffffa0098099
[  133.910244]  ? __this_cpu_preempt_check+0x1c/0x20
[  133.910837]  ? del_timer_sync+0xa5/0x130
[  133.911340]  ? lock_timer_base+0x5/0x100
[  133.911843]  lock_timer_base+0x5/0x100
[  133.912320]  try_to_del_timer_sync+0x33/0x90
[  133.912861]  ? lock_timer_base+0x5/0x100
[  133.913375]  ? try_to_del_timer_sync+0x33/0x90
[  133.913945]  ? try_to_del_timer_sync+0x5/0x90
[  133.914529]  del_timer_sync+0xd3/0x130
[  133.915017]  schedule_timeout+0x34e/0x610
[  133.915535]  ? del_timer_sync+0x130/0x130
[  133.916048]  ? i915_init_ggtt+0x40/0x6b0
[  133.916561]  rcu_gp_fqs_loop+0x2a0/0x410
[  133.917077]  ? rcu_gp_init+0x730/0x730
[  133.917556]  rcu_gp_kthread+0xdd/0x170
[  133.918042]  kthread+0x1e7/0x230
[  133.918471]  ? set_kthread_struct+0x80/0x80
[  133.919008]  ret_from_fork+0x1f/0x30
[  133.919507] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  133.919561] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[  133.920559] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  133.921519] caller is debug_smp_processor_id+0x1c/0x20
[  133.923093] Call Trace:
[  133.923129]  dump_stack_lvl+0xa4/0xd3
[  133.924663]  dump_stack+0x15/0x17
[  133.925182]  check_preemption_disabled+0x167/0x180
[  133.925900]  ? text_poke_bp_batch+0xf5/0x2c0
[  133.926538]  ? apply_paravirt+0x150/0x150
[  133.927171]  debug_smp_processor_id+0x1c/0x20
[  133.927832]  perf_ftrace_function_call+0x7c/0x360
[  133.928582]  ? __i915_printfn_error+0x1/0x30
[  133.929254]  ? 0xffffffffa0098099
[  133.929780]  ? __this_cpu_preempt_check+0x1c/0x20
[  133.930693]  0xffffffffa0098099
[  133.931197]  ? _raw_spin_unlock+0x2c/0x50
[  133.931812]  ? write_comp_data+0x2f/0x90
[  133.932456]  ? i915_error_puts.part.21+0x1/0x90
[  133.933174]  ? i915_error_puts.part.21+0x1/0x90
[  133.933857]  ? text_poke+0x5/0x60
[  133.934430]  text_poke+0x5/0x60
[  133.934929]  text_poke_bp_batch+0xf5/0x2c0
[  133.935552]  ? text_poke+0x5/0x60
[  133.936061]  ? text_poke_bp_batch+0xf5/0x2c0
[  133.936751]  ? failsafe_emulate_mmio_rw.part.5+0x180/0x180
[  133.937600]  text_poke_queue+0xa7/0xc0
[  133.938234]  ftrace_replace_code+0xfd/0x170
[  133.938923]  ftrace_modify_all_code+0x1b1/0x270
[  133.939646]  arch_ftrace_update_code+0x9/0x10
[  133.940305]  ftrace_run_update_code+0x30/0xa0
[  133.940986]  ftrace_shutdown+0x2b8/0x4a0
[  133.941650]  unregister_ftrace_function+0x25/0x50
[  133.942368]  perf_ftrace_event_register+0x89/0xf0
[  133.943073]  ? perf_tp_event_init+0xa0/0xa0
[  133.943711]  perf_trace_destroy+0x37/0x60
[  133.944335]  tp_perf_event_destroy+0x15/0x20
[  133.944993]  _free_event+0xfc/0x7d0
[  133.945589]  put_event+0x37/0x50
[  133.946124]  perf_event_release_kernel+0x2f4/0x370
[  133.946906]  ? perf_event_release_kernel+0x370/0x370
[  133.947662]  perf_release+0x19/0x20
[  133.948216]  __fput+0x12d/0x460
[  133.948811]  ____fput+0x1a/0x20
[  133.949321]  task_work_run+0x8e/0xf0
[  133.949928]  do_exit+0x616/0x1310
[  133.950510]  ? write_comp_data+0x2f/0x90
[  133.951185]  do_group_exit+0x7e/0x130
[  133.951807]  get_signal+0x249/0x13c0
[  133.952404]  ? get_signal+0x5/0x13c0
[  133.953054]  arch_do_signal_or_restart+0xb7/0x7e0
[  133.953874]  ? arch_do_signal_or_restart+0x5/0x7e0
[  133.954690]  exit_to_user_mode_prepare+0x154/0x240
[  133.955434]  syscall_exit_to_user_mode+0x2b/0x60
[  133.956140]  do_syscall_64+0x46/0x80
[  133.956706]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  133.957447] RIP: 0033:0x7fac0740459d
[  133.957998] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  133.958928] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  133.960013] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  133.961066] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  133.962083] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  133.963101] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  133.964100] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  133.965330] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  133.965447] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  133.966290] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  133.966302] Call Trace:
[  133.966310]  dump_stack_lvl+0xa4/0xd3
[  133.966332]  dump_stack+0x15/0x17
[  133.966347]  check_preemption_disabled+0x167/0x180
[  133.966366]  ? rcu_gp_fqs_loop+0x2b4/0x410
[  133.966380]  ? prepare_to_swait_exclusive+0x90/0x90
[  133.967431] caller is debug_smp_processor_id+0x1c/0x20
[  133.968787]  debug_smp_processor_id+0x1c/0x20
[  133.972937]  perf_ftrace_function_call+0x7c/0x360
[  133.973545]  ? trace_hardirqs_on+0x3f/0x170
[  133.974082]  ? preempt_count_sub+0x5/0xa0
[  133.974616]  ? preempt_count_sub+0x5/0xa0
[  133.975125]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[  133.975776]  ? write_comp_data+0x2f/0x90
[  133.976293]  0xffffffffa0098099
[  133.976703]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  133.977306]  ? del_timer_sync+0xde/0x130
[  133.977833]  ? prepare_to_swait_event+0x5/0xf0
[  133.978420]  ? i915_init_ggtt+0x40/0x6b0
[  133.978921]  prepare_to_swait_event+0x5/0xf0
[  133.979459]  rcu_gp_fqs_loop+0x2b4/0x410
[  133.979955]  ? prepare_to_swait_event+0x5/0xf0
[  133.980521]  ? rcu_gp_fqs_loop+0x2b4/0x410
[  133.981047]  ? rcu_gp_init+0x730/0x730
[  133.981524]  rcu_gp_kthread+0xdd/0x170
[  133.982007]  kthread+0x1e7/0x230
[  133.982437]  ? set_kthread_struct+0x80/0x80
[  133.982973]  ret_from_fork+0x1f/0x30
[  133.983467] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  133.983516] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[  133.984522] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  133.985483] caller is debug_smp_processor_id+0x1c/0x20
[  133.987049] Call Trace:
[  133.987084]  dump_stack_lvl+0xa4/0xd3
[  133.988632]  dump_stack+0x15/0x17
[  133.989155]  check_preemption_disabled+0x167/0x180
[  133.989928]  debug_smp_processor_id+0x1c/0x20
[  133.990601]  perf_swevent_get_recursion_context+0x1e/0xd0
[  133.991455]  perf_trace_buf_alloc+0x3d/0x100
[  133.992105]  ? text_poke_bp_batch+0xf5/0x2c0
[  133.992750]  ? apply_paravirt+0x150/0x150
[  133.993373]  perf_ftrace_function_call+0x209/0x360
[  133.994310]  ? 0xffffffffa0098099
[  133.994948]  0xffffffffa0098099
[  133.995452]  ? _raw_spin_unlock+0x2c/0x50
[  133.996067]  ? write_comp_data+0x2f/0x90
[  133.996724]  ? i915_error_puts.part.21+0x1/0x90
[  133.997442]  ? i915_error_puts.part.21+0x1/0x90
[  133.998131]  ? text_poke+0x5/0x60
[  133.998704]  text_poke+0x5/0x60
[  133.999204]  text_poke_bp_batch+0xf5/0x2c0
[  133.999828]  ? text_poke+0x5/0x60
[  134.000349]  ? text_poke_bp_batch+0xf5/0x2c0
[  134.001104]  ? failsafe_emulate_mmio_rw.part.5+0x180/0x180
[  134.002017]  text_poke_queue+0xa7/0xc0
[  134.002715]  ftrace_replace_code+0xfd/0x170
[  134.003449]  ftrace_modify_all_code+0x1b1/0x270
[  134.004183]  arch_ftrace_update_code+0x9/0x10
[  134.004860]  ftrace_run_update_code+0x30/0xa0
[  134.005553]  ftrace_shutdown+0x2b8/0x4a0
[  134.006241]  unregister_ftrace_function+0x25/0x50
[  134.006960]  perf_ftrace_event_register+0x89/0xf0
[  134.007677]  ? perf_tp_event_init+0xa0/0xa0
[  134.008355]  perf_trace_destroy+0x37/0x60
[  134.008992]  tp_perf_event_destroy+0x15/0x20
[  134.009664]  _free_event+0xfc/0x7d0
[  134.010296]  put_event+0x37/0x50
[  134.010838]  perf_event_release_kernel+0x2f4/0x370
[  134.011631]  ? perf_event_release_kernel+0x370/0x370
[  134.012416]  perf_release+0x19/0x20
[  134.012990]  __fput+0x12d/0x460
[  134.013600]  ____fput+0x1a/0x20
[  134.014125]  task_work_run+0x8e/0xf0
[  134.014794]  do_exit+0x616/0x1310
[  134.015381]  ? write_comp_data+0x2f/0x90
[  134.016070]  do_group_exit+0x7e/0x130
[  134.016720]  get_signal+0x249/0x13c0
[  134.017335]  ? get_signal+0x5/0x13c0
[  134.017998]  arch_do_signal_or_restart+0xb7/0x7e0
[  134.018854]  ? arch_do_signal_or_restart+0x5/0x7e0
[  134.019680]  exit_to_user_mode_prepare+0x154/0x240
[  134.020440]  syscall_exit_to_user_mode+0x2b/0x60
[  134.021156]  do_syscall_64+0x46/0x80
[  134.021732]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  134.022497] RIP: 0033:0x7fac0740459d
[  134.023057] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  134.023984] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  134.025093] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  134.026139] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  134.027174] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  134.028211] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  134.029241] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  134.030508] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  134.030628] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  134.031458] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  134.032447] caller is debug_smp_processor_id+0x1c/0x20
[  134.033795] Call Trace:
[  134.033806]  dump_stack_lvl+0xa4/0xd3
[  134.035253]  dump_stack+0x15/0x17
[  134.035679]  check_preemption_disabled+0x167/0x180
[  134.036297]  ? rcu_gp_fqs_loop+0x2bd/0x410
[  134.036816]  ? rcu_pm_notify+0x40/0x40
[  134.037294]  debug_smp_processor_id+0x1c/0x20
[  134.037842]  perf_ftrace_function_call+0x7c/0x360
[  134.038445]  ? prepare_to_swait_event+0xbb/0xf0
[  134.039015]  ? 0xffffffffa0098099
[  134.039440]  ? 0xffffffffa0098099
[  134.039865]  ? 0xffffffffa0098099
[  134.040300]  ? 0xffffffffa0098099
[  134.040733]  0xffffffffa0098099
[  134.041136]  ? trace_hardirqs_on+0x3f/0x170
[  134.041667]  ? preempt_count_sub+0x5/0xa0
[  134.042193]  ? rcu_gp_fqs_check_wake+0x5/0x50
[  134.042739]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[  134.043362]  rcu_gp_fqs_check_wake+0x5/0x50
[  134.043887]  rcu_gp_fqs_loop+0x2bd/0x410
[  134.044390]  ? rcu_gp_fqs_check_wake+0x5/0x50
[  134.044933]  ? rcu_gp_fqs_loop+0x2bd/0x410
[  134.045488]  ? rcu_gp_init+0x730/0x730
[  134.045966]  rcu_gp_kthread+0xdd/0x170
[  134.046479]  kthread+0x1e7/0x230
[  134.046921]  ? set_kthread_struct+0x80/0x80
[  134.047458]  ret_from_fork+0x1f/0x30
[  134.047953] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  134.048932] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  134.050401] Call Trace:
[  134.050759]  dump_stack_lvl+0xa4/0xd3
[  134.051288]  dump_stack+0x15/0x17
[  134.051756]  check_preemption_disabled+0x167/0x180
[  134.052479]  debug_smp_processor_id+0x1c/0x20
[  134.053103]  perf_trace_buf_alloc+0x98/0x100
[  134.053727]  ? text_poke_bp_batch+0xf5/0x2c0
[  134.054353]  ? apply_paravirt+0x150/0x150
[  134.054944]  perf_ftrace_function_call+0x209/0x360
[  134.055719]  ? 0xffffffffa0098099
[  134.056270]  0xffffffffa0098099
[  134.056725]  ? _raw_spin_unlock+0x2c/0x50
[  134.057283]  ? write_comp_data+0x2f/0x90
[  134.057862]  ? i915_error_puts.part.21+0x1/0x90
[  134.058543]  ? i915_error_puts.part.21+0x1/0x90
[  134.059206]  ? text_poke+0x5/0x60
[  134.059741]  text_poke+0x5/0x60
[  134.060216]  text_poke_bp_batch+0xf5/0x2c0
[  134.060787]  ? text_poke+0x5/0x60
[  134.061272]  ? text_poke_bp_batch+0xf5/0x2c0
[  134.061909]  ? failsafe_emulate_mmio_rw.part.5+0x180/0x180
[  134.062747]  text_poke_queue+0xa7/0xc0
[  134.063324]  ftrace_replace_code+0xfd/0x170
[  134.063977]  ftrace_modify_all_code+0x1b1/0x270
[  134.064658]  arch_ftrace_update_code+0x9/0x10
[  134.065286]  ftrace_run_update_code+0x30/0xa0
[  134.065925]  ftrace_shutdown+0x2b8/0x4a0
[  134.066553]  unregister_ftrace_function+0x25/0x50
[  134.067236]  perf_ftrace_event_register+0x89/0xf0
[  134.067916]  ? perf_tp_event_init+0xa0/0xa0
[  134.068535]  perf_trace_destroy+0x37/0x60
[  134.069133]  tp_perf_event_destroy+0x15/0x20
[  134.069771]  _free_event+0xfc/0x7d0
[  134.070446]  put_event+0x37/0x50
[  134.070975]  perf_event_release_kernel+0x2f4/0x370
[  134.071752]  ? perf_event_release_kernel+0x370/0x370
[  134.072487]  perf_release+0x19/0x20
[  134.073007]  __fput+0x12d/0x460
[  134.073502]  ____fput+0x1a/0x20
[  134.073954]  task_work_run+0x8e/0xf0
[  134.074498]  do_exit+0x616/0x1310
[  134.074994]  ? write_comp_data+0x2f/0x90
[  134.075571]  do_group_exit+0x7e/0x130
[  134.076107]  get_signal+0x249/0x13c0
[  134.076634]  ? get_signal+0x5/0x13c0
[  134.077180]  arch_do_signal_or_restart+0xb7/0x7e0
[  134.077882]  ? arch_do_signal_or_restart+0x5/0x7e0
[  134.078593]  exit_to_user_mode_prepare+0x154/0x240
[  134.079265]  syscall_exit_to_user_mode+0x2b/0x60
[  134.079935]  do_syscall_64+0x46/0x80
[  134.080468]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  134.081148] RIP: 0033:0x7fac0740459d
[  134.081643] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  134.082506] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  134.083499] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  134.084426] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  134.085361] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  134.086317] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  134.087284] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  138.770057] check_preemption_disabled: 1547879 callbacks suppressed
[  138.770078] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  138.770149] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[  138.770958] caller is debug_smp_processor_id+0x1c/0x20
[  138.771889] caller is debug_smp_processor_id+0x1c/0x20
[  138.772913] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  138.775118] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  138.776568] Call Trace:
[  138.776920]  dump_stack_lvl+0xa4/0xd3
[  138.777446]  dump_stack+0x15/0x17
[  138.777912]  check_preemption_disabled+0x167/0x180
[  138.778589]  debug_smp_processor_id+0x1c/0x20
[  138.779183]  perf_trace_buf_alloc+0x98/0x100
[  138.779768]  ? text_poke+0x2b/0x60
[  138.780238]  ? do_sync_core+0x30/0x30
[  138.780750]  perf_ftrace_function_call+0x209/0x360
[  138.781499]  ? 0xffffffffa0098099
[  138.781986]  ? sendmsg_copy_msghdr+0x1/0x80
[  138.782607]  0xffffffffa0098099
[  138.783077]  ? _raw_spin_unlock+0x2c/0x50
[  138.783636]  ? sendmsg_copy_msghdr+0x1/0x80
[  138.784226]  ? sendmsg_copy_msghdr+0x1/0x80
[  138.784801]  ? __text_poke+0x5/0x4e0
[  138.785299]  ? lock_is_held_type+0xe2/0x140
[  138.785883]  __text_poke+0x5/0x4e0
[  138.786365]  text_poke+0x2b/0x60
[  138.786820]  ? __text_poke+0x5/0x4e0
[  138.787310]  ? text_poke+0x2b/0x60
[  138.787801]  text_poke_bp_batch+0xf5/0x2c0
[  138.788383]  ? skb_free_head+0x100/0x100
[  138.788945]  text_poke_queue+0xa7/0xc0
[  138.789485]  ftrace_replace_code+0xfd/0x170
[  138.790084]  ftrace_modify_all_code+0x1b1/0x270
[  138.790723]  arch_ftrace_update_code+0x9/0x10
[  138.791316]  ftrace_run_update_code+0x30/0xa0
[  138.791919]  ftrace_shutdown+0x2b8/0x4a0
[  138.792489]  unregister_ftrace_function+0x25/0x50
[  138.793131]  perf_ftrace_event_register+0x89/0xf0
[  138.793767]  ? perf_tp_event_init+0xa0/0xa0
[  138.794344]  perf_trace_destroy+0x37/0x60
[  138.794902]  tp_perf_event_destroy+0x15/0x20
[  138.795490]  _free_event+0xfc/0x7d0
[  138.796001]  put_event+0x37/0x50
[  138.796464]  perf_event_release_kernel+0x2f4/0x370
[  138.797140]  ? perf_event_release_kernel+0x370/0x370
[  138.797817]  perf_release+0x19/0x20
[  138.798311]  __fput+0x12d/0x460
[  138.798804]  ____fput+0x1a/0x20
[  138.799253]  task_work_run+0x8e/0xf0
[  138.799778]  do_exit+0x616/0x1310
[  138.800270]  ? write_comp_data+0x2f/0x90
[  138.800847]  do_group_exit+0x7e/0x130
[  138.801382]  get_signal+0x249/0x13c0
[  138.801900]  ? get_signal+0x5/0x13c0
[  138.802446]  arch_do_signal_or_restart+0xb7/0x7e0
[  138.803139]  ? arch_do_signal_or_restart+0x5/0x7e0
[  138.803831]  exit_to_user_mode_prepare+0x154/0x240
[  138.804488]  syscall_exit_to_user_mode+0x2b/0x60
[  138.805121]  do_syscall_64+0x46/0x80
[  138.805622]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  138.806306] RIP: 0033:0x7fac0740459d
[  138.806799] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  138.807640] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  138.808627] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  138.809548] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  138.810469] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  138.811387] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  138.812304] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  138.813334] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  138.813449] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  138.814282] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  138.814294] Call Trace:
[  138.814304]  dump_stack_lvl+0xa4/0xd3
[  138.814327]  dump_stack+0x15/0x17
[  138.814342]  check_preemption_disabled+0x167/0x180
[  138.814360]  ? schedule_timeout+0x34e/0x610
[  138.814375]  ? do_init_timer+0xa0/0xa0
[  138.815332] caller is debug_smp_processor_id+0x1c/0x20
[  138.816693]  debug_smp_processor_id+0x1c/0x20
[  138.820570]  perf_ftrace_function_call+0x7c/0x360
[  138.821166]  ? 0xffffffffa0098099
[  138.821589]  ? __this_cpu_preempt_check+0x1c/0x20
[  138.822197]  ? finish_task_switch+0xab/0x2a0
[  138.822733]  ? __schedule+0x46e/0xb20
[  138.823216]  0xffffffffa0098099
[  138.823621]  ? finish_task_switch+0xb0/0x2a0
[  138.824175]  ? del_timer_sync+0x5/0x130
[  138.824669]  del_timer_sync+0x5/0x130
[  138.825135]  schedule_timeout+0x34e/0x610
[  138.825643]  ? del_timer_sync+0x5/0x130
[  138.826130]  ? schedule_timeout+0x34e/0x610
[  138.826667]  ? del_timer_sync+0x130/0x130
[  138.827182]  ? i915_init_ggtt+0x40/0x6b0
[  138.827693]  rcu_gp_fqs_loop+0x2a0/0x410
[  138.828200]  ? rcu_gp_init+0x730/0x730
[  138.828675]  rcu_gp_kthread+0xdd/0x170
[  138.829160]  kthread+0x1e7/0x230
[  138.829579]  ? set_kthread_struct+0x80/0x80
[  138.830113]  ret_from_fork+0x1f/0x30
[  138.830609] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  138.830641] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[  138.831554] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  138.832516] caller is debug_smp_processor_id+0x1c/0x20
[  138.833945] Call Trace:
[  138.834913]  dump_stack_lvl+0xa4/0xd3
[  138.835441]  dump_stack+0x15/0x17
[  138.835908]  check_preemption_disabled+0x167/0x180
[  138.836586]  debug_smp_processor_id+0x1c/0x20
[  138.837184]  perf_swevent_put_recursion_context+0x1b/0x40
[  138.837920]  perf_tp_event+0x331/0x4e0
[  138.838523]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[  138.839315]  ? arch_local_irq_enable+0x10/0x12
[  138.839922]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  138.840571]  ? dump_stack_lvl+0xcc/0xd3
[  138.841118]  ? dump_stack+0x15/0x17
[  138.841606]  ? check_preemption_disabled+0x167/0x180
[  138.842292]  ? text_poke+0x2b/0x60
[  138.842762]  ? do_sync_core+0x30/0x30
[  138.843281]  perf_ftrace_function_call+0x248/0x360
[  138.843930]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  138.844567]  ? perf_ftrace_function_call+0x248/0x360
[  138.845345]  ? 0xffffffffa0098099
[  138.845832]  ? sendmsg_copy_msghdr+0x1/0x80
[  138.846431]  0xffffffffa0098099
[  138.846902]  ? _raw_spin_unlock+0x2c/0x50
[  138.847463]  ? sendmsg_copy_msghdr+0x1/0x80
[  138.848054]  ? sendmsg_copy_msghdr+0x1/0x80
[  138.848629]  ? __text_poke+0x5/0x4e0
[  138.849128]  ? lock_is_held_type+0xe2/0x140
[  138.849713]  __text_poke+0x5/0x4e0
[  138.850192]  text_poke+0x2b/0x60
[  138.850646]  ? __text_poke+0x5/0x4e0
[  138.851138]  ? text_poke+0x2b/0x60
[  138.851629]  text_poke_bp_batch+0xf5/0x2c0
[  138.852213]  ? skb_free_head+0x100/0x100
[  138.852774]  text_poke_queue+0xa7/0xc0
[  138.853317]  ftrace_replace_code+0xfd/0x170
[  138.853916]  ftrace_modify_all_code+0x1b1/0x270
[  138.854555]  arch_ftrace_update_code+0x9/0x10
[  138.855150]  ftrace_run_update_code+0x30/0xa0
[  138.855754]  ftrace_shutdown+0x2b8/0x4a0
[  138.856326]  unregister_ftrace_function+0x25/0x50
[  138.856970]  perf_ftrace_event_register+0x89/0xf0
[  138.857609]  ? perf_tp_event_init+0xa0/0xa0
[  138.858186]  perf_trace_destroy+0x37/0x60
[  138.858744]  tp_perf_event_destroy+0x15/0x20
[  138.859333]  _free_event+0xfc/0x7d0
[  138.859846]  put_event+0x37/0x50
[  138.860311]  perf_event_release_kernel+0x2f4/0x370
[  138.860989]  ? perf_event_release_kernel+0x370/0x370
[  138.861668]  perf_release+0x19/0x20
[  138.862164]  __fput+0x12d/0x460
[  138.862658]  ____fput+0x1a/0x20
[  138.863108]  task_work_run+0x8e/0xf0
[  138.863632]  do_exit+0x616/0x1310
[  138.864125]  ? write_comp_data+0x2f/0x90
[  138.864703]  do_group_exit+0x7e/0x130
[  138.865240]  get_signal+0x249/0x13c0
[  138.865759]  ? get_signal+0x5/0x13c0
[  138.866307]  arch_do_signal_or_restart+0xb7/0x7e0
[  138.867003]  ? arch_do_signal_or_restart+0x5/0x7e0
[  138.867697]  exit_to_user_mode_prepare+0x154/0x240
[  138.868354]  syscall_exit_to_user_mode+0x2b/0x60
[  138.868988]  do_syscall_64+0x46/0x80
[  138.869491]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  138.870172] RIP: 0033:0x7fac0740459d
[  138.870664] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  138.871507] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  138.872507] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  138.873428] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  138.874350] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  138.875272] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  138.876194] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  138.877227] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  138.877336] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  138.878173] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  138.878184] Call Trace:
[  138.878192]  dump_stack_lvl+0xa4/0xd3
[  138.878213]  dump_stack+0x15/0x17
[  138.878228]  check_preemption_disabled+0x167/0x180
[  138.878246]  ? del_timer_sync+0xd3/0x130
[  138.878262]  ? detach_if_pending+0x270/0x270
[  138.879307] caller is debug_smp_processor_id+0x1c/0x20
[  138.880666]  debug_smp_processor_id+0x1c/0x20
[  138.884614]  perf_ftrace_function_call+0x7c/0x360
[  138.885203]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  138.885797]  ? register_lock_class+0x42/0x440
[  138.886355]  ? del_timer_sync+0x40/0x130
[  138.886858]  ? 0xffffffffa0098099
[  138.887283]  ? 0xffffffffa0098099
[  138.887709]  ? 0xffffffffa0098099
[  138.888147]  0xffffffffa0098099
[  138.888549]  ? __this_cpu_preempt_check+0x1c/0x20
[  138.889151]  ? del_timer_sync+0xa5/0x130
[  138.889653]  ? try_to_del_timer_sync+0x5/0x90
[  138.890204]  ? write_comp_data+0x2f/0x90
[  138.890704]  try_to_del_timer_sync+0x5/0x90
[  138.891233]  del_timer_sync+0xd3/0x130
[  138.891711]  ? try_to_del_timer_sync+0x5/0x90
[  138.892257]  ? del_timer_sync+0xd3/0x130
[  138.892760]  schedule_timeout+0x34e/0x610
[  138.893277]  ? del_timer_sync+0x130/0x130
[  138.893791]  ? i915_init_ggtt+0x40/0x6b0
[  138.894304]  rcu_gp_fqs_loop+0x2a0/0x410
[  138.894811]  ? rcu_gp_init+0x730/0x730
[  138.895287]  rcu_gp_kthread+0xdd/0x170
[  138.895771]  kthread+0x1e7/0x230
[  138.896189]  ? set_kthread_struct+0x80/0x80
[  138.896724]  ret_from_fork+0x1f/0x30
[  138.897216] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  138.897262] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[  138.898249] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  138.899229] caller is debug_smp_processor_id+0x1c/0x20
[  138.900778] Call Trace:
[  138.901782]  dump_stack_lvl+0xa4/0xd3
[  138.902387]  dump_stack+0x15/0x17
[  138.902911]  check_preemption_disabled+0x167/0x180
[  138.903629]  ? __text_poke+0xea/0x4e0
[  138.904186]  ? __pmd_alloc+0x420/0x420
[  138.904787]  debug_smp_processor_id+0x1c/0x20
[  138.905450]  perf_ftrace_function_call+0x7c/0x360
[  138.906183]  ? text_poke+0x2b/0x60
[  138.906705]  ? do_sync_core+0x30/0x30
[  138.907294]  ? perf_ftrace_function_call+0x248/0x360
[  138.908034]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  138.908740]  ? text_poke+0x2b/0x60
[  138.909273]  ? perf_ftrace_function_call+0x4c/0x360
[  138.910136]  ? sendmsg_copy_msghdr+0x1/0x80
[  138.910796]  0xffffffffa0098099
[  138.911312]  ? 0xffffffffa0098099
[  138.911966]  ? __get_locked_pte+0x5/0x290
[  138.912621]  __get_locked_pte+0x5/0x290
[  138.913212]  __text_poke+0xea/0x4e0
[  138.913757]  ? __get_locked_pte+0x5/0x290
[  138.914362]  ? __text_poke+0xea/0x4e0
[  138.914936]  ? sendmsg_copy_msghdr+0x1/0x80
[  138.915595]  ? lock_is_held_type+0xe2/0x140
[  138.916242]  ? sendmsg_copy_msghdr+0x1/0x80
[  138.916923]  text_poke+0x2b/0x60
[  138.917467]  text_poke_bp_batch+0xf5/0x2c0
[  138.918139]  ? skb_free_head+0x100/0x100
[  138.918785]  text_poke_queue+0xa7/0xc0
[  138.919408]  ftrace_replace_code+0xfd/0x170
[  138.920099]  ftrace_modify_all_code+0x1b1/0x270
[  138.920825]  arch_ftrace_update_code+0x9/0x10
[  138.921486]  ftrace_run_update_code+0x30/0xa0
[  138.922171]  ftrace_shutdown+0x2b8/0x4a0
[  138.922838]  unregister_ftrace_function+0x25/0x50
[  138.923554]  perf_ftrace_event_register+0x89/0xf0
[  138.924267]  ? perf_tp_event_init+0xa0/0xa0
[  138.924904]  perf_trace_destroy+0x37/0x60
[  138.925531]  tp_perf_event_destroy+0x15/0x20
[  138.926195]  _free_event+0xfc/0x7d0
[  138.926794]  put_event+0x37/0x50
[  138.927326]  perf_event_release_kernel+0x2f4/0x370
[  138.928107]  ? perf_event_release_kernel+0x370/0x370
[  138.928869]  perf_release+0x19/0x20
[  138.929425]  __fput+0x12d/0x460
[  138.930023]  ____fput+0x1a/0x20
[  138.930537]  task_work_run+0x8e/0xf0
[  138.931148]  do_exit+0x616/0x1310
[  138.931726]  ? write_comp_data+0x2f/0x90
[  138.932403]  do_group_exit+0x7e/0x130
[  138.933027]  get_signal+0x249/0x13c0
[  138.933627]  ? get_signal+0x5/0x13c0
[  138.934282]  arch_do_signal_or_restart+0xb7/0x7e0
[  138.935107]  ? arch_do_signal_or_restart+0x5/0x7e0
[  138.935919]  exit_to_user_mode_prepare+0x154/0x240
[  138.936657]  syscall_exit_to_user_mode+0x2b/0x60
[  138.937365]  do_syscall_64+0x46/0x80
[  138.937933]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  138.938681] RIP: 0033:0x7fac0740459d
[  138.939231] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  138.940152] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  138.941234] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  138.942241] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  138.943245] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  138.944248] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  138.945250] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  138.946480] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  138.946589] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  138.947423] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  138.948472] caller is debug_smp_processor_id+0x1c/0x20
[  138.949825] Call Trace:
[  138.949834]  dump_stack_lvl+0xa4/0xd3
[  138.951309]  dump_stack+0x15/0x17
[  138.951736]  check_preemption_disabled+0x167/0x180
[  138.952339]  ? try_to_del_timer_sync+0x33/0x90
[  138.952896]  ? calc_wheel_index+0x2d0/0x2d0
[  138.953429]  debug_smp_processor_id+0x1c/0x20
[  138.953979]  perf_ftrace_function_call+0x7c/0x360
[  138.954573]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  138.955162]  ? del_timer_sync+0xd3/0x130
[  138.955659]  ? perf_ftrace_function_call+0x4c/0x360
[  138.956266]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  138.956861]  ? register_lock_class+0x42/0x440
[  138.957412]  ? del_timer_sync+0x40/0x130
[  138.957913]  ? 0xffffffffa0098099
[  138.958342]  ? 0xffffffffa0098099
[  138.958775]  0xffffffffa0098099
[  138.959183]  ? 0xffffffffa0098099
[  138.959606]  ? __this_cpu_preempt_check+0x1c/0x20
[  138.960199]  ? del_timer_sync+0xa5/0x130
[  138.960701]  ? lock_timer_base+0x5/0x100
[  138.961205]  lock_timer_base+0x5/0x100
[  138.961681]  try_to_del_timer_sync+0x33/0x90
[  138.962223]  ? lock_timer_base+0x5/0x100
[  138.962719]  ? try_to_del_timer_sync+0x33/0x90
[  138.963278]  ? try_to_del_timer_sync+0x5/0x90
[  138.963833]  del_timer_sync+0xd3/0x130
[  138.964316]  schedule_timeout+0x34e/0x610
[  138.964835]  ? del_timer_sync+0x130/0x130
[  138.965350]  ? i915_init_ggtt+0x40/0x6b0
[  138.965868]  rcu_gp_fqs_loop+0x2a0/0x410
[  138.966384]  ? rcu_gp_init+0x730/0x730
[  138.966861]  rcu_gp_kthread+0xdd/0x170
[  138.967344]  kthread+0x1e7/0x230
[  138.967763]  ? set_kthread_struct+0x80/0x80
[  138.968298]  ret_from_fork+0x1f/0x30
[  138.968790] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  138.968819] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[  138.969821] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  138.970806] caller is debug_smp_processor_id+0x1c/0x20
[  138.972343] Call Trace:
[  138.973345]  dump_stack_lvl+0xa4/0xd3
[  138.973949]  dump_stack+0x15/0x17
[  138.974477]  check_preemption_disabled+0x167/0x180
[  138.975252]  debug_smp_processor_id+0x1c/0x20
[  138.975919]  perf_swevent_get_recursion_context+0x1e/0xd0
[  138.976777]  perf_trace_buf_alloc+0x3d/0x100
[  138.977430]  ? __text_poke+0xea/0x4e0
[  138.977987]  ? __pmd_alloc+0x420/0x420
[  138.978585]  perf_ftrace_function_call+0x209/0x360
[  138.979516]  ? 0xffffffffa0098099
[  138.980111]  ? sendmsg_copy_msghdr+0x1/0x80
[  138.980775]  0xffffffffa0098099
[  138.981294]  ? 0xffffffffa0098099
[  138.981959]  ? __get_locked_pte+0x5/0x290
[  138.982627]  __get_locked_pte+0x5/0x290
[  138.983223]  __text_poke+0xea/0x4e0
[  138.983770]  ? __get_locked_pte+0x5/0x290
[  138.984375]  ? __text_poke+0xea/0x4e0
[  138.984945]  ? sendmsg_copy_msghdr+0x1/0x80
[  138.985609]  ? lock_is_held_type+0xe2/0x140
[  138.986266]  ? sendmsg_copy_msghdr+0x1/0x80
[  138.986952]  text_poke+0x2b/0x60
[  138.987499]  text_poke_bp_batch+0xf5/0x2c0
[  138.988172]  ? skb_free_head+0x100/0x100
[  138.988821]  text_poke_queue+0xa7/0xc0
[  138.989450]  ftrace_replace_code+0xfd/0x170
[  138.990148]  ftrace_modify_all_code+0x1b1/0x270
[  138.990877]  arch_ftrace_update_code+0x9/0x10
[  138.991543]  ftrace_run_update_code+0x30/0xa0
[  138.992228]  ftrace_shutdown+0x2b8/0x4a0
[  138.992900]  unregister_ftrace_function+0x25/0x50
[  138.993620]  perf_ftrace_event_register+0x89/0xf0
[  138.994342]  ? perf_tp_event_init+0xa0/0xa0
[  138.994982]  perf_trace_destroy+0x37/0x60
[  138.995611]  tp_perf_event_destroy+0x15/0x20
[  138.996273]  _free_event+0xfc/0x7d0
[  138.996874]  put_event+0x37/0x50
[  138.997409]  perf_event_release_kernel+0x2f4/0x370
[  138.998236]  ? perf_event_release_kernel+0x370/0x370
[  138.999001]  perf_release+0x19/0x20
[  138.999560]  __fput+0x12d/0x460
[  139.000162]  ____fput+0x1a/0x20
[  139.000675]  task_work_run+0x8e/0xf0
[  139.001289]  do_exit+0x616/0x1310
[  139.001870]  ? write_comp_data+0x2f/0x90
[  139.002561]  do_group_exit+0x7e/0x130
[  139.003189]  get_signal+0x249/0x13c0
[  139.003791]  ? get_signal+0x5/0x13c0
[  139.004447]  arch_do_signal_or_restart+0xb7/0x7e0
[  139.005275]  ? arch_do_signal_or_restart+0x5/0x7e0
[  139.006093]  exit_to_user_mode_prepare+0x154/0x240
[  139.006845]  syscall_exit_to_user_mode+0x2b/0x60
[  139.007554]  do_syscall_64+0x46/0x80
[  139.008123]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  139.008868] RIP: 0033:0x7fac0740459d
[  139.009419] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  139.010356] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  139.011446] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  139.012452] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  139.013459] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  139.014476] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  139.015481] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  139.016715] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  139.016823] BUG: using smp_processor_id() in preemptible [00000000] code: repro/578
[  139.017663] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  139.018730] caller is debug_smp_processor_id+0x1c/0x20
[  139.019998] Call Trace:
[  139.020969]  dump_stack_lvl+0xa4/0xd3
[  139.021441]  dump_stack+0x15/0x17
[  139.021867]  check_preemption_disabled+0x167/0x180
[  139.022472]  ? rcu_gp_fqs_loop+0x2b4/0x410
[  139.022989]  ? prepare_to_swait_exclusive+0x90/0x90
[  139.023601]  debug_smp_processor_id+0x1c/0x20
[  139.024151]  perf_ftrace_function_call+0x7c/0x360
[  139.024749]  ? trace_hardirqs_on+0x3f/0x170
[  139.025284]  ? preempt_count_sub+0x5/0xa0
[  139.025797]  ? preempt_count_sub+0x5/0xa0
[  139.026307]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[  139.026932]  ? write_comp_data+0x2f/0x90
[  139.027440]  0xffffffffa0098099
[  139.027841]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  139.028442]  ? del_timer_sync+0xde/0x130
[  139.028944]  ? prepare_to_swait_event+0x5/0xf0
[  139.029504]  ? i915_init_ggtt+0x40/0x6b0
[  139.030005]  prepare_to_swait_event+0x5/0xf0
[  139.030546]  rcu_gp_fqs_loop+0x2b4/0x410
[  139.031042]  ? prepare_to_swait_event+0x5/0xf0
[  139.031599]  ? rcu_gp_fqs_loop+0x2b4/0x410
[  139.032127]  ? rcu_gp_init+0x730/0x730
[  139.032604]  rcu_gp_kthread+0xdd/0x170
[  139.033087]  kthread+0x1e7/0x230
[  139.033504]  ? set_kthread_struct+0x80/0x80
[  139.034039]  ret_from_fork+0x1f/0x30
[  139.034534] CPU: 0 PID: 578 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  139.034567] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[  139.035481] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  139.036447] caller is debug_smp_processor_id+0x1c/0x20
[  139.037880] Call Trace:
[  139.038852]  dump_stack_lvl+0xa4/0xd3
[  139.039378]  dump_stack+0x15/0x17
[  139.039844]  check_preemption_disabled+0x167/0x180
[  139.040519]  debug_smp_processor_id+0x1c/0x20
[  139.041112]  perf_trace_buf_alloc+0x98/0x100
[  139.041697]  ? __text_poke+0xea/0x4e0
[  139.042204]  ? __pmd_alloc+0x420/0x420
[  139.042727]  perf_ftrace_function_call+0x209/0x360
[  139.043477]  ? 0xffffffffa0098099
[  139.043976]  ? sendmsg_copy_msghdr+0x1/0x80
[  139.044562]  0xffffffffa0098099
[  139.045013]  ? 0xffffffffa0098099
[  139.045541]  ? __get_locked_pte+0x5/0x290
[  139.046112]  __get_locked_pte+0x5/0x290
[  139.046648]  __text_poke+0xea/0x4e0
[  139.047133]  ? __get_locked_pte+0x5/0x290
[  139.047677]  ? __text_poke+0xea/0x4e0
[  139.048184]  ? sendmsg_copy_msghdr+0x1/0x80
[  139.048767]  ? lock_is_held_type+0xe2/0x140
[  139.049345]  ? sendmsg_copy_msghdr+0x1/0x80
[  139.049940]  text_poke+0x2b/0x60
[  139.050414]  text_poke_bp_batch+0xf5/0x2c0
[  139.050997]  ? skb_free_head+0x100/0x100
[  139.051557]  text_poke_queue+0xa7/0xc0
[  139.052098]  ftrace_replace_code+0xfd/0x170
[  139.052695]  ftrace_modify_all_code+0x1b1/0x270
[  139.053329]  arch_ftrace_update_code+0x9/0x10
[  139.053921]  ftrace_run_update_code+0x30/0xa0
[  139.054529]  ftrace_shutdown+0x2b8/0x4a0
[  139.055099]  unregister_ftrace_function+0x25/0x50
[  139.055739]  perf_ftrace_event_register+0x89/0xf0
[  139.056376]  ? perf_tp_event_init+0xa0/0xa0
[  139.056948]  perf_trace_destroy+0x37/0x60
[  139.057505]  tp_perf_event_destroy+0x15/0x20
[  139.058094]  _free_event+0xfc/0x7d0
[  139.058610]  put_event+0x37/0x50
[  139.059073]  perf_event_release_kernel+0x2f4/0x370
[  139.059753]  ? perf_event_release_kernel+0x370/0x370
[  139.060431]  perf_release+0x19/0x20
[  139.060921]  __fput+0x12d/0x460
[  139.061413]  ____fput+0x1a/0x20
[  139.061863]  task_work_run+0x8e/0xf0
[  139.062390]  do_exit+0x616/0x1310
[  139.062883]  ? write_comp_data+0x2f/0x90
[  139.063459]  do_group_exit+0x7e/0x130
[  139.063995]  get_signal+0x249/0x13c0
[  139.064512]  ? get_signal+0x5/0x13c0
[  139.065056]  arch_do_signal_or_restart+0xb7/0x7e0
[  139.065749]  ? arch_do_signal_or_restart+0x5/0x7e0
[  139.066447]  exit_to_user_mode_prepare+0x154/0x240
[  139.067104]  syscall_exit_to_user_mode+0x2b/0x60
[  139.067739]  do_syscall_64+0x46/0x80
[  139.068242]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  139.068922] RIP: 0033:0x7fac0740459d
[  139.069414] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[  139.070267] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  139.071253] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[  139.072172] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  139.073090] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  139.074010] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  139.074943] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  139.075975] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  139.076926] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  139.078306] Call Trace:
[  139.078623]  dump_stack_lvl+0xa4/0xd3
[  139.079095]  dump_stack+0x15/0x17
[  139.079521]  check_preemption_disabled+0x167/0x180
[  139.080120]  ? rcu_gp_fqs_loop+0x2bd/0x410
[  139.080645]  ? rcu_pm_notify+0x40/0x40
[  139.081124]  debug_smp_processor_id+0x1c/0x20
[  139.081671]  perf_ftrace_function_call+0x7c/0x360
[  139.082265]  ? prepare_to_swait_event+0xbb/0xf0
[  139.082838]  ? 0xffffffffa0098099
[  139.083264]  ? 0xffffffffa0098099
[  139.083690]  ? 0xffffffffa0098099
[  139.084126]  ? 0xffffffffa0098099
[  139.084560]  0xffffffffa0098099
[  139.084964]  ? trace_hardirqs_on+0x3f/0x170
[  139.085499]  ? preempt_count_sub+0x5/0xa0
[  139.086016]  ? rcu_gp_fqs_check_wake+0x5/0x50
[  139.086566]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[  139.087189]  rcu_gp_fqs_check_wake+0x5/0x50
[  139.087716]  rcu_gp_fqs_loop+0x2bd/0x410
[  139.088222]  ? rcu_gp_fqs_check_wake+0x5/0x50
[  139.088767]  ? rcu_gp_fqs_loop+0x2bd/0x410
[  139.089294]  ? rcu_gp_init+0x730/0x730
[  139.089769]  rcu_gp_kthread+0xdd/0x170
[  139.090255]  kthread+0x1e7/0x230
[  139.090675]  ? set_kthread_struct+0x80/0x80
[  139.091210]  ret_from_fork+0x1f/0x30
[  143.773983] check_preemption_disabled: 2976713 callbacks suppressed
[  143.774001] BUG: using smp_processor_id() in preemptible [00000000] code: repro/579
[  143.774598] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[  143.774769] caller is debug_smp_processor_id+0x1c/0x20
[  143.775624] caller is debug_smp_processor_id+0x1c/0x20
[  143.776453] CPU: 1 PID: 579 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  143.778378] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  143.779618] Call Trace:
[  143.779906]  dump_stack_lvl+0xa4/0xd3
[  143.780335]  dump_stack+0x15/0x17
[  143.780721]  check_preemption_disabled+0x167/0x180
[  143.781265]  ? __text_poke+0xea/0x4e0
[  143.781687]  ? __pmd_alloc+0x420/0x420
[  143.782125]  debug_smp_processor_id+0x1c/0x20
[  143.782627]  perf_ftrace_function_call+0x7c/0x360
[  143.783201]  ? __printk_ratelimit+0x21/0x30
[  143.783730]  ? write_comp_data+0x2f/0x90
[  143.784225]  ? text_poke+0x2b/0x60
[  143.784657]  ? do_sync_core+0x30/0x30
[  143.785121]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  143.785708]  ? text_poke+0x2b/0x60
[  143.786145]  ? perf_ftrace_function_call+0x4c/0x360
[  143.786751]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  143.787339]  ? text_poke_bp_batch+0x1dc/0x2c0
[  143.787885]  ? perf_ftrace_function_call+0x4c/0x360
[  143.788505]  ? mmc_blk_ioctl_multi_cmd+0x440/0x440
[  143.789126]  0xffffffffa0098099
[  143.789553]  ? __get_locked_pte+0x5/0x290
[  143.790064]  __get_locked_pte+0x5/0x290
[  143.790553]  __text_poke+0xea/0x4e0
[  143.790997]  ? __get_locked_pte+0x5/0x290
[  143.791501]  ? __text_poke+0xea/0x4e0
[  143.791965]  ? mmc_blk_ioctl_multi_cmd+0x440/0x440
[  143.792569]  ? lock_is_held_type+0xe2/0x140
[  143.793097]  ? mmc_blk_ioctl_multi_cmd+0x440/0x440
[  143.793703]  text_poke+0x2b/0x60
[  143.794127]  text_poke_bp_batch+0x1dc/0x2c0
[  143.794664]  ? sdhci_pci_sd_cd+0x30/0x30
[  143.795166]  text_poke_queue+0xa7/0xc0
[  143.795648]  ftrace_replace_code+0xfd/0x170
[  143.796181]  ftrace_modify_all_code+0x1b1/0x270
[  143.796753]  arch_ftrace_update_code+0x9/0x10
[  143.797300]  ftrace_run_update_code+0x30/0xa0
[  143.797849]  ftrace_startup_enable+0x5e/0xa0
[  143.798391]  ftrace_startup+0x16d/0x240
[  143.798888]  register_ftrace_function+0x43/0x90
[  143.799458]  perf_ftrace_event_register+0xc1/0xf0
[  143.800051]  perf_trace_event_init+0xa0/0x4c0
[  143.800607]  perf_trace_init+0xda/0x160
[  143.801098]  perf_tp_event_init+0x57/0xa0
[  143.801608]  perf_try_init_event+0x83/0x270
[  143.802149]  perf_event_alloc+0xe3f/0x1c10
[  143.802665]  ? _raw_spin_unlock+0x2c/0x50
[  143.803174]  ? alloc_fd+0x20d/0x320
[  143.803635]  __do_sys_perf_event_open+0x3bf/0x1de0
[  143.804235]  ? write_comp_data+0x2f/0x90
[  143.804783]  __x64_sys_perf_event_open+0x26/0x30
[  143.805362]  do_syscall_64+0x37/0x80
[  143.805818]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  143.806450] RIP: 0033:0x7fac0740459d
[  143.806905] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  143.809123] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  143.810041] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  143.810906] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  143.811767] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  143.812629] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  143.813490] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  143.814390] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  143.814430] BUG: using smp_processor_id() in preemptible [00000000] code: repro/579
[  143.815280] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  143.816192] caller is debug_smp_processor_id+0x1c/0x20
[  143.817541] Call Trace:
[  143.818478]  dump_stack_lvl+0xa4/0xd3
[  143.818947]  dump_stack+0x15/0x17
[  143.819370]  check_preemption_disabled+0x167/0x180
[  143.819967]  ? do_nanosleep+0x123/0x2a0
[  143.820450]  ? ___might_sleep+0x170/0x170
[  143.820959]  debug_smp_processor_id+0x1c/0x20
[  143.821507]  perf_ftrace_function_call+0x7c/0x360
[  143.822101]  ? 0xffffffffa0098099
[  143.822527]  ? __this_cpu_preempt_check+0x1c/0x20
[  143.823129]  ? finish_task_switch+0xab/0x2a0
[  143.823662]  ? __schedule+0x46e/0xb20
[  143.824138]  ? do_nanosleep+0x9c/0x2a0
[  143.824617]  0xffffffffa0098099
[  143.825020]  ? finish_task_switch+0xb0/0x2a0
[  143.825566]  ? do_nanosleep+0x107/0x2a0
[  143.826056]  ? __might_sleep+0x5/0x70
[  143.826524]  ? write_comp_data+0x2f/0x90
[  143.827023]  __might_sleep+0x5/0x70
[  143.827466]  do_nanosleep+0x123/0x2a0
[  143.827931]  ? __might_sleep+0x5/0x70
[  143.828392]  ? do_nanosleep+0x123/0x2a0
[  143.828876]  ? write_comp_data+0x2f/0x90
[  143.829381]  hrtimer_nanosleep+0xf7/0x1b0
[  143.829898]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[  143.830480]  __x64_sys_nanosleep+0xfc/0x150
[  143.831017]  do_syscall_64+0x37/0x80
[  143.831471]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  143.832096] RIP: 0033:0x7fac073cca18
[  143.832547] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[  143.834766] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[  143.835686] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[  143.836543] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[  143.837403] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[  143.838272] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[  143.839130] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  143.840023] CPU: 1 PID: 579 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  143.840076] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[  143.840913] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  143.841821] caller is debug_smp_processor_id+0x1c/0x20
[  143.843181] Call Trace:
[  143.843192]  dump_stack_lvl+0xa4/0xd3
[  143.844579]  dump_stack+0x15/0x17
[  143.845004]  check_preemption_disabled+0x167/0x180
[  143.845603]  ? _raw_spin_lock+0x17/0x50
[  143.846087]  ? trace_sched_waking+0xc0/0xc0
[  143.846627]  debug_smp_processor_id+0x1c/0x20
[  143.847176]  perf_ftrace_function_call+0x7c/0x360
[  143.847765]  ? write_comp_data+0x2f/0x90
[  143.848260]  ? __text_poke+0xea/0x4e0
[  143.848725]  ? __pmd_alloc+0x420/0x420
[  143.849199]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  143.849786]  ? __text_poke+0xea/0x4e0
[  143.850255]  ? perf_ftrace_function_call+0x4c/0x360
[  143.850864]  ? __printk_ratelimit+0x21/0x30
[  143.851392]  ? write_comp_data+0x2f/0x90
[  143.851886]  ? text_poke+0x2b/0x60
[  143.852318]  ? do_sync_core+0x30/0x30
[  143.852783]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  143.853369]  ? text_poke+0x2b/0x60
[  143.853814]  0xffffffffa0098099
[  143.854230]  ? mmc_blk_ioctl_multi_cmd+0x440/0x440
[  143.854834]  ? pmd_page_vaddr+0x2b/0x70
[  143.855322]  ? preempt_count_add+0x5/0xc0
[  143.855833]  preempt_count_add+0x5/0xc0
[  143.856317]  _raw_spin_lock+0x17/0x50
[  143.856782]  ? preempt_count_add+0x5/0xc0
[  143.857284]  ? _raw_spin_lock+0x17/0x50
[  143.857771]  __get_locked_pte+0x1a2/0x290
[  143.858288]  ? mmc_blk_ioctl_multi_cmd+0x440/0x440
[  143.858890]  __text_poke+0xea/0x4e0
[  143.859333]  ? mmc_blk_ioctl_multi_cmd+0x440/0x440
[  143.859935]  ? lock_is_held_type+0xe2/0x140
[  143.860463]  ? mmc_blk_ioctl_multi_cmd+0x440/0x440
[  143.861067]  text_poke+0x2b/0x60
[  143.861486]  text_poke_bp_batch+0x1dc/0x2c0
[  143.862019]  ? sdhci_pci_sd_cd+0x30/0x30
[  143.862523]  text_poke_queue+0xa7/0xc0
[  143.863005]  ftrace_replace_code+0xfd/0x170
[  143.863538]  ftrace_modify_all_code+0x1b1/0x270
[  143.864110]  arch_ftrace_update_code+0x9/0x10
[  143.864653]  ftrace_run_update_code+0x30/0xa0
[  143.865202]  ftrace_startup_enable+0x5e/0xa0
[  143.865740]  ftrace_startup+0x16d/0x240
[  143.866239]  register_ftrace_function+0x43/0x90
[  143.866808]  perf_ftrace_event_register+0xc1/0xf0
[  143.867399]  perf_trace_event_init+0xa0/0x4c0
[  143.867954]  perf_trace_init+0xda/0x160
[  143.868444]  perf_tp_event_init+0x57/0xa0
[  143.868953]  perf_try_init_event+0x83/0x270
[  143.869489]  perf_event_alloc+0xe3f/0x1c10
[  143.870003]  ? _raw_spin_unlock+0x2c/0x50
[  143.870514]  ? alloc_fd+0x20d/0x320
[  143.870973]  __do_sys_perf_event_open+0x3bf/0x1de0
[  143.871571]  ? write_comp_data+0x2f/0x90
[  143.872117]  __x64_sys_perf_event_open+0x26/0x30
[  143.872695]  do_syscall_64+0x37/0x80
[  143.873150]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  143.873777] RIP: 0033:0x7fac0740459d
[  143.874230] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  143.876446] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  143.877363] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  143.878226] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  143.879084] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  143.879946] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  143.880806] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  143.881700] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  143.881735] BUG: using smp_processor_id() in preemptible [00000000] code: repro/579
[  143.882592] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  143.882602] Call Trace:
[  143.882609]  dump_stack_lvl+0xa4/0xd3
[  143.883525] caller is debug_smp_processor_id+0x1c/0x20
[  143.884880]  dump_stack+0x15/0x17
[  143.886653]  check_preemption_disabled+0x167/0x180
[  143.887250]  ? __might_sleep+0x48/0x70
[  143.887722]  ? sched_show_task+0x70/0x70
[  143.888217]  debug_smp_processor_id+0x1c/0x20
[  143.888762]  perf_ftrace_function_call+0x7c/0x360
[  143.889346]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  143.889931]  ? do_nanosleep+0x123/0x2a0
[  143.890418]  ? perf_ftrace_function_call+0x4c/0x360
[  143.891032]  ? 0xffffffffa0098099
[  143.891451]  ? __this_cpu_preempt_check+0x1c/0x20
[  143.892052]  ? finish_task_switch+0xab/0x2a0
[  143.892584]  ? __schedule+0x46e/0xb20
[  143.893051]  ? do_nanosleep+0x9c/0x2a0
[  143.893528]  0xffffffffa0098099
[  143.893927]  ? do_nanosleep+0x9c/0x2a0
[  143.894418]  ? do_nanosleep+0x107/0x2a0
[  143.894907]  ? ___might_sleep+0x5/0x170
[  143.895395]  ___might_sleep+0x5/0x170
[  143.895858]  __might_sleep+0x48/0x70
[  143.896311]  ? ___might_sleep+0x5/0x170
[  143.896795]  ? __might_sleep+0x48/0x70
[  143.897274]  do_nanosleep+0x123/0x2a0
[  143.897736]  ? write_comp_data+0x2f/0x90
[  143.898249]  hrtimer_nanosleep+0xf7/0x1b0
[  143.898759]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[  143.899339]  __x64_sys_nanosleep+0xfc/0x150
[  143.899874]  do_syscall_64+0x37/0x80
[  143.900328]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  143.900953] RIP: 0033:0x7fac073cca18
[  143.901402] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[  143.903626] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[  143.904542] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[  143.905400] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[  143.906269] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[  143.907128] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[  143.907987] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  143.908887] CPU: 1 PID: 579 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  143.908933] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[  143.909781] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  143.910721] caller is debug_smp_processor_id+0x1c/0x20
[  143.912064] Call Trace:
[  143.912993]  dump_stack_lvl+0xa4/0xd3
[  143.913464]  dump_stack+0x15/0x17
[  143.913889]  check_preemption_disabled+0x167/0x180
[  143.914498]  ? text_poke_bp_batch+0x1dc/0x2c0
[  143.915044]  ? apply_paravirt+0x150/0x150
[  143.915553]  debug_smp_processor_id+0x1c/0x20
[  143.916107]  perf_ftrace_function_call+0x7c/0x360
[  143.916703]  ? mmc_blk_ioctl_multi_cmd+0x440/0x440
[  143.917306]  ? 0xffffffffa0098099
[  143.917728]  ? __this_cpu_preempt_check+0x1c/0x20
[  143.918358]  0xffffffffa0098099
[  143.918758]  ? _raw_spin_unlock+0x2c/0x50
[  143.919271]  ? __text_poke+0x2f2/0x4e0
[  143.919746]  ? mmc_blk_ioctl_multi_cmd+0x440/0x440
[  143.920346]  ? mmc_rpmb_ioctl+0xa0/0xa0
[  143.920833]  ? text_poke+0x5/0x60
[  143.921268]  text_poke+0x5/0x60
[  143.921670]  text_poke_bp_batch+0x1dc/0x2c0
[  143.922206]  ? text_poke+0x5/0x60
[  143.922627]  ? text_poke_bp_batch+0x1dc/0x2c0
[  143.923178]  ? sdhci_pci_sd_cd+0x30/0x30
[  143.923681]  text_poke_queue+0xa7/0xc0
[  143.924164]  ftrace_replace_code+0xfd/0x170
[  143.924699]  ftrace_modify_all_code+0x1b1/0x270
[  143.925270]  arch_ftrace_update_code+0x9/0x10
[  143.925816]  ftrace_run_update_code+0x30/0xa0
[  143.926374]  ftrace_startup_enable+0x5e/0xa0
[  143.926915]  ftrace_startup+0x16d/0x240
[  143.927412]  register_ftrace_function+0x43/0x90
[  143.927982]  perf_ftrace_event_register+0xc1/0xf0
[  143.928574]  perf_trace_event_init+0xa0/0x4c0
[  143.929129]  perf_trace_init+0xda/0x160
[  143.929622]  perf_tp_event_init+0x57/0xa0
[  143.930136]  perf_try_init_event+0x83/0x270
[  143.930699]  perf_event_alloc+0xe3f/0x1c10
[  143.931216]  ? _raw_spin_unlock+0x2c/0x50
[  143.931725]  ? alloc_fd+0x20d/0x320
[  143.932184]  __do_sys_perf_event_open+0x3bf/0x1de0
[  143.932783]  ? write_comp_data+0x2f/0x90
[  143.933330]  __x64_sys_perf_event_open+0x26/0x30
[  143.933907]  do_syscall_64+0x37/0x80
[  143.934371]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  143.935000] RIP: 0033:0x7fac0740459d
[  143.935451] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  143.937666] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  143.938593] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  143.939455] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  143.940318] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  143.941179] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  143.942043] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  143.942945] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  143.942978] BUG: using smp_processor_id() in preemptible [00000000] code: repro/579
[  143.943831] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  143.944744] caller is debug_smp_processor_id+0x1c/0x20
[  143.946092] Call Trace:
[  143.946099]  dump_stack_lvl+0xa4/0xd3
[  143.946124]  dump_stack+0x15/0x17
[  143.947893]  check_preemption_disabled+0x167/0x180
[  143.948487]  ? do_nanosleep+0x155/0x2a0
[  143.948969]  ? hrtimer_wakeup+0x40/0x40
[  143.949455]  debug_smp_processor_id+0x1c/0x20
[  143.949999]  perf_ftrace_function_call+0x7c/0x360
[  143.950592]  ? 0xffffffffa0098099
[  143.951011]  ? __this_cpu_preempt_check+0x1c/0x20
[  143.951610]  ? finish_task_switch+0xab/0x2a0
[  143.952141]  ? __schedule+0x46e/0xb20
[  143.952607]  ? do_nanosleep+0x9c/0x2a0
[  143.953087]  ? do_nanosleep+0x9c/0x2a0
[  143.953607]  0xffffffffa0098099
[  143.954084]  ? __this_cpu_preempt_check+0x1c/0x20
[  143.954714]  ? lock_is_held_type+0xe2/0x140
[  143.955270]  ? do_nanosleep+0x140/0x2a0
[  143.955787]  ? hrtimer_try_to_cancel+0x5/0x290
[  143.956377]  ? write_comp_data+0x2f/0x90
[  143.956902]  hrtimer_try_to_cancel+0x5/0x290
[  143.957470]  do_nanosleep+0x155/0x2a0
[  143.957967]  ? hrtimer_try_to_cancel+0x5/0x290
[  143.958580]  ? do_nanosleep+0x155/0x2a0
[  143.959092]  ? write_comp_data+0x2f/0x90
[  143.959629]  hrtimer_nanosleep+0xf7/0x1b0
[  143.960175]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[  143.960789]  __x64_sys_nanosleep+0xfc/0x150
[  143.961363]  do_syscall_64+0x37/0x80
[  143.961849]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  143.962534] RIP: 0033:0x7fac073cca18
[  143.963033] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[  143.965362] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[  143.966329] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[  143.967241] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[  143.968141] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[  143.969035] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[  143.969932] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  143.970871] CPU: 1 PID: 579 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  143.970912] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[  143.971776] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  143.972724] caller is debug_smp_processor_id+0x1c/0x20
[  143.974080] Call Trace:
[  143.974088]  dump_stack_lvl+0xa4/0xd3
[  143.975512]  dump_stack+0x15/0x17
[  143.975936]  check_preemption_disabled+0x167/0x180
[  143.976534]  ? text_poke+0x2b/0x60
[  143.976966]  ? do_sync_core+0x30/0x30
[  143.977433]  debug_smp_processor_id+0x1c/0x20
[  143.977979]  perf_ftrace_function_call+0x7c/0x360
[  143.978569]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  143.979154]  ? text_poke_bp_batch+0x1dc/0x2c0
[  143.979698]  ? perf_ftrace_function_call+0x4c/0x360
[  143.980311]  ? mmc_blk_ioctl_multi_cmd+0x440/0x440
[  143.980911]  ? 0xffffffffa0098099
[  143.981331]  ? __this_cpu_preempt_check+0x1c/0x20
[  143.981931]  ? mmc_rpmb_ioctl+0xa0/0xa0
[  143.982427]  0xffffffffa0098099
[  143.982835]  ? _raw_spin_unlock+0x2c/0x50
[  143.983359]  ? mmc_rpmb_ioctl+0xa0/0xa0
[  143.983844]  ? __text_poke+0x5/0x4e0
[  143.984297]  ? lock_is_held_type+0xe2/0x140
[  143.984826]  __text_poke+0x5/0x4e0
[  143.985258]  text_poke+0x2b/0x60
[  143.985671]  ? __text_poke+0x5/0x4e0
[  143.986125]  ? text_poke+0x2b/0x60
[  143.986565]  text_poke_bp_batch+0x1dc/0x2c0
[  143.987096]  ? sdhci_pci_sd_cd+0x30/0x30
[  143.987598]  text_poke_queue+0xa7/0xc0
[  143.988078]  ftrace_replace_code+0xfd/0x170
[  143.988612]  ftrace_modify_all_code+0x1b1/0x270
[  143.989184]  arch_ftrace_update_code+0x9/0x10
[  143.989730]  ftrace_run_update_code+0x30/0xa0
[  143.990283]  ftrace_startup_enable+0x5e/0xa0
[  143.990821]  ftrace_startup+0x16d/0x240
[  143.991318]  register_ftrace_function+0x43/0x90
[  143.991887]  perf_ftrace_event_register+0xc1/0xf0
[  143.992497]  perf_trace_event_init+0xa0/0x4c0
[  143.993062]  perf_trace_init+0xda/0x160
[  143.993554]  perf_tp_event_init+0x57/0xa0
[  143.994080]  perf_try_init_event+0x83/0x270
[  143.994616]  perf_event_alloc+0xe3f/0x1c10
[  143.995132]  ? _raw_spin_unlock+0x2c/0x50
[  143.995640]  ? alloc_fd+0x20d/0x320
[  143.996100]  __do_sys_perf_event_open+0x3bf/0x1de0
[  143.996698]  ? write_comp_data+0x2f/0x90
[  143.997245]  __x64_sys_perf_event_open+0x26/0x30
[  143.997831]  do_syscall_64+0x37/0x80
[  143.998291]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  143.998920] RIP: 0033:0x7fac0740459d
[  143.999371] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  144.001607] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  144.002534] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  144.003394] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  144.004279] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  144.005140] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  144.006002] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  144.006906] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  144.006963] BUG: using smp_processor_id() in preemptible [00000000] code: repro/579
[  144.007834] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  144.008759] caller is debug_smp_processor_id+0x1c/0x20
[  144.010171] Call Trace:
[  144.010185]  dump_stack_lvl+0xa4/0xd3
[  144.010206]  dump_stack+0x15/0x17
[  144.012027]  check_preemption_disabled+0x167/0x180
[  144.012655]  ? hrtimer_try_to_cancel+0x38/0x290
[  144.013243]  ? __hrtimer_get_remaining+0x80/0x80
[  144.013847]  debug_smp_processor_id+0x1c/0x20
[  144.014432]  perf_ftrace_function_call+0x7c/0x360
[  144.015053]  ? do_nanosleep+0x155/0x2a0
[  144.015556]  ? hrtimer_wakeup+0x40/0x40
[  144.016061]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  144.016670]  ? do_nanosleep+0x155/0x2a0
[  144.017174]  ? perf_ftrace_function_call+0x4c/0x360
[  144.017813]  ? 0xffffffffa0098099
[  144.018259]  ? __this_cpu_preempt_check+0x1c/0x20
[  144.018886]  ? do_nanosleep+0x9c/0x2a0
[  144.019381]  0xffffffffa0098099
[  144.019794]  ? do_nanosleep+0x9c/0x2a0
[  144.020293]  ? do_nanosleep+0x9c/0x2a0
[  144.020793]  ? do_nanosleep+0x140/0x2a0
[  144.021309]  ? hrtimer_active+0x5/0xb0
[  144.021805]  ? do_nanosleep+0x140/0x2a0
[  144.022318]  hrtimer_active+0x5/0xb0
[  144.022792]  hrtimer_try_to_cancel+0x38/0x290
[  144.023370]  ? hrtimer_active+0x5/0xb0
[  144.023862]  ? hrtimer_try_to_cancel+0x38/0x290
[  144.024457]  ? do_nanosleep+0x9c/0x2a0
[  144.024953]  do_nanosleep+0x155/0x2a0
[  144.025435]  ? write_comp_data+0x2f/0x90
[  144.025958]  hrtimer_nanosleep+0xf7/0x1b0
[  144.026502]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[  144.027108]  __x64_sys_nanosleep+0xfc/0x150
[  144.027668]  do_syscall_64+0x37/0x80
[  144.028141]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  144.028793] RIP: 0033:0x7fac073cca18
[  144.029261] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[  144.031603] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[  144.032572] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[  144.033469] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[  144.034374] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[  144.035272] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[  144.036170] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  144.037099] CPU: 1 PID: 579 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  144.037152] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[  144.037997] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  144.038008] Call Trace:
[  144.038016]  dump_stack_lvl+0xa4/0xd3
[  144.039254] caller is debug_smp_processor_id+0x1c/0x20
[  144.040668]  dump_stack+0x15/0x17
[  144.042518]  check_preemption_disabled+0x167/0x180
[  144.043120]  ? __text_poke+0xea/0x4e0
[  144.043585]  ? __pmd_alloc+0x420/0x420
[  144.044064]  debug_smp_processor_id+0x1c/0x20
[  144.044622]  perf_ftrace_function_call+0x7c/0x360
[  144.045214]  ? dump_stack+0x15/0x17
[  144.045658]  ? write_comp_data+0x2f/0x90
[  144.046162]  ? text_poke+0x2b/0x60
[  144.046599]  ? do_sync_core+0x30/0x30
[  144.047063]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  144.047651]  ? text_poke+0x2b/0x60
[  144.048093]  ? perf_ftrace_function_call+0x4c/0x360
[  144.048699]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  144.049286]  ? text_poke_bp_batch+0x1dc/0x2c0
[  144.049833]  ? perf_ftrace_function_call+0x4c/0x360
[  144.050461]  ? mmc_rpmb_ioctl+0xa0/0xa0
[  144.050952]  0xffffffffa0098099
[  144.051379]  ? __get_locked_pte+0x5/0x290
[  144.051892]  __get_locked_pte+0x5/0x290
[  144.052378]  __text_poke+0xea/0x4e0
[  144.052822]  ? __get_locked_pte+0x5/0x290
[  144.053327]  ? __text_poke+0xea/0x4e0
[  144.053791]  ? mmc_rpmb_ioctl+0xa0/0xa0
[  144.054295]  ? lock_is_held_type+0xe2/0x140
[  144.054823]  ? mmc_rpmb_ioctl+0xa0/0xa0
[  144.055319]  text_poke+0x2b/0x60
[  144.055738]  text_poke_bp_batch+0x1dc/0x2c0
[  144.056271]  ? sdhci_pci_sd_cd+0x30/0x30
[  144.056773]  text_poke_queue+0xa7/0xc0
[  144.057254]  ftrace_replace_code+0xfd/0x170
[  144.057787]  ftrace_modify_all_code+0x1b1/0x270
[  144.058380]  arch_ftrace_update_code+0x9/0x10
[  144.058945]  ftrace_run_update_code+0x30/0xa0
[  144.059493]  ftrace_startup_enable+0x5e/0xa0
[  144.060032]  ftrace_startup+0x16d/0x240
[  144.060529]  register_ftrace_function+0x43/0x90
[  144.061097]  perf_ftrace_event_register+0xc1/0xf0
[  144.061687]  perf_trace_event_init+0xa0/0x4c0
[  144.062252]  perf_trace_init+0xda/0x160
[  144.062745]  perf_tp_event_init+0x57/0xa0
[  144.063254]  perf_try_init_event+0x83/0x270
[  144.063791]  perf_event_alloc+0xe3f/0x1c10
[  144.064306]  ? _raw_spin_unlock+0x2c/0x50
[  144.064814]  ? alloc_fd+0x20d/0x320
[  144.065273]  __do_sys_perf_event_open+0x3bf/0x1de0
[  144.065872]  ? write_comp_data+0x2f/0x90
[  144.066428]  __x64_sys_perf_event_open+0x26/0x30
[  144.067007]  do_syscall_64+0x37/0x80
[  144.067464]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  144.068091] RIP: 0033:0x7fac0740459d
[  144.068544] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[  144.070770] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[  144.071687] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[  144.072548] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[  144.073409] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[  144.074278] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[  144.075140] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[  144.076038] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[  144.076937] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[  144.078310] Call Trace:
[  144.078624]  dump_stack_lvl+0xa4/0xd3
[  144.079092]  dump_stack+0x15/0x17
[  144.079516]  check_preemption_disabled+0x167/0x180
[  144.080113]  ? syscall_exit_to_user_mode+0xd/0x60
[  144.080696]  ? __bpf_trace_sys_enter+0x10/0x10
[  144.081254]  debug_smp_processor_id+0x1c/0x20
[  144.081801]  perf_ftrace_function_call+0x7c/0x360
[  144.082406]  ? write_comp_data+0x2f/0x90
[  144.082905]  ? write_comp_data+0x2f/0x90
[  144.083404]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  144.083994]  ? write_comp_data+0x2f/0x90
[  144.084492]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  144.085089]  0xffffffffa0098099
[  144.085487]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  144.086094]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[  144.086779]  ? __sanitizer_cov_trace_pc+0x21/0x50
[  144.087368]  syscall_exit_to_user_mode_prepare+0x5/0x240
[  144.088031]  syscall_exit_to_user_mode+0xd/0x60
[  144.088597]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[  144.089271]  ? syscall_exit_to_user_mode+0xd/0x60
[  144.089859]  do_syscall_64+0x46/0x80
[  144.090323]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[  144.090950] RIP: 0033:0x7fac073cca18
[  144.091406] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[  144.093622] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[  144.094538] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac073cca18
[  144.095397] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[  144.096255] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[  144.097114] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[  144.097977] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1260.052029] check_preemption_disabled: 1017730 callbacks suppressed
[ 1260.052051] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20667
[ 1260.054248] caller is debug_smp_processor_id+0x1c/0x20
[ 1260.055025] CPU: 1 PID: 20667 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1260.056135] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1260.057770] Call Trace:
[ 1260.058181]  dump_stack_lvl+0xa4/0xd3
[ 1260.058790]  dump_stack+0x15/0x17
[ 1260.059326]  check_preemption_disabled+0x167/0x180
[ 1260.060064]  ? text_poke+0x2b/0x60
[ 1260.060589]  ? do_sync_core+0x30/0x30
[ 1260.061177]  debug_smp_processor_id+0x1c/0x20
[ 1260.061840]  perf_ftrace_function_call+0x7c/0x360
[ 1260.062553]  ? ftrace_ops_test+0x71/0xc0
[ 1260.063173]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1260.063851]  ? _raw_spin_unlock+0x2c/0x50
[ 1260.064473]  ? preempt_notifier_dec+0x20/0x20
[ 1260.065147]  ? do_sync_core+0x30/0x30
[ 1260.065733]  ? ftrace_call+0x5/0x44
[ 1260.066305]  ? write_comp_data+0x2f/0x90
[ 1260.066918]  ? perf_trace_buf_update+0x70/0x70
[ 1260.067625]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1260.068346]  ? __text_poke+0x4e0/0x4e0
[ 1260.068966]  0xffffffffa0098099
[ 1260.069490]  ? __text_poke+0x4e0/0x4e0
[ 1260.070133]  ? __text_poke+0x4e0/0x4e0
[ 1260.070724]  ? __text_poke+0x5/0x4e0
[ 1260.071316]  __text_poke+0x5/0x4e0
[ 1260.071846]  text_poke+0x2b/0x60
[ 1260.072359]  ? __text_poke+0x5/0x4e0
[ 1260.072905]  ? text_poke+0x2b/0x60
[ 1260.073457]  text_poke_bp_batch+0x93/0x2c0
[ 1260.074121]  ? user_disable_single_step+0x50/0x50
[ 1260.074866]  text_poke_queue+0xa7/0xc0
[ 1260.075483]  ftrace_replace_code+0xfd/0x170
[ 1260.076159]  ftrace_modify_all_code+0x1b1/0x270
[ 1260.076886]  arch_ftrace_update_code+0x9/0x10
[ 1260.077561]  ftrace_run_update_code+0x30/0xa0
[ 1260.078250]  ftrace_shutdown+0x2b8/0x4a0
[ 1260.078910]  unregister_ftrace_function+0x25/0x50
[ 1260.079647]  perf_ftrace_event_register+0x89/0xf0
[ 1260.080362]  ? perf_tp_event_init+0xa0/0xa0
[ 1260.081010]  perf_trace_destroy+0x37/0x60
[ 1260.081634]  tp_perf_event_destroy+0x15/0x20
[ 1260.082320]  _free_event+0xfc/0x7d0
[ 1260.082911]  put_event+0x37/0x50
[ 1260.083459]  perf_event_release_kernel+0x2f4/0x370
[ 1260.084255]  ? perf_event_release_kernel+0x370/0x370
[ 1260.085037]  perf_release+0x19/0x20
[ 1260.085610]  __fput+0x12d/0x460
[ 1260.086201]  ____fput+0x1a/0x20
[ 1260.086730]  task_work_run+0x8e/0xf0
[ 1260.087337]  do_exit+0x616/0x1310
[ 1260.087972]  __x64_sys_exit+0x24/0x30
[ 1260.088566]  do_syscall_64+0x37/0x80
[ 1260.089150]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1260.089937] RIP: 0033:0x7fac0740459d
[ 1260.090513] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1260.091499] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1260.092647] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1260.093717] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1260.094804] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1260.095877] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1260.096951] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1260.098298] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20667
[ 1260.099516] caller is debug_smp_processor_id+0x1c/0x20
[ 1260.100314] CPU: 1 PID: 20667 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1260.101427] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1260.103108] Call Trace:
[ 1260.103511]  dump_stack_lvl+0xa4/0xd3
[ 1260.104107]  dump_stack+0x15/0x17
[ 1260.104641]  check_preemption_disabled+0x167/0x180
[ 1260.105384]  ? text_poke+0x2b/0x60
[ 1260.105941]  ? do_sync_core+0x30/0x30
[ 1260.106560]  debug_smp_processor_id+0x1c/0x20
[ 1260.107243]  perf_ftrace_function_call+0x7c/0x360
[ 1260.107975]  ? ftrace_ops_test+0x71/0xc0
[ 1260.108628]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1260.109364]  ? _raw_spin_unlock+0x2c/0x50
[ 1260.110028]  ? preempt_notifier_dec+0x20/0x20
[ 1260.110762]  ? __text_poke+0x4e0/0x4e0
[ 1260.111383]  ? ftrace_call+0x5/0x44
[ 1260.111947]  ? write_comp_data+0x2f/0x90
[ 1260.112567]  ? perf_trace_buf_update+0x70/0x70
[ 1260.113262]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1260.114022]  ? alternatives_smp_module_del+0x90/0x90
[ 1260.114841]  0xffffffffa0098099
[ 1260.115393]  ? alternatives_smp_module_del+0x90/0x90
[ 1260.116254]  ? alternatives_smp_module_del+0x90/0x90
[ 1260.117040]  ? __text_poke+0x5/0x4e0
[ 1260.117645]  __text_poke+0x5/0x4e0
[ 1260.118203]  text_poke+0x2b/0x60
[ 1260.118738]  ? __text_poke+0x5/0x4e0
[ 1260.119321]  ? text_poke+0x2b/0x60
[ 1260.119896]  text_poke_bp_batch+0x93/0x2c0
[ 1260.120575]  ? user_disable_single_step+0x50/0x50
[ 1260.121333]  text_poke_queue+0xa7/0xc0
[ 1260.122014]  ftrace_replace_code+0xfd/0x170
[ 1260.122722]  ftrace_modify_all_code+0x1b1/0x270
[ 1260.123469]  arch_ftrace_update_code+0x9/0x10
[ 1260.124145]  ftrace_run_update_code+0x30/0xa0
[ 1260.124838]  ftrace_shutdown+0x2b8/0x4a0
[ 1260.125512]  unregister_ftrace_function+0x25/0x50
[ 1260.126266]  perf_ftrace_event_register+0x89/0xf0
[ 1260.127011]  ? perf_tp_event_init+0xa0/0xa0
[ 1260.127686]  perf_trace_destroy+0x37/0x60
[ 1260.128338]  tp_perf_event_destroy+0x15/0x20
[ 1260.129026]  _free_event+0xfc/0x7d0
[ 1260.129628]  put_event+0x37/0x50
[ 1260.130174]  perf_event_release_kernel+0x2f4/0x370
[ 1260.130978]  ? perf_event_release_kernel+0x370/0x370
[ 1260.131818]  perf_release+0x19/0x20
[ 1260.132411]  __fput+0x12d/0x460
[ 1260.133000]  ____fput+0x1a/0x20
[ 1260.133538]  task_work_run+0x8e/0xf0
[ 1260.134172]  do_exit+0x616/0x1310
[ 1260.134824]  __x64_sys_exit+0x24/0x30
[ 1260.135438]  do_syscall_64+0x37/0x80
[ 1260.136041]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1260.136850] RIP: 0033:0x7fac0740459d
[ 1260.137452] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1260.138461] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1260.139624] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1260.140707] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1260.141774] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1260.142831] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1260.143878] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1260.145235] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20667
[ 1260.146476] caller is debug_smp_processor_id+0x1c/0x20
[ 1260.147270] CPU: 1 PID: 20667 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1260.148384] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1260.150091] Call Trace:
[ 1260.150504]  dump_stack_lvl+0xa4/0xd3
[ 1260.151109]  dump_stack+0x15/0x17
[ 1260.151644]  check_preemption_disabled+0x167/0x180
[ 1260.152388]  ? text_poke+0x2b/0x60
[ 1260.152918]  ? do_sync_core+0x30/0x30
[ 1260.153520]  debug_smp_processor_id+0x1c/0x20
[ 1260.154214]  perf_ftrace_function_call+0x7c/0x360
[ 1260.154924]  ? ftrace_ops_test+0x71/0xc0
[ 1260.155540]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1260.156232]  ? _raw_spin_unlock+0x2c/0x50
[ 1260.156857]  ? preempt_notifier_dec+0x20/0x20
[ 1260.157549]  ? alternatives_smp_module_del+0x90/0x90
[ 1260.158336]  ? ftrace_call+0x5/0x44
[ 1260.158901]  ? write_comp_data+0x2f/0x90
[ 1260.159513]  ? perf_trace_buf_update+0x70/0x70
[ 1260.160182]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1260.160908]  ? alternatives_text_reserved+0xa0/0xa0
[ 1260.161666]  0xffffffffa0098099
[ 1260.162201]  ? alternatives_text_reserved+0xa0/0xa0
[ 1260.163013]  ? alternatives_text_reserved+0xa0/0xa0
[ 1260.163777]  ? __text_poke+0x5/0x4e0
[ 1260.164385]  __text_poke+0x5/0x4e0
[ 1260.164952]  text_poke+0x2b/0x60
[ 1260.165492]  ? __text_poke+0x5/0x4e0
[ 1260.166065]  ? text_poke+0x2b/0x60
[ 1260.166637]  text_poke_bp_batch+0x93/0x2c0
[ 1260.167304]  ? user_disable_single_step+0x50/0x50
[ 1260.168033]  text_poke_queue+0xa7/0xc0
[ 1260.168657]  ftrace_replace_code+0xfd/0x170
[ 1260.169328]  ftrace_modify_all_code+0x1b1/0x270
[ 1260.170037]  arch_ftrace_update_code+0x9/0x10
[ 1260.170709]  ftrace_run_update_code+0x30/0xa0
[ 1260.171371]  ftrace_shutdown+0x2b8/0x4a0
[ 1260.171988]  unregister_ftrace_function+0x25/0x50
[ 1260.172677]  perf_ftrace_event_register+0x89/0xf0
[ 1260.173368]  ? perf_tp_event_init+0xa0/0xa0
[ 1260.173994]  perf_trace_destroy+0x37/0x60
[ 1260.174618]  tp_perf_event_destroy+0x15/0x20
[ 1260.175257]  _free_event+0xfc/0x7d0
[ 1260.175824]  put_event+0x37/0x50
[ 1260.176324]  perf_event_release_kernel+0x2f4/0x370
[ 1260.177056]  ? perf_event_release_kernel+0x370/0x370
[ 1260.177797]  perf_release+0x19/0x20
[ 1260.178363]  __fput+0x12d/0x460
[ 1260.178918]  ____fput+0x1a/0x20
[ 1260.179426]  task_work_run+0x8e/0xf0
[ 1260.180006]  do_exit+0x616/0x1310
[ 1260.180596]  __x64_sys_exit+0x24/0x30
[ 1260.181154]  do_syscall_64+0x37/0x80
[ 1260.181703]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1260.182444] RIP: 0033:0x7fac0740459d
[ 1260.182974] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1260.183898] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1260.184943] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1260.185901] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1260.186880] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1260.187873] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1260.188855] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1260.190112] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20667
[ 1260.191217] caller is debug_smp_processor_id+0x1c/0x20
[ 1260.191960] CPU: 1 PID: 20667 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1260.193009] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1260.194641] Call Trace:
[ 1260.195029]  dump_stack_lvl+0xa4/0xd3
[ 1260.195626]  dump_stack+0x15/0x17
[ 1260.196129]  check_preemption_disabled+0x167/0x180
[ 1260.196838]  ? text_poke+0x2b/0x60
[ 1260.197345]  ? do_sync_core+0x30/0x30
[ 1260.197928]  debug_smp_processor_id+0x1c/0x20
[ 1260.198599]  perf_ftrace_function_call+0x7c/0x360
[ 1260.199287]  ? ftrace_ops_test+0x71/0xc0
[ 1260.199868]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1260.200524]  ? _raw_spin_unlock+0x2c/0x50
[ 1260.201113]  ? preempt_notifier_dec+0x20/0x20
[ 1260.201770]  ? alternatives_text_reserved+0xa0/0xa0
[ 1260.202509]  ? ftrace_call+0x5/0x44
[ 1260.203036]  ? write_comp_data+0x2f/0x90
[ 1260.203637]  ? perf_trace_buf_update+0x70/0x70
[ 1260.204287]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1260.204991]  ? text_poke_early+0xc0/0xc0
[ 1260.205596]  0xffffffffa0098099
[ 1260.206131]  ? text_poke_early+0xc0/0xc0
[ 1260.206775]  ? text_poke_early+0xc0/0xc0
[ 1260.207367]  ? __text_poke+0x5/0x4e0
[ 1260.207938]  __text_poke+0x5/0x4e0
[ 1260.208452]  text_poke+0x2b/0x60
[ 1260.208949]  ? __text_poke+0x5/0x4e0
[ 1260.209496]  ? text_poke+0x2b/0x60
[ 1260.210062]  text_poke_bp_batch+0x93/0x2c0
[ 1260.210708]  ? user_disable_single_step+0x50/0x50
[ 1260.211423]  text_poke_queue+0xa7/0xc0
[ 1260.212009]  ftrace_replace_code+0xfd/0x170
[ 1260.212659]  ftrace_modify_all_code+0x1b1/0x270
[ 1260.213348]  arch_ftrace_update_code+0x9/0x10
[ 1260.213998]  ftrace_run_update_code+0x30/0xa0
[ 1260.214680]  ftrace_shutdown+0x2b8/0x4a0
[ 1260.215296]  unregister_ftrace_function+0x25/0x50
[ 1260.215994]  perf_ftrace_event_register+0x89/0xf0
[ 1260.216680]  ? perf_tp_event_init+0xa0/0xa0
[ 1260.217299]  perf_trace_destroy+0x37/0x60
[ 1260.217907]  tp_perf_event_destroy+0x15/0x20
[ 1260.218554]  _free_event+0xfc/0x7d0
[ 1260.219125]  put_event+0x37/0x50
[ 1260.219628]  perf_event_release_kernel+0x2f4/0x370
[ 1260.220362]  ? perf_event_release_kernel+0x370/0x370
[ 1260.221098]  perf_release+0x19/0x20
[ 1260.221635]  __fput+0x12d/0x460
[ 1260.222185]  ____fput+0x1a/0x20
[ 1260.222657]  task_work_run+0x8e/0xf0
[ 1260.223208]  do_exit+0x616/0x1310
[ 1260.223778]  __x64_sys_exit+0x24/0x30
[ 1260.224306]  do_syscall_64+0x37/0x80
[ 1260.224829]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1260.225521] RIP: 0033:0x7fac0740459d
[ 1260.226053] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1260.226945] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1260.227960] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1260.228904] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1260.229863] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1260.230827] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1260.231777] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1260.232960] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20667
[ 1260.234122] caller is debug_smp_processor_id+0x1c/0x20
[ 1260.234872] CPU: 1 PID: 20667 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1260.235910] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1260.237462] Call Trace:
[ 1260.237834]  dump_stack_lvl+0xa4/0xd3
[ 1260.238416]  dump_stack+0x15/0x17
[ 1260.238917]  check_preemption_disabled+0x167/0x180
[ 1260.239619]  ? text_poke+0x2b/0x60
[ 1260.240118]  ? do_sync_core+0x30/0x30
[ 1260.240677]  debug_smp_processor_id+0x1c/0x20
[ 1260.241312]  perf_ftrace_function_call+0x7c/0x360
[ 1260.241990]  ? ftrace_ops_test+0x71/0xc0
[ 1260.242599]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1260.243255]  ? _raw_spin_unlock+0x2c/0x50
[ 1260.243858]  ? preempt_notifier_dec+0x20/0x20
[ 1260.244509]  ? text_poke_early+0xc0/0xc0
[ 1260.245112]  ? ftrace_call+0x5/0x44
[ 1260.245643]  ? write_comp_data+0x2f/0x90
[ 1260.246253]  ? perf_trace_buf_update+0x70/0x70
[ 1260.246908]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1260.247614]  ? apply_alternatives+0x370/0x370
[ 1260.248284]  0xffffffffa0098099
[ 1260.248788]  ? apply_alternatives+0x370/0x370
[ 1260.249478]  ? apply_alternatives+0x370/0x370
[ 1260.250131]  ? __text_poke+0x5/0x4e0
[ 1260.250702]  __text_poke+0x5/0x4e0
[ 1260.251223]  text_poke+0x2b/0x60
[ 1260.251719]  ? __text_poke+0x5/0x4e0
[ 1260.252243]  ? text_poke+0x2b/0x60
[ 1260.252773]  text_poke_bp_batch+0x93/0x2c0
[ 1260.253412]  ? user_disable_single_step+0x50/0x50
[ 1260.254159]  text_poke_queue+0xa7/0xc0
[ 1260.254774]  ftrace_replace_code+0xfd/0x170
[ 1260.255452]  ftrace_modify_all_code+0x1b1/0x270
[ 1260.256159]  arch_ftrace_update_code+0x9/0x10
[ 1260.256822]  ftrace_run_update_code+0x30/0xa0
[ 1260.257503]  ftrace_shutdown+0x2b8/0x4a0
[ 1260.258154]  unregister_ftrace_function+0x25/0x50
[ 1260.258877]  perf_ftrace_event_register+0x89/0xf0
[ 1260.259593]  ? perf_tp_event_init+0xa0/0xa0
[ 1260.260232]  perf_trace_destroy+0x37/0x60
[ 1260.260856]  tp_perf_event_destroy+0x15/0x20
[ 1260.261520]  _free_event+0xfc/0x7d0
[ 1260.262106]  put_event+0x37/0x50
[ 1260.262638]  perf_event_release_kernel+0x2f4/0x370
[ 1260.263377]  ? perf_event_release_kernel+0x370/0x370
[ 1260.264108]  perf_release+0x19/0x20
[ 1260.264637]  __fput+0x12d/0x460
[ 1260.265171]  ____fput+0x1a/0x20
[ 1260.265656]  task_work_run+0x8e/0xf0
[ 1260.266246]  do_exit+0x616/0x1310
[ 1260.266846]  __x64_sys_exit+0x24/0x30
[ 1260.267396]  do_syscall_64+0x37/0x80
[ 1260.267935]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1260.268665] RIP: 0033:0x7fac0740459d
[ 1260.269198] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1260.270111] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1260.271199] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1260.272183] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1260.273164] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1260.274174] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1260.275170] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1260.276423] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20667
[ 1260.277517] caller is debug_smp_processor_id+0x1c/0x20
[ 1260.278342] CPU: 1 PID: 20667 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1260.279386] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1260.280944] Call Trace:
[ 1260.281321]  dump_stack_lvl+0xa4/0xd3
[ 1260.281888]  dump_stack+0x15/0x17
[ 1260.282425]  check_preemption_disabled+0x167/0x180
[ 1260.283125]  ? text_poke+0x2b/0x60
[ 1260.283631]  ? do_sync_core+0x30/0x30
[ 1260.284190]  debug_smp_processor_id+0x1c/0x20
[ 1260.284830]  perf_ftrace_function_call+0x7c/0x360
[ 1260.285512]  ? ftrace_ops_test+0x71/0xc0
[ 1260.286164]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1260.286850]  ? _raw_spin_unlock+0x2c/0x50
[ 1260.287445]  ? preempt_notifier_dec+0x20/0x20
[ 1260.288091]  ? apply_alternatives+0x370/0x370
[ 1260.288733]  ? ftrace_call+0x5/0x44
[ 1260.289255]  ? write_comp_data+0x2f/0x90
[ 1260.289847]  ? perf_trace_buf_update+0x70/0x70
[ 1260.290517]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1260.291206]  ? apply_paravirt+0x150/0x150
[ 1260.291818]  0xffffffffa0098099
[ 1260.292316]  ? apply_paravirt+0x150/0x150
[ 1260.292932]  ? apply_paravirt+0x150/0x150
[ 1260.293492]  ? __text_poke+0x5/0x4e0
[ 1260.294045]  __text_poke+0x5/0x4e0
[ 1260.294563]  text_poke+0x2b/0x60
[ 1260.295035]  ? __text_poke+0x5/0x4e0
[ 1260.295536]  ? text_poke+0x2b/0x60
[ 1260.296048]  text_poke_bp_batch+0x93/0x2c0
[ 1260.296651]  ? user_disable_single_step+0x50/0x50
[ 1260.297335]  text_poke_queue+0xa7/0xc0
[ 1260.297889]  ftrace_replace_code+0xfd/0x170
[ 1260.298535]  ftrace_modify_all_code+0x1b1/0x270
[ 1260.299186]  arch_ftrace_update_code+0x9/0x10
[ 1260.299805]  ftrace_run_update_code+0x30/0xa0
[ 1260.300433]  ftrace_shutdown+0x2b8/0x4a0
[ 1260.301018]  unregister_ftrace_function+0x25/0x50
[ 1260.301684]  perf_ftrace_event_register+0x89/0xf0
[ 1260.302361]  ? perf_tp_event_init+0xa0/0xa0
[ 1260.302969]  perf_trace_destroy+0x37/0x60
[ 1260.303532]  tp_perf_event_destroy+0x15/0x20
[ 1260.304133]  _free_event+0xfc/0x7d0
[ 1260.304666]  put_event+0x37/0x50
[ 1260.305143]  perf_event_release_kernel+0x2f4/0x370
[ 1260.305831]  ? perf_event_release_kernel+0x370/0x370
[ 1260.306561]  perf_release+0x19/0x20
[ 1260.307063]  __fput+0x12d/0x460
[ 1260.307575]  ____fput+0x1a/0x20
[ 1260.308030]  task_work_run+0x8e/0xf0
[ 1260.308571]  do_exit+0x616/0x1310
[ 1260.309123]  __x64_sys_exit+0x24/0x30
[ 1260.309650]  do_syscall_64+0x37/0x80
[ 1260.310172]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1260.310890] RIP: 0033:0x7fac0740459d
[ 1260.311413] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1260.312279] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1260.313296] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1260.314284] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1260.315247] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1260.316195] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1260.317144] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1260.318297] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20667
[ 1260.319354] caller is debug_smp_processor_id+0x1c/0x20
[ 1260.320048] CPU: 1 PID: 20667 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1260.321047] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1260.322577] Call Trace:
[ 1260.322941]  dump_stack_lvl+0xa4/0xd3
[ 1260.323476]  dump_stack+0x15/0x17
[ 1260.323956]  check_preemption_disabled+0x167/0x180
[ 1260.324616]  ? text_poke_bp_batch+0x93/0x2c0
[ 1260.325213]  ? apply_paravirt+0x150/0x150
[ 1260.325786]  debug_smp_processor_id+0x1c/0x20
[ 1260.326427]  perf_ftrace_function_call+0x7c/0x360
[ 1260.327090]  ? preempt_notifier_dec+0x20/0x20
[ 1260.327706]  ? apply_paravirt+0x150/0x150
[ 1260.328290]  ? ftrace_call+0x5/0x44
[ 1260.328785]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1260.329561]  0xffffffffa0098099
[ 1260.330095]  ? text_poke+0x60/0x60
[ 1260.330621]  ? text_poke+0x5/0x60
[ 1260.331122]  text_poke+0x5/0x60
[ 1260.331589]  text_poke_bp_batch+0x93/0x2c0
[ 1260.332158]  ? text_poke+0x5/0x60
[ 1260.332648]  ? text_poke_bp_batch+0x93/0x2c0
[ 1260.333266]  ? user_disable_single_step+0x50/0x50
[ 1260.333955]  text_poke_queue+0xa7/0xc0
[ 1260.334544]  ftrace_replace_code+0xfd/0x170
[ 1260.335178]  ftrace_modify_all_code+0x1b1/0x270
[ 1260.335826]  arch_ftrace_update_code+0x9/0x10
[ 1260.336441]  ftrace_run_update_code+0x30/0xa0
[ 1260.337057]  ftrace_shutdown+0x2b8/0x4a0
[ 1260.337643]  unregister_ftrace_function+0x25/0x50
[ 1260.338313]  perf_ftrace_event_register+0x89/0xf0
[ 1260.338973]  ? perf_tp_event_init+0xa0/0xa0
[ 1260.339560]  perf_trace_destroy+0x37/0x60
[ 1260.340124]  tp_perf_event_destroy+0x15/0x20
[ 1260.340728]  _free_event+0xfc/0x7d0
[ 1260.341252]  put_event+0x37/0x50
[ 1260.341735]  perf_event_release_kernel+0x2f4/0x370
[ 1260.342453]  ? perf_event_release_kernel+0x370/0x370
[ 1260.343163]  perf_release+0x19/0x20
[ 1260.343666]  __fput+0x12d/0x460
[ 1260.344212]  ____fput+0x1a/0x20
[ 1260.344700]  task_work_run+0x8e/0xf0
[ 1260.345274]  do_exit+0x616/0x1310
[ 1260.345857]  __x64_sys_exit+0x24/0x30
[ 1260.346412]  do_syscall_64+0x37/0x80
[ 1260.346932]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1260.347626] RIP: 0033:0x7fac0740459d
[ 1260.348125] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1260.348993] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1260.350006] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1260.350974] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1260.351921] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1260.352862] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1260.353806] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1260.355023] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20667
[ 1260.356062] caller is debug_smp_processor_id+0x1c/0x20
[ 1260.356760] CPU: 1 PID: 20667 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1260.357754] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1260.359265] Call Trace:
[ 1260.359630]  dump_stack_lvl+0xa4/0xd3
[ 1260.360163]  dump_stack+0x15/0x17
[ 1260.360652]  check_preemption_disabled+0x167/0x180
[ 1260.361310]  ? text_poke+0x2b/0x60
[ 1260.361805]  ? do_sync_core+0x30/0x30
[ 1260.362373]  debug_smp_processor_id+0x1c/0x20
[ 1260.363002]  perf_ftrace_function_call+0x7c/0x360
[ 1260.363643]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1260.364301]  ? text_poke_bp_batch+0x93/0x2c0
[ 1260.364899]  ? perf_ftrace_function_call+0x4c/0x360
[ 1260.365568]  ? preempt_notifier_dec+0x20/0x20
[ 1260.366204]  ? apply_paravirt+0x150/0x150
[ 1260.366781]  ? ftrace_call+0x5/0x44
[ 1260.367291]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1260.367984]  ? text_poke+0x60/0x60
[ 1260.368500]  0xffffffffa0098099
[ 1260.368971]  ? text_poke+0x60/0x60
[ 1260.369500]  ? text_poke+0x60/0x60
[ 1260.369979]  ? __text_poke+0x5/0x4e0
[ 1260.370541]  __text_poke+0x5/0x4e0
[ 1260.371035]  text_poke+0x2b/0x60
[ 1260.371497]  ? __text_poke+0x5/0x4e0
[ 1260.372002]  ? text_poke+0x2b/0x60
[ 1260.372502]  text_poke_bp_batch+0x93/0x2c0
[ 1260.373107]  ? user_disable_single_step+0x50/0x50
[ 1260.373782]  text_poke_queue+0xa7/0xc0
[ 1260.374381]  ftrace_replace_code+0xfd/0x170
[ 1260.375010]  ftrace_modify_all_code+0x1b1/0x270
[ 1260.375668]  arch_ftrace_update_code+0x9/0x10
[ 1260.376281]  ftrace_run_update_code+0x30/0xa0
[ 1260.376891]  ftrace_shutdown+0x2b8/0x4a0
[ 1260.377478]  unregister_ftrace_function+0x25/0x50
[ 1260.378138]  perf_ftrace_event_register+0x89/0xf0
[ 1260.378795]  ? perf_tp_event_init+0xa0/0xa0
[ 1260.379386]  perf_trace_destroy+0x37/0x60
[ 1260.379949]  tp_perf_event_destroy+0x15/0x20
[ 1260.380554]  _free_event+0xfc/0x7d0
[ 1260.381079]  put_event+0x37/0x50
[ 1260.381553]  perf_event_release_kernel+0x2f4/0x370
[ 1260.382289]  ? perf_event_release_kernel+0x370/0x370
[ 1260.383007]  perf_release+0x19/0x20
[ 1260.383514]  __fput+0x12d/0x460
[ 1260.384029]  ____fput+0x1a/0x20
[ 1260.384486]  task_work_run+0x8e/0xf0
[ 1260.385031]  do_exit+0x616/0x1310
[ 1260.385585]  __x64_sys_exit+0x24/0x30
[ 1260.386128]  do_syscall_64+0x37/0x80
[ 1260.386648]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1260.387348] RIP: 0033:0x7fac0740459d
[ 1260.387846] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1260.388713] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1260.389728] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1260.390696] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1260.391646] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1260.392575] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1260.393520] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1260.394712] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20667
[ 1260.395752] caller is debug_smp_processor_id+0x1c/0x20
[ 1260.396453] CPU: 1 PID: 20667 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1260.397443] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1260.398945] Call Trace:
[ 1260.399299]  dump_stack_lvl+0xa4/0xd3
[ 1260.399847]  dump_stack+0x15/0x17
[ 1260.400320]  check_preemption_disabled+0x167/0x180
[ 1260.400987]  ? text_poke_bp_batch+0x93/0x2c0
[ 1260.401571]  ? apply_paravirt+0x150/0x150
[ 1260.402176]  debug_smp_processor_id+0x1c/0x20
[ 1260.402785]  perf_ftrace_function_call+0x7c/0x360
[ 1260.403442]  ? preempt_notifier_dec+0x20/0x20
[ 1260.404068]  ? text_poke+0x60/0x60
[ 1260.404568]  ? ftrace_call+0x5/0x44
[ 1260.405077]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1260.405845]  0xffffffffa0098099
[ 1260.406394]  ? alternatives_smp_module_add+0x160/0x160
[ 1260.407095]  ? text_poke+0x5/0x60
[ 1260.407634]  text_poke+0x5/0x60
[ 1260.408094]  text_poke_bp_batch+0x93/0x2c0
[ 1260.408675]  ? text_poke+0x5/0x60
[ 1260.409140]  ? text_poke_bp_batch+0x93/0x2c0
[ 1260.409762]  ? user_disable_single_step+0x50/0x50
[ 1260.410462]  text_poke_queue+0xa7/0xc0
[ 1260.411026]  ftrace_replace_code+0xfd/0x170
[ 1260.411642]  ftrace_modify_all_code+0x1b1/0x270
[ 1260.412299]  arch_ftrace_update_code+0x9/0x10
[ 1260.412909]  ftrace_run_update_code+0x30/0xa0
[ 1260.413523]  ftrace_shutdown+0x2b8/0x4a0
[ 1260.414123]  unregister_ftrace_function+0x25/0x50
[ 1260.414779]  perf_ftrace_event_register+0x89/0xf0
[ 1260.415435]  ? perf_tp_event_init+0xa0/0xa0
[ 1260.416026]  perf_trace_destroy+0x37/0x60
[ 1260.416603]  tp_perf_event_destroy+0x15/0x20
[ 1260.417202]  _free_event+0xfc/0x7d0
[ 1260.417735]  put_event+0x37/0x50
[ 1260.418231]  perf_event_release_kernel+0x2f4/0x370
[ 1260.418937]  ? perf_event_release_kernel+0x370/0x370
[ 1260.419657]  perf_release+0x19/0x20
[ 1260.420162]  __fput+0x12d/0x460
[ 1260.420675]  ____fput+0x1a/0x20
[ 1260.421143]  task_work_run+0x8e/0xf0
[ 1260.421682]  do_exit+0x616/0x1310
[ 1260.422266]  __x64_sys_exit+0x24/0x30
[ 1260.422793]  do_syscall_64+0x37/0x80
[ 1260.423313]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1260.424016] RIP: 0033:0x7fac0740459d
[ 1260.424514] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1260.425378] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1260.426402] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1260.427336] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1260.428278] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1260.429224] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1260.430177] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1260.431349] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20667
[ 1260.432398] caller is debug_smp_processor_id+0x1c/0x20
[ 1260.433104] CPU: 1 PID: 20667 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1260.434104] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1260.435592] Call Trace:
[ 1260.435955]  dump_stack_lvl+0xa4/0xd3
[ 1260.436497]  dump_stack+0x15/0x17
[ 1260.436969]  check_preemption_disabled+0x167/0x180
[ 1260.437631]  ? text_poke+0x2b/0x60
[ 1260.438117]  ? do_sync_core+0x30/0x30
[ 1260.438670]  debug_smp_processor_id+0x1c/0x20
[ 1260.439273]  perf_ftrace_function_call+0x7c/0x360
[ 1260.439923]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1260.440581]  ? text_poke_bp_batch+0x93/0x2c0
[ 1260.441182]  ? perf_ftrace_function_call+0x4c/0x360
[ 1260.441852]  ? preempt_notifier_dec+0x20/0x20
[ 1260.442485]  ? text_poke+0x60/0x60
[ 1260.443073]  ? ftrace_call+0x5/0x44
[ 1260.443571]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1260.444283]  ? alternatives_smp_module_add+0x160/0x160
[ 1260.445001]  0xffffffffa0098099
[ 1260.445484]  ? alternatives_smp_module_add+0x160/0x160
[ 1260.446250]  ? alternatives_smp_module_add+0x160/0x160
[ 1260.446954]  ? __text_poke+0x5/0x4e0
[ 1260.447496]  __text_poke+0x5/0x4e0
[ 1260.447976]  text_poke+0x2b/0x60
[ 1260.448446]  ? __text_poke+0x5/0x4e0
[ 1260.448952]  ? text_poke+0x2b/0x60
[ 1260.449449]  text_poke_bp_batch+0x93/0x2c0
[ 1260.450074]  ? user_disable_single_step+0x50/0x50
[ 1260.450760]  text_poke_queue+0xa7/0xc0
[ 1260.451314]  ftrace_replace_code+0xfd/0x170
[ 1260.451931]  ftrace_modify_all_code+0x1b1/0x270
[ 1260.452582]  arch_ftrace_update_code+0x9/0x10
[ 1260.453210]  ftrace_run_update_code+0x30/0xa0
[ 1260.453828]  ftrace_shutdown+0x2b8/0x4a0
[ 1260.454435]  unregister_ftrace_function+0x25/0x50
[ 1260.455085]  perf_ftrace_event_register+0x89/0xf0
[ 1260.455738]  ? perf_tp_event_init+0xa0/0xa0
[ 1260.456332]  perf_trace_destroy+0x37/0x60
[ 1260.456901]  tp_perf_event_destroy+0x15/0x20
[ 1260.457502]  _free_event+0xfc/0x7d0
[ 1260.458024]  put_event+0x37/0x50
[ 1260.458526]  perf_event_release_kernel+0x2f4/0x370
[ 1260.459224]  ? perf_event_release_kernel+0x370/0x370
[ 1260.459923]  perf_release+0x19/0x20
[ 1260.460428]  __fput+0x12d/0x460
[ 1260.460937]  ____fput+0x1a/0x20
[ 1260.461394]  task_work_run+0x8e/0xf0
[ 1260.461934]  do_exit+0x616/0x1310
[ 1260.462509]  __x64_sys_exit+0x24/0x30
[ 1260.463034]  do_syscall_64+0x37/0x80
[ 1260.463542]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1260.464239] RIP: 0033:0x7fac0740459d
[ 1260.464737] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1260.465593] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1260.466626] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1260.467562] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1260.468496] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1260.469437] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1260.470402] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1265.054068] check_preemption_disabled: 1875104 callbacks suppressed
[ 1265.054096] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20668
[ 1265.056195] caller is debug_smp_processor_id+0x1c/0x20
[ 1265.057002] CPU: 1 PID: 20668 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1265.058111] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1265.059804] Call Trace:
[ 1265.060234]  dump_stack_lvl+0xa4/0xd3
[ 1265.060872]  dump_stack+0x15/0x17
[ 1265.061417]  check_preemption_disabled+0x167/0x180
[ 1265.062202]  ? __get_locked_pte+0x1a2/0x290
[ 1265.062872]  ? __lock_text_start+0x8/0x8
[ 1265.063546]  debug_smp_processor_id+0x1c/0x20
[ 1265.064255]  perf_ftrace_function_call+0x7c/0x360
[ 1265.065035]  ? ftrace_ops_test+0x71/0xc0
[ 1265.065712]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1265.066489]  ? text_poke+0x2b/0x60
[ 1265.067073]  ? perf_ftrace_function_call+0x4c/0x360
[ 1265.067879]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1265.068689]  ? ftrace_ops_test+0x71/0xc0
[ 1265.069350]  ? write_comp_data+0x2f/0x90
[ 1265.070026]  ? perf_trace_buf_update+0x70/0x70
[ 1265.070854]  0xffffffffa0098099
[ 1265.071433]  ? intel_hdcp_info+0xe0/0xe0
[ 1265.072138]  ? ftrace_call+0x5/0x44
[ 1265.072789]  ? pmd_page_vaddr+0x2b/0x70
[ 1265.073454]  ? _raw_spin_lock+0x5/0x50
[ 1265.074146]  _raw_spin_lock+0x5/0x50
[ 1265.074749]  __get_locked_pte+0x1a2/0x290
[ 1265.075395]  ? _raw_spin_lock+0x5/0x50
[ 1265.076000]  ? __get_locked_pte+0x1a2/0x290
[ 1265.076691]  ? intel_hdcp_info+0xe0/0xe0
[ 1265.077351]  __text_poke+0xea/0x4e0
[ 1265.077924]  ? intel_hdcp_info+0xe0/0xe0
[ 1265.078596]  ? lock_is_held_type+0xe2/0x140
[ 1265.079276]  ? intel_hdcp_info+0xe0/0xe0
[ 1265.079950]  text_poke+0x2b/0x60
[ 1265.080532]  text_poke_bp_batch+0x93/0x2c0
[ 1265.081229]  ? i915_fbc_false_color_fops_open+0x40/0x40
[ 1265.082106]  text_poke_queue+0xa7/0xc0
[ 1265.082768]  ftrace_replace_code+0xfd/0x170
[ 1265.083502]  ftrace_modify_all_code+0x1b1/0x270
[ 1265.084270]  arch_ftrace_update_code+0x9/0x10
[ 1265.084982]  ftrace_run_update_code+0x30/0xa0
[ 1265.085719]  ftrace_startup_enable+0x5e/0xa0
[ 1265.086459]  ftrace_startup+0x16d/0x240
[ 1265.087169]  register_ftrace_function+0x43/0x90
[ 1265.087920]  perf_ftrace_event_register+0xc1/0xf0
[ 1265.088699]  perf_trace_event_init+0xa0/0x4c0
[ 1265.089457]  perf_trace_init+0xda/0x160
[ 1265.090136]  perf_tp_event_init+0x57/0xa0
[ 1265.090793]  perf_try_init_event+0x83/0x270
[ 1265.091509]  perf_event_alloc+0xe3f/0x1c10
[ 1265.092134]  ? _raw_spin_unlock+0x2c/0x50
[ 1265.092789]  ? alloc_fd+0x20d/0x320
[ 1265.093467]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1265.094250]  ? write_comp_data+0x2f/0x90
[ 1265.095204]  __x64_sys_perf_event_open+0x26/0x30
[ 1265.096016]  do_syscall_64+0x37/0x80
[ 1265.096623]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1265.097402] RIP: 0033:0x7fac0740459d
[ 1265.097988] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1265.099748] BUG: using smp_processor_id() in preemptible [00000000] code: tuned/324
[ 1265.100698] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1265.102234] caller is debug_smp_processor_id+0x1c/0x20
[ 1265.103128] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1265.105054] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1265.106142] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1265.107220] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1265.108297] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1265.109586] CPU: 0 PID: 324 Comm: tuned Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1265.109735] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20668
[ 1265.110813] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1265.110855] Call Trace:
[ 1265.110912]  dump_stack_lvl+0xa4/0xd3
[ 1265.112015] caller is debug_smp_processor_id+0x1c/0x20
[ 1265.113916]  dump_stack+0x15/0x17
[ 1265.116271]  check_preemption_disabled+0x167/0x180
[ 1265.117123]  ? futex_wait+0x155/0x2f0
[ 1265.117769]  ? __lock_text_start+0x8/0x8
[ 1265.118515]  debug_smp_processor_id+0x1c/0x20
[ 1265.119264]  perf_ftrace_function_call+0x7c/0x360
[ 1265.120047]  ? write_comp_data+0x2f/0x90
[ 1265.120745]  ? perf_trace_buf_update+0x70/0x70
[ 1265.121496]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1265.122350]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1265.123104]  ? __might_sleep+0x48/0x70
[ 1265.123755]  ? sched_show_task+0x70/0x70
[ 1265.124547]  ? ftrace_call+0x5/0x44
[ 1265.125346]  0xffffffffa0098099
[ 1265.126106]  ? futex_wait_queue_me+0x126/0x1a0
[ 1265.127123]  ? _raw_spin_lock+0x5/0x50
[ 1265.127825]  ? futex_wait_queue_me+0x12f/0x1a0
[ 1265.128585]  _raw_spin_lock+0x5/0x50
[ 1265.129216]  futex_wait+0x155/0x2f0
[ 1265.129855]  ? _raw_spin_lock+0x5/0x50
[ 1265.130543]  ? futex_wait+0x155/0x2f0
[ 1265.131334]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1265.132515]  do_futex+0x2c1/0x1200
[ 1265.133164]  ? ftrace_call+0x5/0x44
[ 1265.133885]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1265.134818]  ? do_futex+0x5/0x1200
[ 1265.135561]  __x64_sys_futex+0xa7/0x2c0
[ 1265.136211]  ? do_futex+0x5/0x1200
[ 1265.136806]  ? __x64_sys_futex+0xa7/0x2c0
[ 1265.137750]  do_syscall_64+0x37/0x80
[ 1265.138434]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1265.139270] RIP: 0033:0x7f4b09cf8222
[ 1265.139902] Code: fd e8 02 08 00 00 44 89 e6 41 89 c5 81 f6 89 01 00 00 41 b9 ff ff ff ff 45 31 c0 49 89 da 31 d2 48 89 ef b8 ca 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 26 44 89 ef e8 2e 08 00 00 31 c0 48 83 c4 18
[ 1265.142712] RSP: 002b:00007f4af37709a0 EFLAGS: 00000246 ORIG_RAX: 00000000000000ca
[ 1265.143920] RAX: ffffffffffffffda RBX: 00007f4af3770a40 RCX: 00007f4b09cf8222
[ 1265.145038] RDX: 0000000000000000 RSI: 0000000000000189 RDI: 00007f4aec00aa50
[ 1265.146163] RBP: 00007f4aec00aa50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1265.147273] R10: 00007f4af3770a40 R11: 0000000000000246 R12: 0000000000000000
[ 1265.148385] R13: 0000000000000000 R14: 00007f4af3770a40 R15: 000000003b9aca00
[ 1265.149884] CPU: 1 PID: 20668 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1265.150228] BUG: using smp_processor_id() in preemptible [00000000] code: tuned/324
[ 1265.150945] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1265.152144] caller is debug_smp_processor_id+0x1c/0x20
[ 1265.153631] Call Trace:
[ 1265.154795]  dump_stack_lvl+0xa4/0xd3
[ 1265.155389]  dump_stack+0x15/0x17
[ 1265.155885]  check_preemption_disabled+0x167/0x180
[ 1265.156569]  ? __get_locked_pte+0x1a2/0x290
[ 1265.157166]  ? __lock_text_start+0x8/0x8
[ 1265.157759]  debug_smp_processor_id+0x1c/0x20
[ 1265.158403]  perf_ftrace_function_call+0x7c/0x360
[ 1265.159098]  ? ftrace_ops_test+0x71/0xc0
[ 1265.159694]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1265.160368]  ? text_poke+0x2b/0x60
[ 1265.160875]  ? perf_ftrace_function_call+0x4c/0x360
[ 1265.161582]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1265.162286]  ? ftrace_ops_test+0x71/0xc0
[ 1265.162861]  ? write_comp_data+0x2f/0x90
[ 1265.163461]  ? perf_trace_buf_update+0x70/0x70
[ 1265.164170]  0xffffffffa0098099
[ 1265.164667]  ? i915_dmc_info+0x470/0x470
[ 1265.165260]  ? ftrace_call+0x5/0x44
[ 1265.165798]  ? pmd_page_vaddr+0x2b/0x70
[ 1265.166405]  ? _raw_spin_lock+0x5/0x50
[ 1265.166999]  _raw_spin_lock+0x5/0x50
[ 1265.167541]  __get_locked_pte+0x1a2/0x290
[ 1265.168126]  ? _raw_spin_lock+0x5/0x50
[ 1265.168669]  ? __get_locked_pte+0x1a2/0x290
[ 1265.169293]  ? i915_dmc_info+0x470/0x470
[ 1265.169885]  __text_poke+0xea/0x4e0
[ 1265.170430]  ? i915_dmc_info+0x470/0x470
[ 1265.171022]  ? lock_is_held_type+0xe2/0x140
[ 1265.171639]  ? i915_dmc_info+0x470/0x470
[ 1265.172249]  text_poke+0x2b/0x60
[ 1265.172765]  text_poke_bp_batch+0x93/0x2c0
[ 1265.173399]  ? i915_fbc_false_color_fops_open+0x40/0x40
[ 1265.174192]  text_poke_queue+0xa7/0xc0
[ 1265.174810]  ftrace_replace_code+0xfd/0x170
[ 1265.175465]  ftrace_modify_all_code+0x1b1/0x270
[ 1265.176154]  arch_ftrace_update_code+0x9/0x10
[ 1265.176815]  ftrace_run_update_code+0x30/0xa0
[ 1265.177497]  ftrace_startup_enable+0x5e/0xa0
[ 1265.178176]  ftrace_startup+0x16d/0x240
[ 1265.178806]  register_ftrace_function+0x43/0x90
[ 1265.179477]  perf_ftrace_event_register+0xc1/0xf0
[ 1265.180172]  perf_trace_event_init+0xa0/0x4c0
[ 1265.180894]  perf_trace_init+0xda/0x160
[ 1265.181529]  perf_tp_event_init+0x57/0xa0
[ 1265.182179]  perf_try_init_event+0x83/0x270
[ 1265.182844]  perf_event_alloc+0xe3f/0x1c10
[ 1265.183432]  ? _raw_spin_unlock+0x2c/0x50
[ 1265.184028]  ? alloc_fd+0x20d/0x320
[ 1265.184639]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1265.185343]  ? write_comp_data+0x2f/0x90
[ 1265.186230]  __x64_sys_perf_event_open+0x26/0x30
[ 1265.186915]  do_syscall_64+0x37/0x80
[ 1265.187460]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1265.188171] RIP: 0033:0x7fac0740459d
[ 1265.188704] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1265.191169] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1265.192210] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1265.193224] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1265.194257] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1265.195274] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1265.196291] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1265.197520] CPU: 0 PID: 324 Comm: tuned Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1265.197657] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20668
[ 1265.198724] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1265.198761] Call Trace:
[ 1265.198815]  dump_stack_lvl+0xa4/0xd3
[ 1265.199883] caller is debug_smp_processor_id+0x1c/0x20
[ 1265.201745]  dump_stack+0x15/0x17
[ 1265.203942]  check_preemption_disabled+0x167/0x180
[ 1265.204833]  debug_smp_processor_id+0x1c/0x20
[ 1265.205573]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1265.206562]  perf_trace_buf_alloc+0x3d/0x100
[ 1265.207289]  ? futex_wait+0x155/0x2f0
[ 1265.207910]  ? __lock_text_start+0x8/0x8
[ 1265.208605]  perf_ftrace_function_call+0x209/0x360
[ 1265.209748]  ? 0xffffffffa0098099
[ 1265.210548]  0xffffffffa0098099
[ 1265.211313]  ? futex_wait_queue_me+0x126/0x1a0
[ 1265.212118]  ? _raw_spin_lock+0x5/0x50
[ 1265.212805]  ? futex_wait_queue_me+0x12f/0x1a0
[ 1265.213559]  _raw_spin_lock+0x5/0x50
[ 1265.214201]  futex_wait+0x155/0x2f0
[ 1265.214818]  ? _raw_spin_lock+0x5/0x50
[ 1265.215453]  ? futex_wait+0x155/0x2f0
[ 1265.216233]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1265.217403]  do_futex+0x2c1/0x1200
[ 1265.218043]  ? ftrace_call+0x5/0x44
[ 1265.218772]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1265.219685]  ? do_futex+0x5/0x1200
[ 1265.220412]  __x64_sys_futex+0xa7/0x2c0
[ 1265.221063]  ? do_futex+0x5/0x1200
[ 1265.221652]  ? __x64_sys_futex+0xa7/0x2c0
[ 1265.222600]  do_syscall_64+0x37/0x80
[ 1265.223247]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1265.224072] RIP: 0033:0x7f4b09cf8222
[ 1265.224700] Code: fd e8 02 08 00 00 44 89 e6 41 89 c5 81 f6 89 01 00 00 41 b9 ff ff ff ff 45 31 c0 49 89 da 31 d2 48 89 ef b8 ca 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 26 44 89 ef e8 2e 08 00 00 31 c0 48 83 c4 18
[ 1265.227491] RSP: 002b:00007f4af37709a0 EFLAGS: 00000246 ORIG_RAX: 00000000000000ca
[ 1265.228818] RAX: ffffffffffffffda RBX: 00007f4af3770a40 RCX: 00007f4b09cf8222
[ 1265.230029] RDX: 0000000000000000 RSI: 0000000000000189 RDI: 00007f4aec00aa50
[ 1265.231243] RBP: 00007f4aec00aa50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1265.232510] R10: 00007f4af3770a40 R11: 0000000000000246 R12: 0000000000000000
[ 1265.233778] R13: 0000000000000000 R14: 00007f4af3770a40 R15: 000000003b9aca00
[ 1265.235458] CPU: 1 PID: 20668 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1265.235831] BUG: using smp_processor_id() in preemptible [00000000] code: tuned/324
[ 1265.236607] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1265.237833] caller is debug_smp_processor_id+0x1c/0x20
[ 1265.239509] Call Trace:
[ 1265.239541]  dump_stack_lvl+0xa4/0xd3
[ 1265.239613]  dump_stack+0x15/0x17
[ 1265.239653]  check_preemption_disabled+0x167/0x180
[ 1265.242677]  ? __get_locked_pte+0x1a2/0x290
[ 1265.243366]  ? __lock_text_start+0x8/0x8
[ 1265.244044]  debug_smp_processor_id+0x1c/0x20
[ 1265.244759]  perf_ftrace_function_call+0x7c/0x360
[ 1265.245531]  ? ftrace_ops_test+0x71/0xc0
[ 1265.246189]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1265.246937]  ? text_poke+0x2b/0x60
[ 1265.247494]  ? perf_ftrace_function_call+0x4c/0x360
[ 1265.248265]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1265.249026]  ? ftrace_ops_test+0x71/0xc0
[ 1265.249652]  ? write_comp_data+0x2f/0x90
[ 1265.250302]  ? perf_trace_buf_update+0x70/0x70
[ 1265.251077]  0xffffffffa0098099
[ 1265.251623]  ? i915_power_domain_info+0x170/0x170
[ 1265.252387]  ? ftrace_call+0x5/0x44
[ 1265.252998]  ? pmd_page_vaddr+0x2b/0x70
[ 1265.253658]  ? _raw_spin_lock+0x5/0x50
[ 1265.254317]  _raw_spin_lock+0x5/0x50
[ 1265.254908]  __get_locked_pte+0x1a2/0x290
[ 1265.255559]  ? _raw_spin_lock+0x5/0x50
[ 1265.256164]  ? __get_locked_pte+0x1a2/0x290
[ 1265.256854]  ? i915_power_domain_info+0x170/0x170
[ 1265.257613]  __text_poke+0xea/0x4e0
[ 1265.258199]  ? i915_power_domain_info+0x170/0x170
[ 1265.258960]  ? lock_is_held_type+0xe2/0x140
[ 1265.259638]  ? i915_power_domain_info+0x170/0x170
[ 1265.260425]  text_poke+0x2b/0x60
[ 1265.261011]  text_poke_bp_batch+0x93/0x2c0
[ 1265.261724]  ? i915_fbc_false_color_fops_open+0x40/0x40
[ 1265.262583]  text_poke_queue+0xa7/0xc0
[ 1265.263216]  ftrace_replace_code+0xfd/0x170
[ 1265.263922]  ftrace_modify_all_code+0x1b1/0x270
[ 1265.264656]  arch_ftrace_update_code+0x9/0x10
[ 1265.265339]  ftrace_run_update_code+0x30/0xa0
[ 1265.266040]  ftrace_startup_enable+0x5e/0xa0
[ 1265.266739]  ftrace_startup+0x16d/0x240
[ 1265.267410]  register_ftrace_function+0x43/0x90
[ 1265.268128]  perf_ftrace_event_register+0xc1/0xf0
[ 1265.268881]  perf_trace_event_init+0xa0/0x4c0
[ 1265.269661]  perf_trace_init+0xda/0x160
[ 1265.270325]  perf_tp_event_init+0x57/0xa0
[ 1265.270973]  perf_try_init_event+0x83/0x270
[ 1265.271687]  perf_event_alloc+0xe3f/0x1c10
[ 1265.272315]  ? _raw_spin_unlock+0x2c/0x50
[ 1265.272953]  ? alloc_fd+0x20d/0x320
[ 1265.273607]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1265.274388]  ? write_comp_data+0x2f/0x90
[ 1265.275352]  __x64_sys_perf_event_open+0x26/0x30
[ 1265.276090]  do_syscall_64+0x37/0x80
[ 1265.276686]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1265.277487] RIP: 0033:0x7fac0740459d
[ 1265.278083] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1265.280846] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1265.282020] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1265.283117] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1265.284197] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1265.285289] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1265.286379] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1265.287689] CPU: 0 PID: 324 Comm: tuned Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1265.287927] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20668
[ 1265.288868] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1265.290123] caller is debug_smp_processor_id+0x1c/0x20
[ 1265.291795] Call Trace:
[ 1265.293010]  dump_stack_lvl+0xa4/0xd3
[ 1265.293707]  dump_stack+0x15/0x17
[ 1265.294314]  check_preemption_disabled+0x167/0x180
[ 1265.295205]  debug_smp_processor_id+0x1c/0x20
[ 1265.295970]  perf_trace_buf_alloc+0x98/0x100
[ 1265.296714]  ? futex_wait+0x155/0x2f0
[ 1265.297360]  ? __lock_text_start+0x8/0x8
[ 1265.298066]  perf_ftrace_function_call+0x209/0x360
[ 1265.299147]  ? 0xffffffffa0098099
[ 1265.299891]  0xffffffffa0098099
[ 1265.300633]  ? futex_wait_queue_me+0x126/0x1a0
[ 1265.301450]  ? _raw_spin_lock+0x5/0x50
[ 1265.302145]  ? futex_wait_queue_me+0x12f/0x1a0
[ 1265.302917]  _raw_spin_lock+0x5/0x50
[ 1265.303558]  futex_wait+0x155/0x2f0
[ 1265.304186]  ? _raw_spin_lock+0x5/0x50
[ 1265.304840]  ? futex_wait+0x155/0x2f0
[ 1265.305599]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1265.306702]  do_futex+0x2c1/0x1200
[ 1265.307344]  ? ftrace_call+0x5/0x44
[ 1265.308050]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1265.308965]  ? do_futex+0x5/0x1200
[ 1265.309672]  __x64_sys_futex+0xa7/0x2c0
[ 1265.310375]  ? do_futex+0x5/0x1200
[ 1265.311022]  ? __x64_sys_futex+0xa7/0x2c0
[ 1265.311950]  do_syscall_64+0x37/0x80
[ 1265.312635]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1265.313537] RIP: 0033:0x7f4b09cf8222
[ 1265.314225] Code: fd e8 02 08 00 00 44 89 e6 41 89 c5 81 f6 89 01 00 00 41 b9 ff ff ff ff 45 31 c0 49 89 da 31 d2 48 89 ef b8 ca 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 26 44 89 ef e8 2e 08 00 00 31 c0 48 83 c4 18
[ 1265.317313] RSP: 002b:00007f4af37709a0 EFLAGS: 00000246 ORIG_RAX: 00000000000000ca
[ 1265.318658] RAX: ffffffffffffffda RBX: 00007f4af3770a40 RCX: 00007f4b09cf8222
[ 1265.319870] RDX: 0000000000000000 RSI: 0000000000000189 RDI: 00007f4aec00aa50
[ 1265.321078] RBP: 00007f4aec00aa50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1265.322283] R10: 00007f4af3770a40 R11: 0000000000000246 R12: 0000000000000000
[ 1265.323477] R13: 0000000000000000 R14: 00007f4af3770a40 R15: 000000003b9aca00
[ 1265.324919] CPU: 1 PID: 20668 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1265.325367] BUG: using smp_processor_id() in preemptible [00000000] code: tuned/324
[ 1265.326103] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1265.326127] Call Trace:
[ 1265.326158]  dump_stack_lvl+0xa4/0xd3
[ 1265.326232]  dump_stack+0x15/0x17
[ 1265.327438] caller is debug_smp_processor_id+0x1c/0x20
[ 1265.329163]  check_preemption_disabled+0x167/0x180
[ 1265.332213]  ? __get_locked_pte+0x1a2/0x290
[ 1265.332909]  ? __lock_text_start+0x8/0x8
[ 1265.333583]  debug_smp_processor_id+0x1c/0x20
[ 1265.334320]  perf_ftrace_function_call+0x7c/0x360
[ 1265.335119]  ? ftrace_ops_test+0x71/0xc0
[ 1265.335794]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1265.336563]  ? text_poke+0x2b/0x60
[ 1265.337165]  ? perf_ftrace_function_call+0x4c/0x360
[ 1265.337987]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1265.338825]  ? ftrace_ops_test+0x71/0xc0
[ 1265.339481]  ? write_comp_data+0x2f/0x90
[ 1265.340142]  ? perf_trace_buf_update+0x70/0x70
[ 1265.340949]  0xffffffffa0098099
[ 1265.341533]  ? i915_gem_framebuffer_info+0x1d0/0x1d0
[ 1265.342393]  ? ftrace_call+0x5/0x44
[ 1265.343003]  ? pmd_page_vaddr+0x2b/0x70
[ 1265.343673]  ? _raw_spin_lock+0x5/0x50
[ 1265.344347]  _raw_spin_lock+0x5/0x50
[ 1265.344946]  __get_locked_pte+0x1a2/0x290
[ 1265.345600]  ? _raw_spin_lock+0x5/0x50
[ 1265.346229]  ? __get_locked_pte+0x1a2/0x290
[ 1265.346941]  ? i915_gem_framebuffer_info+0x1d0/0x1d0
[ 1265.347755]  __text_poke+0xea/0x4e0
[ 1265.348325]  ? i915_gem_framebuffer_info+0x1d0/0x1d0
[ 1265.349135]  ? lock_is_held_type+0xe2/0x140
[ 1265.349822]  ? i915_gem_framebuffer_info+0x1d0/0x1d0
[ 1265.350653]  text_poke+0x2b/0x60
[ 1265.351227]  text_poke_bp_batch+0x93/0x2c0
[ 1265.351926]  ? i915_fbc_false_color_fops_open+0x40/0x40
[ 1265.352796]  text_poke_queue+0xa7/0xc0
[ 1265.353458]  ftrace_replace_code+0xfd/0x170
[ 1265.354209]  ftrace_modify_all_code+0x1b1/0x270
[ 1265.355013]  arch_ftrace_update_code+0x9/0x10
[ 1265.355748]  ftrace_run_update_code+0x30/0xa0
[ 1265.356502]  ftrace_startup_enable+0x5e/0xa0
[ 1265.357244]  ftrace_startup+0x16d/0x240
[ 1265.357970]  register_ftrace_function+0x43/0x90
[ 1265.358748]  perf_ftrace_event_register+0xc1/0xf0
[ 1265.359542]  perf_trace_event_init+0xa0/0x4c0
[ 1265.360304]  perf_trace_init+0xda/0x160
[ 1265.360989]  perf_tp_event_init+0x57/0xa0
[ 1265.361671]  perf_try_init_event+0x83/0x270
[ 1265.362423]  perf_event_alloc+0xe3f/0x1c10
[ 1265.363069]  ? _raw_spin_unlock+0x2c/0x50
[ 1265.363731]  ? alloc_fd+0x20d/0x320
[ 1265.364398]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1265.365179]  ? write_comp_data+0x2f/0x90
[ 1265.366148]  __x64_sys_perf_event_open+0x26/0x30
[ 1265.366893]  do_syscall_64+0x37/0x80
[ 1265.367494]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1265.368293] RIP: 0033:0x7fac0740459d
[ 1265.368894] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1265.371670] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1265.372847] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1265.373897] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1265.374929] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1265.375980] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1265.377003] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1265.378284] CPU: 0 PID: 324 Comm: tuned Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1265.378470] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20668
[ 1265.379441] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1265.380577] caller is debug_smp_processor_id+0x1c/0x20
[ 1265.382238] Call Trace:
[ 1265.382275]  dump_stack_lvl+0xa4/0xd3
[ 1265.382358]  dump_stack+0x15/0x17
[ 1265.384504]  check_preemption_disabled+0x167/0x180
[ 1265.385381]  debug_smp_processor_id+0x1c/0x20
[ 1265.386138]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1265.387042]  perf_tp_event+0x331/0x4e0
[ 1265.387863]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1265.388829]  ? trace_hardirqs_on+0x3f/0x170
[ 1265.389561]  ? arch_local_irq_enable+0x10/0x12
[ 1265.390316]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1265.391128]  ? dump_stack_lvl+0xcc/0xd3
[ 1265.391847]  ? dump_stack+0x15/0x17
[ 1265.392499]  ? futex_wait+0x155/0x2f0
[ 1265.393139]  ? __lock_text_start+0x8/0x8
[ 1265.393884]  perf_ftrace_function_call+0x248/0x360
[ 1265.394737]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1265.395512]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1265.396336]  ? perf_ftrace_function_call+0x248/0x360
[ 1265.397468]  ? 0xffffffffa0098099
[ 1265.398210]  0xffffffffa0098099
[ 1265.398914]  ? futex_wait_queue_me+0x126/0x1a0
[ 1265.399719]  ? _raw_spin_lock+0x5/0x50
[ 1265.400407]  ? futex_wait_queue_me+0x12f/0x1a0
[ 1265.401166]  _raw_spin_lock+0x5/0x50
[ 1265.401785]  futex_wait+0x155/0x2f0
[ 1265.402385]  ? _raw_spin_lock+0x5/0x50
[ 1265.402981]  ? futex_wait+0x155/0x2f0
[ 1265.403672]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1265.404671]  do_futex+0x2c1/0x1200
[ 1265.405268]  ? ftrace_call+0x5/0x44
[ 1265.405912]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1265.406764]  ? do_futex+0x5/0x1200
[ 1265.407443]  __x64_sys_futex+0xa7/0x2c0
[ 1265.408087]  ? do_futex+0x5/0x1200
[ 1265.408678]  ? __x64_sys_futex+0xa7/0x2c0
[ 1265.409549]  do_syscall_64+0x37/0x80
[ 1265.410193]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1265.411015] RIP: 0033:0x7f4b09cf8222
[ 1265.411629] Code: fd e8 02 08 00 00 44 89 e6 41 89 c5 81 f6 89 01 00 00 41 b9 ff ff ff ff 45 31 c0 49 89 da 31 d2 48 89 ef b8 ca 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 26 44 89 ef e8 2e 08 00 00 31 c0 48 83 c4 18
[ 1265.414468] RSP: 002b:00007f4af37709a0 EFLAGS: 00000246 ORIG_RAX: 00000000000000ca
[ 1265.415637] RAX: ffffffffffffffda RBX: 00007f4af3770a40 RCX: 00007f4b09cf8222
[ 1265.416696] RDX: 0000000000000000 RSI: 0000000000000189 RDI: 00007f4aec00aa50
[ 1265.417820] RBP: 00007f4aec00aa50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1265.418954] R10: 00007f4af3770a40 R11: 0000000000000246 R12: 0000000000000000
[ 1265.420008] R13: 0000000000000000 R14: 00007f4af3770a40 R15: 000000003b9aca00
[ 1265.421327] CPU: 1 PID: 20668 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1265.421553] BUG: using smp_processor_id() in preemptible [00000000] code: tuned/324
[ 1265.422395] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1265.422417] Call Trace:
[ 1265.422446]  dump_stack_lvl+0xa4/0xd3
[ 1265.422513]  dump_stack+0x15/0x17
[ 1265.423702] caller is debug_smp_processor_id+0x1c/0x20
[ 1265.425262]  check_preemption_disabled+0x167/0x180
[ 1265.428053]  ? __get_locked_pte+0x1a2/0x290
[ 1265.428681]  ? __lock_text_start+0x8/0x8
[ 1265.429300]  debug_smp_processor_id+0x1c/0x20
[ 1265.429953]  perf_ftrace_function_call+0x7c/0x360
[ 1265.430697]  ? ftrace_ops_test+0x71/0xc0
[ 1265.431309]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1265.432008]  ? text_poke+0x2b/0x60
[ 1265.432533]  ? perf_ftrace_function_call+0x4c/0x360
[ 1265.433309]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1265.434071]  ? ftrace_ops_test+0x71/0xc0
[ 1265.434682]  ? write_comp_data+0x2f/0x90
[ 1265.435283]  ? perf_trace_buf_update+0x70/0x70
[ 1265.436013]  0xffffffffa0098099
[ 1265.436525]  ? i915_vbt+0x60/0x60
[ 1265.437075]  ? ftrace_call+0x5/0x44
[ 1265.437630]  ? pmd_page_vaddr+0x2b/0x70
[ 1265.438361]  ? _raw_spin_lock+0x5/0x50
[ 1265.438975]  _raw_spin_lock+0x5/0x50
[ 1265.439513]  __get_locked_pte+0x1a2/0x290
[ 1265.440104]  ? _raw_spin_lock+0x5/0x50
[ 1265.440652]  ? __get_locked_pte+0x1a2/0x290
[ 1265.441282]  ? i915_vbt+0x60/0x60
[ 1265.441800]  __text_poke+0xea/0x4e0
[ 1265.442341]  ? i915_vbt+0x60/0x60
[ 1265.442859]  ? lock_is_held_type+0xe2/0x140
[ 1265.443481]  ? i915_vbt+0x60/0x60
[ 1265.444016]  text_poke+0x2b/0x60
[ 1265.444533]  text_poke_bp_batch+0x93/0x2c0
[ 1265.445188]  ? i915_fbc_false_color_fops_open+0x40/0x40
[ 1265.445970]  text_poke_queue+0xa7/0xc0
[ 1265.446582]  ftrace_replace_code+0xfd/0x170
[ 1265.447241]  ftrace_modify_all_code+0x1b1/0x270
[ 1265.447937]  arch_ftrace_update_code+0x9/0x10
[ 1265.448570]  ftrace_run_update_code+0x30/0xa0
[ 1265.449246]  ftrace_startup_enable+0x5e/0xa0
[ 1265.449893]  ftrace_startup+0x16d/0x240
[ 1265.450588]  register_ftrace_function+0x43/0x90
[ 1265.451357]  perf_ftrace_event_register+0xc1/0xf0
[ 1265.452111]  perf_trace_event_init+0xa0/0x4c0
[ 1265.452896]  perf_trace_init+0xda/0x160
[ 1265.453594]  perf_tp_event_init+0x57/0xa0
[ 1265.454318]  perf_try_init_event+0x83/0x270
[ 1265.455096]  perf_event_alloc+0xe3f/0x1c10
[ 1265.455775]  ? _raw_spin_unlock+0x2c/0x50
[ 1265.456459]  ? alloc_fd+0x20d/0x320
[ 1265.457166]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1265.457980]  ? write_comp_data+0x2f/0x90
[ 1265.458991]  __x64_sys_perf_event_open+0x26/0x30
[ 1265.459773]  do_syscall_64+0x37/0x80
[ 1265.460397]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1265.461214] RIP: 0033:0x7fac0740459d
[ 1265.461818] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1265.464518] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1265.465667] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1265.466737] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1265.467791] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1265.468857] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1265.469912] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1265.471204] CPU: 0 PID: 324 Comm: tuned Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1265.472460] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1265.474343] Call Trace:
[ 1265.474839]  dump_stack_lvl+0xa4/0xd3
[ 1265.475592]  dump_stack+0x15/0x17
[ 1265.476231]  check_preemption_disabled+0x167/0x180
[ 1265.477098]  ? exit_to_user_mode_prepare+0xab/0x240
[ 1265.477923]  ? __schedule+0xb20/0xb20
[ 1265.478626]  debug_smp_processor_id+0x1c/0x20
[ 1265.479387]  perf_ftrace_function_call+0x7c/0x360
[ 1265.480409]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1265.481225]  ? write_comp_data+0x2f/0x90
[ 1265.481937]  ? perf_trace_buf_update+0x70/0x70
[ 1265.482717]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1265.483686]  0xffffffffa0098099
[ 1265.484326]  ? ftrace_call+0x5/0x44
[ 1265.484989]  ? rcu_read_lock_sched_held+0x4f/0x80
[ 1265.485853]  ? trace_hardirqs_on+0x3f/0x170
[ 1265.486649]  ? schedule+0x5/0xd0
[ 1265.487312]  schedule+0x5/0xd0
[ 1265.487879]  exit_to_user_mode_prepare+0xab/0x240
[ 1265.488690]  ? schedule+0x5/0xd0
[ 1265.489276]  ? exit_to_user_mode_prepare+0xab/0x240
[ 1265.490156]  syscall_exit_to_user_mode+0x2b/0x60
[ 1265.491018]  do_syscall_64+0x46/0x80
[ 1265.491718]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1265.492612] RIP: 0033:0x7f4b09cf8222
[ 1265.493259] Code: fd e8 02 08 00 00 44 89 e6 41 89 c5 81 f6 89 01 00 00 41 b9 ff ff ff ff 45 31 c0 49 89 da 31 d2 48 89 ef b8 ca 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 26 44 89 ef e8 2e 08 00 00 31 c0 48 83 c4 18
[ 1265.496194] RSP: 002b:00007f4af37709a0 EFLAGS: 00000246 ORIG_RAX: 00000000000000ca
[ 1265.497443] RAX: ffffffffffffff92 RBX: 00007f4af3770a40 RCX: 00007f4b09cf8222
[ 1265.498612] RDX: 0000000000000000 RSI: 0000000000000189 RDI: 00007f4aec00aa50
[ 1265.499753] RBP: 00007f4aec00aa50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1265.500952] R10: 00007f4af3770a40 R11: 0000000000000246 R12: 0000000000000000
[ 1265.502101] R13: 0000000000000000 R14: 00007f4af3770a40 R15: 000000003b9aca00
[ 1270.057980] check_preemption_disabled: 2333403 callbacks suppressed
[ 1270.057994] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1270.058482] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1270.058816] caller is debug_smp_processor_id+0x1c/0x20
[ 1270.059744] caller is debug_smp_processor_id+0x1c/0x20
[ 1270.060642] CPU: 1 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1270.062729] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1270.064066] Call Trace:
[ 1270.064378]  dump_stack_lvl+0xa4/0xd3
[ 1270.064840]  dump_stack+0x15/0x17
[ 1270.065255]  check_preemption_disabled+0x167/0x180
[ 1270.065842]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1270.066380]  ? apply_paravirt+0x150/0x150
[ 1270.066881]  debug_smp_processor_id+0x1c/0x20
[ 1270.067418]  perf_ftrace_function_call+0x7c/0x360
[ 1270.068003]  ? devm_clk_match+0x40/0x40
[ 1270.068484]  ? 0xffffffffa0098099
[ 1270.068898]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1270.069504]  0xffffffffa0098099
[ 1270.069897]  ? _raw_spin_unlock+0x2c/0x50
[ 1270.070411]  ? __text_poke+0x2f2/0x4e0
[ 1270.070877]  ? devm_clk_match+0x40/0x40
[ 1270.071355]  ? devm_clk_hw_match+0x40/0x40
[ 1270.071859]  ? text_poke+0x5/0x60
[ 1270.072280]  text_poke+0x5/0x60
[ 1270.072675]  text_poke_bp_batch+0x1dc/0x2c0
[ 1270.073189]  ? text_poke+0x5/0x60
[ 1270.073602]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1270.074147]  ? of_clk_add_hw_provider+0x50/0x50
[ 1270.074723]  text_poke_queue+0xa7/0xc0
[ 1270.075195]  ftrace_replace_code+0xfd/0x170
[ 1270.075719]  ftrace_modify_all_code+0x1b1/0x270
[ 1270.076279]  arch_ftrace_update_code+0x9/0x10
[ 1270.076812]  ftrace_run_update_code+0x30/0xa0
[ 1270.077349]  ftrace_startup_enable+0x5e/0xa0
[ 1270.077875]  ftrace_startup+0x16d/0x240
[ 1270.078365]  register_ftrace_function+0x43/0x90
[ 1270.078923]  perf_ftrace_event_register+0xc1/0xf0
[ 1270.079503]  perf_trace_event_init+0xa0/0x4c0
[ 1270.080047]  perf_trace_init+0xda/0x160
[ 1270.080530]  perf_tp_event_init+0x57/0xa0
[ 1270.081029]  perf_try_init_event+0x83/0x270
[ 1270.081555]  perf_event_alloc+0xe3f/0x1c10
[ 1270.082062]  ? _raw_spin_unlock+0x2c/0x50
[ 1270.082563]  ? alloc_fd+0x20d/0x320
[ 1270.083015]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1270.083602]  ? write_comp_data+0x2f/0x90
[ 1270.084139]  __x64_sys_perf_event_open+0x26/0x30
[ 1270.084705]  do_syscall_64+0x37/0x80
[ 1270.085152]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1270.085769] RIP: 0033:0x7fac0740459d
[ 1270.086221] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1270.088395] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1270.089296] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1270.090150] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1270.090994] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1270.091839] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1270.092684] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1270.093565] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1270.093594] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1270.094447] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1270.094458] Call Trace:
[ 1270.094466]  dump_stack_lvl+0xa4/0xd3
[ 1270.095382] caller is debug_smp_processor_id+0x1c/0x20
[ 1270.096708]  dump_stack+0x15/0x17
[ 1270.098448]  check_preemption_disabled+0x167/0x180
[ 1270.099032]  ? do_nanosleep+0x123/0x2a0
[ 1270.099504]  ? ___might_sleep+0x170/0x170
[ 1270.100001]  debug_smp_processor_id+0x1c/0x20
[ 1270.100535]  perf_ftrace_function_call+0x7c/0x360
[ 1270.101116]  ? 0xffffffffa0098099
[ 1270.101527]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1270.102122]  ? finish_task_switch+0xab/0x2a0
[ 1270.102645]  ? __schedule+0x46e/0xb20
[ 1270.103110]  ? do_nanosleep+0x9c/0x2a0
[ 1270.103576]  0xffffffffa0098099
[ 1270.103970]  ? finish_task_switch+0xb0/0x2a0
[ 1270.104503]  ? do_nanosleep+0x107/0x2a0
[ 1270.104983]  ? __might_sleep+0x5/0x70
[ 1270.105435]  ? write_comp_data+0x2f/0x90
[ 1270.105922]  __might_sleep+0x5/0x70
[ 1270.106356]  do_nanosleep+0x123/0x2a0
[ 1270.106811]  ? __might_sleep+0x5/0x70
[ 1270.107262]  ? do_nanosleep+0x123/0x2a0
[ 1270.107735]  ? write_comp_data+0x2f/0x90
[ 1270.108229]  hrtimer_nanosleep+0xf7/0x1b0
[ 1270.108734]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1270.109305]  __x64_sys_nanosleep+0xfc/0x150
[ 1270.109831]  do_syscall_64+0x37/0x80
[ 1270.110278]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1270.110892] RIP: 0033:0x7fac073cca18
[ 1270.111334] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1270.113500] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1270.114397] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1270.115234] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1270.116070] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1270.116907] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1270.117745] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1270.118623] CPU: 1 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1270.118650] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1270.119513] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1270.120402] caller is debug_smp_processor_id+0x1c/0x20
[ 1270.121727] Call Trace:
[ 1270.122642]  dump_stack_lvl+0xa4/0xd3
[ 1270.123103]  dump_stack+0x15/0x17
[ 1270.123520]  check_preemption_disabled+0x167/0x180
[ 1270.124108]  ? text_poke+0x2b/0x60
[ 1270.124532]  ? do_sync_core+0x30/0x30
[ 1270.124989]  debug_smp_processor_id+0x1c/0x20
[ 1270.125525]  perf_ftrace_function_call+0x7c/0x360
[ 1270.126103]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1270.126678]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1270.127214]  ? perf_ftrace_function_call+0x4c/0x360
[ 1270.127818]  ? devm_clk_match+0x40/0x40
[ 1270.128297]  ? 0xffffffffa0098099
[ 1270.128710]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1270.129300]  ? devm_clk_hw_match+0x40/0x40
[ 1270.129812]  0xffffffffa0098099
[ 1270.130217]  ? _raw_spin_unlock+0x2c/0x50
[ 1270.130724]  ? devm_clk_hw_match+0x40/0x40
[ 1270.131228]  ? __text_poke+0x5/0x4e0
[ 1270.131674]  ? lock_is_held_type+0xe2/0x140
[ 1270.132193]  __text_poke+0x5/0x4e0
[ 1270.132619]  text_poke+0x2b/0x60
[ 1270.133024]  ? __text_poke+0x5/0x4e0
[ 1270.133465]  ? text_poke+0x2b/0x60
[ 1270.133895]  text_poke_bp_batch+0x1dc/0x2c0
[ 1270.134420]  ? of_clk_add_hw_provider+0x50/0x50
[ 1270.134984]  text_poke_queue+0xa7/0xc0
[ 1270.135457]  ftrace_replace_code+0xfd/0x170
[ 1270.135980]  ftrace_modify_all_code+0x1b1/0x270
[ 1270.136541]  arch_ftrace_update_code+0x9/0x10
[ 1270.137075]  ftrace_run_update_code+0x30/0xa0
[ 1270.137612]  ftrace_startup_enable+0x5e/0xa0
[ 1270.138141]  ftrace_startup+0x16d/0x240
[ 1270.138629]  register_ftrace_function+0x43/0x90
[ 1270.139188]  perf_ftrace_event_register+0xc1/0xf0
[ 1270.139768]  perf_trace_event_init+0xa0/0x4c0
[ 1270.140313]  perf_trace_init+0xda/0x160
[ 1270.140796]  perf_tp_event_init+0x57/0xa0
[ 1270.141294]  perf_try_init_event+0x83/0x270
[ 1270.141820]  perf_event_alloc+0xe3f/0x1c10
[ 1270.142325]  ? _raw_spin_unlock+0x2c/0x50
[ 1270.142824]  ? alloc_fd+0x20d/0x320
[ 1270.143274]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1270.143862]  ? write_comp_data+0x2f/0x90
[ 1270.144398]  __x64_sys_perf_event_open+0x26/0x30
[ 1270.144968]  do_syscall_64+0x37/0x80
[ 1270.145436]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1270.146051] RIP: 0033:0x7fac0740459d
[ 1270.146505] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1270.148676] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1270.149575] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1270.150425] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1270.151275] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1270.152117] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1270.152970] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1270.153848] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1270.153897] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1270.154755] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1270.154765] Call Trace:
[ 1270.154772]  dump_stack_lvl+0xa4/0xd3
[ 1270.155685] caller is debug_smp_processor_id+0x1c/0x20
[ 1270.157010]  dump_stack+0x15/0x17
[ 1270.158746]  check_preemption_disabled+0x167/0x180
[ 1270.159330]  ? __might_sleep+0x48/0x70
[ 1270.159790]  ? sched_show_task+0x70/0x70
[ 1270.160273]  debug_smp_processor_id+0x1c/0x20
[ 1270.160806]  perf_ftrace_function_call+0x7c/0x360
[ 1270.161386]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1270.161962]  ? do_nanosleep+0x123/0x2a0
[ 1270.162439]  ? perf_ftrace_function_call+0x4c/0x360
[ 1270.163038]  ? 0xffffffffa0098099
[ 1270.163449]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1270.164036]  ? finish_task_switch+0xab/0x2a0
[ 1270.164556]  ? __schedule+0x46e/0xb20
[ 1270.165012]  ? do_nanosleep+0x9c/0x2a0
[ 1270.165478]  0xffffffffa0098099
[ 1270.165868]  ? do_nanosleep+0x9c/0x2a0
[ 1270.166348]  ? do_nanosleep+0x107/0x2a0
[ 1270.166826]  ? ___might_sleep+0x5/0x170
[ 1270.167302]  ___might_sleep+0x5/0x170
[ 1270.167755]  __might_sleep+0x48/0x70
[ 1270.168196]  ? ___might_sleep+0x5/0x170
[ 1270.168666]  ? __might_sleep+0x48/0x70
[ 1270.169133]  do_nanosleep+0x123/0x2a0
[ 1270.169586]  ? write_comp_data+0x2f/0x90
[ 1270.170082]  hrtimer_nanosleep+0xf7/0x1b0
[ 1270.170597]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1270.171167]  __x64_sys_nanosleep+0xfc/0x150
[ 1270.171693]  do_syscall_64+0x37/0x80
[ 1270.172137]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1270.172751] RIP: 0033:0x7fac073cca18
[ 1270.173191] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1270.175360] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1270.176254] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1270.177095] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1270.177935] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1270.178782] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1270.179656] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1270.180552] CPU: 1 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1270.180610] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1270.181441] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1270.182358] caller is debug_smp_processor_id+0x1c/0x20
[ 1270.183669] Call Trace:
[ 1270.184578]  dump_stack_lvl+0xa4/0xd3
[ 1270.185039]  dump_stack+0x15/0x17
[ 1270.185453]  check_preemption_disabled+0x167/0x180
[ 1270.186041]  ? __text_poke+0xea/0x4e0
[ 1270.186505]  ? __pmd_alloc+0x420/0x420
[ 1270.186973]  debug_smp_processor_id+0x1c/0x20
[ 1270.187510]  perf_ftrace_function_call+0x7c/0x360
[ 1270.188091]  ? dump_stack+0x15/0x17
[ 1270.188526]  ? write_comp_data+0x2f/0x90
[ 1270.189010]  ? text_poke+0x2b/0x60
[ 1270.189434]  ? do_sync_core+0x30/0x30
[ 1270.189889]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1270.190491]  ? text_poke+0x2b/0x60
[ 1270.190922]  ? perf_ftrace_function_call+0x4c/0x360
[ 1270.191517]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1270.192092]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1270.192627]  ? perf_ftrace_function_call+0x4c/0x360
[ 1270.193233]  ? devm_clk_hw_match+0x40/0x40
[ 1270.193742]  0xffffffffa0098099
[ 1270.194168]  ? __get_locked_pte+0x5/0x290
[ 1270.194669]  __get_locked_pte+0x5/0x290
[ 1270.195149]  __text_poke+0xea/0x4e0
[ 1270.195584]  ? __get_locked_pte+0x5/0x290
[ 1270.196076]  ? __text_poke+0xea/0x4e0
[ 1270.196531]  ? devm_clk_hw_match+0x40/0x40
[ 1270.197039]  ? lock_is_held_type+0xe2/0x140
[ 1270.197557]  ? devm_clk_hw_match+0x40/0x40
[ 1270.198072]  text_poke+0x2b/0x60
[ 1270.198486]  text_poke_bp_batch+0x1dc/0x2c0
[ 1270.199007]  ? of_clk_add_hw_provider+0x50/0x50
[ 1270.199569]  text_poke_queue+0xa7/0xc0
[ 1270.200042]  ftrace_replace_code+0xfd/0x170
[ 1270.200565]  ftrace_modify_all_code+0x1b1/0x270
[ 1270.201125]  arch_ftrace_update_code+0x9/0x10
[ 1270.201660]  ftrace_run_update_code+0x30/0xa0
[ 1270.202207]  ftrace_startup_enable+0x5e/0xa0
[ 1270.202734]  ftrace_startup+0x16d/0x240
[ 1270.203220]  register_ftrace_function+0x43/0x90
[ 1270.203778]  perf_ftrace_event_register+0xc1/0xf0
[ 1270.204356]  perf_trace_event_init+0xa0/0x4c0
[ 1270.204900]  perf_trace_init+0xda/0x160
[ 1270.205383]  perf_tp_event_init+0x57/0xa0
[ 1270.205897]  perf_try_init_event+0x83/0x270
[ 1270.206432]  perf_event_alloc+0xe3f/0x1c10
[ 1270.206937]  ? _raw_spin_unlock+0x2c/0x50
[ 1270.207434]  ? alloc_fd+0x20d/0x320
[ 1270.207883]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1270.208470]  ? write_comp_data+0x2f/0x90
[ 1270.209016]  __x64_sys_perf_event_open+0x26/0x30
[ 1270.209583]  do_syscall_64+0x37/0x80
[ 1270.210029]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1270.210651] RIP: 0033:0x7fac0740459d
[ 1270.211095] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1270.213294] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1270.214208] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1270.215132] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1270.216057] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1270.216974] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1270.217896] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1270.218865] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1270.218903] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1270.219842] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1270.220814] caller is debug_smp_processor_id+0x1c/0x20
[ 1270.222293] Call Trace:
[ 1270.222302]  dump_stack_lvl+0xa4/0xd3
[ 1270.222325]  dump_stack+0x15/0x17
[ 1270.224229]  check_preemption_disabled+0x167/0x180
[ 1270.224885]  ? do_nanosleep+0x155/0x2a0
[ 1270.225407]  ? hrtimer_wakeup+0x40/0x40
[ 1270.225935]  debug_smp_processor_id+0x1c/0x20
[ 1270.226537]  perf_ftrace_function_call+0x7c/0x360
[ 1270.227181]  ? 0xffffffffa0098099
[ 1270.227636]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1270.228287]  ? finish_task_switch+0xab/0x2a0
[ 1270.228864]  ? __schedule+0x46e/0xb20
[ 1270.229371]  ? do_nanosleep+0x9c/0x2a0
[ 1270.229891]  ? do_nanosleep+0x9c/0x2a0
[ 1270.230417]  0xffffffffa0098099
[ 1270.230853]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1270.231490]  ? lock_is_held_type+0xe2/0x140
[ 1270.232061]  ? do_nanosleep+0x140/0x2a0
[ 1270.232589]  ? hrtimer_try_to_cancel+0x5/0x290
[ 1270.233189]  ? write_comp_data+0x2f/0x90
[ 1270.233725]  hrtimer_try_to_cancel+0x5/0x290
[ 1270.234319]  do_nanosleep+0x155/0x2a0
[ 1270.234819]  ? hrtimer_try_to_cancel+0x5/0x290
[ 1270.235416]  ? do_nanosleep+0x155/0x2a0
[ 1270.235937]  ? write_comp_data+0x2f/0x90
[ 1270.236479]  hrtimer_nanosleep+0xf7/0x1b0
[ 1270.237032]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1270.237659]  __x64_sys_nanosleep+0xfc/0x150
[ 1270.238241]  do_syscall_64+0x37/0x80
[ 1270.238730]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1270.239405] RIP: 0033:0x7fac073cca18
[ 1270.239889] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1270.242286] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1270.243275] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1270.244199] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1270.245128] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1270.246074] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1270.247010] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1270.247977] CPU: 1 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1270.248031] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1270.248917] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1270.249899] caller is debug_smp_processor_id+0x1c/0x20
[ 1270.251315] Call Trace:
[ 1270.251324]  dump_stack_lvl+0xa4/0xd3
[ 1270.252788]  dump_stack+0x15/0x17
[ 1270.253228]  check_preemption_disabled+0x167/0x180
[ 1270.253847]  ? _raw_spin_lock+0x17/0x50
[ 1270.254352]  ? trace_sched_waking+0xc0/0xc0
[ 1270.254871]  debug_smp_processor_id+0x1c/0x20
[ 1270.255409]  perf_ftrace_function_call+0x7c/0x360
[ 1270.255985]  ? write_comp_data+0x2f/0x90
[ 1270.256470]  ? __text_poke+0xea/0x4e0
[ 1270.256923]  ? __pmd_alloc+0x420/0x420
[ 1270.257389]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1270.257963]  ? __text_poke+0xea/0x4e0
[ 1270.258435]  ? perf_ftrace_function_call+0x4c/0x360
[ 1270.259034]  ? dump_stack+0x15/0x17
[ 1270.259468]  ? write_comp_data+0x2f/0x90
[ 1270.259952]  ? text_poke+0x2b/0x60
[ 1270.260393]  ? do_sync_core+0x30/0x30
[ 1270.260848]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1270.261423]  ? text_poke+0x2b/0x60
[ 1270.261866]  0xffffffffa0098099
[ 1270.262277]  ? devm_clk_hw_match+0x40/0x40
[ 1270.262786]  ? pmd_page_vaddr+0x2b/0x70
[ 1270.263265]  ? preempt_count_add+0x5/0xc0
[ 1270.263766]  preempt_count_add+0x5/0xc0
[ 1270.264239]  _raw_spin_lock+0x17/0x50
[ 1270.264695]  ? preempt_count_add+0x5/0xc0
[ 1270.265187]  ? _raw_spin_lock+0x17/0x50
[ 1270.265664]  __get_locked_pte+0x1a2/0x290
[ 1270.266163]  ? devm_clk_hw_match+0x40/0x40
[ 1270.266670]  __text_poke+0xea/0x4e0
[ 1270.267103]  ? devm_clk_hw_match+0x40/0x40
[ 1270.267609]  ? lock_is_held_type+0xe2/0x140
[ 1270.268125]  ? devm_clk_hw_match+0x40/0x40
[ 1270.268634]  text_poke+0x2b/0x60
[ 1270.269045]  text_poke_bp_batch+0x1dc/0x2c0
[ 1270.269567]  ? of_clk_add_hw_provider+0x50/0x50
[ 1270.270133]  text_poke_queue+0xa7/0xc0
[ 1270.270608]  ftrace_replace_code+0xfd/0x170
[ 1270.271131]  ftrace_modify_all_code+0x1b1/0x270
[ 1270.271692]  arch_ftrace_update_code+0x9/0x10
[ 1270.272226]  ftrace_run_update_code+0x30/0xa0
[ 1270.272772]  ftrace_startup_enable+0x5e/0xa0
[ 1270.273318]  ftrace_startup+0x16d/0x240
[ 1270.273804]  register_ftrace_function+0x43/0x90
[ 1270.274367]  perf_ftrace_event_register+0xc1/0xf0
[ 1270.274945]  perf_trace_event_init+0xa0/0x4c0
[ 1270.275489]  perf_trace_init+0xda/0x160
[ 1270.275971]  perf_tp_event_init+0x57/0xa0
[ 1270.276470]  perf_try_init_event+0x83/0x270
[ 1270.276995]  perf_event_alloc+0xe3f/0x1c10
[ 1270.277499]  ? _raw_spin_unlock+0x2c/0x50
[ 1270.277998]  ? alloc_fd+0x20d/0x320
[ 1270.278453]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1270.279039]  ? write_comp_data+0x2f/0x90
[ 1270.279576]  __x64_sys_perf_event_open+0x26/0x30
[ 1270.280141]  do_syscall_64+0x37/0x80
[ 1270.280586]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1270.281201] RIP: 0033:0x7fac0740459d
[ 1270.281643] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1270.283820] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1270.284722] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1270.285565] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1270.286412] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1270.287257] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1270.288101] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1270.288982] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1270.289034] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1270.289892] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1270.290837] caller is debug_smp_processor_id+0x1c/0x20
[ 1270.292196] Call Trace:
[ 1270.293122]  dump_stack_lvl+0xa4/0xd3
[ 1270.293601]  dump_stack+0x15/0x17
[ 1270.294033]  check_preemption_disabled+0x167/0x180
[ 1270.294653]  ? hrtimer_try_to_cancel+0x38/0x290
[ 1270.295233]  ? __hrtimer_get_remaining+0x80/0x80
[ 1270.295823]  debug_smp_processor_id+0x1c/0x20
[ 1270.296379]  perf_ftrace_function_call+0x7c/0x360
[ 1270.296976]  ? do_nanosleep+0x155/0x2a0
[ 1270.297468]  ? hrtimer_wakeup+0x40/0x40
[ 1270.297961]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1270.298562]  ? do_nanosleep+0x155/0x2a0
[ 1270.299057]  ? perf_ftrace_function_call+0x4c/0x360
[ 1270.299682]  ? 0xffffffffa0098099
[ 1270.300109]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1270.300724]  ? do_nanosleep+0x9c/0x2a0
[ 1270.301210]  0xffffffffa0098099
[ 1270.301616]  ? do_nanosleep+0x9c/0x2a0
[ 1270.302112]  ? do_nanosleep+0x9c/0x2a0
[ 1270.302608]  ? do_nanosleep+0x140/0x2a0
[ 1270.303112]  ? hrtimer_active+0x5/0xb0
[ 1270.303601]  ? do_nanosleep+0x140/0x2a0
[ 1270.304096]  hrtimer_active+0x5/0xb0
[ 1270.304560]  hrtimer_try_to_cancel+0x38/0x290
[ 1270.305121]  ? hrtimer_active+0x5/0xb0
[ 1270.305606]  ? hrtimer_try_to_cancel+0x38/0x290
[ 1270.306194]  ? do_nanosleep+0x9c/0x2a0
[ 1270.306679]  do_nanosleep+0x155/0x2a0
[ 1270.307151]  ? write_comp_data+0x2f/0x90
[ 1270.307666]  hrtimer_nanosleep+0xf7/0x1b0
[ 1270.308191]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1270.308783]  __x64_sys_nanosleep+0xfc/0x150
[ 1270.309330]  do_syscall_64+0x37/0x80
[ 1270.309792]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1270.310437] RIP: 0033:0x7fac073cca18
[ 1270.310896] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1270.313157] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1270.314096] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1270.314976] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1270.315855] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1270.316735] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1270.317616] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1270.318539] CPU: 1 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1270.318569] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1270.319437] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1270.320369] caller is debug_smp_processor_id+0x1c/0x20
[ 1270.321696] Call Trace:
[ 1270.322639]  dump_stack_lvl+0xa4/0xd3
[ 1270.323100]  dump_stack+0x15/0x17
[ 1270.323516]  check_preemption_disabled+0x167/0x180
[ 1270.324104]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1270.324638]  ? apply_paravirt+0x150/0x150
[ 1270.325135]  debug_smp_processor_id+0x1c/0x20
[ 1270.325673]  perf_ftrace_function_call+0x7c/0x360
[ 1270.326261]  ? devm_clk_hw_match+0x40/0x40
[ 1270.326770]  ? 0xffffffffa0098099
[ 1270.327183]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1270.327789]  0xffffffffa0098099
[ 1270.328181]  ? _raw_spin_unlock+0x2c/0x50
[ 1270.328685]  ? __text_poke+0x2f2/0x4e0
[ 1270.329152]  ? devm_clk_hw_match+0x40/0x40
[ 1270.329661]  ? of_clk_src_simple_get+0x20/0x20
[ 1270.330216]  ? text_poke+0x5/0x60
[ 1270.330638]  text_poke+0x5/0x60
[ 1270.331034]  text_poke_bp_batch+0x1dc/0x2c0
[ 1270.331550]  ? text_poke+0x5/0x60
[ 1270.331963]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1270.332503]  ? of_clk_add_hw_provider+0x50/0x50
[ 1270.333067]  text_poke_queue+0xa7/0xc0
[ 1270.333542]  ftrace_replace_code+0xfd/0x170
[ 1270.334070]  ftrace_modify_all_code+0x1b1/0x270
[ 1270.334633]  arch_ftrace_update_code+0x9/0x10
[ 1270.335169]  ftrace_run_update_code+0x30/0xa0
[ 1270.335707]  ftrace_startup_enable+0x5e/0xa0
[ 1270.336236]  ftrace_startup+0x16d/0x240
[ 1270.336749]  register_ftrace_function+0x43/0x90
[ 1270.337338]  perf_ftrace_event_register+0xc1/0xf0
[ 1270.337921]  perf_trace_event_init+0xa0/0x4c0
[ 1270.338478]  perf_trace_init+0xda/0x160
[ 1270.338962]  perf_tp_event_init+0x57/0xa0
[ 1270.339461]  perf_try_init_event+0x83/0x270
[ 1270.339988]  perf_event_alloc+0xe3f/0x1c10
[ 1270.340493]  ? _raw_spin_unlock+0x2c/0x50
[ 1270.340992]  ? alloc_fd+0x20d/0x320
[ 1270.341443]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1270.342035]  ? write_comp_data+0x2f/0x90
[ 1270.342586]  __x64_sys_perf_event_open+0x26/0x30
[ 1270.343154]  do_syscall_64+0x37/0x80
[ 1270.343602]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1270.344217] RIP: 0033:0x7fac0740459d
[ 1270.344660] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1270.346842] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1270.347742] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1270.348587] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1270.349431] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1270.350284] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1270.351127] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1270.352006] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1270.352922] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1270.354322] Call Trace:
[ 1270.354644]  dump_stack_lvl+0xa4/0xd3
[ 1270.355123]  dump_stack+0x15/0x17
[ 1270.355570]  check_preemption_disabled+0x167/0x180
[ 1270.356180]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1270.356777]  ? __bpf_trace_sys_enter+0x10/0x10
[ 1270.357347]  debug_smp_processor_id+0x1c/0x20
[ 1270.357905]  perf_ftrace_function_call+0x7c/0x360
[ 1270.358653]  ? write_comp_data+0x2f/0x90
[ 1270.359188]  ? write_comp_data+0x2f/0x90
[ 1270.359697]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1270.360297]  ? write_comp_data+0x2f/0x90
[ 1270.360806]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1270.361414]  0xffffffffa0098099
[ 1270.361819]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1270.362442]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1270.363131]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1270.363731]  syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1270.364400]  syscall_exit_to_user_mode+0xd/0x60
[ 1270.364977]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1270.365667]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1270.366339]  do_syscall_64+0x46/0x80
[ 1270.366820]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1270.367458] RIP: 0033:0x7fac073cca18
[ 1270.367918] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1270.370219] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1270.371153] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1270.372028] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1270.372905] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1270.373781] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1270.374666] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1275.062124] check_preemption_disabled: 2190768 callbacks suppressed
[ 1275.062153] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1275.064125] caller is debug_smp_processor_id+0x1c/0x20
[ 1275.064875] CPU: 0 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1275.065910] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1275.067469] Call Trace:
[ 1275.067882]  dump_stack_lvl+0xa4/0xd3
[ 1275.068503]  dump_stack+0x15/0x17
[ 1275.069032]  check_preemption_disabled+0x167/0x180
[ 1275.069828]  debug_smp_processor_id+0x1c/0x20
[ 1275.070504]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1275.071374]  perf_trace_buf_alloc+0x3d/0x100
[ 1275.072025]  ? insn_get_prefixes.part.1+0x38a/0x650
[ 1275.072744]  ? bad_get_user+0xd/0xd
[ 1275.073309]  perf_ftrace_function_call+0x209/0x360
[ 1275.074335]  ? 0xffffffffa0098099
[ 1275.075029]  0xffffffffa0098099
[ 1275.075698]  ? insn_get_prefixes.part.1+0x363/0x650
[ 1275.076468]  ? inat_get_opcode_attribute+0x5/0x20
[ 1275.077173]  ? write_comp_data+0x2f/0x90
[ 1275.077808]  inat_get_opcode_attribute+0x5/0x20
[ 1275.078520]  insn_get_prefixes.part.1+0x38a/0x650
[ 1275.079233]  ? inat_get_opcode_attribute+0x5/0x20
[ 1275.079923]  ? insn_get_prefixes.part.1+0x38a/0x650
[ 1275.080647]  ? write_comp_data+0x20/0x90
[ 1275.081358]  insn_get_opcode+0x1d5/0x3b0
[ 1275.082043]  insn_get_modrm+0x12b/0x2a0
[ 1275.082724]  insn_get_sib+0x122/0x140
[ 1275.083358]  insn_get_displacement+0x157/0x270
[ 1275.084092]  insn_get_immediate+0x181/0x570
[ 1275.084807]  insn_get_length+0x75/0x90
[ 1275.085435]  insn_decode+0x9b/0x170
[ 1275.086016]  ? update_iter+0x360/0x360
[ 1275.086617]  text_poke_loc_init+0x63/0x140
[ 1275.087460]  ? update_iter+0x360/0x360
[ 1275.088102]  text_poke_queue+0x84/0xc0
[ 1275.088747]  ftrace_replace_code+0xfd/0x170
[ 1275.089460]  ftrace_modify_all_code+0x1b1/0x270
[ 1275.090214]  arch_ftrace_update_code+0x9/0x10
[ 1275.090873]  ftrace_run_update_code+0x30/0xa0
[ 1275.091563]  ftrace_startup_enable+0x5e/0xa0
[ 1275.092240]  ftrace_startup+0x16d/0x240
[ 1275.092940]  register_ftrace_function+0x43/0x90
[ 1275.093653]  perf_ftrace_event_register+0xc1/0xf0
[ 1275.094430]  perf_trace_event_init+0xa0/0x4c0
[ 1275.095177]  perf_trace_init+0xda/0x160
[ 1275.095834]  perf_tp_event_init+0x57/0xa0
[ 1275.096488]  perf_try_init_event+0x83/0x270
[ 1275.097218]  perf_event_alloc+0xe3f/0x1c10
[ 1275.097830]  ? _raw_spin_unlock+0x2c/0x50
[ 1275.098474]  ? alloc_fd+0x20d/0x320
[ 1275.099184]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1275.099932]  ? write_comp_data+0x2f/0x90
[ 1275.101029]  __x64_sys_perf_event_open+0x26/0x30
[ 1275.101737]  do_syscall_64+0x37/0x80
[ 1275.102327]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1275.103061] RIP: 0033:0x7fac0740459d
[ 1275.103618] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1275.106157] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1275.107289] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1275.108325] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1275.109361] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1275.110405] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1275.111437] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1275.113080] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1275.113103] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1275.114312] caller is debug_smp_processor_id+0x1c/0x20
[ 1275.115323] caller is debug_smp_processor_id+0x1c/0x20
[ 1275.115965] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1275.117640] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1275.119058] Call Trace:
[ 1275.119410]  dump_stack_lvl+0xa4/0xd3
[ 1275.119935]  dump_stack+0x15/0x17
[ 1275.120394]  check_preemption_disabled+0x167/0x180
[ 1275.121030]  ? do_epoll_wait+0x3b3/0xd80
[ 1275.121555]  ? __mutex_lock+0x9f0/0x9f0
[ 1275.122098]  debug_smp_processor_id+0x1c/0x20
[ 1275.122684]  perf_ftrace_function_call+0x7c/0x360
[ 1275.123392]  ? ftrace_call+0x5/0x44
[ 1275.123907]  ? trace_hardirqs_on+0x6a/0x170
[ 1275.124541]  ? finish_task_switch+0xb0/0x2a0
[ 1275.125144]  ? finish_task_switch+0x70/0x2a0
[ 1275.125772]  ? trace_hardirqs_on+0x3f/0x170
[ 1275.126379]  ? finish_task_switch+0x70/0x2a0
[ 1275.127007]  ? preempt_count_sub+0x5/0xa0
[ 1275.127640]  0xffffffffa0098099
[ 1275.128123]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1275.128820]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1275.129616]  ? do_epoll_wait+0x36b/0xd80
[ 1275.130227]  ? mutex_lock_nested+0x5/0x20
[ 1275.130805]  ? write_comp_data+0x2f/0x90
[ 1275.131385]  mutex_lock_nested+0x5/0x20
[ 1275.131941]  do_epoll_wait+0x3b3/0xd80
[ 1275.132486]  ? mutex_lock_nested+0x5/0x20
[ 1275.133053]  ? do_epoll_wait+0x3b3/0xd80
[ 1275.133762]  ? wait_woken+0x90/0x90
[ 1275.134356]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1275.135015]  do_syscall_64+0x37/0x80
[ 1275.135543]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1275.136241] RIP: 0033:0x7f8a39143b20
[ 1275.136757] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1275.139162] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1275.140185] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1275.141134] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1275.142086] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1275.142993] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1275.143890] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1275.144953] CPU: 0 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1275.145043] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1275.145953] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1275.147088] caller is debug_smp_processor_id+0x1c/0x20
[ 1275.148488] Call Trace:
[ 1275.149492]  dump_stack_lvl+0xa4/0xd3
[ 1275.150071]  dump_stack+0x15/0x17
[ 1275.150579]  check_preemption_disabled+0x167/0x180
[ 1275.151315]  debug_smp_processor_id+0x1c/0x20
[ 1275.151944]  perf_trace_buf_alloc+0x98/0x100
[ 1275.152561]  ? insn_get_prefixes.part.1+0x38a/0x650
[ 1275.153243]  ? bad_get_user+0xd/0xd
[ 1275.153774]  perf_ftrace_function_call+0x209/0x360
[ 1275.154689]  ? 0xffffffffa0098099
[ 1275.155299]  0xffffffffa0098099
[ 1275.155886]  ? insn_get_prefixes.part.1+0x363/0x650
[ 1275.156610]  ? inat_get_opcode_attribute+0x5/0x20
[ 1275.157283]  ? write_comp_data+0x2f/0x90
[ 1275.157897]  inat_get_opcode_attribute+0x5/0x20
[ 1275.158598]  insn_get_prefixes.part.1+0x38a/0x650
[ 1275.159285]  ? inat_get_opcode_attribute+0x5/0x20
[ 1275.159947]  ? insn_get_prefixes.part.1+0x38a/0x650
[ 1275.160639]  ? write_comp_data+0x20/0x90
[ 1275.161286]  insn_get_opcode+0x1d5/0x3b0
[ 1275.161912]  insn_get_modrm+0x12b/0x2a0
[ 1275.162549]  insn_get_sib+0x122/0x140
[ 1275.163151]  insn_get_displacement+0x157/0x270
[ 1275.163832]  insn_get_immediate+0x181/0x570
[ 1275.164488]  insn_get_length+0x75/0x90
[ 1275.165070]  insn_decode+0x9b/0x170
[ 1275.165610]  ? update_iter+0x360/0x360
[ 1275.166183]  text_poke_loc_init+0x63/0x140
[ 1275.166931]  ? update_iter+0x360/0x360
[ 1275.167526]  text_poke_queue+0x84/0xc0
[ 1275.168123]  ftrace_replace_code+0xfd/0x170
[ 1275.168783]  ftrace_modify_all_code+0x1b1/0x270
[ 1275.169477]  arch_ftrace_update_code+0x9/0x10
[ 1275.170117]  ftrace_run_update_code+0x30/0xa0
[ 1275.170766]  ftrace_startup_enable+0x5e/0xa0
[ 1275.171404]  ftrace_startup+0x16d/0x240
[ 1275.172042]  register_ftrace_function+0x43/0x90
[ 1275.172713]  perf_ftrace_event_register+0xc1/0xf0
[ 1275.173406]  perf_trace_event_init+0xa0/0x4c0
[ 1275.174094]  perf_trace_init+0xda/0x160
[ 1275.174701]  perf_tp_event_init+0x57/0xa0
[ 1275.175309]  perf_try_init_event+0x83/0x270
[ 1275.175979]  perf_event_alloc+0xe3f/0x1c10
[ 1275.176566]  ? _raw_spin_unlock+0x2c/0x50
[ 1275.177161]  ? alloc_fd+0x20d/0x320
[ 1275.177785]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1275.178489]  ? write_comp_data+0x2f/0x90
[ 1275.179404]  __x64_sys_perf_event_open+0x26/0x30
[ 1275.180074]  do_syscall_64+0x37/0x80
[ 1275.180615]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1275.181320] RIP: 0033:0x7fac0740459d
[ 1275.181846] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1275.184244] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1275.185272] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1275.186228] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1275.187177] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1275.188128] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1275.189078] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1275.190261] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1275.190509] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1275.191309] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1275.192324] caller is debug_smp_processor_id+0x1c/0x20
[ 1275.193707] Call Trace:
[ 1275.194735]  dump_stack_lvl+0xa4/0xd3
[ 1275.195263]  dump_stack+0x15/0x17
[ 1275.195726]  check_preemption_disabled+0x167/0x180
[ 1275.196365]  ? mutex_lock_nested+0x1b/0x20
[ 1275.196913]  ? mutex_lock_io_nested+0x940/0x940
[ 1275.197535]  debug_smp_processor_id+0x1c/0x20
[ 1275.198124]  perf_ftrace_function_call+0x7c/0x360
[ 1275.198751]  ? perf_ftrace_function_call+0x4c/0x360
[ 1275.199445]  ? ftrace_call+0x5/0x44
[ 1275.199918]  ? trace_hardirqs_on+0x6a/0x170
[ 1275.200514]  ? finish_task_switch+0xb0/0x2a0
[ 1275.201080]  ? finish_task_switch+0x70/0x2a0
[ 1275.201671]  ? trace_hardirqs_on+0x3f/0x170
[ 1275.202232]  ? finish_task_switch+0x70/0x2a0
[ 1275.202869]  0xffffffffa0098099
[ 1275.203314]  ? 0xffffffffa0098099
[ 1275.203776]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1275.204417]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1275.205125]  ? do_epoll_wait+0x3b3/0xd80
[ 1275.205699]  ? __mutex_lock+0x5/0x9f0
[ 1275.206209]  ? mutex_lock_nested+0x5/0x20
[ 1275.206754]  ? write_comp_data+0x2f/0x90
[ 1275.207285]  __mutex_lock+0x5/0x9f0
[ 1275.207767]  mutex_lock_nested+0x1b/0x20
[ 1275.208302]  ? __mutex_lock+0x5/0x9f0
[ 1275.208798]  ? mutex_lock_nested+0x1b/0x20
[ 1275.209353]  do_epoll_wait+0x3b3/0xd80
[ 1275.210001]  ? wait_woken+0x90/0x90
[ 1275.210553]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1275.211184]  do_syscall_64+0x37/0x80
[ 1275.211685]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1275.212348] RIP: 0033:0x7f8a39143b20
[ 1275.212855] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1275.215143] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1275.216113] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1275.217014] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1275.217914] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1275.218814] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1275.219714] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1275.220779] CPU: 0 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1275.220937] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1275.221782] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1275.222898] caller is debug_smp_processor_id+0x1c/0x20
[ 1275.224291] Call Trace:
[ 1275.225297]  dump_stack_lvl+0xa4/0xd3
[ 1275.225873]  dump_stack+0x15/0x17
[ 1275.226381]  check_preemption_disabled+0x167/0x180
[ 1275.227121]  debug_smp_processor_id+0x1c/0x20
[ 1275.227751]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1275.228531]  perf_tp_event+0x331/0x4e0
[ 1275.229245]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1275.230161]  ? arch_local_irq_enable+0x10/0x12
[ 1275.230801]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1275.231499]  ? dump_stack_lvl+0xcc/0xd3
[ 1275.232096]  ? dump_stack+0x15/0x17
[ 1275.232617]  ? check_preemption_disabled+0x167/0x180
[ 1275.233347]  ? insn_get_prefixes.part.1+0x38a/0x650
[ 1275.234031]  ? bad_get_user+0xd/0xd
[ 1275.234583]  perf_ftrace_function_call+0x248/0x360
[ 1275.235271]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1275.235943]  ? perf_ftrace_function_call+0x248/0x360
[ 1275.236876]  ? 0xffffffffa0098099
[ 1275.237495]  0xffffffffa0098099
[ 1275.238090]  ? insn_get_prefixes.part.1+0x363/0x650
[ 1275.238819]  ? inat_get_opcode_attribute+0x5/0x20
[ 1275.239496]  ? write_comp_data+0x2f/0x90
[ 1275.240093]  inat_get_opcode_attribute+0x5/0x20
[ 1275.240750]  insn_get_prefixes.part.1+0x38a/0x650
[ 1275.241425]  ? inat_get_opcode_attribute+0x5/0x20
[ 1275.242096]  ? insn_get_prefixes.part.1+0x38a/0x650
[ 1275.242793]  ? write_comp_data+0x20/0x90
[ 1275.243445]  insn_get_opcode+0x1d5/0x3b0
[ 1275.244074]  insn_get_modrm+0x12b/0x2a0
[ 1275.244693]  insn_get_sib+0x122/0x140
[ 1275.245279]  insn_get_displacement+0x157/0x270
[ 1275.245964]  insn_get_immediate+0x181/0x570
[ 1275.246630]  insn_get_length+0x75/0x90
[ 1275.247217]  insn_decode+0x9b/0x170
[ 1275.247760]  ? update_iter+0x360/0x360
[ 1275.248315]  text_poke_loc_init+0x63/0x140
[ 1275.249065]  ? update_iter+0x360/0x360
[ 1275.249664]  text_poke_queue+0x84/0xc0
[ 1275.250267]  ftrace_replace_code+0xfd/0x170
[ 1275.250930]  ftrace_modify_all_code+0x1b1/0x270
[ 1275.251628]  arch_ftrace_update_code+0x9/0x10
[ 1275.252260]  ftrace_run_update_code+0x30/0xa0
[ 1275.252913]  ftrace_startup_enable+0x5e/0xa0
[ 1275.253554]  ftrace_startup+0x16d/0x240
[ 1275.254202]  register_ftrace_function+0x43/0x90
[ 1275.254877]  perf_ftrace_event_register+0xc1/0xf0
[ 1275.255576]  perf_trace_event_init+0xa0/0x4c0
[ 1275.256262]  perf_trace_init+0xda/0x160
[ 1275.256871]  perf_tp_event_init+0x57/0xa0
[ 1275.257481]  perf_try_init_event+0x83/0x270
[ 1275.258166]  perf_event_alloc+0xe3f/0x1c10
[ 1275.258763]  ? _raw_spin_unlock+0x2c/0x50
[ 1275.259361]  ? alloc_fd+0x20d/0x320
[ 1275.259988]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1275.260696]  ? write_comp_data+0x2f/0x90
[ 1275.261614]  __x64_sys_perf_event_open+0x26/0x30
[ 1275.262293]  do_syscall_64+0x37/0x80
[ 1275.262836]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1275.263545] RIP: 0033:0x7fac0740459d
[ 1275.264066] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1275.266466] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1275.267500] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1275.268453] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1275.269407] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1275.270365] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1275.271322] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1275.272502] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1275.272671] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1275.273530] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1275.274777] caller is debug_smp_processor_id+0x1c/0x20
[ 1275.276018] Call Trace:
[ 1275.277096]  dump_stack_lvl+0xa4/0xd3
[ 1275.277624]  dump_stack+0x15/0x17
[ 1275.278088]  check_preemption_disabled+0x167/0x180
[ 1275.278729]  ? do_epoll_wait+0x3bf/0xd80
[ 1275.279257]  ? __ia32_sys_fanotify_init+0x5c0/0x5c0
[ 1275.279922]  debug_smp_processor_id+0x1c/0x20
[ 1275.280510]  perf_ftrace_function_call+0x7c/0x360
[ 1275.281178]  ? ftrace_call+0x5/0x44
[ 1275.281725]  ? do_epoll_wait+0x3b3/0xd80
[ 1275.282311]  ? preempt_count_sub+0x5/0xa0
[ 1275.282909]  0xffffffffa0098099
[ 1275.283354]  ? __mutex_lock+0xfe/0x9f0
[ 1275.283883]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1275.284608]  ? do_epoll_wait+0x3b3/0xd80
[ 1275.285183]  ? ep_start_scan+0x5/0x100
[ 1275.285728]  ep_start_scan+0x5/0x100
[ 1275.286232]  do_epoll_wait+0x3bf/0xd80
[ 1275.286748]  ? ep_start_scan+0x5/0x100
[ 1275.287253]  ? do_epoll_wait+0x3bf/0xd80
[ 1275.287920]  ? wait_woken+0x90/0x90
[ 1275.288464]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1275.289085]  do_syscall_64+0x37/0x80
[ 1275.289585]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1275.290258] RIP: 0033:0x7f8a39143b20
[ 1275.290746] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1275.293020] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1275.293996] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1275.294921] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1275.295819] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1275.296724] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1275.297622] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1275.298691] CPU: 0 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1275.298794] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1275.299777] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1275.300812] caller is debug_smp_processor_id+0x1c/0x20
[ 1275.302395] Call Trace:
[ 1275.302445]  dump_stack_lvl+0xa4/0xd3
[ 1275.304114]  dump_stack+0x15/0x17
[ 1275.304672]  check_preemption_disabled+0x167/0x180
[ 1275.305430]  ? insn_get_prefixes.part.1+0x3d8/0x650
[ 1275.306184]  ? bad_get_user+0xd/0xd
[ 1275.306797]  debug_smp_processor_id+0x1c/0x20
[ 1275.307497]  perf_ftrace_function_call+0x7c/0x360
[ 1275.308554]  ? 0xffffffffa0098099
[ 1275.309285]  0xffffffffa0098099
[ 1275.309991]  ? insn_get_prefixes.part.1+0x39b/0x650
[ 1275.310806]  ? inat_get_opcode_attribute+0x5/0x20
[ 1275.311563]  ? write_comp_data+0x2f/0x90
[ 1275.312234]  inat_get_opcode_attribute+0x5/0x20
[ 1275.312955]  insn_get_prefixes.part.1+0x3d8/0x650
[ 1275.313696]  ? inat_get_opcode_attribute+0x5/0x20
[ 1275.314427]  ? insn_get_prefixes.part.1+0x3d8/0x650
[ 1275.315268]  ? write_comp_data+0x20/0x90
[ 1275.316131]  insn_get_opcode+0x1d5/0x3b0
[ 1275.316957]  insn_get_modrm+0x12b/0x2a0
[ 1275.317757]  insn_get_sib+0x122/0x140
[ 1275.318499]  insn_get_displacement+0x157/0x270
[ 1275.319342]  insn_get_immediate+0x181/0x570
[ 1275.320165]  insn_get_length+0x75/0x90
[ 1275.320896]  insn_decode+0x9b/0x170
[ 1275.321564]  ? update_iter+0x360/0x360
[ 1275.322267]  text_poke_loc_init+0x63/0x140
[ 1275.323214]  ? update_iter+0x360/0x360
[ 1275.323934]  text_poke_queue+0x84/0xc0
[ 1275.324657]  ftrace_replace_code+0xfd/0x170
[ 1275.325462]  ftrace_modify_all_code+0x1b1/0x270
[ 1275.326307]  arch_ftrace_update_code+0x9/0x10
[ 1275.327010]  ftrace_run_update_code+0x30/0xa0
[ 1275.327737]  ftrace_startup_enable+0x5e/0xa0
[ 1275.328453]  ftrace_startup+0x16d/0x240
[ 1275.329194]  register_ftrace_function+0x43/0x90
[ 1275.329946]  perf_ftrace_event_register+0xc1/0xf0
[ 1275.330732]  perf_trace_event_init+0xa0/0x4c0
[ 1275.331510]  perf_trace_init+0xda/0x160
[ 1275.332203]  perf_tp_event_init+0x57/0xa0
[ 1275.332894]  perf_try_init_event+0x83/0x270
[ 1275.333666]  perf_event_alloc+0xe3f/0x1c10
[ 1275.334320]  ? _raw_spin_unlock+0x2c/0x50
[ 1275.334985]  ? alloc_fd+0x20d/0x320
[ 1275.335724]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1275.336510]  ? write_comp_data+0x2f/0x90
[ 1275.337667]  __x64_sys_perf_event_open+0x26/0x30
[ 1275.338417]  do_syscall_64+0x37/0x80
[ 1275.339065]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1275.339841] RIP: 0033:0x7fac0740459d
[ 1275.340427] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1275.343022] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1275.344158] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1275.345196] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1275.346239] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1275.347283] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1275.348323] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1275.349706] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1275.349881] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1275.350752] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1275.350775] Call Trace:
[ 1275.350802]  dump_stack_lvl+0xa4/0xd3
[ 1275.350861]  dump_stack+0x15/0x17
[ 1275.350893]  check_preemption_disabled+0x167/0x180
[ 1275.351993] caller is debug_smp_processor_id+0x1c/0x20
[ 1275.353384]  ? ep_start_scan+0x68/0x100
[ 1275.356362]  ? _raw_read_lock_irq+0xa0/0xa0
[ 1275.356943]  debug_smp_processor_id+0x1c/0x20
[ 1275.357528]  perf_ftrace_function_call+0x7c/0x360
[ 1275.358162]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1275.358788]  ? do_epoll_wait+0x3bf/0xd80
[ 1275.359322]  ? perf_ftrace_function_call+0x4c/0x360
[ 1275.360008]  ? ftrace_call+0x5/0x44
[ 1275.360551]  ? do_epoll_wait+0x3b3/0xd80
[ 1275.361147]  0xffffffffa0098099
[ 1275.361623]  ? 0xffffffffa0098099
[ 1275.362095]  ? __mutex_lock+0xfe/0x9f0
[ 1275.362609]  ? do_epoll_wait+0x3b3/0xd80
[ 1275.363143]  ? ep_start_scan+0xe0/0x100
[ 1275.363690]  ? _raw_write_lock_irq+0x5/0x60
[ 1275.364254]  ? write_comp_data+0x2f/0x90
[ 1275.364802]  _raw_write_lock_irq+0x5/0x60
[ 1275.365346]  ep_start_scan+0x68/0x100
[ 1275.365851]  ? _raw_write_lock_irq+0x5/0x60
[ 1275.366411]  ? ep_start_scan+0x68/0x100
[ 1275.366965]  do_epoll_wait+0x3bf/0xd80
[ 1275.367611]  ? wait_woken+0x90/0x90
[ 1275.368156]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1275.368776]  do_syscall_64+0x37/0x80
[ 1275.369275]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1275.369934] RIP: 0033:0x7f8a39143b20
[ 1275.370426] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1275.372695] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1275.373663] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1275.374563] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1275.375458] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1275.376354] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1275.377247] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1275.378313] CPU: 0 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1275.378467] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1275.379399] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1275.380435] caller is debug_smp_processor_id+0x1c/0x20
[ 1275.382015] Call Trace:
[ 1275.382072]  dump_stack_lvl+0xa4/0xd3
[ 1275.383728]  dump_stack+0x15/0x17
[ 1275.384284]  check_preemption_disabled+0x167/0x180
[ 1275.385126]  debug_smp_processor_id+0x1c/0x20
[ 1275.385829]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1275.386755]  perf_trace_buf_alloc+0x3d/0x100
[ 1275.387442]  ? insn_get_prefixes.part.1+0x3d8/0x650
[ 1275.388192]  ? bad_get_user+0xd/0xd
[ 1275.388792]  perf_ftrace_function_call+0x209/0x360
[ 1275.389863]  ? 0xffffffffa0098099
[ 1275.390599]  0xffffffffa0098099
[ 1275.391308]  ? insn_get_prefixes.part.1+0x39b/0x650
[ 1275.392123]  ? inat_get_opcode_attribute+0x5/0x20
[ 1275.392868]  ? write_comp_data+0x2f/0x90
[ 1275.393539]  inat_get_opcode_attribute+0x5/0x20
[ 1275.394278]  insn_get_prefixes.part.1+0x3d8/0x650
[ 1275.395023]  ? inat_get_opcode_attribute+0x5/0x20
[ 1275.395752]  ? insn_get_prefixes.part.1+0x3d8/0x650
[ 1275.396516]  ? write_comp_data+0x20/0x90
[ 1275.397270]  insn_get_opcode+0x1d5/0x3b0
[ 1275.397991]  insn_get_modrm+0x12b/0x2a0
[ 1275.398704]  insn_get_sib+0x122/0x140
[ 1275.399372]  insn_get_displacement+0x157/0x270
[ 1275.400146]  insn_get_immediate+0x181/0x570
[ 1275.400900]  insn_get_length+0x75/0x90
[ 1275.401581]  insn_decode+0x9b/0x170
[ 1275.402197]  ? update_iter+0x360/0x360
[ 1275.402812]  text_poke_loc_init+0x63/0x140
[ 1275.403702]  ? update_iter+0x360/0x360
[ 1275.404382]  text_poke_queue+0x84/0xc0
[ 1275.405064]  ftrace_replace_code+0xfd/0x170
[ 1275.405820]  ftrace_modify_all_code+0x1b1/0x270
[ 1275.406608]  arch_ftrace_update_code+0x9/0x10
[ 1275.407305]  ftrace_run_update_code+0x30/0xa0
[ 1275.408036]  ftrace_startup_enable+0x5e/0xa0
[ 1275.408754]  ftrace_startup+0x16d/0x240
[ 1275.409496]  register_ftrace_function+0x43/0x90
[ 1275.410255]  perf_ftrace_event_register+0xc1/0xf0
[ 1275.411038]  perf_trace_event_init+0xa0/0x4c0
[ 1275.411816]  perf_trace_init+0xda/0x160
[ 1275.412511]  perf_tp_event_init+0x57/0xa0
[ 1275.413193]  perf_try_init_event+0x83/0x270
[ 1275.413967]  perf_event_alloc+0xe3f/0x1c10
[ 1275.414632]  ? _raw_spin_unlock+0x2c/0x50
[ 1275.415300]  ? alloc_fd+0x20d/0x320
[ 1275.416042]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1275.416831]  ? write_comp_data+0x2f/0x90
[ 1275.417995]  __x64_sys_perf_event_open+0x26/0x30
[ 1275.418745]  do_syscall_64+0x37/0x80
[ 1275.419354]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1275.420132] RIP: 0033:0x7fac0740459d
[ 1275.420717] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1275.423314] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1275.424451] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1275.425490] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1275.426534] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1275.427570] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1275.428607] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1275.430035] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1275.431077] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1275.432486] Call Trace:
[ 1275.432838]  dump_stack_lvl+0xa4/0xd3
[ 1275.433363]  dump_stack+0x15/0x17
[ 1275.433824]  check_preemption_disabled+0x167/0x180
[ 1275.434468]  ? do_epoll_wait+0x490/0xd80
[ 1275.434995]  ? ep_eventpoll_poll+0x30/0x30
[ 1275.435567]  debug_smp_processor_id+0x1c/0x20
[ 1275.436153]  perf_ftrace_function_call+0x7c/0x360
[ 1275.436798]  ? write_comp_data+0x2f/0x90
[ 1275.437341]  ? perf_trace_buf_update+0x70/0x70
[ 1275.437943]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1275.438586]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1275.439185]  ? _raw_write_unlock_irq+0x38/0x50
[ 1275.439781]  ? preempt_notifier_dec+0x20/0x20
[ 1275.440410]  ? ftrace_call+0x5/0x44
[ 1275.440945]  0xffffffffa0098099
[ 1275.441436]  ? preempt_count_sub+0x5/0xa0
[ 1275.442033]  ? ep_item_poll.isra.21+0x5/0x90
[ 1275.442612]  ? write_comp_data+0x2f/0x90
[ 1275.443162]  ep_item_poll.isra.21+0x5/0x90
[ 1275.443718]  do_epoll_wait+0x490/0xd80
[ 1275.444232]  ? ep_item_poll.isra.21+0x5/0x90
[ 1275.444800]  ? do_epoll_wait+0x490/0xd80
[ 1275.445467]  ? wait_woken+0x90/0x90
[ 1275.446011]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1275.446638]  do_syscall_64+0x37/0x80
[ 1275.447140]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1275.447801] RIP: 0033:0x7f8a39143b20
[ 1275.448288] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1275.450571] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1275.451538] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1275.452435] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1275.453331] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1275.454232] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1275.455137] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1280.066111] check_preemption_disabled: 850602 callbacks suppressed
[ 1280.066141] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1280.066256] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1280.067012] caller is debug_smp_processor_id+0x1c/0x20
[ 1280.067973] caller is debug_smp_processor_id+0x1c/0x20
[ 1280.069021] CPU: 0 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1280.071310] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1280.072820] Call Trace:
[ 1280.073206]  dump_stack_lvl+0xa4/0xd3
[ 1280.073788]  dump_stack+0x15/0x17
[ 1280.074292]  check_preemption_disabled+0x167/0x180
[ 1280.075040]  debug_smp_processor_id+0x1c/0x20
[ 1280.075672]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1280.076457]  perf_tp_event+0x331/0x4e0
[ 1280.077213]  ? preempt_count_sub+0x5/0xa0
[ 1280.077850]  ? preempt_count_sub+0x5/0xa0
[ 1280.078438]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1280.079156]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1280.079855]  ? ___ratelimit+0x36/0x1e0
[ 1280.080473]  ? __printk_ratelimit+0x21/0x30
[ 1280.081096]  ? check_preemption_disabled+0x10e/0x180
[ 1280.081864]  ? insn_get_immediate+0x181/0x570
[ 1280.082484]  ? insn_get_sib+0x140/0x140
[ 1280.083073]  perf_ftrace_function_call+0x248/0x360
[ 1280.083753]  ? perf_ftrace_function_call+0x248/0x360
[ 1280.084718]  ? 0xffffffffa0098099
[ 1280.085349]  0xffffffffa0098099
[ 1280.085896]  ? 0xffffffffa0098099
[ 1280.086444]  ? insn_get_immediate+0x49/0x570
[ 1280.087103]  ? insn_get_displacement+0x5/0x270
[ 1280.087746]  ? write_comp_data+0x2f/0x90
[ 1280.088349]  insn_get_displacement+0x5/0x270
[ 1280.088972]  insn_get_immediate+0x181/0x570
[ 1280.089583]  ? insn_get_displacement+0x5/0x270
[ 1280.090223]  ? insn_get_immediate+0x181/0x570
[ 1280.090916]  insn_get_length+0x75/0x90
[ 1280.091509]  insn_decode+0x9b/0x170
[ 1280.092058]  ? __traceiter_xfs_dir2_grow_inode+0x60/0x60
[ 1280.092830]  text_poke_loc_init+0x63/0x140
[ 1280.093601]  ? __traceiter_xfs_dir2_grow_inode+0x60/0x60
[ 1280.094409]  text_poke_queue+0x84/0xc0
[ 1280.095016]  ftrace_replace_code+0xfd/0x170
[ 1280.095688]  ftrace_modify_all_code+0x1b1/0x270
[ 1280.096391]  arch_ftrace_update_code+0x9/0x10
[ 1280.097023]  ftrace_run_update_code+0x30/0xa0
[ 1280.097681]  ftrace_startup_enable+0x5e/0xa0
[ 1280.098332]  ftrace_startup+0x16d/0x240
[ 1280.098984]  register_ftrace_function+0x43/0x90
[ 1280.099665]  perf_ftrace_event_register+0xc1/0xf0
[ 1280.100368]  perf_trace_event_init+0xa0/0x4c0
[ 1280.101063]  perf_trace_init+0xda/0x160
[ 1280.101682]  perf_tp_event_init+0x57/0xa0
[ 1280.102300]  perf_try_init_event+0x83/0x270
[ 1280.102986]  perf_event_alloc+0xe3f/0x1c10
[ 1280.103578]  ? _raw_spin_unlock+0x2c/0x50
[ 1280.104181]  ? alloc_fd+0x20d/0x320
[ 1280.104826]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1280.105539]  ? write_comp_data+0x2f/0x90
[ 1280.106506]  __x64_sys_perf_event_open+0x26/0x30
[ 1280.107185]  do_syscall_64+0x37/0x80
[ 1280.107732]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1280.108444] RIP: 0033:0x7fac0740459d
[ 1280.108975] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1280.111384] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1280.112420] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1280.113377] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1280.114336] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1280.115291] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1280.116245] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1280.117455] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1280.117637] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1280.118428] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1280.118450] Call Trace:
[ 1280.118479]  dump_stack_lvl+0xa4/0xd3
[ 1280.118545]  dump_stack+0x15/0x17
[ 1280.118581]  check_preemption_disabled+0x167/0x180
[ 1280.119657] caller is debug_smp_processor_id+0x1c/0x20
[ 1280.121036]  ? lock_timer_base+0x34/0x100
[ 1280.123998]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1280.124621]  debug_smp_processor_id+0x1c/0x20
[ 1280.125204]  perf_ftrace_function_call+0x7c/0x360
[ 1280.125848]  ? ftrace_ops_test+0x71/0xc0
[ 1280.126419]  ? ftrace_ops_test+0x71/0xc0
[ 1280.126958]  ? perf_trace_buf_update+0x70/0x70
[ 1280.127550]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1280.128191]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1280.128793]  ? write_comp_data+0x2f/0x90
[ 1280.129333]  ? perf_trace_buf_update+0x70/0x70
[ 1280.129989]  0xffffffffa0098099
[ 1280.130491]  ? ftrace_call+0x5/0x44
[ 1280.130991]  ? lock_timer_base+0xc0/0x100
[ 1280.131561]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1280.132154]  ? write_comp_data+0x2f/0x90
[ 1280.132703]  _raw_spin_lock_irqsave+0x5/0x70
[ 1280.133276]  lock_timer_base+0x34/0x100
[ 1280.133799]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1280.134386]  ? lock_timer_base+0x34/0x100
[ 1280.134983]  try_to_del_timer_sync+0x33/0x90
[ 1280.135547]  ? try_to_del_timer_sync+0x5/0x90
[ 1280.136158]  del_timer_sync+0xd3/0x130
[ 1280.136697]  schedule_timeout+0x34e/0x610
[ 1280.137294]  ? del_timer_sync+0x130/0x130
[ 1280.137873]  ? i915_init_ggtt+0x40/0x6b0
[ 1280.138473]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1280.139069]  ? rcu_gp_init+0x730/0x730
[ 1280.139578]  rcu_gp_kthread+0xdd/0x170
[ 1280.140135]  kthread+0x1e7/0x230
[ 1280.140596]  ? set_kthread_struct+0x80/0x80
[ 1280.141196]  ret_from_fork+0x1f/0x30
[ 1280.141885] CPU: 0 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1280.142100] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1280.142966] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1280.143934] caller is debug_smp_processor_id+0x1c/0x20
[ 1280.145506] Call Trace:
[ 1280.146553]  dump_stack_lvl+0xa4/0xd3
[ 1280.147212]  dump_stack+0x15/0x17
[ 1280.147771]  check_preemption_disabled+0x167/0x180
[ 1280.148529]  ? insn_get_displacement+0x157/0x270
[ 1280.149240]  ? insn_rip_relative+0xb0/0xb0
[ 1280.149936]  debug_smp_processor_id+0x1c/0x20
[ 1280.150637]  perf_ftrace_function_call+0x7c/0x360
[ 1280.151382]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1280.152125]  ? insn_get_immediate+0x181/0x570
[ 1280.152819]  ? perf_ftrace_function_call+0x4c/0x360
[ 1280.154032]  0xffffffffa0098099
[ 1280.154657]  ? 0xffffffffa0098099
[ 1280.155296]  ? insn_get_displacement+0x47/0x270
[ 1280.156069]  ? insn_get_sib+0x5/0x140
[ 1280.156671]  ? write_comp_data+0x2f/0x90
[ 1280.157344]  insn_get_sib+0x5/0x140
[ 1280.157925]  insn_get_displacement+0x157/0x270
[ 1280.158636]  ? insn_get_sib+0x5/0x140
[ 1280.159220]  ? insn_get_displacement+0x157/0x270
[ 1280.160022]  insn_get_immediate+0x181/0x570
[ 1280.160783]  insn_get_length+0x75/0x90
[ 1280.161451]  insn_decode+0x9b/0x170
[ 1280.162070]  ? __traceiter_xfs_dir2_grow_inode+0x60/0x60
[ 1280.162898]  text_poke_loc_init+0x63/0x140
[ 1280.163817]  ? __traceiter_xfs_dir2_grow_inode+0x60/0x60
[ 1280.164712]  text_poke_queue+0x84/0xc0
[ 1280.165401]  ftrace_replace_code+0xfd/0x170
[ 1280.166167]  ftrace_modify_all_code+0x1b1/0x270
[ 1280.166959]  arch_ftrace_update_code+0x9/0x10
[ 1280.167656]  ftrace_run_update_code+0x30/0xa0
[ 1280.168388]  ftrace_startup_enable+0x5e/0xa0
[ 1280.169111]  ftrace_startup+0x16d/0x240
[ 1280.169863]  register_ftrace_function+0x43/0x90
[ 1280.170624]  perf_ftrace_event_register+0xc1/0xf0
[ 1280.171406]  perf_trace_event_init+0xa0/0x4c0
[ 1280.172193]  perf_trace_init+0xda/0x160
[ 1280.172892]  perf_tp_event_init+0x57/0xa0
[ 1280.173578]  perf_try_init_event+0x83/0x270
[ 1280.174364]  perf_event_alloc+0xe3f/0x1c10
[ 1280.175010]  ? _raw_spin_unlock+0x2c/0x50
[ 1280.175679]  ? alloc_fd+0x20d/0x320
[ 1280.176433]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1280.177225]  ? write_comp_data+0x2f/0x90
[ 1280.178431]  __x64_sys_perf_event_open+0x26/0x30
[ 1280.179181]  do_syscall_64+0x37/0x80
[ 1280.179792]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1280.180566] RIP: 0033:0x7fac0740459d
[ 1280.181152] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1280.183729] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1280.184852] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1280.185886] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1280.186936] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1280.187984] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1280.189017] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1280.190427] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1280.190598] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1280.191392] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1280.192482] caller is debug_smp_processor_id+0x1c/0x20
[ 1280.193844] Call Trace:
[ 1280.194924]  dump_stack_lvl+0xa4/0xd3
[ 1280.195454]  dump_stack+0x15/0x17
[ 1280.195915]  check_preemption_disabled+0x167/0x180
[ 1280.196552]  ? prepare_to_swait_event+0x1b/0xf0
[ 1280.197145]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1280.197775]  debug_smp_processor_id+0x1c/0x20
[ 1280.198367]  perf_ftrace_function_call+0x7c/0x360
[ 1280.198982]  ? ftrace_ops_test+0x71/0xc0
[ 1280.199595]  ? trace_hardirqs_on+0x3f/0x170
[ 1280.200201]  ? write_comp_data+0x2f/0x90
[ 1280.200745]  ? perf_trace_buf_update+0x70/0x70
[ 1280.201341]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1280.202040]  0xffffffffa0098099
[ 1280.202530]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1280.203188]  ? del_timer_sync+0xde/0x130
[ 1280.203747]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1280.204378]  _raw_spin_lock_irqsave+0x5/0x70
[ 1280.204951]  prepare_to_swait_event+0x1b/0xf0
[ 1280.205535]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1280.206130]  ? prepare_to_swait_event+0x1b/0xf0
[ 1280.206760]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1280.207355]  ? rcu_gp_init+0x730/0x730
[ 1280.207869]  rcu_gp_kthread+0xdd/0x170
[ 1280.208425]  kthread+0x1e7/0x230
[ 1280.208886]  ? set_kthread_struct+0x80/0x80
[ 1280.209485]  ret_from_fork+0x1f/0x30
[ 1280.210170] CPU: 0 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1280.210247] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1280.211248] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1280.212220] caller is debug_smp_processor_id+0x1c/0x20
[ 1280.213795] Call Trace:
[ 1280.214849]  dump_stack_lvl+0xa4/0xd3
[ 1280.215508]  dump_stack+0x15/0x17
[ 1280.216066]  check_preemption_disabled+0x167/0x180
[ 1280.216911]  debug_smp_processor_id+0x1c/0x20
[ 1280.217612]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1280.218548]  perf_trace_buf_alloc+0x3d/0x100
[ 1280.219240]  ? insn_get_displacement+0x157/0x270
[ 1280.219951]  ? insn_rip_relative+0xb0/0xb0
[ 1280.220631]  perf_ftrace_function_call+0x209/0x360
[ 1280.221728]  ? 0xffffffffa0098099
[ 1280.222485]  0xffffffffa0098099
[ 1280.223103]  ? 0xffffffffa0098099
[ 1280.223741]  ? insn_get_displacement+0x47/0x270
[ 1280.224512]  ? insn_get_sib+0x5/0x140
[ 1280.225133]  ? write_comp_data+0x2f/0x90
[ 1280.225808]  insn_get_sib+0x5/0x140
[ 1280.226398]  insn_get_displacement+0x157/0x270
[ 1280.227107]  ? insn_get_sib+0x5/0x140
[ 1280.227691]  ? insn_get_displacement+0x157/0x270
[ 1280.228490]  insn_get_immediate+0x181/0x570
[ 1280.229252]  insn_get_length+0x75/0x90
[ 1280.229920]  insn_decode+0x9b/0x170
[ 1280.230545]  ? __traceiter_xfs_dir2_grow_inode+0x60/0x60
[ 1280.231369]  text_poke_loc_init+0x63/0x140
[ 1280.232279]  ? __traceiter_xfs_dir2_grow_inode+0x60/0x60
[ 1280.233175]  text_poke_queue+0x84/0xc0
[ 1280.233863]  ftrace_replace_code+0xfd/0x170
[ 1280.234638]  ftrace_modify_all_code+0x1b1/0x270
[ 1280.235430]  arch_ftrace_update_code+0x9/0x10
[ 1280.236127]  ftrace_run_update_code+0x30/0xa0
[ 1280.236859]  ftrace_startup_enable+0x5e/0xa0
[ 1280.237581]  ftrace_startup+0x16d/0x240
[ 1280.238342]  register_ftrace_function+0x43/0x90
[ 1280.239098]  perf_ftrace_event_register+0xc1/0xf0
[ 1280.239881]  perf_trace_event_init+0xa0/0x4c0
[ 1280.240671]  perf_trace_init+0xda/0x160
[ 1280.241371]  perf_tp_event_init+0x57/0xa0
[ 1280.242062]  perf_try_init_event+0x83/0x270
[ 1280.242854]  perf_event_alloc+0xe3f/0x1c10
[ 1280.243502]  ? _raw_spin_unlock+0x2c/0x50
[ 1280.244171]  ? alloc_fd+0x20d/0x320
[ 1280.244926]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1280.245718]  ? write_comp_data+0x2f/0x90
[ 1280.246932]  __x64_sys_perf_event_open+0x26/0x30
[ 1280.247689]  do_syscall_64+0x37/0x80
[ 1280.248300]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1280.249074] RIP: 0033:0x7fac0740459d
[ 1280.249660] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1280.252247] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1280.253376] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1280.254413] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1280.255448] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1280.256486] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1280.257520] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1280.258935] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1280.259108] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1280.259954] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1280.260976] caller is debug_smp_processor_id+0x1c/0x20
[ 1280.262366] Call Trace:
[ 1280.262395]  dump_stack_lvl+0xa4/0xd3
[ 1280.262460]  dump_stack+0x15/0x17
[ 1280.262497]  check_preemption_disabled+0x167/0x180
[ 1280.262536]  ? finish_swait+0x41/0x80
[ 1280.265467]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1280.266101]  debug_smp_processor_id+0x1c/0x20
[ 1280.266688]  perf_ftrace_function_call+0x7c/0x360
[ 1280.267303]  ? ftrace_ops_test+0x71/0xc0
[ 1280.267844]  ? rcu_advance_cbs+0x70/0x70
[ 1280.268402]  ? write_comp_data+0x2f/0x90
[ 1280.268942]  ? perf_trace_buf_update+0x70/0x70
[ 1280.269538]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1280.270186]  ? write_comp_data+0x2f/0x90
[ 1280.270728]  ? perf_trace_buf_update+0x70/0x70
[ 1280.271321]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1280.272020]  0xffffffffa0098099
[ 1280.272520]  ? trace_hardirqs_on+0x3f/0x170
[ 1280.273146]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1280.273778]  _raw_spin_lock_irqsave+0x5/0x70
[ 1280.274355]  finish_swait+0x41/0x80
[ 1280.274837]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1280.275422]  ? finish_swait+0x41/0x80
[ 1280.275952]  rcu_gp_fqs_loop+0x2da/0x410
[ 1280.276547]  ? rcu_gp_init+0x730/0x730
[ 1280.277057]  rcu_gp_kthread+0xdd/0x170
[ 1280.277614]  kthread+0x1e7/0x230
[ 1280.278079]  ? set_kthread_struct+0x80/0x80
[ 1280.278680]  ret_from_fork+0x1f/0x30
[ 1280.279357] CPU: 0 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1280.279436] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1280.280354] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1280.281331] caller is debug_smp_processor_id+0x1c/0x20
[ 1280.282796] Call Trace:
[ 1280.282833]  dump_stack_lvl+0xa4/0xd3
[ 1280.282916]  dump_stack+0x15/0x17
[ 1280.284805]  check_preemption_disabled+0x167/0x180
[ 1280.285554]  debug_smp_processor_id+0x1c/0x20
[ 1280.286191]  perf_trace_buf_alloc+0x98/0x100
[ 1280.286815]  ? insn_get_displacement+0x157/0x270
[ 1280.287467]  ? insn_rip_relative+0xb0/0xb0
[ 1280.288077]  perf_ftrace_function_call+0x209/0x360
[ 1280.288995]  ? 0xffffffffa0098099
[ 1280.289623]  0xffffffffa0098099
[ 1280.290162]  ? 0xffffffffa0098099
[ 1280.290717]  ? insn_get_displacement+0x47/0x270
[ 1280.291405]  ? insn_get_sib+0x5/0x140
[ 1280.291947]  ? write_comp_data+0x2f/0x90
[ 1280.292546]  insn_get_sib+0x5/0x140
[ 1280.293068]  insn_get_displacement+0x157/0x270
[ 1280.293709]  ? insn_get_sib+0x5/0x140
[ 1280.294241]  ? insn_get_displacement+0x157/0x270
[ 1280.294952]  insn_get_immediate+0x181/0x570
[ 1280.295622]  insn_get_length+0x75/0x90
[ 1280.296212]  insn_decode+0x9b/0x170
[ 1280.296759]  ? __traceiter_xfs_dir2_grow_inode+0x60/0x60
[ 1280.297511]  text_poke_loc_init+0x63/0x140
[ 1280.298284]  ? __traceiter_xfs_dir2_grow_inode+0x60/0x60
[ 1280.299081]  text_poke_queue+0x84/0xc0
[ 1280.299686]  ftrace_replace_code+0xfd/0x170
[ 1280.300357]  ftrace_modify_all_code+0x1b1/0x270
[ 1280.301056]  arch_ftrace_update_code+0x9/0x10
[ 1280.301688]  ftrace_run_update_code+0x30/0xa0
[ 1280.302347]  ftrace_startup_enable+0x5e/0xa0
[ 1280.302990]  ftrace_startup+0x16d/0x240
[ 1280.303641]  register_ftrace_function+0x43/0x90
[ 1280.304319]  perf_ftrace_event_register+0xc1/0xf0
[ 1280.305018]  perf_trace_event_init+0xa0/0x4c0
[ 1280.305711]  perf_trace_init+0xda/0x160
[ 1280.306328]  perf_tp_event_init+0x57/0xa0
[ 1280.306940]  perf_try_init_event+0x83/0x270
[ 1280.307623]  perf_event_alloc+0xe3f/0x1c10
[ 1280.308210]  ? _raw_spin_unlock+0x2c/0x50
[ 1280.308811]  ? alloc_fd+0x20d/0x320
[ 1280.309451]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1280.310165]  ? write_comp_data+0x2f/0x90
[ 1280.311125]  __x64_sys_perf_event_open+0x26/0x30
[ 1280.311801]  do_syscall_64+0x37/0x80
[ 1280.312347]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1280.313054] RIP: 0033:0x7fac0740459d
[ 1280.313583] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1280.315980] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1280.317012] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1280.317965] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1280.318941] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1280.319899] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1280.320847] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1280.322062] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1280.322235] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1280.323032] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1280.324046] caller is debug_smp_processor_id+0x1c/0x20
[ 1280.325408] Call Trace:
[ 1280.326437]  dump_stack_lvl+0xa4/0xd3
[ 1280.326971]  dump_stack+0x15/0x17
[ 1280.327431]  check_preemption_disabled+0x167/0x180
[ 1280.328065]  ? force_qs_rnp+0xd0/0x2c0
[ 1280.328566]  ? preempt_schedule+0x30/0x30
[ 1280.329125]  debug_smp_processor_id+0x1c/0x20
[ 1280.329708]  perf_ftrace_function_call+0x7c/0x360
[ 1280.330352]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1280.331023]  ? ftrace_ops_test+0x71/0xc0
[ 1280.331565]  ? rcu_advance_cbs+0x70/0x70
[ 1280.332124]  ? write_comp_data+0x2f/0x90
[ 1280.332665]  ? perf_trace_buf_update+0x70/0x70
[ 1280.333258]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1280.333900]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1280.334506]  ? force_qs_rnp+0xcb/0x2c0
[ 1280.335017]  ? sched_show_task+0x70/0x70
[ 1280.335576]  ? rcu_gp_torture_wait+0x20/0x20
[ 1280.336161]  0xffffffffa0098099
[ 1280.336595]  ? rcu_exp_wait_wake+0x4c0/0x4c0
[ 1280.337294]  ? __cond_resched+0x5/0x30
[ 1280.337823]  ? ___might_sleep+0x143/0x170
[ 1280.338373]  __cond_resched+0x5/0x30
[ 1280.338864]  force_qs_rnp+0xd0/0x2c0
[ 1280.339355]  ? __cond_resched+0x5/0x30
[ 1280.339855]  ? force_qs_rnp+0xd0/0x2c0
[ 1280.340427]  rcu_gp_fqs_loop+0x2eb/0x410
[ 1280.341021]  ? rcu_gp_init+0x730/0x730
[ 1280.341530]  rcu_gp_kthread+0xdd/0x170
[ 1280.342092]  kthread+0x1e7/0x230
[ 1280.342554]  ? set_kthread_struct+0x80/0x80
[ 1280.343153]  ret_from_fork+0x1f/0x30
[ 1280.343829] CPU: 0 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1280.343939] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1280.344867] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1280.346166] caller is debug_smp_processor_id+0x1c/0x20
[ 1280.347675] Call Trace:
[ 1280.348764]  dump_stack_lvl+0xa4/0xd3
[ 1280.349383]  dump_stack+0x15/0x17
[ 1280.349914]  check_preemption_disabled+0x167/0x180
[ 1280.350720]  debug_smp_processor_id+0x1c/0x20
[ 1280.351395]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1280.352232]  perf_tp_event+0x331/0x4e0
[ 1280.353206]  ? arch_local_irq_enable+0x10/0x12
[ 1280.353902]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1280.354655]  ? dump_stack_lvl+0xcc/0xd3
[ 1280.355271]  ? dump_stack+0x15/0x17
[ 1280.355795]  ? check_preemption_disabled+0x167/0x180
[ 1280.356543]  ? insn_get_displacement+0x157/0x270
[ 1280.357197]  ? insn_rip_relative+0xb0/0xb0
[ 1280.357821]  perf_ftrace_function_call+0x248/0x360
[ 1280.358513]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1280.359194]  ? perf_ftrace_function_call+0x248/0x360
[ 1280.360160]  ? 0xffffffffa0098099
[ 1280.360792]  0xffffffffa0098099
[ 1280.361328]  ? 0xffffffffa0098099
[ 1280.361891]  ? insn_get_displacement+0x47/0x270
[ 1280.362598]  ? insn_get_sib+0x5/0x140
[ 1280.363144]  ? write_comp_data+0x2f/0x90
[ 1280.363752]  insn_get_sib+0x5/0x140
[ 1280.364277]  insn_get_displacement+0x157/0x270
[ 1280.364922]  ? insn_get_sib+0x5/0x140
[ 1280.365456]  ? insn_get_displacement+0x157/0x270
[ 1280.366178]  insn_get_immediate+0x181/0x570
[ 1280.366851]  insn_get_length+0x75/0x90
[ 1280.367446]  insn_decode+0x9b/0x170
[ 1280.367995]  ? __traceiter_xfs_dir2_grow_inode+0x60/0x60
[ 1280.368753]  text_poke_loc_init+0x63/0x140
[ 1280.369525]  ? __traceiter_xfs_dir2_grow_inode+0x60/0x60
[ 1280.370341]  text_poke_queue+0x84/0xc0
[ 1280.370952]  ftrace_replace_code+0xfd/0x170
[ 1280.371626]  ftrace_modify_all_code+0x1b1/0x270
[ 1280.372330]  arch_ftrace_update_code+0x9/0x10
[ 1280.372965]  ftrace_run_update_code+0x30/0xa0
[ 1280.373622]  ftrace_startup_enable+0x5e/0xa0
[ 1280.374285]  ftrace_startup+0x16d/0x240
[ 1280.374940]  register_ftrace_function+0x43/0x90
[ 1280.375622]  perf_ftrace_event_register+0xc1/0xf0
[ 1280.376327]  perf_trace_event_init+0xa0/0x4c0
[ 1280.377025]  perf_trace_init+0xda/0x160
[ 1280.377644]  perf_tp_event_init+0x57/0xa0
[ 1280.378274]  perf_try_init_event+0x83/0x270
[ 1280.378962]  perf_event_alloc+0xe3f/0x1c10
[ 1280.379555]  ? _raw_spin_unlock+0x2c/0x50
[ 1280.380160]  ? alloc_fd+0x20d/0x320
[ 1280.380805]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1280.381517]  ? write_comp_data+0x2f/0x90
[ 1280.382490]  __x64_sys_perf_event_open+0x26/0x30
[ 1280.383170]  do_syscall_64+0x37/0x80
[ 1280.383718]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1280.384430] RIP: 0033:0x7fac0740459d
[ 1280.384963] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1280.387383] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1280.388422] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1280.389379] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1280.390350] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1280.391310] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1280.392267] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1280.393482] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1280.394533] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1280.395951] Call Trace:
[ 1280.396308]  dump_stack_lvl+0xa4/0xd3
[ 1280.396848]  dump_stack+0x15/0x17
[ 1280.397316]  check_preemption_disabled+0x167/0x180
[ 1280.397963]  ? do_epoll_wait+0x3b3/0xd80
[ 1280.398504]  ? __mutex_lock+0x9f0/0x9f0
[ 1280.399054]  debug_smp_processor_id+0x1c/0x20
[ 1280.399652]  perf_ftrace_function_call+0x7c/0x360
[ 1280.400344]  ? ftrace_call+0x5/0x44
[ 1280.400824]  ? trace_hardirqs_on+0x6a/0x170
[ 1280.401433]  ? finish_task_switch+0xb0/0x2a0
[ 1280.402008]  ? finish_task_switch+0x70/0x2a0
[ 1280.402613]  ? trace_hardirqs_on+0x3f/0x170
[ 1280.403176]  ? finish_task_switch+0x70/0x2a0
[ 1280.403778]  ? preempt_count_sub+0x5/0xa0
[ 1280.404385]  0xffffffffa0098099
[ 1280.404837]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1280.405492]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1280.406253]  ? do_epoll_wait+0x36b/0xd80
[ 1280.406824]  ? mutex_lock_nested+0x5/0x20
[ 1280.407378]  ? write_comp_data+0x2f/0x90
[ 1280.407936]  mutex_lock_nested+0x5/0x20
[ 1280.408468]  do_epoll_wait+0x3b3/0xd80
[ 1280.408991]  ? mutex_lock_nested+0x5/0x20
[ 1280.409535]  ? do_epoll_wait+0x3b3/0xd80
[ 1280.410239]  ? wait_woken+0x90/0x90
[ 1280.410806]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1280.411445]  do_syscall_64+0x37/0x80
[ 1280.411954]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1280.412628] RIP: 0033:0x7f8a39143b20
[ 1280.413125] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1280.415417] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1280.416395] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1280.417315] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1280.418221] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1280.419127] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1280.420031] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1285.070120] check_preemption_disabled: 716836 callbacks suppressed
[ 1285.070155] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1285.070257] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1285.071135] caller is debug_smp_processor_id+0x1c/0x20
[ 1285.072100] caller is debug_smp_processor_id+0x1c/0x20
[ 1285.073236] CPU: 0 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1285.075668] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1285.077286] Call Trace:
[ 1285.077717]  dump_stack_lvl+0xa4/0xd3
[ 1285.078395]  dump_stack+0x15/0x17
[ 1285.078962]  check_preemption_disabled+0x167/0x180
[ 1285.079717]  ? ftrace_replace_code+0xfd/0x170
[ 1285.080394]  ? jump_label_transform+0x70/0x70
[ 1285.081124]  debug_smp_processor_id+0x1c/0x20
[ 1285.081823]  perf_ftrace_function_call+0x7c/0x360
[ 1285.082560]  ? write_comp_data+0x2f/0x90
[ 1285.083248]  ? write_comp_data+0x2f/0x90
[ 1285.083937]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1285.084680]  ? write_comp_data+0x2f/0x90
[ 1285.085367]  ? write_comp_data+0x2f/0x90
[ 1285.086063]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1285.086946]  0xffffffffa0098099
[ 1285.087523]  ? write_comp_data+0x2f/0x90
[ 1285.088311]  ? attribute_container_remove_device+0x170/0x170
[ 1285.089199]  ? text_poke_queue+0x5/0xc0
[ 1285.089825]  ? __fentry__+0x10/0x10
[ 1285.090448]  text_poke_queue+0x5/0xc0
[ 1285.091051]  ftrace_replace_code+0xfd/0x170
[ 1285.091724]  ? text_poke_queue+0x5/0xc0
[ 1285.092333]  ? ftrace_replace_code+0xfd/0x170
[ 1285.093111]  ftrace_modify_all_code+0x1b1/0x270
[ 1285.093897]  arch_ftrace_update_code+0x9/0x10
[ 1285.094626]  ftrace_run_update_code+0x30/0xa0
[ 1285.095395]  ftrace_startup_enable+0x5e/0xa0
[ 1285.096152]  ftrace_startup+0x16d/0x240
[ 1285.096935]  register_ftrace_function+0x43/0x90
[ 1285.097729]  perf_ftrace_event_register+0xc1/0xf0
[ 1285.098532]  perf_trace_event_init+0xa0/0x4c0
[ 1285.099312]  perf_trace_init+0xda/0x160
[ 1285.100007]  perf_tp_event_init+0x57/0xa0
[ 1285.100692]  perf_try_init_event+0x83/0x270
[ 1285.101467]  perf_event_alloc+0xe3f/0x1c10
[ 1285.102121]  ? _raw_spin_unlock+0x2c/0x50
[ 1285.102793]  ? alloc_fd+0x20d/0x320
[ 1285.103539]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1285.104406]  ? write_comp_data+0x2f/0x90
[ 1285.105677]  __x64_sys_perf_event_open+0x26/0x30
[ 1285.106514]  do_syscall_64+0x37/0x80
[ 1285.107184]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1285.108041] RIP: 0033:0x7fac0740459d
[ 1285.108689] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1285.111576] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1285.112832] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1285.113984] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1285.115138] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1285.116287] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1285.117436] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1285.118967] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1285.119146] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1285.120024] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1285.121245] caller is debug_smp_processor_id+0x1c/0x20
[ 1285.122738] Call Trace:
[ 1285.122769]  dump_stack_lvl+0xa4/0xd3
[ 1285.122836]  dump_stack+0x15/0x17
[ 1285.122872]  check_preemption_disabled+0x167/0x180
[ 1285.122911]  ? lock_timer_base+0x34/0x100
[ 1285.126209]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1285.126884]  debug_smp_processor_id+0x1c/0x20
[ 1285.127519]  perf_ftrace_function_call+0x7c/0x360
[ 1285.128218]  ? ftrace_ops_test+0x71/0xc0
[ 1285.128831]  ? ftrace_ops_test+0x71/0xc0
[ 1285.129416]  ? perf_trace_buf_update+0x70/0x70
[ 1285.130066]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1285.130764]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1285.131419]  ? write_comp_data+0x2f/0x90
[ 1285.132007]  ? perf_trace_buf_update+0x70/0x70
[ 1285.132718]  0xffffffffa0098099
[ 1285.133256]  ? ftrace_call+0x5/0x44
[ 1285.133796]  ? lock_timer_base+0xc0/0x100
[ 1285.134415]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1285.135062]  ? write_comp_data+0x2f/0x90
[ 1285.135658]  _raw_spin_lock_irqsave+0x5/0x70
[ 1285.136283]  lock_timer_base+0x34/0x100
[ 1285.136850]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1285.137484]  ? lock_timer_base+0x34/0x100
[ 1285.138133]  try_to_del_timer_sync+0x33/0x90
[ 1285.138750]  ? try_to_del_timer_sync+0x5/0x90
[ 1285.139412]  del_timer_sync+0xd3/0x130
[ 1285.139998]  schedule_timeout+0x34e/0x610
[ 1285.140644]  ? del_timer_sync+0x130/0x130
[ 1285.141272]  ? i915_init_ggtt+0x40/0x6b0
[ 1285.141917]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1285.142564]  ? rcu_gp_init+0x730/0x730
[ 1285.143120]  rcu_gp_kthread+0xdd/0x170
[ 1285.143723]  kthread+0x1e7/0x230
[ 1285.144223]  ? set_kthread_struct+0x80/0x80
[ 1285.144874]  ret_from_fork+0x1f/0x30
[ 1285.145597] CPU: 0 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1285.145709] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1285.146802] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1285.146838] Call Trace:
[ 1285.146889]  dump_stack_lvl+0xa4/0xd3
[ 1285.147932] caller is debug_smp_processor_id+0x1c/0x20
[ 1285.149755]  dump_stack+0x15/0x17
[ 1285.152010]  check_preemption_disabled+0x167/0x180
[ 1285.152933]  debug_smp_processor_id+0x1c/0x20
[ 1285.153701]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1285.154717]  perf_trace_buf_alloc+0x3d/0x100
[ 1285.155471]  ? ftrace_replace_code+0xfd/0x170
[ 1285.156216]  ? jump_label_transform+0x70/0x70
[ 1285.157001]  perf_ftrace_function_call+0x209/0x360
[ 1285.158176]  ? 0xffffffffa0098099
[ 1285.158978]  0xffffffffa0098099
[ 1285.159610]  ? write_comp_data+0x2f/0x90
[ 1285.160470]  ? attribute_container_remove_device+0x170/0x170
[ 1285.161432]  ? text_poke_queue+0x5/0xc0
[ 1285.162126]  ? __fentry__+0x10/0x10
[ 1285.162799]  text_poke_queue+0x5/0xc0
[ 1285.163464]  ftrace_replace_code+0xfd/0x170
[ 1285.164206]  ? text_poke_queue+0x5/0xc0
[ 1285.164878]  ? ftrace_replace_code+0xfd/0x170
[ 1285.165731]  ftrace_modify_all_code+0x1b1/0x270
[ 1285.166601]  arch_ftrace_update_code+0x9/0x10
[ 1285.167368]  ftrace_run_update_code+0x30/0xa0
[ 1285.168180]  ftrace_startup_enable+0x5e/0xa0
[ 1285.168969]  ftrace_startup+0x16d/0x240
[ 1285.169782]  register_ftrace_function+0x43/0x90
[ 1285.170621]  perf_ftrace_event_register+0xc1/0xf0
[ 1285.171476]  perf_trace_event_init+0xa0/0x4c0
[ 1285.172339]  perf_trace_init+0xda/0x160
[ 1285.173100]  perf_tp_event_init+0x57/0xa0
[ 1285.173850]  perf_try_init_event+0x83/0x270
[ 1285.174710]  perf_event_alloc+0xe3f/0x1c10
[ 1285.175422]  ? _raw_spin_unlock+0x2c/0x50
[ 1285.176156]  ? alloc_fd+0x20d/0x320
[ 1285.176968]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1285.177835]  ? write_comp_data+0x2f/0x90
[ 1285.179109]  __x64_sys_perf_event_open+0x26/0x30
[ 1285.179933]  do_syscall_64+0x37/0x80
[ 1285.180600]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1285.181455] RIP: 0033:0x7fac0740459d
[ 1285.182103] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1285.184973] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1285.186224] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1285.187369] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1285.188516] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1285.189661] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1285.190812] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1285.192328] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1285.192495] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1285.193381] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1285.194669] caller is debug_smp_processor_id+0x1c/0x20
[ 1285.196024] Call Trace:
[ 1285.197149]  dump_stack_lvl+0xa4/0xd3
[ 1285.197721]  dump_stack+0x15/0x17
[ 1285.198230]  check_preemption_disabled+0x167/0x180
[ 1285.198922]  ? prepare_to_swait_event+0x1b/0xf0
[ 1285.199569]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1285.200245]  debug_smp_processor_id+0x1c/0x20
[ 1285.200881]  perf_ftrace_function_call+0x7c/0x360
[ 1285.201551]  ? ftrace_ops_test+0x71/0xc0
[ 1285.202213]  ? trace_hardirqs_on+0x3f/0x170
[ 1285.202864]  ? write_comp_data+0x2f/0x90
[ 1285.203451]  ? perf_trace_buf_update+0x70/0x70
[ 1285.204099]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1285.204854]  0xffffffffa0098099
[ 1285.205372]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1285.206093]  ? del_timer_sync+0xde/0x130
[ 1285.206702]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1285.207384]  _raw_spin_lock_irqsave+0x5/0x70
[ 1285.208008]  prepare_to_swait_event+0x1b/0xf0
[ 1285.208643]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1285.209280]  ? prepare_to_swait_event+0x1b/0xf0
[ 1285.209964]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1285.210609]  ? rcu_gp_init+0x730/0x730
[ 1285.211163]  rcu_gp_kthread+0xdd/0x170
[ 1285.211765]  kthread+0x1e7/0x230
[ 1285.212265]  ? set_kthread_struct+0x80/0x80
[ 1285.212916]  ret_from_fork+0x1f/0x30
[ 1285.213637] CPU: 0 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1285.213739] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1285.214766] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1285.214792] Call Trace:
[ 1285.214827]  dump_stack_lvl+0xa4/0xd3
[ 1285.215896] caller is debug_smp_processor_id+0x1c/0x20
[ 1285.217584]  dump_stack+0x15/0x17
[ 1285.219715]  check_preemption_disabled+0x167/0x180
[ 1285.220536]  debug_smp_processor_id+0x1c/0x20
[ 1285.221237]  perf_trace_buf_alloc+0x98/0x100
[ 1285.221925]  ? ftrace_replace_code+0xfd/0x170
[ 1285.222618]  ? jump_label_transform+0x70/0x70
[ 1285.223330]  perf_ftrace_function_call+0x209/0x360
[ 1285.224320]  ? 0xffffffffa0098099
[ 1285.224998]  0xffffffffa0098099
[ 1285.225556]  ? write_comp_data+0x2f/0x90
[ 1285.226314]  ? attribute_container_remove_device+0x170/0x170
[ 1285.227200]  ? text_poke_queue+0x5/0xc0
[ 1285.227827]  ? __fentry__+0x10/0x10
[ 1285.228426]  text_poke_queue+0x5/0xc0
[ 1285.229030]  ftrace_replace_code+0xfd/0x170
[ 1285.229705]  ? text_poke_queue+0x5/0xc0
[ 1285.230327]  ? ftrace_replace_code+0xfd/0x170
[ 1285.231083]  ftrace_modify_all_code+0x1b1/0x270
[ 1285.231854]  arch_ftrace_update_code+0x9/0x10
[ 1285.232552]  ftrace_run_update_code+0x30/0xa0
[ 1285.233274]  ftrace_startup_enable+0x5e/0xa0
[ 1285.233982]  ftrace_startup+0x16d/0x240
[ 1285.234702]  register_ftrace_function+0x43/0x90
[ 1285.235450]  perf_ftrace_event_register+0xc1/0xf0
[ 1285.236224]  perf_trace_event_init+0xa0/0x4c0
[ 1285.236985]  perf_trace_init+0xda/0x160
[ 1285.237661]  perf_tp_event_init+0x57/0xa0
[ 1285.238343]  perf_try_init_event+0x83/0x270
[ 1285.239090]  perf_event_alloc+0xe3f/0x1c10
[ 1285.239741]  ? _raw_spin_unlock+0x2c/0x50
[ 1285.240404]  ? alloc_fd+0x20d/0x320
[ 1285.241098]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1285.241880]  ? write_comp_data+0x2f/0x90
[ 1285.242909]  __x64_sys_perf_event_open+0x26/0x30
[ 1285.243657]  do_syscall_64+0x37/0x80
[ 1285.244260]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1285.245046] RIP: 0033:0x7fac0740459d
[ 1285.245629] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1285.248317] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1285.249461] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1285.250531] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1285.251595] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1285.252659] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1285.253722] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1285.255046] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1285.255210] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1285.256095] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1285.257232] caller is debug_smp_processor_id+0x1c/0x20
[ 1285.258739] Call Trace:
[ 1285.258767]  dump_stack_lvl+0xa4/0xd3
[ 1285.258832]  dump_stack+0x15/0x17
[ 1285.258868]  check_preemption_disabled+0x167/0x180
[ 1285.258908]  ? finish_swait+0x41/0x80
[ 1285.262123]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1285.262799]  debug_smp_processor_id+0x1c/0x20
[ 1285.263436]  perf_ftrace_function_call+0x7c/0x360
[ 1285.264106]  ? ftrace_ops_test+0x71/0xc0
[ 1285.264691]  ? rcu_advance_cbs+0x70/0x70
[ 1285.265296]  ? write_comp_data+0x2f/0x90
[ 1285.265892]  ? perf_trace_buf_update+0x70/0x70
[ 1285.266545]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1285.267243]  ? write_comp_data+0x2f/0x90
[ 1285.267834]  ? perf_trace_buf_update+0x70/0x70
[ 1285.268486]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1285.269238]  0xffffffffa0098099
[ 1285.269774]  ? trace_hardirqs_on+0x3f/0x170
[ 1285.270460]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1285.271143]  _raw_spin_lock_irqsave+0x5/0x70
[ 1285.271770]  finish_swait+0x41/0x80
[ 1285.272298]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1285.272936]  ? finish_swait+0x41/0x80
[ 1285.273508]  rcu_gp_fqs_loop+0x2da/0x410
[ 1285.274156]  ? rcu_gp_init+0x730/0x730
[ 1285.274712]  rcu_gp_kthread+0xdd/0x170
[ 1285.275330]  kthread+0x1e7/0x230
[ 1285.275829]  ? set_kthread_struct+0x80/0x80
[ 1285.276478]  ret_from_fork+0x1f/0x30
[ 1285.277198] CPU: 0 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1285.277301] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1285.278320] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1285.278346] Call Trace:
[ 1285.278382]  dump_stack_lvl+0xa4/0xd3
[ 1285.279452] caller is debug_smp_processor_id+0x1c/0x20
[ 1285.281143]  dump_stack+0x15/0x17
[ 1285.283292]  check_preemption_disabled+0x167/0x180
[ 1285.284115]  debug_smp_processor_id+0x1c/0x20
[ 1285.284817]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1285.285687]  perf_tp_event+0x331/0x4e0
[ 1285.286509]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1285.287523]  ? arch_local_irq_enable+0x10/0x12
[ 1285.288247]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1285.289020]  ? dump_stack_lvl+0xcc/0xd3
[ 1285.289719]  ? ftrace_replace_code+0xfd/0x170
[ 1285.290419]  ? jump_label_transform+0x70/0x70
[ 1285.291171]  perf_ftrace_function_call+0x248/0x360
[ 1285.291946]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1285.292658]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1285.293406]  ? perf_ftrace_function_call+0x248/0x360
[ 1285.294449]  ? 0xffffffffa0098099
[ 1285.295129]  0xffffffffa0098099
[ 1285.295688]  ? write_comp_data+0x2f/0x90
[ 1285.296433]  ? attribute_container_remove_device+0x170/0x170
[ 1285.297315]  ? text_poke_queue+0x5/0xc0
[ 1285.297942]  ? __fentry__+0x10/0x10
[ 1285.298546]  text_poke_queue+0x5/0xc0
[ 1285.299153]  ftrace_replace_code+0xfd/0x170
[ 1285.299829]  ? text_poke_queue+0x5/0xc0
[ 1285.300444]  ? ftrace_replace_code+0xfd/0x170
[ 1285.301202]  ftrace_modify_all_code+0x1b1/0x270
[ 1285.301975]  arch_ftrace_update_code+0x9/0x10
[ 1285.302678]  ftrace_run_update_code+0x30/0xa0
[ 1285.303400]  ftrace_startup_enable+0x5e/0xa0
[ 1285.304111]  ftrace_startup+0x16d/0x240
[ 1285.304823]  register_ftrace_function+0x43/0x90
[ 1285.305578]  perf_ftrace_event_register+0xc1/0xf0
[ 1285.306365]  perf_trace_event_init+0xa0/0x4c0
[ 1285.307126]  perf_trace_init+0xda/0x160
[ 1285.307806]  perf_tp_event_init+0x57/0xa0
[ 1285.308481]  perf_try_init_event+0x83/0x270
[ 1285.309230]  perf_event_alloc+0xe3f/0x1c10
[ 1285.309883]  ? _raw_spin_unlock+0x2c/0x50
[ 1285.310556]  ? alloc_fd+0x20d/0x320
[ 1285.311250]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1285.312034]  ? write_comp_data+0x2f/0x90
[ 1285.313054]  __x64_sys_perf_event_open+0x26/0x30
[ 1285.313801]  do_syscall_64+0x37/0x80
[ 1285.314561]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1285.315364] RIP: 0033:0x7fac0740459d
[ 1285.315948] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1285.318634] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1285.319785] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1285.320847] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1285.321911] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1285.322979] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1285.324042] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1285.325357] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1285.325538] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1285.326425] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1285.326446] Call Trace:
[ 1285.326474]  dump_stack_lvl+0xa4/0xd3
[ 1285.326539]  dump_stack+0x15/0x17
[ 1285.326576]  check_preemption_disabled+0x167/0x180
[ 1285.327783] caller is debug_smp_processor_id+0x1c/0x20
[ 1285.329286]  ? force_qs_rnp+0xd0/0x2c0
[ 1285.332500]  ? preempt_schedule+0x30/0x30
[ 1285.333106]  debug_smp_processor_id+0x1c/0x20
[ 1285.333741]  perf_ftrace_function_call+0x7c/0x360
[ 1285.334419]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1285.335114]  ? ftrace_ops_test+0x71/0xc0
[ 1285.335699]  ? rcu_advance_cbs+0x70/0x70
[ 1285.336302]  ? write_comp_data+0x2f/0x90
[ 1285.336888]  ? perf_trace_buf_update+0x70/0x70
[ 1285.337532]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1285.338233]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1285.338872]  ? force_qs_rnp+0xcb/0x2c0
[ 1285.339424]  ? sched_show_task+0x70/0x70
[ 1285.340027]  ? rcu_gp_torture_wait+0x20/0x20
[ 1285.340660]  0xffffffffa0098099
[ 1285.341130]  ? rcu_exp_wait_wake+0x4c0/0x4c0
[ 1285.341879]  ? __cond_resched+0x5/0x30
[ 1285.342457]  ? ___might_sleep+0x143/0x170
[ 1285.343045]  __cond_resched+0x5/0x30
[ 1285.343577]  force_qs_rnp+0xd0/0x2c0
[ 1285.344108]  ? __cond_resched+0x5/0x30
[ 1285.344661]  ? force_qs_rnp+0xd0/0x2c0
[ 1285.345304]  rcu_gp_fqs_loop+0x2eb/0x410
[ 1285.345946]  ? rcu_gp_init+0x730/0x730
[ 1285.346510]  rcu_gp_kthread+0xdd/0x170
[ 1285.347111]  kthread+0x1e7/0x230
[ 1285.347609]  ? set_kthread_struct+0x80/0x80
[ 1285.348256]  ret_from_fork+0x1f/0x30
[ 1285.348979] CPU: 0 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1285.349113] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1285.350199] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1285.350235] Call Trace:
[ 1285.350287]  dump_stack_lvl+0xa4/0xd3
[ 1285.351426] caller is debug_smp_processor_id+0x1c/0x20
[ 1285.353277]  dump_stack+0x15/0x17
[ 1285.355552]  check_preemption_disabled+0x167/0x180
[ 1285.356391]  ? ftrace_replace_code+0xfd/0x170
[ 1285.357143]  ? jump_label_transform+0x70/0x70
[ 1285.357949]  debug_smp_processor_id+0x1c/0x20
[ 1285.358730]  perf_ftrace_function_call+0x7c/0x360
[ 1285.359542]  ? write_comp_data+0x2f/0x90
[ 1285.360338]  ? write_comp_data+0x2f/0x90
[ 1285.361165]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1285.362054]  ? write_comp_data+0x2f/0x90
[ 1285.362883]  ? write_comp_data+0x2f/0x90
[ 1285.363710]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1285.364758]  0xffffffffa0098099
[ 1285.365436]  ? write_comp_data+0x2f/0x90
[ 1285.366366]  ? attribute_container_class_device_del+0x30/0x30
[ 1285.367413]  ? text_poke_queue+0x5/0xc0
[ 1285.368159]  ? __fentry__+0x10/0x10
[ 1285.368885]  text_poke_queue+0x5/0xc0
[ 1285.369599]  ftrace_replace_code+0xfd/0x170
[ 1285.370386]  ? text_poke_queue+0x5/0xc0
[ 1285.371061]  ? ftrace_replace_code+0xfd/0x170
[ 1285.371917]  ftrace_modify_all_code+0x1b1/0x270
[ 1285.372793]  arch_ftrace_update_code+0x9/0x10
[ 1285.373563]  ftrace_run_update_code+0x30/0xa0
[ 1285.374378]  ftrace_startup_enable+0x5e/0xa0
[ 1285.375173]  ftrace_startup+0x16d/0x240
[ 1285.375990]  register_ftrace_function+0x43/0x90
[ 1285.376823]  perf_ftrace_event_register+0xc1/0xf0
[ 1285.377684]  perf_trace_event_init+0xa0/0x4c0
[ 1285.378559]  perf_trace_init+0xda/0x160
[ 1285.379324]  perf_tp_event_init+0x57/0xa0
[ 1285.380079]  perf_try_init_event+0x83/0x270
[ 1285.380929]  perf_event_alloc+0xe3f/0x1c10
[ 1285.381643]  ? _raw_spin_unlock+0x2c/0x50
[ 1285.382392]  ? alloc_fd+0x20d/0x320
[ 1285.383208]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1285.384077]  ? write_comp_data+0x2f/0x90
[ 1285.385345]  __x64_sys_perf_event_open+0x26/0x30
[ 1285.386180]  do_syscall_64+0x37/0x80
[ 1285.386852]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1285.387711] RIP: 0033:0x7fac0740459d
[ 1285.388359] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1285.391270] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1285.392526] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1285.393678] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1285.394834] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1285.395987] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1285.397139] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1285.398670] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1285.399822] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1285.401377] Call Trace:
[ 1285.401764]  dump_stack_lvl+0xa4/0xd3
[ 1285.402359]  dump_stack+0x15/0x17
[ 1285.402867]  check_preemption_disabled+0x167/0x180
[ 1285.403571]  ? do_epoll_wait+0x3b3/0xd80
[ 1285.404153]  ? __mutex_lock+0x9f0/0x9f0
[ 1285.404748]  debug_smp_processor_id+0x1c/0x20
[ 1285.405396]  perf_ftrace_function_call+0x7c/0x360
[ 1285.406154]  ? ftrace_call+0x5/0x44
[ 1285.406677]  ? trace_hardirqs_on+0x6a/0x170
[ 1285.407338]  ? finish_task_switch+0xb0/0x2a0
[ 1285.407962]  ? finish_task_switch+0x70/0x2a0
[ 1285.408613]  ? trace_hardirqs_on+0x3f/0x170
[ 1285.409226]  ? finish_task_switch+0x70/0x2a0
[ 1285.409878]  ? preempt_count_sub+0x5/0xa0
[ 1285.410535]  0xffffffffa0098099
[ 1285.411025]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1285.411733]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1285.412551]  ? do_epoll_wait+0x36b/0xd80
[ 1285.413167]  ? mutex_lock_nested+0x5/0x20
[ 1285.413767]  ? write_comp_data+0x2f/0x90
[ 1285.414376]  mutex_lock_nested+0x5/0x20
[ 1285.414952]  do_epoll_wait+0x3b3/0xd80
[ 1285.415518]  ? mutex_lock_nested+0x5/0x20
[ 1285.416106]  ? do_epoll_wait+0x3b3/0xd80
[ 1285.416850]  ? wait_woken+0x90/0x90
[ 1285.417453]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1285.418145]  do_syscall_64+0x37/0x80
[ 1285.418695]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1285.419424] RIP: 0033:0x7f8a39143b20
[ 1285.419961] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1285.422468] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1285.423534] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1285.424519] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1285.425506] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1285.426496] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1285.427484] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1290.073976] check_preemption_disabled: 1503888 callbacks suppressed
[ 1290.073992] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1290.073994] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[ 1290.074814] caller is debug_smp_processor_id+0x1c/0x20
[ 1290.075823] caller is debug_smp_processor_id+0x1c/0x20
[ 1290.076812] CPU: 1 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1290.078961] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1290.080337] Call Trace:
[ 1290.080655]  dump_stack_lvl+0xa4/0xd3
[ 1290.081129]  dump_stack+0x15/0x17
[ 1290.081555]  check_preemption_disabled+0x167/0x180
[ 1290.082160]  ? insn_get_length+0x75/0x90
[ 1290.082658]  ? insn_get_displacement+0x270/0x270
[ 1290.083240]  debug_smp_processor_id+0x1c/0x20
[ 1290.083791]  perf_ftrace_function_call+0x7c/0x360
[ 1290.084381]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.084971]  ? insn_decode+0x9b/0x170
[ 1290.085437]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.086049]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.086645]  ? text_poke_loc_init+0x63/0x140
[ 1290.087185]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.087800]  ? ___ratelimit+0x36/0x1e0
[ 1290.088288]  ? __printk_ratelimit+0x21/0x30
[ 1290.088820]  ? write_comp_data+0x2f/0x90
[ 1290.089341]  ? math_error+0x170/0x170
[ 1290.089813]  ? insn_get_length+0x41/0x90
[ 1290.090321]  ? insn_get_immediate+0x5/0x570
[ 1290.090850]  ? write_comp_data+0x2f/0x90
[ 1290.091352]  ? insn_get_immediate+0x5/0x570
[ 1290.091881]  ? insn_get_length+0x75/0x90
[ 1290.092378]  ? insn_get_immediate+0x5/0x570
[ 1290.092905]  ? insn_get_length+0x75/0x90
[ 1290.093407]  ? insn_decode+0x9b/0x170
[ 1290.093877]  ? math_error+0x170/0x170
[ 1290.094347]  ? text_poke_loc_init+0x63/0x140
[ 1290.094910]  ? math_error+0x170/0x170
[ 1290.095384]  ? text_poke_queue+0x84/0xc0
[ 1290.095891]  ? ftrace_replace_code+0xfd/0x170
[ 1290.096448]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1290.097044]  ? arch_ftrace_update_code+0x9/0x10
[ 1290.097614]  ? ftrace_run_update_code+0x30/0xa0
[ 1290.098199]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1290.098729]  ? unregister_ftrace_function+0x25/0x50
[ 1290.099342]  ? perf_ftrace_event_register+0x89/0xf0
[ 1290.099953]  ? perf_tp_event_init+0xa0/0xa0
[ 1290.100486]  ? perf_trace_destroy+0x37/0x60
[ 1290.101020]  ? tp_perf_event_destroy+0x15/0x20
[ 1290.101582]  ? _free_event+0xfc/0x7d0
[ 1290.102062]  ? put_event+0x37/0x50
[ 1290.102504]  ? perf_event_release_kernel+0x2f4/0x370
[ 1290.103134]  ? perf_event_release_kernel+0x370/0x370
[ 1290.103757]  ? perf_release+0x19/0x20
[ 1290.104224]  ? __fput+0x12d/0x460
[ 1290.104667]  ? ____fput+0x1a/0x20
[ 1290.105095]  ? task_work_run+0x8e/0xf0
[ 1290.105582]  ? do_exit+0x616/0x1310
[ 1290.106039]  ? write_comp_data+0x2f/0x90
[ 1290.106573]  ? do_group_exit+0x7e/0x130
[ 1290.107083]  ? get_signal+0x249/0x13c0
[ 1290.107579]  ? get_signal+0x5/0x13c0
[ 1290.108050]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1290.108706]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1290.109347]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1290.109996]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1290.110629]  ? do_syscall_64+0x46/0x80
[ 1290.111115]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1290.111804] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1290.111857] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1290.112773] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1290.113718] caller is debug_smp_processor_id+0x1c/0x20
[ 1290.115079] Call Trace:
[ 1290.115088]  dump_stack_lvl+0xa4/0xd3
[ 1290.116480]  dump_stack+0x15/0x17
[ 1290.116904]  check_preemption_disabled+0x167/0x180
[ 1290.117503]  ? ext4_match.isra.25.part.26+0x6b/0x90
[ 1290.118113]  ? fscrypt_fname_alloc_buffer+0x60/0x60
[ 1290.118743]  debug_smp_processor_id+0x1c/0x20
[ 1290.119290]  perf_ftrace_function_call+0x7c/0x360
[ 1290.119882]  ? write_comp_data+0x2f/0x90
[ 1290.120377]  ? ext4_search_dir+0x94/0x140
[ 1290.120881]  ? ext4_rec_len_to_disk.part.20+0x10/0x10
[ 1290.121509]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.122100]  ? ext4_search_dir+0x94/0x140
[ 1290.122605]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.123214]  ? write_comp_data+0x2f/0x90
[ 1290.123710]  ? __ext4_find_entry+0x48b/0x7a0
[ 1290.124244]  ? ext4_htree_fill_tree+0x5a0/0x5a0
[ 1290.124811]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.125398]  ? __ext4_find_entry+0x48b/0x7a0
[ 1290.125933]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.126541]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.127180]  ? ext4_search_dir+0x7e/0x140
[ 1290.127689]  ? fscrypt_match_name+0x5/0x120
[ 1290.128223]  ? fscrypt_match_name+0x5/0x120
[ 1290.128752]  ? ext4_match.isra.25.part.26+0x6b/0x90
[ 1290.129358]  ? fscrypt_match_name+0x5/0x120
[ 1290.129885]  ? ext4_match.isra.25.part.26+0x6b/0x90
[ 1290.130500]  ? ext4_match.isra.25.part.26+0x5/0x90
[ 1290.131099]  ? ext4_search_dir+0x94/0x140
[ 1290.131619]  ? __ext4_find_entry+0x48b/0x7a0
[ 1290.132175]  ? __ext4_find_entry+0x5/0x7a0
[ 1290.132690]  ? write_comp_data+0x2f/0x90
[ 1290.133195]  ? ext4_lookup+0x2f7/0x380
[ 1290.133669]  ? ext4_resetent+0x170/0x170
[ 1290.134190]  ? lookup_open+0x46e/0x9c0
[ 1290.134717]  ? path_openat+0x4b3/0x1320
[ 1290.135228]  ? do_filp_open+0xd2/0x150
[ 1290.135728]  ? preempt_count_sub+0x5/0xa0
[ 1290.136234]  ? _raw_spin_unlock+0x2c/0x50
[ 1290.136745]  ? do_sys_openat2+0x4c2/0x700
[ 1290.137262]  ? write_comp_data+0x2f/0x90
[ 1290.137768]  ? do_sys_openat2+0x559/0x700
[ 1290.138300]  ? do_sys_open+0x8e/0xe0
[ 1290.138772]  ? __x64_sys_openat+0x29/0x30
[ 1290.139279]  ? do_syscall_64+0x37/0x80
[ 1290.139755]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1290.140439] CPU: 1 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1290.140471] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[ 1290.141357] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1290.142392] caller is debug_smp_processor_id+0x1c/0x20
[ 1290.143705] Call Trace:
[ 1290.144636]  dump_stack_lvl+0xa4/0xd3
[ 1290.145109]  dump_stack+0x15/0x17
[ 1290.145534]  check_preemption_disabled+0x167/0x180
[ 1290.146142]  ? insn_get_immediate+0x181/0x570
[ 1290.146687]  ? insn_get_sib+0x140/0x140
[ 1290.147175]  debug_smp_processor_id+0x1c/0x20
[ 1290.147724]  perf_ftrace_function_call+0x7c/0x360
[ 1290.148312]  ? insn_get_displacement+0x270/0x270
[ 1290.148890]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.149479]  ? insn_get_length+0x75/0x90
[ 1290.149975]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.150585]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.151174]  ? insn_decode+0x9b/0x170
[ 1290.151640]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.152259]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.152848]  ? text_poke_loc_init+0x63/0x140
[ 1290.153386]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.153997]  ? ___ratelimit+0x36/0x1e0
[ 1290.154513]  ? insn_get_immediate+0x49/0x570
[ 1290.155054]  ? insn_get_displacement+0x5/0x270
[ 1290.155611]  ? write_comp_data+0x2f/0x90
[ 1290.156110]  ? insn_get_displacement+0x5/0x270
[ 1290.156668]  ? insn_get_immediate+0x181/0x570
[ 1290.157214]  ? insn_get_displacement+0x5/0x270
[ 1290.157769]  ? insn_get_immediate+0x181/0x570
[ 1290.158325]  ? insn_get_length+0x75/0x90
[ 1290.158826]  ? insn_decode+0x9b/0x170
[ 1290.159293]  ? math_error+0x170/0x170
[ 1290.159757]  ? text_poke_loc_init+0x63/0x140
[ 1290.160317]  ? math_error+0x170/0x170
[ 1290.160787]  ? text_poke_queue+0x84/0xc0
[ 1290.161291]  ? ftrace_replace_code+0xfd/0x170
[ 1290.161844]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1290.162450]  ? arch_ftrace_update_code+0x9/0x10
[ 1290.163019]  ? ftrace_run_update_code+0x30/0xa0
[ 1290.163592]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1290.164119]  ? unregister_ftrace_function+0x25/0x50
[ 1290.164731]  ? perf_ftrace_event_register+0x89/0xf0
[ 1290.165342]  ? perf_tp_event_init+0xa0/0xa0
[ 1290.165871]  ? perf_trace_destroy+0x37/0x60
[ 1290.166405]  ? tp_perf_event_destroy+0x15/0x20
[ 1290.166966]  ? _free_event+0xfc/0x7d0
[ 1290.167439]  ? put_event+0x37/0x50
[ 1290.167878]  ? perf_event_release_kernel+0x2f4/0x370
[ 1290.168505]  ? perf_event_release_kernel+0x370/0x370
[ 1290.169128]  ? perf_release+0x19/0x20
[ 1290.169595]  ? __fput+0x12d/0x460
[ 1290.170036]  ? ____fput+0x1a/0x20
[ 1290.170465]  ? task_work_run+0x8e/0xf0
[ 1290.170949]  ? do_exit+0x616/0x1310
[ 1290.171403]  ? write_comp_data+0x2f/0x90
[ 1290.171912]  ? do_group_exit+0x7e/0x130
[ 1290.172406]  ? get_signal+0x249/0x13c0
[ 1290.172886]  ? get_signal+0x5/0x13c0
[ 1290.173355]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1290.173974]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1290.174595]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1290.175223]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1290.175824]  ? do_syscall_64+0x46/0x80
[ 1290.176299]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1290.176982] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1290.177014] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1290.177940] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1290.178910] caller is debug_smp_processor_id+0x1c/0x20
[ 1290.180247] Call Trace:
[ 1290.181178]  dump_stack_lvl+0xa4/0xd3
[ 1290.181647]  dump_stack+0x15/0x17
[ 1290.182073]  check_preemption_disabled+0x167/0x180
[ 1290.182677]  ? ext4_search_dir+0x94/0x140
[ 1290.183177]  ? ext4_rec_len_to_disk.part.20+0x10/0x10
[ 1290.183806]  debug_smp_processor_id+0x1c/0x20
[ 1290.184354]  perf_ftrace_function_call+0x7c/0x360
[ 1290.184944]  ? write_comp_data+0x2f/0x90
[ 1290.185438]  ? __ext4_find_entry+0x48b/0x7a0
[ 1290.185969]  ? ext4_htree_fill_tree+0x5a0/0x5a0
[ 1290.186538]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.187125]  ? __ext4_find_entry+0x48b/0x7a0
[ 1290.187661]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.188266]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.188906]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.189506]  ? ext4_search_dir+0x7e/0x140
[ 1290.190014]  ? ext4_match.isra.25.part.26+0x5/0x90
[ 1290.190612]  ? write_comp_data+0x2f/0x90
[ 1290.191111]  ? ext4_match.isra.25.part.26+0x5/0x90
[ 1290.191706]  ? ext4_search_dir+0x94/0x140
[ 1290.192209]  ? ext4_match.isra.25.part.26+0x5/0x90
[ 1290.192802]  ? ext4_search_dir+0x94/0x140
[ 1290.193322]  ? __ext4_find_entry+0x48b/0x7a0
[ 1290.193878]  ? __ext4_find_entry+0x5/0x7a0
[ 1290.194395]  ? write_comp_data+0x2f/0x90
[ 1290.194905]  ? ext4_lookup+0x2f7/0x380
[ 1290.195379]  ? ext4_resetent+0x170/0x170
[ 1290.195897]  ? lookup_open+0x46e/0x9c0
[ 1290.196423]  ? path_openat+0x4b3/0x1320
[ 1290.196934]  ? do_filp_open+0xd2/0x150
[ 1290.197434]  ? preempt_count_sub+0x5/0xa0
[ 1290.197938]  ? _raw_spin_unlock+0x2c/0x50
[ 1290.198456]  ? do_sys_openat2+0x4c2/0x700
[ 1290.198971]  ? write_comp_data+0x2f/0x90
[ 1290.199476]  ? do_sys_openat2+0x559/0x700
[ 1290.200004]  ? do_sys_open+0x8e/0xe0
[ 1290.200473]  ? __x64_sys_openat+0x29/0x30
[ 1290.200978]  ? do_syscall_64+0x37/0x80
[ 1290.201453]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1290.202140] CPU: 1 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1290.202164] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[ 1290.203054] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1290.204039] caller is debug_smp_processor_id+0x1c/0x20
[ 1290.205393] Call Trace:
[ 1290.206328]  dump_stack_lvl+0xa4/0xd3
[ 1290.206800]  dump_stack+0x15/0x17
[ 1290.207225]  check_preemption_disabled+0x167/0x180
[ 1290.207823]  ? insn_get_displacement+0x157/0x270
[ 1290.208399]  ? insn_rip_relative+0xb0/0xb0
[ 1290.208918]  debug_smp_processor_id+0x1c/0x20
[ 1290.209472]  perf_ftrace_function_call+0x7c/0x360
[ 1290.210065]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.210653]  ? insn_get_immediate+0x181/0x570
[ 1290.211197]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.211805]  ? insn_get_displacement+0x270/0x270
[ 1290.212382]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.212970]  ? insn_get_length+0x75/0x90
[ 1290.213465]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.214076]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.214669]  ? insn_decode+0x9b/0x170
[ 1290.215133]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.215747]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.216336]  ? text_poke_loc_init+0x63/0x140
[ 1290.216874]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.217511]  ? insn_get_displacement+0x47/0x270
[ 1290.218088]  ? insn_get_sib+0x5/0x140
[ 1290.218557]  ? write_comp_data+0x2f/0x90
[ 1290.219056]  ? insn_get_sib+0x5/0x140
[ 1290.219522]  ? insn_get_displacement+0x157/0x270
[ 1290.220099]  ? insn_get_sib+0x5/0x140
[ 1290.220562]  ? insn_get_displacement+0x157/0x270
[ 1290.221146]  ? insn_get_immediate+0x181/0x570
[ 1290.221701]  ? insn_get_length+0x75/0x90
[ 1290.222207]  ? insn_decode+0x9b/0x170
[ 1290.222676]  ? math_error+0x170/0x170
[ 1290.223141]  ? text_poke_loc_init+0x63/0x140
[ 1290.223701]  ? math_error+0x170/0x170
[ 1290.224173]  ? text_poke_queue+0x84/0xc0
[ 1290.224678]  ? ftrace_replace_code+0xfd/0x170
[ 1290.225231]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1290.225826]  ? arch_ftrace_update_code+0x9/0x10
[ 1290.226400]  ? ftrace_run_update_code+0x30/0xa0
[ 1290.226972]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1290.227498]  ? unregister_ftrace_function+0x25/0x50
[ 1290.228109]  ? perf_ftrace_event_register+0x89/0xf0
[ 1290.228720]  ? perf_tp_event_init+0xa0/0xa0
[ 1290.229246]  ? perf_trace_destroy+0x37/0x60
[ 1290.229777]  ? tp_perf_event_destroy+0x15/0x20
[ 1290.230357]  ? _free_event+0xfc/0x7d0
[ 1290.230831]  ? put_event+0x37/0x50
[ 1290.231269]  ? perf_event_release_kernel+0x2f4/0x370
[ 1290.231898]  ? perf_event_release_kernel+0x370/0x370
[ 1290.232519]  ? perf_release+0x19/0x20
[ 1290.232986]  ? __fput+0x12d/0x460
[ 1290.233426]  ? ____fput+0x1a/0x20
[ 1290.233854]  ? task_work_run+0x8e/0xf0
[ 1290.234356]  ? do_exit+0x616/0x1310
[ 1290.234810]  ? write_comp_data+0x2f/0x90
[ 1290.235316]  ? do_group_exit+0x7e/0x130
[ 1290.235812]  ? get_signal+0x249/0x13c0
[ 1290.236294]  ? get_signal+0x5/0x13c0
[ 1290.236764]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1290.237391]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1290.238005]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1290.238633]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1290.239233]  ? do_syscall_64+0x46/0x80
[ 1290.239711]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1290.240395] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1290.240422] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1290.241351] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1290.242314] caller is debug_smp_processor_id+0x1c/0x20
[ 1290.243663] Call Trace:
[ 1290.244597]  dump_stack_lvl+0xa4/0xd3
[ 1290.245065]  dump_stack+0x15/0x17
[ 1290.245486]  check_preemption_disabled+0x167/0x180
[ 1290.246089]  ? ext4_match.isra.25.part.26+0x6b/0x90
[ 1290.246694]  ? fscrypt_fname_alloc_buffer+0x60/0x60
[ 1290.247306]  debug_smp_processor_id+0x1c/0x20
[ 1290.247851]  perf_ftrace_function_call+0x7c/0x360
[ 1290.248443]  ? dump_stack+0x15/0x17
[ 1290.248885]  ? write_comp_data+0x2f/0x90
[ 1290.249379]  ? ext4_search_dir+0x94/0x140
[ 1290.249880]  ? ext4_rec_len_to_disk.part.20+0x10/0x10
[ 1290.250512]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.251097]  ? ext4_search_dir+0x94/0x140
[ 1290.251599]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.252207]  ? write_comp_data+0x2f/0x90
[ 1290.252700]  ? __ext4_find_entry+0x48b/0x7a0
[ 1290.253232]  ? ext4_htree_fill_tree+0x5a0/0x5a0
[ 1290.253795]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.254386]  ? __ext4_find_entry+0x48b/0x7a0
[ 1290.254919]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.255524]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.256159]  ? ext4_search_dir+0x7e/0x140
[ 1290.256666]  ? fscrypt_match_name+0x5/0x120
[ 1290.257199]  ? fscrypt_match_name+0x5/0x120
[ 1290.257725]  ? ext4_match.isra.25.part.26+0x6b/0x90
[ 1290.258331]  ? fscrypt_match_name+0x5/0x120
[ 1290.258855]  ? ext4_match.isra.25.part.26+0x6b/0x90
[ 1290.259468]  ? ext4_match.isra.25.part.26+0x5/0x90
[ 1290.260067]  ? ext4_search_dir+0x94/0x140
[ 1290.260586]  ? __ext4_find_entry+0x48b/0x7a0
[ 1290.261141]  ? __ext4_find_entry+0x5/0x7a0
[ 1290.261654]  ? write_comp_data+0x2f/0x90
[ 1290.262164]  ? ext4_lookup+0x2f7/0x380
[ 1290.262630]  ? ext4_resetent+0x170/0x170
[ 1290.263147]  ? lookup_open+0x46e/0x9c0
[ 1290.263672]  ? path_openat+0x4b3/0x1320
[ 1290.264182]  ? do_filp_open+0xd2/0x150
[ 1290.264681]  ? preempt_count_sub+0x5/0xa0
[ 1290.265185]  ? _raw_spin_unlock+0x2c/0x50
[ 1290.265694]  ? do_sys_openat2+0x4c2/0x700
[ 1290.266216]  ? write_comp_data+0x2f/0x90
[ 1290.266721]  ? do_sys_openat2+0x559/0x700
[ 1290.267259]  ? do_sys_open+0x8e/0xe0
[ 1290.267728]  ? __x64_sys_openat+0x29/0x30
[ 1290.268232]  ? do_syscall_64+0x37/0x80
[ 1290.268707]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1290.269387] CPU: 1 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1290.269414] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[ 1290.270308] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1290.270320] Call Trace:
[ 1290.270327]  dump_stack_lvl+0xa4/0xd3
[ 1290.271310] caller is debug_smp_processor_id+0x1c/0x20
[ 1290.272683]  dump_stack+0x15/0x17
[ 1290.274466]  check_preemption_disabled+0x167/0x180
[ 1290.275070]  ? insn_get_sib+0x122/0x140
[ 1290.275554]  ? insn_get_opcode+0x3b0/0x3b0
[ 1290.276074]  debug_smp_processor_id+0x1c/0x20
[ 1290.276623]  perf_ftrace_function_call+0x7c/0x360
[ 1290.277212]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.277801]  ? insn_get_displacement+0x157/0x270
[ 1290.278401]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.279010]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.279597]  ? insn_get_immediate+0x181/0x570
[ 1290.280144]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.280751]  ? insn_get_displacement+0x270/0x270
[ 1290.281328]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.281916]  ? insn_get_length+0x75/0x90
[ 1290.282414]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.283021]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.283609]  ? insn_decode+0x9b/0x170
[ 1290.284073]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.284712]  ? insn_get_sib+0x43/0x140
[ 1290.285191]  ? insn_get_modrm+0x5/0x2a0
[ 1290.285676]  ? write_comp_data+0x2f/0x90
[ 1290.286179]  ? insn_get_modrm+0x5/0x2a0
[ 1290.286664]  ? insn_get_sib+0x122/0x140
[ 1290.287149]  ? insn_get_modrm+0x5/0x2a0
[ 1290.287633]  ? insn_get_sib+0x122/0x140
[ 1290.288124]  ? insn_get_displacement+0x157/0x270
[ 1290.288707]  ? insn_get_immediate+0x181/0x570
[ 1290.289261]  ? insn_get_length+0x75/0x90
[ 1290.289762]  ? insn_decode+0x9b/0x170
[ 1290.290233]  ? math_error+0x170/0x170
[ 1290.290698]  ? text_poke_loc_init+0x63/0x140
[ 1290.291258]  ? math_error+0x170/0x170
[ 1290.291730]  ? text_poke_queue+0x84/0xc0
[ 1290.292233]  ? ftrace_replace_code+0xfd/0x170
[ 1290.292789]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1290.293382]  ? arch_ftrace_update_code+0x9/0x10
[ 1290.293948]  ? ftrace_run_update_code+0x30/0xa0
[ 1290.294525]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1290.295050]  ? unregister_ftrace_function+0x25/0x50
[ 1290.295659]  ? perf_ftrace_event_register+0x89/0xf0
[ 1290.296269]  ? perf_tp_event_init+0xa0/0xa0
[ 1290.296795]  ? perf_trace_destroy+0x37/0x60
[ 1290.297324]  ? tp_perf_event_destroy+0x15/0x20
[ 1290.297885]  ? _free_event+0xfc/0x7d0
[ 1290.298361]  ? put_event+0x37/0x50
[ 1290.298803]  ? perf_event_release_kernel+0x2f4/0x370
[ 1290.299431]  ? perf_event_release_kernel+0x370/0x370
[ 1290.300052]  ? perf_release+0x19/0x20
[ 1290.300519]  ? __fput+0x12d/0x460
[ 1290.300958]  ? ____fput+0x1a/0x20
[ 1290.301386]  ? task_work_run+0x8e/0xf0
[ 1290.301870]  ? do_exit+0x616/0x1310
[ 1290.302326]  ? write_comp_data+0x2f/0x90
[ 1290.302832]  ? do_group_exit+0x7e/0x130
[ 1290.303331]  ? get_signal+0x249/0x13c0
[ 1290.303812]  ? get_signal+0x5/0x13c0
[ 1290.304279]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1290.304904]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1290.305516]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1290.306140]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1290.306740]  ? do_syscall_64+0x46/0x80
[ 1290.307216]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1290.307900] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1290.307940] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20671
[ 1290.308862] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1290.309801] caller is debug_smp_processor_id+0x1c/0x20
[ 1290.311166] Call Trace:
[ 1290.311174]  dump_stack_lvl+0xa4/0xd3
[ 1290.312563]  dump_stack+0x15/0x17
[ 1290.312986]  check_preemption_disabled+0x167/0x180
[ 1290.313585]  ? __ext4_find_entry+0x4b2/0x7a0
[ 1290.314121]  ? block_commit_write+0x40/0x40
[ 1290.314663]  debug_smp_processor_id+0x1c/0x20
[ 1290.315209]  perf_ftrace_function_call+0x7c/0x360
[ 1290.315819]  ? write_comp_data+0x2f/0x90
[ 1290.316317]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.316904]  ? fscrypt_match_name+0x58/0x120
[ 1290.317457]  ? ext4_match.isra.25.part.26+0x6b/0x90
[ 1290.318067]  ? write_comp_data+0x2f/0x90
[ 1290.318569]  ? __ext4_find_entry+0x49a/0x7a0
[ 1290.319109]  ? __brelse+0x5/0x60
[ 1290.319527]  ? __brelse+0x5/0x60
[ 1290.319940]  ? __ext4_find_entry+0x4b2/0x7a0
[ 1290.320475]  ? __brelse+0x5/0x60
[ 1290.320887]  ? __ext4_find_entry+0x4b2/0x7a0
[ 1290.321442]  ? __ext4_find_entry+0x5/0x7a0
[ 1290.321959]  ? write_comp_data+0x2f/0x90
[ 1290.322469]  ? ext4_lookup+0x2f7/0x380
[ 1290.322943]  ? ext4_resetent+0x170/0x170
[ 1290.323461]  ? lookup_open+0x46e/0x9c0
[ 1290.323985]  ? path_openat+0x4b3/0x1320
[ 1290.324496]  ? do_filp_open+0xd2/0x150
[ 1290.324994]  ? preempt_count_sub+0x5/0xa0
[ 1290.325499]  ? _raw_spin_unlock+0x2c/0x50
[ 1290.326009]  ? do_sys_openat2+0x4c2/0x700
[ 1290.326525]  ? write_comp_data+0x2f/0x90
[ 1290.327029]  ? do_sys_openat2+0x559/0x700
[ 1290.327558]  ? do_sys_open+0x8e/0xe0
[ 1290.328027]  ? __x64_sys_openat+0x29/0x30
[ 1290.328531]  ? do_syscall_64+0x37/0x80
[ 1290.329005]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1290.329687] CPU: 1 PID: 20671 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1290.329711] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[ 1290.330607] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1290.330618] Call Trace:
[ 1290.330625]  dump_stack_lvl+0xa4/0xd3
[ 1290.331606] caller is debug_smp_processor_id+0x1c/0x20
[ 1290.332970]  dump_stack+0x15/0x17
[ 1290.334749]  check_preemption_disabled+0x167/0x180
[ 1290.335348]  ? insn_get_modrm+0x12b/0x2a0
[ 1290.335851]  ? insn_get_prefixes+0x50/0x50
[ 1290.336369]  debug_smp_processor_id+0x1c/0x20
[ 1290.336917]  perf_ftrace_function_call+0x7c/0x360
[ 1290.337505]  ? insn_get_opcode+0x3b0/0x3b0
[ 1290.338019]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.338610]  ? insn_get_sib+0x122/0x140
[ 1290.339094]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.339732]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.340329]  ? insn_get_displacement+0x157/0x270
[ 1290.340908]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.341517]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.342112]  ? insn_get_immediate+0x181/0x570
[ 1290.342664]  ? perf_ftrace_function_call+0x4c/0x360
[ 1290.343274]  ? insn_get_displacement+0x270/0x270
[ 1290.343852]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1290.344439]  ? insn_get_length+0x75/0x90
[ 1290.344965]  ? insn_get_modrm+0x49/0x2a0
[ 1290.345465]  ? insn_get_opcode+0x5/0x3b0
[ 1290.345959]  ? write_comp_data+0x2f/0x90
[ 1290.346462]  ? insn_get_opcode+0x5/0x3b0
[ 1290.346958]  ? insn_get_modrm+0x12b/0x2a0
[ 1290.347463]  ? insn_get_opcode+0x5/0x3b0
[ 1290.347956]  ? insn_get_modrm+0x12b/0x2a0
[ 1290.348470]  ? insn_get_sib+0x122/0x140
[ 1290.348963]  ? insn_get_displacement+0x157/0x270
[ 1290.349546]  ? insn_get_immediate+0x181/0x570
[ 1290.350104]  ? insn_get_length+0x75/0x90
[ 1290.350605]  ? insn_decode+0x9b/0x170
[ 1290.351072]  ? math_error+0x170/0x170
[ 1290.351539]  ? text_poke_loc_init+0x63/0x140
[ 1290.352097]  ? math_error+0x170/0x170
[ 1290.352569]  ? text_poke_queue+0x84/0xc0
[ 1290.353073]  ? ftrace_replace_code+0xfd/0x170
[ 1290.353629]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1290.354226]  ? arch_ftrace_update_code+0x9/0x10
[ 1290.354794]  ? ftrace_run_update_code+0x30/0xa0
[ 1290.355364]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1290.355890]  ? unregister_ftrace_function+0x25/0x50
[ 1290.356499]  ? perf_ftrace_event_register+0x89/0xf0
[ 1290.357109]  ? perf_tp_event_init+0xa0/0xa0
[ 1290.357638]  ? perf_trace_destroy+0x37/0x60
[ 1290.358171]  ? tp_perf_event_destroy+0x15/0x20
[ 1290.358731]  ? _free_event+0xfc/0x7d0
[ 1290.359203]  ? put_event+0x37/0x50
[ 1290.359641]  ? perf_event_release_kernel+0x2f4/0x370
[ 1290.360271]  ? perf_event_release_kernel+0x370/0x370
[ 1290.360910]  ? perf_release+0x19/0x20
[ 1290.361378]  ? __fput+0x12d/0x460
[ 1290.361818]  ? ____fput+0x1a/0x20
[ 1290.362256]  ? task_work_run+0x8e/0xf0
[ 1290.362741]  ? do_exit+0x616/0x1310
[ 1290.363199]  ? write_comp_data+0x2f/0x90
[ 1290.363709]  ? do_group_exit+0x7e/0x130
[ 1290.364203]  ? get_signal+0x249/0x13c0
[ 1290.364686]  ? get_signal+0x5/0x13c0
[ 1290.365155]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1290.365780]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1290.366395]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1290.367016]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1290.367617]  ? do_syscall_64+0x46/0x80
[ 1290.368093]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1290.368775] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1290.369738] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1290.371109] Call Trace:
[ 1290.371426]  dump_stack_lvl+0xa4/0xd3
[ 1290.371897]  dump_stack+0x15/0x17
[ 1290.372321]  check_preemption_disabled+0x167/0x180
[ 1290.372920]  ? ext4_lookup+0x303/0x380
[ 1290.373392]  ? __slab_free+0x470/0x470
[ 1290.373869]  debug_smp_processor_id+0x1c/0x20
[ 1290.374419]  perf_ftrace_function_call+0x7c/0x360
[ 1290.375021]  ? ext4_match.isra.25.part.26+0x6b/0x90
[ 1290.375628]  ? write_comp_data+0x2f/0x90
[ 1290.376128]  ? __ext4_find_entry+0x49a/0x7a0
[ 1290.376665]  ? write_comp_data+0x2f/0x90
[ 1290.377178]  ? __ext4_find_entry+0x553/0x7a0
[ 1290.377731]  ? kfree+0x5/0x5b0
[ 1290.378134]  ? write_comp_data+0x2f/0x90
[ 1290.378632]  ? kfree+0x5/0x5b0
[ 1290.379025]  ? ext4_lookup+0x303/0x380
[ 1290.379498]  ? kfree+0x5/0x5b0
[ 1290.379888]  ? ext4_lookup+0x303/0x380
[ 1290.380361]  ? ext4_resetent+0x170/0x170
[ 1290.380880]  ? lookup_open+0x46e/0x9c0
[ 1290.381406]  ? path_openat+0x4b3/0x1320
[ 1290.381918]  ? do_filp_open+0xd2/0x150
[ 1290.382421]  ? preempt_count_sub+0x5/0xa0
[ 1290.382926]  ? _raw_spin_unlock+0x2c/0x50
[ 1290.383437]  ? do_sys_openat2+0x4c2/0x700
[ 1290.383953]  ? write_comp_data+0x2f/0x90
[ 1290.384459]  ? do_sys_openat2+0x559/0x700
[ 1290.384987]  ? do_sys_open+0x8e/0xe0
[ 1290.385457]  ? __x64_sys_openat+0x29/0x30
[ 1290.385963]  ? do_syscall_64+0x37/0x80
[ 1290.386441]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1295.078073] check_preemption_disabled: 2834613 callbacks suppressed
[ 1295.078096] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1295.078879] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1295.078970] caller is debug_smp_processor_id+0x1c/0x20
[ 1295.079832] caller is debug_smp_processor_id+0x1c/0x20
[ 1295.080795] CPU: 0 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1295.082958] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1295.084388] Call Trace:
[ 1295.084757]  dump_stack_lvl+0xa4/0xd3
[ 1295.085313]  dump_stack+0x15/0x17
[ 1295.085794]  check_preemption_disabled+0x167/0x180
[ 1295.086523]  debug_smp_processor_id+0x1c/0x20
[ 1295.087128]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1295.087913]  perf_trace_buf_alloc+0x3d/0x100
[ 1295.088508]  ? insn_get_immediate+0x181/0x570
[ 1295.089101]  ? insn_get_sib+0x140/0x140
[ 1295.089652]  perf_ftrace_function_call+0x209/0x360
[ 1295.090347]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1295.091165]  ? 0xffffffffa0098099
[ 1295.091759]  0xffffffffa0098099
[ 1295.092279]  ? 0xffffffffa0098099
[ 1295.092795]  ? insn_get_immediate+0x49/0x570
[ 1295.093427]  ? insn_get_displacement+0x5/0x270
[ 1295.094041]  ? write_comp_data+0x2f/0x90
[ 1295.094622]  insn_get_displacement+0x5/0x270
[ 1295.095216]  insn_get_immediate+0x181/0x570
[ 1295.095800]  ? insn_get_displacement+0x5/0x270
[ 1295.096404]  ? insn_get_immediate+0x181/0x570
[ 1295.097059]  insn_get_length+0x75/0x90
[ 1295.097622]  insn_decode+0x9b/0x170
[ 1295.098154]  ? __ia32_sys_gethostname+0x190/0x190
[ 1295.098802]  text_poke_loc_init+0x63/0x140
[ 1295.099533]  ? __ia32_sys_gethostname+0x190/0x190
[ 1295.100221]  text_poke_queue+0x84/0xc0
[ 1295.100795]  ftrace_replace_code+0xfd/0x170
[ 1295.101433]  ftrace_modify_all_code+0x1b1/0x270
[ 1295.102108]  arch_ftrace_update_code+0x9/0x10
[ 1295.102716]  ftrace_run_update_code+0x30/0xa0
[ 1295.103344]  ftrace_startup_enable+0x5e/0xa0
[ 1295.103959]  ftrace_startup+0x16d/0x240
[ 1295.104575]  register_ftrace_function+0x43/0x90
[ 1295.105223]  perf_ftrace_event_register+0xc1/0xf0
[ 1295.105891]  perf_trace_event_init+0xa0/0x4c0
[ 1295.106563]  perf_trace_init+0xda/0x160
[ 1295.107149]  perf_tp_event_init+0x57/0xa0
[ 1295.107735]  perf_try_init_event+0x83/0x270
[ 1295.108385]  perf_event_alloc+0xe3f/0x1c10
[ 1295.108951]  ? _raw_spin_unlock+0x2c/0x50
[ 1295.109527]  ? alloc_fd+0x20d/0x320
[ 1295.110140]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1295.110822]  ? write_comp_data+0x2f/0x90
[ 1295.111712]  __x64_sys_perf_event_open+0x26/0x30
[ 1295.112424]  do_syscall_64+0x37/0x80
[ 1295.112990]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1295.113732] RIP: 0033:0x7fac0740459d
[ 1295.114287] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1295.116805] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1295.117886] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1295.118891] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1295.119888] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1295.120887] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1295.121885] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1295.123123] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1295.123243] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1295.124016] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1295.124998] caller is debug_smp_processor_id+0x1c/0x20
[ 1295.126356] Call Trace:
[ 1295.126368]  dump_stack_lvl+0xa4/0xd3
[ 1295.126392]  dump_stack+0x15/0x17
[ 1295.126407]  check_preemption_disabled+0x167/0x180
[ 1295.126426]  ? do_nanosleep+0x123/0x2a0
[ 1295.126441]  ? ___might_sleep+0x170/0x170
[ 1295.126461]  debug_smp_processor_id+0x1c/0x20
[ 1295.130335]  perf_ftrace_function_call+0x7c/0x360
[ 1295.130931]  ? 0xffffffffa0098099
[ 1295.131353]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1295.131954]  ? finish_task_switch+0xab/0x2a0
[ 1295.132488]  ? __schedule+0x46e/0xb20
[ 1295.132968]  ? do_nanosleep+0x9c/0x2a0
[ 1295.133445]  0xffffffffa0098099
[ 1295.133851]  ? finish_task_switch+0xb0/0x2a0
[ 1295.134401]  ? do_nanosleep+0x107/0x2a0
[ 1295.134892]  ? __might_sleep+0x5/0x70
[ 1295.135355]  ? write_comp_data+0x2f/0x90
[ 1295.135853]  __might_sleep+0x5/0x70
[ 1295.136298]  do_nanosleep+0x123/0x2a0
[ 1295.136764]  ? __might_sleep+0x5/0x70
[ 1295.137226]  ? do_nanosleep+0x123/0x2a0
[ 1295.137708]  ? write_comp_data+0x2f/0x90
[ 1295.138220]  hrtimer_nanosleep+0xf7/0x1b0
[ 1295.138740]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1295.139325]  __x64_sys_nanosleep+0xfc/0x150
[ 1295.139865]  do_syscall_64+0x37/0x80
[ 1295.140322]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1295.140950] RIP: 0033:0x7fac073cca18
[ 1295.141402] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1295.143617] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1295.144535] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1295.145394] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1295.146257] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1295.147115] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1295.147974] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1295.148872] CPU: 0 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1295.148934] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1295.149838] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1295.150774] caller is debug_smp_processor_id+0x1c/0x20
[ 1295.152183] Call Trace:
[ 1295.153137]  dump_stack_lvl+0xa4/0xd3
[ 1295.153661]  dump_stack+0x15/0x17
[ 1295.154132]  check_preemption_disabled+0x167/0x180
[ 1295.154806]  debug_smp_processor_id+0x1c/0x20
[ 1295.155397]  perf_trace_buf_alloc+0x98/0x100
[ 1295.155979]  ? insn_get_immediate+0x181/0x570
[ 1295.156561]  ? insn_get_sib+0x140/0x140
[ 1295.157090]  perf_ftrace_function_call+0x209/0x360
[ 1295.157840]  ? 0xffffffffa0098099
[ 1295.158367]  0xffffffffa0098099
[ 1295.158838]  ? 0xffffffffa0098099
[ 1295.159317]  ? insn_get_immediate+0x49/0x570
[ 1295.159912]  ? insn_get_displacement+0x5/0x270
[ 1295.160510]  ? write_comp_data+0x2f/0x90
[ 1295.161057]  insn_get_displacement+0x5/0x270
[ 1295.161638]  insn_get_immediate+0x181/0x570
[ 1295.162214]  ? insn_get_displacement+0x5/0x270
[ 1295.162807]  ? insn_get_immediate+0x181/0x570
[ 1295.163423]  insn_get_length+0x75/0x90
[ 1295.163955]  insn_decode+0x9b/0x170
[ 1295.164450]  ? __ia32_sys_gethostname+0x190/0x190
[ 1295.165082]  text_poke_loc_init+0x63/0x140
[ 1295.165718]  ? __ia32_sys_gethostname+0x190/0x190
[ 1295.166381]  text_poke_queue+0x84/0xc0
[ 1295.166920]  ftrace_replace_code+0xfd/0x170
[ 1295.167516]  ftrace_modify_all_code+0x1b1/0x270
[ 1295.168149]  arch_ftrace_update_code+0x9/0x10
[ 1295.168739]  ftrace_run_update_code+0x30/0xa0
[ 1295.169340]  ftrace_startup_enable+0x5e/0xa0
[ 1295.169931]  ftrace_startup+0x16d/0x240
[ 1295.170507]  register_ftrace_function+0x43/0x90
[ 1295.171129]  perf_ftrace_event_register+0xc1/0xf0
[ 1295.171775]  perf_trace_event_init+0xa0/0x4c0
[ 1295.172394]  perf_trace_init+0xda/0x160
[ 1295.172943]  perf_tp_event_init+0x57/0xa0
[ 1295.173501]  perf_try_init_event+0x83/0x270
[ 1295.174111]  perf_event_alloc+0xe3f/0x1c10
[ 1295.174669]  ? _raw_spin_unlock+0x2c/0x50
[ 1295.175225]  ? alloc_fd+0x20d/0x320
[ 1295.175762]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1295.176418]  ? write_comp_data+0x2f/0x90
[ 1295.177130]  __x64_sys_perf_event_open+0x26/0x30
[ 1295.177764]  do_syscall_64+0x37/0x80
[ 1295.178272]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1295.178946] RIP: 0033:0x7fac0740459d
[ 1295.179436] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1295.181770] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1295.182763] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1295.183675] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1295.184606] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1295.185522] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1295.186446] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1295.187482] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1295.187591] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1295.188372] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1295.189356] caller is debug_smp_processor_id+0x1c/0x20
[ 1295.190718] Call Trace:
[ 1295.190729]  dump_stack_lvl+0xa4/0xd3
[ 1295.190752]  dump_stack+0x15/0x17
[ 1295.190768]  check_preemption_disabled+0x167/0x180
[ 1295.190786]  ? __might_sleep+0x48/0x70
[ 1295.190800]  ? sched_show_task+0x70/0x70
[ 1295.190819]  debug_smp_processor_id+0x1c/0x20
[ 1295.194683]  perf_ftrace_function_call+0x7c/0x360
[ 1295.195272]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1295.195858]  ? do_nanosleep+0x123/0x2a0
[ 1295.196344]  ? perf_ftrace_function_call+0x4c/0x360
[ 1295.196960]  ? 0xffffffffa0098099
[ 1295.197382]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1295.197986]  ? finish_task_switch+0xab/0x2a0
[ 1295.198523]  ? __schedule+0x46e/0xb20
[ 1295.198993]  ? do_nanosleep+0x9c/0x2a0
[ 1295.199471]  0xffffffffa0098099
[ 1295.199872]  ? do_nanosleep+0x9c/0x2a0
[ 1295.200364]  ? do_nanosleep+0x107/0x2a0
[ 1295.200856]  ? ___might_sleep+0x5/0x170
[ 1295.201347]  ___might_sleep+0x5/0x170
[ 1295.201812]  __might_sleep+0x48/0x70
[ 1295.202271]  ? ___might_sleep+0x5/0x170
[ 1295.202754]  ? __might_sleep+0x48/0x70
[ 1295.203234]  do_nanosleep+0x123/0x2a0
[ 1295.203699]  ? write_comp_data+0x2f/0x90
[ 1295.204207]  hrtimer_nanosleep+0xf7/0x1b0
[ 1295.204724]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1295.205308]  __x64_sys_nanosleep+0xfc/0x150
[ 1295.205848]  do_syscall_64+0x37/0x80
[ 1295.206307]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1295.206936] RIP: 0033:0x7fac073cca18
[ 1295.207387] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1295.209594] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1295.210514] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1295.211375] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1295.212237] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1295.213097] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1295.213956] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1295.214859] CPU: 0 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1295.214886] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1295.215823] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1295.216738] caller is debug_smp_processor_id+0x1c/0x20
[ 1295.218173] Call Trace:
[ 1295.218193]  dump_stack_lvl+0xa4/0xd3
[ 1295.219644]  dump_stack+0x15/0x17
[ 1295.220108]  check_preemption_disabled+0x167/0x180
[ 1295.220784]  debug_smp_processor_id+0x1c/0x20
[ 1295.221380]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1295.222121]  perf_tp_event+0x331/0x4e0
[ 1295.222798]  ? arch_local_irq_enable+0x10/0x12
[ 1295.223409]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1295.224071]  ? dump_stack_lvl+0xcc/0xd3
[ 1295.224662]  ? dump_stack+0x15/0x17
[ 1295.225180]  ? check_preemption_disabled+0x167/0x180
[ 1295.225924]  ? insn_get_immediate+0x181/0x570
[ 1295.226567]  ? insn_get_sib+0x140/0x140
[ 1295.227142]  perf_ftrace_function_call+0x248/0x360
[ 1295.227825]  ? perf_ftrace_function_call+0x248/0x360
[ 1295.228659]  ? 0xffffffffa0098099
[ 1295.229211]  0xffffffffa0098099
[ 1295.229712]  ? 0xffffffffa0098099
[ 1295.230236]  ? insn_get_immediate+0x49/0x570
[ 1295.230868]  ? insn_get_displacement+0x5/0x270
[ 1295.231506]  ? write_comp_data+0x2f/0x90
[ 1295.232089]  insn_get_displacement+0x5/0x270
[ 1295.232706]  insn_get_immediate+0x181/0x570
[ 1295.233309]  ? insn_get_displacement+0x5/0x270
[ 1295.233939]  ? insn_get_immediate+0x181/0x570
[ 1295.234584]  insn_get_length+0x75/0x90
[ 1295.235118]  insn_decode+0x9b/0x170
[ 1295.235620]  ? __ia32_sys_gethostname+0x190/0x190
[ 1295.236256]  text_poke_loc_init+0x63/0x140
[ 1295.236895]  ? __ia32_sys_gethostname+0x190/0x190
[ 1295.237552]  text_poke_queue+0x84/0xc0
[ 1295.238101]  ftrace_replace_code+0xfd/0x170
[ 1295.238709]  ftrace_modify_all_code+0x1b1/0x270
[ 1295.239365]  arch_ftrace_update_code+0x9/0x10
[ 1295.239958]  ftrace_run_update_code+0x30/0xa0
[ 1295.240562]  ftrace_startup_enable+0x5e/0xa0
[ 1295.241154]  ftrace_startup+0x16d/0x240
[ 1295.241722]  register_ftrace_function+0x43/0x90
[ 1295.242358]  perf_ftrace_event_register+0xc1/0xf0
[ 1295.243007]  perf_trace_event_init+0xa0/0x4c0
[ 1295.243629]  perf_trace_init+0xda/0x160
[ 1295.244182]  perf_tp_event_init+0x57/0xa0
[ 1295.244744]  perf_try_init_event+0x83/0x270
[ 1295.245350]  perf_event_alloc+0xe3f/0x1c10
[ 1295.245906]  ? _raw_spin_unlock+0x2c/0x50
[ 1295.246470]  ? alloc_fd+0x20d/0x320
[ 1295.247010]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1295.247667]  ? write_comp_data+0x2f/0x90
[ 1295.248383]  __x64_sys_perf_event_open+0x26/0x30
[ 1295.249012]  do_syscall_64+0x37/0x80
[ 1295.249514]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1295.250214] RIP: 0033:0x7fac0740459d
[ 1295.250708] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1295.253052] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1295.254038] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1295.254961] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1295.255880] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1295.256797] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1295.257715] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1295.258756] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1295.258876] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1295.259655] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1295.260730] caller is debug_smp_processor_id+0x1c/0x20
[ 1295.262081] Call Trace:
[ 1295.262093]  dump_stack_lvl+0xa4/0xd3
[ 1295.262117]  dump_stack+0x15/0x17
[ 1295.262133]  check_preemption_disabled+0x167/0x180
[ 1295.262151]  ? do_nanosleep+0x155/0x2a0
[ 1295.262166]  ? hrtimer_wakeup+0x40/0x40
[ 1295.262188]  debug_smp_processor_id+0x1c/0x20
[ 1295.266098]  perf_ftrace_function_call+0x7c/0x360
[ 1295.266696]  ? 0xffffffffa0098099
[ 1295.267117]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1295.267720]  ? finish_task_switch+0xab/0x2a0
[ 1295.268255]  ? __schedule+0x46e/0xb20
[ 1295.268724]  ? do_nanosleep+0x9c/0x2a0
[ 1295.269205]  ? do_nanosleep+0x9c/0x2a0
[ 1295.269683]  0xffffffffa0098099
[ 1295.270091]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1295.270680]  ? lock_is_held_type+0xe2/0x140
[ 1295.271210]  ? do_nanosleep+0x140/0x2a0
[ 1295.271700]  ? hrtimer_try_to_cancel+0x5/0x290
[ 1295.272257]  ? write_comp_data+0x2f/0x90
[ 1295.272754]  hrtimer_try_to_cancel+0x5/0x290
[ 1295.273291]  do_nanosleep+0x155/0x2a0
[ 1295.273756]  ? hrtimer_try_to_cancel+0x5/0x290
[ 1295.274314]  ? do_nanosleep+0x155/0x2a0
[ 1295.274798]  ? write_comp_data+0x2f/0x90
[ 1295.275305]  hrtimer_nanosleep+0xf7/0x1b0
[ 1295.275822]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1295.276406]  __x64_sys_nanosleep+0xfc/0x150
[ 1295.276945]  do_syscall_64+0x37/0x80
[ 1295.277396]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1295.278024] RIP: 0033:0x7fac073cca18
[ 1295.278480] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1295.280684] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1295.281598] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1295.282474] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1295.283300] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1295.284156] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1295.285013] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1295.285913] CPU: 0 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1295.285956] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1295.286969] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1295.287877] caller is debug_smp_processor_id+0x1c/0x20
[ 1295.289420] Call Trace:
[ 1295.290426]  dump_stack_lvl+0xa4/0xd3
[ 1295.291025]  dump_stack+0x15/0x17
[ 1295.291544]  check_preemption_disabled+0x167/0x180
[ 1295.292259]  ? insn_get_displacement+0x157/0x270
[ 1295.292935]  ? insn_rip_relative+0xb0/0xb0
[ 1295.293575]  debug_smp_processor_id+0x1c/0x20
[ 1295.294244]  perf_ftrace_function_call+0x7c/0x360
[ 1295.294950]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1295.295651]  ? insn_get_immediate+0x181/0x570
[ 1295.296305]  ? perf_ftrace_function_call+0x4c/0x360
[ 1295.297304]  0xffffffffa0098099
[ 1295.297852]  ? 0xffffffffa0098099
[ 1295.298431]  ? insn_get_displacement+0x47/0x270
[ 1295.299143]  ? insn_get_sib+0x5/0x140
[ 1295.299714]  ? write_comp_data+0x2f/0x90
[ 1295.300333]  insn_get_sib+0x5/0x140
[ 1295.300874]  insn_get_displacement+0x157/0x270
[ 1295.301541]  ? insn_get_sib+0x5/0x140
[ 1295.302101]  ? insn_get_displacement+0x157/0x270
[ 1295.302861]  insn_get_immediate+0x181/0x570
[ 1295.303548]  insn_get_length+0x75/0x90
[ 1295.304156]  insn_decode+0x9b/0x170
[ 1295.304719]  ? __ia32_sys_gethostname+0x190/0x190
[ 1295.305419]  text_poke_loc_init+0x63/0x140
[ 1295.306202]  ? __ia32_sys_gethostname+0x190/0x190
[ 1295.306947]  text_poke_queue+0x84/0xc0
[ 1295.307567]  ftrace_replace_code+0xfd/0x170
[ 1295.308254]  ftrace_modify_all_code+0x1b1/0x270
[ 1295.308976]  arch_ftrace_update_code+0x9/0x10
[ 1295.309632]  ftrace_run_update_code+0x30/0xa0
[ 1295.310312]  ftrace_startup_enable+0x5e/0xa0
[ 1295.310978]  ftrace_startup+0x16d/0x240
[ 1295.311652]  register_ftrace_function+0x43/0x90
[ 1295.312353]  perf_ftrace_event_register+0xc1/0xf0
[ 1295.313076]  perf_trace_event_init+0xa0/0x4c0
[ 1295.313786]  perf_trace_init+0xda/0x160
[ 1295.314429]  perf_tp_event_init+0x57/0xa0
[ 1295.315068]  perf_try_init_event+0x83/0x270
[ 1295.315769]  perf_event_alloc+0xe3f/0x1c10
[ 1295.316380]  ? _raw_spin_unlock+0x2c/0x50
[ 1295.317000]  ? alloc_fd+0x20d/0x320
[ 1295.317648]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1295.318395]  ? write_comp_data+0x2f/0x90
[ 1295.319343]  __x64_sys_perf_event_open+0x26/0x30
[ 1295.320044]  do_syscall_64+0x37/0x80
[ 1295.320607]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1295.321344] RIP: 0033:0x7fac0740459d
[ 1295.321891] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1295.324435] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1295.325511] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1295.326516] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1295.327511] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1295.328506] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1295.329579] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1295.330819] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1295.330937] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1295.331716] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1295.332789] caller is debug_smp_processor_id+0x1c/0x20
[ 1295.334148] Call Trace:
[ 1295.334159]  dump_stack_lvl+0xa4/0xd3
[ 1295.334182]  dump_stack+0x15/0x17
[ 1295.334198]  check_preemption_disabled+0x167/0x180
[ 1295.334216]  ? hrtimer_try_to_cancel+0x38/0x290
[ 1295.334233]  ? __hrtimer_get_remaining+0x80/0x80
[ 1295.334255]  debug_smp_processor_id+0x1c/0x20
[ 1295.338356]  perf_ftrace_function_call+0x7c/0x360
[ 1295.338946]  ? do_nanosleep+0x155/0x2a0
[ 1295.339432]  ? hrtimer_wakeup+0x40/0x40
[ 1295.339919]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1295.340506]  ? do_nanosleep+0x155/0x2a0
[ 1295.340993]  ? perf_ftrace_function_call+0x4c/0x360
[ 1295.341608]  ? 0xffffffffa0098099
[ 1295.342030]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1295.342647]  ? do_nanosleep+0x9c/0x2a0
[ 1295.343125]  0xffffffffa0098099
[ 1295.343524]  ? do_nanosleep+0x9c/0x2a0
[ 1295.344005]  ? do_nanosleep+0x9c/0x2a0
[ 1295.344487]  ? do_nanosleep+0x140/0x2a0
[ 1295.344978]  ? hrtimer_active+0x5/0xb0
[ 1295.345457]  ? do_nanosleep+0x140/0x2a0
[ 1295.345961]  hrtimer_active+0x5/0xb0
[ 1295.346434]  hrtimer_try_to_cancel+0x38/0x290
[ 1295.346984]  ? hrtimer_active+0x5/0xb0
[ 1295.347458]  ? hrtimer_try_to_cancel+0x38/0x290
[ 1295.348032]  ? do_nanosleep+0x9c/0x2a0
[ 1295.348509]  do_nanosleep+0x155/0x2a0
[ 1295.348973]  ? write_comp_data+0x2f/0x90
[ 1295.349481]  hrtimer_nanosleep+0xf7/0x1b0
[ 1295.350006]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1295.350598]  __x64_sys_nanosleep+0xfc/0x150
[ 1295.351138]  do_syscall_64+0x37/0x80
[ 1295.351594]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1295.352223] RIP: 0033:0x7fac073cca18
[ 1295.352674] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1295.354894] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1295.355811] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1295.356670] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1295.357529] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1295.358400] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1295.359258] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1295.360158] CPU: 0 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1295.360189] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1295.361208] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1295.362145] caller is debug_smp_processor_id+0x1c/0x20
[ 1295.363674] Call Trace:
[ 1295.364678]  dump_stack_lvl+0xa4/0xd3
[ 1295.365281]  dump_stack+0x15/0x17
[ 1295.365803]  check_preemption_disabled+0x167/0x180
[ 1295.366582]  debug_smp_processor_id+0x1c/0x20
[ 1295.367244]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1295.368100]  perf_trace_buf_alloc+0x3d/0x100
[ 1295.368751]  ? insn_get_displacement+0x157/0x270
[ 1295.369434]  ? insn_rip_relative+0xb0/0xb0
[ 1295.370073]  perf_ftrace_function_call+0x209/0x360
[ 1295.371007]  ? 0xffffffffa0098099
[ 1295.371648]  0xffffffffa0098099
[ 1295.372199]  ? 0xffffffffa0098099
[ 1295.372770]  ? insn_get_displacement+0x47/0x270
[ 1295.373484]  ? insn_get_sib+0x5/0x140
[ 1295.374051]  ? write_comp_data+0x2f/0x90
[ 1295.374680]  insn_get_sib+0x5/0x140
[ 1295.375224]  insn_get_displacement+0x157/0x270
[ 1295.375897]  ? insn_get_sib+0x5/0x140
[ 1295.376451]  ? insn_get_displacement+0x157/0x270
[ 1295.377188]  insn_get_immediate+0x181/0x570
[ 1295.377880]  insn_get_length+0x75/0x90
[ 1295.378502]  insn_decode+0x9b/0x170
[ 1295.379072]  ? __ia32_sys_gethostname+0x190/0x190
[ 1295.379779]  text_poke_loc_init+0x63/0x140
[ 1295.380562]  ? __ia32_sys_gethostname+0x190/0x190
[ 1295.381312]  text_poke_queue+0x84/0xc0
[ 1295.381940]  ftrace_replace_code+0xfd/0x170
[ 1295.382655]  ftrace_modify_all_code+0x1b1/0x270
[ 1295.383386]  arch_ftrace_update_code+0x9/0x10
[ 1295.384049]  ftrace_run_update_code+0x30/0xa0
[ 1295.384732]  ftrace_startup_enable+0x5e/0xa0
[ 1295.385405]  ftrace_startup+0x16d/0x240
[ 1295.386081]  register_ftrace_function+0x43/0x90
[ 1295.386790]  perf_ftrace_event_register+0xc1/0xf0
[ 1295.387524]  perf_trace_event_init+0xa0/0x4c0
[ 1295.388245]  perf_trace_init+0xda/0x160
[ 1295.388885]  perf_tp_event_init+0x57/0xa0
[ 1295.389525]  perf_try_init_event+0x83/0x270
[ 1295.390236]  perf_event_alloc+0xe3f/0x1c10
[ 1295.390855]  ? _raw_spin_unlock+0x2c/0x50
[ 1295.391485]  ? alloc_fd+0x20d/0x320
[ 1295.392142]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1295.392884]  ? write_comp_data+0x2f/0x90
[ 1295.393845]  __x64_sys_perf_event_open+0x26/0x30
[ 1295.394559]  do_syscall_64+0x37/0x80
[ 1295.395129]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1295.395874] RIP: 0033:0x7fac0740459d
[ 1295.396427] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1295.398954] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1295.400038] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1295.401040] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1295.402041] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1295.403047] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1295.404048] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1295.405283] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1295.406180] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1295.407541] Call Trace:
[ 1295.407858]  dump_stack_lvl+0xa4/0xd3
[ 1295.408329]  dump_stack+0x15/0x17
[ 1295.408753]  check_preemption_disabled+0x167/0x180
[ 1295.409351]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1295.409935]  ? __bpf_trace_sys_enter+0x10/0x10
[ 1295.410496]  debug_smp_processor_id+0x1c/0x20
[ 1295.411043]  perf_ftrace_function_call+0x7c/0x360
[ 1295.411635]  ? write_comp_data+0x2f/0x90
[ 1295.412135]  ? write_comp_data+0x2f/0x90
[ 1295.412635]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1295.413223]  ? write_comp_data+0x2f/0x90
[ 1295.413721]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1295.414324]  0xffffffffa0098099
[ 1295.414724]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1295.415335]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1295.416010]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1295.416610]  syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1295.417270]  syscall_exit_to_user_mode+0xd/0x60
[ 1295.417837]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1295.418515]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1295.419103]  do_syscall_64+0x46/0x80
[ 1295.419559]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1295.420187] RIP: 0033:0x7fac073cca18
[ 1295.420637] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1295.422852] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1295.423766] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1295.424625] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1295.425483] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1295.426345] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1295.427203] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1300.082115] check_preemption_disabled: 1095862 callbacks suppressed
[ 1300.082151] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1300.082247] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1300.083040] caller is debug_smp_processor_id+0x1c/0x20
[ 1300.083909] caller is debug_smp_processor_id+0x1c/0x20
[ 1300.084930] CPU: 0 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1300.087126] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1300.088586] Call Trace:
[ 1300.088987]  dump_stack_lvl+0xa4/0xd3
[ 1300.089593]  dump_stack+0x15/0x17
[ 1300.090105]  check_preemption_disabled+0x167/0x180
[ 1300.090793]  ? __get_locked_pte+0x1a2/0x290
[ 1300.091387]  ? __lock_text_start+0x8/0x8
[ 1300.092004]  debug_smp_processor_id+0x1c/0x20
[ 1300.092637]  perf_ftrace_function_call+0x7c/0x360
[ 1300.093580]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1300.094258]  ? write_comp_data+0x2f/0x90
[ 1300.094852]  ? perf_trace_buf_update+0x70/0x70
[ 1300.095617]  0xffffffffa0098099
[ 1300.096149]  ? __traceiter_jbd2_handle_extend+0x1/0x80
[ 1300.096923]  ? ftrace_call+0x5/0x44
[ 1300.097484]  ? pmd_page_vaddr+0x2b/0x70
[ 1300.098112]  ? _raw_spin_lock+0x5/0x50
[ 1300.098744]  _raw_spin_lock+0x5/0x50
[ 1300.099283]  __get_locked_pte+0x1a2/0x290
[ 1300.099874]  ? _raw_spin_lock+0x5/0x50
[ 1300.100416]  ? __get_locked_pte+0x1a2/0x290
[ 1300.101066]  ? __traceiter_jbd2_handle_extend+0x1/0x80
[ 1300.101825]  __text_poke+0xea/0x4e0
[ 1300.102364]  ? __traceiter_jbd2_handle_extend+0x1/0x80
[ 1300.103121]  ? lock_is_held_type+0xe2/0x140
[ 1300.103754]  ? __traceiter_jbd2_handle_extend+0x1/0x80
[ 1300.104546]  text_poke+0x2b/0x60
[ 1300.105092]  text_poke_bp_batch+0xf5/0x2c0
[ 1300.105759]  ? hugetlbfs_mknod+0x40/0x40
[ 1300.106419]  text_poke_queue+0xa7/0xc0
[ 1300.107048]  ftrace_replace_code+0xfd/0x170
[ 1300.107742]  ftrace_modify_all_code+0x1b1/0x270
[ 1300.108462]  arch_ftrace_update_code+0x9/0x10
[ 1300.109095]  ftrace_run_update_code+0x30/0xa0
[ 1300.109761]  ftrace_startup_enable+0x5e/0xa0
[ 1300.110422]  ftrace_startup+0x16d/0x240
[ 1300.111110]  register_ftrace_function+0x43/0x90
[ 1300.111798]  perf_ftrace_event_register+0xc1/0xf0
[ 1300.112508]  perf_trace_event_init+0xa0/0x4c0
[ 1300.113230]  perf_trace_init+0xda/0x160
[ 1300.113869]  perf_tp_event_init+0x57/0xa0
[ 1300.114503]  perf_try_init_event+0x83/0x270
[ 1300.115229]  perf_event_alloc+0xe3f/0x1c10
[ 1300.115842]  ? _raw_spin_unlock+0x2c/0x50
[ 1300.116500]  ? alloc_fd+0x20d/0x320
[ 1300.117249]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1300.118032]  ? write_comp_data+0x2f/0x90
[ 1300.119233]  __x64_sys_perf_event_open+0x26/0x30
[ 1300.119973]  do_syscall_64+0x37/0x80
[ 1300.120576]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1300.121340] RIP: 0033:0x7fac0740459d
[ 1300.121921] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1300.124477] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1300.125594] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1300.126619] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1300.127642] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1300.128665] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1300.129687] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1300.131087] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1300.131271] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1300.132054] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1300.133135] caller is debug_smp_processor_id+0x1c/0x20
[ 1300.134505] Call Trace:
[ 1300.134535]  dump_stack_lvl+0xa4/0xd3
[ 1300.134602]  dump_stack+0x15/0x17
[ 1300.134648]  check_preemption_disabled+0x167/0x180
[ 1300.134687]  ? lock_timer_base+0x34/0x100
[ 1300.137678]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1300.138306]  debug_smp_processor_id+0x1c/0x20
[ 1300.138891]  perf_ftrace_function_call+0x7c/0x360
[ 1300.139535]  ? ftrace_ops_test+0x71/0xc0
[ 1300.140101]  ? ftrace_ops_test+0x71/0xc0
[ 1300.140641]  ? perf_trace_buf_update+0x70/0x70
[ 1300.141235]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1300.141876]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1300.142482]  ? write_comp_data+0x2f/0x90
[ 1300.143022]  ? perf_trace_buf_update+0x70/0x70
[ 1300.143681]  0xffffffffa0098099
[ 1300.144180]  ? ftrace_call+0x5/0x44
[ 1300.144678]  ? lock_timer_base+0xc0/0x100
[ 1300.145246]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1300.145840]  ? write_comp_data+0x2f/0x90
[ 1300.146393]  _raw_spin_lock_irqsave+0x5/0x70
[ 1300.146967]  lock_timer_base+0x34/0x100
[ 1300.147490]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1300.148074]  ? lock_timer_base+0x34/0x100
[ 1300.148671]  try_to_del_timer_sync+0x33/0x90
[ 1300.149233]  ? try_to_del_timer_sync+0x5/0x90
[ 1300.149843]  del_timer_sync+0xd3/0x130
[ 1300.150384]  schedule_timeout+0x34e/0x610
[ 1300.150984]  ? del_timer_sync+0x130/0x130
[ 1300.151563]  ? i915_init_ggtt+0x40/0x6b0
[ 1300.152160]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1300.152757]  ? rcu_gp_init+0x730/0x730
[ 1300.153267]  rcu_gp_kthread+0xdd/0x170
[ 1300.153823]  kthread+0x1e7/0x230
[ 1300.154297]  ? set_kthread_struct+0x80/0x80
[ 1300.154898]  ret_from_fork+0x1f/0x30
[ 1300.155578] CPU: 0 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1300.155692] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1300.156648] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1300.157618] caller is debug_smp_processor_id+0x1c/0x20
[ 1300.159178] Call Trace:
[ 1300.159231]  dump_stack_lvl+0xa4/0xd3
[ 1300.160860]  dump_stack+0x15/0x17
[ 1300.161413]  check_preemption_disabled+0x167/0x180
[ 1300.162253]  debug_smp_processor_id+0x1c/0x20
[ 1300.162944]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1300.163861]  perf_trace_buf_alloc+0x3d/0x100
[ 1300.164542]  ? __get_locked_pte+0x1a2/0x290
[ 1300.165190]  ? __lock_text_start+0x8/0x8
[ 1300.165841]  perf_ftrace_function_call+0x209/0x360
[ 1300.166931]  ? 0xffffffffa0098099
[ 1300.167671]  0xffffffffa0098099
[ 1300.168247]  ? __traceiter_jbd2_handle_extend+0x1/0x80
[ 1300.169076]  ? ftrace_call+0x5/0x44
[ 1300.169683]  ? pmd_page_vaddr+0x2b/0x70
[ 1300.170359]  ? _raw_spin_lock+0x5/0x50
[ 1300.171040]  _raw_spin_lock+0x5/0x50
[ 1300.171628]  __get_locked_pte+0x1a2/0x290
[ 1300.172272]  ? _raw_spin_lock+0x5/0x50
[ 1300.172864]  ? __get_locked_pte+0x1a2/0x290
[ 1300.173564]  ? __traceiter_jbd2_handle_extend+0x1/0x80
[ 1300.174396]  __text_poke+0xea/0x4e0
[ 1300.174972]  ? __traceiter_jbd2_handle_extend+0x1/0x80
[ 1300.175800]  ? lock_is_held_type+0xe2/0x140
[ 1300.176483]  ? __traceiter_jbd2_handle_extend+0x1/0x80
[ 1300.177345]  text_poke+0x2b/0x60
[ 1300.177940]  text_poke_bp_batch+0xf5/0x2c0
[ 1300.178669]  ? hugetlbfs_mknod+0x40/0x40
[ 1300.179371]  text_poke_queue+0xa7/0xc0
[ 1300.180052]  ftrace_replace_code+0xfd/0x170
[ 1300.180805]  ftrace_modify_all_code+0x1b1/0x270
[ 1300.181588]  arch_ftrace_update_code+0x9/0x10
[ 1300.182282]  ftrace_run_update_code+0x30/0xa0
[ 1300.183010]  ftrace_startup_enable+0x5e/0xa0
[ 1300.183724]  ftrace_startup+0x16d/0x240
[ 1300.184467]  register_ftrace_function+0x43/0x90
[ 1300.185213]  perf_ftrace_event_register+0xc1/0xf0
[ 1300.185985]  perf_trace_event_init+0xa0/0x4c0
[ 1300.186771]  perf_trace_init+0xda/0x160
[ 1300.187464]  perf_tp_event_init+0x57/0xa0
[ 1300.188143]  perf_try_init_event+0x83/0x270
[ 1300.188918]  perf_event_alloc+0xe3f/0x1c10
[ 1300.189558]  ? _raw_spin_unlock+0x2c/0x50
[ 1300.190223]  ? alloc_fd+0x20d/0x320
[ 1300.190972]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1300.191753]  ? write_comp_data+0x2f/0x90
[ 1300.192950]  __x64_sys_perf_event_open+0x26/0x30
[ 1300.193693]  do_syscall_64+0x37/0x80
[ 1300.194301]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1300.195066] RIP: 0033:0x7fac0740459d
[ 1300.195646] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1300.198195] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1300.199309] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1300.200328] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1300.201348] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1300.202375] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1300.203398] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1300.204791] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1300.204958] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1300.205754] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1300.206906] caller is debug_smp_processor_id+0x1c/0x20
[ 1300.208127] Call Trace:
[ 1300.209131]  dump_stack_lvl+0xa4/0xd3
[ 1300.209660]  dump_stack+0x15/0x17
[ 1300.210122]  check_preemption_disabled+0x167/0x180
[ 1300.210759]  ? prepare_to_swait_event+0x1b/0xf0
[ 1300.211355]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1300.211976]  debug_smp_processor_id+0x1c/0x20
[ 1300.212559]  perf_ftrace_function_call+0x7c/0x360
[ 1300.213173]  ? ftrace_ops_test+0x71/0xc0
[ 1300.213784]  ? trace_hardirqs_on+0x3f/0x170
[ 1300.214387]  ? write_comp_data+0x2f/0x90
[ 1300.214928]  ? perf_trace_buf_update+0x70/0x70
[ 1300.215521]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1300.216219]  0xffffffffa0098099
[ 1300.216699]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1300.217360]  ? del_timer_sync+0xde/0x130
[ 1300.217923]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1300.218563]  _raw_spin_lock_irqsave+0x5/0x70
[ 1300.219140]  prepare_to_swait_event+0x1b/0xf0
[ 1300.219725]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1300.220307]  ? prepare_to_swait_event+0x1b/0xf0
[ 1300.220938]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1300.221534]  ? rcu_gp_init+0x730/0x730
[ 1300.222045]  rcu_gp_kthread+0xdd/0x170
[ 1300.222611]  kthread+0x1e7/0x230
[ 1300.223071]  ? set_kthread_struct+0x80/0x80
[ 1300.223674]  ret_from_fork+0x1f/0x30
[ 1300.224352] CPU: 0 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1300.224464] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1300.225331] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1300.226380] caller is debug_smp_processor_id+0x1c/0x20
[ 1300.227762] Call Trace:
[ 1300.228757]  dump_stack_lvl+0xa4/0xd3
[ 1300.229331]  dump_stack+0x15/0x17
[ 1300.229826]  check_preemption_disabled+0x167/0x180
[ 1300.230580]  debug_smp_processor_id+0x1c/0x20
[ 1300.231203]  perf_trace_buf_alloc+0x98/0x100
[ 1300.231815]  ? __get_locked_pte+0x1a2/0x290
[ 1300.232402]  ? __lock_text_start+0x8/0x8
[ 1300.232982]  perf_ftrace_function_call+0x209/0x360
[ 1300.233887]  ? 0xffffffffa0098099
[ 1300.234515]  0xffffffffa0098099
[ 1300.235016]  ? __traceiter_jbd2_handle_extend+0x1/0x80
[ 1300.235756]  ? ftrace_call+0x5/0x44
[ 1300.236293]  ? pmd_page_vaddr+0x2b/0x70
[ 1300.236883]  ? _raw_spin_lock+0x5/0x50
[ 1300.237479]  _raw_spin_lock+0x5/0x50
[ 1300.238005]  __get_locked_pte+0x1a2/0x290
[ 1300.238594]  ? _raw_spin_lock+0x5/0x50
[ 1300.239130]  ? __get_locked_pte+0x1a2/0x290
[ 1300.239751]  ? __traceiter_jbd2_handle_extend+0x1/0x80
[ 1300.240497]  __text_poke+0xea/0x4e0
[ 1300.241011]  ? __traceiter_jbd2_handle_extend+0x1/0x80
[ 1300.241753]  ? lock_is_held_type+0xe2/0x140
[ 1300.242375]  ? __traceiter_jbd2_handle_extend+0x1/0x80
[ 1300.243142]  text_poke+0x2b/0x60
[ 1300.243661]  text_poke_bp_batch+0xf5/0x2c0
[ 1300.244298]  ? hugetlbfs_mknod+0x40/0x40
[ 1300.244914]  text_poke_queue+0xa7/0xc0
[ 1300.245510]  ftrace_replace_code+0xfd/0x170
[ 1300.246176]  ftrace_modify_all_code+0x1b1/0x270
[ 1300.246868]  arch_ftrace_update_code+0x9/0x10
[ 1300.247488]  ftrace_run_update_code+0x30/0xa0
[ 1300.248132]  ftrace_startup_enable+0x5e/0xa0
[ 1300.248765]  ftrace_startup+0x16d/0x240
[ 1300.249406]  register_ftrace_function+0x43/0x90
[ 1300.250077]  perf_ftrace_event_register+0xc1/0xf0
[ 1300.250768]  perf_trace_event_init+0xa0/0x4c0
[ 1300.251451]  perf_trace_init+0xda/0x160
[ 1300.252058]  perf_tp_event_init+0x57/0xa0
[ 1300.252661]  perf_try_init_event+0x83/0x270
[ 1300.253336]  perf_event_alloc+0xe3f/0x1c10
[ 1300.253915]  ? _raw_spin_unlock+0x2c/0x50
[ 1300.254517]  ? alloc_fd+0x20d/0x320
[ 1300.255152]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1300.255851]  ? write_comp_data+0x2f/0x90
[ 1300.256802]  __x64_sys_perf_event_open+0x26/0x30
[ 1300.257468]  do_syscall_64+0x37/0x80
[ 1300.258005]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1300.258712] RIP: 0033:0x7fac0740459d
[ 1300.259232] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1300.261588] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1300.262609] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1300.263550] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1300.264490] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1300.265430] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1300.266374] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1300.267567] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1300.267733] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1300.268529] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1300.269530] caller is debug_smp_processor_id+0x1c/0x20
[ 1300.270898] Call Trace:
[ 1300.270927]  dump_stack_lvl+0xa4/0xd3
[ 1300.270992]  dump_stack+0x15/0x17
[ 1300.271028]  check_preemption_disabled+0x167/0x180
[ 1300.271067]  ? finish_swait+0x41/0x80
[ 1300.273969]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1300.274596]  debug_smp_processor_id+0x1c/0x20
[ 1300.275178]  perf_ftrace_function_call+0x7c/0x360
[ 1300.275793]  ? ftrace_ops_test+0x71/0xc0
[ 1300.276332]  ? rcu_advance_cbs+0x70/0x70
[ 1300.276890]  ? write_comp_data+0x2f/0x90
[ 1300.277430]  ? perf_trace_buf_update+0x70/0x70
[ 1300.278022]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1300.278667]  ? write_comp_data+0x2f/0x90
[ 1300.279206]  ? perf_trace_buf_update+0x70/0x70
[ 1300.279799]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1300.280495]  0xffffffffa0098099
[ 1300.280993]  ? trace_hardirqs_on+0x3f/0x170
[ 1300.281618]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1300.282250]  _raw_spin_lock_irqsave+0x5/0x70
[ 1300.282825]  finish_swait+0x41/0x80
[ 1300.283306]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1300.283890]  ? finish_swait+0x41/0x80
[ 1300.284418]  rcu_gp_fqs_loop+0x2da/0x410
[ 1300.285013]  ? rcu_gp_init+0x730/0x730
[ 1300.285521]  rcu_gp_kthread+0xdd/0x170
[ 1300.286081]  kthread+0x1e7/0x230
[ 1300.286541]  ? set_kthread_struct+0x80/0x80
[ 1300.287139]  ret_from_fork+0x1f/0x30
[ 1300.287815] CPU: 0 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1300.287927] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1300.288802] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1300.289775] caller is debug_smp_processor_id+0x1c/0x20
[ 1300.291227] Call Trace:
[ 1300.291263]  dump_stack_lvl+0xa4/0xd3
[ 1300.291346]  dump_stack+0x15/0x17
[ 1300.293214]  check_preemption_disabled+0x167/0x180
[ 1300.293953]  debug_smp_processor_id+0x1c/0x20
[ 1300.294581]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1300.295355]  perf_tp_event+0x331/0x4e0
[ 1300.296238]  ? arch_local_irq_enable+0x10/0x12
[ 1300.296880]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1300.297569]  ? dump_stack_lvl+0xcc/0xd3
[ 1300.298166]  ? dump_stack+0x15/0x17
[ 1300.298681]  ? check_preemption_disabled+0x167/0x180
[ 1300.299438]  ? __get_locked_pte+0x1a2/0x290
[ 1300.300025]  ? __lock_text_start+0x8/0x8
[ 1300.300617]  perf_ftrace_function_call+0x248/0x360
[ 1300.301280]  ? perf_ftrace_function_call+0x248/0x360
[ 1300.302234]  ? 0xffffffffa0098099
[ 1300.302855]  0xffffffffa0098099
[ 1300.303357]  ? __traceiter_jbd2_handle_extend+0x1/0x80
[ 1300.304099]  ? ftrace_call+0x5/0x44
[ 1300.304636]  ? pmd_page_vaddr+0x2b/0x70
[ 1300.305228]  ? _raw_spin_lock+0x5/0x50
[ 1300.305823]  _raw_spin_lock+0x5/0x50
[ 1300.306356]  __get_locked_pte+0x1a2/0x290
[ 1300.306937]  ? _raw_spin_lock+0x5/0x50
[ 1300.307473]  ? __get_locked_pte+0x1a2/0x290
[ 1300.308098]  ? __traceiter_jbd2_handle_extend+0x1/0x80
[ 1300.308841]  __text_poke+0xea/0x4e0
[ 1300.309358]  ? __traceiter_jbd2_handle_extend+0x1/0x80
[ 1300.310106]  ? lock_is_held_type+0xe2/0x140
[ 1300.310722]  ? __traceiter_jbd2_handle_extend+0x1/0x80
[ 1300.311496]  text_poke+0x2b/0x60
[ 1300.312018]  text_poke_bp_batch+0xf5/0x2c0
[ 1300.312657]  ? hugetlbfs_mknod+0x40/0x40
[ 1300.313274]  text_poke_queue+0xa7/0xc0
[ 1300.313872]  ftrace_replace_code+0xfd/0x170
[ 1300.314566]  ftrace_modify_all_code+0x1b1/0x270
[ 1300.315258]  arch_ftrace_update_code+0x9/0x10
[ 1300.315880]  ftrace_run_update_code+0x30/0xa0
[ 1300.316526]  ftrace_startup_enable+0x5e/0xa0
[ 1300.317161]  ftrace_startup+0x16d/0x240
[ 1300.317802]  register_ftrace_function+0x43/0x90
[ 1300.318478]  perf_ftrace_event_register+0xc1/0xf0
[ 1300.319172]  perf_trace_event_init+0xa0/0x4c0
[ 1300.319855]  perf_trace_init+0xda/0x160
[ 1300.320463]  perf_tp_event_init+0x57/0xa0
[ 1300.321065]  perf_try_init_event+0x83/0x270
[ 1300.321740]  perf_event_alloc+0xe3f/0x1c10
[ 1300.322327]  ? _raw_spin_unlock+0x2c/0x50
[ 1300.322918]  ? alloc_fd+0x20d/0x320
[ 1300.323551]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1300.324252]  ? write_comp_data+0x2f/0x90
[ 1300.325201]  __x64_sys_perf_event_open+0x26/0x30
[ 1300.325868]  do_syscall_64+0x37/0x80
[ 1300.326416]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1300.327117] RIP: 0033:0x7fac0740459d
[ 1300.327646] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1300.330008] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1300.331034] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1300.331974] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1300.332913] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1300.333852] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1300.334799] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1300.335990] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1300.336184] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1300.336950] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1300.338190] caller is debug_smp_processor_id+0x1c/0x20
[ 1300.339409] Call Trace:
[ 1300.340474]  dump_stack_lvl+0xa4/0xd3
[ 1300.341001]  dump_stack+0x15/0x17
[ 1300.341464]  check_preemption_disabled+0x167/0x180
[ 1300.342101]  ? force_qs_rnp+0xd0/0x2c0
[ 1300.342600]  ? preempt_schedule+0x30/0x30
[ 1300.343158]  debug_smp_processor_id+0x1c/0x20
[ 1300.343741]  perf_ftrace_function_call+0x7c/0x360
[ 1300.344356]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1300.344997]  ? ftrace_ops_test+0x71/0xc0
[ 1300.345536]  ? rcu_advance_cbs+0x70/0x70
[ 1300.346095]  ? write_comp_data+0x2f/0x90
[ 1300.346636]  ? perf_trace_buf_update+0x70/0x70
[ 1300.347228]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1300.347868]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1300.348462]  ? force_qs_rnp+0xcb/0x2c0
[ 1300.348969]  ? sched_show_task+0x70/0x70
[ 1300.349528]  ? rcu_gp_torture_wait+0x20/0x20
[ 1300.350115]  0xffffffffa0098099
[ 1300.350550]  ? rcu_exp_wait_wake+0x4c0/0x4c0
[ 1300.351249]  ? __cond_resched+0x5/0x30
[ 1300.351778]  ? ___might_sleep+0x143/0x170
[ 1300.352318]  __cond_resched+0x5/0x30
[ 1300.352809]  force_qs_rnp+0xd0/0x2c0
[ 1300.353300]  ? __cond_resched+0x5/0x30
[ 1300.353802]  ? force_qs_rnp+0xd0/0x2c0
[ 1300.354379]  rcu_gp_fqs_loop+0x2eb/0x410
[ 1300.354974]  ? rcu_gp_init+0x730/0x730
[ 1300.355485]  rcu_gp_kthread+0xdd/0x170
[ 1300.356041]  kthread+0x1e7/0x230
[ 1300.356502]  ? set_kthread_struct+0x80/0x80
[ 1300.357102]  ret_from_fork+0x1f/0x30
[ 1300.357779] CPU: 0 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1300.357923] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1300.358853] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1300.358889] Call Trace:
[ 1300.358941]  dump_stack_lvl+0xa4/0xd3
[ 1300.359987] caller is debug_smp_processor_id+0x1c/0x20
[ 1300.361612]  dump_stack+0x15/0x17
[ 1300.363624]  check_preemption_disabled+0x167/0x180
[ 1300.364373]  ? __get_locked_pte+0x1a2/0x290
[ 1300.365022]  ? __lock_text_start+0x8/0x8
[ 1300.365687]  debug_smp_processor_id+0x1c/0x20
[ 1300.366382]  perf_ftrace_function_call+0x7c/0x360
[ 1300.367401]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1300.368132]  ? write_comp_data+0x2f/0x90
[ 1300.368778]  ? perf_trace_buf_update+0x70/0x70
[ 1300.369604]  0xffffffffa0098099
[ 1300.370182]  ? __traceiter_jbd2_handle_stats+0x1/0xa0
[ 1300.370998]  ? ftrace_call+0x5/0x44
[ 1300.371617]  ? pmd_page_vaddr+0x2b/0x70
[ 1300.372313]  ? _raw_spin_lock+0x5/0x50
[ 1300.373023]  _raw_spin_lock+0x5/0x50
[ 1300.373660]  __get_locked_pte+0x1a2/0x290
[ 1300.374327]  ? _raw_spin_lock+0x5/0x50
[ 1300.374923]  ? __get_locked_pte+0x1a2/0x290
[ 1300.375628]  ? __traceiter_jbd2_handle_stats+0x1/0xa0
[ 1300.376449]  __text_poke+0xea/0x4e0
[ 1300.377028]  ? __traceiter_jbd2_handle_stats+0x1/0xa0
[ 1300.377847]  ? lock_is_held_type+0xe2/0x140
[ 1300.378545]  ? __traceiter_jbd2_handle_stats+0x1/0xa0
[ 1300.379402]  text_poke+0x2b/0x60
[ 1300.380000]  text_poke_bp_batch+0xf5/0x2c0
[ 1300.380727]  ? hugetlbfs_mknod+0x40/0x40
[ 1300.381433]  text_poke_queue+0xa7/0xc0
[ 1300.382120]  ftrace_replace_code+0xfd/0x170
[ 1300.382875]  ftrace_modify_all_code+0x1b1/0x270
[ 1300.383657]  arch_ftrace_update_code+0x9/0x10
[ 1300.384344]  ftrace_run_update_code+0x30/0xa0
[ 1300.385066]  ftrace_startup_enable+0x5e/0xa0
[ 1300.385778]  ftrace_startup+0x16d/0x240
[ 1300.386525]  register_ftrace_function+0x43/0x90
[ 1300.387273]  perf_ftrace_event_register+0xc1/0xf0
[ 1300.388045]  perf_trace_event_init+0xa0/0x4c0
[ 1300.388823]  perf_trace_init+0xda/0x160
[ 1300.389516]  perf_tp_event_init+0x57/0xa0
[ 1300.390199]  perf_try_init_event+0x83/0x270
[ 1300.390972]  perf_event_alloc+0xe3f/0x1c10
[ 1300.391610]  ? _raw_spin_unlock+0x2c/0x50
[ 1300.392270]  ? alloc_fd+0x20d/0x320
[ 1300.393020]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1300.393800]  ? write_comp_data+0x2f/0x90
[ 1300.394999]  __x64_sys_perf_event_open+0x26/0x30
[ 1300.395743]  do_syscall_64+0x37/0x80
[ 1300.396346]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1300.397112] RIP: 0033:0x7fac0740459d
[ 1300.397693] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1300.400247] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1300.401360] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1300.402392] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1300.403413] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1300.404434] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1300.405455] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1300.406852] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1300.407909] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1300.409334] Call Trace:
[ 1300.409693]  dump_stack_lvl+0xa4/0xd3
[ 1300.410242]  dump_stack+0x15/0x17
[ 1300.410714]  check_preemption_disabled+0x167/0x180
[ 1300.411365]  ? do_epoll_wait+0x3b3/0xd80
[ 1300.411902]  ? __mutex_lock+0x9f0/0x9f0
[ 1300.412453]  debug_smp_processor_id+0x1c/0x20
[ 1300.413051]  perf_ftrace_function_call+0x7c/0x360
[ 1300.413747]  ? ftrace_call+0x5/0x44
[ 1300.414232]  ? trace_hardirqs_on+0x6a/0x170
[ 1300.414843]  ? finish_task_switch+0xb0/0x2a0
[ 1300.415418]  ? finish_task_switch+0x70/0x2a0
[ 1300.416020]  ? trace_hardirqs_on+0x3f/0x170
[ 1300.416582]  ? finish_task_switch+0x70/0x2a0
[ 1300.417185]  ? preempt_count_sub+0x5/0xa0
[ 1300.417808]  0xffffffffa0098099
[ 1300.418264]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1300.418918]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1300.419730]  ? do_epoll_wait+0x36b/0xd80
[ 1300.420310]  ? mutex_lock_nested+0x5/0x20
[ 1300.420861]  ? write_comp_data+0x2f/0x90
[ 1300.421420]  mutex_lock_nested+0x5/0x20
[ 1300.421951]  do_epoll_wait+0x3b3/0xd80
[ 1300.422483]  ? mutex_lock_nested+0x5/0x20
[ 1300.423025]  ? do_epoll_wait+0x3b3/0xd80
[ 1300.423733]  ? wait_woken+0x90/0x90
[ 1300.424298]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1300.424938]  do_syscall_64+0x37/0x80
[ 1300.425447]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1300.426120] RIP: 0033:0x7f8a39143b20
[ 1300.426617] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1300.428910] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1300.429887] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1300.430796] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1300.431702] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1300.432700] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1300.433597] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1305.086151] check_preemption_disabled: 778840 callbacks suppressed
[ 1305.086179] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1305.088022] caller is debug_smp_processor_id+0x1c/0x20
[ 1305.088723] CPU: 0 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1305.089686] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1305.091160] Call Trace:
[ 1305.091556]  dump_stack_lvl+0xa4/0xd3
[ 1305.092159]  dump_stack+0x15/0x17
[ 1305.092667]  check_preemption_disabled+0x167/0x180
[ 1305.093356]  ? __get_locked_pte+0x1a2/0x290
[ 1305.093954]  ? __lock_text_start+0x8/0x8
[ 1305.094586]  debug_smp_processor_id+0x1c/0x20
[ 1305.095222]  perf_ftrace_function_call+0x7c/0x360
[ 1305.096158]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1305.096814]  ? write_comp_data+0x2f/0x90
[ 1305.097397]  ? perf_trace_buf_update+0x70/0x70
[ 1305.098156]  0xffffffffa0098099
[ 1305.098680]  ? tty_buffer_set_lock_subclass+0x50/0x50
[ 1305.099425]  ? ftrace_call+0x5/0x44
[ 1305.099973]  ? pmd_page_vaddr+0x2b/0x70
[ 1305.100577]  ? _raw_spin_lock+0x5/0x50
[ 1305.101191]  _raw_spin_lock+0x5/0x50
[ 1305.101728]  __get_locked_pte+0x1a2/0x290
[ 1305.102334]  ? _raw_spin_lock+0x5/0x50
[ 1305.102866]  ? __get_locked_pte+0x1a2/0x290
[ 1305.103500]  ? tty_buffer_set_lock_subclass+0x50/0x50
[ 1305.104231]  __text_poke+0xea/0x4e0
[ 1305.104748]  ? tty_buffer_set_lock_subclass+0x50/0x50
[ 1305.105479]  ? lock_is_held_type+0xe2/0x140
[ 1305.106103]  ? tty_buffer_set_lock_subclass+0x50/0x50
[ 1305.106873]  text_poke+0x2b/0x60
[ 1305.107409]  text_poke_bp_batch+0x1dc/0x2c0
[ 1305.108071]  ? fn_show_state+0x20/0x20
[ 1305.108691]  text_poke_queue+0xa7/0xc0
[ 1305.109304]  ftrace_replace_code+0xfd/0x170
[ 1305.109991]  ftrace_modify_all_code+0x1b1/0x270
[ 1305.110715]  arch_ftrace_update_code+0x9/0x10
[ 1305.111333]  ftrace_run_update_code+0x30/0xa0
[ 1305.111985]  ftrace_startup_enable+0x5e/0xa0
[ 1305.112625]  ftrace_startup+0x16d/0x240
[ 1305.113299]  register_ftrace_function+0x43/0x90
[ 1305.113970]  perf_ftrace_event_register+0xc1/0xf0
[ 1305.114679]  perf_trace_event_init+0xa0/0x4c0
[ 1305.115381]  perf_trace_init+0xda/0x160
[ 1305.116005]  perf_tp_event_init+0x57/0xa0
[ 1305.116617]  perf_try_init_event+0x83/0x270
[ 1305.117315]  perf_event_alloc+0xe3f/0x1c10
[ 1305.117890]  ? _raw_spin_unlock+0x2c/0x50
[ 1305.118498]  ? alloc_fd+0x20d/0x320
[ 1305.119177]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1305.119897]  ? write_comp_data+0x2f/0x90
[ 1305.121027]  __x64_sys_perf_event_open+0x26/0x30
[ 1305.121739]  do_syscall_64+0x37/0x80
[ 1305.122327]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1305.123056] RIP: 0033:0x7fac0740459d
[ 1305.123616] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1305.126052] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1305.127131] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1305.128107] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1305.129078] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1305.130061] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1305.131037] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1305.132646] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1305.132661] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1305.132691] caller is debug_smp_processor_id+0x1c/0x20
[ 1305.133763] caller is debug_smp_processor_id+0x1c/0x20
[ 1305.135013] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1305.137371] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1305.138790] Call Trace:
[ 1305.139145]  dump_stack_lvl+0xa4/0xd3
[ 1305.139681]  dump_stack+0x15/0x17
[ 1305.140145]  check_preemption_disabled+0x167/0x180
[ 1305.140786]  ? do_epoll_wait+0x3b3/0xd80
[ 1305.141317]  ? __mutex_lock+0x9f0/0x9f0
[ 1305.141862]  debug_smp_processor_id+0x1c/0x20
[ 1305.142463]  perf_ftrace_function_call+0x7c/0x360
[ 1305.143149]  ? ftrace_call+0x5/0x44
[ 1305.143623]  ? trace_hardirqs_on+0x6a/0x170
[ 1305.144227]  ? finish_task_switch+0xb0/0x2a0
[ 1305.144796]  ? finish_task_switch+0x70/0x2a0
[ 1305.145392]  ? trace_hardirqs_on+0x3f/0x170
[ 1305.145950]  ? finish_task_switch+0x70/0x2a0
[ 1305.146554]  ? preempt_count_sub+0x5/0xa0
[ 1305.147158]  0xffffffffa0098099
[ 1305.147606]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1305.148253]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1305.149002]  ? do_epoll_wait+0x36b/0xd80
[ 1305.149567]  ? mutex_lock_nested+0x5/0x20
[ 1305.150116]  ? write_comp_data+0x2f/0x90
[ 1305.150670]  mutex_lock_nested+0x5/0x20
[ 1305.151195]  do_epoll_wait+0x3b3/0xd80
[ 1305.151715]  ? mutex_lock_nested+0x5/0x20
[ 1305.152247]  ? do_epoll_wait+0x3b3/0xd80
[ 1305.152941]  ? wait_woken+0x90/0x90
[ 1305.153501]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1305.154139]  do_syscall_64+0x37/0x80
[ 1305.154647]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1305.155313] RIP: 0033:0x7f8a39143b20
[ 1305.155805] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1305.158082] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1305.159060] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1305.159958] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1305.160857] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1305.161757] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1305.162665] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1305.163762] CPU: 0 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1305.163920] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1305.164832] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1305.165870] caller is debug_smp_processor_id+0x1c/0x20
[ 1305.167436] Call Trace:
[ 1305.167491]  dump_stack_lvl+0xa4/0xd3
[ 1305.169135]  dump_stack+0x15/0x17
[ 1305.169690]  check_preemption_disabled+0x167/0x180
[ 1305.170539]  debug_smp_processor_id+0x1c/0x20
[ 1305.171234]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1305.172151]  perf_trace_buf_alloc+0x3d/0x100
[ 1305.172833]  ? __get_locked_pte+0x1a2/0x290
[ 1305.173481]  ? __lock_text_start+0x8/0x8
[ 1305.174141]  perf_ftrace_function_call+0x209/0x360
[ 1305.175232]  ? 0xffffffffa0098099
[ 1305.175974]  0xffffffffa0098099
[ 1305.176549]  ? tty_buffer_set_lock_subclass+0x50/0x50
[ 1305.177367]  ? ftrace_call+0x5/0x44
[ 1305.177978]  ? pmd_page_vaddr+0x2b/0x70
[ 1305.178659]  ? _raw_spin_lock+0x5/0x50
[ 1305.179342]  _raw_spin_lock+0x5/0x50
[ 1305.179932]  __get_locked_pte+0x1a2/0x290
[ 1305.180577]  ? _raw_spin_lock+0x5/0x50
[ 1305.181170]  ? __get_locked_pte+0x1a2/0x290
[ 1305.181874]  ? tty_buffer_set_lock_subclass+0x50/0x50
[ 1305.182698]  __text_poke+0xea/0x4e0
[ 1305.183275]  ? tty_buffer_set_lock_subclass+0x50/0x50
[ 1305.184091]  ? lock_is_held_type+0xe2/0x140
[ 1305.184776]  ? tty_buffer_set_lock_subclass+0x50/0x50
[ 1305.185628]  text_poke+0x2b/0x60
[ 1305.186232]  text_poke_bp_batch+0x1dc/0x2c0
[ 1305.186970]  ? fn_show_state+0x20/0x20
[ 1305.187659]  text_poke_queue+0xa7/0xc0
[ 1305.188344]  ftrace_replace_code+0xfd/0x170
[ 1305.189101]  ftrace_modify_all_code+0x1b1/0x270
[ 1305.189887]  arch_ftrace_update_code+0x9/0x10
[ 1305.190587]  ftrace_run_update_code+0x30/0xa0
[ 1305.191315]  ftrace_startup_enable+0x5e/0xa0
[ 1305.192030]  ftrace_startup+0x16d/0x240
[ 1305.192777]  register_ftrace_function+0x43/0x90
[ 1305.193526]  perf_ftrace_event_register+0xc1/0xf0
[ 1305.194310]  perf_trace_event_init+0xa0/0x4c0
[ 1305.195093]  perf_trace_init+0xda/0x160
[ 1305.195792]  perf_tp_event_init+0x57/0xa0
[ 1305.196473]  perf_try_init_event+0x83/0x270
[ 1305.197249]  perf_event_alloc+0xe3f/0x1c10
[ 1305.197889]  ? _raw_spin_unlock+0x2c/0x50
[ 1305.198557]  ? alloc_fd+0x20d/0x320
[ 1305.199309]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1305.200093]  ? write_comp_data+0x2f/0x90
[ 1305.201289]  __x64_sys_perf_event_open+0x26/0x30
[ 1305.202032]  do_syscall_64+0x37/0x80
[ 1305.202643]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1305.203433] RIP: 0033:0x7fac0740459d
[ 1305.204014] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1305.206572] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1305.207690] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1305.208714] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1305.209740] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1305.210804] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1305.211830] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1305.213232] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1305.213402] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1305.214268] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1305.214290] Call Trace:
[ 1305.214318]  dump_stack_lvl+0xa4/0xd3
[ 1305.214383]  dump_stack+0x15/0x17
[ 1305.214420]  check_preemption_disabled+0x167/0x180
[ 1305.215402] caller is debug_smp_processor_id+0x1c/0x20
[ 1305.216797]  ? mutex_lock_nested+0x1b/0x20
[ 1305.219811]  ? mutex_lock_io_nested+0x940/0x940
[ 1305.220441]  debug_smp_processor_id+0x1c/0x20
[ 1305.221033]  perf_ftrace_function_call+0x7c/0x360
[ 1305.221666]  ? perf_ftrace_function_call+0x4c/0x360
[ 1305.222382]  ? ftrace_call+0x5/0x44
[ 1305.222858]  ? trace_hardirqs_on+0x6a/0x170
[ 1305.223463]  ? finish_task_switch+0xb0/0x2a0
[ 1305.224031]  ? finish_task_switch+0x70/0x2a0
[ 1305.224634]  ? trace_hardirqs_on+0x3f/0x170
[ 1305.225192]  ? finish_task_switch+0x70/0x2a0
[ 1305.225843]  0xffffffffa0098099
[ 1305.226299]  ? 0xffffffffa0098099
[ 1305.226767]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1305.227415]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1305.228129]  ? do_epoll_wait+0x3b3/0xd80
[ 1305.228713]  ? __mutex_lock+0x5/0x9f0
[ 1305.229219]  ? mutex_lock_nested+0x5/0x20
[ 1305.229767]  ? write_comp_data+0x2f/0x90
[ 1305.230322]  __mutex_lock+0x5/0x9f0
[ 1305.230809]  mutex_lock_nested+0x1b/0x20
[ 1305.231347]  ? __mutex_lock+0x5/0x9f0
[ 1305.231845]  ? mutex_lock_nested+0x1b/0x20
[ 1305.232402]  do_epoll_wait+0x3b3/0xd80
[ 1305.233079]  ? wait_woken+0x90/0x90
[ 1305.233639]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1305.234282]  do_syscall_64+0x37/0x80
[ 1305.234787]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1305.235450] RIP: 0033:0x7f8a39143b20
[ 1305.235940] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1305.238213] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1305.239179] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1305.240077] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1305.240972] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1305.241868] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1305.242772] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1305.243868] CPU: 0 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1305.243975] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1305.244849] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1305.245887] caller is debug_smp_processor_id+0x1c/0x20
[ 1305.247337] Call Trace:
[ 1305.247374]  dump_stack_lvl+0xa4/0xd3
[ 1305.247457]  dump_stack+0x15/0x17
[ 1305.249335]  check_preemption_disabled+0x167/0x180
[ 1305.250078]  debug_smp_processor_id+0x1c/0x20
[ 1305.250706]  perf_trace_buf_alloc+0x98/0x100
[ 1305.251323]  ? __get_locked_pte+0x1a2/0x290
[ 1305.251913]  ? __lock_text_start+0x8/0x8
[ 1305.252496]  perf_ftrace_function_call+0x209/0x360
[ 1305.253402]  ? 0xffffffffa0098099
[ 1305.254023]  0xffffffffa0098099
[ 1305.254537]  ? tty_buffer_set_lock_subclass+0x50/0x50
[ 1305.255266]  ? ftrace_call+0x5/0x44
[ 1305.255804]  ? pmd_page_vaddr+0x2b/0x70
[ 1305.256398]  ? _raw_spin_lock+0x5/0x50
[ 1305.256994]  _raw_spin_lock+0x5/0x50
[ 1305.257522]  __get_locked_pte+0x1a2/0x290
[ 1305.258112]  ? _raw_spin_lock+0x5/0x50
[ 1305.258649]  ? __get_locked_pte+0x1a2/0x290
[ 1305.259272]  ? tty_buffer_set_lock_subclass+0x50/0x50
[ 1305.260002]  __text_poke+0xea/0x4e0
[ 1305.260518]  ? tty_buffer_set_lock_subclass+0x50/0x50
[ 1305.261247]  ? lock_is_held_type+0xe2/0x140
[ 1305.261860]  ? tty_buffer_set_lock_subclass+0x50/0x50
[ 1305.262617]  text_poke+0x2b/0x60
[ 1305.263138]  text_poke_bp_batch+0x1dc/0x2c0
[ 1305.263790]  ? fn_show_state+0x20/0x20
[ 1305.264388]  text_poke_queue+0xa7/0xc0
[ 1305.264984]  ftrace_replace_code+0xfd/0x170
[ 1305.265649]  ftrace_modify_all_code+0x1b1/0x270
[ 1305.266343]  arch_ftrace_update_code+0x9/0x10
[ 1305.266968]  ftrace_run_update_code+0x30/0xa0
[ 1305.267615]  ftrace_startup_enable+0x5e/0xa0
[ 1305.268249]  ftrace_startup+0x16d/0x240
[ 1305.268892]  register_ftrace_function+0x43/0x90
[ 1305.269561]  perf_ftrace_event_register+0xc1/0xf0
[ 1305.270254]  perf_trace_event_init+0xa0/0x4c0
[ 1305.270940]  perf_trace_init+0xda/0x160
[ 1305.271550]  perf_tp_event_init+0x57/0xa0
[ 1305.272155]  perf_try_init_event+0x83/0x270
[ 1305.272829]  perf_event_alloc+0xe3f/0x1c10
[ 1305.273409]  ? _raw_spin_unlock+0x2c/0x50
[ 1305.273999]  ? alloc_fd+0x20d/0x320
[ 1305.274638]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1305.275339]  ? write_comp_data+0x2f/0x90
[ 1305.276291]  __x64_sys_perf_event_open+0x26/0x30
[ 1305.276959]  do_syscall_64+0x37/0x80
[ 1305.277498]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1305.278200] RIP: 0033:0x7fac0740459d
[ 1305.278721] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1305.281088] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1305.282112] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1305.283051] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1305.283991] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1305.284930] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1305.285868] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1305.287068] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1305.287241] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1305.288103] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1305.289099] caller is debug_smp_processor_id+0x1c/0x20
[ 1305.290489] Call Trace:
[ 1305.290519]  dump_stack_lvl+0xa4/0xd3
[ 1305.290585]  dump_stack+0x15/0x17
[ 1305.290622]  check_preemption_disabled+0x167/0x180
[ 1305.290661]  ? ep_start_scan+0x68/0x100
[ 1305.293605]  ? _raw_read_lock_irq+0xa0/0xa0
[ 1305.294195]  debug_smp_processor_id+0x1c/0x20
[ 1305.294784]  perf_ftrace_function_call+0x7c/0x360
[ 1305.295413]  ? ftrace_ops_test+0x71/0xc0
[ 1305.295963]  ? preempt_notifier_dec+0x20/0x20
[ 1305.296607]  ? ftrace_call+0x5/0x44
[ 1305.297127]  ? write_comp_data+0x2f/0x90
[ 1305.297673]  ? perf_trace_buf_update+0x70/0x70
[ 1305.298281]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1305.298978]  0xffffffffa0098099
[ 1305.299463]  ? ftrace_call+0x5/0x44
[ 1305.299948]  ? __mutex_lock+0xfe/0x9f0
[ 1305.300464]  ? do_epoll_wait+0x3b3/0xd80
[ 1305.301002]  ? ep_start_scan+0xe0/0x100
[ 1305.301557]  ? _raw_write_lock_irq+0x5/0x60
[ 1305.302133]  ? write_comp_data+0x2f/0x90
[ 1305.302688]  _raw_write_lock_irq+0x5/0x60
[ 1305.303237]  ep_start_scan+0x68/0x100
[ 1305.303751]  ? _raw_write_lock_irq+0x5/0x60
[ 1305.304310]  ? ep_start_scan+0x68/0x100
[ 1305.304875]  do_epoll_wait+0x3bf/0xd80
[ 1305.305551]  ? wait_woken+0x90/0x90
[ 1305.306117]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1305.306754]  do_syscall_64+0x37/0x80
[ 1305.307259]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1305.307924] RIP: 0033:0x7f8a39143b20
[ 1305.308414] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1305.310693] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1305.311661] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1305.312558] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1305.313476] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1305.314384] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1305.315280] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1305.316373] CPU: 0 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1305.316486] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1305.317353] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1305.318459] caller is debug_smp_processor_id+0x1c/0x20
[ 1305.319839] Call Trace:
[ 1305.320840]  dump_stack_lvl+0xa4/0xd3
[ 1305.321415]  dump_stack+0x15/0x17
[ 1305.321911]  check_preemption_disabled+0x167/0x180
[ 1305.322653]  debug_smp_processor_id+0x1c/0x20
[ 1305.323276]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1305.324050]  perf_tp_event+0x331/0x4e0
[ 1305.324934]  ? arch_local_irq_enable+0x10/0x12
[ 1305.325580]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1305.326275]  ? dump_stack_lvl+0xcc/0xd3
[ 1305.326870]  ? dump_stack+0x15/0x17
[ 1305.327384]  ? check_preemption_disabled+0x167/0x180
[ 1305.328143]  ? __get_locked_pte+0x1a2/0x290
[ 1305.328730]  ? __lock_text_start+0x8/0x8
[ 1305.329325]  perf_ftrace_function_call+0x248/0x360
[ 1305.329991]  ? perf_ftrace_function_call+0x248/0x360
[ 1305.330948]  ? 0xffffffffa0098099
[ 1305.331571]  0xffffffffa0098099
[ 1305.332073]  ? tty_buffer_set_lock_subclass+0x50/0x50
[ 1305.332804]  ? ftrace_call+0x5/0x44
[ 1305.333345]  ? pmd_page_vaddr+0x2b/0x70
[ 1305.333938]  ? _raw_spin_lock+0x5/0x50
[ 1305.334538]  _raw_spin_lock+0x5/0x50
[ 1305.335065]  __get_locked_pte+0x1a2/0x290
[ 1305.335647]  ? _raw_spin_lock+0x5/0x50
[ 1305.336184]  ? __get_locked_pte+0x1a2/0x290
[ 1305.336808]  ? tty_buffer_set_lock_subclass+0x50/0x50
[ 1305.337539]  __text_poke+0xea/0x4e0
[ 1305.338073]  ? tty_buffer_set_lock_subclass+0x50/0x50
[ 1305.338815]  ? lock_is_held_type+0xe2/0x140
[ 1305.339429]  ? tty_buffer_set_lock_subclass+0x50/0x50
[ 1305.340181]  text_poke+0x2b/0x60
[ 1305.340702]  text_poke_bp_batch+0x1dc/0x2c0
[ 1305.341351]  ? fn_show_state+0x20/0x20
[ 1305.341947]  text_poke_queue+0xa7/0xc0
[ 1305.342547]  ftrace_replace_code+0xfd/0x170
[ 1305.343206]  ftrace_modify_all_code+0x1b1/0x270
[ 1305.343900]  arch_ftrace_update_code+0x9/0x10
[ 1305.344521]  ftrace_run_update_code+0x30/0xa0
[ 1305.345168]  ftrace_startup_enable+0x5e/0xa0
[ 1305.345804]  ftrace_startup+0x16d/0x240
[ 1305.346451]  register_ftrace_function+0x43/0x90
[ 1305.347120]  perf_ftrace_event_register+0xc1/0xf0
[ 1305.347811]  perf_trace_event_init+0xa0/0x4c0
[ 1305.348494]  perf_trace_init+0xda/0x160
[ 1305.349101]  perf_tp_event_init+0x57/0xa0
[ 1305.349706]  perf_try_init_event+0x83/0x270
[ 1305.350384]  perf_event_alloc+0xe3f/0x1c10
[ 1305.350964]  ? _raw_spin_unlock+0x2c/0x50
[ 1305.351556]  ? alloc_fd+0x20d/0x320
[ 1305.352192]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1305.352892]  ? write_comp_data+0x2f/0x90
[ 1305.353846]  __x64_sys_perf_event_open+0x26/0x30
[ 1305.354514]  do_syscall_64+0x37/0x80
[ 1305.355052]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1305.355750] RIP: 0033:0x7fac0740459d
[ 1305.356268] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1305.358629] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1305.359646] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1305.360584] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1305.361524] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1305.362464] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1305.363404] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1305.364599] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1305.364789] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1305.365625] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1305.366859] caller is debug_smp_processor_id+0x1c/0x20
[ 1305.368089] Call Trace:
[ 1305.369150]  dump_stack_lvl+0xa4/0xd3
[ 1305.369686]  dump_stack+0x15/0x17
[ 1305.370154]  check_preemption_disabled+0x167/0x180
[ 1305.370797]  ? ep_done_scan+0x3b/0x240
[ 1305.371306]  ? _raw_read_lock_irq+0xa0/0xa0
[ 1305.371895]  debug_smp_processor_id+0x1c/0x20
[ 1305.372485]  perf_ftrace_function_call+0x7c/0x360
[ 1305.373116]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1305.373764]  ? ftrace_ops_test+0x71/0xc0
[ 1305.374340]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1305.374987]  ? _prb_read_valid+0x3ad/0x3f0
[ 1305.375594]  ? write_comp_data+0x2f/0x90
[ 1305.376207]  0xffffffffa0098099
[ 1305.376654]  ? ep_destroy_wakeup_source+0xe0/0xe0
[ 1305.377359]  ? do_epoll_wait+0x85a/0xd80
[ 1305.377924]  ? _raw_write_lock_irq+0x5/0x60
[ 1305.378536]  _raw_write_lock_irq+0x5/0x60
[ 1305.379087]  ep_done_scan+0x3b/0x240
[ 1305.379586]  ? _raw_write_lock_irq+0x5/0x60
[ 1305.380145]  ? ep_done_scan+0x3b/0x240
[ 1305.380737]  do_epoll_wait+0xabb/0xd80
[ 1305.381413]  ? wait_woken+0x90/0x90
[ 1305.381972]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1305.382612]  do_syscall_64+0x37/0x80
[ 1305.383118]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1305.383782] RIP: 0033:0x7f8a39143b20
[ 1305.384272] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1305.386541] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1305.387510] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1305.388407] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1305.389306] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1305.390206] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1305.391103] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1305.392199] CPU: 0 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1305.392304] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1305.393268] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1305.394372] caller is debug_smp_processor_id+0x1c/0x20
[ 1305.395866] Call Trace:
[ 1305.396910]  dump_stack_lvl+0xa4/0xd3
[ 1305.397565]  dump_stack+0x15/0x17
[ 1305.398123]  check_preemption_disabled+0x167/0x180
[ 1305.398873]  ? __get_locked_pte+0x1a2/0x290
[ 1305.399521]  ? __lock_text_start+0x8/0x8
[ 1305.400191]  debug_smp_processor_id+0x1c/0x20
[ 1305.400884]  perf_ftrace_function_call+0x7c/0x360
[ 1305.401904]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1305.402641]  ? write_comp_data+0x2f/0x90
[ 1305.403290]  ? perf_trace_buf_update+0x70/0x70
[ 1305.404119]  0xffffffffa0098099
[ 1305.404697]  ? tty_buffer_restart_work+0x30/0x30
[ 1305.405455]  ? ftrace_call+0x5/0x44
[ 1305.406068]  ? pmd_page_vaddr+0x2b/0x70
[ 1305.406745]  ? _raw_spin_lock+0x5/0x50
[ 1305.407425]  _raw_spin_lock+0x5/0x50
[ 1305.408013]  __get_locked_pte+0x1a2/0x290
[ 1305.408658]  ? _raw_spin_lock+0x5/0x50
[ 1305.409251]  ? __get_locked_pte+0x1a2/0x290
[ 1305.409954]  ? tty_buffer_restart_work+0x30/0x30
[ 1305.410716]  __text_poke+0xea/0x4e0
[ 1305.411291]  ? tty_buffer_restart_work+0x30/0x30
[ 1305.412049]  ? lock_is_held_type+0xe2/0x140
[ 1305.412735]  ? tty_buffer_restart_work+0x30/0x30
[ 1305.413528]  text_poke+0x2b/0x60
[ 1305.414126]  text_poke_bp_batch+0x1dc/0x2c0
[ 1305.414865]  ? fn_show_state+0x20/0x20
[ 1305.415553]  text_poke_queue+0xa7/0xc0
[ 1305.416237]  ftrace_replace_code+0xfd/0x170
[ 1305.416993]  ftrace_modify_all_code+0x1b1/0x270
[ 1305.417777]  arch_ftrace_update_code+0x9/0x10
[ 1305.418480]  ftrace_run_update_code+0x30/0xa0
[ 1305.419215]  ftrace_startup_enable+0x5e/0xa0
[ 1305.419932]  ftrace_startup+0x16d/0x240
[ 1305.420677]  register_ftrace_function+0x43/0x90
[ 1305.421428]  perf_ftrace_event_register+0xc1/0xf0
[ 1305.422207]  perf_trace_event_init+0xa0/0x4c0
[ 1305.422990]  perf_trace_init+0xda/0x160
[ 1305.423685]  perf_tp_event_init+0x57/0xa0
[ 1305.424367]  perf_try_init_event+0x83/0x270
[ 1305.425143]  perf_event_alloc+0xe3f/0x1c10
[ 1305.425786]  ? _raw_spin_unlock+0x2c/0x50
[ 1305.426459]  ? alloc_fd+0x20d/0x320
[ 1305.427209]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1305.428064]  ? write_comp_data+0x2f/0x90
[ 1305.429264]  __x64_sys_perf_event_open+0x26/0x30
[ 1305.430005]  do_syscall_64+0x37/0x80
[ 1305.430616]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1305.431380] RIP: 0033:0x7fac0740459d
[ 1305.431961] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1305.434519] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1305.435637] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1305.436657] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1305.437687] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1305.438720] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1305.439740] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1305.441128] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1305.442182] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1305.443589] Call Trace:
[ 1305.443942]  dump_stack_lvl+0xa4/0xd3
[ 1305.444478]  dump_stack+0x15/0x17
[ 1305.444944]  check_preemption_disabled+0x167/0x180
[ 1305.445586]  ? do_epoll_wait+0xac3/0xd80
[ 1305.446126]  ? __mutex_unlock_slowpath+0x2e0/0x2e0
[ 1305.446784]  debug_smp_processor_id+0x1c/0x20
[ 1305.447375]  perf_ftrace_function_call+0x7c/0x360
[ 1305.448018]  ? perf_trace_buf_update+0x70/0x70
[ 1305.448617]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1305.449266]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1305.449866]  ? _raw_write_unlock_irq+0x38/0x50
[ 1305.450480]  ? preempt_notifier_dec+0x20/0x20
[ 1305.451124]  ? ftrace_call+0x5/0x44
[ 1305.451612]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1305.452327]  0xffffffffa0098099
[ 1305.452794]  ? preempt_count_sub+0x5/0xa0
[ 1305.453441]  ? mutex_unlock+0x5/0x20
[ 1305.453974]  mutex_unlock+0x5/0x20
[ 1305.454453]  do_epoll_wait+0xac3/0xd80
[ 1305.454974]  ? mutex_unlock+0x5/0x20
[ 1305.455458]  ? do_epoll_wait+0xac3/0xd80
[ 1305.456154]  ? wait_woken+0x90/0x90
[ 1305.456713]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1305.457348]  do_syscall_64+0x37/0x80
[ 1305.457852]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1305.458519] RIP: 0033:0x7f8a39143b20
[ 1305.459010] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1305.461283] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1305.462254] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1305.463152] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1305.464060] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1305.464960] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1305.465857] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1310.089984] check_preemption_disabled: 770724 callbacks suppressed
[ 1310.090001] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1310.090060] BUG: using smp_processor_id() in preemptible [00000000] code: rs:main Q:Reg/365
[ 1310.090799] caller is debug_smp_processor_id+0x1c/0x20
[ 1310.091896] caller is debug_smp_processor_id+0x1c/0x20
[ 1310.092865] CPU: 1 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1310.095019] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1310.096344] Call Trace:
[ 1310.096652]  dump_stack_lvl+0xa4/0xd3
[ 1310.097110]  dump_stack+0x15/0x17
[ 1310.097521]  check_preemption_disabled+0x167/0x180
[ 1310.098114]  ? text_poke_bp_batch+0xf5/0x2c0
[ 1310.098634]  ? apply_paravirt+0x150/0x150
[ 1310.099172]  debug_smp_processor_id+0x1c/0x20
[ 1310.099754]  perf_ftrace_function_call+0x7c/0x360
[ 1310.100386]  ? fbcon_fb_unregistered+0x1/0x250
[ 1310.100992]  ? 0xffffffffa0098099
[ 1310.101442]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1310.102102]  0xffffffffa0098099
[ 1310.102530]  ? _raw_spin_unlock+0x2c/0x50
[ 1310.103066]  ? write_comp_data+0x2f/0x90
[ 1310.103598]  ? fbcon_remap_all+0x1/0xa0
[ 1310.104118]  ? fbcon_remap_all+0x1/0xa0
[ 1310.104633]  ? text_poke+0x5/0x60
[ 1310.105089]  text_poke+0x5/0x60
[ 1310.105518]  text_poke_bp_batch+0xf5/0x2c0
[ 1310.106068]  ? text_poke+0x5/0x60
[ 1310.106528]  ? text_poke_bp_batch+0xf5/0x2c0
[ 1310.107103]  ? ipmi_addr_src_to_str+0x50/0x50
[ 1310.107691]  text_poke_queue+0xa7/0xc0
[ 1310.108204]  ftrace_replace_code+0xfd/0x170
[ 1310.108772]  ftrace_modify_all_code+0x1b1/0x270
[ 1310.109382]  arch_ftrace_update_code+0x9/0x10
[ 1310.109962]  ftrace_run_update_code+0x30/0xa0
[ 1310.110549]  ftrace_shutdown+0x2b8/0x4a0
[ 1310.111086]  unregister_ftrace_function+0x25/0x50
[ 1310.111712]  perf_ftrace_event_register+0x89/0xf0
[ 1310.112337]  ? perf_tp_event_init+0xa0/0xa0
[ 1310.112896]  perf_trace_destroy+0x37/0x60
[ 1310.113436]  tp_perf_event_destroy+0x15/0x20
[ 1310.114007]  _free_event+0xfc/0x7d0
[ 1310.114489]  put_event+0x37/0x50
[ 1310.114932]  perf_event_release_kernel+0x2f4/0x370
[ 1310.115575]  ? perf_event_release_kernel+0x370/0x370
[ 1310.116231]  perf_release+0x19/0x20
[ 1310.116704]  __fput+0x12d/0x460
[ 1310.117149]  ____fput+0x1a/0x20
[ 1310.117579]  task_work_run+0x8e/0xf0
[ 1310.118072]  do_exit+0x616/0x1310
[ 1310.118534]  ? write_comp_data+0x2f/0x90
[ 1310.119071]  do_group_exit+0x7e/0x130
[ 1310.119573]  get_signal+0x249/0x13c0
[ 1310.120062]  ? get_signal+0x5/0x13c0
[ 1310.120559]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1310.121200]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1310.121848]  exit_to_user_mode_prepare+0x154/0x240
[ 1310.122494]  syscall_exit_to_user_mode+0x2b/0x60
[ 1310.123109]  do_syscall_64+0x46/0x80
[ 1310.123591]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1310.124257] RIP: 0033:0x7fac0740459d
[ 1310.124735] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1310.125571] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1310.126550] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1310.127462] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1310.128377] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1310.129293] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1310.130211] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1310.131163] CPU: 0 PID: 365 Comm: rs:main Q:Reg Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1310.131193] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1310.132325] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1310.133309] caller is debug_smp_processor_id+0x1c/0x20
[ 1310.134921] Call Trace:
[ 1310.134957]  dump_stack_lvl+0xa4/0xd3
[ 1310.136561]  dump_stack+0x15/0x17
[ 1310.137101]  check_preemption_disabled+0x167/0x180
[ 1310.137843]  ? ext4_block_write_begin+0x64f/0x9f0
[ 1310.138567]  ? trace_sched_waking+0xc0/0xc0
[ 1310.139245]  debug_smp_processor_id+0x1c/0x20
[ 1310.139927]  perf_ftrace_function_call+0x7c/0x360
[ 1310.140660]  ? 0xffffffffa0098099
[ 1310.141235]  ? ext4_da_get_block_prep+0x47c/0x7f0
[ 1310.142021]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1310.142767]  ? lock_is_held_type+0xe2/0x140
[ 1310.143467]  ? ext4_da_get_block_prep+0x776/0x7f0
[ 1310.144283]  0xffffffffa0098099
[ 1310.144847]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1310.145619]  ? ext4_block_write_begin+0x61e/0x9f0
[ 1310.146384]  ? preempt_count_add+0x5/0xc0
[ 1310.147017]  ? write_comp_data+0x2f/0x90
[ 1310.147659]  preempt_count_add+0x5/0xc0
[ 1310.148269]  ext4_block_write_begin+0x64f/0x9f0
[ 1310.148976]  ? preempt_count_add+0x5/0xc0
[ 1310.149596]  ? ext4_block_write_begin+0x64f/0x9f0
[ 1310.150341]  ? ext4_da_release_space+0x2a0/0x2a0
[ 1310.151143]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1310.151948]  ext4_da_write_begin+0x1d4/0x560
[ 1310.152758]  generic_perform_write+0x166/0x2b0
[ 1310.153612]  ext4_buffered_write_iter+0xe0/0x1f0
[ 1310.154398]  ext4_file_write_iter+0xb9/0xb70
[ 1310.155087]  ? ext4_buffered_write_iter+0x1f0/0x1f0
[ 1310.155827]  ? iov_iter_init+0x4d/0x90
[ 1310.156591]  new_sync_write+0x21b/0x300
[ 1310.157427]  vfs_write+0x3ea/0x610
[ 1310.158053]  ksys_write+0x9e/0x170
[ 1310.158684]  __x64_sys_write+0x23/0x30
[ 1310.159295]  do_syscall_64+0x37/0x80
[ 1310.159880]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1310.160650] RIP: 0033:0x7f3db99ffd07
[ 1310.161220] Code: c3 66 90 41 54 49 89 d4 55 48 89 f5 53 89 fb 48 83 ec 10 e8 0b fd ff ff 41 89 c0 4c 89 e2 48 89 ee 89 df b8 01 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 35 44 89 c7 48 89 44 24 08 e8 44 fd ff ff 48
[ 1310.163835] RSP: 002b:00007f3db5dbf870 EFLAGS: 00000293 ORIG_RAX: 0000000000000001
[ 1310.164955] RAX: ffffffffffffffda RBX: 0000000000000005 RCX: 00007f3db99ffd07
[ 1310.165992] RDX: 0000000000000133 RSI: 00007f3da8004410 RDI: 0000000000000005
[ 1310.167032] RBP: 00007f3da8004410 R08: 0000000000000000 R09: 0000000000000000
[ 1310.168069] R10: 0000000000000000 R11: 0000000000000293 R12: 0000000000000133
[ 1310.169107] R13: 0000000000000000 R14: 0000557e3e371be0 R15: 0000000000000005
[ 1310.170371] CPU: 1 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1310.170519] BUG: using smp_processor_id() in preemptible [00000000] code: rs:main Q:Reg/365
[ 1310.171337] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1310.172520] caller is debug_smp_processor_id+0x1c/0x20
[ 1310.173946] Call Trace:
[ 1310.173956]  dump_stack_lvl+0xa4/0xd3
[ 1310.175501]  dump_stack+0x15/0x17
[ 1310.175951]  check_preemption_disabled+0x167/0x180
[ 1310.176584]  ? text_poke+0x2b/0x60
[ 1310.177041]  ? do_sync_core+0x30/0x30
[ 1310.177536]  debug_smp_processor_id+0x1c/0x20
[ 1310.178119]  perf_ftrace_function_call+0x7c/0x360
[ 1310.178742]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1310.179362]  ? text_poke_bp_batch+0xf5/0x2c0
[ 1310.179930]  ? perf_ftrace_function_call+0x4c/0x360
[ 1310.180580]  ? fbcon_fb_unregistered+0x1/0x250
[ 1310.181173]  ? 0xffffffffa0098099
[ 1310.181618]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1310.182256]  ? fbcon_remap_all+0x1/0xa0
[ 1310.182776]  0xffffffffa0098099
[ 1310.183208]  ? _raw_spin_unlock+0x2c/0x50
[ 1310.183745]  ? fbcon_remap_all+0x1/0xa0
[ 1310.184263]  ? fbcon_remap_all+0x1/0xa0
[ 1310.184775]  ? __text_poke+0x5/0x4e0
[ 1310.185256]  ? lock_is_held_type+0xe2/0x140
[ 1310.185816]  __text_poke+0x5/0x4e0
[ 1310.186279]  text_poke+0x2b/0x60
[ 1310.186717]  ? __text_poke+0x5/0x4e0
[ 1310.187197]  ? text_poke+0x2b/0x60
[ 1310.187662]  text_poke_bp_batch+0xf5/0x2c0
[ 1310.188214]  ? ipmi_addr_src_to_str+0x50/0x50
[ 1310.188799]  text_poke_queue+0xa7/0xc0
[ 1310.189310]  ftrace_replace_code+0xfd/0x170
[ 1310.189874]  ftrace_modify_all_code+0x1b1/0x270
[ 1310.190485]  arch_ftrace_update_code+0x9/0x10
[ 1310.191063]  ftrace_run_update_code+0x30/0xa0
[ 1310.191644]  ftrace_shutdown+0x2b8/0x4a0
[ 1310.192178]  unregister_ftrace_function+0x25/0x50
[ 1310.192801]  perf_ftrace_event_register+0x89/0xf0
[ 1310.193423]  ? perf_tp_event_init+0xa0/0xa0
[ 1310.193980]  perf_trace_destroy+0x37/0x60
[ 1310.194524]  tp_perf_event_destroy+0x15/0x20
[ 1310.195097]  _free_event+0xfc/0x7d0
[ 1310.195576]  put_event+0x37/0x50
[ 1310.196017]  perf_event_release_kernel+0x2f4/0x370
[ 1310.196658]  ? perf_event_release_kernel+0x370/0x370
[ 1310.197316]  perf_release+0x19/0x20
[ 1310.197789]  __fput+0x12d/0x460
[ 1310.198236]  ____fput+0x1a/0x20
[ 1310.198666]  task_work_run+0x8e/0xf0
[ 1310.199156]  do_exit+0x616/0x1310
[ 1310.199615]  ? write_comp_data+0x2f/0x90
[ 1310.200152]  do_group_exit+0x7e/0x130
[ 1310.200653]  get_signal+0x249/0x13c0
[ 1310.201141]  ? get_signal+0x5/0x13c0
[ 1310.201636]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1310.202278]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1310.202926]  exit_to_user_mode_prepare+0x154/0x240
[ 1310.203561]  syscall_exit_to_user_mode+0x2b/0x60
[ 1310.204172]  do_syscall_64+0x46/0x80
[ 1310.204654]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1310.205319] RIP: 0033:0x7fac0740459d
[ 1310.205796] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1310.206634] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1310.207607] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1310.208518] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1310.209431] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1310.210347] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1310.211258] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1310.212207] CPU: 0 PID: 365 Comm: rs:main Q:Reg Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1310.212228] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1310.213371] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1310.214377] caller is debug_smp_processor_id+0x1c/0x20
[ 1310.215972] Call Trace:
[ 1310.217024]  dump_stack_lvl+0xa4/0xd3
[ 1310.217645]  dump_stack+0x15/0x17
[ 1310.218190]  check_preemption_disabled+0x167/0x180
[ 1310.218990]  debug_smp_processor_id+0x1c/0x20
[ 1310.219680]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1310.220567]  perf_trace_buf_alloc+0x3d/0x100
[ 1310.221240]  ? ext4_block_write_begin+0x64f/0x9f0
[ 1310.221960]  ? trace_sched_waking+0xc0/0xc0
[ 1310.222634]  perf_ftrace_function_call+0x209/0x360
[ 1310.223588]  ? 0xffffffffa0098099
[ 1310.224244]  0xffffffffa0098099
[ 1310.224809]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1310.225584]  ? ext4_block_write_begin+0x61e/0x9f0
[ 1310.226352]  ? preempt_count_add+0x5/0xc0
[ 1310.226988]  ? write_comp_data+0x2f/0x90
[ 1310.227634]  preempt_count_add+0x5/0xc0
[ 1310.228249]  ext4_block_write_begin+0x64f/0x9f0
[ 1310.228958]  ? preempt_count_add+0x5/0xc0
[ 1310.229583]  ? ext4_block_write_begin+0x64f/0x9f0
[ 1310.230331]  ? ext4_da_release_space+0x2a0/0x2a0
[ 1310.231144]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1310.231952]  ext4_da_write_begin+0x1d4/0x560
[ 1310.232769]  generic_perform_write+0x166/0x2b0
[ 1310.233630]  ext4_buffered_write_iter+0xe0/0x1f0
[ 1310.234422]  ext4_file_write_iter+0xb9/0xb70
[ 1310.235116]  ? ext4_buffered_write_iter+0x1f0/0x1f0
[ 1310.235859]  ? iov_iter_init+0x4d/0x90
[ 1310.236613]  new_sync_write+0x21b/0x300
[ 1310.237456]  vfs_write+0x3ea/0x610
[ 1310.238091]  ksys_write+0x9e/0x170
[ 1310.238724]  __x64_sys_write+0x23/0x30
[ 1310.239337]  do_syscall_64+0x37/0x80
[ 1310.239925]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1310.240701] RIP: 0033:0x7f3db99ffd07
[ 1310.241276] Code: c3 66 90 41 54 49 89 d4 55 48 89 f5 53 89 fb 48 83 ec 10 e8 0b fd ff ff 41 89 c0 4c 89 e2 48 89 ee 89 df b8 01 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 35 44 89 c7 48 89 44 24 08 e8 44 fd ff ff 48
[ 1310.243933] RSP: 002b:00007f3db5dbf870 EFLAGS: 00000293 ORIG_RAX: 0000000000000001
[ 1310.245064] RAX: ffffffffffffffda RBX: 0000000000000005 RCX: 00007f3db99ffd07
[ 1310.246117] RDX: 0000000000000133 RSI: 00007f3da8004410 RDI: 0000000000000005
[ 1310.247161] RBP: 00007f3da8004410 R08: 0000000000000000 R09: 0000000000000000
[ 1310.248205] R10: 0000000000000000 R11: 0000000000000293 R12: 0000000000000133
[ 1310.249252] R13: 0000000000000000 R14: 0000557e3e371be0 R15: 0000000000000005
[ 1310.250533] CPU: 1 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1310.250671] BUG: using smp_processor_id() in preemptible [00000000] code: rs:main Q:Reg/365
[ 1310.251501] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1310.252603] caller is debug_smp_processor_id+0x1c/0x20
[ 1310.254041] Call Trace:
[ 1310.254050]  dump_stack_lvl+0xa4/0xd3
[ 1310.254078]  dump_stack+0x15/0x17
[ 1310.254094]  check_preemption_disabled+0x167/0x180
[ 1310.254113]  ? __text_poke+0xea/0x4e0
[ 1310.254129]  ? __pmd_alloc+0x420/0x420
[ 1310.254150]  debug_smp_processor_id+0x1c/0x20
[ 1310.258211]  perf_ftrace_function_call+0x7c/0x360
[ 1310.258839]  ? dump_stack+0x15/0x17
[ 1310.259310]  ? write_comp_data+0x2f/0x90
[ 1310.259835]  ? text_poke+0x2b/0x60
[ 1310.260293]  ? do_sync_core+0x30/0x30
[ 1310.260786]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1310.261420]  ? text_poke+0x2b/0x60
[ 1310.261880]  ? perf_ftrace_function_call+0x4c/0x360
[ 1310.262533]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1310.263155]  ? text_poke_bp_batch+0xf5/0x2c0
[ 1310.263724]  ? perf_ftrace_function_call+0x4c/0x360
[ 1310.264379]  ? fbcon_remap_all+0x1/0xa0
[ 1310.264896]  0xffffffffa0098099
[ 1310.265346]  ? __get_locked_pte+0x5/0x290
[ 1310.265889]  __get_locked_pte+0x5/0x290
[ 1310.266412]  __text_poke+0xea/0x4e0
[ 1310.266883]  ? __get_locked_pte+0x5/0x290
[ 1310.267416]  ? __text_poke+0xea/0x4e0
[ 1310.267907]  ? fbcon_remap_all+0x1/0xa0
[ 1310.268423]  ? lock_is_held_type+0xe2/0x140
[ 1310.268982]  ? fbcon_remap_all+0x1/0xa0
[ 1310.269502]  text_poke+0x2b/0x60
[ 1310.269946]  text_poke_bp_batch+0xf5/0x2c0
[ 1310.270508]  ? ipmi_addr_src_to_str+0x50/0x50
[ 1310.271092]  text_poke_queue+0xa7/0xc0
[ 1310.271604]  ftrace_replace_code+0xfd/0x170
[ 1310.272169]  ftrace_modify_all_code+0x1b1/0x270
[ 1310.272781]  arch_ftrace_update_code+0x9/0x10
[ 1310.273360]  ftrace_run_update_code+0x30/0xa0
[ 1310.273943]  ftrace_shutdown+0x2b8/0x4a0
[ 1310.274481]  unregister_ftrace_function+0x25/0x50
[ 1310.275105]  perf_ftrace_event_register+0x89/0xf0
[ 1310.275730]  ? perf_tp_event_init+0xa0/0xa0
[ 1310.276288]  perf_trace_destroy+0x37/0x60
[ 1310.276827]  tp_perf_event_destroy+0x15/0x20
[ 1310.277399]  _free_event+0xfc/0x7d0
[ 1310.277878]  put_event+0x37/0x50
[ 1310.278328]  perf_event_release_kernel+0x2f4/0x370
[ 1310.278971]  ? perf_event_release_kernel+0x370/0x370
[ 1310.279629]  perf_release+0x19/0x20
[ 1310.280101]  __fput+0x12d/0x460
[ 1310.280545]  ____fput+0x1a/0x20
[ 1310.280975]  task_work_run+0x8e/0xf0
[ 1310.281466]  do_exit+0x616/0x1310
[ 1310.281924]  ? write_comp_data+0x2f/0x90
[ 1310.282468]  do_group_exit+0x7e/0x130
[ 1310.282971]  get_signal+0x249/0x13c0
[ 1310.283458]  ? get_signal+0x5/0x13c0
[ 1310.283953]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1310.284593]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1310.285240]  exit_to_user_mode_prepare+0x154/0x240
[ 1310.285874]  syscall_exit_to_user_mode+0x2b/0x60
[ 1310.286495]  do_syscall_64+0x46/0x80
[ 1310.286977]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1310.287644] RIP: 0033:0x7fac0740459d
[ 1310.288120] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1310.288954] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1310.289930] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1310.290854] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1310.291781] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1310.292702] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1310.293615] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1310.294572] CPU: 0 PID: 365 Comm: rs:main Q:Reg Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1310.294595] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1310.295655] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1310.296645] caller is debug_smp_processor_id+0x1c/0x20
[ 1310.298161] Call Trace:
[ 1310.298180]  dump_stack_lvl+0xa4/0xd3
[ 1310.299710]  dump_stack+0x15/0x17
[ 1310.300198]  check_preemption_disabled+0x167/0x180
[ 1310.300903]  debug_smp_processor_id+0x1c/0x20
[ 1310.301527]  perf_trace_buf_alloc+0x98/0x100
[ 1310.302148]  ? ext4_block_write_begin+0x64f/0x9f0
[ 1310.302822]  ? trace_sched_waking+0xc0/0xc0
[ 1310.303438]  perf_ftrace_function_call+0x209/0x360
[ 1310.304218]  ? 0xffffffffa0098099
[ 1310.304757]  0xffffffffa0098099
[ 1310.305243]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1310.305929]  ? ext4_block_write_begin+0x61e/0x9f0
[ 1310.306618]  ? preempt_count_add+0x5/0xc0
[ 1310.307193]  ? write_comp_data+0x2f/0x90
[ 1310.307766]  preempt_count_add+0x5/0xc0
[ 1310.308321]  ext4_block_write_begin+0x64f/0x9f0
[ 1310.308964]  ? preempt_count_add+0x5/0xc0
[ 1310.309533]  ? ext4_block_write_begin+0x64f/0x9f0
[ 1310.310217]  ? ext4_da_release_space+0x2a0/0x2a0
[ 1310.310915]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1310.311618]  ext4_da_write_begin+0x1d4/0x560
[ 1310.312299]  generic_perform_write+0x166/0x2b0
[ 1310.313010]  ext4_buffered_write_iter+0xe0/0x1f0
[ 1310.313695]  ext4_file_write_iter+0xb9/0xb70
[ 1310.314324]  ? ext4_buffered_write_iter+0x1f0/0x1f0
[ 1310.315005]  ? iov_iter_init+0x4d/0x90
[ 1310.315622]  new_sync_write+0x21b/0x300
[ 1310.316285]  vfs_write+0x3ea/0x610
[ 1310.316817]  ksys_write+0x9e/0x170
[ 1310.317352]  __x64_sys_write+0x23/0x30
[ 1310.317901]  do_syscall_64+0x37/0x80
[ 1310.318431]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1310.319139] RIP: 0033:0x7f3db99ffd07
[ 1310.319654] Code: c3 66 90 41 54 49 89 d4 55 48 89 f5 53 89 fb 48 83 ec 10 e8 0b fd ff ff 41 89 c0 4c 89 e2 48 89 ee 89 df b8 01 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 35 44 89 c7 48 89 44 24 08 e8 44 fd ff ff 48
[ 1310.322129] RSP: 002b:00007f3db5dbf870 EFLAGS: 00000293 ORIG_RAX: 0000000000000001
[ 1310.323160] RAX: ffffffffffffffda RBX: 0000000000000005 RCX: 00007f3db99ffd07
[ 1310.324121] RDX: 0000000000000133 RSI: 00007f3da8004410 RDI: 0000000000000005
[ 1310.325085] RBP: 00007f3da8004410 R08: 0000000000000000 R09: 0000000000000000
[ 1310.326045] R10: 0000000000000000 R11: 0000000000000293 R12: 0000000000000133
[ 1310.327011] R13: 0000000000000000 R14: 0000557e3e371be0 R15: 0000000000000005
[ 1310.328083] CPU: 1 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1310.328218] BUG: using smp_processor_id() in preemptible [00000000] code: rs:main Q:Reg/365
[ 1310.329053] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1310.330324] caller is debug_smp_processor_id+0x1c/0x20
[ 1310.331730] Call Trace:
[ 1310.332768]  dump_stack_lvl+0xa4/0xd3
[ 1310.333277]  dump_stack+0x15/0x17
[ 1310.333731]  check_preemption_disabled+0x167/0x180
[ 1310.334381]  ? _raw_spin_lock+0x17/0x50
[ 1310.334897]  ? trace_sched_waking+0xc0/0xc0
[ 1310.335461]  debug_smp_processor_id+0x1c/0x20
[ 1310.336045]  perf_ftrace_function_call+0x7c/0x360
[ 1310.336674]  ? write_comp_data+0x2f/0x90
[ 1310.337204]  ? __text_poke+0xea/0x4e0
[ 1310.337709]  ? __pmd_alloc+0x420/0x420
[ 1310.338240]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1310.338868]  ? __text_poke+0xea/0x4e0
[ 1310.339360]  ? perf_ftrace_function_call+0x4c/0x360
[ 1310.340014]  ? write_comp_data+0x2f/0x90
[ 1310.340542]  ? perf_trace_buf_update+0x70/0x70
[ 1310.341130]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1310.341753]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1310.342374]  0xffffffffa0098099
[ 1310.342800]  ? ftrace_call+0x5/0x44
[ 1310.343272]  ? fbcon_remap_all+0x1/0xa0
[ 1310.343790]  ? pmd_page_vaddr+0x2b/0x70
[ 1310.344306]  ? preempt_count_add+0x5/0xc0
[ 1310.344845]  preempt_count_add+0x5/0xc0
[ 1310.345357]  _raw_spin_lock+0x17/0x50
[ 1310.345849]  ? preempt_count_add+0x5/0xc0
[ 1310.346395]  ? _raw_spin_lock+0x17/0x50
[ 1310.346910]  __get_locked_pte+0x1a2/0x290
[ 1310.347449]  ? fbcon_remap_all+0x1/0xa0
[ 1310.347964]  __text_poke+0xea/0x4e0
[ 1310.348433]  ? fbcon_remap_all+0x1/0xa0
[ 1310.348948]  ? lock_is_held_type+0xe2/0x140
[ 1310.349512]  ? fbcon_remap_all+0x1/0xa0
[ 1310.350030]  text_poke+0x2b/0x60
[ 1310.350484]  text_poke_bp_batch+0xf5/0x2c0
[ 1310.351035]  ? ipmi_addr_src_to_str+0x50/0x50
[ 1310.351619]  text_poke_queue+0xa7/0xc0
[ 1310.352141]  ftrace_replace_code+0xfd/0x170
[ 1310.352705]  ftrace_modify_all_code+0x1b1/0x270
[ 1310.353309]  arch_ftrace_update_code+0x9/0x10
[ 1310.353885]  ftrace_run_update_code+0x30/0xa0
[ 1310.354475]  ftrace_shutdown+0x2b8/0x4a0
[ 1310.355008]  unregister_ftrace_function+0x25/0x50
[ 1310.355629]  perf_ftrace_event_register+0x89/0xf0
[ 1310.356251]  ? perf_tp_event_init+0xa0/0xa0
[ 1310.356808]  perf_trace_destroy+0x37/0x60
[ 1310.357346]  tp_perf_event_destroy+0x15/0x20
[ 1310.357916]  _free_event+0xfc/0x7d0
[ 1310.358398]  put_event+0x37/0x50
[ 1310.358838]  perf_event_release_kernel+0x2f4/0x370
[ 1310.359481]  ? perf_event_release_kernel+0x370/0x370
[ 1310.360137]  perf_release+0x19/0x20
[ 1310.360607]  __fput+0x12d/0x460
[ 1310.361049]  ____fput+0x1a/0x20
[ 1310.361478]  task_work_run+0x8e/0xf0
[ 1310.361968]  do_exit+0x616/0x1310
[ 1310.362428]  ? write_comp_data+0x2f/0x90
[ 1310.362965]  do_group_exit+0x7e/0x130
[ 1310.363469]  get_signal+0x249/0x13c0
[ 1310.363956]  ? get_signal+0x5/0x13c0
[ 1310.364451]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1310.365091]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1310.365738]  exit_to_user_mode_prepare+0x154/0x240
[ 1310.366377]  syscall_exit_to_user_mode+0x2b/0x60
[ 1310.366992]  do_syscall_64+0x46/0x80
[ 1310.367475]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1310.368142] RIP: 0033:0x7fac0740459d
[ 1310.368619] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1310.369452] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1310.370426] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1310.371355] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1310.372266] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1310.373185] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1310.374101] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1310.375052] CPU: 0 PID: 365 Comm: rs:main Q:Reg Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1310.375097] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20672
[ 1310.376142] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1310.377133] caller is debug_smp_processor_id+0x1c/0x20
[ 1310.378641] Call Trace:
[ 1310.378661]  dump_stack_lvl+0xa4/0xd3
[ 1310.380196]  dump_stack+0x15/0x17
[ 1310.380680]  check_preemption_disabled+0x167/0x180
[ 1310.381385]  debug_smp_processor_id+0x1c/0x20
[ 1310.382007]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1310.382776]  perf_tp_event+0x331/0x4e0
[ 1310.383476]  ? arch_local_irq_enable+0x10/0x12
[ 1310.384105]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1310.384781]  ? dump_stack_lvl+0xcc/0xd3
[ 1310.385349]  ? dump_stack+0x15/0x17
[ 1310.385857]  ? check_preemption_disabled+0x167/0x180
[ 1310.386581]  ? ext4_block_write_begin+0x64f/0x9f0
[ 1310.387241]  ? trace_sched_waking+0xc0/0xc0
[ 1310.387847]  perf_ftrace_function_call+0x248/0x360
[ 1310.388524]  ? perf_ftrace_function_call+0x248/0x360
[ 1310.389336]  ? 0xffffffffa0098099
[ 1310.389875]  0xffffffffa0098099
[ 1310.390362]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1310.391048]  ? ext4_block_write_begin+0x61e/0x9f0
[ 1310.391730]  ? preempt_count_add+0x5/0xc0
[ 1310.392312]  ? write_comp_data+0x2f/0x90
[ 1310.392887]  preempt_count_add+0x5/0xc0
[ 1310.393440]  ext4_block_write_begin+0x64f/0x9f0
[ 1310.394087]  ? preempt_count_add+0x5/0xc0
[ 1310.394655]  ? ext4_block_write_begin+0x64f/0x9f0
[ 1310.395326]  ? ext4_da_release_space+0x2a0/0x2a0
[ 1310.396020]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1310.396721]  ext4_da_write_begin+0x1d4/0x560
[ 1310.397399]  generic_perform_write+0x166/0x2b0
[ 1310.398113]  ext4_buffered_write_iter+0xe0/0x1f0
[ 1310.398799]  ext4_file_write_iter+0xb9/0xb70
[ 1310.399416]  ? ext4_buffered_write_iter+0x1f0/0x1f0
[ 1310.400097]  ? iov_iter_init+0x4d/0x90
[ 1310.400714]  new_sync_write+0x21b/0x300
[ 1310.401377]  vfs_write+0x3ea/0x610
[ 1310.401911]  ksys_write+0x9e/0x170
[ 1310.402458]  __x64_sys_write+0x23/0x30
[ 1310.403011]  do_syscall_64+0x37/0x80
[ 1310.403535]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1310.404243] RIP: 0033:0x7f3db99ffd07
[ 1310.404758] Code: c3 66 90 41 54 49 89 d4 55 48 89 f5 53 89 fb 48 83 ec 10 e8 0b fd ff ff 41 89 c0 4c 89 e2 48 89 ee 89 df b8 01 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 35 44 89 c7 48 89 44 24 08 e8 44 fd ff ff 48
[ 1310.407215] RSP: 002b:00007f3db5dbf870 EFLAGS: 00000293 ORIG_RAX: 0000000000000001
[ 1310.408248] RAX: ffffffffffffffda RBX: 0000000000000005 RCX: 00007f3db99ffd07
[ 1310.409209] RDX: 0000000000000133 RSI: 00007f3da8004410 RDI: 0000000000000005
[ 1310.410174] RBP: 00007f3da8004410 R08: 0000000000000000 R09: 0000000000000000
[ 1310.411138] R10: 0000000000000000 R11: 0000000000000293 R12: 0000000000000133
[ 1310.412100] R13: 0000000000000000 R14: 0000557e3e371be0 R15: 0000000000000005
[ 1310.413173] CPU: 1 PID: 20672 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1310.413321] BUG: using smp_processor_id() in preemptible [00000000] code: rs:main Q:Reg/365
[ 1310.414144] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1310.414156] Call Trace:
[ 1310.414165]  dump_stack_lvl+0xa4/0xd3
[ 1310.414187]  dump_stack+0x15/0x17
[ 1310.414202]  check_preemption_disabled+0x167/0x180
[ 1310.414221]  ? text_poke_bp_batch+0xf5/0x2c0
[ 1310.414236]  ? apply_paravirt+0x150/0x150
[ 1310.415414] caller is debug_smp_processor_id+0x1c/0x20
[ 1310.416850]  debug_smp_processor_id+0x1c/0x20
[ 1310.421038]  perf_ftrace_function_call+0x7c/0x360
[ 1310.421669]  ? fbcon_remap_all+0x1/0xa0
[ 1310.422198]  ? 0xffffffffa0098099
[ 1310.422646]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1310.423301]  0xffffffffa0098099
[ 1310.423726]  ? _raw_spin_unlock+0x2c/0x50
[ 1310.424264]  ? write_comp_data+0x2f/0x90
[ 1310.424796]  ? fbcon_fb_registered+0x1/0x220
[ 1310.425369]  ? fbcon_fb_registered+0x1/0x220
[ 1310.425935]  ? text_poke+0x5/0x60
[ 1310.426395]  text_poke+0x5/0x60
[ 1310.426824]  text_poke_bp_batch+0xf5/0x2c0
[ 1310.427372]  ? text_poke+0x5/0x60
[ 1310.427819]  ? text_poke_bp_batch+0xf5/0x2c0
[ 1310.428395]  ? ipmi_addr_src_to_str+0x50/0x50
[ 1310.428982]  text_poke_queue+0xa7/0xc0
[ 1310.429492]  ftrace_replace_code+0xfd/0x170
[ 1310.430060]  ftrace_modify_all_code+0x1b1/0x270
[ 1310.430669]  arch_ftrace_update_code+0x9/0x10
[ 1310.431247]  ftrace_run_update_code+0x30/0xa0
[ 1310.431830]  ftrace_shutdown+0x2b8/0x4a0
[ 1310.432364]  unregister_ftrace_function+0x25/0x50
[ 1310.433006]  perf_ftrace_event_register+0x89/0xf0
[ 1310.433629]  ? perf_tp_event_init+0xa0/0xa0
[ 1310.434190]  perf_trace_destroy+0x37/0x60
[ 1310.434728]  tp_perf_event_destroy+0x15/0x20
[ 1310.435298]  _free_event+0xfc/0x7d0
[ 1310.435777]  put_event+0x37/0x50
[ 1310.436217]  perf_event_release_kernel+0x2f4/0x370
[ 1310.436858]  ? perf_event_release_kernel+0x370/0x370
[ 1310.437513]  perf_release+0x19/0x20
[ 1310.437983]  __fput+0x12d/0x460
[ 1310.438429]  ____fput+0x1a/0x20
[ 1310.438859]  task_work_run+0x8e/0xf0
[ 1310.439348]  do_exit+0x616/0x1310
[ 1310.439806]  ? write_comp_data+0x2f/0x90
[ 1310.440341]  do_group_exit+0x7e/0x130
[ 1310.440843]  get_signal+0x249/0x13c0
[ 1310.441324]  ? get_signal+0x5/0x13c0
[ 1310.441819]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1310.442466]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1310.443112]  exit_to_user_mode_prepare+0x154/0x240
[ 1310.443748]  syscall_exit_to_user_mode+0x2b/0x60
[ 1310.444361]  do_syscall_64+0x46/0x80
[ 1310.444844]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1310.445508] RIP: 0033:0x7fac0740459d
[ 1310.445986] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1310.446825] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1310.447798] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1310.448709] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1310.449625] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1310.450544] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1310.451456] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1310.452412] CPU: 0 PID: 365 Comm: rs:main Q:Reg Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1310.453594] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1310.455243] Call Trace:
[ 1310.455658]  dump_stack_lvl+0xa4/0xd3
[ 1310.456284]  dump_stack+0x15/0x17
[ 1310.456828]  check_preemption_disabled+0x167/0x180
[ 1310.457578]  ? copy_page_from_iter_atomic+0x3c/0xc40
[ 1310.458342]  ? trace_sched_waking+0xc0/0xc0
[ 1310.459028]  debug_smp_processor_id+0x1c/0x20
[ 1310.459718]  perf_ftrace_function_call+0x7c/0x360
[ 1310.460456]  ? 0xffffffffa0098099
[ 1310.461113]  ? 0xffffffffa0098099
[ 1310.461704]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1310.462563]  0xffffffffa0098099
[ 1310.463247]  ? preempt_count_add+0x5/0xc0
[ 1310.463930]  preempt_count_add+0x5/0xc0
[ 1310.464546]  copy_page_from_iter_atomic+0x3c/0xc40
[ 1310.465318]  ? preempt_count_add+0x5/0xc0
[ 1310.465949]  ? copy_page_from_iter_atomic+0x3c/0xc40
[ 1310.466737]  ? ext4_da_write_begin+0x2ce/0x560
[ 1310.467482]  ? write_comp_data+0x2f/0x90
[ 1310.468196]  generic_perform_write+0x19f/0x2b0
[ 1310.469045]  ext4_buffered_write_iter+0xe0/0x1f0
[ 1310.469835]  ext4_file_write_iter+0xb9/0xb70
[ 1310.470535]  ? ext4_buffered_write_iter+0x1f0/0x1f0
[ 1310.471283]  ? iov_iter_init+0x4d/0x90
[ 1310.472038]  new_sync_write+0x21b/0x300
[ 1310.472885]  vfs_write+0x3ea/0x610
[ 1310.473519]  ksys_write+0x9e/0x170
[ 1310.474155]  __x64_sys_write+0x23/0x30
[ 1310.474778]  do_syscall_64+0x37/0x80
[ 1310.475370]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1310.476148] RIP: 0033:0x7f3db99ffd07
[ 1310.476721] Code: c3 66 90 41 54 49 89 d4 55 48 89 f5 53 89 fb 48 83 ec 10 e8 0b fd ff ff 41 89 c0 4c 89 e2 48 89 ee 89 df b8 01 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 35 44 89 c7 48 89 44 24 08 e8 44 fd ff ff 48
[ 1310.479374] RSP: 002b:00007f3db5dbf870 EFLAGS: 00000293 ORIG_RAX: 0000000000000001
[ 1310.480507] RAX: ffffffffffffffda RBX: 0000000000000005 RCX: 00007f3db99ffd07
[ 1310.481560] RDX: 0000000000000133 RSI: 00007f3da8004410 RDI: 0000000000000005
[ 1310.482615] RBP: 00007f3da8004410 R08: 0000000000000000 R09: 0000000000000000
[ 1310.483662] R10: 0000000000000000 R11: 0000000000000293 R12: 0000000000000133
[ 1310.484709] R13: 0000000000000000 R14: 0000557e3e371be0 R15: 0000000000000005
[ 1315.094064] check_preemption_disabled: 3411921 callbacks suppressed
[ 1315.094093] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1315.094152] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1315.095043] caller is debug_smp_processor_id+0x1c/0x20
[ 1315.096005] caller is debug_smp_processor_id+0x1c/0x20
[ 1315.097107] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1315.099579] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1315.101153] Call Trace:
[ 1315.101544]  dump_stack_lvl+0xa4/0xd3
[ 1315.102139]  dump_stack+0x15/0x17
[ 1315.102645]  check_preemption_disabled+0x167/0x180
[ 1315.103375]  debug_smp_processor_id+0x1c/0x20
[ 1315.103982]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1315.104767]  perf_trace_buf_alloc+0x3d/0x100
[ 1315.105365]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1315.106014]  ? cea_set_pte+0x140/0x140
[ 1315.106563]  perf_ftrace_function_call+0x209/0x360
[ 1315.107419]  ? 0xffffffffa0098099
[ 1315.107975]  ? virtqueue_add_inbuf_ctx+0x60/0x60
[ 1315.108631]  0xffffffffa0098099
[ 1315.109175]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1315.109895]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1315.110544]  ? virtqueue_add_inbuf_ctx+0x60/0x60
[ 1315.111178]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1315.111899]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1315.112617]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1315.113241]  copy_from_kernel_nofault_allowed+0x5/0x80
[ 1315.113940]  copy_from_kernel_nofault+0x2f/0x220
[ 1315.114583]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1315.115290]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1315.116017]  ftrace_verify_code+0x2c/0x70
[ 1315.116609]  ftrace_replace_code+0x69/0x170
[ 1315.117244]  ftrace_modify_all_code+0x1b1/0x270
[ 1315.117912]  arch_ftrace_update_code+0x9/0x10
[ 1315.118525]  ftrace_run_update_code+0x30/0xa0
[ 1315.119149]  ftrace_startup_enable+0x5e/0xa0
[ 1315.119763]  ftrace_startup+0x16d/0x240
[ 1315.120375]  register_ftrace_function+0x43/0x90
[ 1315.121026]  perf_ftrace_event_register+0xc1/0xf0
[ 1315.121696]  perf_trace_event_init+0xa0/0x4c0
[ 1315.122359]  perf_trace_init+0xda/0x160
[ 1315.122944]  perf_tp_event_init+0x57/0xa0
[ 1315.123573]  perf_try_init_event+0x83/0x270
[ 1315.124256]  perf_event_alloc+0xe3f/0x1c10
[ 1315.124849]  ? _raw_spin_unlock+0x2c/0x50
[ 1315.125451]  ? alloc_fd+0x20d/0x320
[ 1315.126090]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1315.126773]  ? write_comp_data+0x2f/0x90
[ 1315.127648]  __x64_sys_perf_event_open+0x26/0x30
[ 1315.128294]  do_syscall_64+0x37/0x80
[ 1315.128812]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1315.129491] RIP: 0033:0x7fac0740459d
[ 1315.129996] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1315.132389] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1315.133381] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1315.134310] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1315.135224] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1315.136137] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1315.137050] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1315.138187] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1315.138408] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1315.139015] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1315.139917] caller is debug_smp_processor_id+0x1c/0x20
[ 1315.141147] Call Trace:
[ 1315.141157]  dump_stack_lvl+0xa4/0xd3
[ 1315.142465]  dump_stack+0x15/0x17
[ 1315.142850]  check_preemption_disabled+0x167/0x180
[ 1315.143468]  ? do_nanosleep+0x123/0x2a0
[ 1315.144017]  ? ___might_sleep+0x170/0x170
[ 1315.144590]  debug_smp_processor_id+0x1c/0x20
[ 1315.145195]  perf_ftrace_function_call+0x7c/0x360
[ 1315.145827]  ? 0xffffffffa0098099
[ 1315.146303]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1315.146951]  ? finish_task_switch+0xab/0x2a0
[ 1315.147554]  ? __schedule+0x46e/0xb20
[ 1315.148077]  ? do_nanosleep+0x9c/0x2a0
[ 1315.148604]  0xffffffffa0098099
[ 1315.149026]  ? finish_task_switch+0xb0/0x2a0
[ 1315.149617]  ? do_nanosleep+0x107/0x2a0
[ 1315.150164]  ? __might_sleep+0x5/0x70
[ 1315.150654]  ? write_comp_data+0x2f/0x90
[ 1315.151184]  __might_sleep+0x5/0x70
[ 1315.151646]  do_nanosleep+0x123/0x2a0
[ 1315.152151]  ? __might_sleep+0x5/0x70
[ 1315.152680]  ? do_nanosleep+0x123/0x2a0
[ 1315.153245]  ? write_comp_data+0x2f/0x90
[ 1315.153816]  hrtimer_nanosleep+0xf7/0x1b0
[ 1315.154409]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1315.155077]  __x64_sys_nanosleep+0xfc/0x150
[ 1315.155676]  do_syscall_64+0x37/0x80
[ 1315.156198]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1315.156955] RIP: 0033:0x7fac073cca18
[ 1315.157481] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1315.160042] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1315.161126] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1315.162142] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1315.163160] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1315.164199] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1315.165231] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1315.166310] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1315.166371] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1315.167403] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1315.168441] caller is debug_smp_processor_id+0x1c/0x20
[ 1315.170027] Call Trace:
[ 1315.170050]  dump_stack_lvl+0xa4/0xd3
[ 1315.171671]  dump_stack+0x15/0x17
[ 1315.172186]  check_preemption_disabled+0x167/0x180
[ 1315.172918]  debug_smp_processor_id+0x1c/0x20
[ 1315.173541]  perf_trace_buf_alloc+0x98/0x100
[ 1315.174170]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1315.174844]  ? cea_set_pte+0x140/0x140
[ 1315.175394]  perf_ftrace_function_call+0x209/0x360
[ 1315.176177]  ? 0xffffffffa0098099
[ 1315.176701]  ? virtqueue_add_inbuf_ctx+0x60/0x60
[ 1315.177363]  0xffffffffa0098099
[ 1315.177870]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1315.178634]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1315.179284]  ? virtqueue_add_inbuf_ctx+0x60/0x60
[ 1315.179944]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1315.180690]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1315.181437]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1315.182085]  copy_from_kernel_nofault_allowed+0x5/0x80
[ 1315.182819]  copy_from_kernel_nofault+0x2f/0x220
[ 1315.183477]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1315.184216]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1315.184931]  ftrace_verify_code+0x2c/0x70
[ 1315.185523]  ftrace_replace_code+0x69/0x170
[ 1315.186157]  ftrace_modify_all_code+0x1b1/0x270
[ 1315.186825]  arch_ftrace_update_code+0x9/0x10
[ 1315.187447]  ftrace_run_update_code+0x30/0xa0
[ 1315.188080]  ftrace_startup_enable+0x5e/0xa0
[ 1315.188702]  ftrace_startup+0x16d/0x240
[ 1315.189294]  register_ftrace_function+0x43/0x90
[ 1315.189951]  perf_ftrace_event_register+0xc1/0xf0
[ 1315.190633]  perf_trace_event_init+0xa0/0x4c0
[ 1315.191283]  perf_trace_init+0xda/0x160
[ 1315.191860]  perf_tp_event_init+0x57/0xa0
[ 1315.192449]  perf_try_init_event+0x83/0x270
[ 1315.193082]  perf_event_alloc+0xe3f/0x1c10
[ 1315.193666]  ? _raw_spin_unlock+0x2c/0x50
[ 1315.194255]  ? alloc_fd+0x20d/0x320
[ 1315.194817]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1315.195507]  ? write_comp_data+0x2f/0x90
[ 1315.196244]  __x64_sys_perf_event_open+0x26/0x30
[ 1315.196906]  do_syscall_64+0x37/0x80
[ 1315.197432]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1315.198146] RIP: 0033:0x7fac0740459d
[ 1315.198666] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1315.201136] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1315.202189] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1315.203161] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1315.204136] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1315.205106] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1315.206082] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1315.207167] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1315.207279] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1315.208100] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1315.209144] caller is debug_smp_processor_id+0x1c/0x20
[ 1315.210568] Call Trace:
[ 1315.210578]  dump_stack_lvl+0xa4/0xd3
[ 1315.210601]  dump_stack+0x15/0x17
[ 1315.210615]  check_preemption_disabled+0x167/0x180
[ 1315.210633]  ? __might_sleep+0x48/0x70
[ 1315.210647]  ? sched_show_task+0x70/0x70
[ 1315.210666]  debug_smp_processor_id+0x1c/0x20
[ 1315.214716]  perf_ftrace_function_call+0x7c/0x360
[ 1315.215327]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1315.215938]  ? do_nanosleep+0x123/0x2a0
[ 1315.216455]  ? perf_ftrace_function_call+0x4c/0x360
[ 1315.217109]  ? 0xffffffffa0098099
[ 1315.217549]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1315.218203]  ? finish_task_switch+0xab/0x2a0
[ 1315.218760]  ? __schedule+0x46e/0xb20
[ 1315.219247]  ? do_nanosleep+0x9c/0x2a0
[ 1315.219745]  0xffffffffa0098099
[ 1315.220163]  ? do_nanosleep+0x9c/0x2a0
[ 1315.220674]  ? do_nanosleep+0x107/0x2a0
[ 1315.221212]  ? ___might_sleep+0x5/0x170
[ 1315.221725]  ___might_sleep+0x5/0x170
[ 1315.222219]  __might_sleep+0x48/0x70
[ 1315.222693]  ? ___might_sleep+0x5/0x170
[ 1315.223196]  ? __might_sleep+0x48/0x70
[ 1315.223694]  do_nanosleep+0x123/0x2a0
[ 1315.224177]  ? write_comp_data+0x2f/0x90
[ 1315.224704]  hrtimer_nanosleep+0xf7/0x1b0
[ 1315.225240]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1315.225846]  __x64_sys_nanosleep+0xfc/0x150
[ 1315.226441]  do_syscall_64+0x37/0x80
[ 1315.226948]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1315.227625] RIP: 0033:0x7fac073cca18
[ 1315.228094] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1315.230411] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1315.231370] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1315.232270] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1315.233167] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1315.234074] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1315.234975] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1315.235906] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1315.235950] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1315.236936] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1315.237890] caller is debug_smp_processor_id+0x1c/0x20
[ 1315.239418] Call Trace:
[ 1315.239437]  dump_stack_lvl+0xa4/0xd3
[ 1315.240960]  dump_stack+0x15/0x17
[ 1315.241447]  check_preemption_disabled+0x167/0x180
[ 1315.242165]  debug_smp_processor_id+0x1c/0x20
[ 1315.242793]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1315.243564]  perf_tp_event+0x331/0x4e0
[ 1315.244256]  ? arch_local_irq_enable+0x10/0x12
[ 1315.244897]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1315.245576]  ? dump_stack_lvl+0xcc/0xd3
[ 1315.246157]  ? dump_stack+0x15/0x17
[ 1315.246666]  ? check_preemption_disabled+0x167/0x180
[ 1315.247396]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1315.248076]  ? cea_set_pte+0x140/0x140
[ 1315.248712]  perf_ftrace_function_call+0x248/0x360
[ 1315.249416]  ? perf_ftrace_function_call+0x248/0x360
[ 1315.250254]  ? 0xffffffffa0098099
[ 1315.250779]  ? virtqueue_add_inbuf_ctx+0x60/0x60
[ 1315.251442]  0xffffffffa0098099
[ 1315.251950]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1315.252698]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1315.253350]  ? virtqueue_add_inbuf_ctx+0x60/0x60
[ 1315.254035]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1315.254794]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1315.255538]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1315.256181]  copy_from_kernel_nofault_allowed+0x5/0x80
[ 1315.256907]  copy_from_kernel_nofault+0x2f/0x220
[ 1315.257564]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1315.258316]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1315.259035]  ftrace_verify_code+0x2c/0x70
[ 1315.259629]  ftrace_replace_code+0x69/0x170
[ 1315.260254]  ftrace_modify_all_code+0x1b1/0x270
[ 1315.260920]  arch_ftrace_update_code+0x9/0x10
[ 1315.261541]  ftrace_run_update_code+0x30/0xa0
[ 1315.262215]  ftrace_startup_enable+0x5e/0xa0
[ 1315.262838]  ftrace_startup+0x16d/0x240
[ 1315.263432]  register_ftrace_function+0x43/0x90
[ 1315.264087]  perf_ftrace_event_register+0xc1/0xf0
[ 1315.264769]  perf_trace_event_init+0xa0/0x4c0
[ 1315.265420]  perf_trace_init+0xda/0x160
[ 1315.265995]  perf_tp_event_init+0x57/0xa0
[ 1315.266593]  perf_try_init_event+0x83/0x270
[ 1315.267227]  perf_event_alloc+0xe3f/0x1c10
[ 1315.267813]  ? _raw_spin_unlock+0x2c/0x50
[ 1315.268396]  ? alloc_fd+0x20d/0x320
[ 1315.268958]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1315.269648]  ? write_comp_data+0x2f/0x90
[ 1315.270394]  __x64_sys_perf_event_open+0x26/0x30
[ 1315.271056]  do_syscall_64+0x37/0x80
[ 1315.271583]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1315.272294] RIP: 0033:0x7fac0740459d
[ 1315.272811] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1315.275296] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1315.276334] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1315.277318] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1315.278297] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1315.279263] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1315.280237] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1315.281319] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1315.281435] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1315.282275] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1315.282287] Call Trace:
[ 1315.282294]  dump_stack_lvl+0xa4/0xd3
[ 1315.282317]  dump_stack+0x15/0x17
[ 1315.282331]  check_preemption_disabled+0x167/0x180
[ 1315.282349]  ? do_nanosleep+0x155/0x2a0
[ 1315.282364]  ? hrtimer_wakeup+0x40/0x40
[ 1315.283489] caller is debug_smp_processor_id+0x1c/0x20
[ 1315.284907]  debug_smp_processor_id+0x1c/0x20
[ 1315.288951]  perf_ftrace_function_call+0x7c/0x360
[ 1315.289571]  ? 0xffffffffa0098099
[ 1315.290011]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1315.290648]  ? finish_task_switch+0xab/0x2a0
[ 1315.291206]  ? __schedule+0x46e/0xb20
[ 1315.291695]  ? do_nanosleep+0x9c/0x2a0
[ 1315.292196]  ? do_nanosleep+0x9c/0x2a0
[ 1315.292694]  0xffffffffa0098099
[ 1315.293116]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1315.293730]  ? lock_is_held_type+0xe2/0x140
[ 1315.294289]  ? do_nanosleep+0x140/0x2a0
[ 1315.294800]  ? hrtimer_try_to_cancel+0x5/0x290
[ 1315.295383]  ? write_comp_data+0x2f/0x90
[ 1315.295901]  hrtimer_try_to_cancel+0x5/0x290
[ 1315.296462]  do_nanosleep+0x155/0x2a0
[ 1315.296947]  ? hrtimer_try_to_cancel+0x5/0x290
[ 1315.297528]  ? do_nanosleep+0x155/0x2a0
[ 1315.298032]  ? write_comp_data+0x2f/0x90
[ 1315.298562]  hrtimer_nanosleep+0xf7/0x1b0
[ 1315.299100]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1315.299706]  __x64_sys_nanosleep+0xfc/0x150
[ 1315.300268]  do_syscall_64+0x37/0x80
[ 1315.300743]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1315.301399] RIP: 0033:0x7fac073cca18
[ 1315.301869] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1315.304196] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1315.305171] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1315.306073] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1315.306972] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1315.307870] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1315.308768] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1315.309702] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1315.309744] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1315.310805] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1315.311769] caller is debug_smp_processor_id+0x1c/0x20
[ 1315.313388] Call Trace:
[ 1315.314449]  dump_stack_lvl+0xa4/0xd3
[ 1315.315075]  dump_stack+0x15/0x17
[ 1315.315617]  check_preemption_disabled+0x167/0x180
[ 1315.316368]  ? ftrace_verify_code+0x2c/0x70
[ 1315.317019]  ? copy_to_user_nofault+0x150/0x150
[ 1315.317753]  debug_smp_processor_id+0x1c/0x20
[ 1315.318445]  perf_ftrace_function_call+0x7c/0x360
[ 1315.319291]  ? 0xffffffffa0098099
[ 1315.319914]  ? virtqueue_add_inbuf_ctx+0x60/0x60
[ 1315.320647]  ? 0xffffffffa0098099
[ 1315.321270]  0xffffffffa0098099
[ 1315.321781]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1315.322626]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1315.323346]  ? virtqueue_add_inbuf_ctx+0x60/0x60
[ 1315.324056]  ? virtqueue_add_inbuf_ctx+0x60/0x60
[ 1315.324787]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1315.325603]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1315.326317]  ? vp_modern_remove+0x80/0x80
[ 1315.326964]  ? copy_from_kernel_nofault+0x5/0x220
[ 1315.327743]  copy_from_kernel_nofault+0x5/0x220
[ 1315.328456]  ftrace_verify_code+0x2c/0x70
[ 1315.329094]  ? copy_from_kernel_nofault+0x5/0x220
[ 1315.329817]  ? ftrace_verify_code+0x2c/0x70
[ 1315.330520]  ftrace_replace_code+0x69/0x170
[ 1315.331238]  ftrace_modify_all_code+0x1b1/0x270
[ 1315.331992]  arch_ftrace_update_code+0x9/0x10
[ 1315.332678]  ftrace_run_update_code+0x30/0xa0
[ 1315.333386]  ftrace_startup_enable+0x5e/0xa0
[ 1315.334087]  ftrace_startup+0x16d/0x240
[ 1315.334780]  register_ftrace_function+0x43/0x90
[ 1315.335513]  perf_ftrace_event_register+0xc1/0xf0
[ 1315.336271]  perf_trace_event_init+0xa0/0x4c0
[ 1315.337012]  perf_trace_init+0xda/0x160
[ 1315.337672]  perf_tp_event_init+0x57/0xa0
[ 1315.338336]  perf_try_init_event+0x83/0x270
[ 1315.339065]  perf_event_alloc+0xe3f/0x1c10
[ 1315.339707]  ? _raw_spin_unlock+0x2c/0x50
[ 1315.340359]  ? alloc_fd+0x20d/0x320
[ 1315.341032]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1315.341800]  ? write_comp_data+0x2f/0x90
[ 1315.342776]  __x64_sys_perf_event_open+0x26/0x30
[ 1315.343509]  do_syscall_64+0x37/0x80
[ 1315.344098]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1315.344870] RIP: 0033:0x7fac0740459d
[ 1315.345443] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1315.348095] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1315.349227] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1315.350280] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1315.351345] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1315.352394] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1315.353442] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1315.354721] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1315.354926] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1315.355654] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1315.356781] caller is debug_smp_processor_id+0x1c/0x20
[ 1315.358196] Call Trace:
[ 1315.358204]  dump_stack_lvl+0xa4/0xd3
[ 1315.358225]  dump_stack+0x15/0x17
[ 1315.358240]  check_preemption_disabled+0x167/0x180
[ 1315.358257]  ? hrtimer_try_to_cancel+0x38/0x290
[ 1315.358274]  ? __hrtimer_get_remaining+0x80/0x80
[ 1315.358295]  debug_smp_processor_id+0x1c/0x20
[ 1315.358311]  perf_ftrace_function_call+0x7c/0x360
[ 1315.358329]  ? do_nanosleep+0x155/0x2a0
[ 1315.358343]  ? hrtimer_wakeup+0x40/0x40
[ 1315.358360]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1315.358376]  ? do_nanosleep+0x155/0x2a0
[ 1315.365280]  ? perf_ftrace_function_call+0x4c/0x360
[ 1315.365922]  ? 0xffffffffa0098099
[ 1315.366364]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1315.366994]  ? do_nanosleep+0x9c/0x2a0
[ 1315.367492]  0xffffffffa0098099
[ 1315.367907]  ? do_nanosleep+0x9c/0x2a0
[ 1315.368408]  ? do_nanosleep+0x9c/0x2a0
[ 1315.368910]  ? do_nanosleep+0x140/0x2a0
[ 1315.369421]  ? hrtimer_active+0x5/0xb0
[ 1315.369920]  ? do_nanosleep+0x140/0x2a0
[ 1315.370430]  hrtimer_active+0x5/0xb0
[ 1315.370906]  hrtimer_try_to_cancel+0x38/0x290
[ 1315.371479]  ? hrtimer_active+0x5/0xb0
[ 1315.371973]  ? hrtimer_try_to_cancel+0x38/0x290
[ 1315.372571]  ? do_nanosleep+0x9c/0x2a0
[ 1315.373068]  do_nanosleep+0x155/0x2a0
[ 1315.373551]  ? write_comp_data+0x2f/0x90
[ 1315.374080]  hrtimer_nanosleep+0xf7/0x1b0
[ 1315.374617]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1315.375224]  __x64_sys_nanosleep+0xfc/0x150
[ 1315.375784]  do_syscall_64+0x37/0x80
[ 1315.376260]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1315.376916] RIP: 0033:0x7fac073cca18
[ 1315.377386] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1315.379708] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1315.380670] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1315.381570] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1315.382471] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1315.383370] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1315.384269] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1315.385204] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1315.385246] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1315.386310] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1315.387280] caller is debug_smp_processor_id+0x1c/0x20
[ 1315.388897] Call Trace:
[ 1315.389939]  dump_stack_lvl+0xa4/0xd3
[ 1315.390570]  dump_stack+0x15/0x17
[ 1315.391114]  check_preemption_disabled+0x167/0x180
[ 1315.391917]  debug_smp_processor_id+0x1c/0x20
[ 1315.392606]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1315.393492]  perf_trace_buf_alloc+0x3d/0x100
[ 1315.394172]  ? ftrace_verify_code+0x2c/0x70
[ 1315.394824]  ? copy_to_user_nofault+0x150/0x150
[ 1315.395547]  perf_ftrace_function_call+0x209/0x360
[ 1315.396507]  ? 0xffffffffa0098099
[ 1315.397165]  0xffffffffa0098099
[ 1315.397679]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1315.398503]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1315.399238]  ? virtqueue_add_inbuf_ctx+0x60/0x60
[ 1315.399959]  ? virtqueue_add_inbuf_ctx+0x60/0x60
[ 1315.400693]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1315.401512]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1315.402234]  ? vp_modern_remove+0x80/0x80
[ 1315.402884]  ? copy_from_kernel_nofault+0x5/0x220
[ 1315.403666]  copy_from_kernel_nofault+0x5/0x220
[ 1315.404381]  ftrace_verify_code+0x2c/0x70
[ 1315.405020]  ? copy_from_kernel_nofault+0x5/0x220
[ 1315.405747]  ? ftrace_verify_code+0x2c/0x70
[ 1315.406445]  ftrace_replace_code+0x69/0x170
[ 1315.407163]  ftrace_modify_all_code+0x1b1/0x270
[ 1315.407919]  arch_ftrace_update_code+0x9/0x10
[ 1315.408605]  ftrace_run_update_code+0x30/0xa0
[ 1315.409313]  ftrace_startup_enable+0x5e/0xa0
[ 1315.410010]  ftrace_startup+0x16d/0x240
[ 1315.410708]  register_ftrace_function+0x43/0x90
[ 1315.411441]  perf_ftrace_event_register+0xc1/0xf0
[ 1315.412200]  perf_trace_event_init+0xa0/0x4c0
[ 1315.412943]  perf_trace_init+0xda/0x160
[ 1315.413603]  perf_tp_event_init+0x57/0xa0
[ 1315.414272]  perf_try_init_event+0x83/0x270
[ 1315.415003]  perf_event_alloc+0xe3f/0x1c10
[ 1315.415645]  ? _raw_spin_unlock+0x2c/0x50
[ 1315.416296]  ? alloc_fd+0x20d/0x320
[ 1315.416969]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1315.417738]  ? write_comp_data+0x2f/0x90
[ 1315.418718]  __x64_sys_perf_event_open+0x26/0x30
[ 1315.419451]  do_syscall_64+0x37/0x80
[ 1315.420042]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1315.420817] RIP: 0033:0x7fac0740459d
[ 1315.421403] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1315.424059] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1315.425192] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1315.426243] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1315.427291] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1315.428341] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1315.429391] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1315.430674] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1315.431605] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1315.433033] Call Trace:
[ 1315.433360]  dump_stack_lvl+0xa4/0xd3
[ 1315.433850]  dump_stack+0x15/0x17
[ 1315.434298]  check_preemption_disabled+0x167/0x180
[ 1315.434924]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1315.435537]  ? __bpf_trace_sys_enter+0x10/0x10
[ 1315.436120]  debug_smp_processor_id+0x1c/0x20
[ 1315.436692]  perf_ftrace_function_call+0x7c/0x360
[ 1315.437308]  ? write_comp_data+0x2f/0x90
[ 1315.437832]  ? write_comp_data+0x2f/0x90
[ 1315.438358]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1315.438974]  ? write_comp_data+0x2f/0x90
[ 1315.439496]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1315.440120]  0xffffffffa0098099
[ 1315.440536]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1315.441169]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1315.441876]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1315.442496]  syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1315.443182]  syscall_exit_to_user_mode+0xd/0x60
[ 1315.443777]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1315.444483]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1315.445099]  do_syscall_64+0x46/0x80
[ 1315.445574]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1315.446233] RIP: 0033:0x7fac073cca18
[ 1315.446704] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1315.449020] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1315.449981] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1315.450886] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1315.451786] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1315.452685] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1315.453586] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1320.098125] check_preemption_disabled: 1450786 callbacks suppressed
[ 1320.098155] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1320.098253] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1320.099067] caller is debug_smp_processor_id+0x1c/0x20
[ 1320.099981] caller is debug_smp_processor_id+0x1c/0x20
[ 1320.101051] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1320.103286] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1320.104739] Call Trace:
[ 1320.105133]  dump_stack_lvl+0xa4/0xd3
[ 1320.105734]  dump_stack+0x15/0x17
[ 1320.106251]  check_preemption_disabled+0x167/0x180
[ 1320.106937]  ? __get_locked_pte+0x1a2/0x290
[ 1320.107532]  ? __lock_text_start+0x8/0x8
[ 1320.108146]  debug_smp_processor_id+0x1c/0x20
[ 1320.108781]  perf_ftrace_function_call+0x7c/0x360
[ 1320.109726]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1320.110407]  ? write_comp_data+0x2f/0x90
[ 1320.111004]  ? perf_trace_buf_update+0x70/0x70
[ 1320.111767]  0xffffffffa0098099
[ 1320.112301]  ? resv_hugepages_show+0x40/0x40
[ 1320.112978]  ? ftrace_call+0x5/0x44
[ 1320.113539]  ? pmd_page_vaddr+0x2b/0x70
[ 1320.114168]  ? _raw_spin_lock+0x5/0x50
[ 1320.114828]  _raw_spin_lock+0x5/0x50
[ 1320.115397]  __get_locked_pte+0x1a2/0x290
[ 1320.116019]  ? _raw_spin_lock+0x5/0x50
[ 1320.116588]  ? __get_locked_pte+0x1a2/0x290
[ 1320.117231]  ? resv_hugepages_show+0x40/0x40
[ 1320.117886]  __text_poke+0xea/0x4e0
[ 1320.118420]  ? resv_hugepages_show+0x40/0x40
[ 1320.119077]  ? lock_is_held_type+0xe2/0x140
[ 1320.119706]  ? resv_hugepages_show+0x40/0x40
[ 1320.120396]  text_poke+0x2b/0x60
[ 1320.120944]  text_poke_bp_batch+0x1dc/0x2c0
[ 1320.121624]  ? section_deactivate+0x360/0x360
[ 1320.122329]  text_poke_queue+0xa7/0xc0
[ 1320.122957]  ftrace_replace_code+0xfd/0x170
[ 1320.123655]  ftrace_modify_all_code+0x1b1/0x270
[ 1320.124377]  arch_ftrace_update_code+0x9/0x10
[ 1320.125009]  ftrace_run_update_code+0x30/0xa0
[ 1320.125675]  ftrace_startup_enable+0x5e/0xa0
[ 1320.126348]  ftrace_startup+0x16d/0x240
[ 1320.127040]  register_ftrace_function+0x43/0x90
[ 1320.127724]  perf_ftrace_event_register+0xc1/0xf0
[ 1320.128432]  perf_trace_event_init+0xa0/0x4c0
[ 1320.129148]  perf_trace_init+0xda/0x160
[ 1320.129785]  perf_tp_event_init+0x57/0xa0
[ 1320.130419]  perf_try_init_event+0x83/0x270
[ 1320.131131]  perf_event_alloc+0xe3f/0x1c10
[ 1320.131734]  ? _raw_spin_unlock+0x2c/0x50
[ 1320.132397]  ? alloc_fd+0x20d/0x320
[ 1320.133155]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1320.133944]  ? write_comp_data+0x2f/0x90
[ 1320.135153]  __x64_sys_perf_event_open+0x26/0x30
[ 1320.135902]  do_syscall_64+0x37/0x80
[ 1320.136511]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1320.137286] RIP: 0033:0x7fac0740459d
[ 1320.137875] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1320.140448] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1320.141574] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1320.142611] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1320.143644] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1320.144678] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1320.145709] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1320.147123] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1320.147309] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1320.148090] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1320.149188] caller is debug_smp_processor_id+0x1c/0x20
[ 1320.150553] Call Trace:
[ 1320.150583]  dump_stack_lvl+0xa4/0xd3
[ 1320.150650]  dump_stack+0x15/0x17
[ 1320.150686]  check_preemption_disabled+0x167/0x180
[ 1320.150725]  ? lock_timer_base+0x34/0x100
[ 1320.153731]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1320.154355]  debug_smp_processor_id+0x1c/0x20
[ 1320.154939]  perf_ftrace_function_call+0x7c/0x360
[ 1320.155581]  ? ftrace_ops_test+0x71/0xc0
[ 1320.156148]  ? ftrace_ops_test+0x71/0xc0
[ 1320.156688]  ? perf_trace_buf_update+0x70/0x70
[ 1320.157281]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1320.157922]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1320.158528]  ? write_comp_data+0x2f/0x90
[ 1320.159067]  ? perf_trace_buf_update+0x70/0x70
[ 1320.159725]  0xffffffffa0098099
[ 1320.160223]  ? ftrace_call+0x5/0x44
[ 1320.160723]  ? lock_timer_base+0xc0/0x100
[ 1320.161306]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1320.161900]  ? write_comp_data+0x2f/0x90
[ 1320.162450]  _raw_spin_lock_irqsave+0x5/0x70
[ 1320.163023]  lock_timer_base+0x34/0x100
[ 1320.163546]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1320.164129]  ? lock_timer_base+0x34/0x100
[ 1320.164727]  try_to_del_timer_sync+0x33/0x90
[ 1320.165292]  ? try_to_del_timer_sync+0x5/0x90
[ 1320.165901]  del_timer_sync+0xd3/0x130
[ 1320.166442]  schedule_timeout+0x34e/0x610
[ 1320.167039]  ? del_timer_sync+0x130/0x130
[ 1320.167616]  ? i915_init_ggtt+0x40/0x6b0
[ 1320.168212]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1320.168806]  ? rcu_gp_init+0x730/0x730
[ 1320.169314]  rcu_gp_kthread+0xdd/0x170
[ 1320.169868]  kthread+0x1e7/0x230
[ 1320.170332]  ? set_kthread_struct+0x80/0x80
[ 1320.170928]  ret_from_fork+0x1f/0x30
[ 1320.171606] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1320.171732] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1320.172688] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1320.173662] caller is debug_smp_processor_id+0x1c/0x20
[ 1320.175241] Call Trace:
[ 1320.175294]  dump_stack_lvl+0xa4/0xd3
[ 1320.176935]  dump_stack+0x15/0x17
[ 1320.177493]  check_preemption_disabled+0x167/0x180
[ 1320.178343]  debug_smp_processor_id+0x1c/0x20
[ 1320.179043]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1320.179966]  perf_trace_buf_alloc+0x3d/0x100
[ 1320.180654]  ? __get_locked_pte+0x1a2/0x290
[ 1320.181311]  ? __lock_text_start+0x8/0x8
[ 1320.181969]  perf_ftrace_function_call+0x209/0x360
[ 1320.183069]  ? 0xffffffffa0098099
[ 1320.183816]  0xffffffffa0098099
[ 1320.184397]  ? resv_hugepages_show+0x40/0x40
[ 1320.185120]  ? ftrace_call+0x5/0x44
[ 1320.185736]  ? pmd_page_vaddr+0x2b/0x70
[ 1320.186418]  ? _raw_spin_lock+0x5/0x50
[ 1320.187106]  _raw_spin_lock+0x5/0x50
[ 1320.187701]  __get_locked_pte+0x1a2/0x290
[ 1320.188353]  ? _raw_spin_lock+0x5/0x50
[ 1320.188953]  ? __get_locked_pte+0x1a2/0x290
[ 1320.189661]  ? resv_hugepages_show+0x40/0x40
[ 1320.190389]  __text_poke+0xea/0x4e0
[ 1320.190972]  ? resv_hugepages_show+0x40/0x40
[ 1320.191695]  ? lock_is_held_type+0xe2/0x140
[ 1320.192396]  ? resv_hugepages_show+0x40/0x40
[ 1320.193155]  text_poke+0x2b/0x60
[ 1320.193756]  text_poke_bp_batch+0x1dc/0x2c0
[ 1320.194508]  ? section_deactivate+0x360/0x360
[ 1320.195276]  text_poke_queue+0xa7/0xc0
[ 1320.195965]  ftrace_replace_code+0xfd/0x170
[ 1320.196730]  ftrace_modify_all_code+0x1b1/0x270
[ 1320.197523]  arch_ftrace_update_code+0x9/0x10
[ 1320.198224]  ftrace_run_update_code+0x30/0xa0
[ 1320.198957]  ftrace_startup_enable+0x5e/0xa0
[ 1320.199680]  ftrace_startup+0x16d/0x240
[ 1320.200431]  register_ftrace_function+0x43/0x90
[ 1320.201188]  perf_ftrace_event_register+0xc1/0xf0
[ 1320.201970]  perf_trace_event_init+0xa0/0x4c0
[ 1320.202753]  perf_trace_init+0xda/0x160
[ 1320.203453]  perf_tp_event_init+0x57/0xa0
[ 1320.204141]  perf_try_init_event+0x83/0x270
[ 1320.204928]  perf_event_alloc+0xe3f/0x1c10
[ 1320.205575]  ? _raw_spin_unlock+0x2c/0x50
[ 1320.206255]  ? alloc_fd+0x20d/0x320
[ 1320.207012]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1320.207801]  ? write_comp_data+0x2f/0x90
[ 1320.209005]  __x64_sys_perf_event_open+0x26/0x30
[ 1320.209757]  do_syscall_64+0x37/0x80
[ 1320.210377]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1320.211154] RIP: 0033:0x7fac0740459d
[ 1320.211740] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1320.214326] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1320.215455] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1320.216491] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1320.217527] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1320.218570] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1320.219608] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1320.221013] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1320.221183] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1320.221987] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1320.222010] Call Trace:
[ 1320.222040]  dump_stack_lvl+0xa4/0xd3
[ 1320.222115]  dump_stack+0x15/0x17
[ 1320.222152]  check_preemption_disabled+0x167/0x180
[ 1320.223164] caller is debug_smp_processor_id+0x1c/0x20
[ 1320.224542]  ? prepare_to_swait_event+0x1b/0xf0
[ 1320.227544]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1320.228166]  debug_smp_processor_id+0x1c/0x20
[ 1320.228751]  perf_ftrace_function_call+0x7c/0x360
[ 1320.229365]  ? ftrace_ops_test+0x71/0xc0
[ 1320.229978]  ? trace_hardirqs_on+0x3f/0x170
[ 1320.230586]  ? write_comp_data+0x2f/0x90
[ 1320.231127]  ? perf_trace_buf_update+0x70/0x70
[ 1320.231720]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1320.232418]  0xffffffffa0098099
[ 1320.232898]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1320.233558]  ? del_timer_sync+0xde/0x130
[ 1320.234124]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1320.234755]  _raw_spin_lock_irqsave+0x5/0x70
[ 1320.235330]  prepare_to_swait_event+0x1b/0xf0
[ 1320.235913]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1320.236497]  ? prepare_to_swait_event+0x1b/0xf0
[ 1320.237128]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1320.237724]  ? rcu_gp_init+0x730/0x730
[ 1320.238245]  rcu_gp_kthread+0xdd/0x170
[ 1320.238802]  kthread+0x1e7/0x230
[ 1320.239262]  ? set_kthread_struct+0x80/0x80
[ 1320.239863]  ret_from_fork+0x1f/0x30
[ 1320.240540] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1320.240655] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1320.241536] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1320.242585] caller is debug_smp_processor_id+0x1c/0x20
[ 1320.243986] Call Trace:
[ 1320.244983]  dump_stack_lvl+0xa4/0xd3
[ 1320.245566]  dump_stack+0x15/0x17
[ 1320.246072]  check_preemption_disabled+0x167/0x180
[ 1320.246821]  debug_smp_processor_id+0x1c/0x20
[ 1320.247454]  perf_trace_buf_alloc+0x98/0x100
[ 1320.248075]  ? __get_locked_pte+0x1a2/0x290
[ 1320.248673]  ? __lock_text_start+0x8/0x8
[ 1320.249269]  perf_ftrace_function_call+0x209/0x360
[ 1320.250193]  ? 0xffffffffa0098099
[ 1320.250822]  0xffffffffa0098099
[ 1320.251329]  ? resv_hugepages_show+0x40/0x40
[ 1320.251973]  ? ftrace_call+0x5/0x44
[ 1320.252520]  ? pmd_page_vaddr+0x2b/0x70
[ 1320.253119]  ? _raw_spin_lock+0x5/0x50
[ 1320.253723]  _raw_spin_lock+0x5/0x50
[ 1320.254274]  __get_locked_pte+0x1a2/0x290
[ 1320.254869]  ? _raw_spin_lock+0x5/0x50
[ 1320.255427]  ? __get_locked_pte+0x1a2/0x290
[ 1320.256060]  ? resv_hugepages_show+0x40/0x40
[ 1320.256705]  __text_poke+0xea/0x4e0
[ 1320.257227]  ? resv_hugepages_show+0x40/0x40
[ 1320.257871]  ? lock_is_held_type+0xe2/0x140
[ 1320.258500]  ? resv_hugepages_show+0x40/0x40
[ 1320.259170]  text_poke+0x2b/0x60
[ 1320.259694]  text_poke_bp_batch+0x1dc/0x2c0
[ 1320.260351]  ? section_deactivate+0x360/0x360
[ 1320.261029]  text_poke_queue+0xa7/0xc0
[ 1320.261634]  ftrace_replace_code+0xfd/0x170
[ 1320.262311]  ftrace_modify_all_code+0x1b1/0x270
[ 1320.263012]  arch_ftrace_update_code+0x9/0x10
[ 1320.263640]  ftrace_run_update_code+0x30/0xa0
[ 1320.264293]  ftrace_startup_enable+0x5e/0xa0
[ 1320.264937]  ftrace_startup+0x16d/0x240
[ 1320.265586]  register_ftrace_function+0x43/0x90
[ 1320.266270]  perf_ftrace_event_register+0xc1/0xf0
[ 1320.266967]  perf_trace_event_init+0xa0/0x4c0
[ 1320.267658]  perf_trace_init+0xda/0x160
[ 1320.268272]  perf_tp_event_init+0x57/0xa0
[ 1320.268883]  perf_try_init_event+0x83/0x270
[ 1320.269566]  perf_event_alloc+0xe3f/0x1c10
[ 1320.270161]  ? _raw_spin_unlock+0x2c/0x50
[ 1320.270760]  ? alloc_fd+0x20d/0x320
[ 1320.271399]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1320.272107]  ? write_comp_data+0x2f/0x90
[ 1320.273067]  __x64_sys_perf_event_open+0x26/0x30
[ 1320.273742]  do_syscall_64+0x37/0x80
[ 1320.274296]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1320.275003] RIP: 0033:0x7fac0740459d
[ 1320.275529] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1320.277924] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1320.278964] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1320.279914] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1320.280864] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1320.281815] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1320.282767] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1320.283974] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1320.284141] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1320.284934] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1320.285944] caller is debug_smp_processor_id+0x1c/0x20
[ 1320.287320] Call Trace:
[ 1320.288333]  dump_stack_lvl+0xa4/0xd3
[ 1320.288863]  dump_stack+0x15/0x17
[ 1320.289323]  check_preemption_disabled+0x167/0x180
[ 1320.289959]  ? finish_swait+0x41/0x80
[ 1320.290456]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1320.291079]  debug_smp_processor_id+0x1c/0x20
[ 1320.291662]  perf_ftrace_function_call+0x7c/0x360
[ 1320.292276]  ? ftrace_ops_test+0x71/0xc0
[ 1320.292815]  ? rcu_advance_cbs+0x70/0x70
[ 1320.293372]  ? write_comp_data+0x2f/0x90
[ 1320.293911]  ? perf_trace_buf_update+0x70/0x70
[ 1320.294507]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1320.295148]  ? write_comp_data+0x2f/0x90
[ 1320.295688]  ? perf_trace_buf_update+0x70/0x70
[ 1320.296283]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1320.296980]  0xffffffffa0098099
[ 1320.297479]  ? trace_hardirqs_on+0x3f/0x170
[ 1320.298109]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1320.298742]  _raw_spin_lock_irqsave+0x5/0x70
[ 1320.299317]  finish_swait+0x41/0x80
[ 1320.299798]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1320.300383]  ? finish_swait+0x41/0x80
[ 1320.300912]  rcu_gp_fqs_loop+0x2da/0x410
[ 1320.301509]  ? rcu_gp_init+0x730/0x730
[ 1320.302018]  rcu_gp_kthread+0xdd/0x170
[ 1320.302573]  kthread+0x1e7/0x230
[ 1320.303034]  ? set_kthread_struct+0x80/0x80
[ 1320.303634]  ret_from_fork+0x1f/0x30
[ 1320.304310] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1320.304425] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1320.305308] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1320.306354] caller is debug_smp_processor_id+0x1c/0x20
[ 1320.307750] Call Trace:
[ 1320.308745]  dump_stack_lvl+0xa4/0xd3
[ 1320.309332]  dump_stack+0x15/0x17
[ 1320.309833]  check_preemption_disabled+0x167/0x180
[ 1320.310588]  debug_smp_processor_id+0x1c/0x20
[ 1320.311220]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1320.312005]  perf_tp_event+0x331/0x4e0
[ 1320.312896]  ? arch_local_irq_enable+0x10/0x12
[ 1320.313548]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1320.314309]  ? dump_stack_lvl+0xcc/0xd3
[ 1320.314961]  ? dump_stack+0x15/0x17
[ 1320.315488]  ? check_preemption_disabled+0x167/0x180
[ 1320.316254]  ? __get_locked_pte+0x1a2/0x290
[ 1320.316855]  ? __lock_text_start+0x8/0x8
[ 1320.317456]  perf_ftrace_function_call+0x248/0x360
[ 1320.318145]  ? perf_ftrace_function_call+0x248/0x360
[ 1320.319107]  ? 0xffffffffa0098099
[ 1320.319734]  0xffffffffa0098099
[ 1320.320241]  ? resv_hugepages_show+0x40/0x40
[ 1320.320886]  ? ftrace_call+0x5/0x44
[ 1320.321430]  ? pmd_page_vaddr+0x2b/0x70
[ 1320.322028]  ? _raw_spin_lock+0x5/0x50
[ 1320.322658]  _raw_spin_lock+0x5/0x50
[ 1320.323253]  __get_locked_pte+0x1a2/0x290
[ 1320.323906]  ? _raw_spin_lock+0x5/0x50
[ 1320.324528]  ? __get_locked_pte+0x1a2/0x290
[ 1320.325216]  ? resv_hugepages_show+0x40/0x40
[ 1320.325919]  __text_poke+0xea/0x4e0
[ 1320.326505]  ? resv_hugepages_show+0x40/0x40
[ 1320.327207]  ? lock_is_held_type+0xe2/0x140
[ 1320.327882]  ? resv_hugepages_show+0x40/0x40
[ 1320.328609]  text_poke+0x2b/0x60
[ 1320.329179]  text_poke_bp_batch+0x1dc/0x2c0
[ 1320.329892]  ? section_deactivate+0x360/0x360
[ 1320.330656]  text_poke_queue+0xa7/0xc0
[ 1320.331316]  ftrace_replace_code+0xfd/0x170
[ 1320.332042]  ftrace_modify_all_code+0x1b1/0x270
[ 1320.332802]  arch_ftrace_update_code+0x9/0x10
[ 1320.333466]  ftrace_run_update_code+0x30/0xa0
[ 1320.334165]  ftrace_startup_enable+0x5e/0xa0
[ 1320.334806]  ftrace_startup+0x16d/0x240
[ 1320.335454]  register_ftrace_function+0x43/0x90
[ 1320.336130]  perf_ftrace_event_register+0xc1/0xf0
[ 1320.336827]  perf_trace_event_init+0xa0/0x4c0
[ 1320.337518]  perf_trace_init+0xda/0x160
[ 1320.338151]  perf_tp_event_init+0x57/0xa0
[ 1320.338764]  perf_try_init_event+0x83/0x270
[ 1320.339445]  perf_event_alloc+0xe3f/0x1c10
[ 1320.340030]  ? _raw_spin_unlock+0x2c/0x50
[ 1320.340629]  ? alloc_fd+0x20d/0x320
[ 1320.341277]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1320.341985]  ? write_comp_data+0x2f/0x90
[ 1320.342954]  __x64_sys_perf_event_open+0x26/0x30
[ 1320.343628]  do_syscall_64+0x37/0x80
[ 1320.344171]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1320.344877] RIP: 0033:0x7fac0740459d
[ 1320.345402] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1320.347805] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1320.348832] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1320.349781] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1320.350731] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1320.351680] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1320.352629] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1320.353834] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1320.354176] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1320.354813] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1320.355912] caller is debug_smp_processor_id+0x1c/0x20
[ 1320.357277] Call Trace:
[ 1320.358352]  dump_stack_lvl+0xa4/0xd3
[ 1320.358883]  dump_stack+0x15/0x17
[ 1320.359343]  check_preemption_disabled+0x167/0x180
[ 1320.359977]  ? force_qs_rnp+0xd0/0x2c0
[ 1320.360476]  ? preempt_schedule+0x30/0x30
[ 1320.361033]  debug_smp_processor_id+0x1c/0x20
[ 1320.361617]  perf_ftrace_function_call+0x7c/0x360
[ 1320.362235]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1320.362877]  ? ftrace_ops_test+0x71/0xc0
[ 1320.363414]  ? rcu_advance_cbs+0x70/0x70
[ 1320.363972]  ? write_comp_data+0x2f/0x90
[ 1320.364513]  ? perf_trace_buf_update+0x70/0x70
[ 1320.365105]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1320.365747]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1320.366343]  ? force_qs_rnp+0xcb/0x2c0
[ 1320.366853]  ? sched_show_task+0x70/0x70
[ 1320.367411]  ? rcu_gp_torture_wait+0x20/0x20
[ 1320.367995]  0xffffffffa0098099
[ 1320.368430]  ? rcu_exp_wait_wake+0x4c0/0x4c0
[ 1320.369130]  ? __cond_resched+0x5/0x30
[ 1320.369659]  ? ___might_sleep+0x143/0x170
[ 1320.370202]  __cond_resched+0x5/0x30
[ 1320.370693]  force_qs_rnp+0xd0/0x2c0
[ 1320.371181]  ? __cond_resched+0x5/0x30
[ 1320.371682]  ? force_qs_rnp+0xd0/0x2c0
[ 1320.372255]  rcu_gp_fqs_loop+0x2eb/0x410
[ 1320.372850]  ? rcu_gp_init+0x730/0x730
[ 1320.373358]  rcu_gp_kthread+0xdd/0x170
[ 1320.373913]  kthread+0x1e7/0x230
[ 1320.374378]  ? set_kthread_struct+0x80/0x80
[ 1320.374977]  ret_from_fork+0x1f/0x30
[ 1320.375656] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1320.375816] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1320.376742] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1320.377807] caller is debug_smp_processor_id+0x1c/0x20
[ 1320.379388] Call Trace:
[ 1320.379442]  dump_stack_lvl+0xa4/0xd3
[ 1320.381105]  dump_stack+0x15/0x17
[ 1320.381665]  check_preemption_disabled+0x167/0x180
[ 1320.382434]  ? __get_locked_pte+0x1a2/0x290
[ 1320.383092]  ? __lock_text_start+0x8/0x8
[ 1320.383767]  debug_smp_processor_id+0x1c/0x20
[ 1320.384469]  perf_ftrace_function_call+0x7c/0x360
[ 1320.385497]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1320.386238]  ? write_comp_data+0x2f/0x90
[ 1320.386895]  ? perf_trace_buf_update+0x70/0x70
[ 1320.387733]  0xffffffffa0098099
[ 1320.388317]  ? free_hugepages_show+0xb0/0xb0
[ 1320.389040]  ? ftrace_call+0x5/0x44
[ 1320.389656]  ? pmd_page_vaddr+0x2b/0x70
[ 1320.390340]  ? _raw_spin_lock+0x5/0x50
[ 1320.391028]  _raw_spin_lock+0x5/0x50
[ 1320.391622]  __get_locked_pte+0x1a2/0x290
[ 1320.392274]  ? _raw_spin_lock+0x5/0x50
[ 1320.392872]  ? __get_locked_pte+0x1a2/0x290
[ 1320.393582]  ? free_hugepages_show+0xb0/0xb0
[ 1320.394309]  __text_poke+0xea/0x4e0
[ 1320.394893]  ? free_hugepages_show+0xb0/0xb0
[ 1320.395616]  ? lock_is_held_type+0xe2/0x140
[ 1320.396309]  ? free_hugepages_show+0xb0/0xb0
[ 1320.397069]  text_poke+0x2b/0x60
[ 1320.397670]  text_poke_bp_batch+0x1dc/0x2c0
[ 1320.398419]  ? section_deactivate+0x360/0x360
[ 1320.399190]  text_poke_queue+0xa7/0xc0
[ 1320.399880]  ftrace_replace_code+0xfd/0x170
[ 1320.400646]  ftrace_modify_all_code+0x1b1/0x270
[ 1320.401437]  arch_ftrace_update_code+0x9/0x10
[ 1320.402140]  ftrace_run_update_code+0x30/0xa0
[ 1320.402875]  ftrace_startup_enable+0x5e/0xa0
[ 1320.403599]  ftrace_startup+0x16d/0x240
[ 1320.404352]  register_ftrace_function+0x43/0x90
[ 1320.405110]  perf_ftrace_event_register+0xc1/0xf0
[ 1320.405892]  perf_trace_event_init+0xa0/0x4c0
[ 1320.406684]  perf_trace_init+0xda/0x160
[ 1320.407385]  perf_tp_event_init+0x57/0xa0
[ 1320.408072]  perf_try_init_event+0x83/0x270
[ 1320.408854]  perf_event_alloc+0xe3f/0x1c10
[ 1320.409500]  ? _raw_spin_unlock+0x2c/0x50
[ 1320.410174]  ? alloc_fd+0x20d/0x320
[ 1320.410930]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1320.411723]  ? write_comp_data+0x2f/0x90
[ 1320.412929]  __x64_sys_perf_event_open+0x26/0x30
[ 1320.413682]  do_syscall_64+0x37/0x80
[ 1320.414299]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1320.415075] RIP: 0033:0x7fac0740459d
[ 1320.415663] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1320.418395] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1320.419544] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1320.420579] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1320.421622] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1320.422694] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1320.423730] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1320.425152] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1320.426220] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1320.427648] Call Trace:
[ 1320.428006]  dump_stack_lvl+0xa4/0xd3
[ 1320.428546]  dump_stack+0x15/0x17
[ 1320.429025]  check_preemption_disabled+0x167/0x180
[ 1320.429674]  ? do_epoll_wait+0x3b3/0xd80
[ 1320.430220]  ? __mutex_lock+0x9f0/0x9f0
[ 1320.430770]  debug_smp_processor_id+0x1c/0x20
[ 1320.431364]  perf_ftrace_function_call+0x7c/0x360
[ 1320.432058]  ? ftrace_call+0x5/0x44
[ 1320.432537]  ? trace_hardirqs_on+0x6a/0x170
[ 1320.433153]  ? finish_task_switch+0xb0/0x2a0
[ 1320.433727]  ? finish_task_switch+0x70/0x2a0
[ 1320.434337]  ? trace_hardirqs_on+0x3f/0x170
[ 1320.434901]  ? finish_task_switch+0x70/0x2a0
[ 1320.435502]  ? preempt_count_sub+0x5/0xa0
[ 1320.436108]  0xffffffffa0098099
[ 1320.436560]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1320.437233]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1320.437990]  ? do_epoll_wait+0x36b/0xd80
[ 1320.438572]  ? mutex_lock_nested+0x5/0x20
[ 1320.439123]  ? write_comp_data+0x2f/0x90
[ 1320.439682]  mutex_lock_nested+0x5/0x20
[ 1320.440213]  do_epoll_wait+0x3b3/0xd80
[ 1320.440736]  ? mutex_lock_nested+0x5/0x20
[ 1320.441278]  ? do_epoll_wait+0x3b3/0xd80
[ 1320.441977]  ? wait_woken+0x90/0x90
[ 1320.442547]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1320.443187]  do_syscall_64+0x37/0x80
[ 1320.443695]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1320.444363] RIP: 0033:0x7f8a39143b20
[ 1320.444860] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1320.447153] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1320.448131] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1320.449037] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1320.449941] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1320.450880] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1320.451786] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1325.102115] check_preemption_disabled: 851950 callbacks suppressed
[ 1325.102150] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1325.104002] caller is debug_smp_processor_id+0x1c/0x20
[ 1325.104700] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1325.105665] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1325.107115] Call Trace:
[ 1325.107503]  dump_stack_lvl+0xa4/0xd3
[ 1325.108091]  dump_stack+0x15/0x17
[ 1325.108589]  check_preemption_disabled+0x167/0x180
[ 1325.109262]  ? insn_get_opcode+0x1d5/0x3b0
[ 1325.109836]  ? insn_decode_from_regs+0x110/0x110
[ 1325.110530]  debug_smp_processor_id+0x1c/0x20
[ 1325.111153]  perf_ftrace_function_call+0x7c/0x360
[ 1325.111806]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1325.112435]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1325.113096]  ? insn_get_modrm+0x12b/0x2a0
[ 1325.113675]  ? perf_ftrace_function_call+0x4c/0x360
[ 1325.114768]  0xffffffffa0098099
[ 1325.115341]  ? 0xffffffffa0098099
[ 1325.115896]  ? insn_get_opcode+0x49/0x3b0
[ 1325.116524]  ? insn_get_prefixes.part.1+0x5/0x650
[ 1325.117184]  ? write_comp_data+0x2f/0x90
[ 1325.117786]  insn_get_prefixes.part.1+0x5/0x650
[ 1325.118443]  insn_get_opcode+0x1d5/0x3b0
[ 1325.119012]  ? insn_get_prefixes.part.1+0x5/0x650
[ 1325.119655]  ? insn_get_opcode+0x1d5/0x3b0
[ 1325.120324]  insn_get_modrm+0x12b/0x2a0
[ 1325.120964]  insn_get_sib+0x122/0x140
[ 1325.121569]  insn_get_displacement+0x157/0x270
[ 1325.122278]  insn_get_immediate+0x181/0x570
[ 1325.122960]  insn_get_length+0x75/0x90
[ 1325.123559]  insn_decode+0x9b/0x170
[ 1325.124111]  ? ima_check_policy+0x40/0x40
[ 1325.124706]  text_poke_loc_init+0x63/0x140
[ 1325.125525]  ? ima_check_policy+0x40/0x40
[ 1325.126184]  text_poke_queue+0x84/0xc0
[ 1325.126800]  ftrace_replace_code+0xfd/0x170
[ 1325.127484]  ftrace_modify_all_code+0x1b1/0x270
[ 1325.128190]  arch_ftrace_update_code+0x9/0x10
[ 1325.128811]  ftrace_run_update_code+0x30/0xa0
[ 1325.129465]  ftrace_startup_enable+0x5e/0xa0
[ 1325.130121]  ftrace_startup+0x16d/0x240
[ 1325.130803]  register_ftrace_function+0x43/0x90
[ 1325.131491]  perf_ftrace_event_register+0xc1/0xf0
[ 1325.132206]  perf_trace_event_init+0xa0/0x4c0
[ 1325.132932]  perf_trace_init+0xda/0x160
[ 1325.133578]  perf_tp_event_init+0x57/0xa0
[ 1325.134214]  perf_try_init_event+0x83/0x270
[ 1325.134912]  perf_event_alloc+0xe3f/0x1c10
[ 1325.135487]  ? _raw_spin_unlock+0x2c/0x50
[ 1325.136122]  ? alloc_fd+0x20d/0x320
[ 1325.136844]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1325.137600]  ? write_comp_data+0x2f/0x90
[ 1325.138759]  __x64_sys_perf_event_open+0x26/0x30
[ 1325.139474]  do_syscall_64+0x37/0x80
[ 1325.140055]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1325.140795] RIP: 0033:0x7fac0740459d
[ 1325.141354] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1325.143936] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1325.145067] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1325.146113] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1325.147152] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1325.148191] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1325.149231] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1325.150944] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1325.150962] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1325.150991] caller is debug_smp_processor_id+0x1c/0x20
[ 1325.152076] caller is debug_smp_processor_id+0x1c/0x20
[ 1325.153131] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1325.155525] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1325.156928] Call Trace:
[ 1325.157281]  dump_stack_lvl+0xa4/0xd3
[ 1325.157818]  dump_stack+0x15/0x17
[ 1325.158292]  check_preemption_disabled+0x167/0x180
[ 1325.158933]  ? do_epoll_wait+0x3b3/0xd80
[ 1325.159462]  ? __mutex_lock+0x9f0/0x9f0
[ 1325.160005]  debug_smp_processor_id+0x1c/0x20
[ 1325.160599]  perf_ftrace_function_call+0x7c/0x360
[ 1325.161285]  ? ftrace_call+0x5/0x44
[ 1325.161759]  ? trace_hardirqs_on+0x6a/0x170
[ 1325.162376]  ? finish_task_switch+0xb0/0x2a0
[ 1325.162945]  ? finish_task_switch+0x70/0x2a0
[ 1325.163542]  ? trace_hardirqs_on+0x3f/0x170
[ 1325.164099]  ? finish_task_switch+0x70/0x2a0
[ 1325.164695]  ? preempt_count_sub+0x5/0xa0
[ 1325.165298]  0xffffffffa0098099
[ 1325.165746]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1325.166403]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1325.167151]  ? do_epoll_wait+0x36b/0xd80
[ 1325.167716]  ? mutex_lock_nested+0x5/0x20
[ 1325.168262]  ? write_comp_data+0x2f/0x90
[ 1325.168816]  mutex_lock_nested+0x5/0x20
[ 1325.169343]  do_epoll_wait+0x3b3/0xd80
[ 1325.169861]  ? mutex_lock_nested+0x5/0x20
[ 1325.170401]  ? do_epoll_wait+0x3b3/0xd80
[ 1325.171095]  ? wait_woken+0x90/0x90
[ 1325.171655]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1325.172289]  do_syscall_64+0x37/0x80
[ 1325.172792]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1325.173454] RIP: 0033:0x7f8a39143b20
[ 1325.173945] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1325.176211] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1325.177181] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1325.178080] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1325.178978] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1325.179878] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1325.180776] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1325.181871] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1325.182253] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1325.182965] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1325.184000] caller is debug_smp_processor_id+0x1c/0x20
[ 1325.185583] Call Trace:
[ 1325.186640]  dump_stack_lvl+0xa4/0xd3
[ 1325.187302]  dump_stack+0x15/0x17
[ 1325.187865]  check_preemption_disabled+0x167/0x180
[ 1325.188717]  debug_smp_processor_id+0x1c/0x20
[ 1325.189421]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1325.190355]  perf_trace_buf_alloc+0x3d/0x100
[ 1325.191048]  ? insn_get_opcode+0x1d5/0x3b0
[ 1325.191694]  ? insn_decode_from_regs+0x110/0x110
[ 1325.192446]  perf_ftrace_function_call+0x209/0x360
[ 1325.193226]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1325.194262]  ? 0xffffffffa0098099
[ 1325.195011]  0xffffffffa0098099
[ 1325.195652]  ? 0xffffffffa0098099
[ 1325.196276]  ? insn_get_opcode+0x49/0x3b0
[ 1325.196982]  ? insn_get_prefixes.part.1+0x5/0x650
[ 1325.197729]  ? write_comp_data+0x2f/0x90
[ 1325.198410]  insn_get_prefixes.part.1+0x5/0x650
[ 1325.199136]  insn_get_opcode+0x1d5/0x3b0
[ 1325.199780]  ? insn_get_prefixes.part.1+0x5/0x650
[ 1325.200511]  ? insn_get_opcode+0x1d5/0x3b0
[ 1325.201265]  insn_get_modrm+0x12b/0x2a0
[ 1325.201987]  insn_get_sib+0x122/0x140
[ 1325.202669]  insn_get_displacement+0x157/0x270
[ 1325.203454]  insn_get_immediate+0x181/0x570
[ 1325.204222]  insn_get_length+0x75/0x90
[ 1325.204897]  insn_decode+0x9b/0x170
[ 1325.205517]  ? ima_check_policy+0x40/0x40
[ 1325.206174]  text_poke_loc_init+0x63/0x140
[ 1325.207089]  ? ima_check_policy+0x40/0x40
[ 1325.207815]  text_poke_queue+0x84/0xc0
[ 1325.208509]  ftrace_replace_code+0xfd/0x170
[ 1325.209277]  ftrace_modify_all_code+0x1b1/0x270
[ 1325.210078]  arch_ftrace_update_code+0x9/0x10
[ 1325.210781]  ftrace_run_update_code+0x30/0xa0
[ 1325.211519]  ftrace_startup_enable+0x5e/0xa0
[ 1325.212247]  ftrace_startup+0x16d/0x240
[ 1325.213004]  register_ftrace_function+0x43/0x90
[ 1325.213765]  perf_ftrace_event_register+0xc1/0xf0
[ 1325.214555]  perf_trace_event_init+0xa0/0x4c0
[ 1325.215348]  perf_trace_init+0xda/0x160
[ 1325.216053]  perf_tp_event_init+0x57/0xa0
[ 1325.216745]  perf_try_init_event+0x83/0x270
[ 1325.217533]  perf_event_alloc+0xe3f/0x1c10
[ 1325.218189]  ? _raw_spin_unlock+0x2c/0x50
[ 1325.218862]  ? alloc_fd+0x20d/0x320
[ 1325.219624]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1325.220421]  ? write_comp_data+0x2f/0x90
[ 1325.221631]  __x64_sys_perf_event_open+0x26/0x30
[ 1325.222391]  do_syscall_64+0x37/0x80
[ 1325.223007]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1325.223790] RIP: 0033:0x7fac0740459d
[ 1325.224380] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1325.226986] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1325.228123] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1325.229165] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1325.230211] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1325.231249] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1325.232288] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1325.233700] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1325.233872] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1325.234732] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1325.234754] Call Trace:
[ 1325.234782]  dump_stack_lvl+0xa4/0xd3
[ 1325.234848]  dump_stack+0x15/0x17
[ 1325.234885]  check_preemption_disabled+0x167/0x180
[ 1325.235886] caller is debug_smp_processor_id+0x1c/0x20
[ 1325.237277]  ? mutex_lock_nested+0x1b/0x20
[ 1325.240247]  ? mutex_lock_io_nested+0x940/0x940
[ 1325.240873]  debug_smp_processor_id+0x1c/0x20
[ 1325.241462]  perf_ftrace_function_call+0x7c/0x360
[ 1325.242095]  ? perf_ftrace_function_call+0x4c/0x360
[ 1325.242801]  ? ftrace_call+0x5/0x44
[ 1325.243275]  ? trace_hardirqs_on+0x6a/0x170
[ 1325.243880]  ? finish_task_switch+0xb0/0x2a0
[ 1325.244448]  ? finish_task_switch+0x70/0x2a0
[ 1325.245044]  ? trace_hardirqs_on+0x3f/0x170
[ 1325.245602]  ? finish_task_switch+0x70/0x2a0
[ 1325.246257]  0xffffffffa0098099
[ 1325.246706]  ? 0xffffffffa0098099
[ 1325.247172]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1325.247819]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1325.248532]  ? do_epoll_wait+0x3b3/0xd80
[ 1325.249116]  ? __mutex_lock+0x5/0x9f0
[ 1325.249622]  ? mutex_lock_nested+0x5/0x20
[ 1325.250172]  ? write_comp_data+0x2f/0x90
[ 1325.250707]  __mutex_lock+0x5/0x9f0
[ 1325.251192]  mutex_lock_nested+0x1b/0x20
[ 1325.251730]  ? __mutex_lock+0x5/0x9f0
[ 1325.252227]  ? mutex_lock_nested+0x1b/0x20
[ 1325.252784]  do_epoll_wait+0x3b3/0xd80
[ 1325.253459]  ? wait_woken+0x90/0x90
[ 1325.254017]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1325.254657]  do_syscall_64+0x37/0x80
[ 1325.255161]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1325.255829] RIP: 0033:0x7f8a39143b20
[ 1325.256319] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1325.258589] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1325.259557] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1325.260455] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1325.261351] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1325.262252] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1325.263152] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1325.264247] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1325.264330] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1325.265248] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1325.266355] caller is debug_smp_processor_id+0x1c/0x20
[ 1325.267757] Call Trace:
[ 1325.268763]  dump_stack_lvl+0xa4/0xd3
[ 1325.269347]  dump_stack+0x15/0x17
[ 1325.269849]  check_preemption_disabled+0x167/0x180
[ 1325.270608]  debug_smp_processor_id+0x1c/0x20
[ 1325.271244]  perf_trace_buf_alloc+0x98/0x100
[ 1325.271869]  ? insn_get_opcode+0x1d5/0x3b0
[ 1325.272456]  ? insn_decode_from_regs+0x110/0x110
[ 1325.273134]  perf_ftrace_function_call+0x209/0x360
[ 1325.274057]  ? 0xffffffffa0098099
[ 1325.274692]  0xffffffffa0098099
[ 1325.275241]  ? 0xffffffffa0098099
[ 1325.275784]  ? insn_get_opcode+0x49/0x3b0
[ 1325.276409]  ? insn_get_prefixes.part.1+0x5/0x650
[ 1325.277084]  ? write_comp_data+0x2f/0x90
[ 1325.277686]  insn_get_prefixes.part.1+0x5/0x650
[ 1325.278350]  insn_get_opcode+0x1d5/0x3b0
[ 1325.278928]  ? insn_get_prefixes.part.1+0x5/0x650
[ 1325.279590]  ? insn_get_opcode+0x1d5/0x3b0
[ 1325.280250]  insn_get_modrm+0x12b/0x2a0
[ 1325.280891]  insn_get_sib+0x122/0x140
[ 1325.281485]  insn_get_displacement+0x157/0x270
[ 1325.282188]  insn_get_immediate+0x181/0x570
[ 1325.282859]  insn_get_length+0x75/0x90
[ 1325.283452]  insn_decode+0x9b/0x170
[ 1325.284008]  ? ima_check_policy+0x40/0x40
[ 1325.284597]  text_poke_loc_init+0x63/0x140
[ 1325.285367]  ? ima_check_policy+0x40/0x40
[ 1325.286003]  text_poke_queue+0x84/0xc0
[ 1325.286616]  ftrace_replace_code+0xfd/0x170
[ 1325.287286]  ftrace_modify_all_code+0x1b1/0x270
[ 1325.287990]  arch_ftrace_update_code+0x9/0x10
[ 1325.288624]  ftrace_run_update_code+0x30/0xa0
[ 1325.289282]  ftrace_startup_enable+0x5e/0xa0
[ 1325.289930]  ftrace_startup+0x16d/0x240
[ 1325.290590]  register_ftrace_function+0x43/0x90
[ 1325.291271]  perf_ftrace_event_register+0xc1/0xf0
[ 1325.291973]  perf_trace_event_init+0xa0/0x4c0
[ 1325.292667]  perf_trace_init+0xda/0x160
[ 1325.293285]  perf_tp_event_init+0x57/0xa0
[ 1325.293903]  perf_try_init_event+0x83/0x270
[ 1325.294597]  perf_event_alloc+0xe3f/0x1c10
[ 1325.295188]  ? _raw_spin_unlock+0x2c/0x50
[ 1325.295790]  ? alloc_fd+0x20d/0x320
[ 1325.296433]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1325.297145]  ? write_comp_data+0x2f/0x90
[ 1325.298121]  __x64_sys_perf_event_open+0x26/0x30
[ 1325.298801]  do_syscall_64+0x37/0x80
[ 1325.299349]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1325.300060] RIP: 0033:0x7fac0740459d
[ 1325.300589] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1325.303011] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1325.304047] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1325.305005] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1325.305962] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1325.306924] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1325.307870] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1325.309082] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1325.309252] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1325.310121] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1325.310142] Call Trace:
[ 1325.310170]  dump_stack_lvl+0xa4/0xd3
[ 1325.310236]  dump_stack+0x15/0x17
[ 1325.310272]  check_preemption_disabled+0x167/0x180
[ 1325.311282] caller is debug_smp_processor_id+0x1c/0x20
[ 1325.312674]  ? ep_start_scan+0x68/0x100
[ 1325.315615]  ? _raw_read_lock_irq+0xa0/0xa0
[ 1325.316201]  debug_smp_processor_id+0x1c/0x20
[ 1325.316790]  perf_ftrace_function_call+0x7c/0x360
[ 1325.317421]  ? ftrace_ops_test+0x71/0xc0
[ 1325.317965]  ? preempt_notifier_dec+0x20/0x20
[ 1325.318615]  ? ftrace_call+0x5/0x44
[ 1325.319136]  ? write_comp_data+0x2f/0x90
[ 1325.319681]  ? perf_trace_buf_update+0x70/0x70
[ 1325.320280]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1325.320976]  0xffffffffa0098099
[ 1325.321460]  ? ftrace_call+0x5/0x44
[ 1325.321944]  ? __mutex_lock+0xfe/0x9f0
[ 1325.322469]  ? do_epoll_wait+0x3b3/0xd80
[ 1325.323006]  ? ep_start_scan+0xe0/0x100
[ 1325.323561]  ? _raw_write_lock_irq+0x5/0x60
[ 1325.324129]  ? write_comp_data+0x2f/0x90
[ 1325.324683]  _raw_write_lock_irq+0x5/0x60
[ 1325.325230]  ep_start_scan+0x68/0x100
[ 1325.325736]  ? _raw_write_lock_irq+0x5/0x60
[ 1325.326304]  ? ep_start_scan+0x68/0x100
[ 1325.326868]  do_epoll_wait+0x3bf/0xd80
[ 1325.327542]  ? wait_woken+0x90/0x90
[ 1325.328100]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1325.328734]  do_syscall_64+0x37/0x80
[ 1325.329238]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1325.329901] RIP: 0033:0x7f8a39143b20
[ 1325.330400] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1325.332666] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1325.333631] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1325.334542] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1325.335436] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1325.336331] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1325.337226] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1325.338323] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1325.338413] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1325.339323] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1325.340360] caller is debug_smp_processor_id+0x1c/0x20
[ 1325.341825] Call Trace:
[ 1325.342847]  dump_stack_lvl+0xa4/0xd3
[ 1325.343433]  dump_stack+0x15/0x17
[ 1325.343937]  check_preemption_disabled+0x167/0x180
[ 1325.344690]  debug_smp_processor_id+0x1c/0x20
[ 1325.345326]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1325.346121]  perf_tp_event+0x331/0x4e0
[ 1325.346882]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1325.347816]  ? arch_local_irq_enable+0x10/0x12
[ 1325.348475]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1325.349176]  ? dump_stack_lvl+0xcc/0xd3
[ 1325.349816]  ? insn_get_opcode+0x1d5/0x3b0
[ 1325.350410]  ? insn_decode_from_regs+0x110/0x110
[ 1325.351099]  perf_ftrace_function_call+0x248/0x360
[ 1325.351801]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1325.352448]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1325.353125]  ? perf_ftrace_function_call+0x248/0x360
[ 1325.354096]  ? 0xffffffffa0098099
[ 1325.354727]  0xffffffffa0098099
[ 1325.355275]  ? 0xffffffffa0098099
[ 1325.355822]  ? insn_get_opcode+0x49/0x3b0
[ 1325.356448]  ? insn_get_prefixes.part.1+0x5/0x650
[ 1325.357124]  ? write_comp_data+0x2f/0x90
[ 1325.357726]  insn_get_prefixes.part.1+0x5/0x650
[ 1325.358387]  insn_get_opcode+0x1d5/0x3b0
[ 1325.358966]  ? insn_get_prefixes.part.1+0x5/0x650
[ 1325.359631]  ? insn_get_opcode+0x1d5/0x3b0
[ 1325.360291]  insn_get_modrm+0x12b/0x2a0
[ 1325.360925]  insn_get_sib+0x122/0x140
[ 1325.361520]  insn_get_displacement+0x157/0x270
[ 1325.362226]  insn_get_immediate+0x181/0x570
[ 1325.362903]  insn_get_length+0x75/0x90
[ 1325.363496]  insn_decode+0x9b/0x170
[ 1325.364045]  ? ima_check_policy+0x40/0x40
[ 1325.364633]  text_poke_loc_init+0x63/0x140
[ 1325.365402]  ? ima_check_policy+0x40/0x40
[ 1325.366039]  text_poke_queue+0x84/0xc0
[ 1325.366656]  ftrace_replace_code+0xfd/0x170
[ 1325.367329]  ftrace_modify_all_code+0x1b1/0x270
[ 1325.368031]  arch_ftrace_update_code+0x9/0x10
[ 1325.368667]  ftrace_run_update_code+0x30/0xa0
[ 1325.369325]  ftrace_startup_enable+0x5e/0xa0
[ 1325.369972]  ftrace_startup+0x16d/0x240
[ 1325.370630]  register_ftrace_function+0x43/0x90
[ 1325.371311]  perf_ftrace_event_register+0xc1/0xf0
[ 1325.372017]  perf_trace_event_init+0xa0/0x4c0
[ 1325.372713]  perf_trace_init+0xda/0x160
[ 1325.373332]  perf_tp_event_init+0x57/0xa0
[ 1325.373948]  perf_try_init_event+0x83/0x270
[ 1325.374636]  perf_event_alloc+0xe3f/0x1c10
[ 1325.375227]  ? _raw_spin_unlock+0x2c/0x50
[ 1325.375830]  ? alloc_fd+0x20d/0x320
[ 1325.376473]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1325.377186]  ? write_comp_data+0x2f/0x90
[ 1325.378152]  __x64_sys_perf_event_open+0x26/0x30
[ 1325.378831]  do_syscall_64+0x37/0x80
[ 1325.379379]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1325.380089] RIP: 0033:0x7fac0740459d
[ 1325.380617] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1325.382994] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1325.384036] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1325.384993] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1325.385950] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1325.386907] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1325.387866] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1325.389075] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1325.389248] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1325.390104] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1325.390125] Call Trace:
[ 1325.390153]  dump_stack_lvl+0xa4/0xd3
[ 1325.390218]  dump_stack+0x15/0x17
[ 1325.390255]  check_preemption_disabled+0x167/0x180
[ 1325.391353] caller is debug_smp_processor_id+0x1c/0x20
[ 1325.392740]  ? ep_done_scan+0x3b/0x240
[ 1325.395694]  ? _raw_read_lock_irq+0xa0/0xa0
[ 1325.396281]  debug_smp_processor_id+0x1c/0x20
[ 1325.396869]  perf_ftrace_function_call+0x7c/0x360
[ 1325.397499]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1325.398147]  ? ftrace_ops_test+0x71/0xc0
[ 1325.398718]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1325.399363]  ? _prb_read_valid+0x3ad/0x3f0
[ 1325.399968]  ? write_comp_data+0x2f/0x90
[ 1325.400578]  0xffffffffa0098099
[ 1325.401025]  ? ep_destroy_wakeup_source+0xe0/0xe0
[ 1325.401729]  ? do_epoll_wait+0x85a/0xd80
[ 1325.402298]  ? _raw_write_lock_irq+0x5/0x60
[ 1325.402902]  _raw_write_lock_irq+0x5/0x60
[ 1325.403451]  ep_done_scan+0x3b/0x240
[ 1325.403948]  ? _raw_write_lock_irq+0x5/0x60
[ 1325.404506]  ? ep_done_scan+0x3b/0x240
[ 1325.405096]  do_epoll_wait+0xabb/0xd80
[ 1325.405771]  ? wait_woken+0x90/0x90
[ 1325.406333]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1325.406970]  do_syscall_64+0x37/0x80
[ 1325.407474]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1325.408136] RIP: 0033:0x7f8a39143b20
[ 1325.408625] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1325.410891] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1325.411858] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1325.412752] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1325.413647] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1325.414545] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1325.415438] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1325.416530] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1325.416613] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1325.417610] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1325.418719] caller is debug_smp_processor_id+0x1c/0x20
[ 1325.420231] Call Trace:
[ 1325.421279]  dump_stack_lvl+0xa4/0xd3
[ 1325.421938]  dump_stack+0x15/0x17
[ 1325.422502]  check_preemption_disabled+0x167/0x180
[ 1325.423269]  ? insn_get_prefixes.part.1+0x114/0x650
[ 1325.424022]  ? bad_get_user+0xd/0xd
[ 1325.424644]  debug_smp_processor_id+0x1c/0x20
[ 1325.425349]  perf_ftrace_function_call+0x7c/0x360
[ 1325.426104]  ? perf_ftrace_function_call+0x248/0x360
[ 1325.426904]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1325.427616]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1325.428361]  ? insn_get_opcode+0x1d5/0x3b0
[ 1325.429025]  ? perf_ftrace_function_call+0x4c/0x360
[ 1325.430155]  0xffffffffa0098099
[ 1325.430882]  ? insn_get_prefixes.part.1+0xb3/0x650
[ 1325.431692]  ? inat_get_opcode_attribute+0x5/0x20
[ 1325.432440]  ? write_comp_data+0x2f/0x90
[ 1325.433117]  inat_get_opcode_attribute+0x5/0x20
[ 1325.433842]  insn_get_prefixes.part.1+0x114/0x650
[ 1325.434592]  ? inat_get_opcode_attribute+0x5/0x20
[ 1325.435330]  ? insn_get_prefixes.part.1+0x114/0x650
[ 1325.436099]  ? write_comp_data+0x2f/0x90
[ 1325.436864]  insn_get_opcode+0x1d5/0x3b0
[ 1325.437593]  insn_get_modrm+0x12b/0x2a0
[ 1325.438319]  insn_get_sib+0x122/0x140
[ 1325.438996]  insn_get_displacement+0x157/0x270
[ 1325.439779]  insn_get_immediate+0x181/0x570
[ 1325.440545]  insn_get_length+0x75/0x90
[ 1325.441217]  insn_decode+0x9b/0x170
[ 1325.441836]  ? ima_check_policy+0x40/0x40
[ 1325.442626]  text_poke_loc_init+0x63/0x140
[ 1325.443596]  ? ima_check_policy+0x40/0x40
[ 1325.444318]  text_poke_queue+0x84/0xc0
[ 1325.445010]  ftrace_replace_code+0xfd/0x170
[ 1325.445774]  ftrace_modify_all_code+0x1b1/0x270
[ 1325.446580]  arch_ftrace_update_code+0x9/0x10
[ 1325.447278]  ftrace_run_update_code+0x30/0xa0
[ 1325.448014]  ftrace_startup_enable+0x5e/0xa0
[ 1325.448737]  ftrace_startup+0x16d/0x240
[ 1325.449490]  register_ftrace_function+0x43/0x90
[ 1325.450258]  perf_ftrace_event_register+0xc1/0xf0
[ 1325.451042]  perf_trace_event_init+0xa0/0x4c0
[ 1325.451904]  perf_trace_init+0xda/0x160
[ 1325.452605]  perf_tp_event_init+0x57/0xa0
[ 1325.453290]  perf_try_init_event+0x83/0x270
[ 1325.454079]  perf_event_alloc+0xe3f/0x1c10
[ 1325.454729]  ? _raw_spin_unlock+0x2c/0x50
[ 1325.455395]  ? alloc_fd+0x20d/0x320
[ 1325.456150]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1325.456941]  ? write_comp_data+0x2f/0x90
[ 1325.458149]  __x64_sys_perf_event_open+0x26/0x30
[ 1325.458898]  do_syscall_64+0x37/0x80
[ 1325.459507]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1325.460281] RIP: 0033:0x7fac0740459d
[ 1325.460865] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1325.463442] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1325.464571] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1325.465603] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1325.466648] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1325.467682] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1325.468741] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1325.470157] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1325.471192] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1325.472598] Call Trace:
[ 1325.472951]  dump_stack_lvl+0xa4/0xd3
[ 1325.473486]  dump_stack+0x15/0x17
[ 1325.473950]  check_preemption_disabled+0x167/0x180
[ 1325.474604]  ? do_epoll_wait+0xac3/0xd80
[ 1325.475132]  ? __mutex_unlock_slowpath+0x2e0/0x2e0
[ 1325.475792]  debug_smp_processor_id+0x1c/0x20
[ 1325.476383]  perf_ftrace_function_call+0x7c/0x360
[ 1325.477025]  ? perf_trace_buf_update+0x70/0x70
[ 1325.477627]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1325.478290]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1325.478890]  ? _raw_write_unlock_irq+0x38/0x50
[ 1325.479491]  ? preempt_notifier_dec+0x20/0x20
[ 1325.480134]  ? ftrace_call+0x5/0x44
[ 1325.480619]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1325.481335]  0xffffffffa0098099
[ 1325.481802]  ? preempt_count_sub+0x5/0xa0
[ 1325.482461]  ? mutex_unlock+0x5/0x20
[ 1325.482994]  mutex_unlock+0x5/0x20
[ 1325.483472]  do_epoll_wait+0xac3/0xd80
[ 1325.483991]  ? mutex_unlock+0x5/0x20
[ 1325.484482]  ? do_epoll_wait+0xac3/0xd80
[ 1325.485179]  ? wait_woken+0x90/0x90
[ 1325.485740]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1325.486384]  do_syscall_64+0x37/0x80
[ 1325.486890]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1325.487553] RIP: 0033:0x7f8a39143b20
[ 1325.488043] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1325.490319] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1325.491288] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1325.492185] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1325.493082] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1325.493984] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1325.494892] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1330.106130] check_preemption_disabled: 612196 callbacks suppressed
[ 1330.106162] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1330.108131] caller is debug_smp_processor_id+0x1c/0x20
[ 1330.108878] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1330.109924] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1330.111505] Call Trace:
[ 1330.111916]  dump_stack_lvl+0xa4/0xd3
[ 1330.112539]  dump_stack+0x15/0x17
[ 1330.113066]  check_preemption_disabled+0x167/0x180
[ 1330.113785]  ? __get_locked_pte+0x1a2/0x290
[ 1330.114417]  ? __lock_text_start+0x8/0x8
[ 1330.115055]  debug_smp_processor_id+0x1c/0x20
[ 1330.115716]  perf_ftrace_function_call+0x7c/0x360
[ 1330.116682]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1330.117385]  ? write_comp_data+0x2f/0x90
[ 1330.118010]  ? perf_trace_buf_update+0x70/0x70
[ 1330.118811]  0xffffffffa0098099
[ 1330.119360]  ? devm_counter_match+0x60/0x60
[ 1330.120048]  ? ftrace_call+0x5/0x44
[ 1330.120631]  ? pmd_page_vaddr+0x2b/0x70
[ 1330.121278]  ? _raw_spin_lock+0x5/0x50
[ 1330.121926]  _raw_spin_lock+0x5/0x50
[ 1330.122504]  __get_locked_pte+0x1a2/0x290
[ 1330.123121]  ? _raw_spin_lock+0x5/0x50
[ 1330.123688]  ? __get_locked_pte+0x1a2/0x290
[ 1330.124357]  ? devm_counter_match+0x60/0x60
[ 1330.125026]  __text_poke+0xea/0x4e0
[ 1330.125578]  ? devm_counter_match+0x60/0x60
[ 1330.126266]  ? lock_is_held_type+0xe2/0x140
[ 1330.126920]  ? devm_counter_match+0x60/0x60
[ 1330.127621]  text_poke+0x2b/0x60
[ 1330.128187]  text_poke_bp_batch+0x1dc/0x2c0
[ 1330.128891]  ? sockfs_dname+0x40/0x40
[ 1330.129527]  text_poke_queue+0xa7/0xc0
[ 1330.130200]  ftrace_replace_code+0xfd/0x170
[ 1330.130920]  ftrace_modify_all_code+0x1b1/0x270
[ 1330.131665]  arch_ftrace_update_code+0x9/0x10
[ 1330.132324]  ftrace_run_update_code+0x30/0xa0
[ 1330.133017]  ftrace_startup_enable+0x5e/0xa0
[ 1330.133698]  ftrace_startup+0x16d/0x240
[ 1330.134424]  register_ftrace_function+0x43/0x90
[ 1330.135215]  perf_ftrace_event_register+0xc1/0xf0
[ 1330.135974]  perf_trace_event_init+0xa0/0x4c0
[ 1330.136736]  perf_trace_init+0xda/0x160
[ 1330.137412]  perf_tp_event_init+0x57/0xa0
[ 1330.138093]  perf_try_init_event+0x83/0x270
[ 1330.138891]  perf_event_alloc+0xe3f/0x1c10
[ 1330.139552]  ? _raw_spin_unlock+0x2c/0x50
[ 1330.140259]  ? alloc_fd+0x20d/0x320
[ 1330.141052]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1330.141897]  ? write_comp_data+0x2f/0x90
[ 1330.143171]  __x64_sys_perf_event_open+0x26/0x30
[ 1330.143973]  do_syscall_64+0x37/0x80
[ 1330.144623]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1330.145453] RIP: 0033:0x7fac0740459d
[ 1330.146088] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1330.148864] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1330.150078] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1330.151159] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1330.152211] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1330.153265] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1330.154342] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1330.156026] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1330.156043] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1330.156072] caller is debug_smp_processor_id+0x1c/0x20
[ 1330.157241] caller is debug_smp_processor_id+0x1c/0x20
[ 1330.158634] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1330.161169] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1330.162723] Call Trace:
[ 1330.163109]  dump_stack_lvl+0xa4/0xd3
[ 1330.163688]  dump_stack+0x15/0x17
[ 1330.164192]  check_preemption_disabled+0x167/0x180
[ 1330.164889]  ? do_epoll_wait+0x3b3/0xd80
[ 1330.165465]  ? __mutex_lock+0x9f0/0x9f0
[ 1330.166059]  debug_smp_processor_id+0x1c/0x20
[ 1330.166707]  perf_ftrace_function_call+0x7c/0x360
[ 1330.167448]  ? ftrace_call+0x5/0x44
[ 1330.167966]  ? trace_hardirqs_on+0x6a/0x170
[ 1330.168621]  ? finish_task_switch+0xb0/0x2a0
[ 1330.169242]  ? finish_task_switch+0x70/0x2a0
[ 1330.169888]  ? trace_hardirqs_on+0x3f/0x170
[ 1330.170501]  ? finish_task_switch+0x70/0x2a0
[ 1330.171149]  ? preempt_count_sub+0x5/0xa0
[ 1330.171799]  0xffffffffa0098099
[ 1330.172286]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1330.172989]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1330.173802]  ? do_epoll_wait+0x36b/0xd80
[ 1330.174418]  ? mutex_lock_nested+0x5/0x20
[ 1330.175012]  ? write_comp_data+0x2f/0x90
[ 1330.175613]  mutex_lock_nested+0x5/0x20
[ 1330.176186]  do_epoll_wait+0x3b3/0xd80
[ 1330.176749]  ? mutex_lock_nested+0x5/0x20
[ 1330.177333]  ? do_epoll_wait+0x3b3/0xd80
[ 1330.178077]  ? wait_woken+0x90/0x90
[ 1330.178680]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1330.179363]  do_syscall_64+0x37/0x80
[ 1330.179910]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1330.180632] RIP: 0033:0x7f8a39143b20
[ 1330.181166] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1330.183655] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1330.184712] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1330.185691] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1330.186676] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1330.187655] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1330.188634] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1330.189809] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1330.189922] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1330.190976] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1330.191013] Call Trace:
[ 1330.191065]  dump_stack_lvl+0xa4/0xd3
[ 1330.192173] caller is debug_smp_processor_id+0x1c/0x20
[ 1330.193941]  dump_stack+0x15/0x17
[ 1330.196142]  check_preemption_disabled+0x167/0x180
[ 1330.197042]  debug_smp_processor_id+0x1c/0x20
[ 1330.197791]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1330.198781]  perf_trace_buf_alloc+0x3d/0x100
[ 1330.199515]  ? __get_locked_pte+0x1a2/0x290
[ 1330.200215]  ? __lock_text_start+0x8/0x8
[ 1330.200914]  perf_ftrace_function_call+0x209/0x360
[ 1330.202065]  ? 0xffffffffa0098099
[ 1330.202847]  0xffffffffa0098099
[ 1330.203464]  ? devm_counter_match+0x60/0x60
[ 1330.204220]  ? ftrace_call+0x5/0x44
[ 1330.204875]  ? pmd_page_vaddr+0x2b/0x70
[ 1330.205595]  ? _raw_spin_lock+0x5/0x50
[ 1330.206327]  _raw_spin_lock+0x5/0x50
[ 1330.206963]  __get_locked_pte+0x1a2/0x290
[ 1330.207658]  ? _raw_spin_lock+0x5/0x50
[ 1330.208298]  ? __get_locked_pte+0x1a2/0x290
[ 1330.209052]  ? devm_counter_match+0x60/0x60
[ 1330.209805]  __text_poke+0xea/0x4e0
[ 1330.210429]  ? devm_counter_match+0x60/0x60
[ 1330.211181]  ? lock_is_held_type+0xe2/0x140
[ 1330.211919]  ? devm_counter_match+0x60/0x60
[ 1330.212706]  text_poke+0x2b/0x60
[ 1330.213341]  text_poke_bp_batch+0x1dc/0x2c0
[ 1330.214135]  ? sockfs_dname+0x40/0x40
[ 1330.214848]  text_poke_queue+0xa7/0xc0
[ 1330.215577]  ftrace_replace_code+0xfd/0x170
[ 1330.216385]  ftrace_modify_all_code+0x1b1/0x270
[ 1330.217224]  arch_ftrace_update_code+0x9/0x10
[ 1330.217969]  ftrace_run_update_code+0x30/0xa0
[ 1330.218752]  ftrace_startup_enable+0x5e/0xa0
[ 1330.219522]  ftrace_startup+0x16d/0x240
[ 1330.220315]  register_ftrace_function+0x43/0x90
[ 1330.221122]  perf_ftrace_event_register+0xc1/0xf0
[ 1330.221952]  perf_trace_event_init+0xa0/0x4c0
[ 1330.222791]  perf_trace_init+0xda/0x160
[ 1330.223533]  perf_tp_event_init+0x57/0xa0
[ 1330.224267]  perf_try_init_event+0x83/0x270
[ 1330.225095]  perf_event_alloc+0xe3f/0x1c10
[ 1330.225788]  ? _raw_spin_unlock+0x2c/0x50
[ 1330.226505]  ? alloc_fd+0x20d/0x320
[ 1330.227300]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1330.228142]  ? write_comp_data+0x2f/0x90
[ 1330.229388]  __x64_sys_perf_event_open+0x26/0x30
[ 1330.230191]  do_syscall_64+0x37/0x80
[ 1330.230841]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1330.231671] RIP: 0033:0x7fac0740459d
[ 1330.232298] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1330.235075] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1330.236285] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1330.237394] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1330.238504] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1330.239611] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1330.240718] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1330.242202] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1330.242371] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1330.243319] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1330.244417] caller is debug_smp_processor_id+0x1c/0x20
[ 1330.245928] Call Trace:
[ 1330.247043]  dump_stack_lvl+0xa4/0xd3
[ 1330.247623]  dump_stack+0x15/0x17
[ 1330.248126]  check_preemption_disabled+0x167/0x180
[ 1330.248825]  ? mutex_lock_nested+0x1b/0x20
[ 1330.249421]  ? mutex_lock_io_nested+0x940/0x940
[ 1330.250105]  debug_smp_processor_id+0x1c/0x20
[ 1330.250747]  perf_ftrace_function_call+0x7c/0x360
[ 1330.251434]  ? perf_ftrace_function_call+0x4c/0x360
[ 1330.252197]  ? ftrace_call+0x5/0x44
[ 1330.252713]  ? trace_hardirqs_on+0x6a/0x170
[ 1330.253368]  ? finish_task_switch+0xb0/0x2a0
[ 1330.253986]  ? finish_task_switch+0x70/0x2a0
[ 1330.254636]  ? trace_hardirqs_on+0x3f/0x170
[ 1330.255245]  ? finish_task_switch+0x70/0x2a0
[ 1330.255949]  0xffffffffa0098099
[ 1330.256436]  ? 0xffffffffa0098099
[ 1330.256944]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1330.257648]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1330.258433]  ? do_epoll_wait+0x3b3/0xd80
[ 1330.259064]  ? __mutex_lock+0x5/0x9f0
[ 1330.259614]  ? mutex_lock_nested+0x5/0x20
[ 1330.260208]  ? write_comp_data+0x2f/0x90
[ 1330.260789]  __mutex_lock+0x5/0x9f0
[ 1330.261316]  mutex_lock_nested+0x1b/0x20
[ 1330.261900]  ? __mutex_lock+0x5/0x9f0
[ 1330.262467]  ? mutex_lock_nested+0x1b/0x20
[ 1330.263074]  do_epoll_wait+0x3b3/0xd80
[ 1330.263793]  ? wait_woken+0x90/0x90
[ 1330.264392]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1330.265077]  do_syscall_64+0x37/0x80
[ 1330.265624]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1330.266383] RIP: 0033:0x7f8a39143b20
[ 1330.266948] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1330.269436] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1330.270522] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1330.271510] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1330.272491] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1330.273471] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1330.274458] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1330.275634] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1330.275752] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1330.276716] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1330.277852] caller is debug_smp_processor_id+0x1c/0x20
[ 1330.279450] Call Trace:
[ 1330.279486]  dump_stack_lvl+0xa4/0xd3
[ 1330.279569]  dump_stack+0x15/0x17
[ 1330.281631]  check_preemption_disabled+0x167/0x180
[ 1330.282439]  debug_smp_processor_id+0x1c/0x20
[ 1330.283120]  perf_trace_buf_alloc+0x98/0x100
[ 1330.283789]  ? __get_locked_pte+0x1a2/0x290
[ 1330.284432]  ? __lock_text_start+0x8/0x8
[ 1330.285064]  perf_ftrace_function_call+0x209/0x360
[ 1330.286031]  ? 0xffffffffa0098099
[ 1330.286703]  0xffffffffa0098099
[ 1330.287247]  ? devm_counter_match+0x60/0x60
[ 1330.287925]  ? ftrace_call+0x5/0x44
[ 1330.288508]  ? pmd_page_vaddr+0x2b/0x70
[ 1330.289151]  ? _raw_spin_lock+0x5/0x50
[ 1330.289797]  _raw_spin_lock+0x5/0x50
[ 1330.290382]  __get_locked_pte+0x1a2/0x290
[ 1330.291012]  ? _raw_spin_lock+0x5/0x50
[ 1330.291597]  ? __get_locked_pte+0x1a2/0x290
[ 1330.292275]  ? devm_counter_match+0x60/0x60
[ 1330.292952]  __text_poke+0xea/0x4e0
[ 1330.293522]  ? devm_counter_match+0x60/0x60
[ 1330.294209]  ? lock_is_held_type+0xe2/0x140
[ 1330.294877]  ? devm_counter_match+0x60/0x60
[ 1330.295578]  text_poke+0x2b/0x60
[ 1330.296139]  text_poke_bp_batch+0x1dc/0x2c0
[ 1330.296841]  ? sockfs_dname+0x40/0x40
[ 1330.297474]  text_poke_queue+0xa7/0xc0
[ 1330.298126]  ftrace_replace_code+0xfd/0x170
[ 1330.298842]  ftrace_modify_all_code+0x1b1/0x270
[ 1330.299593]  arch_ftrace_update_code+0x9/0x10
[ 1330.300271]  ftrace_run_update_code+0x30/0xa0
[ 1330.300978]  ftrace_startup_enable+0x5e/0xa0
[ 1330.301668]  ftrace_startup+0x16d/0x240
[ 1330.302375]  register_ftrace_function+0x43/0x90
[ 1330.303107]  perf_ftrace_event_register+0xc1/0xf0
[ 1330.303859]  perf_trace_event_init+0xa0/0x4c0
[ 1330.304600]  perf_trace_init+0xda/0x160
[ 1330.305258]  perf_tp_event_init+0x57/0xa0
[ 1330.305914]  perf_try_init_event+0x83/0x270
[ 1330.306659]  perf_event_alloc+0xe3f/0x1c10
[ 1330.307292]  ? _raw_spin_unlock+0x2c/0x50
[ 1330.307937]  ? alloc_fd+0x20d/0x320
[ 1330.308616]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1330.309377]  ? write_comp_data+0x2f/0x90
[ 1330.310387]  __x64_sys_perf_event_open+0x26/0x30
[ 1330.311113]  do_syscall_64+0x37/0x80
[ 1330.311699]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1330.312463] RIP: 0033:0x7fac0740459d
[ 1330.313030] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1330.315630] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1330.316740] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1330.317768] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1330.318806] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1330.319834] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1330.320863] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1330.322156] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1330.322323] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1330.323277] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1330.324386] caller is debug_smp_processor_id+0x1c/0x20
[ 1330.325902] Call Trace:
[ 1330.327017]  dump_stack_lvl+0xa4/0xd3
[ 1330.327597]  dump_stack+0x15/0x17
[ 1330.328104]  check_preemption_disabled+0x167/0x180
[ 1330.328805]  ? ep_start_scan+0x68/0x100
[ 1330.329379]  ? _raw_read_lock_irq+0xa0/0xa0
[ 1330.330018]  debug_smp_processor_id+0x1c/0x20
[ 1330.330674]  perf_ftrace_function_call+0x7c/0x360
[ 1330.331362]  ? ftrace_ops_test+0x71/0xc0
[ 1330.331954]  ? preempt_notifier_dec+0x20/0x20
[ 1330.332650]  ? ftrace_call+0x5/0x44
[ 1330.333214]  ? write_comp_data+0x2f/0x90
[ 1330.333808]  ? perf_trace_buf_update+0x70/0x70
[ 1330.334470]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1330.335223]  0xffffffffa0098099
[ 1330.335747]  ? ftrace_call+0x5/0x44
[ 1330.336274]  ? __mutex_lock+0xfe/0x9f0
[ 1330.336835]  ? do_epoll_wait+0x3b3/0xd80
[ 1330.337421]  ? ep_start_scan+0xe0/0x100
[ 1330.338022]  ? _raw_write_lock_irq+0x5/0x60
[ 1330.338654]  ? write_comp_data+0x2f/0x90
[ 1330.339261]  _raw_write_lock_irq+0x5/0x60
[ 1330.339858]  ep_start_scan+0x68/0x100
[ 1330.340410]  ? _raw_write_lock_irq+0x5/0x60
[ 1330.341020]  ? ep_start_scan+0x68/0x100
[ 1330.341631]  do_epoll_wait+0x3bf/0xd80
[ 1330.342363]  ? wait_woken+0x90/0x90
[ 1330.342966]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1330.343651]  do_syscall_64+0x37/0x80
[ 1330.344201]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1330.344923] RIP: 0033:0x7f8a39143b20
[ 1330.345457] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1330.347958] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1330.349016] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1330.349996] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1330.350984] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1330.351968] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1330.352949] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1330.354133] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1330.354258] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1330.355221] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1330.356357] caller is debug_smp_processor_id+0x1c/0x20
[ 1330.357943] Call Trace:
[ 1330.359052]  dump_stack_lvl+0xa4/0xd3
[ 1330.359674]  dump_stack+0x15/0x17
[ 1330.360211]  check_preemption_disabled+0x167/0x180
[ 1330.361012]  debug_smp_processor_id+0x1c/0x20
[ 1330.361693]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1330.362546]  perf_tp_event+0x331/0x4e0
[ 1330.363477]  ? arch_local_irq_enable+0x10/0x12
[ 1330.364180]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1330.364930]  ? dump_stack_lvl+0xcc/0xd3
[ 1330.365575]  ? dump_stack+0x15/0x17
[ 1330.366143]  ? check_preemption_disabled+0x167/0x180
[ 1330.366967]  ? __get_locked_pte+0x1a2/0x290
[ 1330.367610]  ? __lock_text_start+0x8/0x8
[ 1330.368254]  perf_ftrace_function_call+0x248/0x360
[ 1330.368983]  ? perf_ftrace_function_call+0x248/0x360
[ 1330.369999]  ? 0xffffffffa0098099
[ 1330.370667]  0xffffffffa0098099
[ 1330.371211]  ? devm_counter_match+0x60/0x60
[ 1330.371893]  ? ftrace_call+0x5/0x44
[ 1330.372477]  ? pmd_page_vaddr+0x2b/0x70
[ 1330.373121]  ? _raw_spin_lock+0x5/0x50
[ 1330.373766]  _raw_spin_lock+0x5/0x50
[ 1330.374342]  __get_locked_pte+0x1a2/0x290
[ 1330.374973]  ? _raw_spin_lock+0x5/0x50
[ 1330.375557]  ? __get_locked_pte+0x1a2/0x290
[ 1330.376234]  ? devm_counter_match+0x60/0x60
[ 1330.376911]  __text_poke+0xea/0x4e0
[ 1330.377472]  ? devm_counter_match+0x60/0x60
[ 1330.378151]  ? lock_is_held_type+0xe2/0x140
[ 1330.378818]  ? devm_counter_match+0x60/0x60
[ 1330.379520]  text_poke+0x2b/0x60
[ 1330.380084]  text_poke_bp_batch+0x1dc/0x2c0
[ 1330.380785]  ? sockfs_dname+0x40/0x40
[ 1330.381417]  text_poke_queue+0xa7/0xc0
[ 1330.382068]  ftrace_replace_code+0xfd/0x170
[ 1330.382784]  ftrace_modify_all_code+0x1b1/0x270
[ 1330.383531]  arch_ftrace_update_code+0x9/0x10
[ 1330.384210]  ftrace_run_update_code+0x30/0xa0
[ 1330.384914]  ftrace_startup_enable+0x5e/0xa0
[ 1330.385605]  ftrace_startup+0x16d/0x240
[ 1330.386301]  register_ftrace_function+0x43/0x90
[ 1330.387026]  perf_ftrace_event_register+0xc1/0xf0
[ 1330.387781]  perf_trace_event_init+0xa0/0x4c0
[ 1330.388521]  perf_trace_init+0xda/0x160
[ 1330.389179]  perf_tp_event_init+0x57/0xa0
[ 1330.389836]  perf_try_init_event+0x83/0x270
[ 1330.390569]  perf_event_alloc+0xe3f/0x1c10
[ 1330.391203]  ? _raw_spin_unlock+0x2c/0x50
[ 1330.391849]  ? alloc_fd+0x20d/0x320
[ 1330.392529]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1330.393292]  ? write_comp_data+0x2f/0x90
[ 1330.394300]  __x64_sys_perf_event_open+0x26/0x30
[ 1330.395027]  do_syscall_64+0x37/0x80
[ 1330.395614]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1330.396378] RIP: 0033:0x7fac0740459d
[ 1330.396945] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1330.399547] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1330.400665] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1330.401702] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1330.402736] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1330.403762] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1330.404793] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1330.406079] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1330.406271] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1330.407205] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1330.408382] caller is debug_smp_processor_id+0x1c/0x20
[ 1330.409957] Call Trace:
[ 1330.409987]  dump_stack_lvl+0xa4/0xd3
[ 1330.410057]  dump_stack+0x15/0x17
[ 1330.410096]  check_preemption_disabled+0x167/0x180
[ 1330.410137]  ? ep_done_scan+0x3b/0x240
[ 1330.413526]  ? _raw_read_lock_irq+0xa0/0xa0
[ 1330.414200]  debug_smp_processor_id+0x1c/0x20
[ 1330.414867]  perf_ftrace_function_call+0x7c/0x360
[ 1330.415581]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1330.416312]  ? ftrace_ops_test+0x71/0xc0
[ 1330.416954]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1330.417684]  ? _prb_read_valid+0x3ad/0x3f0
[ 1330.418400]  ? write_comp_data+0x2f/0x90
[ 1330.419083]  0xffffffffa0098099
[ 1330.419586]  ? ep_destroy_wakeup_source+0xe0/0xe0
[ 1330.420393]  ? do_epoll_wait+0x85a/0xd80
[ 1330.421036]  ? _raw_write_lock_irq+0x5/0x60
[ 1330.421735]  _raw_write_lock_irq+0x5/0x60
[ 1330.422363]  ep_done_scan+0x3b/0x240
[ 1330.422922]  ? _raw_write_lock_irq+0x5/0x60
[ 1330.423553]  ? ep_done_scan+0x3b/0x240
[ 1330.424233]  do_epoll_wait+0xabb/0xd80
[ 1330.424976]  ? wait_woken+0x90/0x90
[ 1330.425596]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1330.426327]  do_syscall_64+0x37/0x80
[ 1330.426933]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1330.427706] RIP: 0033:0x7f8a39143b20
[ 1330.428259] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1330.430855] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1330.431958] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1330.432977] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1330.433996] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1330.435024] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1330.436043] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1330.437260] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1330.437382] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1330.438447] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1330.438485] Call Trace:
[ 1330.438537]  dump_stack_lvl+0xa4/0xd3
[ 1330.439694] caller is debug_smp_processor_id+0x1c/0x20
[ 1330.441467]  dump_stack+0x15/0x17
[ 1330.443686]  check_preemption_disabled+0x167/0x180
[ 1330.444499]  ? __get_locked_pte+0x1a2/0x290
[ 1330.445202]  ? __lock_text_start+0x8/0x8
[ 1330.445921]  debug_smp_processor_id+0x1c/0x20
[ 1330.446678]  perf_ftrace_function_call+0x7c/0x360
[ 1330.447768]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1330.448558]  ? write_comp_data+0x2f/0x90
[ 1330.449259]  ? perf_trace_buf_update+0x70/0x70
[ 1330.450150]  0xffffffffa0098099
[ 1330.450768]  ? counter_name_attribute_create.part.9+0xe0/0xe0
[ 1330.451750]  ? ftrace_call+0x5/0x44
[ 1330.452405]  ? pmd_page_vaddr+0x2b/0x70
[ 1330.453127]  ? _raw_spin_lock+0x5/0x50
[ 1330.453857]  _raw_spin_lock+0x5/0x50
[ 1330.454497]  __get_locked_pte+0x1a2/0x290
[ 1330.455195]  ? _raw_spin_lock+0x5/0x50
[ 1330.455835]  ? __get_locked_pte+0x1a2/0x290
[ 1330.456590]  ? counter_name_attribute_create.part.9+0xe0/0xe0
[ 1330.457573]  __text_poke+0xea/0x4e0
[ 1330.458200]  ? counter_name_attribute_create.part.9+0xe0/0xe0
[ 1330.459180]  ? lock_is_held_type+0xe2/0x140
[ 1330.459920]  ? counter_name_attribute_create.part.9+0xe0/0xe0
[ 1330.460937]  text_poke+0x2b/0x60
[ 1330.461573]  text_poke_bp_batch+0x1dc/0x2c0
[ 1330.462369]  ? sockfs_dname+0x40/0x40
[ 1330.463085]  text_poke_queue+0xa7/0xc0
[ 1330.463816]  ftrace_replace_code+0xfd/0x170
[ 1330.464624]  ftrace_modify_all_code+0x1b1/0x270
[ 1330.465466]  arch_ftrace_update_code+0x9/0x10
[ 1330.466216]  ftrace_run_update_code+0x30/0xa0
[ 1330.466996]  ftrace_startup_enable+0x5e/0xa0
[ 1330.467767]  ftrace_startup+0x16d/0x240
[ 1330.468562]  register_ftrace_function+0x43/0x90
[ 1330.469369]  perf_ftrace_event_register+0xc1/0xf0
[ 1330.470219]  perf_trace_event_init+0xa0/0x4c0
[ 1330.471059]  perf_trace_init+0xda/0x160
[ 1330.471805]  perf_tp_event_init+0x57/0xa0
[ 1330.472538]  perf_try_init_event+0x83/0x270
[ 1330.473368]  perf_event_alloc+0xe3f/0x1c10
[ 1330.474065]  ? _raw_spin_unlock+0x2c/0x50
[ 1330.474779]  ? alloc_fd+0x20d/0x320
[ 1330.475574]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1330.476418]  ? write_comp_data+0x2f/0x90
[ 1330.477665]  __x64_sys_perf_event_open+0x26/0x30
[ 1330.478471]  do_syscall_64+0x37/0x80
[ 1330.479123]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1330.479957] RIP: 0033:0x7fac0740459d
[ 1330.480584] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1330.483392] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1330.484605] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1330.485719] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1330.486839] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1330.487952] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1330.489064] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1330.490554] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1330.491723] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1330.493325] Call Trace:
[ 1330.493720]  dump_stack_lvl+0xa4/0xd3
[ 1330.494332]  dump_stack+0x15/0x17
[ 1330.494855]  check_preemption_disabled+0x167/0x180
[ 1330.495578]  ? do_epoll_wait+0xac3/0xd80
[ 1330.496174]  ? __mutex_unlock_slowpath+0x2e0/0x2e0
[ 1330.496914]  debug_smp_processor_id+0x1c/0x20
[ 1330.497580]  perf_ftrace_function_call+0x7c/0x360
[ 1330.498320]  ? perf_trace_buf_update+0x70/0x70
[ 1330.498997]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1330.499726]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1330.500403]  ? _raw_write_unlock_irq+0x38/0x50
[ 1330.501081]  ? preempt_notifier_dec+0x20/0x20
[ 1330.501800]  ? ftrace_call+0x5/0x44
[ 1330.502348]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1330.503144]  0xffffffffa0098099
[ 1330.503666]  ? preempt_count_sub+0x5/0xa0
[ 1330.504381]  ? mutex_unlock+0x5/0x20
[ 1330.504975]  mutex_unlock+0x5/0x20
[ 1330.505509]  do_epoll_wait+0xac3/0xd80
[ 1330.506094]  ? mutex_unlock+0x5/0x20
[ 1330.506641]  ? do_epoll_wait+0xac3/0xd80
[ 1330.507403]  ? wait_woken+0x90/0x90
[ 1330.508022]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1330.508728]  do_syscall_64+0x37/0x80
[ 1330.509294]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1330.510045] RIP: 0033:0x7f8a39143b20
[ 1330.510602] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1330.513190] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1330.514293] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1330.515312] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1330.516332] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1330.517351] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1330.518372] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1335.110060] check_preemption_disabled: 950062 callbacks suppressed
[ 1335.110082] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1335.110157] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1335.110952] caller is debug_smp_processor_id+0x1c/0x20
[ 1335.111913] caller is debug_smp_processor_id+0x1c/0x20
[ 1335.112936] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1335.115182] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1335.116593] Call Trace:
[ 1335.116929]  dump_stack_lvl+0xa4/0xd3
[ 1335.117433]  dump_stack+0x15/0x17
[ 1335.117876]  check_preemption_disabled+0x167/0x180
[ 1335.118532]  debug_smp_processor_id+0x1c/0x20
[ 1335.119100]  perf_trace_buf_alloc+0x98/0x100
[ 1335.119660]  ? __text_poke+0xea/0x4e0
[ 1335.120140]  ? __pmd_alloc+0x420/0x420
[ 1335.120642]  perf_ftrace_function_call+0x209/0x360
[ 1335.121358]  ? 0xffffffffa0098099
[ 1335.121834]  ? xfs_bnobt_keys_inorder+0x40/0x40
[ 1335.122457]  0xffffffffa0098099
[ 1335.122886]  ? 0xffffffffa0098099
[ 1335.123389]  ? __get_locked_pte+0x5/0x290
[ 1335.123935]  __get_locked_pte+0x5/0x290
[ 1335.124440]  __text_poke+0xea/0x4e0
[ 1335.124903]  ? __get_locked_pte+0x5/0x290
[ 1335.125421]  ? __text_poke+0xea/0x4e0
[ 1335.125905]  ? xfs_bnobt_keys_inorder+0x40/0x40
[ 1335.126528]  ? lock_is_held_type+0xe2/0x140
[ 1335.127079]  ? xfs_bnobt_keys_inorder+0x40/0x40
[ 1335.127684]  text_poke+0x2b/0x60
[ 1335.128132]  text_poke_bp_batch+0x93/0x2c0
[ 1335.128688]  ? xfs_bmbt_disk_set_all+0x80/0x80
[ 1335.129287]  text_poke_queue+0xa7/0xc0
[ 1335.129804]  ftrace_replace_code+0xfd/0x170
[ 1335.130383]  ftrace_modify_all_code+0x1b1/0x270
[ 1335.130989]  arch_ftrace_update_code+0x9/0x10
[ 1335.131555]  ftrace_run_update_code+0x30/0xa0
[ 1335.132130]  ftrace_shutdown+0x2b8/0x4a0
[ 1335.132675]  unregister_ftrace_function+0x25/0x50
[ 1335.133285]  perf_ftrace_event_register+0x89/0xf0
[ 1335.133893]  ? perf_tp_event_init+0xa0/0xa0
[ 1335.134448]  perf_trace_destroy+0x37/0x60
[ 1335.134980]  tp_perf_event_destroy+0x15/0x20
[ 1335.135541]  _free_event+0xfc/0x7d0
[ 1335.136034]  put_event+0x37/0x50
[ 1335.136477]  perf_event_release_kernel+0x2f4/0x370
[ 1335.137127]  ? perf_event_release_kernel+0x370/0x370
[ 1335.137773]  perf_release+0x19/0x20
[ 1335.138251]  __fput+0x12d/0x460
[ 1335.138720]  ____fput+0x1a/0x20
[ 1335.139148]  task_work_run+0x8e/0xf0
[ 1335.139649]  do_exit+0x616/0x1310
[ 1335.140119]  ? write_comp_data+0x2f/0x90
[ 1335.140669]  do_group_exit+0x7e/0x130
[ 1335.141186]  get_signal+0x249/0x13c0
[ 1335.141679]  ? get_signal+0x5/0x13c0
[ 1335.142206]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1335.142870]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1335.143537]  exit_to_user_mode_prepare+0x154/0x240
[ 1335.144230]  syscall_exit_to_user_mode+0x2b/0x60
[ 1335.144901]  do_syscall_64+0x46/0x80
[ 1335.145432]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1335.146152] RIP: 0033:0x7fac0740459d
[ 1335.146672] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1335.147564] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1335.148607] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1335.149580] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1335.150558] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1335.151528] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1335.152499] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1335.153582] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1335.153700] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1335.154583] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1335.154596] Call Trace:
[ 1335.154605]  dump_stack_lvl+0xa4/0xd3
[ 1335.154628]  dump_stack+0x15/0x17
[ 1335.154643]  check_preemption_disabled+0x167/0x180
[ 1335.154661]  ? schedule_timeout+0x34e/0x610
[ 1335.155721] caller is debug_smp_processor_id+0x1c/0x20
[ 1335.157150]  ? do_init_timer+0xa0/0xa0
[ 1335.160694]  debug_smp_processor_id+0x1c/0x20
[ 1335.161272]  perf_ftrace_function_call+0x7c/0x360
[ 1335.161900]  ? 0xffffffffa0098099
[ 1335.162350]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1335.162986]  ? finish_task_switch+0xab/0x2a0
[ 1335.163552]  ? __schedule+0x46e/0xb20
[ 1335.164060]  0xffffffffa0098099
[ 1335.164486]  ? finish_task_switch+0xb0/0x2a0
[ 1335.165069]  ? del_timer_sync+0x5/0x130
[ 1335.165589]  del_timer_sync+0x5/0x130
[ 1335.166083]  schedule_timeout+0x34e/0x610
[ 1335.166619]  ? del_timer_sync+0x5/0x130
[ 1335.167131]  ? schedule_timeout+0x34e/0x610
[ 1335.167696]  ? del_timer_sync+0x130/0x130
[ 1335.168236]  ? i915_init_ggtt+0x40/0x6b0
[ 1335.168774]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1335.169307]  ? rcu_gp_init+0x730/0x730
[ 1335.169808]  rcu_gp_kthread+0xdd/0x170
[ 1335.170319]  kthread+0x1e7/0x230
[ 1335.170760]  ? set_kthread_struct+0x80/0x80
[ 1335.171322]  ret_from_fork+0x1f/0x30
[ 1335.171837] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1335.171884] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1335.172864] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1335.173885] caller is debug_smp_processor_id+0x1c/0x20
[ 1335.175412] Call Trace:
[ 1335.175432]  dump_stack_lvl+0xa4/0xd3
[ 1335.176970]  dump_stack+0x15/0x17
[ 1335.177462]  check_preemption_disabled+0x167/0x180
[ 1335.178178]  debug_smp_processor_id+0x1c/0x20
[ 1335.178806]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1335.179579]  perf_tp_event+0x331/0x4e0
[ 1335.180204]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1335.181035]  ? arch_local_irq_enable+0x10/0x12
[ 1335.181678]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1335.182365]  ? dump_stack_lvl+0xcc/0xd3
[ 1335.182941]  ? dump_stack+0x15/0x17
[ 1335.183469]  ? __text_poke+0xea/0x4e0
[ 1335.183998]  ? __pmd_alloc+0x420/0x420
[ 1335.184556]  perf_ftrace_function_call+0x248/0x360
[ 1335.185236]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1335.185871]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1335.186549]  ? perf_ftrace_function_call+0x248/0x360
[ 1335.187369]  ? 0xffffffffa0098099
[ 1335.187893]  ? xfs_bnobt_keys_inorder+0x40/0x40
[ 1335.188555]  0xffffffffa0098099
[ 1335.189030]  ? 0xffffffffa0098099
[ 1335.189585]  ? __get_locked_pte+0x5/0x290
[ 1335.190193]  __get_locked_pte+0x5/0x290
[ 1335.190753]  __text_poke+0xea/0x4e0
[ 1335.191273]  ? __get_locked_pte+0x5/0x290
[ 1335.191849]  ? __text_poke+0xea/0x4e0
[ 1335.192386]  ? xfs_bnobt_keys_inorder+0x40/0x40
[ 1335.193048]  ? lock_is_held_type+0xe2/0x140
[ 1335.193659]  ? xfs_bnobt_keys_inorder+0x40/0x40
[ 1335.194335]  text_poke+0x2b/0x60
[ 1335.194831]  text_poke_bp_batch+0x93/0x2c0
[ 1335.195445]  ? xfs_bmbt_disk_set_all+0x80/0x80
[ 1335.196102]  text_poke_queue+0xa7/0xc0
[ 1335.196672]  ftrace_replace_code+0xfd/0x170
[ 1335.197301]  ftrace_modify_all_code+0x1b1/0x270
[ 1335.197973]  arch_ftrace_update_code+0x9/0x10
[ 1335.198603]  ftrace_run_update_code+0x30/0xa0
[ 1335.199242]  ftrace_shutdown+0x2b8/0x4a0
[ 1335.199845]  unregister_ftrace_function+0x25/0x50
[ 1335.200522]  perf_ftrace_event_register+0x89/0xf0
[ 1335.201196]  ? perf_tp_event_init+0xa0/0xa0
[ 1335.201800]  perf_trace_destroy+0x37/0x60
[ 1335.202396]  tp_perf_event_destroy+0x15/0x20
[ 1335.203017]  _free_event+0xfc/0x7d0
[ 1335.203556]  put_event+0x37/0x50
[ 1335.204045]  perf_event_release_kernel+0x2f4/0x370
[ 1335.204761]  ? perf_event_release_kernel+0x370/0x370
[ 1335.205479]  perf_release+0x19/0x20
[ 1335.205997]  __fput+0x12d/0x460
[ 1335.206520]  ____fput+0x1a/0x20
[ 1335.206994]  task_work_run+0x8e/0xf0
[ 1335.207551]  do_exit+0x616/0x1310
[ 1335.208071]  ? write_comp_data+0x2f/0x90
[ 1335.208679]  do_group_exit+0x7e/0x130
[ 1335.209243]  get_signal+0x249/0x13c0
[ 1335.209788]  ? get_signal+0x5/0x13c0
[ 1335.210368]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1335.211099]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1335.211831]  exit_to_user_mode_prepare+0x154/0x240
[ 1335.212525]  syscall_exit_to_user_mode+0x2b/0x60
[ 1335.213193]  do_syscall_64+0x46/0x80
[ 1335.213723]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1335.214444] RIP: 0033:0x7fac0740459d
[ 1335.214965] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1335.215854] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1335.216900] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1335.217875] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1335.218859] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1335.219833] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1335.220807] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1335.221894] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1335.222083] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1335.222901] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1335.224033] caller is debug_smp_processor_id+0x1c/0x20
[ 1335.225479] Call Trace:
[ 1335.225487]  dump_stack_lvl+0xa4/0xd3
[ 1335.227052]  dump_stack+0x15/0x17
[ 1335.227500]  check_preemption_disabled+0x167/0x180
[ 1335.228135]  ? del_timer_sync+0xd3/0x130
[ 1335.228658]  ? detach_if_pending+0x270/0x270
[ 1335.229228]  debug_smp_processor_id+0x1c/0x20
[ 1335.229810]  perf_ftrace_function_call+0x7c/0x360
[ 1335.230435]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1335.231063]  ? register_lock_class+0x42/0x440
[ 1335.231646]  ? del_timer_sync+0x40/0x130
[ 1335.232174]  ? 0xffffffffa0098099
[ 1335.232623]  ? 0xffffffffa0098099
[ 1335.233071]  ? 0xffffffffa0098099
[ 1335.233530]  0xffffffffa0098099
[ 1335.233954]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1335.234592]  ? del_timer_sync+0xa5/0x130
[ 1335.235122]  ? try_to_del_timer_sync+0x5/0x90
[ 1335.235701]  ? write_comp_data+0x2f/0x90
[ 1335.236228]  try_to_del_timer_sync+0x5/0x90
[ 1335.236786]  del_timer_sync+0xd3/0x130
[ 1335.237294]  ? try_to_del_timer_sync+0x5/0x90
[ 1335.237870]  ? del_timer_sync+0xd3/0x130
[ 1335.238403]  schedule_timeout+0x34e/0x610
[ 1335.238949]  ? del_timer_sync+0x130/0x130
[ 1335.239491]  ? i915_init_ggtt+0x40/0x6b0
[ 1335.240027]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1335.240562]  ? rcu_gp_init+0x730/0x730
[ 1335.241064]  rcu_gp_kthread+0xdd/0x170
[ 1335.241575]  kthread+0x1e7/0x230
[ 1335.242015]  ? set_kthread_struct+0x80/0x80
[ 1335.242584]  ret_from_fork+0x1f/0x30
[ 1335.243103] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1335.243130] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1335.244213] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1335.245231] caller is debug_smp_processor_id+0x1c/0x20
[ 1335.246874] Call Trace:
[ 1335.246908]  dump_stack_lvl+0xa4/0xd3
[ 1335.248527]  dump_stack+0x15/0x17
[ 1335.249075]  check_preemption_disabled+0x167/0x180
[ 1335.249832]  ? _raw_spin_lock+0x17/0x50
[ 1335.250458]  ? trace_sched_waking+0xc0/0xc0
[ 1335.251151]  debug_smp_processor_id+0x1c/0x20
[ 1335.251849]  perf_ftrace_function_call+0x7c/0x360
[ 1335.252711]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1335.253441]  ? write_comp_data+0x2f/0x90
[ 1335.254090]  ? perf_trace_buf_update+0x70/0x70
[ 1335.254798]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1335.255562]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1335.256348]  0xffffffffa0098099
[ 1335.256892]  ? ftrace_call+0x5/0x44
[ 1335.257487]  ? xfs_bnobt_keys_inorder+0x40/0x40
[ 1335.258264]  ? pmd_page_vaddr+0x2b/0x70
[ 1335.258917]  ? preempt_count_add+0x5/0xc0
[ 1335.259607]  preempt_count_add+0x5/0xc0
[ 1335.260230]  _raw_spin_lock+0x17/0x50
[ 1335.260829]  ? preempt_count_add+0x5/0xc0
[ 1335.261465]  ? _raw_spin_lock+0x17/0x50
[ 1335.262107]  __get_locked_pte+0x1a2/0x290
[ 1335.262778]  ? xfs_bnobt_keys_inorder+0x40/0x40
[ 1335.263521]  __text_poke+0xea/0x4e0
[ 1335.264095]  ? xfs_bnobt_keys_inorder+0x40/0x40
[ 1335.264835]  ? lock_is_held_type+0xe2/0x140
[ 1335.265520]  ? xfs_bnobt_keys_inorder+0x40/0x40
[ 1335.266295]  text_poke+0x2b/0x60
[ 1335.266865]  text_poke_bp_batch+0x93/0x2c0
[ 1335.267567]  ? xfs_bmbt_disk_set_all+0x80/0x80
[ 1335.268315]  text_poke_queue+0xa7/0xc0
[ 1335.268971]  ftrace_replace_code+0xfd/0x170
[ 1335.269696]  ftrace_modify_all_code+0x1b1/0x270
[ 1335.270465]  arch_ftrace_update_code+0x9/0x10
[ 1335.271164]  ftrace_run_update_code+0x30/0xa0
[ 1335.271881]  ftrace_shutdown+0x2b8/0x4a0
[ 1335.272579]  unregister_ftrace_function+0x25/0x50
[ 1335.273336]  perf_ftrace_event_register+0x89/0xf0
[ 1335.274088]  ? perf_tp_event_init+0xa0/0xa0
[ 1335.274758]  perf_trace_destroy+0x37/0x60
[ 1335.275417]  tp_perf_event_destroy+0x15/0x20
[ 1335.276112]  _free_event+0xfc/0x7d0
[ 1335.276737]  put_event+0x37/0x50
[ 1335.277295]  perf_event_release_kernel+0x2f4/0x370
[ 1335.278120]  ? perf_event_release_kernel+0x370/0x370
[ 1335.278920]  perf_release+0x19/0x20
[ 1335.279504]  __fput+0x12d/0x460
[ 1335.280127]  ____fput+0x1a/0x20
[ 1335.280664]  task_work_run+0x8e/0xf0
[ 1335.281305]  do_exit+0x616/0x1310
[ 1335.281915]  ? write_comp_data+0x2f/0x90
[ 1335.282633]  do_group_exit+0x7e/0x130
[ 1335.283286]  get_signal+0x249/0x13c0
[ 1335.283913]  ? get_signal+0x5/0x13c0
[ 1335.284593]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1335.285456]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1335.286312]  exit_to_user_mode_prepare+0x154/0x240
[ 1335.287088]  syscall_exit_to_user_mode+0x2b/0x60
[ 1335.287832]  do_syscall_64+0x46/0x80
[ 1335.288427]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1335.289211] RIP: 0033:0x7fac0740459d
[ 1335.289790] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1335.290769] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1335.291908] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1335.292964] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1335.294028] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1335.295099] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1335.296156] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1335.297468] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1335.297584] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1335.298494] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1335.298506] Call Trace:
[ 1335.298515]  dump_stack_lvl+0xa4/0xd3
[ 1335.298537]  dump_stack+0x15/0x17
[ 1335.298552]  check_preemption_disabled+0x167/0x180
[ 1335.298570]  ? try_to_del_timer_sync+0x33/0x90
[ 1335.298587]  ? calc_wheel_index+0x2d0/0x2d0
[ 1335.299722] caller is debug_smp_processor_id+0x1c/0x20
[ 1335.301163]  debug_smp_processor_id+0x1c/0x20
[ 1335.305445]  perf_ftrace_function_call+0x7c/0x360
[ 1335.306082]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1335.306712]  ? del_timer_sync+0xd3/0x130
[ 1335.307240]  ? perf_ftrace_function_call+0x4c/0x360
[ 1335.307884]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1335.308512]  ? register_lock_class+0x42/0x440
[ 1335.309097]  ? del_timer_sync+0x40/0x130
[ 1335.309624]  ? 0xffffffffa0098099
[ 1335.310079]  ? 0xffffffffa0098099
[ 1335.310544]  0xffffffffa0098099
[ 1335.310974]  ? 0xffffffffa0098099
[ 1335.311421]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1335.312046]  ? del_timer_sync+0xa5/0x130
[ 1335.312576]  ? lock_timer_base+0x5/0x100
[ 1335.313105]  lock_timer_base+0x5/0x100
[ 1335.313609]  try_to_del_timer_sync+0x33/0x90
[ 1335.314184]  ? lock_timer_base+0x5/0x100
[ 1335.314708]  ? try_to_del_timer_sync+0x33/0x90
[ 1335.315296]  ? try_to_del_timer_sync+0x5/0x90
[ 1335.315880]  del_timer_sync+0xd3/0x130
[ 1335.316389]  schedule_timeout+0x34e/0x610
[ 1335.316935]  ? del_timer_sync+0x130/0x130
[ 1335.317477]  ? i915_init_ggtt+0x40/0x6b0
[ 1335.318015]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1335.318566]  ? rcu_gp_init+0x730/0x730
[ 1335.319068]  rcu_gp_kthread+0xdd/0x170
[ 1335.319577]  kthread+0x1e7/0x230
[ 1335.320019]  ? set_kthread_struct+0x80/0x80
[ 1335.320583]  ret_from_fork+0x1f/0x30
[ 1335.321100] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1335.321142] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1335.322257] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1335.323293] caller is debug_smp_processor_id+0x1c/0x20
[ 1335.324928] Call Trace:
[ 1335.325988]  dump_stack_lvl+0xa4/0xd3
[ 1335.326626]  dump_stack+0x15/0x17
[ 1335.327176]  check_preemption_disabled+0x167/0x180
[ 1335.327987]  debug_smp_processor_id+0x1c/0x20
[ 1335.328685]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1335.329584]  perf_trace_buf_alloc+0x3d/0x100
[ 1335.330274]  ? _raw_spin_lock+0x17/0x50
[ 1335.330887]  ? trace_sched_waking+0xc0/0xc0
[ 1335.331569]  perf_ftrace_function_call+0x209/0x360
[ 1335.332536]  ? 0xffffffffa0098099
[ 1335.333200]  0xffffffffa0098099
[ 1335.333742]  ? ftrace_call+0x5/0x44
[ 1335.334341]  ? xfs_bnobt_keys_inorder+0x40/0x40
[ 1335.335092]  ? pmd_page_vaddr+0x2b/0x70
[ 1335.335746]  ? preempt_count_add+0x5/0xc0
[ 1335.336437]  preempt_count_add+0x5/0xc0
[ 1335.337060]  _raw_spin_lock+0x17/0x50
[ 1335.337660]  ? preempt_count_add+0x5/0xc0
[ 1335.338302]  ? _raw_spin_lock+0x17/0x50
[ 1335.338937]  __get_locked_pte+0x1a2/0x290
[ 1335.339614]  ? xfs_bnobt_keys_inorder+0x40/0x40
[ 1335.340355]  __text_poke+0xea/0x4e0
[ 1335.340929]  ? xfs_bnobt_keys_inorder+0x40/0x40
[ 1335.341671]  ? lock_is_held_type+0xe2/0x140
[ 1335.342361]  ? xfs_bnobt_keys_inorder+0x40/0x40
[ 1335.343125]  text_poke+0x2b/0x60
[ 1335.343696]  text_poke_bp_batch+0x93/0x2c0
[ 1335.344399]  ? xfs_bmbt_disk_set_all+0x80/0x80
[ 1335.345150]  text_poke_queue+0xa7/0xc0
[ 1335.345806]  ftrace_replace_code+0xfd/0x170
[ 1335.346536]  ftrace_modify_all_code+0x1b1/0x270
[ 1335.347298]  arch_ftrace_update_code+0x9/0x10
[ 1335.347993]  ftrace_run_update_code+0x30/0xa0
[ 1335.348710]  ftrace_shutdown+0x2b8/0x4a0
[ 1335.349411]  unregister_ftrace_function+0x25/0x50
[ 1335.350179]  perf_ftrace_event_register+0x89/0xf0
[ 1335.350925]  ? perf_tp_event_init+0xa0/0xa0
[ 1335.351596]  perf_trace_destroy+0x37/0x60
[ 1335.352255]  tp_perf_event_destroy+0x15/0x20
[ 1335.352949]  _free_event+0xfc/0x7d0
[ 1335.353577]  put_event+0x37/0x50
[ 1335.354139]  perf_event_release_kernel+0x2f4/0x370
[ 1335.354962]  ? perf_event_release_kernel+0x370/0x370
[ 1335.355763]  perf_release+0x19/0x20
[ 1335.356348]  __fput+0x12d/0x460
[ 1335.356972]  ____fput+0x1a/0x20
[ 1335.357509]  task_work_run+0x8e/0xf0
[ 1335.358154]  do_exit+0x616/0x1310
[ 1335.358759]  ? write_comp_data+0x2f/0x90
[ 1335.359469]  do_group_exit+0x7e/0x130
[ 1335.360123]  get_signal+0x249/0x13c0
[ 1335.360752]  ? get_signal+0x5/0x13c0
[ 1335.361435]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1335.362300]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1335.363152]  exit_to_user_mode_prepare+0x154/0x240
[ 1335.363930]  syscall_exit_to_user_mode+0x2b/0x60
[ 1335.364674]  do_syscall_64+0x46/0x80
[ 1335.365270]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1335.366058] RIP: 0033:0x7fac0740459d
[ 1335.366639] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1335.367611] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1335.368759] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1335.369818] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1335.370879] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1335.371938] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1335.372994] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1335.374285] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1335.374394] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1335.375281] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1335.376334] caller is debug_smp_processor_id+0x1c/0x20
[ 1335.377766] Call Trace:
[ 1335.378807]  dump_stack_lvl+0xa4/0xd3
[ 1335.379307]  dump_stack+0x15/0x17
[ 1335.379758]  check_preemption_disabled+0x167/0x180
[ 1335.380394]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1335.380940]  ? prepare_to_swait_exclusive+0x90/0x90
[ 1335.381589]  debug_smp_processor_id+0x1c/0x20
[ 1335.382174]  perf_ftrace_function_call+0x7c/0x360
[ 1335.382805]  ? trace_hardirqs_on+0x3f/0x170
[ 1335.383369]  ? preempt_count_sub+0x5/0xa0
[ 1335.383911]  ? preempt_count_sub+0x5/0xa0
[ 1335.384448]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1335.385107]  ? write_comp_data+0x2f/0x90
[ 1335.385643]  0xffffffffa0098099
[ 1335.386070]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1335.386707]  ? del_timer_sync+0xde/0x130
[ 1335.387236]  ? prepare_to_swait_event+0x5/0xf0
[ 1335.387826]  ? i915_init_ggtt+0x40/0x6b0
[ 1335.388355]  prepare_to_swait_event+0x5/0xf0
[ 1335.388922]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1335.389446]  ? prepare_to_swait_event+0x5/0xf0
[ 1335.390033]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1335.390593]  ? rcu_gp_init+0x730/0x730
[ 1335.391097]  rcu_gp_kthread+0xdd/0x170
[ 1335.391607]  kthread+0x1e7/0x230
[ 1335.392049]  ? set_kthread_struct+0x80/0x80
[ 1335.392613]  ret_from_fork+0x1f/0x30
[ 1335.393129] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1335.393162] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1335.394160] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1335.394178] Call Trace:
[ 1335.395195] caller is debug_smp_processor_id+0x1c/0x20
[ 1335.396723]  dump_stack_lvl+0xa4/0xd3
[ 1335.398275]  dump_stack+0x15/0x17
[ 1335.398766]  check_preemption_disabled+0x167/0x180
[ 1335.399478]  debug_smp_processor_id+0x1c/0x20
[ 1335.400107]  perf_trace_buf_alloc+0x98/0x100
[ 1335.400725]  ? _raw_spin_lock+0x17/0x50
[ 1335.401280]  ? trace_sched_waking+0xc0/0xc0
[ 1335.401888]  perf_ftrace_function_call+0x209/0x360
[ 1335.402679]  ? 0xffffffffa0098099
[ 1335.403224]  0xffffffffa0098099
[ 1335.403698]  ? ftrace_call+0x5/0x44
[ 1335.404222]  ? xfs_bnobt_keys_inorder+0x40/0x40
[ 1335.404893]  ? pmd_page_vaddr+0x2b/0x70
[ 1335.405458]  ? preempt_count_add+0x5/0xc0
[ 1335.406063]  preempt_count_add+0x5/0xc0
[ 1335.406623]  _raw_spin_lock+0x17/0x50
[ 1335.407161]  ? preempt_count_add+0x5/0xc0
[ 1335.407741]  ? _raw_spin_lock+0x17/0x50
[ 1335.408308]  __get_locked_pte+0x1a2/0x290
[ 1335.408900]  ? xfs_bnobt_keys_inorder+0x40/0x40
[ 1335.409562]  __text_poke+0xea/0x4e0
[ 1335.410079]  ? xfs_bnobt_keys_inorder+0x40/0x40
[ 1335.410740]  ? lock_is_held_type+0xe2/0x140
[ 1335.411349]  ? xfs_bnobt_keys_inorder+0x40/0x40
[ 1335.412020]  text_poke+0x2b/0x60
[ 1335.412515]  text_poke_bp_batch+0x93/0x2c0
[ 1335.413131]  ? xfs_bmbt_disk_set_all+0x80/0x80
[ 1335.413790]  text_poke_queue+0xa7/0xc0
[ 1335.414521]  ftrace_replace_code+0xfd/0x170
[ 1335.415198]  ftrace_modify_all_code+0x1b1/0x270
[ 1335.415871]  arch_ftrace_update_code+0x9/0x10
[ 1335.416507]  ftrace_run_update_code+0x30/0xa0
[ 1335.417148]  ftrace_shutdown+0x2b8/0x4a0
[ 1335.417753]  unregister_ftrace_function+0x25/0x50
[ 1335.418485]  perf_ftrace_event_register+0x89/0xf0
[ 1335.419162]  ? perf_tp_event_init+0xa0/0xa0
[ 1335.419769]  perf_trace_destroy+0x37/0x60
[ 1335.420359]  tp_perf_event_destroy+0x15/0x20
[ 1335.420981]  _free_event+0xfc/0x7d0
[ 1335.421521]  put_event+0x37/0x50
[ 1335.422011]  perf_event_release_kernel+0x2f4/0x370
[ 1335.422732]  ? perf_event_release_kernel+0x370/0x370
[ 1335.423450]  perf_release+0x19/0x20
[ 1335.423969]  __fput+0x12d/0x460
[ 1335.424486]  ____fput+0x1a/0x20
[ 1335.424961]  task_work_run+0x8e/0xf0
[ 1335.425535]  do_exit+0x616/0x1310
[ 1335.426063]  ? write_comp_data+0x2f/0x90
[ 1335.426672]  do_group_exit+0x7e/0x130
[ 1335.427288]  get_signal+0x249/0x13c0
[ 1335.427892]  ? get_signal+0x5/0x13c0
[ 1335.428505]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1335.429322]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1335.430118]  exit_to_user_mode_prepare+0x154/0x240
[ 1335.430856]  syscall_exit_to_user_mode+0x2b/0x60
[ 1335.431582]  do_syscall_64+0x46/0x80
[ 1335.432147]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1335.432864] RIP: 0033:0x7fac0740459d
[ 1335.433386] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1335.434315] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1335.435436] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1335.436452] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1335.437445] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1335.438444] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1335.439418] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1335.440506] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1335.441524] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1335.443053] Call Trace:
[ 1335.443406]  dump_stack_lvl+0xa4/0xd3
[ 1335.443913]  dump_stack+0x15/0x17
[ 1335.444363]  check_preemption_disabled+0x167/0x180
[ 1335.445010]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1335.445557]  ? rcu_pm_notify+0x40/0x40
[ 1335.446066]  debug_smp_processor_id+0x1c/0x20
[ 1335.446655]  perf_ftrace_function_call+0x7c/0x360
[ 1335.447281]  ? prepare_to_swait_event+0xbb/0xf0
[ 1335.447890]  ? 0xffffffffa0098099
[ 1335.448338]  ? 0xffffffffa0098099
[ 1335.448788]  ? 0xffffffffa0098099
[ 1335.449247]  ? 0xffffffffa0098099
[ 1335.449704]  0xffffffffa0098099
[ 1335.450144]  ? trace_hardirqs_on+0x3f/0x170
[ 1335.450716]  ? preempt_count_sub+0x5/0xa0
[ 1335.451263]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1335.451839]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1335.452505]  rcu_gp_fqs_check_wake+0x5/0x50
[ 1335.453059]  rcu_gp_fqs_loop+0x2bd/0x410
[ 1335.453584]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1335.454168]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1335.454725]  ? rcu_gp_init+0x730/0x730
[ 1335.455225]  rcu_gp_kthread+0xdd/0x170
[ 1335.455736]  kthread+0x1e7/0x230
[ 1335.456177]  ? set_kthread_struct+0x80/0x80
[ 1335.456742]  ret_from_fork+0x1f/0x30
[ 1340.114050] check_preemption_disabled: 1538525 callbacks suppressed
[ 1340.114079] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1340.114152] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1340.114941] caller is debug_smp_processor_id+0x1c/0x20
[ 1340.115902] caller is debug_smp_processor_id+0x1c/0x20
[ 1340.116939] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1340.119206] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1340.120674] Call Trace:
[ 1340.121029]  dump_stack_lvl+0xa4/0xd3
[ 1340.121561]  dump_stack+0x15/0x17
[ 1340.122032]  check_preemption_disabled+0x167/0x180
[ 1340.122717]  debug_smp_processor_id+0x1c/0x20
[ 1340.123319]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1340.124062]  perf_tp_event+0x331/0x4e0
[ 1340.124696]  ? preempt_count_sub+0x5/0xa0
[ 1340.125274]  ? preempt_count_sub+0x5/0xa0
[ 1340.125831]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1340.126519]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1340.127174]  ? ___ratelimit+0x36/0x1e0
[ 1340.127728]  ? __printk_ratelimit+0x21/0x30
[ 1340.128329]  ? insn_get_immediate+0x181/0x570
[ 1340.128913]  ? insn_get_sib+0x140/0x140
[ 1340.129455]  perf_ftrace_function_call+0x248/0x360
[ 1340.130110]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1340.130724]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1340.131368]  ? perf_ftrace_function_call+0x248/0x360
[ 1340.132157]  ? 0xffffffffa0098099
[ 1340.132682]  0xffffffffa0098099
[ 1340.133158]  ? 0xffffffffa0098099
[ 1340.133645]  ? insn_get_immediate+0x49/0x570
[ 1340.134254]  ? insn_get_displacement+0x5/0x270
[ 1340.134864]  ? write_comp_data+0x2f/0x90
[ 1340.135420]  insn_get_displacement+0x5/0x270
[ 1340.136007]  insn_get_immediate+0x181/0x570
[ 1340.136585]  ? insn_get_displacement+0x5/0x270
[ 1340.137190]  ? insn_get_immediate+0x181/0x570
[ 1340.137815]  insn_get_length+0x75/0x90
[ 1340.138358]  insn_decode+0x9b/0x170
[ 1340.138861]  ? intel_irqs_enabled+0x20/0x20
[ 1340.139456]  text_poke_loc_init+0x63/0x140
[ 1340.140100]  ? intel_irqs_enabled+0x20/0x20
[ 1340.140700]  text_poke_queue+0x84/0xc0
[ 1340.141248]  ftrace_replace_code+0xfd/0x170
[ 1340.141851]  ftrace_modify_all_code+0x1b1/0x270
[ 1340.142498]  arch_ftrace_update_code+0x9/0x10
[ 1340.143096]  ftrace_run_update_code+0x30/0xa0
[ 1340.143713]  ftrace_shutdown+0x2b8/0x4a0
[ 1340.144289]  unregister_ftrace_function+0x25/0x50
[ 1340.144937]  perf_ftrace_event_register+0x89/0xf0
[ 1340.145581]  ? perf_tp_event_init+0xa0/0xa0
[ 1340.146168]  perf_trace_destroy+0x37/0x60
[ 1340.146740]  tp_perf_event_destroy+0x15/0x20
[ 1340.147335]  _free_event+0xfc/0x7d0
[ 1340.147862]  put_event+0x37/0x50
[ 1340.148331]  perf_event_release_kernel+0x2f4/0x370
[ 1340.149028]  ? perf_event_release_kernel+0x370/0x370
[ 1340.149715]  perf_release+0x19/0x20
[ 1340.150222]  __fput+0x12d/0x460
[ 1340.150722]  ____fput+0x1a/0x20
[ 1340.151177]  task_work_run+0x8e/0xf0
[ 1340.151707]  do_exit+0x616/0x1310
[ 1340.152207]  ? write_comp_data+0x2f/0x90
[ 1340.152789]  do_group_exit+0x7e/0x130
[ 1340.153331]  get_signal+0x249/0x13c0
[ 1340.153866]  ? get_signal+0x5/0x13c0
[ 1340.154423]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1340.155126]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1340.155832]  exit_to_user_mode_prepare+0x154/0x240
[ 1340.156499]  syscall_exit_to_user_mode+0x2b/0x60
[ 1340.157139]  do_syscall_64+0x46/0x80
[ 1340.157647]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1340.158342] RIP: 0033:0x7fac0740459d
[ 1340.158835] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1340.159680] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1340.160678] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1340.161608] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1340.162551] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1340.163484] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1340.164414] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1340.165455] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1340.165574] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1340.166409] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1340.166421] Call Trace:
[ 1340.166430]  dump_stack_lvl+0xa4/0xd3
[ 1340.166452]  dump_stack+0x15/0x17
[ 1340.166467]  check_preemption_disabled+0x167/0x180
[ 1340.166485]  ? schedule_timeout+0x34e/0x610
[ 1340.166501]  ? do_init_timer+0xa0/0xa0
[ 1340.167584] caller is debug_smp_processor_id+0x1c/0x20
[ 1340.168940]  debug_smp_processor_id+0x1c/0x20
[ 1340.172860]  perf_ftrace_function_call+0x7c/0x360
[ 1340.173457]  ? 0xffffffffa0098099
[ 1340.173880]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1340.174496]  ? finish_task_switch+0xab/0x2a0
[ 1340.175025]  ? __schedule+0x46e/0xb20
[ 1340.175508]  0xffffffffa0098099
[ 1340.175913]  ? finish_task_switch+0xb0/0x2a0
[ 1340.176466]  ? del_timer_sync+0x5/0x130
[ 1340.176958]  del_timer_sync+0x5/0x130
[ 1340.177425]  schedule_timeout+0x34e/0x610
[ 1340.177933]  ? del_timer_sync+0x5/0x130
[ 1340.178429]  ? schedule_timeout+0x34e/0x610
[ 1340.178965]  ? del_timer_sync+0x130/0x130
[ 1340.179480]  ? i915_init_ggtt+0x40/0x6b0
[ 1340.179989]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1340.180503]  ? rcu_gp_init+0x730/0x730
[ 1340.180977]  rcu_gp_kthread+0xdd/0x170
[ 1340.181460]  kthread+0x1e7/0x230
[ 1340.181878]  ? set_kthread_struct+0x80/0x80
[ 1340.182426]  ret_from_fork+0x1f/0x30
[ 1340.182918] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1340.182951] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1340.183996] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1340.184954] caller is debug_smp_processor_id+0x1c/0x20
[ 1340.186535] Call Trace:
[ 1340.186569]  dump_stack_lvl+0xa4/0xd3
[ 1340.188113]  dump_stack+0x15/0x17
[ 1340.188640]  check_preemption_disabled+0x167/0x180
[ 1340.189366]  ? insn_get_displacement+0x157/0x270
[ 1340.190060]  ? insn_rip_relative+0xb0/0xb0
[ 1340.190717]  debug_smp_processor_id+0x1c/0x20
[ 1340.191387]  perf_ftrace_function_call+0x7c/0x360
[ 1340.192103]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1340.192817]  ? insn_get_immediate+0x181/0x570
[ 1340.193491]  ? perf_ftrace_function_call+0x4c/0x360
[ 1340.194505]  0xffffffffa0098099
[ 1340.195058]  ? 0xffffffffa0098099
[ 1340.195633]  ? insn_get_displacement+0x47/0x270
[ 1340.196354]  ? insn_get_sib+0x5/0x140
[ 1340.196927]  ? write_comp_data+0x2f/0x90
[ 1340.197564]  insn_get_sib+0x5/0x140
[ 1340.198120]  insn_get_displacement+0x157/0x270
[ 1340.198798]  ? insn_get_sib+0x5/0x140
[ 1340.199359]  ? insn_get_displacement+0x157/0x270
[ 1340.200102]  insn_get_immediate+0x181/0x570
[ 1340.200798]  insn_get_length+0x75/0x90
[ 1340.201415]  insn_decode+0x9b/0x170
[ 1340.201986]  ? intel_irqs_enabled+0x20/0x20
[ 1340.202633]  text_poke_loc_init+0x63/0x140
[ 1340.203415]  ? intel_irqs_enabled+0x20/0x20
[ 1340.204101]  text_poke_queue+0x84/0xc0
[ 1340.204732]  ftrace_replace_code+0xfd/0x170
[ 1340.205429]  ftrace_modify_all_code+0x1b1/0x270
[ 1340.206166]  arch_ftrace_update_code+0x9/0x10
[ 1340.206834]  ftrace_run_update_code+0x30/0xa0
[ 1340.207523]  ftrace_shutdown+0x2b8/0x4a0
[ 1340.208195]  unregister_ftrace_function+0x25/0x50
[ 1340.208918]  perf_ftrace_event_register+0x89/0xf0
[ 1340.209633]  ? perf_tp_event_init+0xa0/0xa0
[ 1340.210278]  perf_trace_destroy+0x37/0x60
[ 1340.210911]  tp_perf_event_destroy+0x15/0x20
[ 1340.211577]  _free_event+0xfc/0x7d0
[ 1340.212181]  put_event+0x37/0x50
[ 1340.212717]  perf_event_release_kernel+0x2f4/0x370
[ 1340.213505]  ? perf_event_release_kernel+0x370/0x370
[ 1340.214277]  perf_release+0x19/0x20
[ 1340.214882]  __fput+0x12d/0x460
[ 1340.215513]  ____fput+0x1a/0x20
[ 1340.216029]  task_work_run+0x8e/0xf0
[ 1340.216645]  do_exit+0x616/0x1310
[ 1340.217228]  ? write_comp_data+0x2f/0x90
[ 1340.217909]  do_group_exit+0x7e/0x130
[ 1340.218581]  get_signal+0x249/0x13c0
[ 1340.219221]  ? get_signal+0x5/0x13c0
[ 1340.219877]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1340.220715]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1340.221534]  exit_to_user_mode_prepare+0x154/0x240
[ 1340.222294]  syscall_exit_to_user_mode+0x2b/0x60
[ 1340.223017]  do_syscall_64+0x46/0x80
[ 1340.223594]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1340.224347] RIP: 0033:0x7fac0740459d
[ 1340.224904] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1340.225851] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1340.226969] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1340.227984] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1340.228999] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1340.230013] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1340.231032] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1340.232276] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1340.232390] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1340.233225] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1340.234428] caller is debug_smp_processor_id+0x1c/0x20
[ 1340.235694] Call Trace:
[ 1340.235704]  dump_stack_lvl+0xa4/0xd3
[ 1340.237185]  dump_stack+0x15/0x17
[ 1340.237613]  check_preemption_disabled+0x167/0x180
[ 1340.238226]  ? del_timer_sync+0xd3/0x130
[ 1340.238724]  ? detach_if_pending+0x270/0x270
[ 1340.239266]  debug_smp_processor_id+0x1c/0x20
[ 1340.239817]  perf_ftrace_function_call+0x7c/0x360
[ 1340.240409]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1340.241006]  ? register_lock_class+0x42/0x440
[ 1340.241562]  ? del_timer_sync+0x40/0x130
[ 1340.242067]  ? 0xffffffffa0098099
[ 1340.242493]  ? 0xffffffffa0098099
[ 1340.242919]  ? 0xffffffffa0098099
[ 1340.243354]  0xffffffffa0098099
[ 1340.243757]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1340.244358]  ? del_timer_sync+0xa5/0x130
[ 1340.244862]  ? try_to_del_timer_sync+0x5/0x90
[ 1340.245411]  ? write_comp_data+0x2f/0x90
[ 1340.245911]  try_to_del_timer_sync+0x5/0x90
[ 1340.246471]  del_timer_sync+0xd3/0x130
[ 1340.246949]  ? try_to_del_timer_sync+0x5/0x90
[ 1340.247497]  ? del_timer_sync+0xd3/0x130
[ 1340.247999]  schedule_timeout+0x34e/0x610
[ 1340.248516]  ? del_timer_sync+0x130/0x130
[ 1340.249030]  ? i915_init_ggtt+0x40/0x6b0
[ 1340.249539]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1340.250046]  ? rcu_gp_init+0x730/0x730
[ 1340.250533]  rcu_gp_kthread+0xdd/0x170
[ 1340.251018]  kthread+0x1e7/0x230
[ 1340.251437]  ? set_kthread_struct+0x80/0x80
[ 1340.251971]  ret_from_fork+0x1f/0x30
[ 1340.252463] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1340.252491] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1340.253531] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1340.254525] caller is debug_smp_processor_id+0x1c/0x20
[ 1340.256081] Call Trace:
[ 1340.257090]  dump_stack_lvl+0xa4/0xd3
[ 1340.257701]  dump_stack+0x15/0x17
[ 1340.258241]  check_preemption_disabled+0x167/0x180
[ 1340.259026]  debug_smp_processor_id+0x1c/0x20
[ 1340.259700]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1340.260563]  perf_trace_buf_alloc+0x3d/0x100
[ 1340.261223]  ? insn_get_displacement+0x157/0x270
[ 1340.261914]  ? insn_rip_relative+0xb0/0xb0
[ 1340.262561]  perf_ftrace_function_call+0x209/0x360
[ 1340.263500]  ? 0xffffffffa0098099
[ 1340.264146]  0xffffffffa0098099
[ 1340.264701]  ? 0xffffffffa0098099
[ 1340.265278]  ? insn_get_displacement+0x47/0x270
[ 1340.266002]  ? insn_get_sib+0x5/0x140
[ 1340.266581]  ? write_comp_data+0x2f/0x90
[ 1340.267214]  insn_get_sib+0x5/0x140
[ 1340.267760]  insn_get_displacement+0x157/0x270
[ 1340.268444]  ? insn_get_sib+0x5/0x140
[ 1340.269008]  ? insn_get_displacement+0x157/0x270
[ 1340.269755]  insn_get_immediate+0x181/0x570
[ 1340.270465]  insn_get_length+0x75/0x90
[ 1340.271087]  insn_decode+0x9b/0x170
[ 1340.271662]  ? intel_irqs_enabled+0x20/0x20
[ 1340.272308]  text_poke_loc_init+0x63/0x140
[ 1340.273096]  ? intel_irqs_enabled+0x20/0x20
[ 1340.273787]  text_poke_queue+0x84/0xc0
[ 1340.274428]  ftrace_replace_code+0xfd/0x170
[ 1340.275128]  ftrace_modify_all_code+0x1b1/0x270
[ 1340.275865]  arch_ftrace_update_code+0x9/0x10
[ 1340.276534]  ftrace_run_update_code+0x30/0xa0
[ 1340.277226]  ftrace_shutdown+0x2b8/0x4a0
[ 1340.277902]  unregister_ftrace_function+0x25/0x50
[ 1340.278633]  perf_ftrace_event_register+0x89/0xf0
[ 1340.279348]  ? perf_tp_event_init+0xa0/0xa0
[ 1340.279992]  perf_trace_destroy+0x37/0x60
[ 1340.280634]  tp_perf_event_destroy+0x15/0x20
[ 1340.281303]  _free_event+0xfc/0x7d0
[ 1340.281909]  put_event+0x37/0x50
[ 1340.282456]  perf_event_release_kernel+0x2f4/0x370
[ 1340.283247]  ? perf_event_release_kernel+0x370/0x370
[ 1340.284018]  perf_release+0x19/0x20
[ 1340.284581]  __fput+0x12d/0x460
[ 1340.285186]  ____fput+0x1a/0x20
[ 1340.285704]  task_work_run+0x8e/0xf0
[ 1340.286330]  do_exit+0x616/0x1310
[ 1340.286917]  ? write_comp_data+0x2f/0x90
[ 1340.287605]  do_group_exit+0x7e/0x130
[ 1340.288237]  get_signal+0x249/0x13c0
[ 1340.288844]  ? get_signal+0x5/0x13c0
[ 1340.289506]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1340.290352]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1340.291178]  exit_to_user_mode_prepare+0x154/0x240
[ 1340.291929]  syscall_exit_to_user_mode+0x2b/0x60
[ 1340.292648]  do_syscall_64+0x46/0x80
[ 1340.293222]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1340.293978] RIP: 0033:0x7fac0740459d
[ 1340.294546] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1340.295479] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1340.296580] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1340.297597] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1340.298623] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1340.299642] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1340.300658] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1340.301905] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1340.302090] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1340.302856] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1340.303863] caller is debug_smp_processor_id+0x1c/0x20
[ 1340.305219] Call Trace:
[ 1340.306208]  dump_stack_lvl+0xa4/0xd3
[ 1340.306679]  dump_stack+0x15/0x17
[ 1340.307104]  check_preemption_disabled+0x167/0x180
[ 1340.307704]  ? try_to_del_timer_sync+0x33/0x90
[ 1340.308261]  ? calc_wheel_index+0x2d0/0x2d0
[ 1340.308792]  debug_smp_processor_id+0x1c/0x20
[ 1340.309339]  perf_ftrace_function_call+0x7c/0x360
[ 1340.309929]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1340.310523]  ? del_timer_sync+0xd3/0x130
[ 1340.311021]  ? perf_ftrace_function_call+0x4c/0x360
[ 1340.311628]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1340.312222]  ? register_lock_class+0x42/0x440
[ 1340.312776]  ? del_timer_sync+0x40/0x130
[ 1340.313276]  ? 0xffffffffa0098099
[ 1340.313700]  ? 0xffffffffa0098099
[ 1340.314153]  0xffffffffa0098099
[ 1340.314562]  ? 0xffffffffa0098099
[ 1340.314985]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1340.315577]  ? del_timer_sync+0xa5/0x130
[ 1340.316079]  ? lock_timer_base+0x5/0x100
[ 1340.316581]  lock_timer_base+0x5/0x100
[ 1340.317058]  try_to_del_timer_sync+0x33/0x90
[ 1340.317597]  ? lock_timer_base+0x5/0x100
[ 1340.318099]  ? try_to_del_timer_sync+0x33/0x90
[ 1340.318657]  ? try_to_del_timer_sync+0x5/0x90
[ 1340.319210]  del_timer_sync+0xd3/0x130
[ 1340.319692]  schedule_timeout+0x34e/0x610
[ 1340.320209]  ? del_timer_sync+0x130/0x130
[ 1340.320729]  ? i915_init_ggtt+0x40/0x6b0
[ 1340.321237]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1340.321744]  ? rcu_gp_init+0x730/0x730
[ 1340.322222]  rcu_gp_kthread+0xdd/0x170
[ 1340.322704]  kthread+0x1e7/0x230
[ 1340.323122]  ? set_kthread_struct+0x80/0x80
[ 1340.323656]  ret_from_fork+0x1f/0x30
[ 1340.324144] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1340.324174] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1340.325133] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1340.326118] caller is debug_smp_processor_id+0x1c/0x20
[ 1340.327561] Call Trace:
[ 1340.328527]  dump_stack_lvl+0xa4/0xd3
[ 1340.329058]  dump_stack+0x15/0x17
[ 1340.329528]  check_preemption_disabled+0x167/0x180
[ 1340.330217]  debug_smp_processor_id+0x1c/0x20
[ 1340.330820]  perf_trace_buf_alloc+0x98/0x100
[ 1340.331413]  ? insn_get_displacement+0x157/0x270
[ 1340.332041]  ? insn_rip_relative+0xb0/0xb0
[ 1340.332613]  perf_ftrace_function_call+0x209/0x360
[ 1340.333371]  ? 0xffffffffa0098099
[ 1340.333896]  0xffffffffa0098099
[ 1340.334369]  ? 0xffffffffa0098099
[ 1340.334860]  ? insn_get_displacement+0x47/0x270
[ 1340.335497]  ? insn_get_sib+0x5/0x140
[ 1340.336011]  ? write_comp_data+0x2f/0x90
[ 1340.336567]  insn_get_sib+0x5/0x140
[ 1340.337060]  insn_get_displacement+0x157/0x270
[ 1340.337670]  ? insn_get_sib+0x5/0x140
[ 1340.338180]  ? insn_get_displacement+0x157/0x270
[ 1340.338834]  insn_get_immediate+0x181/0x570
[ 1340.339440]  insn_get_length+0x75/0x90
[ 1340.339980]  insn_decode+0x9b/0x170
[ 1340.340483]  ? intel_irqs_enabled+0x20/0x20
[ 1340.341061]  text_poke_loc_init+0x63/0x140
[ 1340.341705]  ? intel_irqs_enabled+0x20/0x20
[ 1340.342309]  text_poke_queue+0x84/0xc0
[ 1340.342857]  ftrace_replace_code+0xfd/0x170
[ 1340.343462]  ftrace_modify_all_code+0x1b1/0x270
[ 1340.344105]  arch_ftrace_update_code+0x9/0x10
[ 1340.344706]  ftrace_run_update_code+0x30/0xa0
[ 1340.345316]  ftrace_shutdown+0x2b8/0x4a0
[ 1340.345893]  unregister_ftrace_function+0x25/0x50
[ 1340.346553]  perf_ftrace_event_register+0x89/0xf0
[ 1340.347198]  ? perf_tp_event_init+0xa0/0xa0
[ 1340.347778]  perf_trace_destroy+0x37/0x60
[ 1340.348342]  tp_perf_event_destroy+0x15/0x20
[ 1340.348939]  _free_event+0xfc/0x7d0
[ 1340.349456]  put_event+0x37/0x50
[ 1340.349935]  perf_event_release_kernel+0x2f4/0x370
[ 1340.350630]  ? perf_event_release_kernel+0x370/0x370
[ 1340.351316]  perf_release+0x19/0x20
[ 1340.351814]  __fput+0x12d/0x460
[ 1340.352310]  ____fput+0x1a/0x20
[ 1340.352765]  task_work_run+0x8e/0xf0
[ 1340.353294]  do_exit+0x616/0x1310
[ 1340.353792]  ? write_comp_data+0x2f/0x90
[ 1340.354386]  do_group_exit+0x7e/0x130
[ 1340.354929]  get_signal+0x249/0x13c0
[ 1340.355451]  ? get_signal+0x5/0x13c0
[ 1340.356001]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1340.356704]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1340.357407]  exit_to_user_mode_prepare+0x154/0x240
[ 1340.358077]  syscall_exit_to_user_mode+0x2b/0x60
[ 1340.358719]  do_syscall_64+0x46/0x80
[ 1340.359228]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1340.359913] RIP: 0033:0x7fac0740459d
[ 1340.360411] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1340.361264] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1340.362269] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1340.363201] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1340.364134] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1340.365070] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1340.366002] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1340.367050] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1340.367156] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1340.367995] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1340.369003] caller is debug_smp_processor_id+0x1c/0x20
[ 1340.370361] Call Trace:
[ 1340.370370]  dump_stack_lvl+0xa4/0xd3
[ 1340.370392]  dump_stack+0x15/0x17
[ 1340.370407]  check_preemption_disabled+0x167/0x180
[ 1340.370425]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1340.370439]  ? prepare_to_swait_exclusive+0x90/0x90
[ 1340.370460]  debug_smp_processor_id+0x1c/0x20
[ 1340.374497]  perf_ftrace_function_call+0x7c/0x360
[ 1340.375094]  ? trace_hardirqs_on+0x3f/0x170
[ 1340.375626]  ? preempt_count_sub+0x5/0xa0
[ 1340.376139]  ? preempt_count_sub+0x5/0xa0
[ 1340.376646]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1340.377268]  ? write_comp_data+0x2f/0x90
[ 1340.377775]  0xffffffffa0098099
[ 1340.378180]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1340.378783]  ? del_timer_sync+0xde/0x130
[ 1340.379285]  ? prepare_to_swait_event+0x5/0xf0
[ 1340.379843]  ? i915_init_ggtt+0x40/0x6b0
[ 1340.380344]  prepare_to_swait_event+0x5/0xf0
[ 1340.380882]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1340.381379]  ? prepare_to_swait_event+0x5/0xf0
[ 1340.381935]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1340.382464]  ? rcu_gp_init+0x730/0x730
[ 1340.382941]  rcu_gp_kthread+0xdd/0x170
[ 1340.383425]  kthread+0x1e7/0x230
[ 1340.383845]  ? set_kthread_struct+0x80/0x80
[ 1340.384381]  ret_from_fork+0x1f/0x30
[ 1340.384873] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1340.384903] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1340.385855] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1340.386840] caller is debug_smp_processor_id+0x1c/0x20
[ 1340.388281] Call Trace:
[ 1340.389244]  dump_stack_lvl+0xa4/0xd3
[ 1340.389770]  dump_stack+0x15/0x17
[ 1340.390245]  check_preemption_disabled+0x167/0x180
[ 1340.390928]  debug_smp_processor_id+0x1c/0x20
[ 1340.391530]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1340.392270]  perf_tp_event+0x331/0x4e0
[ 1340.392884]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1340.393683]  ? arch_local_irq_enable+0x10/0x12
[ 1340.394461]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1340.395135]  ? dump_stack_lvl+0xcc/0xd3
[ 1340.395706]  ? insn_get_displacement+0x157/0x270
[ 1340.396336]  ? insn_rip_relative+0xb0/0xb0
[ 1340.396913]  perf_ftrace_function_call+0x248/0x360
[ 1340.397577]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1340.398195]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1340.398840]  ? perf_ftrace_function_call+0x248/0x360
[ 1340.399630]  ? 0xffffffffa0098099
[ 1340.400153]  0xffffffffa0098099
[ 1340.400625]  ? 0xffffffffa0098099
[ 1340.401118]  ? insn_get_displacement+0x47/0x270
[ 1340.401755]  ? insn_get_sib+0x5/0x140
[ 1340.402272]  ? write_comp_data+0x2f/0x90
[ 1340.402829]  insn_get_sib+0x5/0x140
[ 1340.403322]  insn_get_displacement+0x157/0x270
[ 1340.403933]  ? insn_get_sib+0x5/0x140
[ 1340.404440]  ? insn_get_displacement+0x157/0x270
[ 1340.405095]  insn_get_immediate+0x181/0x570
[ 1340.405702]  insn_get_length+0x75/0x90
[ 1340.406246]  insn_decode+0x9b/0x170
[ 1340.406750]  ? intel_irqs_enabled+0x20/0x20
[ 1340.407330]  text_poke_loc_init+0x63/0x140
[ 1340.407974]  ? intel_irqs_enabled+0x20/0x20
[ 1340.408575]  text_poke_queue+0x84/0xc0
[ 1340.409127]  ftrace_replace_code+0xfd/0x170
[ 1340.409734]  ftrace_modify_all_code+0x1b1/0x270
[ 1340.410383]  arch_ftrace_update_code+0x9/0x10
[ 1340.410986]  ftrace_run_update_code+0x30/0xa0
[ 1340.411599]  ftrace_shutdown+0x2b8/0x4a0
[ 1340.412178]  unregister_ftrace_function+0x25/0x50
[ 1340.412829]  perf_ftrace_event_register+0x89/0xf0
[ 1340.413477]  ? perf_tp_event_init+0xa0/0xa0
[ 1340.414062]  perf_trace_destroy+0x37/0x60
[ 1340.414635]  tp_perf_event_destroy+0x15/0x20
[ 1340.415233]  _free_event+0xfc/0x7d0
[ 1340.415752]  put_event+0x37/0x50
[ 1340.416223]  perf_event_release_kernel+0x2f4/0x370
[ 1340.416911]  ? perf_event_release_kernel+0x370/0x370
[ 1340.417599]  perf_release+0x19/0x20
[ 1340.418133]  __fput+0x12d/0x460
[ 1340.418634]  ____fput+0x1a/0x20
[ 1340.419090]  task_work_run+0x8e/0xf0
[ 1340.419622]  do_exit+0x616/0x1310
[ 1340.420121]  ? write_comp_data+0x2f/0x90
[ 1340.420708]  do_group_exit+0x7e/0x130
[ 1340.421256]  get_signal+0x249/0x13c0
[ 1340.421783]  ? get_signal+0x5/0x13c0
[ 1340.422347]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1340.423053]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1340.423757]  exit_to_user_mode_prepare+0x154/0x240
[ 1340.424423]  syscall_exit_to_user_mode+0x2b/0x60
[ 1340.425065]  do_syscall_64+0x46/0x80
[ 1340.425575]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1340.426289] RIP: 0033:0x7fac0740459d
[ 1340.426797] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1340.427645] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1340.428631] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1340.429550] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1340.430476] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1340.431393] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1340.432312] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1340.433343] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1340.434305] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1340.435675] Call Trace:
[ 1340.435991]  dump_stack_lvl+0xa4/0xd3
[ 1340.436464]  dump_stack+0x15/0x17
[ 1340.436891]  check_preemption_disabled+0x167/0x180
[ 1340.437493]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1340.438010]  ? rcu_pm_notify+0x40/0x40
[ 1340.438514]  debug_smp_processor_id+0x1c/0x20
[ 1340.439067]  perf_ftrace_function_call+0x7c/0x360
[ 1340.439658]  ? prepare_to_swait_event+0xbb/0xf0
[ 1340.440231]  ? 0xffffffffa0098099
[ 1340.440656]  ? 0xffffffffa0098099
[ 1340.441082]  ? 0xffffffffa0098099
[ 1340.441518]  ? 0xffffffffa0098099
[ 1340.441951]  0xffffffffa0098099
[ 1340.442369]  ? trace_hardirqs_on+0x3f/0x170
[ 1340.442902]  ? preempt_count_sub+0x5/0xa0
[ 1340.443421]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1340.443968]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1340.444598]  rcu_gp_fqs_check_wake+0x5/0x50
[ 1340.445126]  rcu_gp_fqs_loop+0x2bd/0x410
[ 1340.445622]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1340.446181]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1340.446724]  ? rcu_gp_init+0x730/0x730
[ 1340.447200]  rcu_gp_kthread+0xdd/0x170
[ 1340.447682]  kthread+0x1e7/0x230
[ 1340.448101]  ? set_kthread_struct+0x80/0x80
[ 1340.448637]  ret_from_fork+0x1f/0x30
[ 1345.118050] check_preemption_disabled: 1560384 callbacks suppressed
[ 1345.118079] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1345.118149] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1345.118907] caller is debug_smp_processor_id+0x1c/0x20
[ 1345.119809] caller is debug_smp_processor_id+0x1c/0x20
[ 1345.120790] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1345.122927] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1345.124315] Call Trace:
[ 1345.124652]  dump_stack_lvl+0xa4/0xd3
[ 1345.125156]  dump_stack+0x15/0x17
[ 1345.125582]  check_preemption_disabled+0x167/0x180
[ 1345.126210]  debug_smp_processor_id+0x1c/0x20
[ 1345.126753]  perf_trace_buf_alloc+0x98/0x100
[ 1345.127287]  ? insn_get_sib+0x122/0x140
[ 1345.127765]  ? insn_get_opcode+0x3b0/0x3b0
[ 1345.128282]  perf_ftrace_function_call+0x209/0x360
[ 1345.128970]  ? 0xffffffffa0098099
[ 1345.129447]  0xffffffffa0098099
[ 1345.129873]  ? 0xffffffffa0098099
[ 1345.130336]  ? insn_get_sib+0x43/0x140
[ 1345.130850]  ? insn_get_modrm+0x5/0x2a0
[ 1345.131358]  ? write_comp_data+0x2f/0x90
[ 1345.131889]  insn_get_modrm+0x5/0x2a0
[ 1345.132376]  insn_get_sib+0x122/0x140
[ 1345.132839]  ? insn_get_modrm+0x5/0x2a0
[ 1345.133316]  ? insn_get_sib+0x122/0x140
[ 1345.133818]  insn_get_displacement+0x157/0x270
[ 1345.134396]  insn_get_immediate+0x181/0x570
[ 1345.134942]  insn_get_length+0x75/0x90
[ 1345.135430]  insn_decode+0x9b/0x170
[ 1345.135884]  ? watchdog_next_keepalive+0xe0/0xe0
[ 1345.136457]  text_poke_loc_init+0x63/0x140
[ 1345.137040]  ? watchdog_next_keepalive+0xe0/0xe0
[ 1345.137631]  text_poke_queue+0x84/0xc0
[ 1345.138136]  ftrace_replace_code+0xfd/0x170
[ 1345.138686]  ftrace_modify_all_code+0x1b1/0x270
[ 1345.139269]  arch_ftrace_update_code+0x9/0x10
[ 1345.139811]  ftrace_run_update_code+0x30/0xa0
[ 1345.140361]  ftrace_shutdown+0x2b8/0x4a0
[ 1345.140885]  unregister_ftrace_function+0x25/0x50
[ 1345.141476]  perf_ftrace_event_register+0x89/0xf0
[ 1345.142061]  ? perf_tp_event_init+0xa0/0xa0
[ 1345.142589]  perf_trace_destroy+0x37/0x60
[ 1345.143098]  tp_perf_event_destroy+0x15/0x20
[ 1345.143637]  _free_event+0xfc/0x7d0
[ 1345.144106]  put_event+0x37/0x50
[ 1345.144531]  perf_event_release_kernel+0x2f4/0x370
[ 1345.145150]  ? perf_event_release_kernel+0x370/0x370
[ 1345.145769]  perf_release+0x19/0x20
[ 1345.146226]  __fput+0x12d/0x460
[ 1345.146680]  ____fput+0x1a/0x20
[ 1345.147092]  task_work_run+0x8e/0xf0
[ 1345.147574]  do_exit+0x616/0x1310
[ 1345.148026]  ? write_comp_data+0x2f/0x90
[ 1345.148555]  do_group_exit+0x7e/0x130
[ 1345.149046]  get_signal+0x249/0x13c0
[ 1345.149520]  ? get_signal+0x5/0x13c0
[ 1345.150018]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1345.150669]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1345.151305]  exit_to_user_mode_prepare+0x154/0x240
[ 1345.151955]  syscall_exit_to_user_mode+0x2b/0x60
[ 1345.152595]  do_syscall_64+0x46/0x80
[ 1345.153103]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1345.153791] RIP: 0033:0x7fac0740459d
[ 1345.154296] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1345.155150] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1345.156151] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1345.157085] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1345.158017] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1345.158955] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1345.159891] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1345.160939] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1345.161054] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1345.161884] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1345.162984] caller is debug_smp_processor_id+0x1c/0x20
[ 1345.164252] Call Trace:
[ 1345.164263]  dump_stack_lvl+0xa4/0xd3
[ 1345.165684]  dump_stack+0x15/0x17
[ 1345.166115]  check_preemption_disabled+0x167/0x180
[ 1345.166715]  ? schedule_timeout+0x34e/0x610
[ 1345.167241]  ? do_init_timer+0xa0/0xa0
[ 1345.167721]  debug_smp_processor_id+0x1c/0x20
[ 1345.168268]  perf_ftrace_function_call+0x7c/0x360
[ 1345.168863]  ? 0xffffffffa0098099
[ 1345.169286]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1345.169888]  ? finish_task_switch+0xab/0x2a0
[ 1345.170428]  ? __schedule+0x46e/0xb20
[ 1345.170910]  0xffffffffa0098099
[ 1345.171315]  ? finish_task_switch+0xb0/0x2a0
[ 1345.171867]  ? del_timer_sync+0x5/0x130
[ 1345.172360]  del_timer_sync+0x5/0x130
[ 1345.172827]  schedule_timeout+0x34e/0x610
[ 1345.173332]  ? del_timer_sync+0x5/0x130
[ 1345.173817]  ? schedule_timeout+0x34e/0x610
[ 1345.174357]  ? del_timer_sync+0x130/0x130
[ 1345.174870]  ? i915_init_ggtt+0x40/0x6b0
[ 1345.175379]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1345.175886]  ? rcu_gp_init+0x730/0x730
[ 1345.176361]  rcu_gp_kthread+0xdd/0x170
[ 1345.176843]  kthread+0x1e7/0x230
[ 1345.177261]  ? set_kthread_struct+0x80/0x80
[ 1345.177795]  ret_from_fork+0x1f/0x30
[ 1345.178288] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1345.178319] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1345.179273] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1345.180241] caller is debug_smp_processor_id+0x1c/0x20
[ 1345.181696] Call Trace:
[ 1345.182659]  dump_stack_lvl+0xa4/0xd3
[ 1345.183188]  dump_stack+0x15/0x17
[ 1345.183659]  check_preemption_disabled+0x167/0x180
[ 1345.184341]  debug_smp_processor_id+0x1c/0x20
[ 1345.184943]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1345.185685]  perf_tp_event+0x331/0x4e0
[ 1345.186365]  ? arch_local_irq_enable+0x10/0x12
[ 1345.186990]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1345.187645]  ? dump_stack_lvl+0xcc/0xd3
[ 1345.188195]  ? dump_stack+0x15/0x17
[ 1345.188687]  ? check_preemption_disabled+0x167/0x180
[ 1345.189392]  ? insn_get_sib+0x122/0x140
[ 1345.189921]  ? insn_get_opcode+0x3b0/0x3b0
[ 1345.190508]  perf_ftrace_function_call+0x248/0x360
[ 1345.191161]  ? perf_ftrace_function_call+0x248/0x360
[ 1345.191952]  ? 0xffffffffa0098099
[ 1345.192478]  0xffffffffa0098099
[ 1345.192949]  ? 0xffffffffa0098099
[ 1345.193441]  ? insn_get_sib+0x43/0x140
[ 1345.193981]  ? insn_get_modrm+0x5/0x2a0
[ 1345.194518]  ? write_comp_data+0x2f/0x90
[ 1345.195076]  insn_get_modrm+0x5/0x2a0
[ 1345.195590]  insn_get_sib+0x122/0x140
[ 1345.196104]  ? insn_get_modrm+0x5/0x2a0
[ 1345.196634]  ? insn_get_sib+0x122/0x140
[ 1345.197191]  insn_get_displacement+0x157/0x270
[ 1345.197823]  insn_get_immediate+0x181/0x570
[ 1345.198432]  insn_get_length+0x75/0x90
[ 1345.198973]  insn_decode+0x9b/0x170
[ 1345.199475]  ? watchdog_next_keepalive+0xe0/0xe0
[ 1345.200108]  text_poke_loc_init+0x63/0x140
[ 1345.200751]  ? watchdog_next_keepalive+0xe0/0xe0
[ 1345.201404]  text_poke_queue+0x84/0xc0
[ 1345.201952]  ftrace_replace_code+0xfd/0x170
[ 1345.202560]  ftrace_modify_all_code+0x1b1/0x270
[ 1345.203202]  arch_ftrace_update_code+0x9/0x10
[ 1345.203802]  ftrace_run_update_code+0x30/0xa0
[ 1345.204412]  ftrace_shutdown+0x2b8/0x4a0
[ 1345.204991]  unregister_ftrace_function+0x25/0x50
[ 1345.205665]  perf_ftrace_event_register+0x89/0xf0
[ 1345.206320]  ? perf_tp_event_init+0xa0/0xa0
[ 1345.206899]  perf_trace_destroy+0x37/0x60
[ 1345.207463]  tp_perf_event_destroy+0x15/0x20
[ 1345.208058]  _free_event+0xfc/0x7d0
[ 1345.208575]  put_event+0x37/0x50
[ 1345.209042]  perf_event_release_kernel+0x2f4/0x370
[ 1345.209728]  ? perf_event_release_kernel+0x370/0x370
[ 1345.210416]  perf_release+0x19/0x20
[ 1345.210913]  __fput+0x12d/0x460
[ 1345.211413]  ____fput+0x1a/0x20
[ 1345.211868]  task_work_run+0x8e/0xf0
[ 1345.212398]  do_exit+0x616/0x1310
[ 1345.212896]  ? write_comp_data+0x2f/0x90
[ 1345.213479]  do_group_exit+0x7e/0x130
[ 1345.214020]  get_signal+0x249/0x13c0
[ 1345.214546]  ? get_signal+0x5/0x13c0
[ 1345.215095]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1345.215799]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1345.216502]  exit_to_user_mode_prepare+0x154/0x240
[ 1345.217166]  syscall_exit_to_user_mode+0x2b/0x60
[ 1345.217808]  do_syscall_64+0x46/0x80
[ 1345.218319]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1345.219005] RIP: 0033:0x7fac0740459d
[ 1345.219496] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1345.220343] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1345.221326] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1345.222246] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1345.223163] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1345.224079] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1345.224996] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1345.226033] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1345.226156] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1345.227020] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1345.228123] caller is debug_smp_processor_id+0x1c/0x20
[ 1345.229480] Call Trace:
[ 1345.229491]  dump_stack_lvl+0xa4/0xd3
[ 1345.230996]  dump_stack+0x15/0x17
[ 1345.231428]  check_preemption_disabled+0x167/0x180
[ 1345.232028]  ? del_timer_sync+0xd3/0x130
[ 1345.232530]  ? detach_if_pending+0x270/0x270
[ 1345.233074]  debug_smp_processor_id+0x1c/0x20
[ 1345.233626]  perf_ftrace_function_call+0x7c/0x360
[ 1345.234224]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1345.234820]  ? register_lock_class+0x42/0x440
[ 1345.235374]  ? del_timer_sync+0x40/0x130
[ 1345.235875]  ? 0xffffffffa0098099
[ 1345.236300]  ? 0xffffffffa0098099
[ 1345.236725]  ? 0xffffffffa0098099
[ 1345.237158]  0xffffffffa0098099
[ 1345.237560]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1345.238164]  ? del_timer_sync+0xa5/0x130
[ 1345.238666]  ? try_to_del_timer_sync+0x5/0x90
[ 1345.239211]  ? write_comp_data+0x2f/0x90
[ 1345.239708]  try_to_del_timer_sync+0x5/0x90
[ 1345.240234]  del_timer_sync+0xd3/0x130
[ 1345.240710]  ? try_to_del_timer_sync+0x5/0x90
[ 1345.241255]  ? del_timer_sync+0xd3/0x130
[ 1345.241755]  schedule_timeout+0x34e/0x610
[ 1345.242275]  ? del_timer_sync+0x130/0x130
[ 1345.242788]  ? i915_init_ggtt+0x40/0x6b0
[ 1345.243297]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1345.243803]  ? rcu_gp_init+0x730/0x730
[ 1345.244277]  rcu_gp_kthread+0xdd/0x170
[ 1345.244760]  kthread+0x1e7/0x230
[ 1345.245176]  ? set_kthread_struct+0x80/0x80
[ 1345.245710]  ret_from_fork+0x1f/0x30
[ 1345.246212] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1345.246267] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1345.247281] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1345.248240] caller is debug_smp_processor_id+0x1c/0x20
[ 1345.249807] Call Trace:
[ 1345.250838]  dump_stack_lvl+0xa4/0xd3
[ 1345.251447]  dump_stack+0x15/0x17
[ 1345.251975]  check_preemption_disabled+0x167/0x180
[ 1345.252703]  ? insn_get_modrm+0x12b/0x2a0
[ 1345.253311]  ? insn_get_prefixes+0x50/0x50
[ 1345.253963]  debug_smp_processor_id+0x1c/0x20
[ 1345.254640]  perf_ftrace_function_call+0x7c/0x360
[ 1345.255368]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1345.256083]  ? insn_get_sib+0x122/0x140
[ 1345.256679]  ? perf_ftrace_function_call+0x4c/0x360
[ 1345.257676]  0xffffffffa0098099
[ 1345.258256]  ? 0xffffffffa0098099
[ 1345.258832]  ? insn_get_modrm+0x49/0x2a0
[ 1345.259472]  ? insn_get_opcode+0x5/0x3b0
[ 1345.260079]  ? write_comp_data+0x2f/0x90
[ 1345.260721]  insn_get_opcode+0x5/0x3b0
[ 1345.261310]  insn_get_modrm+0x12b/0x2a0
[ 1345.261907]  ? insn_get_opcode+0x5/0x3b0
[ 1345.262513]  ? insn_get_modrm+0x12b/0x2a0
[ 1345.263186]  insn_get_sib+0x122/0x140
[ 1345.263804]  insn_get_displacement+0x157/0x270
[ 1345.264526]  insn_get_immediate+0x181/0x570
[ 1345.265223]  insn_get_length+0x75/0x90
[ 1345.265839]  insn_decode+0x9b/0x170
[ 1345.266420]  ? watchdog_next_keepalive+0xe0/0xe0
[ 1345.267124]  text_poke_loc_init+0x63/0x140
[ 1345.267908]  ? watchdog_next_keepalive+0xe0/0xe0
[ 1345.268650]  text_poke_queue+0x84/0xc0
[ 1345.269280]  ftrace_replace_code+0xfd/0x170
[ 1345.269979]  ftrace_modify_all_code+0x1b1/0x270
[ 1345.270721]  arch_ftrace_update_code+0x9/0x10
[ 1345.271419]  ftrace_run_update_code+0x30/0xa0
[ 1345.272112]  ftrace_shutdown+0x2b8/0x4a0
[ 1345.272793]  unregister_ftrace_function+0x25/0x50
[ 1345.273518]  perf_ftrace_event_register+0x89/0xf0
[ 1345.274245]  ? perf_tp_event_init+0xa0/0xa0
[ 1345.274889]  perf_trace_destroy+0x37/0x60
[ 1345.275522]  tp_perf_event_destroy+0x15/0x20
[ 1345.276191]  _free_event+0xfc/0x7d0
[ 1345.276796]  put_event+0x37/0x50
[ 1345.277334]  perf_event_release_kernel+0x2f4/0x370
[ 1345.278134]  ? perf_event_release_kernel+0x370/0x370
[ 1345.278906]  perf_release+0x19/0x20
[ 1345.279474]  __fput+0x12d/0x460
[ 1345.280076]  ____fput+0x1a/0x20
[ 1345.280595]  task_work_run+0x8e/0xf0
[ 1345.281213]  do_exit+0x616/0x1310
[ 1345.281798]  ? write_comp_data+0x2f/0x90
[ 1345.282492]  do_group_exit+0x7e/0x130
[ 1345.283123]  get_signal+0x249/0x13c0
[ 1345.283730]  ? get_signal+0x5/0x13c0
[ 1345.284388]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1345.285221]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1345.286042]  exit_to_user_mode_prepare+0x154/0x240
[ 1345.286799]  syscall_exit_to_user_mode+0x2b/0x60
[ 1345.287523]  do_syscall_64+0x46/0x80
[ 1345.288098]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1345.288852] RIP: 0033:0x7fac0740459d
[ 1345.289409] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1345.290351] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1345.291451] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1345.292469] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1345.293486] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1345.294506] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1345.295525] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1345.296766] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1345.296879] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1345.297710] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1345.298901] caller is debug_smp_processor_id+0x1c/0x20
[ 1345.300156] Call Trace:
[ 1345.300165]  dump_stack_lvl+0xa4/0xd3
[ 1345.301646]  dump_stack+0x15/0x17
[ 1345.302070]  check_preemption_disabled+0x167/0x180
[ 1345.302670]  ? try_to_del_timer_sync+0x33/0x90
[ 1345.303224]  ? calc_wheel_index+0x2d0/0x2d0
[ 1345.303752]  debug_smp_processor_id+0x1c/0x20
[ 1345.304300]  perf_ftrace_function_call+0x7c/0x360
[ 1345.304890]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1345.305475]  ? del_timer_sync+0xd3/0x130
[ 1345.305971]  ? perf_ftrace_function_call+0x4c/0x360
[ 1345.306585]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1345.307180]  ? register_lock_class+0x42/0x440
[ 1345.307731]  ? del_timer_sync+0x40/0x130
[ 1345.308229]  ? 0xffffffffa0098099
[ 1345.308653]  ? 0xffffffffa0098099
[ 1345.309084]  0xffffffffa0098099
[ 1345.309492]  ? 0xffffffffa0098099
[ 1345.309915]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1345.310509]  ? del_timer_sync+0xa5/0x130
[ 1345.311012]  ? lock_timer_base+0x5/0x100
[ 1345.311514]  lock_timer_base+0x5/0x100
[ 1345.311990]  try_to_del_timer_sync+0x33/0x90
[ 1345.312526]  ? lock_timer_base+0x5/0x100
[ 1345.313020]  ? try_to_del_timer_sync+0x33/0x90
[ 1345.313574]  ? try_to_del_timer_sync+0x5/0x90
[ 1345.314129]  del_timer_sync+0xd3/0x130
[ 1345.314612]  schedule_timeout+0x34e/0x610
[ 1345.315127]  ? del_timer_sync+0x130/0x130
[ 1345.315641]  ? i915_init_ggtt+0x40/0x6b0
[ 1345.316148]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1345.316654]  ? rcu_gp_init+0x730/0x730
[ 1345.317128]  rcu_gp_kthread+0xdd/0x170
[ 1345.317610]  kthread+0x1e7/0x230
[ 1345.318028]  ? set_kthread_struct+0x80/0x80
[ 1345.318564]  ret_from_fork+0x1f/0x30
[ 1345.319055] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1345.319088] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1345.320124] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1345.321083] caller is debug_smp_processor_id+0x1c/0x20
[ 1345.322664] Call Trace:
[ 1345.322700]  dump_stack_lvl+0xa4/0xd3
[ 1345.324251]  dump_stack+0x15/0x17
[ 1345.324783]  check_preemption_disabled+0x167/0x180
[ 1345.325572]  debug_smp_processor_id+0x1c/0x20
[ 1345.326251]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1345.327115]  perf_trace_buf_alloc+0x3d/0x100
[ 1345.327776]  ? insn_get_modrm+0x12b/0x2a0
[ 1345.328389]  ? insn_get_prefixes+0x50/0x50
[ 1345.329034]  perf_ftrace_function_call+0x209/0x360
[ 1345.329777]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1345.330675]  ? 0xffffffffa0098099
[ 1345.331319]  0xffffffffa0098099
[ 1345.331889]  ? 0xffffffffa0098099
[ 1345.332457]  ? insn_get_modrm+0x49/0x2a0
[ 1345.333102]  ? insn_get_opcode+0x5/0x3b0
[ 1345.333714]  ? write_comp_data+0x2f/0x90
[ 1345.334351]  insn_get_opcode+0x5/0x3b0
[ 1345.334939]  insn_get_modrm+0x12b/0x2a0
[ 1345.335540]  ? insn_get_opcode+0x5/0x3b0
[ 1345.336140]  ? insn_get_modrm+0x12b/0x2a0
[ 1345.336818]  insn_get_sib+0x122/0x140
[ 1345.337439]  insn_get_displacement+0x157/0x270
[ 1345.338191]  insn_get_immediate+0x181/0x570
[ 1345.338893]  insn_get_length+0x75/0x90
[ 1345.339514]  insn_decode+0x9b/0x170
[ 1345.340090]  ? watchdog_next_keepalive+0xe0/0xe0
[ 1345.340795]  text_poke_loc_init+0x63/0x140
[ 1345.341583]  ? watchdog_next_keepalive+0xe0/0xe0
[ 1345.342336]  text_poke_queue+0x84/0xc0
[ 1345.342971]  ftrace_replace_code+0xfd/0x170
[ 1345.343672]  ftrace_modify_all_code+0x1b1/0x270
[ 1345.344410]  arch_ftrace_update_code+0x9/0x10
[ 1345.345079]  ftrace_run_update_code+0x30/0xa0
[ 1345.345771]  ftrace_shutdown+0x2b8/0x4a0
[ 1345.346452]  unregister_ftrace_function+0x25/0x50
[ 1345.347180]  perf_ftrace_event_register+0x89/0xf0
[ 1345.347898]  ? perf_tp_event_init+0xa0/0xa0
[ 1345.348547]  perf_trace_destroy+0x37/0x60
[ 1345.349186]  tp_perf_event_destroy+0x15/0x20
[ 1345.349855]  _free_event+0xfc/0x7d0
[ 1345.350467]  put_event+0x37/0x50
[ 1345.351008]  perf_event_release_kernel+0x2f4/0x370
[ 1345.351802]  ? perf_event_release_kernel+0x370/0x370
[ 1345.352577]  perf_release+0x19/0x20
[ 1345.353143]  __fput+0x12d/0x460
[ 1345.353749]  ____fput+0x1a/0x20
[ 1345.354272]  task_work_run+0x8e/0xf0
[ 1345.354894]  do_exit+0x616/0x1310
[ 1345.355481]  ? write_comp_data+0x2f/0x90
[ 1345.356170]  do_group_exit+0x7e/0x130
[ 1345.356804]  get_signal+0x249/0x13c0
[ 1345.357413]  ? get_signal+0x5/0x13c0
[ 1345.358079]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1345.358915]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1345.359741]  exit_to_user_mode_prepare+0x154/0x240
[ 1345.360491]  syscall_exit_to_user_mode+0x2b/0x60
[ 1345.361211]  do_syscall_64+0x46/0x80
[ 1345.361787]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1345.362545] RIP: 0033:0x7fac0740459d
[ 1345.363103] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1345.364038] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1345.365139] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1345.366162] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1345.367203] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1345.368222] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1345.369240] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1345.370491] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1345.370597] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1345.371430] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1345.372436] caller is debug_smp_processor_id+0x1c/0x20
[ 1345.373782] Call Trace:
[ 1345.374776]  dump_stack_lvl+0xa4/0xd3
[ 1345.375247]  dump_stack+0x15/0x17
[ 1345.375672]  check_preemption_disabled+0x167/0x180
[ 1345.376268]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1345.376781]  ? prepare_to_swait_exclusive+0x90/0x90
[ 1345.377392]  debug_smp_processor_id+0x1c/0x20
[ 1345.377941]  perf_ftrace_function_call+0x7c/0x360
[ 1345.378542]  ? trace_hardirqs_on+0x3f/0x170
[ 1345.379074]  ? preempt_count_sub+0x5/0xa0
[ 1345.379587]  ? preempt_count_sub+0x5/0xa0
[ 1345.380092]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1345.380714]  ? write_comp_data+0x2f/0x90
[ 1345.381220]  0xffffffffa0098099
[ 1345.381620]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1345.382273]  ? del_timer_sync+0xde/0x130
[ 1345.382779]  ? prepare_to_swait_event+0x5/0xf0
[ 1345.383350]  ? i915_init_ggtt+0x40/0x6b0
[ 1345.383848]  prepare_to_swait_event+0x5/0xf0
[ 1345.384383]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1345.384879]  ? prepare_to_swait_event+0x5/0xf0
[ 1345.385433]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1345.385960]  ? rcu_gp_init+0x730/0x730
[ 1345.386438]  rcu_gp_kthread+0xdd/0x170
[ 1345.386919]  kthread+0x1e7/0x230
[ 1345.387337]  ? set_kthread_struct+0x80/0x80
[ 1345.387871]  ret_from_fork+0x1f/0x30
[ 1345.388361] CPU: 0 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1345.388391] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1345.389346] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1345.390330] caller is debug_smp_processor_id+0x1c/0x20
[ 1345.391770] Call Trace:
[ 1345.392735]  dump_stack_lvl+0xa4/0xd3
[ 1345.393267]  dump_stack+0x15/0x17
[ 1345.393739]  check_preemption_disabled+0x167/0x180
[ 1345.394428]  debug_smp_processor_id+0x1c/0x20
[ 1345.395031]  perf_trace_buf_alloc+0x98/0x100
[ 1345.395623]  ? insn_get_modrm+0x12b/0x2a0
[ 1345.396174]  ? insn_get_prefixes+0x50/0x50
[ 1345.396746]  perf_ftrace_function_call+0x209/0x360
[ 1345.397506]  ? 0xffffffffa0098099
[ 1345.398032]  0xffffffffa0098099
[ 1345.398512]  ? 0xffffffffa0098099
[ 1345.398998]  ? insn_get_modrm+0x49/0x2a0
[ 1345.399558]  ? insn_get_opcode+0x5/0x3b0
[ 1345.400102]  ? write_comp_data+0x2f/0x90
[ 1345.400659]  insn_get_opcode+0x5/0x3b0
[ 1345.401180]  insn_get_modrm+0x12b/0x2a0
[ 1345.401715]  ? insn_get_opcode+0x5/0x3b0
[ 1345.402258]  ? insn_get_modrm+0x12b/0x2a0
[ 1345.402838]  insn_get_sib+0x122/0x140
[ 1345.403370]  insn_get_displacement+0x157/0x270
[ 1345.404001]  insn_get_immediate+0x181/0x570
[ 1345.404605]  insn_get_length+0x75/0x90
[ 1345.405143]  insn_decode+0x9b/0x170
[ 1345.405644]  ? watchdog_next_keepalive+0xe0/0xe0
[ 1345.406279]  text_poke_loc_init+0x63/0x140
[ 1345.406920]  ? watchdog_next_keepalive+0xe0/0xe0
[ 1345.407572]  text_poke_queue+0x84/0xc0
[ 1345.408119]  ftrace_replace_code+0xfd/0x170
[ 1345.408723]  ftrace_modify_all_code+0x1b1/0x270
[ 1345.409366]  arch_ftrace_update_code+0x9/0x10
[ 1345.409966]  ftrace_run_update_code+0x30/0xa0
[ 1345.410585]  ftrace_shutdown+0x2b8/0x4a0
[ 1345.411161]  unregister_ftrace_function+0x25/0x50
[ 1345.411809]  perf_ftrace_event_register+0x89/0xf0
[ 1345.412455]  ? perf_tp_event_init+0xa0/0xa0
[ 1345.413033]  perf_trace_destroy+0x37/0x60
[ 1345.413598]  tp_perf_event_destroy+0x15/0x20
[ 1345.414197]  _free_event+0xfc/0x7d0
[ 1345.414715]  put_event+0x37/0x50
[ 1345.415184]  perf_event_release_kernel+0x2f4/0x370
[ 1345.415870]  ? perf_event_release_kernel+0x370/0x370
[ 1345.416556]  perf_release+0x19/0x20
[ 1345.417053]  __fput+0x12d/0x460
[ 1345.417550]  ____fput+0x1a/0x20
[ 1345.418009]  task_work_run+0x8e/0xf0
[ 1345.418544]  do_exit+0x616/0x1310
[ 1345.419045]  ? write_comp_data+0x2f/0x90
[ 1345.419631]  do_group_exit+0x7e/0x130
[ 1345.420176]  get_signal+0x249/0x13c0
[ 1345.420702]  ? get_signal+0x5/0x13c0
[ 1345.421253]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1345.421958]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1345.422665]  exit_to_user_mode_prepare+0x154/0x240
[ 1345.423331]  syscall_exit_to_user_mode+0x2b/0x60
[ 1345.423974]  do_syscall_64+0x46/0x80
[ 1345.424484]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1345.425171] RIP: 0033:0x7fac0740459d
[ 1345.425671] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1345.426533] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1345.427546] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1345.428482] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1345.429416] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1345.430358] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1345.431291] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1345.432335] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1345.433280] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1345.434654] Call Trace:
[ 1345.434971]  dump_stack_lvl+0xa4/0xd3
[ 1345.435442]  dump_stack+0x15/0x17
[ 1345.435866]  check_preemption_disabled+0x167/0x180
[ 1345.436464]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1345.436976]  ? rcu_pm_notify+0x40/0x40
[ 1345.437453]  debug_smp_processor_id+0x1c/0x20
[ 1345.438001]  perf_ftrace_function_call+0x7c/0x360
[ 1345.438596]  ? prepare_to_swait_event+0xbb/0xf0
[ 1345.439168]  ? 0xffffffffa0098099
[ 1345.439591]  ? 0xffffffffa0098099
[ 1345.440017]  ? 0xffffffffa0098099
[ 1345.440452]  ? 0xffffffffa0098099
[ 1345.440884]  0xffffffffa0098099
[ 1345.441288]  ? trace_hardirqs_on+0x3f/0x170
[ 1345.441819]  ? preempt_count_sub+0x5/0xa0
[ 1345.442339]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1345.442885]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1345.443506]  rcu_gp_fqs_check_wake+0x5/0x50
[ 1345.444030]  rcu_gp_fqs_loop+0x2bd/0x410
[ 1345.444525]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1345.445067]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1345.445593]  ? rcu_gp_init+0x730/0x730
[ 1345.446071]  rcu_gp_kthread+0xdd/0x170
[ 1345.446555]  kthread+0x1e7/0x230
[ 1345.446972]  ? set_kthread_struct+0x80/0x80
[ 1345.447505]  ret_from_fork+0x1f/0x30
[ 1350.121974] check_preemption_disabled: 2262255 callbacks suppressed
[ 1350.121988] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1350.121991] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[ 1350.122723] caller is debug_smp_processor_id+0x1c/0x20
[ 1350.123557] caller is debug_smp_processor_id+0x1c/0x20
[ 1350.124433] CPU: 1 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1350.126346] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1350.127622] Call Trace:
[ 1350.127918]  dump_stack_lvl+0xa4/0xd3
[ 1350.128368]  dump_stack+0x15/0x17
[ 1350.128780]  check_preemption_disabled+0x167/0x180
[ 1350.129362]  ? __get_locked_pte+0x1a2/0x290
[ 1350.129874]  ? __lock_text_start+0x8/0x8
[ 1350.130362]  debug_smp_processor_id+0x1c/0x20
[ 1350.130894]  perf_ftrace_function_call+0x7c/0x360
[ 1350.131467]  ? __text_poke+0x2f2/0x4e0
[ 1350.131930]  ? _raw_spin_trylock_bh+0x80/0x80
[ 1350.132464]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1350.133036]  ? __text_poke+0x2f2/0x4e0
[ 1350.133498]  ? perf_ftrace_function_call+0x4c/0x360
[ 1350.134094]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1350.134673]  ? irqentry_exit+0x3a/0x90
[ 1350.135134]  ? sysvec_apic_timer_interrupt+0xc8/0xd0
[ 1350.135743]  ? trace_hardirqs_on+0x6a/0x170
[ 1350.136257]  ? irqentry_exit+0x3a/0x90
[ 1350.136721]  ? pmd_page_vaddr+0x2b/0x70
[ 1350.137194]  ? _raw_spin_lock+0x5/0x50
[ 1350.137659]  ? _raw_spin_lock+0x5/0x50
[ 1350.138124]  ? __get_locked_pte+0x1a2/0x290
[ 1350.138634]  ? _raw_spin_lock+0x5/0x50
[ 1350.139097]  ? __get_locked_pte+0x1a2/0x290
[ 1350.139609]  ? fixed_mdio_read+0x1/0x180
[ 1350.140113]  ? __text_poke+0xea/0x4e0
[ 1350.140567]  ? lock_is_held_type+0xe2/0x140
[ 1350.141080]  ? fixed_mdio_read+0x1/0x180
[ 1350.141565]  ? text_poke+0x2b/0x60
[ 1350.141987]  ? text_poke_bp_batch+0xf5/0x2c0
[ 1350.142515]  ? e100_get_sset_count+0x50/0x50
[ 1350.143046]  ? text_poke_queue+0xa7/0xc0
[ 1350.143530]  ? ftrace_replace_code+0xfd/0x170
[ 1350.144066]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1350.144641]  ? arch_ftrace_update_code+0x9/0x10
[ 1350.145191]  ? ftrace_run_update_code+0x30/0xa0
[ 1350.145751]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1350.146260]  ? unregister_ftrace_function+0x25/0x50
[ 1350.146851]  ? perf_ftrace_event_register+0x89/0xf0
[ 1350.147447]  ? perf_tp_event_init+0xa0/0xa0
[ 1350.147958]  ? perf_trace_destroy+0x37/0x60
[ 1350.148471]  ? tp_perf_event_destroy+0x15/0x20
[ 1350.149012]  ? _free_event+0xfc/0x7d0
[ 1350.149466]  ? put_event+0x37/0x50
[ 1350.149887]  ? perf_event_release_kernel+0x2f4/0x370
[ 1350.150497]  ? perf_event_release_kernel+0x370/0x370
[ 1350.151099]  ? perf_release+0x19/0x20
[ 1350.151549]  ? __fput+0x12d/0x460
[ 1350.151967]  ? ____fput+0x1a/0x20
[ 1350.152379]  ? task_work_run+0x8e/0xf0
[ 1350.152845]  ? do_exit+0x616/0x1310
[ 1350.153280]  ? write_comp_data+0x2f/0x90
[ 1350.153765]  ? do_group_exit+0x7e/0x130
[ 1350.154243]  ? get_signal+0x249/0x13c0
[ 1350.154706]  ? get_signal+0x5/0x13c0
[ 1350.155149]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1350.155745]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1350.156329]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1350.156927]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1350.157516]  ? do_syscall_64+0x46/0x80
[ 1350.157980]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1350.158631] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1350.158663] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1350.159572] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1350.160488] caller is debug_smp_processor_id+0x1c/0x20
[ 1350.161806] Call Trace:
[ 1350.162725]  dump_stack_lvl+0xa4/0xd3
[ 1350.163180]  dump_stack+0x15/0x17
[ 1350.163591]  check_preemption_disabled+0x167/0x180
[ 1350.164171]  ? inode_sub_bytes+0x31/0xd0
[ 1350.164653]  ? __lock_text_start+0x8/0x8
[ 1350.165140]  debug_smp_processor_id+0x1c/0x20
[ 1350.165672]  perf_ftrace_function_call+0x7c/0x360
[ 1350.166255]  ? perf_ftrace_function_call+0x4c/0x360
[ 1350.166864]  ? ext4_try_merge_freed_extent+0x122/0x160
[ 1350.167492]  ? _raw_spin_trylock_bh+0x80/0x80
[ 1350.168023]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1350.168592]  ? ext4_try_merge_freed_extent+0x122/0x160
[ 1350.169212]  ? write_comp_data+0x2f/0x90
[ 1350.169692]  ? ext4_mb_free_metadata+0x1d7/0x300
[ 1350.170258]  ? _raw_spin_trylock_bh+0x80/0x80
[ 1350.170790]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1350.171363]  ? ext4_mb_free_metadata+0x1d7/0x300
[ 1350.171925]  ? perf_ftrace_function_call+0x4c/0x360
[ 1350.172517]  ? write_comp_data+0x2f/0x90
[ 1350.172996]  ? ext4_free_blocks+0x7ab/0x1580
[ 1350.173533]  ? __lock_acquire+0xa2a/0x1ba0
[ 1350.174040]  ? __dquot_free_space+0x3ac/0x550
[ 1350.174592]  ? _raw_spin_lock+0x5/0x50
[ 1350.175056]  ? __lock_acquire+0x4d6/0x1ba0
[ 1350.175558]  ? _raw_spin_lock+0x5/0x50
[ 1350.176021]  ? inode_sub_bytes+0x31/0xd0
[ 1350.176503]  ? _raw_spin_lock+0x5/0x50
[ 1350.176964]  ? inode_sub_bytes+0x31/0xd0
[ 1350.177451]  ? __dquot_free_space+0x3c2/0x550
[ 1350.177981]  ? lock_is_held_type+0xe2/0x140
[ 1350.178500]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1350.179074]  ? write_comp_data+0x2f/0x90
[ 1350.179559]  ? ext4_free_blocks+0xefe/0x1580
[ 1350.180098]  ? ext4_ext_remove_space+0x1156/0x2260
[ 1350.180702]  ? ext4_ext_truncate+0x124/0x150
[ 1350.181229]  ? ext4_truncate+0x6db/0x940
[ 1350.181710]  ? write_comp_data+0x2f/0x90
[ 1350.182197]  ? ext4_evict_inode+0x512/0xfb0
[ 1350.182712]  ? ext4_da_write_begin+0x560/0x560
[ 1350.183255]  ? evict+0x102/0x210
[ 1350.183667]  ? iput+0x2e0/0x4f0
[ 1350.184061]  ? dentry_unlink_inode+0x125/0x1b0
[ 1350.184604]  ? __dentry_kill+0x179/0x280
[ 1350.185087]  ? dput.part.36+0x3a/0x870
[ 1350.185549]  ? dput.part.36+0x51e/0x870
[ 1350.186019]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1350.186596]  ? dput+0x1a/0x20
[ 1350.186967]  ? do_renameat2+0x601/0x8e0
[ 1350.187458]  ? __x64_sys_rename+0x49/0x50
[ 1350.187951]  ? do_syscall_64+0x37/0x80
[ 1350.188412]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1350.189059] CPU: 1 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1350.189103] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[ 1350.189949] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1350.190928] caller is debug_smp_processor_id+0x1c/0x20
[ 1350.192241] Call Trace:
[ 1350.193148]  dump_stack_lvl+0xa4/0xd3
[ 1350.193610]  dump_stack+0x15/0x17
[ 1350.194020]  check_preemption_disabled+0x167/0x180
[ 1350.194607]  ? __get_locked_pte+0x1a2/0x290
[ 1350.195118]  ? __lock_text_start+0x8/0x8
[ 1350.195600]  debug_smp_processor_id+0x1c/0x20
[ 1350.196131]  perf_ftrace_function_call+0x7c/0x360
[ 1350.196701]  ? __text_poke+0x2f2/0x4e0
[ 1350.197162]  ? _raw_spin_trylock_bh+0x80/0x80
[ 1350.197694]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1350.198268]  ? __text_poke+0x2f2/0x4e0
[ 1350.198729]  ? perf_ftrace_function_call+0x4c/0x360
[ 1350.199321]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1350.199898]  ? __lock_acquire+0xa2a/0x1ba0
[ 1350.200411]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1350.200985]  ? pmd_page_vaddr+0x2b/0x70
[ 1350.201457]  ? _raw_spin_lock+0x5/0x50
[ 1350.201921]  ? _raw_spin_lock+0x5/0x50
[ 1350.202387]  ? __get_locked_pte+0x1a2/0x290
[ 1350.202898]  ? _raw_spin_lock+0x5/0x50
[ 1350.203360]  ? __get_locked_pte+0x1a2/0x290
[ 1350.203872]  ? fixed_phy_add_gpiod.part.7+0x1/0x120
[ 1350.204466]  ? __text_poke+0xea/0x4e0
[ 1350.204918]  ? lock_is_held_type+0xe2/0x140
[ 1350.205429]  ? fixed_phy_add_gpiod.part.7+0x1/0x120
[ 1350.206023]  ? text_poke+0x2b/0x60
[ 1350.206450]  ? text_poke_bp_batch+0xf5/0x2c0
[ 1350.206971]  ? e100_get_sset_count+0x50/0x50
[ 1350.207497]  ? text_poke_queue+0xa7/0xc0
[ 1350.207981]  ? ftrace_replace_code+0xfd/0x170
[ 1350.208514]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1350.209084]  ? arch_ftrace_update_code+0x9/0x10
[ 1350.209633]  ? ftrace_run_update_code+0x30/0xa0
[ 1350.210188]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1350.210692]  ? unregister_ftrace_function+0x25/0x50
[ 1350.211283]  ? perf_ftrace_event_register+0x89/0xf0
[ 1350.211876]  ? perf_tp_event_init+0xa0/0xa0
[ 1350.212387]  ? perf_trace_destroy+0x37/0x60
[ 1350.212900]  ? tp_perf_event_destroy+0x15/0x20
[ 1350.213440]  ? _free_event+0xfc/0x7d0
[ 1350.213894]  ? put_event+0x37/0x50
[ 1350.214317]  ? perf_event_release_kernel+0x2f4/0x370
[ 1350.214921]  ? perf_event_release_kernel+0x370/0x370
[ 1350.215522]  ? perf_release+0x19/0x20
[ 1350.215972]  ? __fput+0x12d/0x460
[ 1350.216389]  ? ____fput+0x1a/0x20
[ 1350.216801]  ? task_work_run+0x8e/0xf0
[ 1350.217265]  ? do_exit+0x616/0x1310
[ 1350.217700]  ? write_comp_data+0x2f/0x90
[ 1350.218188]  ? do_group_exit+0x7e/0x130
[ 1350.218663]  ? get_signal+0x249/0x13c0
[ 1350.219125]  ? get_signal+0x5/0x13c0
[ 1350.219569]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1350.220166]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1350.220752]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1350.221352]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1350.221934]  ? do_syscall_64+0x46/0x80
[ 1350.222398]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1350.223043] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1350.223062] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1350.223977] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1350.224887] caller is debug_smp_processor_id+0x1c/0x20
[ 1350.226211] Call Trace:
[ 1350.226216]  dump_stack_lvl+0xa4/0xd3
[ 1350.227566]  dump_stack+0x15/0x17
[ 1350.227980]  check_preemption_disabled+0x167/0x180
[ 1350.228560]  ? ext4_mark_iloc_dirty+0xcd/0x1490
[ 1350.229109]  ? __lock_text_start+0x8/0x8
[ 1350.229589]  debug_smp_processor_id+0x1c/0x20
[ 1350.230124]  perf_ftrace_function_call+0x7c/0x360
[ 1350.230702]  ? __lock_acquire+0x4d6/0x1ba0
[ 1350.231211]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1350.231793]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1350.232369]  ? _raw_spin_lock+0x5/0x50
[ 1350.232830]  ? write_comp_data+0x2f/0x90
[ 1350.233312]  ? _raw_spin_lock+0x5/0x50
[ 1350.233773]  ? ext4_mark_iloc_dirty+0xcd/0x1490
[ 1350.234326]  ? _raw_spin_lock+0x5/0x50
[ 1350.234787]  ? ext4_mark_iloc_dirty+0xcd/0x1490
[ 1350.235338]  ? __ext4_journal_get_write_access+0x129/0x280
[ 1350.235998]  ? write_comp_data+0x2f/0x90
[ 1350.236479]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1350.237054]  ? __ext4_mark_inode_dirty+0xf6/0x460
[ 1350.237628]  ? write_comp_data+0x2f/0x90
[ 1350.238114]  ? ext4_dirty_inode+0x76/0xa0
[ 1350.238605]  ? ext4_setattr+0x11a0/0x11a0
[ 1350.239096]  ? __mark_inode_dirty+0x2cd/0x9f0
[ 1350.239643]  ? ext4_free_blocks+0xf0b/0x1580
[ 1350.240181]  ? ext4_ext_remove_space+0x1156/0x2260
[ 1350.240782]  ? ext4_ext_truncate+0x124/0x150
[ 1350.241306]  ? ext4_truncate+0x6db/0x940
[ 1350.241787]  ? write_comp_data+0x2f/0x90
[ 1350.242274]  ? ext4_evict_inode+0x512/0xfb0
[ 1350.242788]  ? ext4_da_write_begin+0x560/0x560
[ 1350.243332]  ? evict+0x102/0x210
[ 1350.243737]  ? iput+0x2e0/0x4f0
[ 1350.244132]  ? dentry_unlink_inode+0x125/0x1b0
[ 1350.244673]  ? __dentry_kill+0x179/0x280
[ 1350.245157]  ? dput.part.36+0x3a/0x870
[ 1350.245619]  ? dput.part.36+0x51e/0x870
[ 1350.246092]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1350.246667]  ? dput+0x1a/0x20
[ 1350.247039]  ? do_renameat2+0x601/0x8e0
[ 1350.247529]  ? __x64_sys_rename+0x49/0x50
[ 1350.248021]  ? do_syscall_64+0x37/0x80
[ 1350.248482]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1350.249127] CPU: 1 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1350.249158] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[ 1350.250013] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1350.250022] Call Trace:
[ 1350.250027]  dump_stack_lvl+0xa4/0xd3
[ 1350.250985] caller is debug_smp_processor_id+0x1c/0x20
[ 1350.252312]  dump_stack+0x15/0x17
[ 1350.254048]  check_preemption_disabled+0x167/0x180
[ 1350.254635]  ? __get_locked_pte+0x1a2/0x290
[ 1350.255146]  ? __lock_text_start+0x8/0x8
[ 1350.255629]  debug_smp_processor_id+0x1c/0x20
[ 1350.256161]  perf_ftrace_function_call+0x7c/0x360
[ 1350.256732]  ? __text_poke+0x2f2/0x4e0
[ 1350.257190]  ? _raw_spin_trylock_bh+0x80/0x80
[ 1350.257722]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1350.258295]  ? __text_poke+0x2f2/0x4e0
[ 1350.258757]  ? perf_ftrace_function_call+0x4c/0x360
[ 1350.259350]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1350.259926]  ? __lock_acquire+0xa2a/0x1ba0
[ 1350.260440]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1350.261012]  ? pmd_page_vaddr+0x2b/0x70
[ 1350.261486]  ? _raw_spin_lock+0x5/0x50
[ 1350.261951]  ? _raw_spin_lock+0x5/0x50
[ 1350.262417]  ? __get_locked_pte+0x1a2/0x290
[ 1350.262929]  ? _raw_spin_lock+0x5/0x50
[ 1350.263392]  ? __get_locked_pte+0x1a2/0x290
[ 1350.263903]  ? __fixed_phy_register.part.8+0x1/0x300
[ 1350.264507]  ? __text_poke+0xea/0x4e0
[ 1350.264962]  ? lock_is_held_type+0xe2/0x140
[ 1350.265475]  ? __fixed_phy_register.part.8+0x1/0x300
[ 1350.266087]  ? text_poke+0x2b/0x60
[ 1350.266514]  ? text_poke_bp_batch+0xf5/0x2c0
[ 1350.267039]  ? e100_get_sset_count+0x50/0x50
[ 1350.267565]  ? text_poke_queue+0xa7/0xc0
[ 1350.268049]  ? ftrace_replace_code+0xfd/0x170
[ 1350.268582]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1350.269154]  ? arch_ftrace_update_code+0x9/0x10
[ 1350.269705]  ? ftrace_run_update_code+0x30/0xa0
[ 1350.270260]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1350.270765]  ? unregister_ftrace_function+0x25/0x50
[ 1350.271356]  ? perf_ftrace_event_register+0x89/0xf0
[ 1350.271948]  ? perf_tp_event_init+0xa0/0xa0
[ 1350.272459]  ? perf_trace_destroy+0x37/0x60
[ 1350.272972]  ? tp_perf_event_destroy+0x15/0x20
[ 1350.273515]  ? _free_event+0xfc/0x7d0
[ 1350.273968]  ? put_event+0x37/0x50
[ 1350.274395]  ? perf_event_release_kernel+0x2f4/0x370
[ 1350.274998]  ? perf_event_release_kernel+0x370/0x370
[ 1350.275598]  ? perf_release+0x19/0x20
[ 1350.276049]  ? __fput+0x12d/0x460
[ 1350.276467]  ? ____fput+0x1a/0x20
[ 1350.276879]  ? task_work_run+0x8e/0xf0
[ 1350.277346]  ? do_exit+0x616/0x1310
[ 1350.277781]  ? write_comp_data+0x2f/0x90
[ 1350.278270]  ? do_group_exit+0x7e/0x130
[ 1350.278747]  ? get_signal+0x249/0x13c0
[ 1350.279209]  ? get_signal+0x5/0x13c0
[ 1350.279655]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1350.280251]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1350.280837]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1350.281438]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1350.282020]  ? do_syscall_64+0x46/0x80
[ 1350.282485]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1350.283132] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1350.283151] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1350.284074] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1350.284985] caller is debug_smp_processor_id+0x1c/0x20
[ 1350.286307] Call Trace:
[ 1350.286313]  dump_stack_lvl+0xa4/0xd3
[ 1350.287663]  dump_stack+0x15/0x17
[ 1350.288074]  check_preemption_disabled+0x167/0x180
[ 1350.288656]  ? ext4_mark_iloc_dirty+0xcd/0x1490
[ 1350.289206]  ? __lock_text_start+0x8/0x8
[ 1350.289690]  debug_smp_processor_id+0x1c/0x20
[ 1350.290224]  perf_ftrace_function_call+0x7c/0x360
[ 1350.290802]  ? __lock_acquire+0x4d6/0x1ba0
[ 1350.291311]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1350.291891]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1350.292467]  ? _raw_spin_lock+0x5/0x50
[ 1350.292928]  ? write_comp_data+0x2f/0x90
[ 1350.293408]  ? _raw_spin_lock+0x5/0x50
[ 1350.293870]  ? ext4_mark_iloc_dirty+0xcd/0x1490
[ 1350.294428]  ? _raw_spin_lock+0x5/0x50
[ 1350.294899]  ? ext4_mark_iloc_dirty+0xcd/0x1490
[ 1350.295462]  ? __ext4_journal_get_write_access+0x129/0x280
[ 1350.296122]  ? write_comp_data+0x2f/0x90
[ 1350.296604]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1350.297180]  ? __ext4_mark_inode_dirty+0xf6/0x460
[ 1350.297756]  ? write_comp_data+0x2f/0x90
[ 1350.298250]  ? __ext4_ext_dirty.isra.34+0xb2/0xc0
[ 1350.298825]  ? ext4_ext_remove_space+0xd6a/0x2260
[ 1350.299415]  ? ext4_ext_truncate+0x124/0x150
[ 1350.299939]  ? ext4_truncate+0x6db/0x940
[ 1350.300417]  ? write_comp_data+0x2f/0x90
[ 1350.300900]  ? ext4_evict_inode+0x512/0xfb0
[ 1350.301414]  ? ext4_da_write_begin+0x560/0x560
[ 1350.301956]  ? evict+0x102/0x210
[ 1350.302366]  ? iput+0x2e0/0x4f0
[ 1350.302763]  ? dentry_unlink_inode+0x125/0x1b0
[ 1350.303310]  ? __dentry_kill+0x179/0x280
[ 1350.303792]  ? dput.part.36+0x3a/0x870
[ 1350.304252]  ? dput.part.36+0x51e/0x870
[ 1350.304722]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1350.305296]  ? dput+0x1a/0x20
[ 1350.305667]  ? do_renameat2+0x601/0x8e0
[ 1350.306169]  ? __x64_sys_rename+0x49/0x50
[ 1350.306665]  ? do_syscall_64+0x37/0x80
[ 1350.307132]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1350.307802] CPU: 1 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1350.307830] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[ 1350.308691] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1350.309654] caller is debug_smp_processor_id+0x1c/0x20
[ 1350.310979] Call Trace:
[ 1350.310985]  dump_stack_lvl+0xa4/0xd3
[ 1350.312335]  dump_stack+0x15/0x17
[ 1350.312745]  check_preemption_disabled+0x167/0x180
[ 1350.313325]  ? __get_locked_pte+0x1a2/0x290
[ 1350.313834]  ? __lock_text_start+0x8/0x8
[ 1350.314318]  debug_smp_processor_id+0x1c/0x20
[ 1350.314847]  perf_ftrace_function_call+0x7c/0x360
[ 1350.315418]  ? __text_poke+0x2f2/0x4e0
[ 1350.315877]  ? _raw_spin_trylock_bh+0x80/0x80
[ 1350.316407]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1350.316974]  ? __text_poke+0x2f2/0x4e0
[ 1350.317432]  ? perf_ftrace_function_call+0x4c/0x360
[ 1350.318021]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1350.318598]  ? __lock_acquire+0xa2a/0x1ba0
[ 1350.319109]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1350.319679]  ? pmd_page_vaddr+0x2b/0x70
[ 1350.320148]  ? _raw_spin_lock+0x5/0x50
[ 1350.320611]  ? _raw_spin_lock+0x5/0x50
[ 1350.321071]  ? __get_locked_pte+0x1a2/0x290
[ 1350.321579]  ? _raw_spin_lock+0x5/0x50
[ 1350.322039]  ? __get_locked_pte+0x1a2/0x290
[ 1350.322552]  ? fixed_phy_register+0x1/0x80
[ 1350.323053]  ? __text_poke+0xea/0x4e0
[ 1350.323504]  ? lock_is_held_type+0xe2/0x140
[ 1350.324013]  ? fixed_phy_register+0x1/0x80
[ 1350.324516]  ? text_poke+0x2b/0x60
[ 1350.324937]  ? text_poke_bp_batch+0xf5/0x2c0
[ 1350.325458]  ? e100_get_sset_count+0x50/0x50
[ 1350.325980]  ? text_poke_queue+0xa7/0xc0
[ 1350.326467]  ? ftrace_replace_code+0xfd/0x170
[ 1350.326999]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1350.327570]  ? arch_ftrace_update_code+0x9/0x10
[ 1350.328117]  ? ftrace_run_update_code+0x30/0xa0
[ 1350.328668]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1350.329171]  ? unregister_ftrace_function+0x25/0x50
[ 1350.329759]  ? perf_ftrace_event_register+0x89/0xf0
[ 1350.330378]  ? perf_tp_event_init+0xa0/0xa0
[ 1350.330890]  ? perf_trace_destroy+0x37/0x60
[ 1350.331399]  ? tp_perf_event_destroy+0x15/0x20
[ 1350.331940]  ? _free_event+0xfc/0x7d0
[ 1350.332392]  ? put_event+0x37/0x50
[ 1350.332812]  ? perf_event_release_kernel+0x2f4/0x370
[ 1350.333413]  ? perf_event_release_kernel+0x370/0x370
[ 1350.334014]  ? perf_release+0x19/0x20
[ 1350.334468]  ? __fput+0x12d/0x460
[ 1350.334884]  ? ____fput+0x1a/0x20
[ 1350.335294]  ? task_work_run+0x8e/0xf0
[ 1350.335758]  ? do_exit+0x616/0x1310
[ 1350.336191]  ? write_comp_data+0x2f/0x90
[ 1350.336675]  ? do_group_exit+0x7e/0x130
[ 1350.337149]  ? get_signal+0x249/0x13c0
[ 1350.337610]  ? get_signal+0x5/0x13c0
[ 1350.338059]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1350.338655]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1350.339239]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1350.339839]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1350.340420]  ? do_syscall_64+0x46/0x80
[ 1350.340882]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1350.341526] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1350.341549] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20673
[ 1350.342467] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1350.342477] Call Trace:
[ 1350.342481]  dump_stack_lvl+0xa4/0xd3
[ 1350.343392] caller is debug_smp_processor_id+0x1c/0x20
[ 1350.344719]  dump_stack+0x15/0x17
[ 1350.346455]  check_preemption_disabled+0x167/0x180
[ 1350.347038]  ? ext4_mark_iloc_dirty+0xcd/0x1490
[ 1350.347588]  ? __lock_text_start+0x8/0x8
[ 1350.348071]  debug_smp_processor_id+0x1c/0x20
[ 1350.348604]  perf_ftrace_function_call+0x7c/0x360
[ 1350.349182]  ? __lock_acquire+0x4d6/0x1ba0
[ 1350.349690]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1350.350273]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1350.350851]  ? _raw_spin_lock+0x5/0x50
[ 1350.351312]  ? write_comp_data+0x2f/0x90
[ 1350.351793]  ? _raw_spin_lock+0x5/0x50
[ 1350.352256]  ? ext4_mark_iloc_dirty+0xcd/0x1490
[ 1350.352807]  ? _raw_spin_lock+0x5/0x50
[ 1350.353269]  ? ext4_mark_iloc_dirty+0xcd/0x1490
[ 1350.353820]  ? __ext4_journal_get_write_access+0x129/0x280
[ 1350.354483]  ? write_comp_data+0x2f/0x90
[ 1350.354966]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1350.355542]  ? __ext4_mark_inode_dirty+0xf6/0x460
[ 1350.356116]  ? write_comp_data+0x2f/0x90
[ 1350.356602]  ? __ext4_ext_dirty.isra.34+0xb2/0xc0
[ 1350.357178]  ? ext4_ext_remove_space+0x1624/0x2260
[ 1350.357780]  ? ext4_ext_truncate+0x124/0x150
[ 1350.358311]  ? ext4_truncate+0x6db/0x940
[ 1350.358792]  ? write_comp_data+0x2f/0x90
[ 1350.359292]  ? ext4_evict_inode+0x512/0xfb0
[ 1350.359812]  ? ext4_da_write_begin+0x560/0x560
[ 1350.360355]  ? evict+0x102/0x210
[ 1350.360759]  ? iput+0x2e0/0x4f0
[ 1350.361155]  ? dentry_unlink_inode+0x125/0x1b0
[ 1350.361698]  ? __dentry_kill+0x179/0x280
[ 1350.362189]  ? dput.part.36+0x3a/0x870
[ 1350.362651]  ? dput.part.36+0x51e/0x870
[ 1350.363120]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1350.363693]  ? dput+0x1a/0x20
[ 1350.364066]  ? do_renameat2+0x601/0x8e0
[ 1350.364556]  ? __x64_sys_rename+0x49/0x50
[ 1350.365051]  ? do_syscall_64+0x37/0x80
[ 1350.365513]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1350.366173] CPU: 1 PID: 20673 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1350.366326] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[ 1350.367067] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1350.368035] caller is debug_smp_processor_id+0x1c/0x20
[ 1350.369363] Call Trace:
[ 1350.370275]  dump_stack_lvl+0xa4/0xd3
[ 1350.370727]  dump_stack+0x15/0x17
[ 1350.371137]  check_preemption_disabled+0x167/0x180
[ 1350.371718]  ? __get_locked_pte+0x1a2/0x290
[ 1350.372228]  ? __lock_text_start+0x8/0x8
[ 1350.372710]  debug_smp_processor_id+0x1c/0x20
[ 1350.373243]  perf_ftrace_function_call+0x7c/0x360
[ 1350.373812]  ? __text_poke+0x2f2/0x4e0
[ 1350.374276]  ? _raw_spin_trylock_bh+0x80/0x80
[ 1350.374807]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1350.375379]  ? __text_poke+0x2f2/0x4e0
[ 1350.375839]  ? perf_ftrace_function_call+0x4c/0x360
[ 1350.376430]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1350.377006]  ? __lock_acquire+0xa2a/0x1ba0
[ 1350.377518]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1350.378095]  ? pmd_page_vaddr+0x2b/0x70
[ 1350.378566]  ? _raw_spin_lock+0x5/0x50
[ 1350.379029]  ? _raw_spin_lock+0x5/0x50
[ 1350.379490]  ? __get_locked_pte+0x1a2/0x290
[ 1350.380000]  ? _raw_spin_lock+0x5/0x50
[ 1350.380460]  ? __get_locked_pte+0x1a2/0x290
[ 1350.380972]  ? fixed_phy_register_with_gpiod+0x1/0x80
[ 1350.381585]  ? __text_poke+0xea/0x4e0
[ 1350.382038]  ? lock_is_held_type+0xe2/0x140
[ 1350.382554]  ? fixed_phy_register_with_gpiod+0x1/0x80
[ 1350.383170]  ? text_poke+0x2b/0x60
[ 1350.383593]  ? text_poke_bp_batch+0xf5/0x2c0
[ 1350.384117]  ? e100_get_sset_count+0x50/0x50
[ 1350.384643]  ? text_poke_queue+0xa7/0xc0
[ 1350.385126]  ? ftrace_replace_code+0xfd/0x170
[ 1350.385661]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1350.386237]  ? arch_ftrace_update_code+0x9/0x10
[ 1350.386788]  ? ftrace_run_update_code+0x30/0xa0
[ 1350.387340]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1350.387842]  ? unregister_ftrace_function+0x25/0x50
[ 1350.388432]  ? perf_ftrace_event_register+0x89/0xf0
[ 1350.389023]  ? perf_tp_event_init+0xa0/0xa0
[ 1350.389536]  ? perf_trace_destroy+0x37/0x60
[ 1350.390048]  ? tp_perf_event_destroy+0x15/0x20
[ 1350.390593]  ? _free_event+0xfc/0x7d0
[ 1350.391046]  ? put_event+0x37/0x50
[ 1350.391469]  ? perf_event_release_kernel+0x2f4/0x370
[ 1350.392072]  ? perf_event_release_kernel+0x370/0x370
[ 1350.392673]  ? perf_release+0x19/0x20
[ 1350.393125]  ? __fput+0x12d/0x460
[ 1350.393542]  ? ____fput+0x1a/0x20
[ 1350.393954]  ? task_work_run+0x8e/0xf0
[ 1350.394421]  ? do_exit+0x616/0x1310
[ 1350.394855]  ? write_comp_data+0x2f/0x90
[ 1350.395340]  ? do_group_exit+0x7e/0x130
[ 1350.395816]  ? get_signal+0x249/0x13c0
[ 1350.396279]  ? get_signal+0x5/0x13c0
[ 1350.396724]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1350.397320]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1350.397906]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1350.398512]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1350.399094]  ? do_syscall_64+0x46/0x80
[ 1350.399556]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1350.400199] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1350.401131] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1350.402463] Call Trace:
[ 1350.402766]  dump_stack_lvl+0xa4/0xd3
[ 1350.403217]  dump_stack+0x15/0x17
[ 1350.403627]  check_preemption_disabled+0x167/0x180
[ 1350.404208]  ? kfree+0x2e1/0x5b0
[ 1350.404607]  ? mem_cgroup_css_alloc+0x7c0/0x7c0
[ 1350.405160]  debug_smp_processor_id+0x1c/0x20
[ 1350.405693]  perf_ftrace_function_call+0x7c/0x360
[ 1350.406271]  ? jbd2_journal_dirty_metadata+0x123/0x430
[ 1350.406892]  ? write_comp_data+0x2f/0x90
[ 1350.407374]  ? write_comp_data+0x2f/0x90
[ 1350.407856]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1350.408427]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1350.408999]  ? ext4_mark_iloc_dirty+0x901/0x1490
[ 1350.409559]  ? __ext4_journal_get_write_access+0x129/0x280
[ 1350.410227]  ? write_comp_data+0x2f/0x90
[ 1350.410713]  ? ext4_ext_remove_space+0x503/0x2260
[ 1350.411285]  ? kmemleak_free+0x5/0x60
[ 1350.411740]  ? kmemleak_free+0x5/0x60
[ 1350.412191]  ? kfree+0x2e1/0x5b0
[ 1350.412591]  ? kmemleak_free+0x5/0x60
[ 1350.413043]  ? kfree+0x2e1/0x5b0
[ 1350.413443]  ? ext4_ext_remove_space+0x503/0x2260
[ 1350.414015]  ? ext4_ext_remove_space+0x503/0x2260
[ 1350.414608]  ? ext4_ext_truncate+0x124/0x150
[ 1350.415132]  ? ext4_truncate+0x6db/0x940
[ 1350.415612]  ? write_comp_data+0x2f/0x90
[ 1350.416095]  ? ext4_evict_inode+0x512/0xfb0
[ 1350.416610]  ? ext4_da_write_begin+0x560/0x560
[ 1350.417152]  ? evict+0x102/0x210
[ 1350.417556]  ? iput+0x2e0/0x4f0
[ 1350.417950]  ? dentry_unlink_inode+0x125/0x1b0
[ 1350.418496]  ? __dentry_kill+0x179/0x280
[ 1350.418980]  ? dput.part.36+0x3a/0x870
[ 1350.419441]  ? dput.part.36+0x51e/0x870
[ 1350.419912]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1350.420486]  ? dput+0x1a/0x20
[ 1350.420859]  ? do_renameat2+0x601/0x8e0
[ 1350.421350]  ? __x64_sys_rename+0x49/0x50
[ 1350.421844]  ? do_syscall_64+0x37/0x80
[ 1350.422307]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1355.126073] check_preemption_disabled: 2314991 callbacks suppressed
[ 1355.126096] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1355.126393] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1355.127006] caller is debug_smp_processor_id+0x1c/0x20
[ 1355.127917] caller is debug_smp_processor_id+0x1c/0x20
[ 1355.128925] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1355.131188] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1355.132626] Call Trace:
[ 1355.133002]  dump_stack_lvl+0xa4/0xd3
[ 1355.133560]  dump_stack+0x15/0x17
[ 1355.134040]  check_preemption_disabled+0x167/0x180
[ 1355.134741]  ? __text_poke+0xea/0x4e0
[ 1355.135268]  ? __pmd_alloc+0x420/0x420
[ 1355.135823]  debug_smp_processor_id+0x1c/0x20
[ 1355.136430]  perf_ftrace_function_call+0x7c/0x360
[ 1355.137080]  ? text_poke+0x2b/0x60
[ 1355.137571]  ? perf_ftrace_function_call+0x4c/0x360
[ 1355.138462]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1355.139110]  ? cpu_cgroup_attach+0x1/0x70
[ 1355.139697]  0xffffffffa0098099
[ 1355.140188]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1355.140824]  ? do_sync_core+0x30/0x30
[ 1355.141434]  ? __get_locked_pte+0x5/0x290
[ 1355.142040]  __get_locked_pte+0x5/0x290
[ 1355.142590]  __text_poke+0xea/0x4e0
[ 1355.143091]  ? __get_locked_pte+0x5/0x290
[ 1355.143642]  ? __text_poke+0xea/0x4e0
[ 1355.144163]  ? cpu_cgroup_attach+0x1/0x70
[ 1355.144746]  ? lock_is_held_type+0xe2/0x140
[ 1355.145341]  ? cpu_cgroup_attach+0x1/0x70
[ 1355.145945]  text_poke+0x2b/0x60
[ 1355.146457]  text_poke_bp_batch+0xf5/0x2c0
[ 1355.147074]  ? pick_next_pushable_task+0x70/0x70
[ 1355.147757]  text_poke_queue+0xa7/0xc0
[ 1355.148336]  ftrace_replace_code+0xfd/0x170
[ 1355.148977]  ftrace_modify_all_code+0x1b1/0x270
[ 1355.149648]  arch_ftrace_update_code+0x9/0x10
[ 1355.150262]  ftrace_run_update_code+0x30/0xa0
[ 1355.150891]  ftrace_startup_enable+0x5e/0xa0
[ 1355.151508]  ftrace_startup+0x16d/0x240
[ 1355.152130]  register_ftrace_function+0x43/0x90
[ 1355.152780]  perf_ftrace_event_register+0xc1/0xf0
[ 1355.153451]  perf_trace_event_init+0xa0/0x4c0
[ 1355.154122]  perf_trace_init+0xda/0x160
[ 1355.154712]  perf_tp_event_init+0x57/0xa0
[ 1355.155300]  perf_try_init_event+0x83/0x270
[ 1355.155954]  perf_event_alloc+0xe3f/0x1c10
[ 1355.156520]  ? _raw_spin_unlock+0x2c/0x50
[ 1355.157095]  ? alloc_fd+0x20d/0x320
[ 1355.157707]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1355.158395]  ? write_comp_data+0x2f/0x90
[ 1355.159304]  __x64_sys_perf_event_open+0x26/0x30
[ 1355.159995]  do_syscall_64+0x37/0x80
[ 1355.160566]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1355.161308] RIP: 0033:0x7fac0740459d
[ 1355.161864] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1355.164393] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1355.165478] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1355.166481] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1355.167480] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1355.168480] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1355.169478] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1355.170729] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1355.170865] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1355.171631] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1355.172701] caller is debug_smp_processor_id+0x1c/0x20
[ 1355.174059] Call Trace:
[ 1355.174079]  dump_stack_lvl+0xa4/0xd3
[ 1355.174112]  dump_stack+0x15/0x17
[ 1355.174131]  check_preemption_disabled+0x167/0x180
[ 1355.174153]  ? do_nanosleep+0x155/0x2a0
[ 1355.174170]  ? hrtimer_wakeup+0x40/0x40
[ 1355.174197]  debug_smp_processor_id+0x1c/0x20
[ 1355.178116]  perf_ftrace_function_call+0x7c/0x360
[ 1355.178720]  ? ftrace_call+0x5/0x44
[ 1355.179167]  ? write_comp_data+0x2f/0x90
[ 1355.179670]  ? perf_trace_buf_update+0x70/0x70
[ 1355.180231]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1355.180828]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1355.181396]  ? __might_sleep+0x48/0x70
[ 1355.181875]  ? sched_show_task+0x70/0x70
[ 1355.182386]  ? do_nanosleep+0x9c/0x2a0
[ 1355.182874]  ? do_nanosleep+0x9c/0x2a0
[ 1355.183358]  0xffffffffa0098099
[ 1355.183771]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1355.184366]  ? lock_is_held_type+0xe2/0x140
[ 1355.184905]  ? do_nanosleep+0x140/0x2a0
[ 1355.185403]  ? hrtimer_try_to_cancel+0x5/0x290
[ 1355.185965]  ? write_comp_data+0x2f/0x90
[ 1355.186474]  hrtimer_try_to_cancel+0x5/0x290
[ 1355.187016]  do_nanosleep+0x155/0x2a0
[ 1355.187487]  ? hrtimer_try_to_cancel+0x5/0x290
[ 1355.188046]  ? do_nanosleep+0x155/0x2a0
[ 1355.188532]  ? write_comp_data+0x2f/0x90
[ 1355.189049]  hrtimer_nanosleep+0xf7/0x1b0
[ 1355.189573]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1355.190174]  __x64_sys_nanosleep+0xfc/0x150
[ 1355.190722]  do_syscall_64+0x37/0x80
[ 1355.191183]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1355.191812] RIP: 0033:0x7fac073cca18
[ 1355.192268] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1355.194484] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1355.195407] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1355.196270] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1355.197132] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1355.197996] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1355.198866] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1355.199787] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1355.199872] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1355.200845] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1355.201753] caller is debug_smp_processor_id+0x1c/0x20
[ 1355.203313] Call Trace:
[ 1355.203352]  dump_stack_lvl+0xa4/0xd3
[ 1355.204905]  dump_stack+0x15/0x17
[ 1355.205434]  check_preemption_disabled+0x167/0x180
[ 1355.206222]  debug_smp_processor_id+0x1c/0x20
[ 1355.206888]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1355.207752]  perf_trace_buf_alloc+0x3d/0x100
[ 1355.208409]  ? __text_poke+0xea/0x4e0
[ 1355.208969]  ? __pmd_alloc+0x420/0x420
[ 1355.209564]  perf_ftrace_function_call+0x209/0x360
[ 1355.210519]  ? 0xffffffffa0098099
[ 1355.211124]  ? cpu_cgroup_attach+0x1/0x70
[ 1355.211768]  0xffffffffa0098099
[ 1355.212303]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1355.213005]  ? do_sync_core+0x30/0x30
[ 1355.213672]  ? __get_locked_pte+0x5/0x290
[ 1355.214341]  __get_locked_pte+0x5/0x290
[ 1355.214936]  __text_poke+0xea/0x4e0
[ 1355.215486]  ? __get_locked_pte+0x5/0x290
[ 1355.216091]  ? __text_poke+0xea/0x4e0
[ 1355.216662]  ? cpu_cgroup_attach+0x1/0x70
[ 1355.217304]  ? lock_is_held_type+0xe2/0x140
[ 1355.217959]  ? cpu_cgroup_attach+0x1/0x70
[ 1355.218626]  text_poke+0x2b/0x60
[ 1355.219180]  text_poke_bp_batch+0xf5/0x2c0
[ 1355.219858]  ? pick_next_pushable_task+0x70/0x70
[ 1355.220606]  text_poke_queue+0xa7/0xc0
[ 1355.221240]  ftrace_replace_code+0xfd/0x170
[ 1355.221939]  ftrace_modify_all_code+0x1b1/0x270
[ 1355.222679]  arch_ftrace_update_code+0x9/0x10
[ 1355.223344]  ftrace_run_update_code+0x30/0xa0
[ 1355.224033]  ftrace_startup_enable+0x5e/0xa0
[ 1355.224709]  ftrace_startup+0x16d/0x240
[ 1355.225388]  register_ftrace_function+0x43/0x90
[ 1355.226103]  perf_ftrace_event_register+0xc1/0xf0
[ 1355.226843]  perf_trace_event_init+0xa0/0x4c0
[ 1355.227569]  perf_trace_init+0xda/0x160
[ 1355.228215]  perf_tp_event_init+0x57/0xa0
[ 1355.228860]  perf_try_init_event+0x83/0x270
[ 1355.229583]  perf_event_alloc+0xe3f/0x1c10
[ 1355.230216]  ? _raw_spin_unlock+0x2c/0x50
[ 1355.230849]  ? alloc_fd+0x20d/0x320
[ 1355.231586]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1355.232333]  ? write_comp_data+0x2f/0x90
[ 1355.233320]  __x64_sys_perf_event_open+0x26/0x30
[ 1355.234031]  do_syscall_64+0x37/0x80
[ 1355.234614]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1355.235370] RIP: 0033:0x7fac0740459d
[ 1355.235928] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1355.238463] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1355.239549] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1355.240555] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1355.241560] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1355.242570] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1355.243574] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1355.244828] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1355.244958] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1355.245722] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1355.246827] caller is debug_smp_processor_id+0x1c/0x20
[ 1355.248077] Call Trace:
[ 1355.249052]  dump_stack_lvl+0xa4/0xd3
[ 1355.249532]  dump_stack+0x15/0x17
[ 1355.249961]  check_preemption_disabled+0x167/0x180
[ 1355.250570]  ? hrtimer_try_to_cancel+0x38/0x290
[ 1355.251140]  ? __hrtimer_get_remaining+0x80/0x80
[ 1355.251732]  debug_smp_processor_id+0x1c/0x20
[ 1355.252285]  perf_ftrace_function_call+0x7c/0x360
[ 1355.252878]  ? do_nanosleep+0x155/0x2a0
[ 1355.253367]  ? hrtimer_wakeup+0x40/0x40
[ 1355.253859]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1355.254453]  ? do_nanosleep+0x155/0x2a0
[ 1355.254943]  ? perf_ftrace_function_call+0x4c/0x360
[ 1355.255566]  ? ftrace_call+0x5/0x44
[ 1355.256014]  ? write_comp_data+0x2f/0x90
[ 1355.256516]  ? perf_trace_buf_update+0x70/0x70
[ 1355.257078]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1355.257686]  ? do_nanosleep+0x9c/0x2a0
[ 1355.258173]  0xffffffffa0098099
[ 1355.258578]  ? do_nanosleep+0x9c/0x2a0
[ 1355.259067]  ? do_nanosleep+0x9c/0x2a0
[ 1355.259558]  ? do_nanosleep+0x140/0x2a0
[ 1355.260056]  ? hrtimer_active+0x5/0xb0
[ 1355.260542]  ? do_nanosleep+0x140/0x2a0
[ 1355.261032]  hrtimer_active+0x5/0xb0
[ 1355.261491]  hrtimer_try_to_cancel+0x38/0x290
[ 1355.262044]  ? hrtimer_active+0x5/0xb0
[ 1355.262526]  ? hrtimer_try_to_cancel+0x38/0x290
[ 1355.263109]  ? do_nanosleep+0x9c/0x2a0
[ 1355.263592]  do_nanosleep+0x155/0x2a0
[ 1355.264059]  ? write_comp_data+0x2f/0x90
[ 1355.264577]  hrtimer_nanosleep+0xf7/0x1b0
[ 1355.265103]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1355.265699]  __x64_sys_nanosleep+0xfc/0x150
[ 1355.266253]  do_syscall_64+0x37/0x80
[ 1355.266716]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1355.267346] RIP: 0033:0x7fac073cca18
[ 1355.267802] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1355.270024] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1355.270951] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1355.271817] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1355.272681] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1355.273547] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1355.274421] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1355.275343] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1355.275420] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1355.276313] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1355.277225] caller is debug_smp_processor_id+0x1c/0x20
[ 1355.278653] Call Trace:
[ 1355.278677]  dump_stack_lvl+0xa4/0xd3
[ 1355.280143]  dump_stack+0x15/0x17
[ 1355.280609]  check_preemption_disabled+0x167/0x180
[ 1355.281291]  debug_smp_processor_id+0x1c/0x20
[ 1355.281888]  perf_trace_buf_alloc+0x98/0x100
[ 1355.282481]  ? __text_poke+0xea/0x4e0
[ 1355.282985]  ? __pmd_alloc+0x420/0x420
[ 1355.283512]  perf_ftrace_function_call+0x209/0x360
[ 1355.284283]  ? 0xffffffffa0098099
[ 1355.284790]  ? cpu_cgroup_attach+0x1/0x70
[ 1355.285358]  0xffffffffa0098099
[ 1355.285820]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1355.286463]  ? do_sync_core+0x30/0x30
[ 1355.287030]  ? __get_locked_pte+0x5/0x290
[ 1355.287607]  __get_locked_pte+0x5/0x290
[ 1355.288141]  __text_poke+0xea/0x4e0
[ 1355.288630]  ? __get_locked_pte+0x5/0x290
[ 1355.289182]  ? __text_poke+0xea/0x4e0
[ 1355.289692]  ? cpu_cgroup_attach+0x1/0x70
[ 1355.290267]  ? lock_is_held_type+0xe2/0x140
[ 1355.290849]  ? cpu_cgroup_attach+0x1/0x70
[ 1355.291426]  text_poke+0x2b/0x60
[ 1355.291902]  text_poke_bp_batch+0xf5/0x2c0
[ 1355.292492]  ? pick_next_pushable_task+0x70/0x70
[ 1355.293147]  text_poke_queue+0xa7/0xc0
[ 1355.293695]  ftrace_replace_code+0xfd/0x170
[ 1355.294304]  ftrace_modify_all_code+0x1b1/0x270
[ 1355.294949]  arch_ftrace_update_code+0x9/0x10
[ 1355.295543]  ftrace_run_update_code+0x30/0xa0
[ 1355.296152]  ftrace_startup_enable+0x5e/0xa0
[ 1355.296749]  ftrace_startup+0x16d/0x240
[ 1355.297324]  register_ftrace_function+0x43/0x90
[ 1355.297956]  perf_ftrace_event_register+0xc1/0xf0
[ 1355.298614]  perf_trace_event_init+0xa0/0x4c0
[ 1355.299244]  perf_trace_init+0xda/0x160
[ 1355.299804]  perf_tp_event_init+0x57/0xa0
[ 1355.300371]  perf_try_init_event+0x83/0x270
[ 1355.300985]  perf_event_alloc+0xe3f/0x1c10
[ 1355.301546]  ? _raw_spin_unlock+0x2c/0x50
[ 1355.302115]  ? alloc_fd+0x20d/0x320
[ 1355.302666]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1355.303332]  ? write_comp_data+0x2f/0x90
[ 1355.304076]  __x64_sys_perf_event_open+0x26/0x30
[ 1355.304710]  do_syscall_64+0x37/0x80
[ 1355.305216]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1355.305891] RIP: 0033:0x7fac0740459d
[ 1355.306392] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1355.308736] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1355.309723] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1355.310647] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1355.311568] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1355.312488] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1355.313406] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1355.314462] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1355.314583] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1355.315356] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1355.316349] caller is debug_smp_processor_id+0x1c/0x20
[ 1355.317701] Call Trace:
[ 1355.318682]  dump_stack_lvl+0xa4/0xd3
[ 1355.319163]  dump_stack+0x15/0x17
[ 1355.319592]  check_preemption_disabled+0x167/0x180
[ 1355.320195]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1355.320786]  ? __bpf_trace_sys_enter+0x10/0x10
[ 1355.321353]  debug_smp_processor_id+0x1c/0x20
[ 1355.321907]  perf_ftrace_function_call+0x7c/0x360
[ 1355.322515]  ? write_comp_data+0x2f/0x90
[ 1355.323028]  ? write_comp_data+0x2f/0x90
[ 1355.323537]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1355.324137]  ? write_comp_data+0x2f/0x90
[ 1355.324647]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1355.325260]  0xffffffffa0098099
[ 1355.325666]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1355.326304]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1355.326988]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1355.327585]  syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1355.328249]  syscall_exit_to_user_mode+0xd/0x60
[ 1355.328824]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1355.329506]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1355.330111]  do_syscall_64+0x46/0x80
[ 1355.330580]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1355.331214] RIP: 0033:0x7fac073cca18
[ 1355.331673] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1355.333894] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1355.334829] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1355.335704] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1355.336570] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1355.337437] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1355.338314] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1355.339238] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1355.339308] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1355.340208] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1355.341123] caller is debug_smp_processor_id+0x1c/0x20
[ 1355.342563] Call Trace:
[ 1355.342586]  dump_stack_lvl+0xa4/0xd3
[ 1355.344056]  dump_stack+0x15/0x17
[ 1355.344533]  check_preemption_disabled+0x167/0x180
[ 1355.345217]  debug_smp_processor_id+0x1c/0x20
[ 1355.345815]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1355.346557]  perf_tp_event+0x331/0x4e0
[ 1355.347254]  ? arch_local_irq_enable+0x10/0x12
[ 1355.347867]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1355.348519]  ? dump_stack_lvl+0xcc/0xd3
[ 1355.349070]  ? dump_stack+0x15/0x17
[ 1355.349558]  ? check_preemption_disabled+0x167/0x180
[ 1355.350412]  ? __text_poke+0xea/0x4e0
[ 1355.350920]  ? __pmd_alloc+0x420/0x420
[ 1355.351515]  perf_ftrace_function_call+0x248/0x360
[ 1355.352167]  ? perf_ftrace_function_call+0x248/0x360
[ 1355.352974]  ? 0xffffffffa0098099
[ 1355.353483]  ? cpu_cgroup_attach+0x1/0x70
[ 1355.354056]  0xffffffffa0098099
[ 1355.354520]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1355.355144]  ? do_sync_core+0x30/0x30
[ 1355.355705]  ? __get_locked_pte+0x5/0x290
[ 1355.356284]  __get_locked_pte+0x5/0x290
[ 1355.356819]  __text_poke+0xea/0x4e0
[ 1355.357311]  ? __get_locked_pte+0x5/0x290
[ 1355.357860]  ? __text_poke+0xea/0x4e0
[ 1355.358375]  ? cpu_cgroup_attach+0x1/0x70
[ 1355.358943]  ? lock_is_held_type+0xe2/0x140
[ 1355.359527]  ? cpu_cgroup_attach+0x1/0x70
[ 1355.360106]  text_poke+0x2b/0x60
[ 1355.360583]  text_poke_bp_batch+0xf5/0x2c0
[ 1355.361175]  ? pick_next_pushable_task+0x70/0x70
[ 1355.361838]  text_poke_queue+0xa7/0xc0
[ 1355.362397]  ftrace_replace_code+0xfd/0x170
[ 1355.363007]  ftrace_modify_all_code+0x1b1/0x270
[ 1355.363650]  arch_ftrace_update_code+0x9/0x10
[ 1355.364249]  ftrace_run_update_code+0x30/0xa0
[ 1355.364861]  ftrace_startup_enable+0x5e/0xa0
[ 1355.365461]  ftrace_startup+0x16d/0x240
[ 1355.366040]  register_ftrace_function+0x43/0x90
[ 1355.366675]  perf_ftrace_event_register+0xc1/0xf0
[ 1355.367329]  perf_trace_event_init+0xa0/0x4c0
[ 1355.367961]  perf_trace_init+0xda/0x160
[ 1355.368522]  perf_tp_event_init+0x57/0xa0
[ 1355.369091]  perf_try_init_event+0x83/0x270
[ 1355.369707]  perf_event_alloc+0xe3f/0x1c10
[ 1355.370274]  ? _raw_spin_unlock+0x2c/0x50
[ 1355.370837]  ? alloc_fd+0x20d/0x320
[ 1355.371391]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1355.372056]  ? write_comp_data+0x2f/0x90
[ 1355.372803]  __x64_sys_perf_event_open+0x26/0x30
[ 1355.373440]  do_syscall_64+0x37/0x80
[ 1355.373948]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1355.374636] RIP: 0033:0x7fac0740459d
[ 1355.375136] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1355.377491] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1355.378491] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1355.379416] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1355.380343] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1355.381269] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1355.382196] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1355.383253] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1355.383379] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1355.384149] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1355.385221] caller is debug_smp_processor_id+0x1c/0x20
[ 1355.386578] Call Trace:
[ 1355.386591]  dump_stack_lvl+0xa4/0xd3
[ 1355.386619]  dump_stack+0x15/0x17
[ 1355.386638]  check_preemption_disabled+0x167/0x180
[ 1355.386660]  ? syscall_exit_to_user_mode_prepare+0x1c8/0x240
[ 1355.386677]  ? __audit_syscall_entry+0x1e0/0x1e0
[ 1355.386704]  debug_smp_processor_id+0x1c/0x20
[ 1355.390926]  perf_ftrace_function_call+0x7c/0x360
[ 1355.391519]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1355.392113]  ? perf_ftrace_function_call+0x4c/0x360
[ 1355.392730]  ? write_comp_data+0x2f/0x90
[ 1355.393241]  ? write_comp_data+0x2f/0x90
[ 1355.393748]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1355.394350]  ? write_comp_data+0x2f/0x90
[ 1355.394872]  0xffffffffa0098099
[ 1355.395288]  ? 0xffffffffa0098099
[ 1355.395745]  ? __audit_syscall_exit+0x5/0x400
[ 1355.396304]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1355.396986]  __audit_syscall_exit+0x5/0x400
[ 1355.397519]  syscall_exit_to_user_mode_prepare+0x1c8/0x240
[ 1355.398207]  ? __audit_syscall_exit+0x5/0x400
[ 1355.398757]  ? syscall_exit_to_user_mode_prepare+0x1c8/0x240
[ 1355.399465]  syscall_exit_to_user_mode+0xd/0x60
[ 1355.400040]  do_syscall_64+0x46/0x80
[ 1355.400502]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1355.401134] RIP: 0033:0x7fac073cca18
[ 1355.401590] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1355.403811] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1355.404733] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1355.405597] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1355.406464] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1355.407328] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1355.408193] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1355.409116] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1355.409169] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1355.410173] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1355.410200] Call Trace:
[ 1355.411111] caller is debug_smp_processor_id+0x1c/0x20
[ 1355.412673]  dump_stack_lvl+0xa4/0xd3
[ 1355.414253]  dump_stack+0x15/0x17
[ 1355.414780]  check_preemption_disabled+0x167/0x180
[ 1355.415503]  ? __get_locked_pte+0x1a2/0x290
[ 1355.416130]  ? __lock_text_start+0x8/0x8
[ 1355.416757]  debug_smp_processor_id+0x1c/0x20
[ 1355.417421]  perf_ftrace_function_call+0x7c/0x360
[ 1355.418122]  ? __pmd_alloc+0x420/0x420
[ 1355.418715]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1355.419422]  ? __text_poke+0xea/0x4e0
[ 1355.419990]  ? perf_ftrace_function_call+0x4c/0x360
[ 1355.420994]  0xffffffffa0098099
[ 1355.421526]  ? cpu_cgroup_attach+0x1/0x70
[ 1355.422170]  ? 0xffffffffa0098099
[ 1355.422723]  ? pmd_page_vaddr+0x2b/0x70
[ 1355.423350]  ? _raw_spin_lock+0x5/0x50
[ 1355.423979]  _raw_spin_lock+0x5/0x50
[ 1355.424539]  __get_locked_pte+0x1a2/0x290
[ 1355.425155]  ? _raw_spin_lock+0x5/0x50
[ 1355.425724]  ? __get_locked_pte+0x1a2/0x290
[ 1355.426389]  ? cpu_cgroup_attach+0x1/0x70
[ 1355.427026]  __text_poke+0xea/0x4e0
[ 1355.427578]  ? cpu_cgroup_attach+0x1/0x70
[ 1355.428217]  ? lock_is_held_type+0xe2/0x140
[ 1355.428868]  ? cpu_cgroup_attach+0x1/0x70
[ 1355.429551]  text_poke+0x2b/0x60
[ 1355.430117]  text_poke_bp_batch+0xf5/0x2c0
[ 1355.430793]  ? pick_next_pushable_task+0x70/0x70
[ 1355.431536]  text_poke_queue+0xa7/0xc0
[ 1355.432169]  ftrace_replace_code+0xfd/0x170
[ 1355.432868]  ftrace_modify_all_code+0x1b1/0x270
[ 1355.433602]  arch_ftrace_update_code+0x9/0x10
[ 1355.434268]  ftrace_run_update_code+0x30/0xa0
[ 1355.434952]  ftrace_startup_enable+0x5e/0xa0
[ 1355.435634]  ftrace_startup+0x16d/0x240
[ 1355.436309]  register_ftrace_function+0x43/0x90
[ 1355.437016]  perf_ftrace_event_register+0xc1/0xf0
[ 1355.437747]  perf_trace_event_init+0xa0/0x4c0
[ 1355.438473]  perf_trace_init+0xda/0x160
[ 1355.439113]  perf_tp_event_init+0x57/0xa0
[ 1355.439753]  perf_try_init_event+0x83/0x270
[ 1355.440463]  perf_event_alloc+0xe3f/0x1c10
[ 1355.441080]  ? _raw_spin_unlock+0x2c/0x50
[ 1355.441710]  ? alloc_fd+0x20d/0x320
[ 1355.442376]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1355.443118]  ? write_comp_data+0x2f/0x90
[ 1355.444095]  __x64_sys_perf_event_open+0x26/0x30
[ 1355.444801]  do_syscall_64+0x37/0x80
[ 1355.445370]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1355.446117] RIP: 0033:0x7fac0740459d
[ 1355.446669] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1355.449220] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1355.450314] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1355.451319] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1355.452323] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1355.453325] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1355.454328] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1355.455580] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1355.456484] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1355.457853] Call Trace:
[ 1355.458181]  dump_stack_lvl+0xa4/0xd3
[ 1355.458661]  dump_stack+0x15/0x17
[ 1355.459091]  check_preemption_disabled+0x167/0x180
[ 1355.459695]  ? __audit_syscall_exit+0x190/0x400
[ 1355.460268]  ? path_get+0x40/0x40
[ 1355.460705]  debug_smp_processor_id+0x1c/0x20
[ 1355.461259]  perf_ftrace_function_call+0x7c/0x360
[ 1355.461851]  ? syscall_exit_to_user_mode_prepare+0x1c8/0x240
[ 1355.462555]  ? __audit_syscall_entry+0x1e0/0x1e0
[ 1355.463138]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1355.463730]  ? syscall_exit_to_user_mode_prepare+0x1c8/0x240
[ 1355.464432]  ? perf_ftrace_function_call+0x4c/0x360
[ 1355.465044]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1355.465637]  ? perf_ftrace_function_call+0x4c/0x360
[ 1355.466257]  ? write_comp_data+0x2f/0x90
[ 1355.466769]  ? write_comp_data+0x2f/0x90
[ 1355.467293]  0xffffffffa0098099
[ 1355.467718]  ? 0xffffffffa0098099
[ 1355.468150]  ? __audit_syscall_exit+0xbb/0x400
[ 1355.468721]  ? path_put+0x5/0x30
[ 1355.469139]  ? write_comp_data+0x2f/0x90
[ 1355.469644]  path_put+0x5/0x30
[ 1355.470043]  __audit_syscall_exit+0x190/0x400
[ 1355.470602]  ? path_put+0x5/0x30
[ 1355.471017]  ? __audit_syscall_exit+0x190/0x400
[ 1355.471586]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1355.472281]  syscall_exit_to_user_mode_prepare+0x1c8/0x240
[ 1355.472968]  syscall_exit_to_user_mode+0xd/0x60
[ 1355.473543]  do_syscall_64+0x46/0x80
[ 1355.474005]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1355.474646] RIP: 0033:0x7fac073cca18
[ 1355.475102] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1355.477341] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1355.478268] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1355.479133] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1355.479996] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1355.480861] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1355.481723] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1360.130131] check_preemption_disabled: 974975 callbacks suppressed
[ 1360.130161] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1360.130255] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1360.131041] caller is debug_smp_processor_id+0x1c/0x20
[ 1360.131911] caller is debug_smp_processor_id+0x1c/0x20
[ 1360.132935] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1360.135175] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1360.136674] Call Trace:
[ 1360.137070]  dump_stack_lvl+0xa4/0xd3
[ 1360.137672]  dump_stack+0x15/0x17
[ 1360.138189]  check_preemption_disabled+0x167/0x180
[ 1360.138910]  ? __get_locked_pte+0x1a2/0x290
[ 1360.139536]  ? __lock_text_start+0x8/0x8
[ 1360.140156]  debug_smp_processor_id+0x1c/0x20
[ 1360.140788]  perf_ftrace_function_call+0x7c/0x360
[ 1360.141734]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1360.142411]  ? write_comp_data+0x2f/0x90
[ 1360.143008]  ? perf_trace_buf_update+0x70/0x70
[ 1360.143772]  0xffffffffa0098099
[ 1360.144307]  ? nfs4_proc_pathconf+0xd0/0xd0
[ 1360.144969]  ? ftrace_call+0x5/0x44
[ 1360.145532]  ? pmd_page_vaddr+0x2b/0x70
[ 1360.146157]  ? _raw_spin_lock+0x5/0x50
[ 1360.146785]  _raw_spin_lock+0x5/0x50
[ 1360.147326]  __get_locked_pte+0x1a2/0x290
[ 1360.147917]  ? _raw_spin_lock+0x5/0x50
[ 1360.148460]  ? __get_locked_pte+0x1a2/0x290
[ 1360.149104]  ? nfs4_proc_pathconf+0xd0/0xd0
[ 1360.149747]  __text_poke+0xea/0x4e0
[ 1360.150285]  ? nfs4_proc_pathconf+0xd0/0xd0
[ 1360.150929]  ? lock_is_held_type+0xe2/0x140
[ 1360.151558]  ? nfs4_proc_pathconf+0xd0/0xd0
[ 1360.152236]  text_poke+0x2b/0x60
[ 1360.152783]  text_poke_bp_batch+0x93/0x2c0
[ 1360.153451]  ? nfs4_xdr_enc_open_noattr+0x1b0/0x1b0
[ 1360.154225]  text_poke_queue+0xa7/0xc0
[ 1360.154854]  ftrace_replace_code+0xfd/0x170
[ 1360.155549]  ftrace_modify_all_code+0x1b1/0x270
[ 1360.156269]  arch_ftrace_update_code+0x9/0x10
[ 1360.156903]  ftrace_run_update_code+0x30/0xa0
[ 1360.157569]  ftrace_startup_enable+0x5e/0xa0
[ 1360.158239]  ftrace_startup+0x16d/0x240
[ 1360.158964]  register_ftrace_function+0x43/0x90
[ 1360.159686]  perf_ftrace_event_register+0xc1/0xf0
[ 1360.160425]  perf_trace_event_init+0xa0/0x4c0
[ 1360.161173]  perf_trace_init+0xda/0x160
[ 1360.161827]  perf_tp_event_init+0x57/0xa0
[ 1360.162478]  perf_try_init_event+0x83/0x270
[ 1360.163230]  perf_event_alloc+0xe3f/0x1c10
[ 1360.163858]  ? _raw_spin_unlock+0x2c/0x50
[ 1360.164519]  ? alloc_fd+0x20d/0x320
[ 1360.165270]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1360.166059]  ? write_comp_data+0x2f/0x90
[ 1360.167256]  __x64_sys_perf_event_open+0x26/0x30
[ 1360.167997]  do_syscall_64+0x37/0x80
[ 1360.168602]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1360.169368] RIP: 0033:0x7fac0740459d
[ 1360.169950] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1360.172500] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1360.173624] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1360.174652] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1360.175677] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1360.176703] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1360.177728] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1360.179129] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1360.179316] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1360.180090] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1360.181178] caller is debug_smp_processor_id+0x1c/0x20
[ 1360.182542] Call Trace:
[ 1360.182573]  dump_stack_lvl+0xa4/0xd3
[ 1360.182639]  dump_stack+0x15/0x17
[ 1360.182675]  check_preemption_disabled+0x167/0x180
[ 1360.182714]  ? lock_timer_base+0x34/0x100
[ 1360.185716]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1360.186343]  debug_smp_processor_id+0x1c/0x20
[ 1360.186926]  perf_ftrace_function_call+0x7c/0x360
[ 1360.187570]  ? ftrace_ops_test+0x71/0xc0
[ 1360.188136]  ? ftrace_ops_test+0x71/0xc0
[ 1360.188676]  ? perf_trace_buf_update+0x70/0x70
[ 1360.189270]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1360.189910]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1360.190517]  ? write_comp_data+0x2f/0x90
[ 1360.191057]  ? perf_trace_buf_update+0x70/0x70
[ 1360.191716]  0xffffffffa0098099
[ 1360.192215]  ? ftrace_call+0x5/0x44
[ 1360.192711]  ? lock_timer_base+0xc0/0x100
[ 1360.193280]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1360.193874]  ? write_comp_data+0x2f/0x90
[ 1360.194432]  _raw_spin_lock_irqsave+0x5/0x70
[ 1360.195005]  lock_timer_base+0x34/0x100
[ 1360.195526]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1360.196110]  ? lock_timer_base+0x34/0x100
[ 1360.196707]  try_to_del_timer_sync+0x33/0x90
[ 1360.197271]  ? try_to_del_timer_sync+0x5/0x90
[ 1360.197882]  del_timer_sync+0xd3/0x130
[ 1360.198505]  schedule_timeout+0x34e/0x610
[ 1360.199105]  ? del_timer_sync+0x130/0x130
[ 1360.199683]  ? i915_init_ggtt+0x40/0x6b0
[ 1360.200280]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1360.200875]  ? rcu_gp_init+0x730/0x730
[ 1360.201384]  rcu_gp_kthread+0xdd/0x170
[ 1360.201940]  kthread+0x1e7/0x230
[ 1360.202407]  ? set_kthread_struct+0x80/0x80
[ 1360.203006]  ret_from_fork+0x1f/0x30
[ 1360.203684] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1360.203805] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1360.204753] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1360.205725] caller is debug_smp_processor_id+0x1c/0x20
[ 1360.207282] Call Trace:
[ 1360.207336]  dump_stack_lvl+0xa4/0xd3
[ 1360.208964]  dump_stack+0x15/0x17
[ 1360.209516]  check_preemption_disabled+0x167/0x180
[ 1360.210358]  debug_smp_processor_id+0x1c/0x20
[ 1360.211050]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1360.211968]  perf_trace_buf_alloc+0x3d/0x100
[ 1360.212650]  ? __get_locked_pte+0x1a2/0x290
[ 1360.213299]  ? __lock_text_start+0x8/0x8
[ 1360.213951]  perf_ftrace_function_call+0x209/0x360
[ 1360.215043]  ? 0xffffffffa0098099
[ 1360.215784]  0xffffffffa0098099
[ 1360.216361]  ? nfs4_proc_pathconf+0xd0/0xd0
[ 1360.217061]  ? ftrace_call+0x5/0x44
[ 1360.217671]  ? pmd_page_vaddr+0x2b/0x70
[ 1360.218350]  ? _raw_spin_lock+0x5/0x50
[ 1360.219032]  _raw_spin_lock+0x5/0x50
[ 1360.219623]  __get_locked_pte+0x1a2/0x290
[ 1360.220268]  ? _raw_spin_lock+0x5/0x50
[ 1360.220860]  ? __get_locked_pte+0x1a2/0x290
[ 1360.221562]  ? nfs4_proc_pathconf+0xd0/0xd0
[ 1360.222269]  __text_poke+0xea/0x4e0
[ 1360.222845]  ? nfs4_proc_pathconf+0xd0/0xd0
[ 1360.223544]  ? lock_is_held_type+0xe2/0x140
[ 1360.224229]  ? nfs4_proc_pathconf+0xd0/0xd0
[ 1360.224965]  text_poke+0x2b/0x60
[ 1360.225560]  text_poke_bp_batch+0x93/0x2c0
[ 1360.226289]  ? nfs4_xdr_enc_open_noattr+0x1b0/0x1b0
[ 1360.227121]  text_poke_queue+0xa7/0xc0
[ 1360.227803]  ftrace_replace_code+0xfd/0x170
[ 1360.228559]  ftrace_modify_all_code+0x1b1/0x270
[ 1360.229345]  arch_ftrace_update_code+0x9/0x10
[ 1360.230056]  ftrace_run_update_code+0x30/0xa0
[ 1360.230789]  ftrace_startup_enable+0x5e/0xa0
[ 1360.231503]  ftrace_startup+0x16d/0x240
[ 1360.232250]  register_ftrace_function+0x43/0x90
[ 1360.233001]  perf_ftrace_event_register+0xc1/0xf0
[ 1360.233774]  perf_trace_event_init+0xa0/0x4c0
[ 1360.234559]  perf_trace_init+0xda/0x160
[ 1360.235254]  perf_tp_event_init+0x57/0xa0
[ 1360.235933]  perf_try_init_event+0x83/0x270
[ 1360.236709]  perf_event_alloc+0xe3f/0x1c10
[ 1360.237348]  ? _raw_spin_unlock+0x2c/0x50
[ 1360.238010]  ? alloc_fd+0x20d/0x320
[ 1360.238763]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1360.239570]  ? write_comp_data+0x2f/0x90
[ 1360.240776]  __x64_sys_perf_event_open+0x26/0x30
[ 1360.241519]  do_syscall_64+0x37/0x80
[ 1360.242127]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1360.242895] RIP: 0033:0x7fac0740459d
[ 1360.243474] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1360.246026] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1360.247150] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1360.248173] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1360.249198] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1360.250227] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1360.251252] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1360.252649] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1360.252821] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1360.253611] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1360.254765] caller is debug_smp_processor_id+0x1c/0x20
[ 1360.255981] Call Trace:
[ 1360.256982]  dump_stack_lvl+0xa4/0xd3
[ 1360.257510]  dump_stack+0x15/0x17
[ 1360.257967]  check_preemption_disabled+0x167/0x180
[ 1360.258611]  ? prepare_to_swait_event+0x1b/0xf0
[ 1360.259201]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1360.259822]  debug_smp_processor_id+0x1c/0x20
[ 1360.260405]  perf_ftrace_function_call+0x7c/0x360
[ 1360.261017]  ? ftrace_ops_test+0x71/0xc0
[ 1360.261627]  ? trace_hardirqs_on+0x3f/0x170
[ 1360.262228]  ? write_comp_data+0x2f/0x90
[ 1360.262767]  ? perf_trace_buf_update+0x70/0x70
[ 1360.263357]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1360.264052]  0xffffffffa0098099
[ 1360.264531]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1360.265187]  ? del_timer_sync+0xde/0x130
[ 1360.265745]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1360.266376]  _raw_spin_lock_irqsave+0x5/0x70
[ 1360.266947]  prepare_to_swait_event+0x1b/0xf0
[ 1360.267528]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1360.268108]  ? prepare_to_swait_event+0x1b/0xf0
[ 1360.268735]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1360.269327]  ? rcu_gp_init+0x730/0x730
[ 1360.269834]  rcu_gp_kthread+0xdd/0x170
[ 1360.270393]  kthread+0x1e7/0x230
[ 1360.270851]  ? set_kthread_struct+0x80/0x80
[ 1360.271447]  ret_from_fork+0x1f/0x30
[ 1360.272124] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1360.272239] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1360.273108] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1360.274149] caller is debug_smp_processor_id+0x1c/0x20
[ 1360.275533] Call Trace:
[ 1360.276525]  dump_stack_lvl+0xa4/0xd3
[ 1360.277098]  dump_stack+0x15/0x17
[ 1360.277591]  check_preemption_disabled+0x167/0x180
[ 1360.278333]  debug_smp_processor_id+0x1c/0x20
[ 1360.278957]  perf_trace_buf_alloc+0x98/0x100
[ 1360.279571]  ? __get_locked_pte+0x1a2/0x290
[ 1360.280157]  ? __lock_text_start+0x8/0x8
[ 1360.280741]  perf_ftrace_function_call+0x209/0x360
[ 1360.281647]  ? 0xffffffffa0098099
[ 1360.282275]  0xffffffffa0098099
[ 1360.282778]  ? nfs4_proc_pathconf+0xd0/0xd0
[ 1360.283403]  ? ftrace_call+0x5/0x44
[ 1360.283942]  ? pmd_page_vaddr+0x2b/0x70
[ 1360.284536]  ? _raw_spin_lock+0x5/0x50
[ 1360.285132]  _raw_spin_lock+0x5/0x50
[ 1360.285659]  __get_locked_pte+0x1a2/0x290
[ 1360.286242]  ? _raw_spin_lock+0x5/0x50
[ 1360.286777]  ? __get_locked_pte+0x1a2/0x290
[ 1360.287401]  ? nfs4_proc_pathconf+0xd0/0xd0
[ 1360.288030]  __text_poke+0xea/0x4e0
[ 1360.288547]  ? nfs4_proc_pathconf+0xd0/0xd0
[ 1360.289171]  ? lock_is_held_type+0xe2/0x140
[ 1360.289786]  ? nfs4_proc_pathconf+0xd0/0xd0
[ 1360.290444]  text_poke+0x2b/0x60
[ 1360.290964]  text_poke_bp_batch+0x93/0x2c0
[ 1360.291602]  ? nfs4_xdr_enc_open_noattr+0x1b0/0x1b0
[ 1360.292337]  text_poke_queue+0xa7/0xc0
[ 1360.292935]  ftrace_replace_code+0xfd/0x170
[ 1360.293600]  ftrace_modify_all_code+0x1b1/0x270
[ 1360.294302]  arch_ftrace_update_code+0x9/0x10
[ 1360.294927]  ftrace_run_update_code+0x30/0xa0
[ 1360.295572]  ftrace_startup_enable+0x5e/0xa0
[ 1360.296208]  ftrace_startup+0x16d/0x240
[ 1360.296850]  register_ftrace_function+0x43/0x90
[ 1360.297519]  perf_ftrace_event_register+0xc1/0xf0
[ 1360.298220]  perf_trace_event_init+0xa0/0x4c0
[ 1360.298906]  perf_trace_init+0xda/0x160
[ 1360.299514]  perf_tp_event_init+0x57/0xa0
[ 1360.300120]  perf_try_init_event+0x83/0x270
[ 1360.300798]  perf_event_alloc+0xe3f/0x1c10
[ 1360.301379]  ? _raw_spin_unlock+0x2c/0x50
[ 1360.301972]  ? alloc_fd+0x20d/0x320
[ 1360.302615]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1360.303313]  ? write_comp_data+0x2f/0x90
[ 1360.304265]  __x64_sys_perf_event_open+0x26/0x30
[ 1360.304930]  do_syscall_64+0x37/0x80
[ 1360.305466]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1360.306166] RIP: 0033:0x7fac0740459d
[ 1360.306687] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1360.309057] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1360.310119] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1360.311133] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1360.312132] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1360.313135] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1360.314137] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1360.315416] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1360.315596] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1360.316441] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1360.317495] caller is debug_smp_processor_id+0x1c/0x20
[ 1360.318976] Call Trace:
[ 1360.319008]  dump_stack_lvl+0xa4/0xd3
[ 1360.319081]  dump_stack+0x15/0x17
[ 1360.319120]  check_preemption_disabled+0x167/0x180
[ 1360.319163]  ? finish_swait+0x41/0x80
[ 1360.322118]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1360.322739]  debug_smp_processor_id+0x1c/0x20
[ 1360.323332]  perf_ftrace_function_call+0x7c/0x360
[ 1360.323945]  ? ftrace_ops_test+0x71/0xc0
[ 1360.324482]  ? rcu_advance_cbs+0x70/0x70
[ 1360.325037]  ? write_comp_data+0x2f/0x90
[ 1360.325575]  ? perf_trace_buf_update+0x70/0x70
[ 1360.326170]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1360.326810]  ? write_comp_data+0x2f/0x90
[ 1360.327347]  ? perf_trace_buf_update+0x70/0x70
[ 1360.327937]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1360.328631]  0xffffffffa0098099
[ 1360.329128]  ? trace_hardirqs_on+0x3f/0x170
[ 1360.329753]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1360.330386]  _raw_spin_lock_irqsave+0x5/0x70
[ 1360.330957]  finish_swait+0x41/0x80
[ 1360.331436]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1360.332016]  ? finish_swait+0x41/0x80
[ 1360.332540]  rcu_gp_fqs_loop+0x2da/0x410
[ 1360.333131]  ? rcu_gp_init+0x730/0x730
[ 1360.333638]  rcu_gp_kthread+0xdd/0x170
[ 1360.334194]  kthread+0x1e7/0x230
[ 1360.334654]  ? set_kthread_struct+0x80/0x80
[ 1360.335253]  ret_from_fork+0x1f/0x30
[ 1360.335929] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1360.336054] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1360.336918] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1360.337890] caller is debug_smp_processor_id+0x1c/0x20
[ 1360.339339] Call Trace:
[ 1360.339376]  dump_stack_lvl+0xa4/0xd3
[ 1360.339459]  dump_stack+0x15/0x17
[ 1360.341330]  check_preemption_disabled+0x167/0x180
[ 1360.342074]  debug_smp_processor_id+0x1c/0x20
[ 1360.342701]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1360.343480]  perf_tp_event+0x331/0x4e0
[ 1360.344367]  ? arch_local_irq_enable+0x10/0x12
[ 1360.345014]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1360.345706]  ? dump_stack_lvl+0xcc/0xd3
[ 1360.346305]  ? dump_stack+0x15/0x17
[ 1360.346821]  ? check_preemption_disabled+0x167/0x180
[ 1360.347581]  ? __get_locked_pte+0x1a2/0x290
[ 1360.348170]  ? __lock_text_start+0x8/0x8
[ 1360.348766]  perf_ftrace_function_call+0x248/0x360
[ 1360.349434]  ? perf_ftrace_function_call+0x248/0x360
[ 1360.350391]  ? 0xffffffffa0098099
[ 1360.351014]  0xffffffffa0098099
[ 1360.351519]  ? nfs4_proc_pathconf+0xd0/0xd0
[ 1360.352148]  ? ftrace_call+0x5/0x44
[ 1360.352689]  ? pmd_page_vaddr+0x2b/0x70
[ 1360.353282]  ? _raw_spin_lock+0x5/0x50
[ 1360.353879]  _raw_spin_lock+0x5/0x50
[ 1360.354413]  __get_locked_pte+0x1a2/0x290
[ 1360.354994]  ? _raw_spin_lock+0x5/0x50
[ 1360.355530]  ? __get_locked_pte+0x1a2/0x290
[ 1360.356156]  ? nfs4_proc_pathconf+0xd0/0xd0
[ 1360.356781]  __text_poke+0xea/0x4e0
[ 1360.357299]  ? nfs4_proc_pathconf+0xd0/0xd0
[ 1360.357919]  ? lock_is_held_type+0xe2/0x140
[ 1360.358538]  ? nfs4_proc_pathconf+0xd0/0xd0
[ 1360.359188]  text_poke+0x2b/0x60
[ 1360.359709]  text_poke_bp_batch+0x93/0x2c0
[ 1360.360348]  ? nfs4_xdr_enc_open_noattr+0x1b0/0x1b0
[ 1360.361088]  text_poke_queue+0xa7/0xc0
[ 1360.361687]  ftrace_replace_code+0xfd/0x170
[ 1360.362353]  ftrace_modify_all_code+0x1b1/0x270
[ 1360.363047]  arch_ftrace_update_code+0x9/0x10
[ 1360.363671]  ftrace_run_update_code+0x30/0xa0
[ 1360.364319]  ftrace_startup_enable+0x5e/0xa0
[ 1360.364957]  ftrace_startup+0x16d/0x240
[ 1360.365601]  register_ftrace_function+0x43/0x90
[ 1360.366281]  perf_ftrace_event_register+0xc1/0xf0
[ 1360.366973]  perf_trace_event_init+0xa0/0x4c0
[ 1360.367656]  perf_trace_init+0xda/0x160
[ 1360.368266]  perf_tp_event_init+0x57/0xa0
[ 1360.368872]  perf_try_init_event+0x83/0x270
[ 1360.369549]  perf_event_alloc+0xe3f/0x1c10
[ 1360.370133]  ? _raw_spin_unlock+0x2c/0x50
[ 1360.370726]  ? alloc_fd+0x20d/0x320
[ 1360.371361]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1360.372063]  ? write_comp_data+0x2f/0x90
[ 1360.373018]  __x64_sys_perf_event_open+0x26/0x30
[ 1360.373693]  do_syscall_64+0x37/0x80
[ 1360.374242]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1360.374990] RIP: 0033:0x7fac0740459d
[ 1360.375520] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1360.377899] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1360.378950] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1360.379891] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1360.380830] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1360.381772] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1360.382728] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1360.383921] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1360.384122] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1360.384890] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1360.386156] caller is debug_smp_processor_id+0x1c/0x20
[ 1360.387357] Call Trace:
[ 1360.388417]  dump_stack_lvl+0xa4/0xd3
[ 1360.388946]  dump_stack+0x15/0x17
[ 1360.389405]  check_preemption_disabled+0x167/0x180
[ 1360.390039]  ? force_qs_rnp+0xd0/0x2c0
[ 1360.390550]  ? preempt_schedule+0x30/0x30
[ 1360.391110]  debug_smp_processor_id+0x1c/0x20
[ 1360.391695]  perf_ftrace_function_call+0x7c/0x360
[ 1360.392311]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1360.392954]  ? ftrace_ops_test+0x71/0xc0
[ 1360.393499]  ? rcu_advance_cbs+0x70/0x70
[ 1360.394060]  ? write_comp_data+0x2f/0x90
[ 1360.394607]  ? perf_trace_buf_update+0x70/0x70
[ 1360.395200]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1360.395842]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1360.396435]  ? force_qs_rnp+0xcb/0x2c0
[ 1360.396946]  ? sched_show_task+0x70/0x70
[ 1360.397506]  ? rcu_gp_torture_wait+0x20/0x20
[ 1360.398098]  0xffffffffa0098099
[ 1360.398533]  ? rcu_exp_wait_wake+0x4c0/0x4c0
[ 1360.399233]  ? __cond_resched+0x5/0x30
[ 1360.399761]  ? ___might_sleep+0x143/0x170
[ 1360.400302]  __cond_resched+0x5/0x30
[ 1360.400792]  force_qs_rnp+0xd0/0x2c0
[ 1360.401281]  ? __cond_resched+0x5/0x30
[ 1360.401781]  ? force_qs_rnp+0xd0/0x2c0
[ 1360.402363]  rcu_gp_fqs_loop+0x2eb/0x410
[ 1360.402959]  ? rcu_gp_init+0x730/0x730
[ 1360.403470]  rcu_gp_kthread+0xdd/0x170
[ 1360.404028]  kthread+0x1e7/0x230
[ 1360.404489]  ? set_kthread_struct+0x80/0x80
[ 1360.405087]  ret_from_fork+0x1f/0x30
[ 1360.405766] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1360.405917] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1360.406862] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1360.406899] Call Trace:
[ 1360.406951]  dump_stack_lvl+0xa4/0xd3
[ 1360.408001] caller is debug_smp_processor_id+0x1c/0x20
[ 1360.409635]  dump_stack+0x15/0x17
[ 1360.411657]  check_preemption_disabled+0x167/0x180
[ 1360.412406]  ? __get_locked_pte+0x1a2/0x290
[ 1360.413054]  ? __lock_text_start+0x8/0x8
[ 1360.413723]  debug_smp_processor_id+0x1c/0x20
[ 1360.414418]  perf_ftrace_function_call+0x7c/0x360
[ 1360.415439]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1360.416168]  ? write_comp_data+0x2f/0x90
[ 1360.416816]  ? perf_trace_buf_update+0x70/0x70
[ 1360.417642]  0xffffffffa0098099
[ 1360.418222]  ? nfs4_proc_statfs+0xd0/0xd0
[ 1360.418898]  ? ftrace_call+0x5/0x44
[ 1360.419507]  ? pmd_page_vaddr+0x2b/0x70
[ 1360.420179]  ? _raw_spin_lock+0x5/0x50
[ 1360.420860]  _raw_spin_lock+0x5/0x50
[ 1360.421448]  __get_locked_pte+0x1a2/0x290
[ 1360.422096]  ? _raw_spin_lock+0x5/0x50
[ 1360.422690]  ? __get_locked_pte+0x1a2/0x290
[ 1360.423390]  ? nfs4_proc_statfs+0xd0/0xd0
[ 1360.424068]  __text_poke+0xea/0x4e0
[ 1360.424643]  ? nfs4_proc_statfs+0xd0/0xd0
[ 1360.425321]  ? lock_is_held_type+0xe2/0x140
[ 1360.426005]  ? nfs4_proc_statfs+0xd0/0xd0
[ 1360.426721]  text_poke+0x2b/0x60
[ 1360.427315]  text_poke_bp_batch+0x93/0x2c0
[ 1360.428039]  ? nfs4_xdr_enc_open_noattr+0x1b0/0x1b0
[ 1360.428868]  text_poke_queue+0xa7/0xc0
[ 1360.429548]  ftrace_replace_code+0xfd/0x170
[ 1360.430305]  ftrace_modify_all_code+0x1b1/0x270
[ 1360.431104]  arch_ftrace_update_code+0x9/0x10
[ 1360.431793]  ftrace_run_update_code+0x30/0xa0
[ 1360.432517]  ftrace_startup_enable+0x5e/0xa0
[ 1360.433228]  ftrace_startup+0x16d/0x240
[ 1360.433972]  register_ftrace_function+0x43/0x90
[ 1360.434724]  perf_ftrace_event_register+0xc1/0xf0
[ 1360.435495]  perf_trace_event_init+0xa0/0x4c0
[ 1360.436274]  perf_trace_init+0xda/0x160
[ 1360.436966]  perf_tp_event_init+0x57/0xa0
[ 1360.437645]  perf_try_init_event+0x83/0x270
[ 1360.438422]  perf_event_alloc+0xe3f/0x1c10
[ 1360.439060]  ? _raw_spin_unlock+0x2c/0x50
[ 1360.439722]  ? alloc_fd+0x20d/0x320
[ 1360.440472]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1360.441254]  ? write_comp_data+0x2f/0x90
[ 1360.442454]  __x64_sys_perf_event_open+0x26/0x30
[ 1360.443193]  do_syscall_64+0x37/0x80
[ 1360.443796]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1360.444562] RIP: 0033:0x7fac0740459d
[ 1360.445142] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1360.447688] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1360.448802] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1360.449825] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1360.450850] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1360.451870] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1360.452892] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1360.454290] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1360.455342] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1360.456775] Call Trace:
[ 1360.457134]  dump_stack_lvl+0xa4/0xd3
[ 1360.457675]  dump_stack+0x15/0x17
[ 1360.458153]  check_preemption_disabled+0x167/0x180
[ 1360.458805]  ? do_epoll_wait+0x3b3/0xd80
[ 1360.459343]  ? __mutex_lock+0x9f0/0x9f0
[ 1360.459896]  debug_smp_processor_id+0x1c/0x20
[ 1360.460497]  perf_ftrace_function_call+0x7c/0x360
[ 1360.461194]  ? ftrace_call+0x5/0x44
[ 1360.461676]  ? trace_hardirqs_on+0x6a/0x170
[ 1360.462293]  ? finish_task_switch+0xb0/0x2a0
[ 1360.462871]  ? finish_task_switch+0x70/0x2a0
[ 1360.463473]  ? trace_hardirqs_on+0x3f/0x170
[ 1360.464039]  ? finish_task_switch+0x70/0x2a0
[ 1360.464644]  ? preempt_count_sub+0x5/0xa0
[ 1360.465253]  0xffffffffa0098099
[ 1360.465708]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1360.466369]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1360.467131]  ? do_epoll_wait+0x36b/0xd80
[ 1360.467705]  ? mutex_lock_nested+0x5/0x20
[ 1360.468261]  ? write_comp_data+0x2f/0x90
[ 1360.468822]  mutex_lock_nested+0x5/0x20
[ 1360.469357]  do_epoll_wait+0x3b3/0xd80
[ 1360.469885]  ? mutex_lock_nested+0x5/0x20
[ 1360.470433]  ? do_epoll_wait+0x3b3/0xd80
[ 1360.471134]  ? wait_woken+0x90/0x90
[ 1360.471700]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1360.472340]  do_syscall_64+0x37/0x80
[ 1360.472844]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1360.473521] RIP: 0033:0x7f8a39143b20
[ 1360.474021] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1360.476370] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1360.477379] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1360.478298] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1360.479205] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1360.480112] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1360.481019] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1365.134120] check_preemption_disabled: 752673 callbacks suppressed
[ 1365.134151] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1365.136137] caller is debug_smp_processor_id+0x1c/0x20
[ 1365.136891] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1365.137929] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1365.139490] Call Trace:
[ 1365.139904]  dump_stack_lvl+0xa4/0xd3
[ 1365.140531]  dump_stack+0x15/0x17
[ 1365.141065]  check_preemption_disabled+0x167/0x180
[ 1365.141871]  debug_smp_processor_id+0x1c/0x20
[ 1365.142552]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1365.143437]  perf_trace_buf_alloc+0x3d/0x100
[ 1365.144100]  ? ftrace_replace_code+0xfd/0x170
[ 1365.144751]  ? jump_label_transform+0x70/0x70
[ 1365.145436]  perf_ftrace_function_call+0x209/0x360
[ 1365.146491]  ? 0xffffffffa0098099
[ 1365.147199]  0xffffffffa0098099
[ 1365.147754]  ? write_comp_data+0x2f/0x90
[ 1365.148512]  ? ttm_pool_debugfs_shrink_show+0xb0/0xb0
[ 1365.149271]  ? text_poke_queue+0x5/0xc0
[ 1365.149872]  ? __fentry__+0x10/0x10
[ 1365.150476]  text_poke_queue+0x5/0xc0
[ 1365.151055]  ftrace_replace_code+0xfd/0x170
[ 1365.151701]  ? text_poke_queue+0x5/0xc0
[ 1365.152286]  ? ftrace_replace_code+0xfd/0x170
[ 1365.153033]  ftrace_modify_all_code+0x1b1/0x270
[ 1365.153789]  arch_ftrace_update_code+0x9/0x10
[ 1365.154472]  ftrace_run_update_code+0x30/0xa0
[ 1365.155174]  ftrace_startup_enable+0x5e/0xa0
[ 1365.155866]  ftrace_startup+0x16d/0x240
[ 1365.156580]  register_ftrace_function+0x43/0x90
[ 1365.157302]  perf_ftrace_event_register+0xc1/0xf0
[ 1365.158050]  perf_trace_event_init+0xa0/0x4c0
[ 1365.158830]  perf_trace_init+0xda/0x160
[ 1365.159513]  perf_tp_event_init+0x57/0xa0
[ 1365.160184]  perf_try_init_event+0x83/0x270
[ 1365.160946]  perf_event_alloc+0xe3f/0x1c10
[ 1365.161580]  ? _raw_spin_unlock+0x2c/0x50
[ 1365.162239]  ? alloc_fd+0x20d/0x320
[ 1365.162956]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1365.163710]  ? write_comp_data+0x2f/0x90
[ 1365.164841]  __x64_sys_perf_event_open+0x26/0x30
[ 1365.165557]  do_syscall_64+0x37/0x80
[ 1365.166157]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1365.166900] RIP: 0033:0x7fac0740459d
[ 1365.167461] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1365.170124] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1365.171259] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1365.172300] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1365.173345] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1365.174398] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1365.175444] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1365.177113] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1365.177129] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1365.178377] caller is debug_smp_processor_id+0x1c/0x20
[ 1365.179547] caller is debug_smp_processor_id+0x1c/0x20
[ 1365.180280] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1365.182034] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1365.183639] Call Trace:
[ 1365.184045]  dump_stack_lvl+0xa4/0xd3
[ 1365.184663]  dump_stack+0x15/0x17
[ 1365.185197]  check_preemption_disabled+0x167/0x180
[ 1365.185991]  debug_smp_processor_id+0x1c/0x20
[ 1365.186671]  perf_trace_buf_alloc+0x98/0x100
[ 1365.187335]  ? ftrace_replace_code+0xfd/0x170
[ 1365.187994]  ? jump_label_transform+0x70/0x70
[ 1365.188681]  perf_ftrace_function_call+0x209/0x360
[ 1365.189642]  ? 0xffffffffa0098099
[ 1365.190304]  0xffffffffa0098099
[ 1365.190844]  ? write_comp_data+0x2f/0x90
[ 1365.191565]  ? ttm_pool_debugfs_shrink_show+0xb0/0xb0
[ 1365.192330]  ? text_poke_queue+0x5/0xc0
[ 1365.192931]  ? __fentry__+0x10/0x10
[ 1365.193532]  text_poke_queue+0x5/0xc0
[ 1365.194117]  ftrace_replace_code+0xfd/0x170
[ 1365.194765]  ? text_poke_queue+0x5/0xc0
[ 1365.195354]  ? ftrace_replace_code+0xfd/0x170
[ 1365.196085]  ftrace_modify_all_code+0x1b1/0x270
[ 1365.196826]  arch_ftrace_update_code+0x9/0x10
[ 1365.197497]  ftrace_run_update_code+0x30/0xa0
[ 1365.198197]  ftrace_startup_enable+0x5e/0xa0
[ 1365.198880]  ftrace_startup+0x16d/0x240
[ 1365.199567]  register_ftrace_function+0x43/0x90
[ 1365.200286]  perf_ftrace_event_register+0xc1/0xf0
[ 1365.201030]  perf_trace_event_init+0xa0/0x4c0
[ 1365.201764]  perf_trace_init+0xda/0x160
[ 1365.202418]  perf_tp_event_init+0x57/0xa0
[ 1365.203068]  perf_try_init_event+0x83/0x270
[ 1365.203790]  perf_event_alloc+0xe3f/0x1c10
[ 1365.204417]  ? _raw_spin_unlock+0x2c/0x50
[ 1365.205054]  ? alloc_fd+0x20d/0x320
[ 1365.205727]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1365.206482]  ? write_comp_data+0x2f/0x90
[ 1365.207479]  __x64_sys_perf_event_open+0x26/0x30
[ 1365.208196]  do_syscall_64+0x37/0x80
[ 1365.208774]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1365.209527] RIP: 0033:0x7fac0740459d
[ 1365.210088] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1365.212645] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1365.213745] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1365.214767] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1365.215783] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1365.216810] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1365.217825] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1365.219103] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1365.219270] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1365.220227] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1365.221309] caller is debug_smp_processor_id+0x1c/0x20
[ 1365.222832] Call Trace:
[ 1365.222861]  dump_stack_lvl+0xa4/0xd3
[ 1365.222928]  dump_stack+0x15/0x17
[ 1365.222964]  check_preemption_disabled+0x167/0x180
[ 1365.223004]  ? do_epoll_wait+0x3b3/0xd80
[ 1365.226230]  ? __mutex_lock+0x9f0/0x9f0
[ 1365.226820]  debug_smp_processor_id+0x1c/0x20
[ 1365.227460]  perf_ftrace_function_call+0x7c/0x360
[ 1365.228202]  ? ftrace_call+0x5/0x44
[ 1365.228718]  ? trace_hardirqs_on+0x6a/0x170
[ 1365.229372]  ? finish_task_switch+0xb0/0x2a0
[ 1365.229991]  ? finish_task_switch+0x70/0x2a0
[ 1365.230646]  ? trace_hardirqs_on+0x3f/0x170
[ 1365.231269]  ? finish_task_switch+0x70/0x2a0
[ 1365.231914]  ? preempt_count_sub+0x5/0xa0
[ 1365.232564]  0xffffffffa0098099
[ 1365.233050]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1365.233752]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1365.234569]  ? do_epoll_wait+0x36b/0xd80
[ 1365.235181]  ? mutex_lock_nested+0x5/0x20
[ 1365.235774]  ? write_comp_data+0x2f/0x90
[ 1365.236375]  mutex_lock_nested+0x5/0x20
[ 1365.236946]  do_epoll_wait+0x3b3/0xd80
[ 1365.237508]  ? mutex_lock_nested+0x5/0x20
[ 1365.238095]  ? do_epoll_wait+0x3b3/0xd80
[ 1365.238837]  ? wait_woken+0x90/0x90
[ 1365.239436]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1365.240119]  do_syscall_64+0x37/0x80
[ 1365.240664]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1365.241387] RIP: 0033:0x7f8a39143b20
[ 1365.241920] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1365.244404] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1365.245460] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1365.246442] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1365.247420] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1365.248397] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1365.249373] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1365.250552] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1365.250713] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1365.251621] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1365.252756] caller is debug_smp_processor_id+0x1c/0x20
[ 1365.254322] Call Trace:
[ 1365.254360]  dump_stack_lvl+0xa4/0xd3
[ 1365.254443]  dump_stack+0x15/0x17
[ 1365.256490]  check_preemption_disabled+0x167/0x180
[ 1365.257283]  debug_smp_processor_id+0x1c/0x20
[ 1365.257958]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1365.258795]  perf_tp_event+0x331/0x4e0
[ 1365.259590]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1365.260570]  ? arch_local_irq_enable+0x10/0x12
[ 1365.261267]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1365.262010]  ? dump_stack_lvl+0xcc/0xd3
[ 1365.262685]  ? ftrace_replace_code+0xfd/0x170
[ 1365.263345]  ? jump_label_transform+0x70/0x70
[ 1365.264043]  perf_ftrace_function_call+0x248/0x360
[ 1365.264788]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1365.265474]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1365.266196]  ? perf_ftrace_function_call+0x248/0x360
[ 1365.267206]  ? 0xffffffffa0098099
[ 1365.267865]  0xffffffffa0098099
[ 1365.268406]  ? write_comp_data+0x2f/0x90
[ 1365.269128]  ? ttm_pool_debugfs_shrink_show+0xb0/0xb0
[ 1365.269893]  ? text_poke_queue+0x5/0xc0
[ 1365.270500]  ? __fentry__+0x10/0x10
[ 1365.271080]  text_poke_queue+0x5/0xc0
[ 1365.271661]  ftrace_replace_code+0xfd/0x170
[ 1365.272310]  ? text_poke_queue+0x5/0xc0
[ 1365.272903]  ? ftrace_replace_code+0xfd/0x170
[ 1365.273633]  ftrace_modify_all_code+0x1b1/0x270
[ 1365.274379]  arch_ftrace_update_code+0x9/0x10
[ 1365.275054]  ftrace_run_update_code+0x30/0xa0
[ 1365.275752]  ftrace_startup_enable+0x5e/0xa0
[ 1365.276437]  ftrace_startup+0x16d/0x240
[ 1365.277126]  register_ftrace_function+0x43/0x90
[ 1365.277846]  perf_ftrace_event_register+0xc1/0xf0
[ 1365.278595]  perf_trace_event_init+0xa0/0x4c0
[ 1365.279332]  perf_trace_init+0xda/0x160
[ 1365.279985]  perf_tp_event_init+0x57/0xa0
[ 1365.280635]  perf_try_init_event+0x83/0x270
[ 1365.281359]  perf_event_alloc+0xe3f/0x1c10
[ 1365.281986]  ? _raw_spin_unlock+0x2c/0x50
[ 1365.282626]  ? alloc_fd+0x20d/0x320
[ 1365.283301]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1365.284057]  ? write_comp_data+0x2f/0x90
[ 1365.285055]  __x64_sys_perf_event_open+0x26/0x30
[ 1365.285774]  do_syscall_64+0x37/0x80
[ 1365.286356]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1365.287114] RIP: 0033:0x7fac0740459d
[ 1365.287675] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1365.290248] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1365.291349] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1365.292367] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1365.293384] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1365.294409] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1365.295425] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1365.296696] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1365.296877] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1365.297811] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1365.299137] caller is debug_smp_processor_id+0x1c/0x20
[ 1365.300506] Call Trace:
[ 1365.301659]  dump_stack_lvl+0xa4/0xd3
[ 1365.302243]  dump_stack+0x15/0x17
[ 1365.302748]  check_preemption_disabled+0x167/0x180
[ 1365.303447]  ? mutex_lock_nested+0x1b/0x20
[ 1365.304043]  ? mutex_lock_io_nested+0x940/0x940
[ 1365.304722]  debug_smp_processor_id+0x1c/0x20
[ 1365.305365]  perf_ftrace_function_call+0x7c/0x360
[ 1365.306054]  ? perf_ftrace_function_call+0x4c/0x360
[ 1365.306824]  ? ftrace_call+0x5/0x44
[ 1365.307340]  ? trace_hardirqs_on+0x6a/0x170
[ 1365.307993]  ? finish_task_switch+0xb0/0x2a0
[ 1365.308612]  ? finish_task_switch+0x70/0x2a0
[ 1365.309258]  ? trace_hardirqs_on+0x3f/0x170
[ 1365.309866]  ? finish_task_switch+0x70/0x2a0
[ 1365.310573]  0xffffffffa0098099
[ 1365.311059]  ? 0xffffffffa0098099
[ 1365.311567]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1365.312267]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1365.313042]  ? do_epoll_wait+0x3b3/0xd80
[ 1365.313673]  ? __mutex_lock+0x5/0x9f0
[ 1365.314227]  ? mutex_lock_nested+0x5/0x20
[ 1365.314821]  ? write_comp_data+0x2f/0x90
[ 1365.315402]  __mutex_lock+0x5/0x9f0
[ 1365.315929]  mutex_lock_nested+0x1b/0x20
[ 1365.316512]  ? __mutex_lock+0x5/0x9f0
[ 1365.317051]  ? mutex_lock_nested+0x1b/0x20
[ 1365.317657]  do_epoll_wait+0x3b3/0xd80
[ 1365.318382]  ? wait_woken+0x90/0x90
[ 1365.318983]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1365.319668]  do_syscall_64+0x37/0x80
[ 1365.320215]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1365.320937] RIP: 0033:0x7f8a39143b20
[ 1365.321469] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1365.323955] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1365.325010] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1365.325989] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1365.326972] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1365.327950] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1365.328926] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1365.330114] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1365.330220] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1365.331263] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1365.332393] caller is debug_smp_processor_id+0x1c/0x20
[ 1365.334073] Call Trace:
[ 1365.334126]  dump_stack_lvl+0xa4/0xd3
[ 1365.335896]  dump_stack+0x15/0x17
[ 1365.336486]  check_preemption_disabled+0x167/0x180
[ 1365.337286]  ? ftrace_replace_code+0xfd/0x170
[ 1365.338004]  ? jump_label_transform+0x70/0x70
[ 1365.338780]  debug_smp_processor_id+0x1c/0x20
[ 1365.339520]  perf_ftrace_function_call+0x7c/0x360
[ 1365.340290]  ? write_comp_data+0x2f/0x90
[ 1365.341015]  ? write_comp_data+0x2f/0x90
[ 1365.341742]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1365.342546]  ? write_comp_data+0x2f/0x90
[ 1365.343274]  ? write_comp_data+0x2f/0x90
[ 1365.344003]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1365.344935]  0xffffffffa0098099
[ 1365.345546]  ? write_comp_data+0x2f/0x90
[ 1365.346389]  ? ttm_pool_type_fini+0x90/0x90
[ 1365.347103]  ? text_poke_queue+0x5/0xc0
[ 1365.347765]  ? __fentry__+0x10/0x10
[ 1365.348411]  text_poke_queue+0x5/0xc0
[ 1365.349053]  ftrace_replace_code+0xfd/0x170
[ 1365.349765]  ? text_poke_queue+0x5/0xc0
[ 1365.350414]  ? ftrace_replace_code+0xfd/0x170
[ 1365.351236]  ftrace_modify_all_code+0x1b1/0x270
[ 1365.352067]  arch_ftrace_update_code+0x9/0x10
[ 1365.352804]  ftrace_run_update_code+0x30/0xa0
[ 1365.353577]  ftrace_startup_enable+0x5e/0xa0
[ 1365.354341]  ftrace_startup+0x16d/0x240
[ 1365.355129]  register_ftrace_function+0x43/0x90
[ 1365.355928]  perf_ftrace_event_register+0xc1/0xf0
[ 1365.356753]  perf_trace_event_init+0xa0/0x4c0
[ 1365.357582]  perf_trace_init+0xda/0x160
[ 1365.358322]  perf_tp_event_init+0x57/0xa0
[ 1365.359047]  perf_try_init_event+0x83/0x270
[ 1365.359868]  perf_event_alloc+0xe3f/0x1c10
[ 1365.360553]  ? _raw_spin_unlock+0x2c/0x50
[ 1365.361260]  ? alloc_fd+0x20d/0x320
[ 1365.362048]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1365.362887]  ? write_comp_data+0x2f/0x90
[ 1365.364125]  __x64_sys_perf_event_open+0x26/0x30
[ 1365.364917]  do_syscall_64+0x37/0x80
[ 1365.365562]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1365.366390] RIP: 0033:0x7fac0740459d
[ 1365.367006] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1365.369748] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1365.370954] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1365.372051] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1365.373149] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1365.374253] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1365.375354] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1365.376823] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1365.376996] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1365.377939] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1365.379255] caller is debug_smp_processor_id+0x1c/0x20
[ 1365.380618] Call Trace:
[ 1365.381766]  dump_stack_lvl+0xa4/0xd3
[ 1365.382347]  dump_stack+0x15/0x17
[ 1365.382851]  check_preemption_disabled+0x167/0x180
[ 1365.383548]  ? ep_start_scan+0x68/0x100
[ 1365.384111]  ? _raw_read_lock_irq+0xa0/0xa0
[ 1365.384746]  debug_smp_processor_id+0x1c/0x20
[ 1365.385387]  perf_ftrace_function_call+0x7c/0x360
[ 1365.386075]  ? ftrace_ops_test+0x71/0xc0
[ 1365.386668]  ? preempt_notifier_dec+0x20/0x20
[ 1365.387362]  ? ftrace_call+0x5/0x44
[ 1365.387924]  ? write_comp_data+0x2f/0x90
[ 1365.388515]  ? perf_trace_buf_update+0x70/0x70
[ 1365.389166]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1365.389916]  0xffffffffa0098099
[ 1365.390442]  ? ftrace_call+0x5/0x44
[ 1365.390967]  ? __mutex_lock+0xfe/0x9f0
[ 1365.391527]  ? do_epoll_wait+0x3b3/0xd80
[ 1365.392110]  ? ep_start_scan+0xe0/0x100
[ 1365.392712]  ? _raw_write_lock_irq+0x5/0x60
[ 1365.393329]  ? write_comp_data+0x2f/0x90
[ 1365.393929]  _raw_write_lock_irq+0x5/0x60
[ 1365.394533]  ep_start_scan+0x68/0x100
[ 1365.395083]  ? _raw_write_lock_irq+0x5/0x60
[ 1365.395690]  ? ep_start_scan+0x68/0x100
[ 1365.396298]  do_epoll_wait+0x3bf/0xd80
[ 1365.397018]  ? wait_woken+0x90/0x90
[ 1365.397616]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1365.398308]  do_syscall_64+0x37/0x80
[ 1365.398855]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1365.399576] RIP: 0033:0x7f8a39143b20
[ 1365.400105] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1365.402591] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1365.403642] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1365.404617] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1365.405593] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1365.406576] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1365.407556] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1365.408734] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1365.408855] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1365.409883] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1365.411101] caller is debug_smp_processor_id+0x1c/0x20
[ 1365.412725] Call Trace:
[ 1365.413858]  dump_stack_lvl+0xa4/0xd3
[ 1365.414558]  dump_stack+0x15/0x17
[ 1365.415149]  check_preemption_disabled+0x167/0x180
[ 1365.416039]  debug_smp_processor_id+0x1c/0x20
[ 1365.416779]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1365.417755]  perf_trace_buf_alloc+0x3d/0x100
[ 1365.418486]  ? ftrace_replace_code+0xfd/0x170
[ 1365.419206]  ? jump_label_transform+0x70/0x70
[ 1365.419963]  perf_ftrace_function_call+0x209/0x360
[ 1365.421104]  ? 0xffffffffa0098099
[ 1365.421882]  0xffffffffa0098099
[ 1365.422498]  ? write_comp_data+0x2f/0x90
[ 1365.423334]  ? ttm_pool_type_fini+0x90/0x90
[ 1365.424047]  ? text_poke_queue+0x5/0xc0
[ 1365.424712]  ? __fentry__+0x10/0x10
[ 1365.425360]  text_poke_queue+0x5/0xc0
[ 1365.426000]  ftrace_replace_code+0xfd/0x170
[ 1365.426718]  ? text_poke_queue+0x5/0xc0
[ 1365.427363]  ? ftrace_replace_code+0xfd/0x170
[ 1365.428187]  ftrace_modify_all_code+0x1b1/0x270
[ 1365.429021]  arch_ftrace_update_code+0x9/0x10
[ 1365.429760]  ftrace_run_update_code+0x30/0xa0
[ 1365.430538]  ftrace_startup_enable+0x5e/0xa0
[ 1365.431303]  ftrace_startup+0x16d/0x240
[ 1365.432119]  register_ftrace_function+0x43/0x90
[ 1365.432920]  perf_ftrace_event_register+0xc1/0xf0
[ 1365.433775]  perf_trace_event_init+0xa0/0x4c0
[ 1365.434684]  perf_trace_init+0xda/0x160
[ 1365.435468]  perf_tp_event_init+0x57/0xa0
[ 1365.436196]  perf_try_init_event+0x83/0x270
[ 1365.437020]  perf_event_alloc+0xe3f/0x1c10
[ 1365.437717]  ? _raw_spin_unlock+0x2c/0x50
[ 1365.438445]  ? alloc_fd+0x20d/0x320
[ 1365.439236]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1365.440075]  ? write_comp_data+0x2f/0x90
[ 1365.441317]  __x64_sys_perf_event_open+0x26/0x30
[ 1365.442125]  do_syscall_64+0x37/0x80
[ 1365.442776]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1365.443603] RIP: 0033:0x7fac0740459d
[ 1365.444225] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1365.446979] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1365.448178] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1365.449277] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1365.450381] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1365.451480] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1365.452579] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1365.454056] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1365.454231] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1365.455185] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1365.456276] caller is debug_smp_processor_id+0x1c/0x20
[ 1365.457789] Call Trace:
[ 1365.458895]  dump_stack_lvl+0xa4/0xd3
[ 1365.459473]  dump_stack+0x15/0x17
[ 1365.459977]  check_preemption_disabled+0x167/0x180
[ 1365.460674]  ? ep_done_scan+0x3b/0x240
[ 1365.461225]  ? _raw_read_lock_irq+0xa0/0xa0
[ 1365.461861]  debug_smp_processor_id+0x1c/0x20
[ 1365.462505]  perf_ftrace_function_call+0x7c/0x360
[ 1365.463196]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1365.463898]  ? ftrace_ops_test+0x71/0xc0
[ 1365.464516]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1365.465219]  ? _prb_read_valid+0x3ad/0x3f0
[ 1365.465872]  ? write_comp_data+0x2f/0x90
[ 1365.466534]  0xffffffffa0098099
[ 1365.467018]  ? ep_destroy_wakeup_source+0xe0/0xe0
[ 1365.467778]  ? do_epoll_wait+0x85a/0xd80
[ 1365.468390]  ? _raw_write_lock_irq+0x5/0x60
[ 1365.469044]  _raw_write_lock_irq+0x5/0x60
[ 1365.469639]  ep_done_scan+0x3b/0x240
[ 1365.470186]  ? _raw_write_lock_irq+0x5/0x60
[ 1365.470794]  ? ep_done_scan+0x3b/0x240
[ 1365.471429]  do_epoll_wait+0xabb/0xd80
[ 1365.472150]  ? wait_woken+0x90/0x90
[ 1365.472752]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1365.473436]  do_syscall_64+0x37/0x80
[ 1365.473982]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1365.474710] RIP: 0033:0x7f8a39143b20
[ 1365.475243] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1365.477724] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1365.478789] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1365.479768] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1365.480746] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1365.481724] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1365.482705] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1365.483879] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1365.484963] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1365.486583] Call Trace:
[ 1365.486993]  dump_stack_lvl+0xa4/0xd3
[ 1365.487611]  dump_stack+0x15/0x17
[ 1365.488146]  check_preemption_disabled+0x167/0x180
[ 1365.488939]  debug_smp_processor_id+0x1c/0x20
[ 1365.489614]  perf_trace_buf_alloc+0x98/0x100
[ 1365.490282]  ? ftrace_replace_code+0xfd/0x170
[ 1365.490944]  ? jump_label_transform+0x70/0x70
[ 1365.491632]  perf_ftrace_function_call+0x209/0x360
[ 1365.492595]  ? 0xffffffffa0098099
[ 1365.493257]  0xffffffffa0098099
[ 1365.493798]  ? write_comp_data+0x2f/0x90
[ 1365.494526]  ? ttm_pool_type_fini+0x90/0x90
[ 1365.495179]  ? text_poke_queue+0x5/0xc0
[ 1365.495783]  ? __fentry__+0x10/0x10
[ 1365.496363]  text_poke_queue+0x5/0xc0
[ 1365.496945]  ftrace_replace_code+0xfd/0x170
[ 1365.497594]  ? text_poke_queue+0x5/0xc0
[ 1365.498193]  ? ftrace_replace_code+0xfd/0x170
[ 1365.498925]  ftrace_modify_all_code+0x1b1/0x270
[ 1365.499669]  arch_ftrace_update_code+0x9/0x10
[ 1365.500342]  ftrace_run_update_code+0x30/0xa0
[ 1365.501039]  ftrace_startup_enable+0x5e/0xa0
[ 1365.501725]  ftrace_startup+0x16d/0x240
[ 1365.502422]  register_ftrace_function+0x43/0x90
[ 1365.503144]  perf_ftrace_event_register+0xc1/0xf0
[ 1365.503890]  perf_trace_event_init+0xa0/0x4c0
[ 1365.504626]  perf_trace_init+0xda/0x160
[ 1365.505278]  perf_tp_event_init+0x57/0xa0
[ 1365.505929]  perf_try_init_event+0x83/0x270
[ 1365.506657]  perf_event_alloc+0xe3f/0x1c10
[ 1365.507285]  ? _raw_spin_unlock+0x2c/0x50
[ 1365.507924]  ? alloc_fd+0x20d/0x320
[ 1365.508600]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1365.509356]  ? write_comp_data+0x2f/0x90
[ 1365.510358]  __x64_sys_perf_event_open+0x26/0x30
[ 1365.511079]  do_syscall_64+0x37/0x80
[ 1365.511660]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1365.512418] RIP: 0033:0x7fac0740459d
[ 1365.512980] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1365.515554] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1365.516656] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1365.517673] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1365.518697] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1365.519715] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1365.520735] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1370.138076] check_preemption_disabled: 619778 callbacks suppressed
[ 1370.138097] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1370.139831] caller is debug_smp_processor_id+0x1c/0x20
[ 1370.140475] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1370.141376] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1370.142740] Call Trace:
[ 1370.143069]  dump_stack_lvl+0xa4/0xd3
[ 1370.143561]  dump_stack+0x15/0x17
[ 1370.143996]  check_preemption_disabled+0x167/0x180
[ 1370.144629]  debug_smp_processor_id+0x1c/0x20
[ 1370.145184]  perf_trace_buf_alloc+0x98/0x100
[ 1370.145731]  ? text_poke_bp_batch+0x93/0x2c0
[ 1370.146276]  ? apply_paravirt+0x150/0x150
[ 1370.146796]  perf_ftrace_function_call+0x209/0x360
[ 1370.147559]  ? 0xffffffffa0098099
[ 1370.148079]  0xffffffffa0098099
[ 1370.148519]  ? _raw_spin_unlock+0x2c/0x50
[ 1370.149096]  ? __text_poke+0x2f2/0x4e0
[ 1370.149645]  ? __ia32_sys_setgid16+0x50/0x50
[ 1370.150240]  ? text_poke+0x5/0x60
[ 1370.150726]  text_poke+0x5/0x60
[ 1370.151167]  text_poke_bp_batch+0x93/0x2c0
[ 1370.151726]  ? text_poke+0x5/0x60
[ 1370.152182]  ? text_poke_bp_batch+0x93/0x2c0
[ 1370.152788]  ? kimage_file_post_load_cleanup+0xb0/0xb0
[ 1370.153499]  text_poke_queue+0xa7/0xc0
[ 1370.154037]  ftrace_replace_code+0xfd/0x170
[ 1370.154643]  ftrace_modify_all_code+0x1b1/0x270
[ 1370.155283]  arch_ftrace_update_code+0x9/0x10
[ 1370.155873]  ftrace_run_update_code+0x30/0xa0
[ 1370.156473]  ftrace_shutdown+0x2b8/0x4a0
[ 1370.157043]  unregister_ftrace_function+0x25/0x50
[ 1370.157681]  perf_ftrace_event_register+0x89/0xf0
[ 1370.158325]  ? perf_tp_event_init+0xa0/0xa0
[ 1370.158894]  perf_trace_destroy+0x37/0x60
[ 1370.159448]  tp_perf_event_destroy+0x15/0x20
[ 1370.160033]  _free_event+0xfc/0x7d0
[ 1370.160544]  put_event+0x37/0x50
[ 1370.161006]  perf_event_release_kernel+0x2f4/0x370
[ 1370.161690]  ? perf_event_release_kernel+0x370/0x370
[ 1370.162378]  perf_release+0x19/0x20
[ 1370.162868]  __fput+0x12d/0x460
[ 1370.163362]  ____fput+0x1a/0x20
[ 1370.163809]  task_work_run+0x8e/0xf0
[ 1370.164333]  do_exit+0x616/0x1310
[ 1370.164825]  ? write_comp_data+0x2f/0x90
[ 1370.165402]  do_group_exit+0x7e/0x130
[ 1370.165937]  get_signal+0x249/0x13c0
[ 1370.166462]  ? get_signal+0x5/0x13c0
[ 1370.167006]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1370.167701]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1370.168395]  exit_to_user_mode_prepare+0x154/0x240
[ 1370.169049]  syscall_exit_to_user_mode+0x2b/0x60
[ 1370.169678]  do_syscall_64+0x46/0x80
[ 1370.170186]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1370.170859] RIP: 0033:0x7fac0740459d
[ 1370.171354] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1370.172191] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1370.173171] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1370.174090] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1370.175003] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1370.175914] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1370.176826] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1370.178080] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1370.178201] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1370.179213] caller is debug_smp_processor_id+0x1c/0x20
[ 1370.180257] caller is debug_smp_processor_id+0x1c/0x20
[ 1370.180922] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1370.182663] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1370.184119] Call Trace:
[ 1370.184458]  dump_stack_lvl+0xa4/0xd3
[ 1370.184966]  dump_stack+0x15/0x17
[ 1370.185421]  check_preemption_disabled+0x167/0x180
[ 1370.186064]  ? __mutex_lock+0x56/0x9f0
[ 1370.186576]  ? ___might_sleep+0x170/0x170
[ 1370.187125]  debug_smp_processor_id+0x1c/0x20
[ 1370.187713]  perf_ftrace_function_call+0x7c/0x360
[ 1370.188344]  ? perf_ftrace_function_call+0x4c/0x360
[ 1370.189000]  ? write_comp_data+0x2f/0x90
[ 1370.189532]  ? mutex_lock_nested+0x1b/0x20
[ 1370.190086]  ? mutex_lock_io_nested+0x940/0x940
[ 1370.190695]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1370.191325]  ? mutex_lock_nested+0x1b/0x20
[ 1370.191879]  ? perf_ftrace_function_call+0x4c/0x360
[ 1370.192534]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1370.193168]  ? ftrace_ops_test+0x71/0xc0
[ 1370.193726]  0xffffffffa0098099
[ 1370.194159]  ? 0xffffffffa0098099
[ 1370.194610]  ? trace_hardirqs_on+0x6a/0x170
[ 1370.195177]  ? write_comp_data+0x2f/0x90
[ 1370.195712]  ? perf_trace_buf_update+0x70/0x70
[ 1370.196314]  ? do_epoll_wait+0x3b3/0xd80
[ 1370.196863]  ? __might_sleep+0x5/0x70
[ 1370.197372]  __might_sleep+0x5/0x70
[ 1370.197851]  __mutex_lock+0x56/0x9f0
[ 1370.198344]  ? __might_sleep+0x5/0x70
[ 1370.198842]  ? __mutex_lock+0x56/0x9f0
[ 1370.199358]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1370.200077]  ? do_epoll_wait+0x3b3/0xd80
[ 1370.200612]  ? do_epoll_wait+0x3b3/0xd80
[ 1370.201153]  ? __mutex_lock+0x5/0x9f0
[ 1370.201670]  mutex_lock_nested+0x1b/0x20
[ 1370.202210]  ? __mutex_lock+0x5/0x9f0
[ 1370.202706]  ? mutex_lock_nested+0x1b/0x20
[ 1370.203261]  do_epoll_wait+0x3b3/0xd80
[ 1370.203814]  ? wait_woken+0x90/0x90
[ 1370.204312]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1370.204895]  do_syscall_64+0x37/0x80
[ 1370.205386]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1370.206060] RIP: 0033:0x7f8a39143b20
[ 1370.206550] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1370.208929] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1370.209912] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1370.210837] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1370.211760] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1370.212681] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1370.213601] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1370.214580] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1370.214639] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1370.215591] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1370.216681] caller is debug_smp_processor_id+0x1c/0x20
[ 1370.218185] Call Trace:
[ 1370.218208]  dump_stack_lvl+0xa4/0xd3
[ 1370.219742]  dump_stack+0x15/0x17
[ 1370.220228]  check_preemption_disabled+0x167/0x180
[ 1370.220938]  debug_smp_processor_id+0x1c/0x20
[ 1370.221561]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1370.222333]  perf_tp_event+0x331/0x4e0
[ 1370.223041]  ? arch_local_irq_enable+0x10/0x12
[ 1370.223681]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1370.224362]  ? dump_stack_lvl+0xcc/0xd3
[ 1370.224935]  ? dump_stack+0x15/0x17
[ 1370.225446]  ? check_preemption_disabled+0x167/0x180
[ 1370.226183]  ? text_poke_bp_batch+0x93/0x2c0
[ 1370.226788]  ? apply_paravirt+0x150/0x150
[ 1370.227378]  perf_ftrace_function_call+0x248/0x360
[ 1370.228054]  ? perf_ftrace_function_call+0x248/0x360
[ 1370.228883]  ? 0xffffffffa0098099
[ 1370.229433]  0xffffffffa0098099
[ 1370.229900]  ? _raw_spin_unlock+0x2c/0x50
[ 1370.230506]  ? __text_poke+0x2f2/0x4e0
[ 1370.231079]  ? __ia32_sys_setgid16+0x50/0x50
[ 1370.231693]  ? text_poke+0x5/0x60
[ 1370.232204]  text_poke+0x5/0x60
[ 1370.232668]  text_poke_bp_batch+0x93/0x2c0
[ 1370.233256]  ? text_poke+0x5/0x60
[ 1370.233736]  ? text_poke_bp_batch+0x93/0x2c0
[ 1370.234373]  ? kimage_file_post_load_cleanup+0xb0/0xb0
[ 1370.235121]  text_poke_queue+0xa7/0xc0
[ 1370.235690]  ftrace_replace_code+0xfd/0x170
[ 1370.236318]  ftrace_modify_all_code+0x1b1/0x270
[ 1370.236987]  arch_ftrace_update_code+0x9/0x10
[ 1370.237607]  ftrace_run_update_code+0x30/0xa0
[ 1370.238244]  ftrace_shutdown+0x2b8/0x4a0
[ 1370.238843]  unregister_ftrace_function+0x25/0x50
[ 1370.239514]  perf_ftrace_event_register+0x89/0xf0
[ 1370.240182]  ? perf_tp_event_init+0xa0/0xa0
[ 1370.240781]  perf_trace_destroy+0x37/0x60
[ 1370.241384]  tp_perf_event_destroy+0x15/0x20
[ 1370.242001]  _free_event+0xfc/0x7d0
[ 1370.242544]  put_event+0x37/0x50
[ 1370.243032]  perf_event_release_kernel+0x2f4/0x370
[ 1370.243745]  ? perf_event_release_kernel+0x370/0x370
[ 1370.244455]  perf_release+0x19/0x20
[ 1370.244970]  __fput+0x12d/0x460
[ 1370.245488]  ____fput+0x1a/0x20
[ 1370.245959]  task_work_run+0x8e/0xf0
[ 1370.246513]  do_exit+0x616/0x1310
[ 1370.247030]  ? write_comp_data+0x2f/0x90
[ 1370.247636]  do_group_exit+0x7e/0x130
[ 1370.248198]  get_signal+0x249/0x13c0
[ 1370.248742]  ? get_signal+0x5/0x13c0
[ 1370.249315]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1370.250046]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1370.250782]  exit_to_user_mode_prepare+0x154/0x240
[ 1370.251470]  syscall_exit_to_user_mode+0x2b/0x60
[ 1370.252132]  do_syscall_64+0x46/0x80
[ 1370.252658]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1370.253368] RIP: 0033:0x7fac0740459d
[ 1370.253884] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1370.254767] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1370.255800] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1370.256763] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1370.257725] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1370.258690] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1370.259652] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1370.260737] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1370.260870] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1370.261800] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1370.263019] caller is debug_smp_processor_id+0x1c/0x20
[ 1370.264386] Call Trace:
[ 1370.264395]  dump_stack_lvl+0xa4/0xd3
[ 1370.265948]  dump_stack+0x15/0x17
[ 1370.266408]  check_preemption_disabled+0x167/0x180
[ 1370.267050]  ? __might_sleep+0x48/0x70
[ 1370.267557]  ? sched_show_task+0x70/0x70
[ 1370.268093]  debug_smp_processor_id+0x1c/0x20
[ 1370.268680]  perf_ftrace_function_call+0x7c/0x360
[ 1370.269308]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1370.269937]  ? __mutex_lock+0x56/0x9f0
[ 1370.270451]  ? perf_ftrace_function_call+0x4c/0x360
[ 1370.271102]  ? perf_ftrace_function_call+0x4c/0x360
[ 1370.271757]  ? write_comp_data+0x2f/0x90
[ 1370.272290]  ? mutex_lock_nested+0x1b/0x20
[ 1370.272842]  ? mutex_lock_io_nested+0x940/0x940
[ 1370.273452]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1370.274085]  ? mutex_lock_nested+0x1b/0x20
[ 1370.274640]  ? perf_ftrace_function_call+0x4c/0x360
[ 1370.275293]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1370.275926]  ? ftrace_ops_test+0x71/0xc0
[ 1370.276474]  0xffffffffa0098099
[ 1370.276917]  ? 0xffffffffa0098099
[ 1370.277369]  ? trace_hardirqs_on+0x6a/0x170
[ 1370.277938]  ? do_epoll_wait+0x3b3/0xd80
[ 1370.278488]  ? ___might_sleep+0x5/0x170
[ 1370.279020]  ___might_sleep+0x5/0x170
[ 1370.279520]  __might_sleep+0x48/0x70
[ 1370.280009]  ? ___might_sleep+0x5/0x170
[ 1370.280529]  ? __might_sleep+0x48/0x70
[ 1370.281046]  __mutex_lock+0x56/0x9f0
[ 1370.281540]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1370.282263]  ? do_epoll_wait+0x3b3/0xd80
[ 1370.282797]  ? do_epoll_wait+0x3b3/0xd80
[ 1370.283339]  ? __mutex_lock+0x5/0x9f0
[ 1370.283855]  mutex_lock_nested+0x1b/0x20
[ 1370.284386]  ? __mutex_lock+0x5/0x9f0
[ 1370.284883]  ? mutex_lock_nested+0x1b/0x20
[ 1370.285445]  do_epoll_wait+0x3b3/0xd80
[ 1370.285998]  ? wait_woken+0x90/0x90
[ 1370.286507]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1370.287096]  do_syscall_64+0x37/0x80
[ 1370.287598]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1370.288275] RIP: 0033:0x7f8a39143b20
[ 1370.288765] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1370.291153] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1370.292140] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1370.293064] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1370.293987] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1370.294919] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1370.295844] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1370.296822] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1370.296852] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1370.297921] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1370.299049] caller is debug_smp_processor_id+0x1c/0x20
[ 1370.300654] Call Trace:
[ 1370.301724]  dump_stack_lvl+0xa4/0xd3
[ 1370.302398]  dump_stack+0x15/0x17
[ 1370.302970]  check_preemption_disabled+0x167/0x180
[ 1370.303720]  ? text_poke+0x2b/0x60
[ 1370.304264]  ? do_sync_core+0x30/0x30
[ 1370.304876]  debug_smp_processor_id+0x1c/0x20
[ 1370.305566]  perf_ftrace_function_call+0x7c/0x360
[ 1370.306432]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1370.307210]  ? text_poke_bp_batch+0x93/0x2c0
[ 1370.307884]  ? perf_ftrace_function_call+0x4c/0x360
[ 1370.308868]  ? __ia32_sys_setgid16+0x50/0x50
[ 1370.309591]  0xffffffffa0098099
[ 1370.310180]  ? _raw_spin_unlock+0x2c/0x50
[ 1370.310888]  ? __ia32_sys_setgid16+0x50/0x50
[ 1370.311563]  ? __text_poke+0x5/0x4e0
[ 1370.312140]  ? lock_is_held_type+0xe2/0x140
[ 1370.312822]  __text_poke+0x5/0x4e0
[ 1370.313377]  text_poke+0x2b/0x60
[ 1370.313906]  ? __text_poke+0x5/0x4e0
[ 1370.314490]  ? text_poke+0x2b/0x60
[ 1370.315076]  text_poke_bp_batch+0x93/0x2c0
[ 1370.315771]  ? kimage_file_post_load_cleanup+0xb0/0xb0
[ 1370.316608]  text_poke_queue+0xa7/0xc0
[ 1370.317256]  ftrace_replace_code+0xfd/0x170
[ 1370.317973]  ftrace_modify_all_code+0x1b1/0x270
[ 1370.318738]  arch_ftrace_update_code+0x9/0x10
[ 1370.319423]  ftrace_run_update_code+0x30/0xa0
[ 1370.320136]  ftrace_shutdown+0x2b8/0x4a0
[ 1370.320831]  unregister_ftrace_function+0x25/0x50
[ 1370.321573]  perf_ftrace_event_register+0x89/0xf0
[ 1370.322317]  ? perf_tp_event_init+0xa0/0xa0
[ 1370.322977]  perf_trace_destroy+0x37/0x60
[ 1370.323627]  tp_perf_event_destroy+0x15/0x20
[ 1370.324310]  _free_event+0xfc/0x7d0
[ 1370.324932]  put_event+0x37/0x50
[ 1370.325484]  perf_event_release_kernel+0x2f4/0x370
[ 1370.326301]  ? perf_event_release_kernel+0x370/0x370
[ 1370.327091]  perf_release+0x19/0x20
[ 1370.327667]  __fput+0x12d/0x460
[ 1370.328288]  ____fput+0x1a/0x20
[ 1370.328819]  task_work_run+0x8e/0xf0
[ 1370.329453]  do_exit+0x616/0x1310
[ 1370.330070]  ? write_comp_data+0x2f/0x90
[ 1370.330791]  do_group_exit+0x7e/0x130
[ 1370.331439]  get_signal+0x249/0x13c0
[ 1370.332060]  ? get_signal+0x5/0x13c0
[ 1370.332739]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1370.333596]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1370.334446]  exit_to_user_mode_prepare+0x154/0x240
[ 1370.335212]  syscall_exit_to_user_mode+0x2b/0x60
[ 1370.335944]  do_syscall_64+0x46/0x80
[ 1370.336531]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1370.337305] RIP: 0033:0x7fac0740459d
[ 1370.337875] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1370.338832] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1370.339956] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1370.340995] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1370.342033] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1370.343074] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1370.344108] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1370.345384] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1370.345519] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1370.346452] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1370.346464] Call Trace:
[ 1370.346473]  dump_stack_lvl+0xa4/0xd3
[ 1370.346499]  dump_stack+0x15/0x17
[ 1370.346516]  check_preemption_disabled+0x167/0x180
[ 1370.346537]  ? __mutex_lock+0x7b/0x9f0
[ 1370.347661] caller is debug_smp_processor_id+0x1c/0x20
[ 1370.349110]  ? trace_sched_waking+0xc0/0xc0
[ 1370.352729]  debug_smp_processor_id+0x1c/0x20
[ 1370.353317]  perf_ftrace_function_call+0x7c/0x360
[ 1370.353944]  ? perf_ftrace_function_call+0x4c/0x360
[ 1370.354602]  ? write_comp_data+0x2f/0x90
[ 1370.355134]  ? mutex_lock_nested+0x1b/0x20
[ 1370.355684]  ? mutex_lock_io_nested+0x940/0x940
[ 1370.356294]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1370.356926]  ? mutex_lock_nested+0x1b/0x20
[ 1370.357482]  ? perf_ftrace_function_call+0x4c/0x360
[ 1370.358140]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1370.358776]  ? ftrace_ops_test+0x71/0xc0
[ 1370.359333]  0xffffffffa0098099
[ 1370.359770]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1370.360403]  ? lock_is_held_type+0xe2/0x140
[ 1370.360971]  ? do_epoll_wait+0x3b3/0xd80
[ 1370.361517]  ? preempt_count_add+0x5/0xc0
[ 1370.362073]  preempt_count_add+0x5/0xc0
[ 1370.362594]  __mutex_lock+0x7b/0x9f0
[ 1370.363084]  ? preempt_count_add+0x5/0xc0
[ 1370.363625]  ? __mutex_lock+0x7b/0x9f0
[ 1370.364140]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1370.364860]  ? do_epoll_wait+0x3b3/0xd80
[ 1370.365395]  ? do_epoll_wait+0x3b3/0xd80
[ 1370.365936]  ? __mutex_lock+0x5/0x9f0
[ 1370.366456]  mutex_lock_nested+0x1b/0x20
[ 1370.366988]  ? __mutex_lock+0x5/0x9f0
[ 1370.367485]  ? mutex_lock_nested+0x1b/0x20
[ 1370.368041]  do_epoll_wait+0x3b3/0xd80
[ 1370.368594]  ? wait_woken+0x90/0x90
[ 1370.369091]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1370.369676]  do_syscall_64+0x37/0x80
[ 1370.370170]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1370.370845] RIP: 0033:0x7f8a39143b20
[ 1370.371330] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1370.373704] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1370.374692] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1370.375614] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1370.376535] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1370.377456] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1370.378380] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1370.379355] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1370.379402] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1370.380450] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1370.381531] caller is debug_smp_processor_id+0x1c/0x20
[ 1370.383147] Call Trace:
[ 1370.383183]  dump_stack_lvl+0xa4/0xd3
[ 1370.384801]  dump_stack+0x15/0x17
[ 1370.385346]  check_preemption_disabled+0x167/0x180
[ 1370.386159]  debug_smp_processor_id+0x1c/0x20
[ 1370.386850]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1370.387739]  perf_trace_buf_alloc+0x3d/0x100
[ 1370.388415]  ? text_poke+0x2b/0x60
[ 1370.388958]  ? do_sync_core+0x30/0x30
[ 1370.389561]  perf_ftrace_function_call+0x209/0x360
[ 1370.390324]  ? text_poke_bp_batch+0x93/0x2c0
[ 1370.391187]  ? 0xffffffffa0098099
[ 1370.391782]  ? __ia32_sys_setgid16+0x50/0x50
[ 1370.392506]  0xffffffffa0098099
[ 1370.393091]  ? _raw_spin_unlock+0x2c/0x50
[ 1370.393801]  ? __ia32_sys_setgid16+0x50/0x50
[ 1370.394483]  ? __text_poke+0x5/0x4e0
[ 1370.395065]  ? lock_is_held_type+0xe2/0x140
[ 1370.395755]  __text_poke+0x5/0x4e0
[ 1370.396312]  text_poke+0x2b/0x60
[ 1370.396844]  ? __text_poke+0x5/0x4e0
[ 1370.397412]  ? text_poke+0x2b/0x60
[ 1370.398003]  text_poke_bp_batch+0x93/0x2c0
[ 1370.398705]  ? kimage_file_post_load_cleanup+0xb0/0xb0
[ 1370.399549]  text_poke_queue+0xa7/0xc0
[ 1370.400202]  ftrace_replace_code+0xfd/0x170
[ 1370.400924]  ftrace_modify_all_code+0x1b1/0x270
[ 1370.401681]  arch_ftrace_update_code+0x9/0x10
[ 1370.402378]  ftrace_run_update_code+0x30/0xa0
[ 1370.403090]  ftrace_shutdown+0x2b8/0x4a0
[ 1370.403786]  unregister_ftrace_function+0x25/0x50
[ 1370.404533]  perf_ftrace_event_register+0x89/0xf0
[ 1370.405269]  ? perf_tp_event_init+0xa0/0xa0
[ 1370.405931]  perf_trace_destroy+0x37/0x60
[ 1370.406588]  tp_perf_event_destroy+0x15/0x20
[ 1370.407277]  _free_event+0xfc/0x7d0
[ 1370.407903]  put_event+0x37/0x50
[ 1370.408459]  perf_event_release_kernel+0x2f4/0x370
[ 1370.409274]  ? perf_event_release_kernel+0x370/0x370
[ 1370.410071]  perf_release+0x19/0x20
[ 1370.410651]  __fput+0x12d/0x460
[ 1370.411275]  ____fput+0x1a/0x20
[ 1370.411807]  task_work_run+0x8e/0xf0
[ 1370.412444]  do_exit+0x616/0x1310
[ 1370.413047]  ? write_comp_data+0x2f/0x90
[ 1370.413753]  do_group_exit+0x7e/0x130
[ 1370.414408]  get_signal+0x249/0x13c0
[ 1370.415036]  ? get_signal+0x5/0x13c0
[ 1370.415718]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1370.416580]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1370.417432]  exit_to_user_mode_prepare+0x154/0x240
[ 1370.418204]  syscall_exit_to_user_mode+0x2b/0x60
[ 1370.418942]  do_syscall_64+0x46/0x80
[ 1370.419534]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1370.420309] RIP: 0033:0x7fac0740459d
[ 1370.420881] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1370.421839] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1370.422969] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1370.424012] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1370.425055] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1370.426102] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1370.427145] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1370.428431] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1370.428561] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1370.429490] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1370.430619] caller is debug_smp_processor_id+0x1c/0x20
[ 1370.431982] Call Trace:
[ 1370.431991]  dump_stack_lvl+0xa4/0xd3
[ 1370.433506]  dump_stack+0x15/0x17
[ 1370.433968]  check_preemption_disabled+0x167/0x180
[ 1370.434626]  ? ep_item_poll.isra.21+0x54/0x90
[ 1370.435212]  ? devkmsg_llseek+0x110/0x110
[ 1370.435761]  debug_smp_processor_id+0x1c/0x20
[ 1370.436347]  perf_ftrace_function_call+0x7c/0x360
[ 1370.436980]  ? ftrace_ops_test+0x71/0xc0
[ 1370.437523]  ? ep_start_scan+0xc0/0x100
[ 1370.438054]  ? 0xffffffffa0098099
[ 1370.438513]  ? 0xffffffffa0098099
[ 1370.438968]  ? write_comp_data+0x2f/0x90
[ 1370.439502]  ? perf_trace_buf_update+0x70/0x70
[ 1370.440100]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1370.440738]  ? devkmsg_llseek+0x110/0x110
[ 1370.441284]  0xffffffffa0098099
[ 1370.441728]  ? ftrace_call+0x5/0x44
[ 1370.442227]  ? devkmsg_poll+0x5/0x100
[ 1370.442737]  devkmsg_poll+0x5/0x100
[ 1370.443216]  ep_item_poll.isra.21+0x54/0x90
[ 1370.443783]  ? devkmsg_poll+0x5/0x100
[ 1370.444280]  ? ep_item_poll.isra.21+0x54/0x90
[ 1370.444880]  do_epoll_wait+0x490/0xd80
[ 1370.445434]  ? wait_woken+0x90/0x90
[ 1370.445932]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1370.446526]  do_syscall_64+0x37/0x80
[ 1370.447018]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1370.447692] RIP: 0033:0x7f8a39143b20
[ 1370.448176] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1370.450566] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1370.451549] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1370.452471] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1370.453399] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1370.454343] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1370.455319] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1370.456296] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1370.456328] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1370.457311] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1370.458454] caller is debug_smp_processor_id+0x1c/0x20
[ 1370.459937] Call Trace:
[ 1370.460956]  dump_stack_lvl+0xa4/0xd3
[ 1370.461506]  dump_stack+0x15/0x17
[ 1370.461991]  check_preemption_disabled+0x167/0x180
[ 1370.462720]  debug_smp_processor_id+0x1c/0x20
[ 1370.463343]  perf_trace_buf_alloc+0x98/0x100
[ 1370.463957]  ? text_poke+0x2b/0x60
[ 1370.464448]  ? do_sync_core+0x30/0x30
[ 1370.464985]  perf_ftrace_function_call+0x209/0x360
[ 1370.465775]  ? 0xffffffffa0098099
[ 1370.466297]  ? __ia32_sys_setgid16+0x50/0x50
[ 1370.466934]  0xffffffffa0098099
[ 1370.467429]  ? _raw_spin_unlock+0x2c/0x50
[ 1370.468043]  ? __ia32_sys_setgid16+0x50/0x50
[ 1370.468655]  ? __text_poke+0x5/0x4e0
[ 1370.469175]  ? lock_is_held_type+0xe2/0x140
[ 1370.469788]  __text_poke+0x5/0x4e0
[ 1370.470297]  text_poke+0x2b/0x60
[ 1370.470773]  ? __text_poke+0x5/0x4e0
[ 1370.471288]  ? text_poke+0x2b/0x60
[ 1370.471804]  text_poke_bp_batch+0x93/0x2c0
[ 1370.472417]  ? kimage_file_post_load_cleanup+0xb0/0xb0
[ 1370.473164]  text_poke_queue+0xa7/0xc0
[ 1370.473732]  ftrace_replace_code+0xfd/0x170
[ 1370.474372]  ftrace_modify_all_code+0x1b1/0x270
[ 1370.475041]  arch_ftrace_update_code+0x9/0x10
[ 1370.475664]  ftrace_run_update_code+0x30/0xa0
[ 1370.476298]  ftrace_shutdown+0x2b8/0x4a0
[ 1370.476900]  unregister_ftrace_function+0x25/0x50
[ 1370.477571]  perf_ftrace_event_register+0x89/0xf0
[ 1370.478253]  ? perf_tp_event_init+0xa0/0xa0
[ 1370.478862]  perf_trace_destroy+0x37/0x60
[ 1370.479458]  tp_perf_event_destroy+0x15/0x20
[ 1370.480076]  _free_event+0xfc/0x7d0
[ 1370.480615]  put_event+0x37/0x50
[ 1370.481104]  perf_event_release_kernel+0x2f4/0x370
[ 1370.481818]  ? perf_event_release_kernel+0x370/0x370
[ 1370.482536]  perf_release+0x19/0x20
[ 1370.483051]  __fput+0x12d/0x460
[ 1370.483570]  ____fput+0x1a/0x20
[ 1370.484041]  task_work_run+0x8e/0xf0
[ 1370.484591]  do_exit+0x616/0x1310
[ 1370.485110]  ? write_comp_data+0x2f/0x90
[ 1370.485723]  do_group_exit+0x7e/0x130
[ 1370.486298]  get_signal+0x249/0x13c0
[ 1370.486842]  ? get_signal+0x5/0x13c0
[ 1370.487416]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1370.488149]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1370.488880]  exit_to_user_mode_prepare+0x154/0x240
[ 1370.489574]  syscall_exit_to_user_mode+0x2b/0x60
[ 1370.490252]  do_syscall_64+0x46/0x80
[ 1370.490780]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1370.491490] RIP: 0033:0x7fac0740459d
[ 1370.492007] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1370.492887] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1370.493923] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1370.494909] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1370.495873] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1370.496835] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1370.497797] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1370.498911] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1370.499989] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1370.501449] Call Trace:
[ 1370.501787]  dump_stack_lvl+0xa4/0xd3
[ 1370.502308]  dump_stack+0x15/0x17
[ 1370.502764]  check_preemption_disabled+0x167/0x180
[ 1370.503406]  ? devkmsg_poll+0x8a/0x100
[ 1370.503916]  ? prb_read_valid+0x40/0x40
[ 1370.504444]  debug_smp_processor_id+0x1c/0x20
[ 1370.505032]  perf_ftrace_function_call+0x7c/0x360
[ 1370.505664]  ? dump_stack_lvl+0xcc/0xd3
[ 1370.506199]  ? dump_stack+0x15/0x17
[ 1370.506678]  ? write_comp_data+0x2f/0x90
[ 1370.507211]  ? ep_item_poll.isra.21+0x54/0x90
[ 1370.507798]  ? devkmsg_llseek+0x110/0x110
[ 1370.508344]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1370.508975]  ? ep_item_poll.isra.21+0x54/0x90
[ 1370.509565]  ? perf_ftrace_function_call+0x4c/0x360
[ 1370.510227]  ? ftrace_ops_test+0x71/0xc0
[ 1370.510786]  0xffffffffa0098099
[ 1370.511221]  ? 0xffffffffa0098099
[ 1370.511687]  ? perf_trace_buf_update+0x70/0x70
[ 1370.512308]  ? prb_read_valid_info+0x5/0x80
[ 1370.512887]  prb_read_valid_info+0x5/0x80
[ 1370.513433]  devkmsg_poll+0x8a/0x100
[ 1370.513923]  ? prb_read_valid_info+0x5/0x80
[ 1370.514492]  ? devkmsg_poll+0x8a/0x100
[ 1370.515019]  ? devkmsg_poll+0x5/0x100
[ 1370.515539]  ? devkmsg_llseek+0x110/0x110
[ 1370.516083]  ep_item_poll.isra.21+0x54/0x90
[ 1370.516666]  do_epoll_wait+0x490/0xd80
[ 1370.517224]  ? wait_woken+0x90/0x90
[ 1370.517726]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1370.518316]  do_syscall_64+0x37/0x80
[ 1370.518809]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1370.519484] RIP: 0033:0x7f8a39143b20
[ 1370.519969] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1370.522363] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1370.523345] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1370.524265] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1370.525185] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1370.526188] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1370.527113] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1375.142072] check_preemption_disabled: 1367623 callbacks suppressed
[ 1375.142097] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1375.143955] caller is debug_smp_processor_id+0x1c/0x20
[ 1375.144637] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1375.145597] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1375.147045] Call Trace:
[ 1375.147394]  dump_stack_lvl+0xa4/0xd3
[ 1375.147916]  dump_stack+0x15/0x17
[ 1375.148378]  check_preemption_disabled+0x167/0x180
[ 1375.149048]  debug_smp_processor_id+0x1c/0x20
[ 1375.149640]  perf_trace_buf_alloc+0x98/0x100
[ 1375.150232]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1375.150816]  ? apply_paravirt+0x150/0x150
[ 1375.151368]  perf_ftrace_function_call+0x209/0x360
[ 1375.152109]  ? 0xffffffffa0098099
[ 1375.152622]  0xffffffffa0098099
[ 1375.153063]  ? _raw_spin_unlock+0x2c/0x50
[ 1375.153637]  ? __text_poke+0x2f2/0x4e0
[ 1375.154161]  ? acpi_os_get_timer+0x30/0x30
[ 1375.154746]  ? acpi_os_read_iomem+0xc0/0xc0
[ 1375.155313]  ? text_poke+0x5/0x60
[ 1375.155794]  text_poke+0x5/0x60
[ 1375.156234]  text_poke_bp_batch+0x1dc/0x2c0
[ 1375.156802]  ? text_poke+0x5/0x60
[ 1375.157258]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1375.157868]  ? __acpi_device_uevent_modalias+0x150/0x150
[ 1375.158603]  text_poke_queue+0xa7/0xc0
[ 1375.159140]  ftrace_replace_code+0xfd/0x170
[ 1375.159740]  ftrace_modify_all_code+0x1b1/0x270
[ 1375.160370]  arch_ftrace_update_code+0x9/0x10
[ 1375.160959]  ftrace_run_update_code+0x30/0xa0
[ 1375.161558]  ftrace_shutdown+0x2b8/0x4a0
[ 1375.162132]  unregister_ftrace_function+0x25/0x50
[ 1375.162778]  perf_ftrace_event_register+0x89/0xf0
[ 1375.163423]  ? perf_tp_event_init+0xa0/0xa0
[ 1375.163993]  perf_trace_destroy+0x37/0x60
[ 1375.164546]  tp_perf_event_destroy+0x15/0x20
[ 1375.165130]  _free_event+0xfc/0x7d0
[ 1375.165639]  put_event+0x37/0x50
[ 1375.166110]  perf_event_release_kernel+0x2f4/0x370
[ 1375.166787]  ? perf_event_release_kernel+0x370/0x370
[ 1375.167459]  perf_release+0x19/0x20
[ 1375.167945]  __fput+0x12d/0x460
[ 1375.168430]  ____fput+0x1a/0x20
[ 1375.168875]  task_work_run+0x8e/0xf0
[ 1375.169393]  do_exit+0x616/0x1310
[ 1375.169882]  ? write_comp_data+0x2f/0x90
[ 1375.170459]  do_group_exit+0x7e/0x130
[ 1375.170990]  get_signal+0x249/0x13c0
[ 1375.171502]  ? get_signal+0x5/0x13c0
[ 1375.172040]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1375.172728]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1375.173417]  exit_to_user_mode_prepare+0x154/0x240
[ 1375.174075]  syscall_exit_to_user_mode+0x2b/0x60
[ 1375.174704]  do_syscall_64+0x46/0x80
[ 1375.175203]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1375.175884] RIP: 0033:0x7fac0740459d
[ 1375.176375] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1375.177231] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1375.178234] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1375.179157] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1375.180074] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1375.181014] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1375.181986] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1375.183274] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1375.183286] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1375.184342] caller is debug_smp_processor_id+0x1c/0x20
[ 1375.185451] caller is debug_smp_processor_id+0x1c/0x20
[ 1375.186263] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1375.187871] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1375.189413] Call Trace:
[ 1375.189781]  dump_stack_lvl+0xa4/0xd3
[ 1375.190346]  dump_stack+0x15/0x17
[ 1375.190831]  check_preemption_disabled+0x167/0x180
[ 1375.191535]  debug_smp_processor_id+0x1c/0x20
[ 1375.192156]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1375.192923]  perf_tp_event+0x331/0x4e0
[ 1375.193611]  ? arch_local_irq_enable+0x10/0x12
[ 1375.194257]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1375.194933]  ? dump_stack_lvl+0xcc/0xd3
[ 1375.195502]  ? dump_stack+0x15/0x17
[ 1375.196010]  ? check_preemption_disabled+0x167/0x180
[ 1375.196736]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1375.197351]  ? apply_paravirt+0x150/0x150
[ 1375.197941]  perf_ftrace_function_call+0x248/0x360
[ 1375.198645]  ? perf_ftrace_function_call+0x248/0x360
[ 1375.199456]  ? 0xffffffffa0098099
[ 1375.199995]  0xffffffffa0098099
[ 1375.200458]  ? _raw_spin_unlock+0x2c/0x50
[ 1375.201056]  ? __text_poke+0x2f2/0x4e0
[ 1375.201603]  ? acpi_os_get_timer+0x30/0x30
[ 1375.202204]  ? acpi_os_read_iomem+0xc0/0xc0
[ 1375.202801]  ? text_poke+0x5/0x60
[ 1375.203307]  text_poke+0x5/0x60
[ 1375.203772]  text_poke_bp_batch+0x1dc/0x2c0
[ 1375.204371]  ? text_poke+0x5/0x60
[ 1375.204849]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1375.205489]  ? __acpi_device_uevent_modalias+0x150/0x150
[ 1375.206263]  text_poke_queue+0xa7/0xc0
[ 1375.206827]  ftrace_replace_code+0xfd/0x170
[ 1375.207451]  ftrace_modify_all_code+0x1b1/0x270
[ 1375.208113]  arch_ftrace_update_code+0x9/0x10
[ 1375.208734]  ftrace_run_update_code+0x30/0xa0
[ 1375.209365]  ftrace_shutdown+0x2b8/0x4a0
[ 1375.209961]  unregister_ftrace_function+0x25/0x50
[ 1375.210640]  perf_ftrace_event_register+0x89/0xf0
[ 1375.211306]  ? perf_tp_event_init+0xa0/0xa0
[ 1375.211904]  perf_trace_destroy+0x37/0x60
[ 1375.212487]  tp_perf_event_destroy+0x15/0x20
[ 1375.213101]  _free_event+0xfc/0x7d0
[ 1375.213635]  put_event+0x37/0x50
[ 1375.214132]  perf_event_release_kernel+0x2f4/0x370
[ 1375.214840]  ? perf_event_release_kernel+0x370/0x370
[ 1375.215546]  perf_release+0x19/0x20
[ 1375.216058]  __fput+0x12d/0x460
[ 1375.216568]  ____fput+0x1a/0x20
[ 1375.217036]  task_work_run+0x8e/0xf0
[ 1375.217581]  do_exit+0x616/0x1310
[ 1375.218101]  ? write_comp_data+0x2f/0x90
[ 1375.218703]  do_group_exit+0x7e/0x130
[ 1375.219260]  get_signal+0x249/0x13c0
[ 1375.219799]  ? get_signal+0x5/0x13c0
[ 1375.220364]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1375.221088]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1375.221813]  exit_to_user_mode_prepare+0x154/0x240
[ 1375.222507]  syscall_exit_to_user_mode+0x2b/0x60
[ 1375.223169]  do_syscall_64+0x46/0x80
[ 1375.223693]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1375.224403] RIP: 0033:0x7fac0740459d
[ 1375.224917] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1375.225800] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1375.226841] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1375.227802] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1375.228763] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1375.229726] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1375.230690] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1375.231765] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1375.231875] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1375.232833] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1375.233958] caller is debug_smp_processor_id+0x1c/0x20
[ 1375.235406] Call Trace:
[ 1375.235417]  dump_stack_lvl+0xa4/0xd3
[ 1375.236967]  dump_stack+0x15/0x17
[ 1375.237421]  check_preemption_disabled+0x167/0x180
[ 1375.238060]  ? __mutex_lock+0x56/0x9f0
[ 1375.238566]  ? ___might_sleep+0x170/0x170
[ 1375.239108]  debug_smp_processor_id+0x1c/0x20
[ 1375.239691]  perf_ftrace_function_call+0x7c/0x360
[ 1375.240316]  ? perf_ftrace_function_call+0x4c/0x360
[ 1375.240967]  ? write_comp_data+0x2f/0x90
[ 1375.241495]  ? mutex_lock_nested+0x1b/0x20
[ 1375.242043]  ? mutex_lock_io_nested+0x940/0x940
[ 1375.242655]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1375.243281]  ? mutex_lock_nested+0x1b/0x20
[ 1375.243830]  ? perf_ftrace_function_call+0x4c/0x360
[ 1375.244481]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1375.245108]  ? ftrace_ops_test+0x71/0xc0
[ 1375.245653]  0xffffffffa0098099
[ 1375.246082]  ? 0xffffffffa0098099
[ 1375.246531]  ? trace_hardirqs_on+0x6a/0x170
[ 1375.247093]  ? write_comp_data+0x2f/0x90
[ 1375.247623]  ? perf_trace_buf_update+0x70/0x70
[ 1375.248220]  ? do_epoll_wait+0x3b3/0xd80
[ 1375.248760]  ? __might_sleep+0x5/0x70
[ 1375.249262]  __might_sleep+0x5/0x70
[ 1375.249736]  __mutex_lock+0x56/0x9f0
[ 1375.250224]  ? __might_sleep+0x5/0x70
[ 1375.250718]  ? __mutex_lock+0x56/0x9f0
[ 1375.251229]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1375.251942]  ? do_epoll_wait+0x3b3/0xd80
[ 1375.252472]  ? do_epoll_wait+0x3b3/0xd80
[ 1375.253006]  ? __mutex_lock+0x5/0x9f0
[ 1375.253513]  mutex_lock_nested+0x1b/0x20
[ 1375.254040]  ? __mutex_lock+0x5/0x9f0
[ 1375.254540]  ? mutex_lock_nested+0x1b/0x20
[ 1375.255091]  do_epoll_wait+0x3b3/0xd80
[ 1375.255624]  ? wait_woken+0x90/0x90
[ 1375.256111]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1375.256685]  do_syscall_64+0x37/0x80
[ 1375.257170]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1375.257840] RIP: 0033:0x7f8a39143b20
[ 1375.258327] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1375.260692] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1375.261671] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1375.262594] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1375.263512] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1375.264431] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1375.265349] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1375.266306] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1375.266386] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1375.267401] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1375.268483] caller is debug_smp_processor_id+0x1c/0x20
[ 1375.270101] Call Trace:
[ 1375.270138]  dump_stack_lvl+0xa4/0xd3
[ 1375.271752]  dump_stack+0x15/0x17
[ 1375.272294]  check_preemption_disabled+0x167/0x180
[ 1375.273041]  ? text_poke+0x2b/0x60
[ 1375.273583]  ? do_sync_core+0x30/0x30
[ 1375.274197]  debug_smp_processor_id+0x1c/0x20
[ 1375.274883]  perf_ftrace_function_call+0x7c/0x360
[ 1375.275606]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1375.276336]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1375.277019]  ? perf_ftrace_function_call+0x4c/0x360
[ 1375.277990]  ? acpi_os_read_iomem+0xc0/0xc0
[ 1375.278702]  0xffffffffa0098099
[ 1375.279277]  ? _raw_spin_unlock+0x2c/0x50
[ 1375.279979]  ? acpi_os_read_iomem+0xc0/0xc0
[ 1375.280638]  ? __text_poke+0x5/0x4e0
[ 1375.281215]  ? lock_is_held_type+0xe2/0x140
[ 1375.281897]  __text_poke+0x5/0x4e0
[ 1375.282454]  text_poke+0x2b/0x60
[ 1375.282982]  ? __text_poke+0x5/0x4e0
[ 1375.283546]  ? text_poke+0x2b/0x60
[ 1375.284129]  text_poke_bp_batch+0x1dc/0x2c0
[ 1375.284830]  ? __acpi_device_uevent_modalias+0x150/0x150
[ 1375.285688]  text_poke_queue+0xa7/0xc0
[ 1375.286337]  ftrace_replace_code+0xfd/0x170
[ 1375.287050]  ftrace_modify_all_code+0x1b1/0x270
[ 1375.287801]  arch_ftrace_update_code+0x9/0x10
[ 1375.288485]  ftrace_run_update_code+0x30/0xa0
[ 1375.289190]  ftrace_shutdown+0x2b8/0x4a0
[ 1375.289879]  unregister_ftrace_function+0x25/0x50
[ 1375.290629]  perf_ftrace_event_register+0x89/0xf0
[ 1375.291362]  ? perf_tp_event_init+0xa0/0xa0
[ 1375.292023]  perf_trace_destroy+0x37/0x60
[ 1375.292672]  tp_perf_event_destroy+0x15/0x20
[ 1375.293358]  _free_event+0xfc/0x7d0
[ 1375.293978]  put_event+0x37/0x50
[ 1375.294533]  perf_event_release_kernel+0x2f4/0x370
[ 1375.295341]  ? perf_event_release_kernel+0x370/0x370
[ 1375.296130]  perf_release+0x19/0x20
[ 1375.296705]  __fput+0x12d/0x460
[ 1375.297319]  ____fput+0x1a/0x20
[ 1375.297848]  task_work_run+0x8e/0xf0
[ 1375.298482]  do_exit+0x616/0x1310
[ 1375.299077]  ? write_comp_data+0x2f/0x90
[ 1375.299775]  do_group_exit+0x7e/0x130
[ 1375.300418]  get_signal+0x249/0x13c0
[ 1375.301036]  ? get_signal+0x5/0x13c0
[ 1375.301707]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1375.302561]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1375.303416]  exit_to_user_mode_prepare+0x154/0x240
[ 1375.304182]  syscall_exit_to_user_mode+0x2b/0x60
[ 1375.304913]  do_syscall_64+0x46/0x80
[ 1375.305499]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1375.306276] RIP: 0033:0x7fac0740459d
[ 1375.306846] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1375.307803] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1375.308938] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1375.309977] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1375.311023] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1375.312065] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1375.313108] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1375.314379] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1375.314490] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1375.315440] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1375.316563] caller is debug_smp_processor_id+0x1c/0x20
[ 1375.318006] Call Trace:
[ 1375.318017]  dump_stack_lvl+0xa4/0xd3
[ 1375.318038]  dump_stack+0x15/0x17
[ 1375.318057]  check_preemption_disabled+0x167/0x180
[ 1375.318076]  ? __might_sleep+0x48/0x70
[ 1375.318090]  ? sched_show_task+0x70/0x70
[ 1375.318109]  debug_smp_processor_id+0x1c/0x20
[ 1375.322297]  perf_ftrace_function_call+0x7c/0x360
[ 1375.322925]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1375.323555]  ? __mutex_lock+0x56/0x9f0
[ 1375.324064]  ? perf_ftrace_function_call+0x4c/0x360
[ 1375.324712]  ? perf_ftrace_function_call+0x4c/0x360
[ 1375.325365]  ? write_comp_data+0x2f/0x90
[ 1375.325895]  ? mutex_lock_nested+0x1b/0x20
[ 1375.326449]  ? mutex_lock_io_nested+0x940/0x940
[ 1375.327054]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1375.327683]  ? mutex_lock_nested+0x1b/0x20
[ 1375.328235]  ? perf_ftrace_function_call+0x4c/0x360
[ 1375.328886]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1375.329516]  ? ftrace_ops_test+0x71/0xc0
[ 1375.330059]  0xffffffffa0098099
[ 1375.330494]  ? 0xffffffffa0098099
[ 1375.330943]  ? trace_hardirqs_on+0x6a/0x170
[ 1375.331506]  ? do_epoll_wait+0x3b3/0xd80
[ 1375.332046]  ? ___might_sleep+0x5/0x170
[ 1375.332569]  ___might_sleep+0x5/0x170
[ 1375.333067]  __might_sleep+0x48/0x70
[ 1375.333554]  ? ___might_sleep+0x5/0x170
[ 1375.334073]  ? __might_sleep+0x48/0x70
[ 1375.334585]  __mutex_lock+0x56/0x9f0
[ 1375.335075]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1375.335790]  ? do_epoll_wait+0x3b3/0xd80
[ 1375.336322]  ? do_epoll_wait+0x3b3/0xd80
[ 1375.336857]  ? __mutex_lock+0x5/0x9f0
[ 1375.337365]  mutex_lock_nested+0x1b/0x20
[ 1375.337894]  ? __mutex_lock+0x5/0x9f0
[ 1375.338392]  ? mutex_lock_nested+0x1b/0x20
[ 1375.338943]  do_epoll_wait+0x3b3/0xd80
[ 1375.339480]  ? wait_woken+0x90/0x90
[ 1375.339968]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1375.340544]  do_syscall_64+0x37/0x80
[ 1375.341032]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1375.341705] RIP: 0033:0x7f8a39143b20
[ 1375.342190] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1375.344561] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1375.345545] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1375.346471] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1375.347393] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1375.348315] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1375.349237] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1375.350199] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1375.350230] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1375.351298] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1375.352378] caller is debug_smp_processor_id+0x1c/0x20
[ 1375.353997] Call Trace:
[ 1375.354032]  dump_stack_lvl+0xa4/0xd3
[ 1375.355653]  dump_stack+0x15/0x17
[ 1375.356196]  check_preemption_disabled+0x167/0x180
[ 1375.357000]  debug_smp_processor_id+0x1c/0x20
[ 1375.357687]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1375.358573]  perf_trace_buf_alloc+0x3d/0x100
[ 1375.359247]  ? text_poke+0x2b/0x60
[ 1375.359789]  ? do_sync_core+0x30/0x30
[ 1375.360389]  perf_ftrace_function_call+0x209/0x360
[ 1375.361146]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1375.362006]  ? 0xffffffffa0098099
[ 1375.362599]  ? acpi_os_read_iomem+0xc0/0xc0
[ 1375.363304]  0xffffffffa0098099
[ 1375.363881]  ? _raw_spin_unlock+0x2c/0x50
[ 1375.364584]  ? acpi_os_read_iomem+0xc0/0xc0
[ 1375.365244]  ? __text_poke+0x5/0x4e0
[ 1375.365820]  ? lock_is_held_type+0xe2/0x140
[ 1375.366508]  __text_poke+0x5/0x4e0
[ 1375.367062]  text_poke+0x2b/0x60
[ 1375.367593]  ? __text_poke+0x5/0x4e0
[ 1375.368160]  ? text_poke+0x2b/0x60
[ 1375.368746]  text_poke_bp_batch+0x1dc/0x2c0
[ 1375.369452]  ? __acpi_device_uevent_modalias+0x150/0x150
[ 1375.370316]  text_poke_queue+0xa7/0xc0
[ 1375.370965]  ftrace_replace_code+0xfd/0x170
[ 1375.371681]  ftrace_modify_all_code+0x1b1/0x270
[ 1375.372435]  arch_ftrace_update_code+0x9/0x10
[ 1375.373121]  ftrace_run_update_code+0x30/0xa0
[ 1375.373828]  ftrace_shutdown+0x2b8/0x4a0
[ 1375.374526]  unregister_ftrace_function+0x25/0x50
[ 1375.375276]  perf_ftrace_event_register+0x89/0xf0
[ 1375.376011]  ? perf_tp_event_init+0xa0/0xa0
[ 1375.376669]  perf_trace_destroy+0x37/0x60
[ 1375.377319]  tp_perf_event_destroy+0x15/0x20
[ 1375.378004]  _free_event+0xfc/0x7d0
[ 1375.378662]  put_event+0x37/0x50
[ 1375.379215]  perf_event_release_kernel+0x2f4/0x370
[ 1375.380027]  ? perf_event_release_kernel+0x370/0x370
[ 1375.380819]  perf_release+0x19/0x20
[ 1375.381396]  __fput+0x12d/0x460
[ 1375.382014]  ____fput+0x1a/0x20
[ 1375.382549]  task_work_run+0x8e/0xf0
[ 1375.383183]  do_exit+0x616/0x1310
[ 1375.383781]  ? write_comp_data+0x2f/0x90
[ 1375.384482]  do_group_exit+0x7e/0x130
[ 1375.385128]  get_signal+0x249/0x13c0
[ 1375.385749]  ? get_signal+0x5/0x13c0
[ 1375.386434]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1375.387288]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1375.388130]  exit_to_user_mode_prepare+0x154/0x240
[ 1375.388896]  syscall_exit_to_user_mode+0x2b/0x60
[ 1375.389631]  do_syscall_64+0x46/0x80
[ 1375.390223]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1375.390997] RIP: 0033:0x7fac0740459d
[ 1375.391570] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1375.392529] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1375.393654] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1375.394698] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1375.395747] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1375.396788] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1375.397828] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1375.399102] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1375.399210] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1375.400164] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1375.401202] caller is debug_smp_processor_id+0x1c/0x20
[ 1375.402651] Call Trace:
[ 1375.402660]  dump_stack_lvl+0xa4/0xd3
[ 1375.402682]  dump_stack+0x15/0x17
[ 1375.402697]  check_preemption_disabled+0x167/0x180
[ 1375.402715]  ? __mutex_lock+0x7b/0x9f0
[ 1375.402729]  ? trace_sched_waking+0xc0/0xc0
[ 1375.402748]  debug_smp_processor_id+0x1c/0x20
[ 1375.406899]  perf_ftrace_function_call+0x7c/0x360
[ 1375.407527]  ? perf_ftrace_function_call+0x4c/0x360
[ 1375.408179]  ? write_comp_data+0x2f/0x90
[ 1375.408710]  ? mutex_lock_nested+0x1b/0x20
[ 1375.409260]  ? mutex_lock_io_nested+0x940/0x940
[ 1375.409867]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1375.410498]  ? mutex_lock_nested+0x1b/0x20
[ 1375.411050]  ? perf_ftrace_function_call+0x4c/0x360
[ 1375.411701]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1375.412331]  ? ftrace_ops_test+0x71/0xc0
[ 1375.412876]  0xffffffffa0098099
[ 1375.413308]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1375.413937]  ? lock_is_held_type+0xe2/0x140
[ 1375.414506]  ? do_epoll_wait+0x3b3/0xd80
[ 1375.415046]  ? preempt_count_add+0x5/0xc0
[ 1375.415592]  preempt_count_add+0x5/0xc0
[ 1375.416111]  __mutex_lock+0x7b/0x9f0
[ 1375.416597]  ? preempt_count_add+0x5/0xc0
[ 1375.417135]  ? __mutex_lock+0x7b/0x9f0
[ 1375.417646]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1375.418365]  ? do_epoll_wait+0x3b3/0xd80
[ 1375.418897]  ? do_epoll_wait+0x3b3/0xd80
[ 1375.419433]  ? __mutex_lock+0x5/0x9f0
[ 1375.419941]  mutex_lock_nested+0x1b/0x20
[ 1375.420470]  ? __mutex_lock+0x5/0x9f0
[ 1375.420967]  ? mutex_lock_nested+0x1b/0x20
[ 1375.421518]  do_epoll_wait+0x3b3/0xd80
[ 1375.422059]  ? wait_woken+0x90/0x90
[ 1375.422547]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1375.423123]  do_syscall_64+0x37/0x80
[ 1375.423610]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1375.424282] RIP: 0033:0x7f8a39143b20
[ 1375.424763] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1375.427140] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1375.428124] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1375.429048] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1375.429972] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1375.430899] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1375.431821] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1375.432777] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1375.432809] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1375.433797] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1375.434909] caller is debug_smp_processor_id+0x1c/0x20
[ 1375.436401] Call Trace:
[ 1375.437418]  dump_stack_lvl+0xa4/0xd3
[ 1375.437966]  dump_stack+0x15/0x17
[ 1375.438455]  check_preemption_disabled+0x167/0x180
[ 1375.439161]  debug_smp_processor_id+0x1c/0x20
[ 1375.439784]  perf_trace_buf_alloc+0x98/0x100
[ 1375.440396]  ? text_poke+0x2b/0x60
[ 1375.440888]  ? do_sync_core+0x30/0x30
[ 1375.441424]  perf_ftrace_function_call+0x209/0x360
[ 1375.442207]  ? 0xffffffffa0098099
[ 1375.442714]  ? acpi_os_read_iomem+0xc0/0xc0
[ 1375.443335]  0xffffffffa0098099
[ 1375.443825]  ? _raw_spin_unlock+0x2c/0x50
[ 1375.444434]  ? acpi_os_read_iomem+0xc0/0xc0
[ 1375.445031]  ? __text_poke+0x5/0x4e0
[ 1375.445551]  ? lock_is_held_type+0xe2/0x140
[ 1375.446165]  __text_poke+0x5/0x4e0
[ 1375.446662]  text_poke+0x2b/0x60
[ 1375.447137]  ? __text_poke+0x5/0x4e0
[ 1375.447650]  ? text_poke+0x2b/0x60
[ 1375.448163]  text_poke_bp_batch+0x1dc/0x2c0
[ 1375.448783]  ? __acpi_device_uevent_modalias+0x150/0x150
[ 1375.449549]  text_poke_queue+0xa7/0xc0
[ 1375.450117]  ftrace_replace_code+0xfd/0x170
[ 1375.450742]  ftrace_modify_all_code+0x1b1/0x270
[ 1375.451406]  arch_ftrace_update_code+0x9/0x10
[ 1375.452027]  ftrace_run_update_code+0x30/0xa0
[ 1375.452656]  ftrace_shutdown+0x2b8/0x4a0
[ 1375.453252]  unregister_ftrace_function+0x25/0x50
[ 1375.453924]  perf_ftrace_event_register+0x89/0xf0
[ 1375.454596]  ? perf_tp_event_init+0xa0/0xa0
[ 1375.455194]  perf_trace_destroy+0x37/0x60
[ 1375.455777]  tp_perf_event_destroy+0x15/0x20
[ 1375.456393]  _free_event+0xfc/0x7d0
[ 1375.456950]  put_event+0x37/0x50
[ 1375.457440]  perf_event_release_kernel+0x2f4/0x370
[ 1375.458158]  ? perf_event_release_kernel+0x370/0x370
[ 1375.458867]  perf_release+0x19/0x20
[ 1375.459380]  __fput+0x12d/0x460
[ 1375.459892]  ____fput+0x1a/0x20
[ 1375.460362]  task_work_run+0x8e/0xf0
[ 1375.460908]  do_exit+0x616/0x1310
[ 1375.461422]  ? write_comp_data+0x2f/0x90
[ 1375.462023]  do_group_exit+0x7e/0x130
[ 1375.462584]  get_signal+0x249/0x13c0
[ 1375.463126]  ? get_signal+0x5/0x13c0
[ 1375.463691]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1375.464412]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1375.465136]  exit_to_user_mode_prepare+0x154/0x240
[ 1375.465822]  syscall_exit_to_user_mode+0x2b/0x60
[ 1375.466486]  do_syscall_64+0x46/0x80
[ 1375.467010]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1375.467719] RIP: 0033:0x7fac0740459d
[ 1375.468234] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1375.469116] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1375.470151] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1375.471114] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1375.472077] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1375.473039] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1375.474004] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1375.475079] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1375.475185] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1375.476143] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1375.477182] caller is debug_smp_processor_id+0x1c/0x20
[ 1375.478636] Call Trace:
[ 1375.478645]  dump_stack_lvl+0xa4/0xd3
[ 1375.478667]  dump_stack+0x15/0x17
[ 1375.478682]  check_preemption_disabled+0x167/0x180
[ 1375.478700]  ? do_epoll_wait+0x3bf/0xd80
[ 1375.478716]  ? __ia32_sys_fanotify_init+0x5c0/0x5c0
[ 1375.478738]  debug_smp_processor_id+0x1c/0x20
[ 1375.483007]  perf_ftrace_function_call+0x7c/0x360
[ 1375.483645]  ? 0xffffffffa0098099
[ 1375.484108]  ? do_epoll_wait+0x3b3/0xd80
[ 1375.484646]  ? preempt_count_sub+0x5/0xa0
[ 1375.485198]  0xffffffffa0098099
[ 1375.485626]  ? __mutex_lock+0xfe/0x9f0
[ 1375.486144]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1375.486860]  ? do_epoll_wait+0x3b3/0xd80
[ 1375.487398]  ? ep_start_scan+0x5/0x100
[ 1375.487913]  ep_start_scan+0x5/0x100
[ 1375.488398]  do_epoll_wait+0x3bf/0xd80
[ 1375.488907]  ? ep_start_scan+0x5/0x100
[ 1375.489415]  ? do_epoll_wait+0x3bf/0xd80
[ 1375.489970]  ? wait_woken+0x90/0x90
[ 1375.490460]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1375.491035]  do_syscall_64+0x37/0x80
[ 1375.491521]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1375.492191] RIP: 0033:0x7f8a39143b20
[ 1375.492672] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1375.495039] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1375.496028] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1375.496948] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1375.497866] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1375.498787] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1375.499703] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1375.500656] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1375.501687] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1375.503233] Call Trace:
[ 1375.503598]  dump_stack_lvl+0xa4/0xd3
[ 1375.504146]  dump_stack+0x15/0x17
[ 1375.504635]  check_preemption_disabled+0x167/0x180
[ 1375.505340]  debug_smp_processor_id+0x1c/0x20
[ 1375.505963]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1375.506733]  perf_tp_event+0x331/0x4e0
[ 1375.507354]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1375.508176]  ? arch_local_irq_enable+0x10/0x12
[ 1375.508811]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1375.509487]  ? dump_stack_lvl+0xcc/0xd3
[ 1375.510060]  ? dump_stack+0x15/0x17
[ 1375.510566]  ? check_preemption_disabled+0x167/0x180
[ 1375.511286]  ? text_poke+0x2b/0x60
[ 1375.511777]  ? do_sync_core+0x30/0x30
[ 1375.512319]  perf_ftrace_function_call+0x248/0x360
[ 1375.512999]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1375.513664]  ? perf_ftrace_function_call+0x248/0x360
[ 1375.514478]  ? 0xffffffffa0098099
[ 1375.514986]  ? acpi_os_read_iomem+0xc0/0xc0
[ 1375.515605]  0xffffffffa0098099
[ 1375.516094]  ? _raw_spin_unlock+0x2c/0x50
[ 1375.516703]  ? acpi_os_read_iomem+0xc0/0xc0
[ 1375.517301]  ? __text_poke+0x5/0x4e0
[ 1375.517821]  ? lock_is_held_type+0xe2/0x140
[ 1375.518434]  __text_poke+0x5/0x4e0
[ 1375.518931]  text_poke+0x2b/0x60
[ 1375.519405]  ? __text_poke+0x5/0x4e0
[ 1375.519918]  ? text_poke+0x2b/0x60
[ 1375.520430]  text_poke_bp_batch+0x1dc/0x2c0
[ 1375.521048]  ? __acpi_device_uevent_modalias+0x150/0x150
[ 1375.521814]  text_poke_queue+0xa7/0xc0
[ 1375.522489]  ftrace_replace_code+0xfd/0x170
[ 1375.523114]  ftrace_modify_all_code+0x1b1/0x270
[ 1375.523774]  arch_ftrace_update_code+0x9/0x10
[ 1375.524391]  ftrace_run_update_code+0x30/0xa0
[ 1375.525017]  ftrace_shutdown+0x2b8/0x4a0
[ 1375.525610]  unregister_ftrace_function+0x25/0x50
[ 1375.526284]  perf_ftrace_event_register+0x89/0xf0
[ 1375.526948]  ? perf_tp_event_init+0xa0/0xa0
[ 1375.527543]  perf_trace_destroy+0x37/0x60
[ 1375.528124]  tp_perf_event_destroy+0x15/0x20
[ 1375.528737]  _free_event+0xfc/0x7d0
[ 1375.529270]  put_event+0x37/0x50
[ 1375.529752]  perf_event_release_kernel+0x2f4/0x370
[ 1375.530459]  ? perf_event_release_kernel+0x370/0x370
[ 1375.531170]  perf_release+0x19/0x20
[ 1375.531681]  __fput+0x12d/0x460
[ 1375.532190]  ____fput+0x1a/0x20
[ 1375.532657]  task_work_run+0x8e/0xf0
[ 1375.533208]  do_exit+0x616/0x1310
[ 1375.533717]  ? write_comp_data+0x2f/0x90
[ 1375.534322]  do_group_exit+0x7e/0x130
[ 1375.534879]  get_signal+0x249/0x13c0
[ 1375.535417]  ? get_signal+0x5/0x13c0
[ 1375.535979]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1375.536707]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1375.537430]  exit_to_user_mode_prepare+0x154/0x240
[ 1375.538125]  syscall_exit_to_user_mode+0x2b/0x60
[ 1375.538915]  do_syscall_64+0x46/0x80
[ 1375.539477]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1375.540184] RIP: 0033:0x7fac0740459d
[ 1375.540699] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1375.541587] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1375.542631] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1375.543594] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1375.544559] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1375.545521] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1375.546492] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1380.146074] check_preemption_disabled: 1585505 callbacks suppressed
[ 1380.146101] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1380.146151] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1380.146965] caller is debug_smp_processor_id+0x1c/0x20
[ 1380.147828] caller is debug_smp_processor_id+0x1c/0x20
[ 1380.148840] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1380.150997] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1380.152429] Call Trace:
[ 1380.152797]  dump_stack_lvl+0xa4/0xd3
[ 1380.153352]  dump_stack+0x15/0x17
[ 1380.153832]  check_preemption_disabled+0x167/0x180
[ 1380.154502]  ? insn_decode+0x9b/0x170
[ 1380.155014]  ? insn_get_immediate+0x570/0x570
[ 1380.155638]  debug_smp_processor_id+0x1c/0x20
[ 1380.156244]  perf_ftrace_function_call+0x7c/0x360
[ 1380.156895]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1380.157542]  ? text_poke_loc_init+0x63/0x140
[ 1380.158147]  ? perf_ftrace_function_call+0x4c/0x360
[ 1380.159076]  0xffffffffa0098099
[ 1380.159551]  ? adp5520_suspend+0x50/0x50
[ 1380.160138]  ? 0xffffffffa0098099
[ 1380.160714]  ? insn_get_length+0x5/0x90
[ 1380.161256]  ? write_comp_data+0x2f/0x90
[ 1380.161829]  insn_get_length+0x5/0x90
[ 1380.162371]  insn_decode+0x9b/0x170
[ 1380.162899]  ? insn_get_length+0x5/0x90
[ 1380.163450]  ? insn_decode+0x9b/0x170
[ 1380.164001]  ? adp5520_suspend+0x50/0x50
[ 1380.164568]  text_poke_loc_init+0x63/0x140
[ 1380.165285]  ? adp5520_suspend+0x50/0x50
[ 1380.165877]  text_poke_queue+0x84/0xc0
[ 1380.166467]  ftrace_replace_code+0xfd/0x170
[ 1380.167103]  ftrace_modify_all_code+0x1b1/0x270
[ 1380.167770]  arch_ftrace_update_code+0x9/0x10
[ 1380.168375]  ftrace_run_update_code+0x30/0xa0
[ 1380.168999]  ftrace_shutdown+0x2b8/0x4a0
[ 1380.169612]  unregister_ftrace_function+0x25/0x50
[ 1380.170288]  perf_ftrace_event_register+0x89/0xf0
[ 1380.170972]  ? perf_tp_event_init+0xa0/0xa0
[ 1380.171586]  perf_trace_destroy+0x37/0x60
[ 1380.172168]  tp_perf_event_destroy+0x15/0x20
[ 1380.172772]  _free_event+0xfc/0x7d0
[ 1380.173321]  put_event+0x37/0x50
[ 1380.173810]  perf_event_release_kernel+0x2f4/0x370
[ 1380.174534]  ? perf_event_release_kernel+0x370/0x370
[ 1380.175232]  perf_release+0x19/0x20
[ 1380.175743]  __fput+0x12d/0x460
[ 1380.176294]  ____fput+0x1a/0x20
[ 1380.176764]  task_work_run+0x8e/0xf0
[ 1380.177327]  do_exit+0x616/0x1310
[ 1380.177860]  ? write_comp_data+0x2f/0x90
[ 1380.178497]  do_group_exit+0x7e/0x130
[ 1380.179072]  get_signal+0x249/0x13c0
[ 1380.179641]  ? get_signal+0x5/0x13c0
[ 1380.180286]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1380.181109]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1380.181921]  exit_to_user_mode_prepare+0x154/0x240
[ 1380.182663]  syscall_exit_to_user_mode+0x2b/0x60
[ 1380.183370]  do_syscall_64+0x46/0x80
[ 1380.183936]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1380.184678] RIP: 0033:0x7fac0740459d
[ 1380.185228] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1380.186148] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1380.187231] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1380.188235] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1380.189237] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1380.190244] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1380.191244] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1380.192471] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1380.192591] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1380.193418] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1380.194589] caller is debug_smp_processor_id+0x1c/0x20
[ 1380.195854] Call Trace:
[ 1380.195865]  dump_stack_lvl+0xa4/0xd3
[ 1380.197331]  dump_stack+0x15/0x17
[ 1380.197755]  check_preemption_disabled+0x167/0x180
[ 1380.198357]  ? schedule_timeout+0x34e/0x610
[ 1380.198883]  ? do_init_timer+0xa0/0xa0
[ 1380.199363]  debug_smp_processor_id+0x1c/0x20
[ 1380.199911]  perf_ftrace_function_call+0x7c/0x360
[ 1380.200505]  ? 0xffffffffa0098099
[ 1380.200928]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1380.201532]  ? finish_task_switch+0xab/0x2a0
[ 1380.202069]  ? __schedule+0x46e/0xb20
[ 1380.202552]  0xffffffffa0098099
[ 1380.202958]  ? finish_task_switch+0xb0/0x2a0
[ 1380.203511]  ? del_timer_sync+0x5/0x130
[ 1380.204005]  del_timer_sync+0x5/0x130
[ 1380.204471]  schedule_timeout+0x34e/0x610
[ 1380.204980]  ? del_timer_sync+0x5/0x130
[ 1380.205466]  ? schedule_timeout+0x34e/0x610
[ 1380.206002]  ? del_timer_sync+0x130/0x130
[ 1380.206519]  ? i915_init_ggtt+0x40/0x6b0
[ 1380.207029]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1380.207537]  ? rcu_gp_init+0x730/0x730
[ 1380.208012]  rcu_gp_kthread+0xdd/0x170
[ 1380.208496]  kthread+0x1e7/0x230
[ 1380.208915]  ? set_kthread_struct+0x80/0x80
[ 1380.209450]  ret_from_fork+0x1f/0x30
[ 1380.209942] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1380.209995] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1380.210997] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1380.211963] caller is debug_smp_processor_id+0x1c/0x20
[ 1380.213513] Call Trace:
[ 1380.214522]  dump_stack_lvl+0xa4/0xd3
[ 1380.215125]  dump_stack+0x15/0x17
[ 1380.215649]  check_preemption_disabled+0x167/0x180
[ 1380.216425]  debug_smp_processor_id+0x1c/0x20
[ 1380.217088]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1380.217943]  perf_trace_buf_alloc+0x3d/0x100
[ 1380.218604]  ? insn_decode+0x9b/0x170
[ 1380.219164]  ? insn_get_immediate+0x570/0x570
[ 1380.219837]  perf_ftrace_function_call+0x209/0x360
[ 1380.220768]  ? 0xffffffffa0098099
[ 1380.221408]  0xffffffffa0098099
[ 1380.221926]  ? adp5520_suspend+0x50/0x50
[ 1380.222551]  ? 0xffffffffa0098099
[ 1380.223178]  ? insn_get_length+0x5/0x90
[ 1380.223771]  ? write_comp_data+0x2f/0x90
[ 1380.224396]  insn_get_length+0x5/0x90
[ 1380.224966]  insn_decode+0x9b/0x170
[ 1380.225512]  ? insn_get_length+0x5/0x90
[ 1380.226096]  ? insn_decode+0x9b/0x170
[ 1380.226687]  ? adp5520_suspend+0x50/0x50
[ 1380.227293]  text_poke_loc_init+0x63/0x140
[ 1380.228074]  ? adp5520_suspend+0x50/0x50
[ 1380.228723]  text_poke_queue+0x84/0xc0
[ 1380.229350]  ftrace_replace_code+0xfd/0x170
[ 1380.230045]  ftrace_modify_all_code+0x1b1/0x270
[ 1380.230781]  arch_ftrace_update_code+0x9/0x10
[ 1380.231444]  ftrace_run_update_code+0x30/0xa0
[ 1380.232128]  ftrace_shutdown+0x2b8/0x4a0
[ 1380.232797]  unregister_ftrace_function+0x25/0x50
[ 1380.233517]  perf_ftrace_event_register+0x89/0xf0
[ 1380.234242]  ? perf_tp_event_init+0xa0/0xa0
[ 1380.234882]  perf_trace_destroy+0x37/0x60
[ 1380.235511]  tp_perf_event_destroy+0x15/0x20
[ 1380.236174]  _free_event+0xfc/0x7d0
[ 1380.236776]  put_event+0x37/0x50
[ 1380.237309]  perf_event_release_kernel+0x2f4/0x370
[ 1380.238098]  ? perf_event_release_kernel+0x370/0x370
[ 1380.238863]  perf_release+0x19/0x20
[ 1380.239420]  __fput+0x12d/0x460
[ 1380.240020]  ____fput+0x1a/0x20
[ 1380.240533]  task_work_run+0x8e/0xf0
[ 1380.241145]  do_exit+0x616/0x1310
[ 1380.241725]  ? write_comp_data+0x2f/0x90
[ 1380.242408]  do_group_exit+0x7e/0x130
[ 1380.243034]  get_signal+0x249/0x13c0
[ 1380.243635]  ? get_signal+0x5/0x13c0
[ 1380.244292]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1380.245120]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1380.245936]  exit_to_user_mode_prepare+0x154/0x240
[ 1380.246680]  syscall_exit_to_user_mode+0x2b/0x60
[ 1380.247391]  do_syscall_64+0x46/0x80
[ 1380.247961]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1380.248708] RIP: 0033:0x7fac0740459d
[ 1380.249259] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1380.250191] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1380.251280] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1380.252282] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1380.253286] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1380.254293] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1380.255297] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1380.256530] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1380.256638] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1380.257472] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1380.258562] caller is debug_smp_processor_id+0x1c/0x20
[ 1380.259825] Call Trace:
[ 1380.259833]  dump_stack_lvl+0xa4/0xd3
[ 1380.261245]  dump_stack+0x15/0x17
[ 1380.261671]  check_preemption_disabled+0x167/0x180
[ 1380.262275]  ? del_timer_sync+0xd3/0x130
[ 1380.262772]  ? detach_if_pending+0x270/0x270
[ 1380.263315]  debug_smp_processor_id+0x1c/0x20
[ 1380.263863]  perf_ftrace_function_call+0x7c/0x360
[ 1380.264451]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1380.265046]  ? register_lock_class+0x42/0x440
[ 1380.265600]  ? del_timer_sync+0x40/0x130
[ 1380.266104]  ? 0xffffffffa0098099
[ 1380.266529]  ? 0xffffffffa0098099
[ 1380.266955]  ? 0xffffffffa0098099
[ 1380.267391]  0xffffffffa0098099
[ 1380.267793]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1380.268408]  ? del_timer_sync+0xa5/0x130
[ 1380.268910]  ? try_to_del_timer_sync+0x5/0x90
[ 1380.269460]  ? write_comp_data+0x2f/0x90
[ 1380.269959]  try_to_del_timer_sync+0x5/0x90
[ 1380.270492]  del_timer_sync+0xd3/0x130
[ 1380.270971]  ? try_to_del_timer_sync+0x5/0x90
[ 1380.271517]  ? del_timer_sync+0xd3/0x130
[ 1380.272019]  schedule_timeout+0x34e/0x610
[ 1380.272536]  ? del_timer_sync+0x130/0x130
[ 1380.273050]  ? i915_init_ggtt+0x40/0x6b0
[ 1380.273559]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1380.274069]  ? rcu_gp_init+0x730/0x730
[ 1380.274593]  rcu_gp_kthread+0xdd/0x170
[ 1380.275059]  kthread+0x1e7/0x230
[ 1380.275473]  ? set_kthread_struct+0x80/0x80
[ 1380.276008]  ret_from_fork+0x1f/0x30
[ 1380.276498] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1380.276517] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1380.277465] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1380.278449] caller is debug_smp_processor_id+0x1c/0x20
[ 1380.279862] Call Trace:
[ 1380.280821]  dump_stack_lvl+0xa4/0xd3
[ 1380.281344]  dump_stack+0x15/0x17
[ 1380.281808]  check_preemption_disabled+0x167/0x180
[ 1380.282486]  debug_smp_processor_id+0x1c/0x20
[ 1380.283080]  perf_trace_buf_alloc+0x98/0x100
[ 1380.283664]  ? insn_decode+0x9b/0x170
[ 1380.284164]  ? insn_get_immediate+0x570/0x570
[ 1380.284761]  perf_ftrace_function_call+0x209/0x360
[ 1380.285508]  ? 0xffffffffa0098099
[ 1380.286032]  0xffffffffa0098099
[ 1380.286487]  ? adp5520_suspend+0x50/0x50
[ 1380.287033]  ? 0xffffffffa0098099
[ 1380.287543]  ? insn_get_length+0x5/0x90
[ 1380.288071]  ? write_comp_data+0x2f/0x90
[ 1380.288619]  insn_get_length+0x5/0x90
[ 1380.289126]  insn_decode+0x9b/0x170
[ 1380.289609]  ? insn_get_length+0x5/0x90
[ 1380.290134]  ? insn_decode+0x9b/0x170
[ 1380.290648]  ? adp5520_suspend+0x50/0x50
[ 1380.291187]  text_poke_loc_init+0x63/0x140
[ 1380.291820]  ? adp5520_suspend+0x50/0x50
[ 1380.292381]  text_poke_queue+0x84/0xc0
[ 1380.292919]  ftrace_replace_code+0xfd/0x170
[ 1380.293516]  ftrace_modify_all_code+0x1b1/0x270
[ 1380.294154]  arch_ftrace_update_code+0x9/0x10
[ 1380.294746]  ftrace_run_update_code+0x30/0xa0
[ 1380.295349]  ftrace_shutdown+0x2b8/0x4a0
[ 1380.295919]  unregister_ftrace_function+0x25/0x50
[ 1380.296556]  perf_ftrace_event_register+0x89/0xf0
[ 1380.297193]  ? perf_tp_event_init+0xa0/0xa0
[ 1380.297764]  perf_trace_destroy+0x37/0x60
[ 1380.298329]  tp_perf_event_destroy+0x15/0x20
[ 1380.298916]  _free_event+0xfc/0x7d0
[ 1380.299427]  put_event+0x37/0x50
[ 1380.299890]  perf_event_release_kernel+0x2f4/0x370
[ 1380.300568]  ? perf_event_release_kernel+0x370/0x370
[ 1380.301243]  perf_release+0x19/0x20
[ 1380.301733]  __fput+0x12d/0x460
[ 1380.302232]  ____fput+0x1a/0x20
[ 1380.302686]  task_work_run+0x8e/0xf0
[ 1380.303208]  do_exit+0x616/0x1310
[ 1380.303699]  ? write_comp_data+0x2f/0x90
[ 1380.304272]  do_group_exit+0x7e/0x130
[ 1380.304806]  get_signal+0x249/0x13c0
[ 1380.305322]  ? get_signal+0x5/0x13c0
[ 1380.305865]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1380.306569]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1380.307263]  exit_to_user_mode_prepare+0x154/0x240
[ 1380.307922]  syscall_exit_to_user_mode+0x2b/0x60
[ 1380.308558]  do_syscall_64+0x46/0x80
[ 1380.309063]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1380.309740] RIP: 0033:0x7fac0740459d
[ 1380.310239] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1380.311087] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1380.312074] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1380.312993] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1380.313915] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1380.314867] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1380.315791] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1380.316820] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1380.316929] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1380.317766] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1380.318850] caller is debug_smp_processor_id+0x1c/0x20
[ 1380.320113] Call Trace:
[ 1380.321124]  dump_stack_lvl+0xa4/0xd3
[ 1380.321628]  dump_stack+0x15/0x17
[ 1380.322060]  check_preemption_disabled+0x167/0x180
[ 1380.322669]  ? try_to_del_timer_sync+0x33/0x90
[ 1380.323227]  ? calc_wheel_index+0x2d0/0x2d0
[ 1380.323758]  debug_smp_processor_id+0x1c/0x20
[ 1380.324307]  perf_ftrace_function_call+0x7c/0x360
[ 1380.324897]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1380.325485]  ? del_timer_sync+0xd3/0x130
[ 1380.325981]  ? perf_ftrace_function_call+0x4c/0x360
[ 1380.326599]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1380.327195]  ? register_lock_class+0x42/0x440
[ 1380.327749]  ? del_timer_sync+0x40/0x130
[ 1380.328250]  ? 0xffffffffa0098099
[ 1380.328674]  ? 0xffffffffa0098099
[ 1380.329107]  0xffffffffa0098099
[ 1380.329515]  ? 0xffffffffa0098099
[ 1380.329938]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1380.330539]  ? del_timer_sync+0xa5/0x130
[ 1380.331041]  ? lock_timer_base+0x5/0x100
[ 1380.331543]  lock_timer_base+0x5/0x100
[ 1380.332019]  try_to_del_timer_sync+0x33/0x90
[ 1380.332557]  ? lock_timer_base+0x5/0x100
[ 1380.333053]  ? try_to_del_timer_sync+0x33/0x90
[ 1380.333610]  ? try_to_del_timer_sync+0x5/0x90
[ 1380.334181]  del_timer_sync+0xd3/0x130
[ 1380.334666]  schedule_timeout+0x34e/0x610
[ 1380.335182]  ? del_timer_sync+0x130/0x130
[ 1380.335697]  ? i915_init_ggtt+0x40/0x6b0
[ 1380.336205]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1380.336712]  ? rcu_gp_init+0x730/0x730
[ 1380.337187]  rcu_gp_kthread+0xdd/0x170
[ 1380.337670]  kthread+0x1e7/0x230
[ 1380.338095]  ? set_kthread_struct+0x80/0x80
[ 1380.338631]  ret_from_fork+0x1f/0x30
[ 1380.339121] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1380.339145] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1380.340086] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1380.341050] caller is debug_smp_processor_id+0x1c/0x20
[ 1380.342490] Call Trace:
[ 1380.342510]  dump_stack_lvl+0xa4/0xd3
[ 1380.343964]  dump_stack+0x15/0x17
[ 1380.344426]  check_preemption_disabled+0x167/0x180
[ 1380.345107]  debug_smp_processor_id+0x1c/0x20
[ 1380.345734]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1380.346477]  perf_tp_event+0x331/0x4e0
[ 1380.347140]  ? arch_local_irq_enable+0x10/0x12
[ 1380.347746]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1380.348391]  ? dump_stack_lvl+0xcc/0xd3
[ 1380.348931]  ? dump_stack+0x15/0x17
[ 1380.349415]  ? check_preemption_disabled+0x167/0x180
[ 1380.350108]  ? insn_decode+0x9b/0x170
[ 1380.350608]  ? insn_get_immediate+0x570/0x570
[ 1380.351208]  perf_ftrace_function_call+0x248/0x360
[ 1380.351847]  ? perf_ftrace_function_call+0x248/0x360
[ 1380.352624]  ? 0xffffffffa0098099
[ 1380.353142]  0xffffffffa0098099
[ 1380.353589]  ? adp5520_suspend+0x50/0x50
[ 1380.354142]  ? 0xffffffffa0098099
[ 1380.354654]  ? insn_get_length+0x5/0x90
[ 1380.355180]  ? write_comp_data+0x2f/0x90
[ 1380.355728]  insn_get_length+0x5/0x90
[ 1380.356233]  insn_decode+0x9b/0x170
[ 1380.356717]  ? insn_get_length+0x5/0x90
[ 1380.357238]  ? insn_decode+0x9b/0x170
[ 1380.357753]  ? adp5520_suspend+0x50/0x50
[ 1380.358300]  text_poke_loc_init+0x63/0x140
[ 1380.358937]  ? adp5520_suspend+0x50/0x50
[ 1380.359497]  text_poke_queue+0x84/0xc0
[ 1380.360038]  ftrace_replace_code+0xfd/0x170
[ 1380.360637]  ftrace_modify_all_code+0x1b1/0x270
[ 1380.361273]  arch_ftrace_update_code+0x9/0x10
[ 1380.361865]  ftrace_run_update_code+0x30/0xa0
[ 1380.362471]  ftrace_shutdown+0x2b8/0x4a0
[ 1380.363041]  unregister_ftrace_function+0x25/0x50
[ 1380.363681]  perf_ftrace_event_register+0x89/0xf0
[ 1380.364317]  ? perf_tp_event_init+0xa0/0xa0
[ 1380.364889]  perf_trace_destroy+0x37/0x60
[ 1380.365446]  tp_perf_event_destroy+0x15/0x20
[ 1380.366035]  _free_event+0xfc/0x7d0
[ 1380.366560]  put_event+0x37/0x50
[ 1380.367024]  perf_event_release_kernel+0x2f4/0x370
[ 1380.367702]  ? perf_event_release_kernel+0x370/0x370
[ 1380.368379]  perf_release+0x19/0x20
[ 1380.368870]  __fput+0x12d/0x460
[ 1380.369361]  ____fput+0x1a/0x20
[ 1380.369810]  task_work_run+0x8e/0xf0
[ 1380.370344]  do_exit+0x616/0x1310
[ 1380.370834]  ? write_comp_data+0x2f/0x90
[ 1380.371410]  do_group_exit+0x7e/0x130
[ 1380.371946]  get_signal+0x249/0x13c0
[ 1380.372463]  ? get_signal+0x5/0x13c0
[ 1380.373004]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1380.373699]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1380.374402]  exit_to_user_mode_prepare+0x154/0x240
[ 1380.375065]  syscall_exit_to_user_mode+0x2b/0x60
[ 1380.375697]  do_syscall_64+0x46/0x80
[ 1380.376200]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1380.376873] RIP: 0033:0x7fac0740459d
[ 1380.377364] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1380.378205] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1380.379189] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1380.380106] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1380.381023] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1380.381942] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1380.382863] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1380.383891] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1380.384001] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1380.384838] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1380.385901] caller is debug_smp_processor_id+0x1c/0x20
[ 1380.387261] Call Trace:
[ 1380.387270]  dump_stack_lvl+0xa4/0xd3
[ 1380.387292]  dump_stack+0x15/0x17
[ 1380.387307]  check_preemption_disabled+0x167/0x180
[ 1380.387325]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1380.387339]  ? prepare_to_swait_exclusive+0x90/0x90
[ 1380.387360]  debug_smp_processor_id+0x1c/0x20
[ 1380.391432]  perf_ftrace_function_call+0x7c/0x360
[ 1380.392028]  ? trace_hardirqs_on+0x3f/0x170
[ 1380.392560]  ? preempt_count_sub+0x5/0xa0
[ 1380.393074]  ? preempt_count_sub+0x5/0xa0
[ 1380.393581]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1380.394209]  ? write_comp_data+0x2f/0x90
[ 1380.394716]  0xffffffffa0098099
[ 1380.395117]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1380.395720]  ? del_timer_sync+0xde/0x130
[ 1380.396221]  ? prepare_to_swait_event+0x5/0xf0
[ 1380.396779]  ? i915_init_ggtt+0x40/0x6b0
[ 1380.397278]  prepare_to_swait_event+0x5/0xf0
[ 1380.397816]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1380.398314]  ? prepare_to_swait_event+0x5/0xf0
[ 1380.398869]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1380.399395]  ? rcu_gp_init+0x730/0x730
[ 1380.399871]  rcu_gp_kthread+0xdd/0x170
[ 1380.400353]  kthread+0x1e7/0x230
[ 1380.400772]  ? set_kthread_struct+0x80/0x80
[ 1380.401306]  ret_from_fork+0x1f/0x30
[ 1380.401797] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1380.401818] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1380.402852] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1380.403830] caller is debug_smp_processor_id+0x1c/0x20
[ 1380.405375] Call Trace:
[ 1380.406382]  dump_stack_lvl+0xa4/0xd3
[ 1380.406983]  dump_stack+0x15/0x17
[ 1380.407503]  check_preemption_disabled+0x167/0x180
[ 1380.408219]  ? insn_get_length+0x75/0x90
[ 1380.408807]  ? insn_get_displacement+0x270/0x270
[ 1380.409518]  debug_smp_processor_id+0x1c/0x20
[ 1380.410179]  perf_ftrace_function_call+0x7c/0x360
[ 1380.410875]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1380.411578]  ? insn_decode+0x9b/0x170
[ 1380.412144]  ? perf_ftrace_function_call+0x4c/0x360
[ 1380.413149]  0xffffffffa0098099
[ 1380.413718]  ? adp5520_suspend+0x50/0x50
[ 1380.414346]  ? insn_get_length+0x41/0x90
[ 1380.414976]  ? insn_get_immediate+0x5/0x570
[ 1380.415611]  ? write_comp_data+0x2f/0x90
[ 1380.416232]  insn_get_immediate+0x5/0x570
[ 1380.416844]  insn_get_length+0x75/0x90
[ 1380.417422]  ? insn_get_immediate+0x5/0x570
[ 1380.418044]  ? insn_get_length+0x75/0x90
[ 1380.418679]  insn_decode+0x9b/0x170
[ 1380.419242]  ? adp5520_suspend+0x50/0x50
[ 1380.419842]  text_poke_loc_init+0x63/0x140
[ 1380.420616]  ? adp5520_suspend+0x50/0x50
[ 1380.421260]  text_poke_queue+0x84/0xc0
[ 1380.421882]  ftrace_replace_code+0xfd/0x170
[ 1380.422580]  ftrace_modify_all_code+0x1b1/0x270
[ 1380.423305]  arch_ftrace_update_code+0x9/0x10
[ 1380.423962]  ftrace_run_update_code+0x30/0xa0
[ 1380.424641]  ftrace_shutdown+0x2b8/0x4a0
[ 1380.425305]  unregister_ftrace_function+0x25/0x50
[ 1380.426018]  perf_ftrace_event_register+0x89/0xf0
[ 1380.426746]  ? perf_tp_event_init+0xa0/0xa0
[ 1380.427427]  perf_trace_destroy+0x37/0x60
[ 1380.428087]  tp_perf_event_destroy+0x15/0x20
[ 1380.428751]  _free_event+0xfc/0x7d0
[ 1380.429352]  put_event+0x37/0x50
[ 1380.429887]  perf_event_release_kernel+0x2f4/0x370
[ 1380.430690]  ? perf_event_release_kernel+0x370/0x370
[ 1380.431456]  perf_release+0x19/0x20
[ 1380.432016]  __fput+0x12d/0x460
[ 1380.432619]  ____fput+0x1a/0x20
[ 1380.433138]  task_work_run+0x8e/0xf0
[ 1380.433749]  do_exit+0x616/0x1310
[ 1380.434347]  ? write_comp_data+0x2f/0x90
[ 1380.435041]  do_group_exit+0x7e/0x130
[ 1380.435669]  get_signal+0x249/0x13c0
[ 1380.436269]  ? get_signal+0x5/0x13c0
[ 1380.436923]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1380.437746]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1380.438563]  exit_to_user_mode_prepare+0x154/0x240
[ 1380.439303]  syscall_exit_to_user_mode+0x2b/0x60
[ 1380.440013]  do_syscall_64+0x46/0x80
[ 1380.440581]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1380.441327] RIP: 0033:0x7fac0740459d
[ 1380.441877] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1380.442798] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1380.443883] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1380.444884] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1380.445885] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1380.446888] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1380.447889] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1380.449117] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1380.450076] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1380.451442] Call Trace:
[ 1380.451759]  dump_stack_lvl+0xa4/0xd3
[ 1380.452231]  dump_stack+0x15/0x17
[ 1380.452656]  check_preemption_disabled+0x167/0x180
[ 1380.453257]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1380.453772]  ? rcu_pm_notify+0x40/0x40
[ 1380.454254]  debug_smp_processor_id+0x1c/0x20
[ 1380.454804]  perf_ftrace_function_call+0x7c/0x360
[ 1380.455397]  ? prepare_to_swait_event+0xbb/0xf0
[ 1380.455970]  ? 0xffffffffa0098099
[ 1380.456396]  ? 0xffffffffa0098099
[ 1380.456821]  ? 0xffffffffa0098099
[ 1380.457256]  ? 0xffffffffa0098099
[ 1380.457688]  0xffffffffa0098099
[ 1380.458095]  ? trace_hardirqs_on+0x3f/0x170
[ 1380.458629]  ? preempt_count_sub+0x5/0xa0
[ 1380.459146]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1380.459694]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1380.460317]  rcu_gp_fqs_check_wake+0x5/0x50
[ 1380.460842]  rcu_gp_fqs_loop+0x2bd/0x410
[ 1380.461338]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1380.461881]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1380.462412]  ? rcu_gp_init+0x730/0x730
[ 1380.462888]  rcu_gp_kthread+0xdd/0x170
[ 1380.463374]  kthread+0x1e7/0x230
[ 1380.463792]  ? set_kthread_struct+0x80/0x80
[ 1380.464325]  ret_from_fork+0x1f/0x30
[ 1385.150063] check_preemption_disabled: 1550933 callbacks suppressed
[ 1385.150093] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1385.150148] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1385.150964] caller is debug_smp_processor_id+0x1c/0x20
[ 1385.151821] caller is debug_smp_processor_id+0x1c/0x20
[ 1385.152833] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1385.154995] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1385.156429] Call Trace:
[ 1385.156796]  dump_stack_lvl+0xa4/0xd3
[ 1385.157350]  dump_stack+0x15/0x17
[ 1385.157829]  check_preemption_disabled+0x167/0x180
[ 1385.158493]  ? text_poke_bp_batch+0x93/0x2c0
[ 1385.159077]  ? apply_paravirt+0x150/0x150
[ 1385.159658]  debug_smp_processor_id+0x1c/0x20
[ 1385.160263]  perf_ftrace_function_call+0x7c/0x360
[ 1385.160954]  ? add_policy+0x190/0x190
[ 1385.161511]  ? 0xffffffffa0098099
[ 1385.161994]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1385.162851]  0xffffffffa0098099
[ 1385.163315]  ? _raw_spin_unlock+0x2c/0x50
[ 1385.163920]  ? __text_poke+0x2f2/0x4e0
[ 1385.164499]  ? netlink_policy_dump_get_policy_idx+0xe0/0xe0
[ 1385.165256]  ? text_poke+0x5/0x60
[ 1385.165774]  text_poke+0x5/0x60
[ 1385.166241]  text_poke_bp_batch+0x93/0x2c0
[ 1385.166814]  ? text_poke+0x5/0x60
[ 1385.167280]  ? text_poke_bp_batch+0x93/0x2c0
[ 1385.167915]  ? nf_hook_entries_grow+0x2d0/0x2d0
[ 1385.168586]  text_poke_queue+0xa7/0xc0
[ 1385.169162]  ftrace_replace_code+0xfd/0x170
[ 1385.169798]  ftrace_modify_all_code+0x1b1/0x270
[ 1385.170471]  arch_ftrace_update_code+0x9/0x10
[ 1385.171076]  ftrace_run_update_code+0x30/0xa0
[ 1385.171699]  ftrace_shutdown+0x2b8/0x4a0
[ 1385.172311]  unregister_ftrace_function+0x25/0x50
[ 1385.172970]  perf_ftrace_event_register+0x89/0xf0
[ 1385.173617]  ? perf_tp_event_init+0xa0/0xa0
[ 1385.174209]  perf_trace_destroy+0x37/0x60
[ 1385.174784]  tp_perf_event_destroy+0x15/0x20
[ 1385.175388]  _free_event+0xfc/0x7d0
[ 1385.175938]  put_event+0x37/0x50
[ 1385.176430]  perf_event_release_kernel+0x2f4/0x370
[ 1385.177150]  ? perf_event_release_kernel+0x370/0x370
[ 1385.177847]  perf_release+0x19/0x20
[ 1385.178364]  __fput+0x12d/0x460
[ 1385.178915]  ____fput+0x1a/0x20
[ 1385.179385]  task_work_run+0x8e/0xf0
[ 1385.179948]  do_exit+0x616/0x1310
[ 1385.180480]  ? write_comp_data+0x2f/0x90
[ 1385.181102]  do_group_exit+0x7e/0x130
[ 1385.181675]  get_signal+0x249/0x13c0
[ 1385.182233]  ? get_signal+0x5/0x13c0
[ 1385.182833]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1385.183603]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1385.184405]  exit_to_user_mode_prepare+0x154/0x240
[ 1385.185155]  syscall_exit_to_user_mode+0x2b/0x60
[ 1385.185859]  do_syscall_64+0x46/0x80
[ 1385.186429]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1385.187173] RIP: 0033:0x7fac0740459d
[ 1385.187723] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1385.188640] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1385.189725] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1385.190731] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1385.191732] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1385.192734] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1385.193736] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1385.194969] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1385.195088] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1385.195915] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1385.196989] caller is debug_smp_processor_id+0x1c/0x20
[ 1385.198346] Call Trace:
[ 1385.198358]  dump_stack_lvl+0xa4/0xd3
[ 1385.198380]  dump_stack+0x15/0x17
[ 1385.198395]  check_preemption_disabled+0x167/0x180
[ 1385.198413]  ? schedule_timeout+0x34e/0x610
[ 1385.198429]  ? do_init_timer+0xa0/0xa0
[ 1385.198449]  debug_smp_processor_id+0x1c/0x20
[ 1385.202400]  perf_ftrace_function_call+0x7c/0x360
[ 1385.202997]  ? 0xffffffffa0098099
[ 1385.203420]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1385.204023]  ? finish_task_switch+0xab/0x2a0
[ 1385.204559]  ? __schedule+0x46e/0xb20
[ 1385.205041]  0xffffffffa0098099
[ 1385.205447]  ? finish_task_switch+0xb0/0x2a0
[ 1385.206001]  ? del_timer_sync+0x5/0x130
[ 1385.206497]  del_timer_sync+0x5/0x130
[ 1385.206965]  schedule_timeout+0x34e/0x610
[ 1385.207472]  ? del_timer_sync+0x5/0x130
[ 1385.207956]  ? schedule_timeout+0x34e/0x610
[ 1385.208491]  ? del_timer_sync+0x130/0x130
[ 1385.209003]  ? i915_init_ggtt+0x40/0x6b0
[ 1385.209512]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1385.210019]  ? rcu_gp_init+0x730/0x730
[ 1385.210497]  rcu_gp_kthread+0xdd/0x170
[ 1385.210981]  kthread+0x1e7/0x230
[ 1385.211400]  ? set_kthread_struct+0x80/0x80
[ 1385.211935]  ret_from_fork+0x1f/0x30
[ 1385.212428] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1385.212459] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1385.213478] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1385.214461] caller is debug_smp_processor_id+0x1c/0x20
[ 1385.215993] Call Trace:
[ 1385.216999]  dump_stack_lvl+0xa4/0xd3
[ 1385.217601]  dump_stack+0x15/0x17
[ 1385.218129]  check_preemption_disabled+0x167/0x180
[ 1385.218903]  debug_smp_processor_id+0x1c/0x20
[ 1385.219566]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1385.220421]  perf_trace_buf_alloc+0x3d/0x100
[ 1385.221070]  ? text_poke_bp_batch+0x93/0x2c0
[ 1385.221708]  ? apply_paravirt+0x150/0x150
[ 1385.222339]  perf_ftrace_function_call+0x209/0x360
[ 1385.223267]  ? 0xffffffffa0098099
[ 1385.223905]  0xffffffffa0098099
[ 1385.224411]  ? _raw_spin_unlock+0x2c/0x50
[ 1385.225072]  ? __text_poke+0x2f2/0x4e0
[ 1385.225707]  ? netlink_policy_dump_get_policy_idx+0xe0/0xe0
[ 1385.226534]  ? text_poke+0x5/0x60
[ 1385.227100]  text_poke+0x5/0x60
[ 1385.227602]  text_poke_bp_batch+0x93/0x2c0
[ 1385.228229]  ? text_poke+0x5/0x60
[ 1385.228740]  ? text_poke_bp_batch+0x93/0x2c0
[ 1385.229433]  ? nf_hook_entries_grow+0x2d0/0x2d0
[ 1385.230162]  text_poke_queue+0xa7/0xc0
[ 1385.230790]  ftrace_replace_code+0xfd/0x170
[ 1385.231482]  ftrace_modify_all_code+0x1b1/0x270
[ 1385.232210]  arch_ftrace_update_code+0x9/0x10
[ 1385.232870]  ftrace_run_update_code+0x30/0xa0
[ 1385.233552]  ftrace_shutdown+0x2b8/0x4a0
[ 1385.234225]  unregister_ftrace_function+0x25/0x50
[ 1385.234944]  perf_ftrace_event_register+0x89/0xf0
[ 1385.235658]  ? perf_tp_event_init+0xa0/0xa0
[ 1385.236295]  perf_trace_destroy+0x37/0x60
[ 1385.236921]  tp_perf_event_destroy+0x15/0x20
[ 1385.237582]  _free_event+0xfc/0x7d0
[ 1385.238187]  put_event+0x37/0x50
[ 1385.238721]  perf_event_release_kernel+0x2f4/0x370
[ 1385.239505]  ? perf_event_release_kernel+0x370/0x370
[ 1385.240269]  perf_release+0x19/0x20
[ 1385.240827]  __fput+0x12d/0x460
[ 1385.241427]  ____fput+0x1a/0x20
[ 1385.241941]  task_work_run+0x8e/0xf0
[ 1385.242558]  do_exit+0x616/0x1310
[ 1385.243138]  ? write_comp_data+0x2f/0x90
[ 1385.243818]  do_group_exit+0x7e/0x130
[ 1385.244445]  get_signal+0x249/0x13c0
[ 1385.245047]  ? get_signal+0x5/0x13c0
[ 1385.245702]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1385.246541]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1385.247357]  exit_to_user_mode_prepare+0x154/0x240
[ 1385.248096]  syscall_exit_to_user_mode+0x2b/0x60
[ 1385.248806]  do_syscall_64+0x46/0x80
[ 1385.249375]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1385.250124] RIP: 0033:0x7fac0740459d
[ 1385.250676] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1385.251597] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1385.252684] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1385.253681] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1385.254690] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1385.255695] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1385.256701] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1385.257935] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1385.258123] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1385.258864] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1385.259888] caller is debug_smp_processor_id+0x1c/0x20
[ 1385.261245] Call Trace:
[ 1385.261254]  dump_stack_lvl+0xa4/0xd3
[ 1385.262669]  dump_stack+0x15/0x17
[ 1385.263096]  check_preemption_disabled+0x167/0x180
[ 1385.263696]  ? del_timer_sync+0xd3/0x130
[ 1385.264191]  ? detach_if_pending+0x270/0x270
[ 1385.264731]  debug_smp_processor_id+0x1c/0x20
[ 1385.265280]  perf_ftrace_function_call+0x7c/0x360
[ 1385.265867]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1385.266465]  ? register_lock_class+0x42/0x440
[ 1385.267019]  ? del_timer_sync+0x40/0x130
[ 1385.267521]  ? 0xffffffffa0098099
[ 1385.267946]  ? 0xffffffffa0098099
[ 1385.268372]  ? 0xffffffffa0098099
[ 1385.268806]  0xffffffffa0098099
[ 1385.269208]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1385.269810]  ? del_timer_sync+0xa5/0x130
[ 1385.270314]  ? try_to_del_timer_sync+0x5/0x90
[ 1385.270864]  ? write_comp_data+0x2f/0x90
[ 1385.271363]  try_to_del_timer_sync+0x5/0x90
[ 1385.271891]  del_timer_sync+0xd3/0x130
[ 1385.272367]  ? try_to_del_timer_sync+0x5/0x90
[ 1385.272912]  ? del_timer_sync+0xd3/0x130
[ 1385.273414]  schedule_timeout+0x34e/0x610
[ 1385.273932]  ? del_timer_sync+0x130/0x130
[ 1385.274447]  ? i915_init_ggtt+0x40/0x6b0
[ 1385.274956]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1385.275462]  ? rcu_gp_init+0x730/0x730
[ 1385.275938]  rcu_gp_kthread+0xdd/0x170
[ 1385.276421]  kthread+0x1e7/0x230
[ 1385.276839]  ? set_kthread_struct+0x80/0x80
[ 1385.277373]  ret_from_fork+0x1f/0x30
[ 1385.277868] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1385.277913] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1385.278913] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1385.278931] Call Trace:
[ 1385.279905] caller is debug_smp_processor_id+0x1c/0x20
[ 1385.281345]  dump_stack_lvl+0xa4/0xd3
[ 1385.282820]  dump_stack+0x15/0x17
[ 1385.283286]  check_preemption_disabled+0x167/0x180
[ 1385.283963]  debug_smp_processor_id+0x1c/0x20
[ 1385.284558]  perf_trace_buf_alloc+0x98/0x100
[ 1385.285158]  ? text_poke_bp_batch+0x93/0x2c0
[ 1385.285736]  ? apply_paravirt+0x150/0x150
[ 1385.286303]  perf_ftrace_function_call+0x209/0x360
[ 1385.287059]  ? 0xffffffffa0098099
[ 1385.287577]  0xffffffffa0098099
[ 1385.288025]  ? _raw_spin_unlock+0x2c/0x50
[ 1385.288598]  ? __text_poke+0x2f2/0x4e0
[ 1385.289142]  ? netlink_policy_dump_get_policy_idx+0xe0/0xe0
[ 1385.289885]  ? text_poke+0x5/0x60
[ 1385.290379]  text_poke+0x5/0x60
[ 1385.290824]  text_poke_bp_batch+0x93/0x2c0
[ 1385.291385]  ? text_poke+0x5/0x60
[ 1385.291846]  ? text_poke_bp_batch+0x93/0x2c0
[ 1385.292450]  ? nf_hook_entries_grow+0x2d0/0x2d0
[ 1385.293088]  text_poke_queue+0xa7/0xc0
[ 1385.293632]  ftrace_replace_code+0xfd/0x170
[ 1385.294241]  ftrace_modify_all_code+0x1b1/0x270
[ 1385.294876]  arch_ftrace_update_code+0x9/0x10
[ 1385.295470]  ftrace_run_update_code+0x30/0xa0
[ 1385.296075]  ftrace_shutdown+0x2b8/0x4a0
[ 1385.296646]  unregister_ftrace_function+0x25/0x50
[ 1385.297288]  perf_ftrace_event_register+0x89/0xf0
[ 1385.297927]  ? perf_tp_event_init+0xa0/0xa0
[ 1385.298510]  perf_trace_destroy+0x37/0x60
[ 1385.299067]  tp_perf_event_destroy+0x15/0x20
[ 1385.299655]  _free_event+0xfc/0x7d0
[ 1385.300168]  put_event+0x37/0x50
[ 1385.300632]  perf_event_release_kernel+0x2f4/0x370
[ 1385.301309]  ? perf_event_release_kernel+0x370/0x370
[ 1385.301988]  perf_release+0x19/0x20
[ 1385.302487]  __fput+0x12d/0x460
[ 1385.302980]  ____fput+0x1a/0x20
[ 1385.303429]  task_work_run+0x8e/0xf0
[ 1385.303954]  do_exit+0x616/0x1310
[ 1385.304447]  ? write_comp_data+0x2f/0x90
[ 1385.305023]  do_group_exit+0x7e/0x130
[ 1385.305558]  get_signal+0x249/0x13c0
[ 1385.306080]  ? get_signal+0x5/0x13c0
[ 1385.306630]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1385.307324]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1385.308017]  exit_to_user_mode_prepare+0x154/0x240
[ 1385.308673]  syscall_exit_to_user_mode+0x2b/0x60
[ 1385.309311]  do_syscall_64+0x46/0x80
[ 1385.309812]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1385.310497] RIP: 0033:0x7fac0740459d
[ 1385.310990] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1385.311830] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1385.312815] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1385.313734] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1385.314660] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1385.315585] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1385.316503] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1385.317532] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1385.317642] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1385.318486] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1385.318498] Call Trace:
[ 1385.318506]  dump_stack_lvl+0xa4/0xd3
[ 1385.318528]  dump_stack+0x15/0x17
[ 1385.318543]  check_preemption_disabled+0x167/0x180
[ 1385.318561]  ? try_to_del_timer_sync+0x33/0x90
[ 1385.318577]  ? calc_wheel_index+0x2d0/0x2d0
[ 1385.319564] caller is debug_smp_processor_id+0x1c/0x20
[ 1385.320923]  debug_smp_processor_id+0x1c/0x20
[ 1385.324892]  perf_ftrace_function_call+0x7c/0x360
[ 1385.325483]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1385.326075]  ? del_timer_sync+0xd3/0x130
[ 1385.326576]  ? perf_ftrace_function_call+0x4c/0x360
[ 1385.327182]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1385.327777]  ? register_lock_class+0x42/0x440
[ 1385.328330]  ? del_timer_sync+0x40/0x130
[ 1385.328831]  ? 0xffffffffa0098099
[ 1385.329256]  ? 0xffffffffa0098099
[ 1385.329688]  0xffffffffa0098099
[ 1385.330102]  ? 0xffffffffa0098099
[ 1385.330525]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1385.331117]  ? del_timer_sync+0xa5/0x130
[ 1385.331617]  ? lock_timer_base+0x5/0x100
[ 1385.332121]  lock_timer_base+0x5/0x100
[ 1385.332598]  try_to_del_timer_sync+0x33/0x90
[ 1385.333139]  ? lock_timer_base+0x5/0x100
[ 1385.333634]  ? try_to_del_timer_sync+0x33/0x90
[ 1385.334198]  ? try_to_del_timer_sync+0x5/0x90
[ 1385.334752]  del_timer_sync+0xd3/0x130
[ 1385.335234]  schedule_timeout+0x34e/0x610
[ 1385.335750]  ? del_timer_sync+0x130/0x130
[ 1385.336263]  ? i915_init_ggtt+0x40/0x6b0
[ 1385.336771]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1385.337277]  ? rcu_gp_init+0x730/0x730
[ 1385.337753]  rcu_gp_kthread+0xdd/0x170
[ 1385.338249]  kthread+0x1e7/0x230
[ 1385.338665]  ? set_kthread_struct+0x80/0x80
[ 1385.339206]  ret_from_fork+0x1f/0x30
[ 1385.339699] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1385.339731] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1385.340673] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1385.341643] caller is debug_smp_processor_id+0x1c/0x20
[ 1385.343088] Call Trace:
[ 1385.343106]  dump_stack_lvl+0xa4/0xd3
[ 1385.344560]  dump_stack+0x15/0x17
[ 1385.345026]  check_preemption_disabled+0x167/0x180
[ 1385.345701]  debug_smp_processor_id+0x1c/0x20
[ 1385.346308]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1385.347039]  perf_tp_event+0x331/0x4e0
[ 1385.347704]  ? arch_local_irq_enable+0x10/0x12
[ 1385.348311]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1385.348957]  ? dump_stack_lvl+0xcc/0xd3
[ 1385.349500]  ? dump_stack+0x15/0x17
[ 1385.349985]  ? check_preemption_disabled+0x167/0x180
[ 1385.350689]  ? text_poke_bp_batch+0x93/0x2c0
[ 1385.351265]  ? apply_paravirt+0x150/0x150
[ 1385.351824]  perf_ftrace_function_call+0x248/0x360
[ 1385.352466]  ? perf_ftrace_function_call+0x248/0x360
[ 1385.353252]  ? 0xffffffffa0098099
[ 1385.353771]  0xffffffffa0098099
[ 1385.354222]  ? _raw_spin_unlock+0x2c/0x50
[ 1385.354794]  ? __text_poke+0x2f2/0x4e0
[ 1385.355338]  ? netlink_policy_dump_get_policy_idx+0xe0/0xe0
[ 1385.356080]  ? text_poke+0x5/0x60
[ 1385.356565]  text_poke+0x5/0x60
[ 1385.357008]  text_poke_bp_batch+0x93/0x2c0
[ 1385.357569]  ? text_poke+0x5/0x60
[ 1385.358028]  ? text_poke_bp_batch+0x93/0x2c0
[ 1385.358640]  ? nf_hook_entries_grow+0x2d0/0x2d0
[ 1385.359275]  text_poke_queue+0xa7/0xc0
[ 1385.359816]  ftrace_replace_code+0xfd/0x170
[ 1385.360412]  ftrace_modify_all_code+0x1b1/0x270
[ 1385.361048]  arch_ftrace_update_code+0x9/0x10
[ 1385.361642]  ftrace_run_update_code+0x30/0xa0
[ 1385.362252]  ftrace_shutdown+0x2b8/0x4a0
[ 1385.362823]  unregister_ftrace_function+0x25/0x50
[ 1385.363465]  perf_ftrace_event_register+0x89/0xf0
[ 1385.364102]  ? perf_tp_event_init+0xa0/0xa0
[ 1385.364673]  perf_trace_destroy+0x37/0x60
[ 1385.365231]  tp_perf_event_destroy+0x15/0x20
[ 1385.365831]  _free_event+0xfc/0x7d0
[ 1385.366355]  put_event+0x37/0x50
[ 1385.366818]  perf_event_release_kernel+0x2f4/0x370
[ 1385.367496]  ? perf_event_release_kernel+0x370/0x370
[ 1385.368173]  perf_release+0x19/0x20
[ 1385.368663]  __fput+0x12d/0x460
[ 1385.369154]  ____fput+0x1a/0x20
[ 1385.369603]  task_work_run+0x8e/0xf0
[ 1385.370136]  do_exit+0x616/0x1310
[ 1385.370627]  ? write_comp_data+0x2f/0x90
[ 1385.371203]  do_group_exit+0x7e/0x130
[ 1385.371738]  get_signal+0x249/0x13c0
[ 1385.372254]  ? get_signal+0x5/0x13c0
[ 1385.372796]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1385.373496]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1385.374197]  exit_to_user_mode_prepare+0x154/0x240
[ 1385.374854]  syscall_exit_to_user_mode+0x2b/0x60
[ 1385.375485]  do_syscall_64+0x46/0x80
[ 1385.375985]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1385.376660] RIP: 0033:0x7fac0740459d
[ 1385.377151] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1385.377991] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1385.378978] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1385.379895] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1385.380814] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1385.381733] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1385.382654] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1385.383684] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1385.383793] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20674
[ 1385.384623] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1385.385693] caller is debug_smp_processor_id+0x1c/0x20
[ 1385.387046] Call Trace:
[ 1385.387055]  dump_stack_lvl+0xa4/0xd3
[ 1385.387076]  dump_stack+0x15/0x17
[ 1385.387091]  check_preemption_disabled+0x167/0x180
[ 1385.387109]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1385.387123]  ? prepare_to_swait_exclusive+0x90/0x90
[ 1385.387144]  debug_smp_processor_id+0x1c/0x20
[ 1385.391220]  perf_ftrace_function_call+0x7c/0x360
[ 1385.391817]  ? trace_hardirqs_on+0x3f/0x170
[ 1385.392351]  ? preempt_count_sub+0x5/0xa0
[ 1385.392862]  ? preempt_count_sub+0x5/0xa0
[ 1385.393368]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1385.393990]  ? write_comp_data+0x2f/0x90
[ 1385.394499]  0xffffffffa0098099
[ 1385.394900]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1385.395501]  ? del_timer_sync+0xde/0x130
[ 1385.396003]  ? prepare_to_swait_event+0x5/0xf0
[ 1385.396561]  ? i915_init_ggtt+0x40/0x6b0
[ 1385.397060]  prepare_to_swait_event+0x5/0xf0
[ 1385.397596]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1385.398095]  ? prepare_to_swait_event+0x5/0xf0
[ 1385.398650]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1385.399175]  ? rcu_gp_init+0x730/0x730
[ 1385.399650]  rcu_gp_kthread+0xdd/0x170
[ 1385.400132]  kthread+0x1e7/0x230
[ 1385.400550]  ? set_kthread_struct+0x80/0x80
[ 1385.401084]  ret_from_fork+0x1f/0x30
[ 1385.401575] CPU: 0 PID: 20674 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1385.401604] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1385.402630] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1385.403603] caller is debug_smp_processor_id+0x1c/0x20
[ 1385.405149] Call Trace:
[ 1385.406156]  dump_stack_lvl+0xa4/0xd3
[ 1385.406758]  dump_stack+0x15/0x17
[ 1385.407279]  check_preemption_disabled+0x167/0x180
[ 1385.407997]  ? text_poke+0x2b/0x60
[ 1385.408518]  ? do_sync_core+0x30/0x30
[ 1385.409105]  debug_smp_processor_id+0x1c/0x20
[ 1385.409765]  perf_ftrace_function_call+0x7c/0x360
[ 1385.410464]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1385.411169]  ? text_poke_bp_batch+0x93/0x2c0
[ 1385.411816]  ? perf_ftrace_function_call+0x4c/0x360
[ 1385.412758]  ? netlink_policy_dump_get_policy_idx+0xe0/0xe0
[ 1385.413623]  0xffffffffa0098099
[ 1385.414184]  ? _raw_spin_unlock+0x2c/0x50
[ 1385.414862]  ? netlink_policy_dump_get_policy_idx+0xe0/0xe0
[ 1385.415679]  ? __text_poke+0x5/0x4e0
[ 1385.416235]  ? lock_is_held_type+0xe2/0x140
[ 1385.416892]  __text_poke+0x5/0x4e0
[ 1385.417425]  text_poke+0x2b/0x60
[ 1385.417936]  ? __text_poke+0x5/0x4e0
[ 1385.418483]  ? text_poke+0x2b/0x60
[ 1385.419048]  text_poke_bp_batch+0x93/0x2c0
[ 1385.419715]  ? nf_hook_entries_grow+0x2d0/0x2d0
[ 1385.420439]  text_poke_queue+0xa7/0xc0
[ 1385.421063]  ftrace_replace_code+0xfd/0x170
[ 1385.421752]  ftrace_modify_all_code+0x1b1/0x270
[ 1385.422480]  arch_ftrace_update_code+0x9/0x10
[ 1385.423140]  ftrace_run_update_code+0x30/0xa0
[ 1385.423820]  ftrace_shutdown+0x2b8/0x4a0
[ 1385.424485]  unregister_ftrace_function+0x25/0x50
[ 1385.425201]  perf_ftrace_event_register+0x89/0xf0
[ 1385.425907]  ? perf_tp_event_init+0xa0/0xa0
[ 1385.426546]  perf_trace_destroy+0x37/0x60
[ 1385.427172]  tp_perf_event_destroy+0x15/0x20
[ 1385.427831]  _free_event+0xfc/0x7d0
[ 1385.428429]  put_event+0x37/0x50
[ 1385.428961]  perf_event_release_kernel+0x2f4/0x370
[ 1385.429743]  ? perf_event_release_kernel+0x370/0x370
[ 1385.430505]  perf_release+0x19/0x20
[ 1385.431061]  __fput+0x12d/0x460
[ 1385.431657]  ____fput+0x1a/0x20
[ 1385.432168]  task_work_run+0x8e/0xf0
[ 1385.432778]  do_exit+0x616/0x1310
[ 1385.433355]  ? write_comp_data+0x2f/0x90
[ 1385.434031]  do_group_exit+0x7e/0x130
[ 1385.434659]  get_signal+0x249/0x13c0
[ 1385.435259]  ? get_signal+0x5/0x13c0
[ 1385.435912]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1385.436742]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1385.437558]  exit_to_user_mode_prepare+0x154/0x240
[ 1385.438301]  syscall_exit_to_user_mode+0x2b/0x60
[ 1385.439010]  do_syscall_64+0x46/0x80
[ 1385.439576]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1385.440321] RIP: 0033:0x7fac0740459d
[ 1385.440871] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1385.441790] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1385.442881] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1385.443883] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1385.444886] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1385.445890] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1385.446895] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1385.448125] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1385.449077] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1385.450448] Call Trace:
[ 1385.450763]  dump_stack_lvl+0xa4/0xd3
[ 1385.451234]  dump_stack+0x15/0x17
[ 1385.451658]  check_preemption_disabled+0x167/0x180
[ 1385.452257]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1385.452771]  ? rcu_pm_notify+0x40/0x40
[ 1385.453248]  debug_smp_processor_id+0x1c/0x20
[ 1385.453794]  perf_ftrace_function_call+0x7c/0x360
[ 1385.454390]  ? prepare_to_swait_event+0xbb/0xf0
[ 1385.454961]  ? 0xffffffffa0098099
[ 1385.455385]  ? 0xffffffffa0098099
[ 1385.455811]  ? 0xffffffffa0098099
[ 1385.456245]  ? 0xffffffffa0098099
[ 1385.456678]  0xffffffffa0098099
[ 1385.457081]  ? trace_hardirqs_on+0x3f/0x170
[ 1385.457612]  ? preempt_count_sub+0x5/0xa0
[ 1385.458133]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1385.458679]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1385.459300]  rcu_gp_fqs_check_wake+0x5/0x50
[ 1385.459825]  rcu_gp_fqs_loop+0x2bd/0x410
[ 1385.460322]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1385.460865]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1385.461393]  ? rcu_gp_init+0x730/0x730
[ 1385.461869]  rcu_gp_kthread+0xdd/0x170
[ 1385.462357]  kthread+0x1e7/0x230
[ 1385.462776]  ? set_kthread_struct+0x80/0x80
[ 1385.463314]  ret_from_fork+0x1f/0x30
[ 1390.154074] check_preemption_disabled: 3116828 callbacks suppressed
[ 1390.154099] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1390.154100] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1390.154876] caller is debug_smp_processor_id+0x1c/0x20
[ 1390.155854] caller is debug_smp_processor_id+0x1c/0x20
[ 1390.156700] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1390.158717] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1390.159963] Call Trace:
[ 1390.160252]  dump_stack_lvl+0xa4/0xd3
[ 1390.160681]  dump_stack+0x15/0x17
[ 1390.161067]  check_preemption_disabled+0x167/0x180
[ 1390.161611]  ? __audit_syscall_exit+0x1b2/0x400
[ 1390.162136]  ? audit_log_execve_info+0x7f0/0x7f0
[ 1390.162668]  debug_smp_processor_id+0x1c/0x20
[ 1390.163168]  perf_ftrace_function_call+0x7c/0x360
[ 1390.163703]  ? syscall_exit_to_user_mode_prepare+0x1c8/0x240
[ 1390.164337]  ? __audit_syscall_entry+0x1e0/0x1e0
[ 1390.164873]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1390.165407]  ? syscall_exit_to_user_mode_prepare+0x1c8/0x240
[ 1390.166043]  ? perf_ftrace_function_call+0x4c/0x360
[ 1390.166604]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1390.167140]  ? perf_ftrace_function_call+0x4c/0x360
[ 1390.167697]  ? put_pid+0x5/0x30
[ 1390.168068]  ? write_comp_data+0x2f/0x90
[ 1390.168541]  0xffffffffa0098099
[ 1390.168924]  ? __audit_syscall_exit+0xbb/0x400
[ 1390.169438]  ? unroll_tree_refs+0x5/0x190
[ 1390.169907]  unroll_tree_refs+0x5/0x190
[ 1390.170358]  __audit_syscall_exit+0x1b2/0x400
[ 1390.170857]  ? unroll_tree_refs+0x5/0x190
[ 1390.171319]  ? __audit_syscall_exit+0x1b2/0x400
[ 1390.171837]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1390.172461]  syscall_exit_to_user_mode_prepare+0x1c8/0x240
[ 1390.173088]  syscall_exit_to_user_mode+0xd/0x60
[ 1390.173607]  do_syscall_64+0x46/0x80
[ 1390.174023]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1390.174604] RIP: 0033:0x7fac074f09a0
[ 1390.175015] Code: b8 ff ff ff ff eb bf 0f 1f 00 f3 0f 1e fa 8b 05 d6 d7 00 00 85 c0 75 22 2e 2e 2e 2e 45 31 d2 2e 2e 2e 2e b8 3d 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 2e 2e 2e 41 54
[ 1390.177029] RSP: 002b:00007ffebadbffc8 EFLAGS: 00000246 ORIG_RAX: 000000000000003d
[ 1390.177864] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac074f09a0
[ 1390.178658] RDX: 0000000040000001 RSI: 00007ffebadbffdc RDI: 00000000ffffffff
[ 1390.179442] RBP: 00007ffebadbfff0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1390.180227] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1390.181009] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1390.181827] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1390.181876] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1390.182799] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1390.183644] caller is debug_smp_processor_id+0x1c/0x20
[ 1390.185053] Call Trace:
[ 1390.185968]  dump_stack_lvl+0xa4/0xd3
[ 1390.186531]  dump_stack+0x15/0x17
[ 1390.187010]  check_preemption_disabled+0x167/0x180
[ 1390.187678]  ? ftrace_verify_code+0x2c/0x70
[ 1390.188311]  ? copy_to_user_nofault+0x150/0x150
[ 1390.189022]  debug_smp_processor_id+0x1c/0x20
[ 1390.189690]  perf_ftrace_function_call+0x7c/0x360
[ 1390.190459]  ? irqentry_exit+0x3a/0x90
[ 1390.191032]  ? sysvec_apic_timer_interrupt+0xc8/0xd0
[ 1390.191798]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1390.192522]  ? lockdep_hardirqs_on+0x59/0x110
[ 1390.193186]  ? irqentry_exit+0x3a/0x90
[ 1390.193770]  ? trace_hardirqs_on+0x6a/0x170
[ 1390.194459]  ? irqentry_exit+0x3a/0x90
[ 1390.195110]  0xffffffffa0098099
[ 1390.195617]  ? direct_finish_page+0x60/0x60
[ 1390.196322]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1390.197114]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1390.197800]  ? squashfs_page_actor_init+0xa0/0xa0
[ 1390.198525]  ? copy_from_kernel_nofault+0x5/0x220
[ 1390.199279]  copy_from_kernel_nofault+0x5/0x220
[ 1390.199968]  ftrace_verify_code+0x2c/0x70
[ 1390.200586]  ? copy_from_kernel_nofault+0x5/0x220
[ 1390.201286]  ? ftrace_verify_code+0x2c/0x70
[ 1390.201957]  ftrace_replace_code+0x69/0x170
[ 1390.202660]  ftrace_modify_all_code+0x1b1/0x270
[ 1390.203391]  arch_ftrace_update_code+0x9/0x10
[ 1390.204055]  ftrace_run_update_code+0x30/0xa0
[ 1390.204739]  ftrace_startup_enable+0x5e/0xa0
[ 1390.205412]  ftrace_startup+0x16d/0x240
[ 1390.206085]  register_ftrace_function+0x43/0x90
[ 1390.206795]  perf_ftrace_event_register+0xc1/0xf0
[ 1390.207529]  perf_trace_event_init+0xa0/0x4c0
[ 1390.208247]  perf_trace_init+0xda/0x160
[ 1390.208886]  perf_tp_event_init+0x57/0xa0
[ 1390.209526]  perf_try_init_event+0x83/0x270
[ 1390.210239]  perf_event_alloc+0xe3f/0x1c10
[ 1390.210860]  ? _raw_spin_unlock+0x2c/0x50
[ 1390.211491]  ? alloc_fd+0x20d/0x320
[ 1390.212147]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1390.212890]  ? write_comp_data+0x2f/0x90
[ 1390.213841]  __x64_sys_perf_event_open+0x26/0x30
[ 1390.214555]  do_syscall_64+0x37/0x80
[ 1390.215128]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1390.215878] RIP: 0033:0x7fac0740459d
[ 1390.216434] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1390.218993] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1390.220087] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1390.221097] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1390.222112] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1390.223124] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1390.224130] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1390.225366] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1390.225505] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1390.226275] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1390.226285] Call Trace:
[ 1390.226293]  dump_stack_lvl+0xa4/0xd3
[ 1390.226314]  dump_stack+0x15/0x17
[ 1390.226328]  check_preemption_disabled+0x167/0x180
[ 1390.226345]  ? __audit_syscall_exit+0x28d/0x400
[ 1390.226362]  ? __slab_free+0x470/0x470
[ 1390.227447] caller is debug_smp_processor_id+0x1c/0x20
[ 1390.228809]  debug_smp_processor_id+0x1c/0x20
[ 1390.232766]  perf_ftrace_function_call+0x7c/0x360
[ 1390.233355]  ? syscall_exit_to_user_mode_prepare+0x1c8/0x240
[ 1390.234056]  ? __audit_syscall_entry+0x1e0/0x1e0
[ 1390.234642]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1390.235230]  ? syscall_exit_to_user_mode_prepare+0x1c8/0x240
[ 1390.235929]  ? perf_ftrace_function_call+0x4c/0x360
[ 1390.236542]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1390.237131]  ? perf_ftrace_function_call+0x4c/0x360
[ 1390.237749]  ? put_pid+0x5/0x30
[ 1390.238170]  ? write_comp_data+0x2f/0x90
[ 1390.238685]  0xffffffffa0098099
[ 1390.239102]  ? __audit_syscall_exit+0x276/0x400
[ 1390.239677]  ? kfree+0x5/0x5b0
[ 1390.240070]  ? write_comp_data+0x2f/0x90
[ 1390.240570]  kfree+0x5/0x5b0
[ 1390.240944]  __audit_syscall_exit+0x28d/0x400
[ 1390.241494]  ? kfree+0x5/0x5b0
[ 1390.241886]  ? __audit_syscall_exit+0x28d/0x400
[ 1390.242463]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1390.243159]  syscall_exit_to_user_mode_prepare+0x1c8/0x240
[ 1390.243846]  syscall_exit_to_user_mode+0xd/0x60
[ 1390.244417]  do_syscall_64+0x46/0x80
[ 1390.244874]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1390.245504] RIP: 0033:0x7fac074f09a0
[ 1390.245955] Code: b8 ff ff ff ff eb bf 0f 1f 00 f3 0f 1e fa 8b 05 d6 d7 00 00 85 c0 75 22 2e 2e 2e 2e 45 31 d2 2e 2e 2e 2e b8 3d 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 2e 2e 2e 41 54
[ 1390.248253] RSP: 002b:00007ffebadbffc8 EFLAGS: 00000246 ORIG_RAX: 000000000000003d
[ 1390.249175] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac074f09a0
[ 1390.250041] RDX: 0000000040000001 RSI: 00007ffebadbffdc RDI: 00000000ffffffff
[ 1390.250915] RBP: 00007ffebadbfff0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1390.251777] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1390.252640] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1390.253538] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1390.253562] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1390.254617] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1390.255547] caller is debug_smp_processor_id+0x1c/0x20
[ 1390.257128] Call Trace:
[ 1390.258144]  dump_stack_lvl+0xa4/0xd3
[ 1390.258753]  dump_stack+0x15/0x17
[ 1390.259280]  check_preemption_disabled+0x167/0x180
[ 1390.260062]  debug_smp_processor_id+0x1c/0x20
[ 1390.260731]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1390.261591]  perf_trace_buf_alloc+0x3d/0x100
[ 1390.262256]  ? ftrace_verify_code+0x2c/0x70
[ 1390.262888]  ? copy_to_user_nofault+0x150/0x150
[ 1390.263589]  perf_ftrace_function_call+0x209/0x360
[ 1390.264526]  ? 0xffffffffa0098099
[ 1390.265170]  0xffffffffa0098099
[ 1390.265680]  ? direct_finish_page+0x60/0x60
[ 1390.266393]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1390.267188]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1390.267877]  ? squashfs_page_actor_init+0xa0/0xa0
[ 1390.268601]  ? copy_from_kernel_nofault+0x5/0x220
[ 1390.269360]  copy_from_kernel_nofault+0x5/0x220
[ 1390.270055]  ftrace_verify_code+0x2c/0x70
[ 1390.270677]  ? copy_from_kernel_nofault+0x5/0x220
[ 1390.271380]  ? ftrace_verify_code+0x2c/0x70
[ 1390.272056]  ftrace_replace_code+0x69/0x170
[ 1390.272755]  ftrace_modify_all_code+0x1b1/0x270
[ 1390.273492]  arch_ftrace_update_code+0x9/0x10
[ 1390.274163]  ftrace_run_update_code+0x30/0xa0
[ 1390.274851]  ftrace_startup_enable+0x5e/0xa0
[ 1390.275528]  ftrace_startup+0x16d/0x240
[ 1390.276202]  register_ftrace_function+0x43/0x90
[ 1390.276915]  perf_ftrace_event_register+0xc1/0xf0
[ 1390.277652]  perf_trace_event_init+0xa0/0x4c0
[ 1390.278378]  perf_trace_init+0xda/0x160
[ 1390.279022]  perf_tp_event_init+0x57/0xa0
[ 1390.279665]  perf_try_init_event+0x83/0x270
[ 1390.280377]  perf_event_alloc+0xe3f/0x1c10
[ 1390.281001]  ? _raw_spin_unlock+0x2c/0x50
[ 1390.281633]  ? alloc_fd+0x20d/0x320
[ 1390.282296]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1390.283043]  ? write_comp_data+0x2f/0x90
[ 1390.284002]  __x64_sys_perf_event_open+0x26/0x30
[ 1390.284716]  do_syscall_64+0x37/0x80
[ 1390.285290]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1390.286043] RIP: 0033:0x7fac0740459d
[ 1390.286605] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1390.289168] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1390.290270] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1390.291287] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1390.292303] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1390.293319] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1390.294336] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1390.295582] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1390.295802] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1390.296475] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1390.297480] caller is debug_smp_processor_id+0x1c/0x20
[ 1390.298839] Call Trace:
[ 1390.298847]  dump_stack_lvl+0xa4/0xd3
[ 1390.298868]  dump_stack+0x15/0x17
[ 1390.298882]  check_preemption_disabled+0x167/0x180
[ 1390.298900]  ? exit_to_user_mode_prepare+0xab/0x240
[ 1390.298914]  ? __schedule+0xb20/0xb20
[ 1390.298932]  debug_smp_processor_id+0x1c/0x20
[ 1390.302933]  perf_ftrace_function_call+0x7c/0x360
[ 1390.303524]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1390.304124]  ? perf_ftrace_function_call+0x4c/0x360
[ 1390.304756]  ? 0xffffffffa0098099
[ 1390.305180]  ? 0xffffffffa0098099
[ 1390.305606]  ? 0xffffffffa0098099
[ 1390.306033]  ? __audit_syscall_exit+0x276/0x400
[ 1390.306629]  0xffffffffa0098099
[ 1390.307035]  ? 0xffffffffa0098099
[ 1390.307459]  ? rcu_read_lock_sched_held+0x4f/0x80
[ 1390.308053]  ? trace_hardirqs_on+0x3f/0x170
[ 1390.308584]  ? schedule+0x5/0xd0
[ 1390.309012]  schedule+0x5/0xd0
[ 1390.309442]  exit_to_user_mode_prepare+0xab/0x240
[ 1390.310087]  ? schedule+0x5/0xd0
[ 1390.310533]  ? exit_to_user_mode_prepare+0xab/0x240
[ 1390.311182]  syscall_exit_to_user_mode+0x2b/0x60
[ 1390.311822]  do_syscall_64+0x46/0x80
[ 1390.312313]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1390.312987] RIP: 0033:0x7fac074f09a0
[ 1390.313475] Code: b8 ff ff ff ff eb bf 0f 1f 00 f3 0f 1e fa 8b 05 d6 d7 00 00 85 c0 75 22 2e 2e 2e 2e 45 31 d2 2e 2e 2e 2e b8 3d 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 2e 2e 2e 41 54
[ 1390.315854] RSP: 002b:00007ffebadbffc8 EFLAGS: 00000246 ORIG_RAX: 000000000000003d
[ 1390.316832] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac074f09a0
[ 1390.317758] RDX: 0000000040000001 RSI: 00007ffebadbffdc RDI: 00000000ffffffff
[ 1390.318690] RBP: 00007ffebadbfff0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1390.319578] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1390.320442] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1390.321342] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1390.321384] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1390.322345] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1390.322363] Call Trace:
[ 1390.323287] caller is debug_smp_processor_id+0x1c/0x20
[ 1390.324750]  dump_stack_lvl+0xa4/0xd3
[ 1390.326245]  dump_stack+0x15/0x17
[ 1390.326715]  check_preemption_disabled+0x167/0x180
[ 1390.327397]  debug_smp_processor_id+0x1c/0x20
[ 1390.327997]  perf_trace_buf_alloc+0x98/0x100
[ 1390.328588]  ? ftrace_verify_code+0x2c/0x70
[ 1390.329160]  ? copy_to_user_nofault+0x150/0x150
[ 1390.329789]  perf_ftrace_function_call+0x209/0x360
[ 1390.330592]  ? 0xffffffffa0098099
[ 1390.331118]  0xffffffffa0098099
[ 1390.331567]  ? direct_finish_page+0x60/0x60
[ 1390.332178]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1390.332898]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1390.333521]  ? squashfs_page_actor_init+0xa0/0xa0
[ 1390.334178]  ? copy_from_kernel_nofault+0x5/0x220
[ 1390.334847]  copy_from_kernel_nofault+0x5/0x220
[ 1390.335472]  ftrace_verify_code+0x2c/0x70
[ 1390.336030]  ? copy_from_kernel_nofault+0x5/0x220
[ 1390.336670]  ? ftrace_verify_code+0x2c/0x70
[ 1390.337263]  ftrace_replace_code+0x69/0x170
[ 1390.337870]  ftrace_modify_all_code+0x1b1/0x270
[ 1390.338532]  arch_ftrace_update_code+0x9/0x10
[ 1390.339131]  ftrace_run_update_code+0x30/0xa0
[ 1390.339741]  ftrace_startup_enable+0x5e/0xa0
[ 1390.340338]  ftrace_startup+0x16d/0x240
[ 1390.340910]  register_ftrace_function+0x43/0x90
[ 1390.341544]  perf_ftrace_event_register+0xc1/0xf0
[ 1390.342239]  perf_trace_event_init+0xa0/0x4c0
[ 1390.342871]  perf_trace_init+0xda/0x160
[ 1390.343429]  perf_tp_event_init+0x57/0xa0
[ 1390.343997]  perf_try_init_event+0x83/0x270
[ 1390.344611]  perf_event_alloc+0xe3f/0x1c10
[ 1390.345175]  ? _raw_spin_unlock+0x2c/0x50
[ 1390.345736]  ? alloc_fd+0x20d/0x320
[ 1390.346287]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1390.346951]  ? write_comp_data+0x2f/0x90
[ 1390.347666]  __x64_sys_perf_event_open+0x26/0x30
[ 1390.348303]  do_syscall_64+0x37/0x80
[ 1390.348810]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1390.349494] RIP: 0033:0x7fac0740459d
[ 1390.349990] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1390.352378] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1390.353375] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1390.354316] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1390.355247] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1390.356176] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1390.357104] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1390.358153] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1390.358294] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1390.359048] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1390.360054] caller is debug_smp_processor_id+0x1c/0x20
[ 1390.361408] Call Trace:
[ 1390.362396]  dump_stack_lvl+0xa4/0xd3
[ 1390.362869]  dump_stack+0x15/0x17
[ 1390.363296]  check_preemption_disabled+0x167/0x180
[ 1390.363898]  ? schedule+0x41/0xd0
[ 1390.364322]  ? trace_sched_waking+0xc0/0xc0
[ 1390.364856]  debug_smp_processor_id+0x1c/0x20
[ 1390.365406]  perf_ftrace_function_call+0x7c/0x360
[ 1390.366008]  ? exit_to_user_mode_prepare+0xab/0x240
[ 1390.366626]  ? perf_ftrace_function_call+0x4c/0x360
[ 1390.367238]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1390.367838]  ? perf_ftrace_function_call+0x4c/0x360
[ 1390.368454]  ? 0xffffffffa0098099
[ 1390.368879]  ? 0xffffffffa0098099
[ 1390.369305]  ? 0xffffffffa0098099
[ 1390.369732]  ? __audit_syscall_exit+0x276/0x400
[ 1390.370317]  0xffffffffa0098099
[ 1390.370721]  ? 0xffffffffa0098099
[ 1390.371145]  ? 0xffffffffa0098099
[ 1390.371572]  ? trace_hardirqs_on+0x3f/0x170
[ 1390.372105]  ? preempt_count_add+0x5/0xc0
[ 1390.372617]  preempt_count_add+0x5/0xc0
[ 1390.373104]  schedule+0x41/0xd0
[ 1390.373509]  ? preempt_count_add+0x5/0xc0
[ 1390.374014]  ? schedule+0x41/0xd0
[ 1390.374443]  exit_to_user_mode_prepare+0xab/0x240
[ 1390.375035]  syscall_exit_to_user_mode+0x2b/0x60
[ 1390.375617]  do_syscall_64+0x46/0x80
[ 1390.376075]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1390.376705] RIP: 0033:0x7fac074f09a0
[ 1390.377157] Code: b8 ff ff ff ff eb bf 0f 1f 00 f3 0f 1e fa 8b 05 d6 d7 00 00 85 c0 75 22 2e 2e 2e 2e 45 31 d2 2e 2e 2e 2e b8 3d 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 2e 2e 2e 41 54
[ 1390.379386] RSP: 002b:00007ffebadbffc8 EFLAGS: 00000246 ORIG_RAX: 000000000000003d
[ 1390.380307] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac074f09a0
[ 1390.381172] RDX: 0000000040000001 RSI: 00007ffebadbffdc RDI: 00000000ffffffff
[ 1390.382035] RBP: 00007ffebadbfff0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1390.382902] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1390.383768] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1390.384662] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1390.384758] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1390.385642] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1390.386727] caller is debug_smp_processor_id+0x1c/0x20
[ 1390.388162] Call Trace:
[ 1390.389143]  dump_stack_lvl+0xa4/0xd3
[ 1390.389674]  dump_stack+0x15/0x17
[ 1390.390147]  check_preemption_disabled+0x167/0x180
[ 1390.390829]  debug_smp_processor_id+0x1c/0x20
[ 1390.391431]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1390.392174]  perf_tp_event+0x331/0x4e0
[ 1390.392858]  ? arch_local_irq_enable+0x10/0x12
[ 1390.393469]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1390.394128]  ? dump_stack_lvl+0xcc/0xd3
[ 1390.394680]  ? dump_stack+0x15/0x17
[ 1390.395172]  ? check_preemption_disabled+0x167/0x180
[ 1390.395872]  ? ftrace_verify_code+0x2c/0x70
[ 1390.396444]  ? copy_to_user_nofault+0x150/0x150
[ 1390.397077]  perf_ftrace_function_call+0x248/0x360
[ 1390.397733]  ? perf_ftrace_function_call+0x248/0x360
[ 1390.398525]  ? 0xffffffffa0098099
[ 1390.399050]  0xffffffffa0098099
[ 1390.399498]  ? direct_finish_page+0x60/0x60
[ 1390.400107]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1390.400845]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1390.401488]  ? squashfs_page_actor_init+0xa0/0xa0
[ 1390.402146]  ? copy_from_kernel_nofault+0x5/0x220
[ 1390.402815]  copy_from_kernel_nofault+0x5/0x220
[ 1390.403440]  ftrace_verify_code+0x2c/0x70
[ 1390.403995]  ? copy_from_kernel_nofault+0x5/0x220
[ 1390.404636]  ? ftrace_verify_code+0x2c/0x70
[ 1390.405231]  ftrace_replace_code+0x69/0x170
[ 1390.405833]  ftrace_modify_all_code+0x1b1/0x270
[ 1390.406478]  arch_ftrace_update_code+0x9/0x10
[ 1390.407078]  ftrace_run_update_code+0x30/0xa0
[ 1390.407688]  ftrace_startup_enable+0x5e/0xa0
[ 1390.408284]  ftrace_startup+0x16d/0x240
[ 1390.408856]  register_ftrace_function+0x43/0x90
[ 1390.409488]  perf_ftrace_event_register+0xc1/0xf0
[ 1390.410146]  perf_trace_event_init+0xa0/0x4c0
[ 1390.410774]  perf_trace_init+0xda/0x160
[ 1390.411332]  perf_tp_event_init+0x57/0xa0
[ 1390.411901]  perf_try_init_event+0x83/0x270
[ 1390.412513]  perf_event_alloc+0xe3f/0x1c10
[ 1390.413076]  ? _raw_spin_unlock+0x2c/0x50
[ 1390.413637]  ? alloc_fd+0x20d/0x320
[ 1390.414183]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1390.414849]  ? write_comp_data+0x2f/0x90
[ 1390.415563]  __x64_sys_perf_event_open+0x26/0x30
[ 1390.416203]  do_syscall_64+0x37/0x80
[ 1390.416710]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1390.417393] RIP: 0033:0x7fac0740459d
[ 1390.417890] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1390.420279] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1390.421279] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1390.422221] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1390.423154] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1390.424088] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1390.425023] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1390.426075] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1390.426231] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1390.427099] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1390.428188] caller is debug_smp_processor_id+0x1c/0x20
[ 1390.429565] Call Trace:
[ 1390.429575]  dump_stack_lvl+0xa4/0xd3
[ 1390.431075]  dump_stack+0x15/0x17
[ 1390.431508]  check_preemption_disabled+0x167/0x180
[ 1390.432118]  ? do_epoll_wait+0x3b3/0xd80
[ 1390.432626]  ? __mutex_lock+0x9f0/0x9f0
[ 1390.433123]  debug_smp_processor_id+0x1c/0x20
[ 1390.433682]  perf_ftrace_function_call+0x7c/0x360
[ 1390.434294]  ? 0xffffffffa0098099
[ 1390.434722]  ? trace_hardirqs_on+0x6a/0x170
[ 1390.435264]  ? finish_task_switch+0xb0/0x2a0
[ 1390.435810]  ? finish_task_switch+0x70/0x2a0
[ 1390.436359]  ? trace_hardirqs_on+0x3f/0x170
[ 1390.436894]  ? finish_task_switch+0x70/0x2a0
[ 1390.437452]  ? preempt_count_sub+0x5/0xa0
[ 1390.437979]  0xffffffffa0098099
[ 1390.438393]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1390.438994]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1390.439683]  ? do_epoll_wait+0x36b/0xd80
[ 1390.440195]  ? mutex_lock_nested+0x5/0x20
[ 1390.440711]  ? write_comp_data+0x2f/0x90
[ 1390.441218]  mutex_lock_nested+0x5/0x20
[ 1390.441713]  do_epoll_wait+0x3b3/0xd80
[ 1390.442202]  ? mutex_lock_nested+0x5/0x20
[ 1390.442716]  ? do_epoll_wait+0x3b3/0xd80
[ 1390.443249]  ? wait_woken+0x90/0x90
[ 1390.443716]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1390.444265]  do_syscall_64+0x37/0x80
[ 1390.444728]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1390.445367] RIP: 0033:0x7f8a39143b20
[ 1390.445828] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1390.448093] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1390.449031] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1390.449911] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1390.450791] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1390.451670] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1390.452548] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1390.453464] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1390.454551] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1390.456144] Call Trace:
[ 1390.456549]  dump_stack_lvl+0xa4/0xd3
[ 1390.457158]  dump_stack+0x15/0x17
[ 1390.457686]  check_preemption_disabled+0x167/0x180
[ 1390.458421]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1390.459139]  ? cea_set_pte+0x140/0x140
[ 1390.459747]  debug_smp_processor_id+0x1c/0x20
[ 1390.460416]  perf_ftrace_function_call+0x7c/0x360
[ 1390.461120]  ? copy_to_user_nofault+0x150/0x150
[ 1390.461834]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1390.462553]  ? ftrace_verify_code+0x2c/0x70
[ 1390.463198]  ? perf_ftrace_function_call+0x4c/0x360
[ 1390.464142]  ? squashfs_page_actor_init+0xa0/0xa0
[ 1390.464869]  0xffffffffa0098099
[ 1390.465466]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1390.466271]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1390.466971]  ? squashfs_page_actor_init+0xa0/0xa0
[ 1390.467684]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1390.468481]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1390.469275]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1390.469964]  copy_from_kernel_nofault_allowed+0x5/0x80
[ 1390.470744]  copy_from_kernel_nofault+0x2f/0x220
[ 1390.471449]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1390.472234]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1390.473036]  ftrace_verify_code+0x2c/0x70
[ 1390.473690]  ftrace_replace_code+0x69/0x170
[ 1390.474392]  ftrace_modify_all_code+0x1b1/0x270
[ 1390.475125]  arch_ftrace_update_code+0x9/0x10
[ 1390.475793]  ftrace_run_update_code+0x30/0xa0
[ 1390.476481]  ftrace_startup_enable+0x5e/0xa0
[ 1390.477158]  ftrace_startup+0x16d/0x240
[ 1390.477830]  register_ftrace_function+0x43/0x90
[ 1390.478548]  perf_ftrace_event_register+0xc1/0xf0
[ 1390.479287]  perf_trace_event_init+0xa0/0x4c0
[ 1390.480011]  perf_trace_init+0xda/0x160
[ 1390.480654]  perf_tp_event_init+0x57/0xa0
[ 1390.481297]  perf_try_init_event+0x83/0x270
[ 1390.482007]  perf_event_alloc+0xe3f/0x1c10
[ 1390.482636]  ? _raw_spin_unlock+0x2c/0x50
[ 1390.483269]  ? alloc_fd+0x20d/0x320
[ 1390.483941]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1390.484689]  ? write_comp_data+0x2f/0x90
[ 1390.485641]  __x64_sys_perf_event_open+0x26/0x30
[ 1390.486359]  do_syscall_64+0x37/0x80
[ 1390.486933]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1390.487684] RIP: 0033:0x7fac0740459d
[ 1390.488240] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1390.490806] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1390.491901] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1390.492916] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1390.493929] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1390.494975] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1390.495993] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1395.158118] check_preemption_disabled: 1567469 callbacks suppressed
[ 1395.158142] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1395.159953] caller is debug_smp_processor_id+0x1c/0x20
[ 1395.160637] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1395.161584] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1395.163017] Call Trace:
[ 1395.163383]  dump_stack_lvl+0xa4/0xd3
[ 1395.163936]  dump_stack+0x15/0x17
[ 1395.164410]  check_preemption_disabled+0x167/0x180
[ 1395.165117]  debug_smp_processor_id+0x1c/0x20
[ 1395.165716]  perf_trace_buf_alloc+0x98/0x100
[ 1395.166336]  ? __get_locked_pte+0x1a2/0x290
[ 1395.166931]  ? __lock_text_start+0x8/0x8
[ 1395.167520]  perf_ftrace_function_call+0x209/0x360
[ 1395.168433]  ? 0xffffffffa0098099
[ 1395.169060]  0xffffffffa0098099
[ 1395.169567]  ? vmstat_next+0x30/0x30
[ 1395.170129]  ? 0xffffffffa0098099
[ 1395.170657]  ? pmd_page_vaddr+0x2b/0x70
[ 1395.171264]  ? _raw_spin_lock+0x5/0x50
[ 1395.171880]  _raw_spin_lock+0x5/0x50
[ 1395.172413]  __get_locked_pte+0x1a2/0x290
[ 1395.172993]  ? _raw_spin_lock+0x5/0x50
[ 1395.173507]  ? __get_locked_pte+0x1a2/0x290
[ 1395.174119]  ? vmstat_next+0x30/0x30
[ 1395.174647]  __text_poke+0xea/0x4e0
[ 1395.175150]  ? vmstat_next+0x30/0x30
[ 1395.175676]  ? lock_is_held_type+0xe2/0x140
[ 1395.176272]  ? vmstat_next+0x30/0x30
[ 1395.176822]  text_poke+0x2b/0x60
[ 1395.177319]  text_poke_bp_batch+0x1dc/0x2c0
[ 1395.177940]  ? kmem_cache_size+0x10/0x10
[ 1395.178543]  text_poke_queue+0xa7/0xc0
[ 1395.179116]  ftrace_replace_code+0xfd/0x170
[ 1395.179750]  ftrace_modify_all_code+0x1b1/0x270
[ 1395.180414]  arch_ftrace_update_code+0x9/0x10
[ 1395.181011]  ftrace_run_update_code+0x30/0xa0
[ 1395.181631]  ftrace_startup_enable+0x5e/0xa0
[ 1395.182254]  ftrace_startup+0x16d/0x240
[ 1395.182980]  register_ftrace_function+0x43/0x90
[ 1395.183652]  perf_ftrace_event_register+0xc1/0xf0
[ 1395.184351]  perf_trace_event_init+0xa0/0x4c0
[ 1395.185042]  perf_trace_init+0xda/0x160
[ 1395.185656]  perf_tp_event_init+0x57/0xa0
[ 1395.186281]  perf_try_init_event+0x83/0x270
[ 1395.186962]  perf_event_alloc+0xe3f/0x1c10
[ 1395.187548]  ? _raw_spin_unlock+0x2c/0x50
[ 1395.188145]  ? alloc_fd+0x20d/0x320
[ 1395.188783]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1395.189490]  ? write_comp_data+0x2f/0x90
[ 1395.190458]  __x64_sys_perf_event_open+0x26/0x30
[ 1395.191132]  do_syscall_64+0x37/0x80
[ 1395.191674]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1395.192380] RIP: 0033:0x7fac0740459d
[ 1395.192906] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1395.195306] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1395.196336] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1395.197286] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1395.198245] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1395.199195] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1395.200144] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1395.201623] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1395.201642] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1395.202816] caller is debug_smp_processor_id+0x1c/0x20
[ 1395.202854] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1395.202883] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1395.203936] caller is debug_smp_processor_id+0x1c/0x20
[ 1395.204616] Call Trace:
[ 1395.208041]  dump_stack_lvl+0xa4/0xd3
[ 1395.208630]  dump_stack+0x15/0x17
[ 1395.209129]  check_preemption_disabled+0x167/0x180
[ 1395.209876]  debug_smp_processor_id+0x1c/0x20
[ 1395.210517]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1395.211302]  perf_tp_event+0x331/0x4e0
[ 1395.212190]  ? arch_local_irq_enable+0x10/0x12
[ 1395.212842]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1395.213540]  ? dump_stack_lvl+0xcc/0xd3
[ 1395.214149]  ? dump_stack+0x15/0x17
[ 1395.214670]  ? check_preemption_disabled+0x167/0x180
[ 1395.215438]  ? __get_locked_pte+0x1a2/0x290
[ 1395.216034]  ? __lock_text_start+0x8/0x8
[ 1395.216640]  perf_ftrace_function_call+0x248/0x360
[ 1395.217315]  ? perf_ftrace_function_call+0x248/0x360
[ 1395.218278]  ? 0xffffffffa0098099
[ 1395.218906]  0xffffffffa0098099
[ 1395.219414]  ? vmstat_next+0x30/0x30
[ 1395.219972]  ? 0xffffffffa0098099
[ 1395.220500]  ? pmd_page_vaddr+0x2b/0x70
[ 1395.221100]  ? _raw_spin_lock+0x5/0x50
[ 1395.221703]  _raw_spin_lock+0x5/0x50
[ 1395.222240]  __get_locked_pte+0x1a2/0x290
[ 1395.222829]  ? _raw_spin_lock+0x5/0x50
[ 1395.223372]  ? __get_locked_pte+0x1a2/0x290
[ 1395.224001]  ? vmstat_next+0x30/0x30
[ 1395.224547]  __text_poke+0xea/0x4e0
[ 1395.225071]  ? vmstat_next+0x30/0x30
[ 1395.225628]  ? lock_is_held_type+0xe2/0x140
[ 1395.226264]  ? vmstat_next+0x30/0x30
[ 1395.226843]  text_poke+0x2b/0x60
[ 1395.227368]  text_poke_bp_batch+0x1dc/0x2c0
[ 1395.228027]  ? kmem_cache_size+0x10/0x10
[ 1395.228655]  text_poke_queue+0xa7/0xc0
[ 1395.229261]  ftrace_replace_code+0xfd/0x170
[ 1395.229931]  ftrace_modify_all_code+0x1b1/0x270
[ 1395.230642]  arch_ftrace_update_code+0x9/0x10
[ 1395.231274]  ftrace_run_update_code+0x30/0xa0
[ 1395.231928]  ftrace_startup_enable+0x5e/0xa0
[ 1395.232571]  ftrace_startup+0x16d/0x240
[ 1395.233221]  register_ftrace_function+0x43/0x90
[ 1395.233898]  perf_ftrace_event_register+0xc1/0xf0
[ 1395.234605]  perf_trace_event_init+0xa0/0x4c0
[ 1395.235300]  perf_trace_init+0xda/0x160
[ 1395.235916]  perf_tp_event_init+0x57/0xa0
[ 1395.236527]  perf_try_init_event+0x83/0x270
[ 1395.237213]  perf_event_alloc+0xe3f/0x1c10
[ 1395.237809]  ? _raw_spin_unlock+0x2c/0x50
[ 1395.238418]  ? alloc_fd+0x20d/0x320
[ 1395.239059]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1395.239769]  ? write_comp_data+0x2f/0x90
[ 1395.240730]  __x64_sys_perf_event_open+0x26/0x30
[ 1395.241404]  do_syscall_64+0x37/0x80
[ 1395.241949]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1395.242664] RIP: 0033:0x7fac0740459d
[ 1395.243191] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1395.245584] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1395.246618] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1395.247567] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1395.248514] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1395.249466] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1395.250421] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1395.251630] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1395.251818] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1395.252656] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1395.253752] caller is debug_smp_processor_id+0x1c/0x20
[ 1395.255144] Call Trace:
[ 1395.255174]  dump_stack_lvl+0xa4/0xd3
[ 1395.255241]  dump_stack+0x15/0x17
[ 1395.255277]  check_preemption_disabled+0x167/0x180
[ 1395.255317]  ? do_epoll_wait+0x3b3/0xd80
[ 1395.258343]  ? __mutex_lock+0x9f0/0x9f0
[ 1395.258888]  debug_smp_processor_id+0x1c/0x20
[ 1395.259477]  perf_ftrace_function_call+0x7c/0x360
[ 1395.260164]  ? ftrace_call+0x5/0x44
[ 1395.260639]  ? trace_hardirqs_on+0x6a/0x170
[ 1395.261244]  ? finish_task_switch+0xb0/0x2a0
[ 1395.261814]  ? finish_task_switch+0x70/0x2a0
[ 1395.262413]  ? trace_hardirqs_on+0x3f/0x170
[ 1395.262973]  ? finish_task_switch+0x70/0x2a0
[ 1395.263569]  ? preempt_count_sub+0x5/0xa0
[ 1395.264173]  0xffffffffa0098099
[ 1395.264622]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1395.265270]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1395.266018]  ? do_epoll_wait+0x36b/0xd80
[ 1395.266589]  ? mutex_lock_nested+0x5/0x20
[ 1395.267136]  ? write_comp_data+0x2f/0x90
[ 1395.267690]  mutex_lock_nested+0x5/0x20
[ 1395.268217]  do_epoll_wait+0x3b3/0xd80
[ 1395.268735]  ? mutex_lock_nested+0x5/0x20
[ 1395.269273]  ? do_epoll_wait+0x3b3/0xd80
[ 1395.269969]  ? wait_woken+0x90/0x90
[ 1395.270533]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1395.271169]  do_syscall_64+0x37/0x80
[ 1395.271673]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1395.272337] RIP: 0033:0x7f8a39143b20
[ 1395.272828] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1395.275099] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1395.276066] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1395.276962] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1395.277857] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1395.278757] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1395.279654] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1395.280748] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1395.280858] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1395.281825] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1395.282944] caller is debug_smp_processor_id+0x1c/0x20
[ 1395.284447] Call Trace:
[ 1395.285495]  dump_stack_lvl+0xa4/0xd3
[ 1395.286159]  dump_stack+0x15/0x17
[ 1395.286718]  check_preemption_disabled+0x167/0x180
[ 1395.287480]  ? __text_poke+0xea/0x4e0
[ 1395.288064]  ? __pmd_alloc+0x420/0x420
[ 1395.288713]  debug_smp_processor_id+0x1c/0x20
[ 1395.289411]  perf_ftrace_function_call+0x7c/0x360
[ 1395.290167]  ? text_poke+0x2b/0x60
[ 1395.290736]  ? perf_ftrace_function_call+0x4c/0x360
[ 1395.291837]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1395.292598]  ? sum_vm_events+0xa0/0xa0
[ 1395.293251]  0xffffffffa0098099
[ 1395.293833]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1395.294579]  ? do_sync_core+0x30/0x30
[ 1395.295323]  ? __get_locked_pte+0x5/0x290
[ 1395.296042]  __get_locked_pte+0x5/0x290
[ 1395.296669]  __text_poke+0xea/0x4e0
[ 1395.297250]  ? __get_locked_pte+0x5/0x290
[ 1395.297881]  ? __text_poke+0xea/0x4e0
[ 1395.298493]  ? sum_vm_events+0xa0/0xa0
[ 1395.299143]  ? lock_is_held_type+0xe2/0x140
[ 1395.299835]  ? sum_vm_events+0xa0/0xa0
[ 1395.300521]  text_poke+0x2b/0x60
[ 1395.301121]  text_poke_bp_batch+0x1dc/0x2c0
[ 1395.301865]  ? kmem_cache_size+0x10/0x10
[ 1395.302598]  text_poke_queue+0xa7/0xc0
[ 1395.303293]  ftrace_replace_code+0xfd/0x170
[ 1395.304056]  ftrace_modify_all_code+0x1b1/0x270
[ 1395.304848]  arch_ftrace_update_code+0x9/0x10
[ 1395.305545]  ftrace_run_update_code+0x30/0xa0
[ 1395.306288]  ftrace_startup_enable+0x5e/0xa0
[ 1395.307010]  ftrace_startup+0x16d/0x240
[ 1395.307762]  register_ftrace_function+0x43/0x90
[ 1395.308524]  perf_ftrace_event_register+0xc1/0xf0
[ 1395.309304]  perf_trace_event_init+0xa0/0x4c0
[ 1395.310096]  perf_trace_init+0xda/0x160
[ 1395.310797]  perf_tp_event_init+0x57/0xa0
[ 1395.311482]  perf_try_init_event+0x83/0x270
[ 1395.312261]  perf_event_alloc+0xe3f/0x1c10
[ 1395.312905]  ? _raw_spin_unlock+0x2c/0x50
[ 1395.313573]  ? alloc_fd+0x20d/0x320
[ 1395.314339]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1395.315131]  ? write_comp_data+0x2f/0x90
[ 1395.316336]  __x64_sys_perf_event_open+0x26/0x30
[ 1395.317091]  do_syscall_64+0x37/0x80
[ 1395.317710]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1395.318493] RIP: 0033:0x7fac0740459d
[ 1395.319078] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1395.321656] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1395.322841] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1395.323935] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1395.325029] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1395.326131] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1395.327224] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1395.328712] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1395.328894] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1395.329796] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1395.331121] caller is debug_smp_processor_id+0x1c/0x20
[ 1395.332422] Call Trace:
[ 1395.333514]  dump_stack_lvl+0xa4/0xd3
[ 1395.334048]  dump_stack+0x15/0x17
[ 1395.334523]  check_preemption_disabled+0x167/0x180
[ 1395.335165]  ? mutex_lock_nested+0x1b/0x20
[ 1395.335712]  ? mutex_lock_io_nested+0x940/0x940
[ 1395.336340]  debug_smp_processor_id+0x1c/0x20
[ 1395.336930]  perf_ftrace_function_call+0x7c/0x360
[ 1395.337561]  ? perf_ftrace_function_call+0x4c/0x360
[ 1395.338271]  ? ftrace_call+0x5/0x44
[ 1395.338747]  ? trace_hardirqs_on+0x6a/0x170
[ 1395.339363]  ? finish_task_switch+0xb0/0x2a0
[ 1395.339930]  ? finish_task_switch+0x70/0x2a0
[ 1395.340526]  ? trace_hardirqs_on+0x3f/0x170
[ 1395.341087]  ? finish_task_switch+0x70/0x2a0
[ 1395.341741]  0xffffffffa0098099
[ 1395.342195]  ? 0xffffffffa0098099
[ 1395.342662]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1395.343309]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1395.344021]  ? do_epoll_wait+0x3b3/0xd80
[ 1395.344605]  ? __mutex_lock+0x5/0x9f0
[ 1395.345109]  ? mutex_lock_nested+0x5/0x20
[ 1395.345655]  ? write_comp_data+0x2f/0x90
[ 1395.346193]  __mutex_lock+0x5/0x9f0
[ 1395.346677]  mutex_lock_nested+0x1b/0x20
[ 1395.347215]  ? __mutex_lock+0x5/0x9f0
[ 1395.347711]  ? mutex_lock_nested+0x1b/0x20
[ 1395.348267]  do_epoll_wait+0x3b3/0xd80
[ 1395.348942]  ? wait_woken+0x90/0x90
[ 1395.349501]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1395.350137]  do_syscall_64+0x37/0x80
[ 1395.350645]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1395.351307] RIP: 0033:0x7f8a39143b20
[ 1395.351798] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1395.354073] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1395.355043] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1395.355941] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1395.356838] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1395.357740] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1395.358684] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1395.359784] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1395.359900] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1395.360869] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1395.361907] caller is debug_smp_processor_id+0x1c/0x20
[ 1395.363484] Call Trace:
[ 1395.363537]  dump_stack_lvl+0xa4/0xd3
[ 1395.365191]  dump_stack+0x15/0x17
[ 1395.365749]  check_preemption_disabled+0x167/0x180
[ 1395.366598]  debug_smp_processor_id+0x1c/0x20
[ 1395.367298]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1395.368223]  perf_trace_buf_alloc+0x3d/0x100
[ 1395.368912]  ? __text_poke+0xea/0x4e0
[ 1395.369498]  ? __pmd_alloc+0x420/0x420
[ 1395.370132]  perf_ftrace_function_call+0x209/0x360
[ 1395.371228]  ? 0xffffffffa0098099
[ 1395.371902]  ? sum_vm_events+0xa0/0xa0
[ 1395.372554]  0xffffffffa0098099
[ 1395.373136]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1395.373872]  ? do_sync_core+0x30/0x30
[ 1395.374620]  ? __get_locked_pte+0x5/0x290
[ 1395.375342]  __get_locked_pte+0x5/0x290
[ 1395.375972]  __text_poke+0xea/0x4e0
[ 1395.376554]  ? __get_locked_pte+0x5/0x290
[ 1395.377187]  ? __text_poke+0xea/0x4e0
[ 1395.377789]  ? sum_vm_events+0xa0/0xa0
[ 1395.378441]  ? lock_is_held_type+0xe2/0x140
[ 1395.379133]  ? sum_vm_events+0xa0/0xa0
[ 1395.379817]  text_poke+0x2b/0x60
[ 1395.380416]  text_poke_bp_batch+0x1dc/0x2c0
[ 1395.381160]  ? kmem_cache_size+0x10/0x10
[ 1395.381871]  text_poke_queue+0xa7/0xc0
[ 1395.382562]  ftrace_replace_code+0xfd/0x170
[ 1395.383323]  ftrace_modify_all_code+0x1b1/0x270
[ 1395.384113]  arch_ftrace_update_code+0x9/0x10
[ 1395.384809]  ftrace_run_update_code+0x30/0xa0
[ 1395.385541]  ftrace_startup_enable+0x5e/0xa0
[ 1395.386264]  ftrace_startup+0x16d/0x240
[ 1395.387017]  register_ftrace_function+0x43/0x90
[ 1395.387774]  perf_ftrace_event_register+0xc1/0xf0
[ 1395.388556]  perf_trace_event_init+0xa0/0x4c0
[ 1395.389343]  perf_trace_init+0xda/0x160
[ 1395.390042]  perf_tp_event_init+0x57/0xa0
[ 1395.390732]  perf_try_init_event+0x83/0x270
[ 1395.391515]  perf_event_alloc+0xe3f/0x1c10
[ 1395.392162]  ? _raw_spin_unlock+0x2c/0x50
[ 1395.392832]  ? alloc_fd+0x20d/0x320
[ 1395.393588]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1395.394384]  ? write_comp_data+0x2f/0x90
[ 1395.395587]  __x64_sys_perf_event_open+0x26/0x30
[ 1395.396338]  do_syscall_64+0x37/0x80
[ 1395.396949]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1395.397726] RIP: 0033:0x7fac0740459d
[ 1395.398315] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1395.400895] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1395.402024] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1395.403064] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1395.404099] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1395.405134] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1395.406171] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1395.407575] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1395.407744] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1395.408599] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1395.409610] caller is debug_smp_processor_id+0x1c/0x20
[ 1395.410996] Call Trace:
[ 1395.411025]  dump_stack_lvl+0xa4/0xd3
[ 1395.411092]  dump_stack+0x15/0x17
[ 1395.411128]  check_preemption_disabled+0x167/0x180
[ 1395.411168]  ? do_epoll_wait+0x3bf/0xd80
[ 1395.414126]  ? __ia32_sys_fanotify_init+0x5c0/0x5c0
[ 1395.414794]  debug_smp_processor_id+0x1c/0x20
[ 1395.415384]  perf_ftrace_function_call+0x7c/0x360
[ 1395.416060]  ? ftrace_call+0x5/0x44
[ 1395.416620]  ? do_epoll_wait+0x3b3/0xd80
[ 1395.417202]  ? preempt_count_sub+0x5/0xa0
[ 1395.417815]  0xffffffffa0098099
[ 1395.418267]  ? __mutex_lock+0xfe/0x9f0
[ 1395.418802]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1395.419531]  ? do_epoll_wait+0x3b3/0xd80
[ 1395.420116]  ? ep_start_scan+0x5/0x100
[ 1395.420669]  ep_start_scan+0x5/0x100
[ 1395.421165]  do_epoll_wait+0x3bf/0xd80
[ 1395.421683]  ? ep_start_scan+0x5/0x100
[ 1395.422193]  ? do_epoll_wait+0x3bf/0xd80
[ 1395.422886]  ? wait_woken+0x90/0x90
[ 1395.423444]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1395.424077]  do_syscall_64+0x37/0x80
[ 1395.424580]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1395.425255] RIP: 0033:0x7f8a39143b20
[ 1395.425741] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1395.428008] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1395.428973] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1395.429868] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1395.430766] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1395.431661] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1395.432557] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1395.433649] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1395.433760] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1395.434647] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1395.434674] Call Trace:
[ 1395.434709]  dump_stack_lvl+0xa4/0xd3
[ 1395.435751] caller is debug_smp_processor_id+0x1c/0x20
[ 1395.437260]  dump_stack+0x15/0x17
[ 1395.439177]  check_preemption_disabled+0x167/0x180
[ 1395.439925]  debug_smp_processor_id+0x1c/0x20
[ 1395.440559]  perf_trace_buf_alloc+0x98/0x100
[ 1395.441180]  ? __text_poke+0xea/0x4e0
[ 1395.441711]  ? __pmd_alloc+0x420/0x420
[ 1395.442280]  perf_ftrace_function_call+0x209/0x360
[ 1395.443196]  ? 0xffffffffa0098099
[ 1395.443772]  ? sum_vm_events+0xa0/0xa0
[ 1395.444353]  0xffffffffa0098099
[ 1395.444859]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1395.445527]  ? do_sync_core+0x30/0x30
[ 1395.446170]  ? __get_locked_pte+0x5/0x290
[ 1395.446803]  __get_locked_pte+0x5/0x290
[ 1395.447368]  __text_poke+0xea/0x4e0
[ 1395.447889]  ? __get_locked_pte+0x5/0x290
[ 1395.448462]  ? __text_poke+0xea/0x4e0
[ 1395.449004]  ? sum_vm_events+0xa0/0xa0
[ 1395.449579]  ? lock_is_held_type+0xe2/0x140
[ 1395.450203]  ? sum_vm_events+0xa0/0xa0
[ 1395.450804]  text_poke+0x2b/0x60
[ 1395.451330]  text_poke_bp_batch+0x1dc/0x2c0
[ 1395.451987]  ? kmem_cache_size+0x10/0x10
[ 1395.452613]  text_poke_queue+0xa7/0xc0
[ 1395.453218]  ftrace_replace_code+0xfd/0x170
[ 1395.453886]  ftrace_modify_all_code+0x1b1/0x270
[ 1395.454589]  arch_ftrace_update_code+0x9/0x10
[ 1395.455221]  ftrace_run_update_code+0x30/0xa0
[ 1395.455876]  ftrace_startup_enable+0x5e/0xa0
[ 1395.456519]  ftrace_startup+0x16d/0x240
[ 1395.457169]  register_ftrace_function+0x43/0x90
[ 1395.457846]  perf_ftrace_event_register+0xc1/0xf0
[ 1395.458551]  perf_trace_event_init+0xa0/0x4c0
[ 1395.459243]  perf_trace_init+0xda/0x160
[ 1395.459858]  perf_tp_event_init+0x57/0xa0
[ 1395.460470]  perf_try_init_event+0x83/0x270
[ 1395.461152]  perf_event_alloc+0xe3f/0x1c10
[ 1395.461741]  ? _raw_spin_unlock+0x2c/0x50
[ 1395.462344]  ? alloc_fd+0x20d/0x320
[ 1395.462983]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1395.463690]  ? write_comp_data+0x2f/0x90
[ 1395.464648]  __x64_sys_perf_event_open+0x26/0x30
[ 1395.465324]  do_syscall_64+0x37/0x80
[ 1395.465869]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1395.466581] RIP: 0033:0x7fac0740459d
[ 1395.467109] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1395.469514] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1395.470549] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1395.471502] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1395.472453] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1395.473407] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1395.474360] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1395.475565] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1395.475732] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1395.476592] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1395.477605] caller is debug_smp_processor_id+0x1c/0x20
[ 1395.478994] Call Trace:
[ 1395.479022]  dump_stack_lvl+0xa4/0xd3
[ 1395.479088]  dump_stack+0x15/0x17
[ 1395.479125]  check_preemption_disabled+0x167/0x180
[ 1395.479164]  ? ep_start_scan+0x68/0x100
[ 1395.482119]  ? _raw_read_lock_irq+0xa0/0xa0
[ 1395.482707]  debug_smp_processor_id+0x1c/0x20
[ 1395.483295]  perf_ftrace_function_call+0x7c/0x360
[ 1395.483927]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1395.484557]  ? do_epoll_wait+0x3bf/0xd80
[ 1395.485105]  ? perf_ftrace_function_call+0x4c/0x360
[ 1395.485816]  ? ftrace_call+0x5/0x44
[ 1395.486402]  ? do_epoll_wait+0x3b3/0xd80
[ 1395.487019]  0xffffffffa0098099
[ 1395.487507]  ? 0xffffffffa0098099
[ 1395.487976]  ? __mutex_lock+0xfe/0x9f0
[ 1395.488492]  ? do_epoll_wait+0x3b3/0xd80
[ 1395.489030]  ? ep_start_scan+0xe0/0x100
[ 1395.489584]  ? _raw_write_lock_irq+0x5/0x60
[ 1395.490155]  ? write_comp_data+0x2f/0x90
[ 1395.490710]  _raw_write_lock_irq+0x5/0x60
[ 1395.491260]  ep_start_scan+0x68/0x100
[ 1395.491766]  ? _raw_write_lock_irq+0x5/0x60
[ 1395.492325]  ? ep_start_scan+0x68/0x100
[ 1395.492891]  do_epoll_wait+0x3bf/0xd80
[ 1395.493568]  ? wait_woken+0x90/0x90
[ 1395.494131]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1395.494768]  do_syscall_64+0x37/0x80
[ 1395.495280]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1395.495943] RIP: 0033:0x7f8a39143b20
[ 1395.496435] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1395.498708] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1395.499674] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1395.500570] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1395.501467] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1395.502366] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1395.503262] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1395.504355] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1395.505356] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1395.506868] Call Trace:
[ 1395.507252]  dump_stack_lvl+0xa4/0xd3
[ 1395.507835]  dump_stack+0x15/0x17
[ 1395.508335]  check_preemption_disabled+0x167/0x180
[ 1395.509084]  debug_smp_processor_id+0x1c/0x20
[ 1395.509717]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1395.510511]  perf_tp_event+0x331/0x4e0
[ 1395.511401]  ? arch_local_irq_enable+0x10/0x12
[ 1395.512052]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1395.512749]  ? dump_stack_lvl+0xcc/0xd3
[ 1395.513350]  ? dump_stack+0x15/0x17
[ 1395.513870]  ? check_preemption_disabled+0x167/0x180
[ 1395.514646]  ? __text_poke+0xea/0x4e0
[ 1395.515181]  ? __pmd_alloc+0x420/0x420
[ 1395.515759]  perf_ftrace_function_call+0x248/0x360
[ 1395.516434]  ? perf_ftrace_function_call+0x248/0x360
[ 1395.517403]  ? 0xffffffffa0098099
[ 1395.517980]  ? sum_vm_events+0xa0/0xa0
[ 1395.518569]  0xffffffffa0098099
[ 1395.519079]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1395.519744]  ? do_sync_core+0x30/0x30
[ 1395.520382]  ? __get_locked_pte+0x5/0x290
[ 1395.521017]  __get_locked_pte+0x5/0x290
[ 1395.521580]  __text_poke+0xea/0x4e0
[ 1395.522110]  ? __get_locked_pte+0x5/0x290
[ 1395.522685]  ? __text_poke+0xea/0x4e0
[ 1395.523228]  ? sum_vm_events+0xa0/0xa0
[ 1395.523805]  ? lock_is_held_type+0xe2/0x140
[ 1395.524426]  ? sum_vm_events+0xa0/0xa0
[ 1395.525027]  text_poke+0x2b/0x60
[ 1395.525552]  text_poke_bp_batch+0x1dc/0x2c0
[ 1395.526218]  ? kmem_cache_size+0x10/0x10
[ 1395.526851]  text_poke_queue+0xa7/0xc0
[ 1395.527470]  ftrace_replace_code+0xfd/0x170
[ 1395.528140]  ftrace_modify_all_code+0x1b1/0x270
[ 1395.528841]  arch_ftrace_update_code+0x9/0x10
[ 1395.529471]  ftrace_run_update_code+0x30/0xa0
[ 1395.530141]  ftrace_startup_enable+0x5e/0xa0
[ 1395.530818]  ftrace_startup+0x16d/0x240
[ 1395.531475]  register_ftrace_function+0x43/0x90
[ 1395.532154]  perf_ftrace_event_register+0xc1/0xf0
[ 1395.532856]  perf_trace_event_init+0xa0/0x4c0
[ 1395.533559]  perf_trace_init+0xda/0x160
[ 1395.534186]  perf_tp_event_init+0x57/0xa0
[ 1395.534801]  perf_try_init_event+0x83/0x270
[ 1395.535489]  perf_event_alloc+0xe3f/0x1c10
[ 1395.536079]  ? _raw_spin_unlock+0x2c/0x50
[ 1395.536680]  ? alloc_fd+0x20d/0x320
[ 1395.537321]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1395.538031]  ? write_comp_data+0x2f/0x90
[ 1395.539009]  __x64_sys_perf_event_open+0x26/0x30
[ 1395.539690]  do_syscall_64+0x37/0x80
[ 1395.540236]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1395.540952] RIP: 0033:0x7fac0740459d
[ 1395.541480] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1395.543907] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1395.544939] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1395.545889] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1395.546860] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1395.547813] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1395.548767] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1400.162124] check_preemption_disabled: 876934 callbacks suppressed
[ 1400.162160] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1400.162266] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1400.163033] caller is debug_smp_processor_id+0x1c/0x20
[ 1400.163905] caller is debug_smp_processor_id+0x1c/0x20
[ 1400.164926] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1400.167162] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1400.168659] Call Trace:
[ 1400.169056]  dump_stack_lvl+0xa4/0xd3
[ 1400.169656]  dump_stack+0x15/0x17
[ 1400.170175]  check_preemption_disabled+0x167/0x180
[ 1400.170863]  ? __get_locked_pte+0x1a2/0x290
[ 1400.171455]  ? __lock_text_start+0x8/0x8
[ 1400.172075]  debug_smp_processor_id+0x1c/0x20
[ 1400.172706]  perf_ftrace_function_call+0x7c/0x360
[ 1400.173647]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1400.174321]  ? write_comp_data+0x2f/0x90
[ 1400.174916]  ? perf_trace_buf_update+0x70/0x70
[ 1400.175676]  0xffffffffa0098099
[ 1400.176205]  ? sens_index+0xa0/0xa0
[ 1400.176767]  ? ftrace_call+0x5/0x44
[ 1400.177328]  ? pmd_page_vaddr+0x2b/0x70
[ 1400.177958]  ? _raw_spin_lock+0x5/0x50
[ 1400.178694]  _raw_spin_lock+0x5/0x50
[ 1400.179261]  __get_locked_pte+0x1a2/0x290
[ 1400.179848]  ? _raw_spin_lock+0x5/0x50
[ 1400.180390]  ? __get_locked_pte+0x1a2/0x290
[ 1400.181032]  ? sens_index+0xa0/0xa0
[ 1400.181597]  __text_poke+0xea/0x4e0
[ 1400.182133]  ? sens_index+0xa0/0xa0
[ 1400.182693]  ? lock_is_held_type+0xe2/0x140
[ 1400.183320]  ? sens_index+0xa0/0xa0
[ 1400.183914]  text_poke+0x2b/0x60
[ 1400.184463]  text_poke_bp_batch+0x93/0x2c0
[ 1400.185129]  ? mls_range_isvalid+0xb0/0xb0
[ 1400.185810]  text_poke_queue+0xa7/0xc0
[ 1400.186450]  ftrace_replace_code+0xfd/0x170
[ 1400.187142]  ftrace_modify_all_code+0x1b1/0x270
[ 1400.187859]  arch_ftrace_update_code+0x9/0x10
[ 1400.188489]  ftrace_run_update_code+0x30/0xa0
[ 1400.189152]  ftrace_startup_enable+0x5e/0xa0
[ 1400.189806]  ftrace_startup+0x16d/0x240
[ 1400.190501]  register_ftrace_function+0x43/0x90
[ 1400.191185]  perf_ftrace_event_register+0xc1/0xf0
[ 1400.191893]  perf_trace_event_init+0xa0/0x4c0
[ 1400.192609]  perf_trace_init+0xda/0x160
[ 1400.193246]  perf_tp_event_init+0x57/0xa0
[ 1400.193874]  perf_try_init_event+0x83/0x270
[ 1400.194597]  perf_event_alloc+0xe3f/0x1c10
[ 1400.195181]  ? _raw_spin_unlock+0x2c/0x50
[ 1400.195820]  ? alloc_fd+0x20d/0x320
[ 1400.196580]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1400.197370]  ? write_comp_data+0x2f/0x90
[ 1400.198578]  __x64_sys_perf_event_open+0x26/0x30
[ 1400.199327]  do_syscall_64+0x37/0x80
[ 1400.199935]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1400.200709] RIP: 0033:0x7fac0740459d
[ 1400.201297] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1400.203881] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1400.205007] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1400.206039] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1400.207081] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1400.208112] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1400.209144] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1400.210569] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1400.210760] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1400.211536] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1400.212628] caller is debug_smp_processor_id+0x1c/0x20
[ 1400.213993] Call Trace:
[ 1400.214023]  dump_stack_lvl+0xa4/0xd3
[ 1400.214096]  dump_stack+0x15/0x17
[ 1400.214134]  check_preemption_disabled+0x167/0x180
[ 1400.214174]  ? lock_timer_base+0x34/0x100
[ 1400.217182]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1400.217805]  debug_smp_processor_id+0x1c/0x20
[ 1400.218397]  perf_ftrace_function_call+0x7c/0x360
[ 1400.219041]  ? ftrace_ops_test+0x71/0xc0
[ 1400.219608]  ? ftrace_ops_test+0x71/0xc0
[ 1400.220147]  ? perf_trace_buf_update+0x70/0x70
[ 1400.220740]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1400.221382]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1400.221983]  ? write_comp_data+0x2f/0x90
[ 1400.222555]  ? perf_trace_buf_update+0x70/0x70
[ 1400.223213]  0xffffffffa0098099
[ 1400.223712]  ? ftrace_call+0x5/0x44
[ 1400.224209]  ? lock_timer_base+0xc0/0x100
[ 1400.224776]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1400.225367]  ? write_comp_data+0x2f/0x90
[ 1400.225915]  _raw_spin_lock_irqsave+0x5/0x70
[ 1400.226492]  lock_timer_base+0x34/0x100
[ 1400.227013]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1400.227597]  ? lock_timer_base+0x34/0x100
[ 1400.228194]  try_to_del_timer_sync+0x33/0x90
[ 1400.228757]  ? try_to_del_timer_sync+0x5/0x90
[ 1400.229368]  del_timer_sync+0xd3/0x130
[ 1400.229906]  schedule_timeout+0x34e/0x610
[ 1400.230505]  ? del_timer_sync+0x130/0x130
[ 1400.231083]  ? i915_init_ggtt+0x40/0x6b0
[ 1400.231679]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1400.232274]  ? rcu_gp_init+0x730/0x730
[ 1400.232784]  rcu_gp_kthread+0xdd/0x170
[ 1400.233340]  kthread+0x1e7/0x230
[ 1400.233801]  ? set_kthread_struct+0x80/0x80
[ 1400.234401]  ret_from_fork+0x1f/0x30
[ 1400.235081] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1400.235197] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1400.236164] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1400.237136] caller is debug_smp_processor_id+0x1c/0x20
[ 1400.238726] Call Trace:
[ 1400.238779]  dump_stack_lvl+0xa4/0xd3
[ 1400.240424]  dump_stack+0x15/0x17
[ 1400.240982]  check_preemption_disabled+0x167/0x180
[ 1400.241827]  debug_smp_processor_id+0x1c/0x20
[ 1400.242532]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1400.243460]  perf_trace_buf_alloc+0x3d/0x100
[ 1400.244148]  ? __get_locked_pte+0x1a2/0x290
[ 1400.244804]  ? __lock_text_start+0x8/0x8
[ 1400.245461]  perf_ftrace_function_call+0x209/0x360
[ 1400.246561]  ? 0xffffffffa0098099
[ 1400.247308]  0xffffffffa0098099
[ 1400.247890]  ? sens_index+0xa0/0xa0
[ 1400.248507]  ? ftrace_call+0x5/0x44
[ 1400.249123]  ? pmd_page_vaddr+0x2b/0x70
[ 1400.249801]  ? _raw_spin_lock+0x5/0x50
[ 1400.250491]  _raw_spin_lock+0x5/0x50
[ 1400.251086]  __get_locked_pte+0x1a2/0x290
[ 1400.251736]  ? _raw_spin_lock+0x5/0x50
[ 1400.252334]  ? __get_locked_pte+0x1a2/0x290
[ 1400.253043]  ? sens_index+0xa0/0xa0
[ 1400.253660]  __text_poke+0xea/0x4e0
[ 1400.254251]  ? sens_index+0xa0/0xa0
[ 1400.254868]  ? lock_is_held_type+0xe2/0x140
[ 1400.255559]  ? sens_index+0xa0/0xa0
[ 1400.256212]  text_poke+0x2b/0x60
[ 1400.256812]  text_poke_bp_batch+0x93/0x2c0
[ 1400.257545]  ? mls_range_isvalid+0xb0/0xb0
[ 1400.258281]  text_poke_queue+0xa7/0xc0
[ 1400.258969]  ftrace_replace_code+0xfd/0x170
[ 1400.259755]  ftrace_modify_all_code+0x1b1/0x270
[ 1400.260573]  arch_ftrace_update_code+0x9/0x10
[ 1400.261285]  ftrace_run_update_code+0x30/0xa0
[ 1400.262047]  ftrace_startup_enable+0x5e/0xa0
[ 1400.262800]  ftrace_startup+0x16d/0x240
[ 1400.263564]  register_ftrace_function+0x43/0x90
[ 1400.264335]  perf_ftrace_event_register+0xc1/0xf0
[ 1400.265144]  perf_trace_event_init+0xa0/0x4c0
[ 1400.265941]  perf_trace_init+0xda/0x160
[ 1400.266673]  perf_tp_event_init+0x57/0xa0
[ 1400.267368]  perf_try_init_event+0x83/0x270
[ 1400.268162]  perf_event_alloc+0xe3f/0x1c10
[ 1400.268817]  ? _raw_spin_unlock+0x2c/0x50
[ 1400.269505]  ? alloc_fd+0x20d/0x320
[ 1400.270273]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1400.271066]  ? write_comp_data+0x2f/0x90
[ 1400.272271]  __x64_sys_perf_event_open+0x26/0x30
[ 1400.273023]  do_syscall_64+0x37/0x80
[ 1400.273635]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1400.274418] RIP: 0033:0x7fac0740459d
[ 1400.275007] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1400.277585] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1400.278721] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1400.279753] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1400.280787] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1400.281824] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1400.282863] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1400.284273] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1400.284459] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1400.285254] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1400.286424] caller is debug_smp_processor_id+0x1c/0x20
[ 1400.287641] Call Trace:
[ 1400.288653]  dump_stack_lvl+0xa4/0xd3
[ 1400.289181]  dump_stack+0x15/0x17
[ 1400.289641]  check_preemption_disabled+0x167/0x180
[ 1400.290279]  ? prepare_to_swait_event+0x1b/0xf0
[ 1400.290874]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1400.291497]  debug_smp_processor_id+0x1c/0x20
[ 1400.292079]  perf_ftrace_function_call+0x7c/0x360
[ 1400.292693]  ? ftrace_ops_test+0x71/0xc0
[ 1400.293306]  ? trace_hardirqs_on+0x3f/0x170
[ 1400.293902]  ? write_comp_data+0x2f/0x90
[ 1400.294444]  ? perf_trace_buf_update+0x70/0x70
[ 1400.295036]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1400.295732]  0xffffffffa0098099
[ 1400.296212]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1400.296870]  ? del_timer_sync+0xde/0x130
[ 1400.297428]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1400.298061]  _raw_spin_lock_irqsave+0x5/0x70
[ 1400.298635]  prepare_to_swait_event+0x1b/0xf0
[ 1400.299218]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1400.299799]  ? prepare_to_swait_event+0x1b/0xf0
[ 1400.300427]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1400.301022]  ? rcu_gp_init+0x730/0x730
[ 1400.301530]  rcu_gp_kthread+0xdd/0x170
[ 1400.302089]  kthread+0x1e7/0x230
[ 1400.302550]  ? set_kthread_struct+0x80/0x80
[ 1400.303149]  ret_from_fork+0x1f/0x30
[ 1400.303827] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1400.303959] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1400.304826] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1400.305800] caller is debug_smp_processor_id+0x1c/0x20
[ 1400.307266] Call Trace:
[ 1400.307305]  dump_stack_lvl+0xa4/0xd3
[ 1400.307388]  dump_stack+0x15/0x17
[ 1400.309270]  check_preemption_disabled+0x167/0x180
[ 1400.310018]  debug_smp_processor_id+0x1c/0x20
[ 1400.310655]  perf_trace_buf_alloc+0x98/0x100
[ 1400.311274]  ? __get_locked_pte+0x1a2/0x290
[ 1400.311868]  ? __lock_text_start+0x8/0x8
[ 1400.312455]  perf_ftrace_function_call+0x209/0x360
[ 1400.313371]  ? 0xffffffffa0098099
[ 1400.313996]  0xffffffffa0098099
[ 1400.314547]  ? sens_index+0xa0/0xa0
[ 1400.315094]  ? ftrace_call+0x5/0x44
[ 1400.315640]  ? pmd_page_vaddr+0x2b/0x70
[ 1400.316240]  ? _raw_spin_lock+0x5/0x50
[ 1400.316843]  _raw_spin_lock+0x5/0x50
[ 1400.317376]  __get_locked_pte+0x1a2/0x290
[ 1400.317962]  ? _raw_spin_lock+0x5/0x50
[ 1400.318514]  ? __get_locked_pte+0x1a2/0x290
[ 1400.319144]  ? sens_index+0xa0/0xa0
[ 1400.319689]  __text_poke+0xea/0x4e0
[ 1400.320212]  ? sens_index+0xa0/0xa0
[ 1400.320758]  ? lock_is_held_type+0xe2/0x140
[ 1400.321377]  ? sens_index+0xa0/0xa0
[ 1400.321946]  text_poke+0x2b/0x60
[ 1400.322482]  text_poke_bp_batch+0x93/0x2c0
[ 1400.323128]  ? mls_range_isvalid+0xb0/0xb0
[ 1400.323771]  text_poke_queue+0xa7/0xc0
[ 1400.324373]  ftrace_replace_code+0xfd/0x170
[ 1400.325040]  ftrace_modify_all_code+0x1b1/0x270
[ 1400.325740]  arch_ftrace_update_code+0x9/0x10
[ 1400.326380]  ftrace_run_update_code+0x30/0xa0
[ 1400.327031]  ftrace_startup_enable+0x5e/0xa0
[ 1400.327673]  ftrace_startup+0x16d/0x240
[ 1400.328322]  register_ftrace_function+0x43/0x90
[ 1400.329003]  perf_ftrace_event_register+0xc1/0xf0
[ 1400.329701]  perf_trace_event_init+0xa0/0x4c0
[ 1400.330400]  perf_trace_init+0xda/0x160
[ 1400.331014]  perf_tp_event_init+0x57/0xa0
[ 1400.331626]  perf_try_init_event+0x83/0x270
[ 1400.332308]  perf_event_alloc+0xe3f/0x1c10
[ 1400.332895]  ? _raw_spin_unlock+0x2c/0x50
[ 1400.333493]  ? alloc_fd+0x20d/0x320
[ 1400.334140]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1400.334847]  ? write_comp_data+0x2f/0x90
[ 1400.335811]  __x64_sys_perf_event_open+0x26/0x30
[ 1400.336484]  do_syscall_64+0x37/0x80
[ 1400.337028]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1400.337732] RIP: 0033:0x7fac0740459d
[ 1400.338265] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1400.340659] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1400.341690] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1400.342651] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1400.343602] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1400.344553] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1400.345502] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1400.346712] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1400.346883] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1400.347674] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1400.348686] caller is debug_smp_processor_id+0x1c/0x20
[ 1400.350053] Call Trace:
[ 1400.350082]  dump_stack_lvl+0xa4/0xd3
[ 1400.350147]  dump_stack+0x15/0x17
[ 1400.350184]  check_preemption_disabled+0x167/0x180
[ 1400.350223]  ? finish_swait+0x41/0x80
[ 1400.353123]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1400.353743]  debug_smp_processor_id+0x1c/0x20
[ 1400.354327]  perf_ftrace_function_call+0x7c/0x360
[ 1400.354940]  ? ftrace_ops_test+0x71/0xc0
[ 1400.355476]  ? rcu_advance_cbs+0x70/0x70
[ 1400.356031]  ? write_comp_data+0x2f/0x90
[ 1400.356568]  ? perf_trace_buf_update+0x70/0x70
[ 1400.357158]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1400.357796]  ? write_comp_data+0x2f/0x90
[ 1400.358337]  ? perf_trace_buf_update+0x70/0x70
[ 1400.358928]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1400.359624]  0xffffffffa0098099
[ 1400.360122]  ? trace_hardirqs_on+0x3f/0x170
[ 1400.360745]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1400.361374]  _raw_spin_lock_irqsave+0x5/0x70
[ 1400.361947]  finish_swait+0x41/0x80
[ 1400.362429]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1400.363011]  ? finish_swait+0x41/0x80
[ 1400.363538]  rcu_gp_fqs_loop+0x2da/0x410
[ 1400.364131]  ? rcu_gp_init+0x730/0x730
[ 1400.364639]  rcu_gp_kthread+0xdd/0x170
[ 1400.365193]  kthread+0x1e7/0x230
[ 1400.365652]  ? set_kthread_struct+0x80/0x80
[ 1400.366254]  ret_from_fork+0x1f/0x30
[ 1400.366930] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1400.367047] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1400.367925] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1400.368896] caller is debug_smp_processor_id+0x1c/0x20
[ 1400.370362] Call Trace:
[ 1400.370399]  dump_stack_lvl+0xa4/0xd3
[ 1400.370482]  dump_stack+0x15/0x17
[ 1400.372361]  check_preemption_disabled+0x167/0x180
[ 1400.373108]  debug_smp_processor_id+0x1c/0x20
[ 1400.373739]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1400.374528]  perf_tp_event+0x331/0x4e0
[ 1400.375419]  ? arch_local_irq_enable+0x10/0x12
[ 1400.376071]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1400.376769]  ? dump_stack_lvl+0xcc/0xd3
[ 1400.377370]  ? dump_stack+0x15/0x17
[ 1400.377891]  ? check_preemption_disabled+0x167/0x180
[ 1400.378661]  ? __get_locked_pte+0x1a2/0x290
[ 1400.379256]  ? __lock_text_start+0x8/0x8
[ 1400.379857]  perf_ftrace_function_call+0x248/0x360
[ 1400.380531]  ? perf_ftrace_function_call+0x248/0x360
[ 1400.381492]  ? 0xffffffffa0098099
[ 1400.382123]  0xffffffffa0098099
[ 1400.382632]  ? sens_index+0xa0/0xa0
[ 1400.383178]  ? ftrace_call+0x5/0x44
[ 1400.383723]  ? pmd_page_vaddr+0x2b/0x70
[ 1400.384322]  ? _raw_spin_lock+0x5/0x50
[ 1400.384925]  _raw_spin_lock+0x5/0x50
[ 1400.385460]  __get_locked_pte+0x1a2/0x290
[ 1400.386047]  ? _raw_spin_lock+0x5/0x50
[ 1400.386594]  ? __get_locked_pte+0x1a2/0x290
[ 1400.387224]  ? sens_index+0xa0/0xa0
[ 1400.387771]  __text_poke+0xea/0x4e0
[ 1400.388293]  ? sens_index+0xa0/0xa0
[ 1400.388838]  ? lock_is_held_type+0xe2/0x140
[ 1400.389458]  ? sens_index+0xa0/0xa0
[ 1400.390030]  text_poke+0x2b/0x60
[ 1400.390560]  text_poke_bp_batch+0x93/0x2c0
[ 1400.391209]  ? mls_range_isvalid+0xb0/0xb0
[ 1400.391854]  text_poke_queue+0xa7/0xc0
[ 1400.392458]  ftrace_replace_code+0xfd/0x170
[ 1400.393124]  ftrace_modify_all_code+0x1b1/0x270
[ 1400.393822]  arch_ftrace_update_code+0x9/0x10
[ 1400.394456]  ftrace_run_update_code+0x30/0xa0
[ 1400.395109]  ftrace_startup_enable+0x5e/0xa0
[ 1400.395750]  ftrace_startup+0x16d/0x240
[ 1400.396400]  register_ftrace_function+0x43/0x90
[ 1400.397077]  perf_ftrace_event_register+0xc1/0xf0
[ 1400.397775]  perf_trace_event_init+0xa0/0x4c0
[ 1400.398476]  perf_trace_init+0xda/0x160
[ 1400.399090]  perf_tp_event_init+0x57/0xa0
[ 1400.399701]  perf_try_init_event+0x83/0x270
[ 1400.400382]  perf_event_alloc+0xe3f/0x1c10
[ 1400.400970]  ? _raw_spin_unlock+0x2c/0x50
[ 1400.401570]  ? alloc_fd+0x20d/0x320
[ 1400.402213]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1400.402920]  ? write_comp_data+0x2f/0x90
[ 1400.403879]  __x64_sys_perf_event_open+0x26/0x30
[ 1400.404553]  do_syscall_64+0x37/0x80
[ 1400.405098]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1400.405805] RIP: 0033:0x7fac0740459d
[ 1400.406336] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1400.408727] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1400.409755] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1400.410704] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1400.411652] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1400.412601] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1400.413547] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1400.414753] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1400.414958] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1400.415714] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1400.416816] caller is debug_smp_processor_id+0x1c/0x20
[ 1400.418177] Call Trace:
[ 1400.418206]  dump_stack_lvl+0xa4/0xd3
[ 1400.418271]  dump_stack+0x15/0x17
[ 1400.418307]  check_preemption_disabled+0x167/0x180
[ 1400.418346]  ? force_qs_rnp+0xd0/0x2c0
[ 1400.421317]  ? preempt_schedule+0x30/0x30
[ 1400.421875]  debug_smp_processor_id+0x1c/0x20
[ 1400.422461]  perf_ftrace_function_call+0x7c/0x360
[ 1400.423073]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1400.423710]  ? ftrace_ops_test+0x71/0xc0
[ 1400.424246]  ? rcu_advance_cbs+0x70/0x70
[ 1400.424798]  ? write_comp_data+0x2f/0x90
[ 1400.425335]  ? perf_trace_buf_update+0x70/0x70
[ 1400.425924]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1400.426565]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1400.427154]  ? force_qs_rnp+0xcb/0x2c0
[ 1400.427661]  ? sched_show_task+0x70/0x70
[ 1400.428216]  ? rcu_gp_torture_wait+0x20/0x20
[ 1400.428797]  0xffffffffa0098099
[ 1400.429229]  ? rcu_exp_wait_wake+0x4c0/0x4c0
[ 1400.429925]  ? __cond_resched+0x5/0x30
[ 1400.430454]  ? ___might_sleep+0x143/0x170
[ 1400.430992]  __cond_resched+0x5/0x30
[ 1400.431480]  force_qs_rnp+0xd0/0x2c0
[ 1400.431968]  ? __cond_resched+0x5/0x30
[ 1400.432465]  ? force_qs_rnp+0xd0/0x2c0
[ 1400.433039]  rcu_gp_fqs_loop+0x2eb/0x410
[ 1400.433630]  ? rcu_gp_init+0x730/0x730
[ 1400.434146]  rcu_gp_kthread+0xdd/0x170
[ 1400.434700]  kthread+0x1e7/0x230
[ 1400.435159]  ? set_kthread_struct+0x80/0x80
[ 1400.435756]  ret_from_fork+0x1f/0x30
[ 1400.436432] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1400.436580] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1400.437512] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1400.438657] caller is debug_smp_processor_id+0x1c/0x20
[ 1400.440165] Call Trace:
[ 1400.441224]  dump_stack_lvl+0xa4/0xd3
[ 1400.441882]  dump_stack+0x15/0x17
[ 1400.442453]  check_preemption_disabled+0x167/0x180
[ 1400.443212]  ? __get_locked_pte+0x1a2/0x290
[ 1400.443867]  ? __lock_text_start+0x8/0x8
[ 1400.444543]  debug_smp_processor_id+0x1c/0x20
[ 1400.445245]  perf_ftrace_function_call+0x7c/0x360
[ 1400.446282]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1400.447023]  ? write_comp_data+0x2f/0x90
[ 1400.447680]  ? perf_trace_buf_update+0x70/0x70
[ 1400.448516]  0xffffffffa0098099
[ 1400.449098]  ? cat_index+0xa0/0xa0
[ 1400.449703]  ? ftrace_call+0x5/0x44
[ 1400.450334]  ? pmd_page_vaddr+0x2b/0x70
[ 1400.451013]  ? _raw_spin_lock+0x5/0x50
[ 1400.451702]  _raw_spin_lock+0x5/0x50
[ 1400.452298]  __get_locked_pte+0x1a2/0x290
[ 1400.452951]  ? _raw_spin_lock+0x5/0x50
[ 1400.453551]  ? __get_locked_pte+0x1a2/0x290
[ 1400.454267]  ? cat_index+0xa0/0xa0
[ 1400.454875]  __text_poke+0xea/0x4e0
[ 1400.455458]  ? cat_index+0xa0/0xa0
[ 1400.456064]  ? lock_is_held_type+0xe2/0x140
[ 1400.456757]  ? cat_index+0xa0/0xa0
[ 1400.457406]  text_poke+0x2b/0x60
[ 1400.458006]  text_poke_bp_batch+0x93/0x2c0
[ 1400.458746]  ? mls_range_isvalid+0xb0/0xb0
[ 1400.459477]  text_poke_queue+0xa7/0xc0
[ 1400.460166]  ftrace_replace_code+0xfd/0x170
[ 1400.460929]  ftrace_modify_all_code+0x1b1/0x270
[ 1400.461721]  arch_ftrace_update_code+0x9/0x10
[ 1400.462563]  ftrace_run_update_code+0x30/0xa0
[ 1400.463343]  ftrace_startup_enable+0x5e/0xa0
[ 1400.464070]  ftrace_startup+0x16d/0x240
[ 1400.464824]  register_ftrace_function+0x43/0x90
[ 1400.465584]  perf_ftrace_event_register+0xc1/0xf0
[ 1400.466373]  perf_trace_event_init+0xa0/0x4c0
[ 1400.467165]  perf_trace_init+0xda/0x160
[ 1400.467868]  perf_tp_event_init+0x57/0xa0
[ 1400.468557]  perf_try_init_event+0x83/0x270
[ 1400.469342]  perf_event_alloc+0xe3f/0x1c10
[ 1400.469992]  ? _raw_spin_unlock+0x2c/0x50
[ 1400.470665]  ? alloc_fd+0x20d/0x320
[ 1400.471422]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1400.472215]  ? write_comp_data+0x2f/0x90
[ 1400.473419]  __x64_sys_perf_event_open+0x26/0x30
[ 1400.474175]  do_syscall_64+0x37/0x80
[ 1400.474788]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1400.475563] RIP: 0033:0x7fac0740459d
[ 1400.476152] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1400.478743] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1400.479878] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1400.480922] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1400.481988] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1400.483034] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1400.484075] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1400.485488] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1400.486550] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1400.487975] Call Trace:
[ 1400.488332]  dump_stack_lvl+0xa4/0xd3
[ 1400.488869]  dump_stack+0x15/0x17
[ 1400.489338]  check_preemption_disabled+0x167/0x180
[ 1400.489985]  ? do_epoll_wait+0x3b3/0xd80
[ 1400.490524]  ? __mutex_lock+0x9f0/0x9f0
[ 1400.491076]  debug_smp_processor_id+0x1c/0x20
[ 1400.491671]  perf_ftrace_function_call+0x7c/0x360
[ 1400.492362]  ? ftrace_call+0x5/0x44
[ 1400.492842]  ? trace_hardirqs_on+0x6a/0x170
[ 1400.493450]  ? finish_task_switch+0xb0/0x2a0
[ 1400.494022]  ? finish_task_switch+0x70/0x2a0
[ 1400.494636]  ? trace_hardirqs_on+0x3f/0x170
[ 1400.495199]  ? finish_task_switch+0x70/0x2a0
[ 1400.495797]  ? preempt_count_sub+0x5/0xa0
[ 1400.496403]  0xffffffffa0098099
[ 1400.496853]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1400.497504]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1400.498260]  ? do_epoll_wait+0x36b/0xd80
[ 1400.498830]  ? mutex_lock_nested+0x5/0x20
[ 1400.499379]  ? write_comp_data+0x2f/0x90
[ 1400.499937]  mutex_lock_nested+0x5/0x20
[ 1400.500466]  do_epoll_wait+0x3b3/0xd80
[ 1400.500987]  ? mutex_lock_nested+0x5/0x20
[ 1400.501526]  ? do_epoll_wait+0x3b3/0xd80
[ 1400.502230]  ? wait_woken+0x90/0x90
[ 1400.502793]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1400.503433]  do_syscall_64+0x37/0x80
[ 1400.503941]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1400.504610] RIP: 0033:0x7f8a39143b20
[ 1400.505105] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1400.507393] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1400.508369] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1400.509272] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1400.510177] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1400.511078] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1400.511979] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1405.166115] check_preemption_disabled: 634542 callbacks suppressed
[ 1405.166141] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1405.166258] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1405.167032] caller is debug_smp_processor_id+0x1c/0x20
[ 1405.167989] caller is debug_smp_processor_id+0x1c/0x20
[ 1405.169023] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1405.171279] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1405.172735] Call Trace:
[ 1405.173112]  dump_stack_lvl+0xa4/0xd3
[ 1405.173684]  dump_stack+0x15/0x17
[ 1405.174184]  check_preemption_disabled+0x167/0x180
[ 1405.174911]  debug_smp_processor_id+0x1c/0x20
[ 1405.175527]  perf_trace_buf_alloc+0x98/0x100
[ 1405.176134]  ? __get_locked_pte+0x1a2/0x290
[ 1405.176715]  ? __lock_text_start+0x8/0x8
[ 1405.177290]  perf_ftrace_function_call+0x209/0x360
[ 1405.178183]  ? 0xffffffffa0098099
[ 1405.178794]  0xffffffffa0098099
[ 1405.179290]  ? cpufreq_stats_record_transition+0x1e0/0x1e0
[ 1405.180081]  ? ftrace_call+0x5/0x44
[ 1405.180614]  ? pmd_page_vaddr+0x2b/0x70
[ 1405.181203]  ? _raw_spin_lock+0x5/0x50
[ 1405.181792]  _raw_spin_lock+0x5/0x50
[ 1405.182325]  __get_locked_pte+0x1a2/0x290
[ 1405.182899]  ? _raw_spin_lock+0x5/0x50
[ 1405.183429]  ? __get_locked_pte+0x1a2/0x290
[ 1405.184046]  ? cpufreq_stats_record_transition+0x1e0/0x1e0
[ 1405.184822]  __text_poke+0xea/0x4e0
[ 1405.185333]  ? cpufreq_stats_record_transition+0x1e0/0x1e0
[ 1405.186118]  ? lock_is_held_type+0xe2/0x140
[ 1405.186726]  ? cpufreq_stats_record_transition+0x1e0/0x1e0
[ 1405.187522]  text_poke+0x2b/0x60
[ 1405.188033]  text_poke_bp_batch+0x1dc/0x2c0
[ 1405.188672]  ? od_register_powersave_bias_handler+0x30/0x30
[ 1405.189480]  text_poke_queue+0xa7/0xc0
[ 1405.190072]  ftrace_replace_code+0xfd/0x170
[ 1405.190726]  ftrace_modify_all_code+0x1b1/0x270
[ 1405.191407]  arch_ftrace_update_code+0x9/0x10
[ 1405.192025]  ftrace_run_update_code+0x30/0xa0
[ 1405.192664]  ftrace_startup_enable+0x5e/0xa0
[ 1405.193291]  ftrace_startup+0x16d/0x240
[ 1405.193921]  register_ftrace_function+0x43/0x90
[ 1405.194591]  perf_ftrace_event_register+0xc1/0xf0
[ 1405.195273]  perf_trace_event_init+0xa0/0x4c0
[ 1405.195946]  perf_trace_init+0xda/0x160
[ 1405.196544]  perf_tp_event_init+0x57/0xa0
[ 1405.197140]  perf_try_init_event+0x83/0x270
[ 1405.197804]  perf_event_alloc+0xe3f/0x1c10
[ 1405.198382]  ? _raw_spin_unlock+0x2c/0x50
[ 1405.198966]  ? alloc_fd+0x20d/0x320
[ 1405.199594]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1405.200350]  ? write_comp_data+0x2f/0x90
[ 1405.201354]  __x64_sys_perf_event_open+0x26/0x30
[ 1405.202082]  do_syscall_64+0x37/0x80
[ 1405.202667]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1405.203428] RIP: 0033:0x7fac0740459d
[ 1405.203996] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1405.206608] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1405.207721] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1405.208748] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1405.209775] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1405.210805] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1405.211832] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1405.213114] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1405.213295] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1405.214170] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1405.214193] Call Trace:
[ 1405.214221]  dump_stack_lvl+0xa4/0xd3
[ 1405.214288]  dump_stack+0x15/0x17
[ 1405.214324]  check_preemption_disabled+0x167/0x180
[ 1405.215413] caller is debug_smp_processor_id+0x1c/0x20
[ 1405.216919]  ? lock_timer_base+0x34/0x100
[ 1405.220120]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1405.220795]  debug_smp_processor_id+0x1c/0x20
[ 1405.221430]  perf_ftrace_function_call+0x7c/0x360
[ 1405.222134]  ? ftrace_ops_test+0x71/0xc0
[ 1405.222745]  ? ftrace_ops_test+0x71/0xc0
[ 1405.223328]  ? perf_trace_buf_update+0x70/0x70
[ 1405.223972]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1405.224668]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1405.225324]  ? write_comp_data+0x2f/0x90
[ 1405.225910]  ? perf_trace_buf_update+0x70/0x70
[ 1405.226623]  0xffffffffa0098099
[ 1405.227160]  ? ftrace_call+0x5/0x44
[ 1405.227699]  ? lock_timer_base+0xc0/0x100
[ 1405.228316]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1405.228962]  ? write_comp_data+0x2f/0x90
[ 1405.229557]  _raw_spin_lock_irqsave+0x5/0x70
[ 1405.230189]  lock_timer_base+0x34/0x100
[ 1405.230758]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1405.231393]  ? lock_timer_base+0x34/0x100
[ 1405.232036]  try_to_del_timer_sync+0x33/0x90
[ 1405.232649]  ? try_to_del_timer_sync+0x5/0x90
[ 1405.233310]  del_timer_sync+0xd3/0x130
[ 1405.233894]  schedule_timeout+0x34e/0x610
[ 1405.234553]  ? del_timer_sync+0x130/0x130
[ 1405.235179]  ? i915_init_ggtt+0x40/0x6b0
[ 1405.235825]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1405.236467]  ? rcu_gp_init+0x730/0x730
[ 1405.237022]  rcu_gp_kthread+0xdd/0x170
[ 1405.237623]  kthread+0x1e7/0x230
[ 1405.238130]  ? set_kthread_struct+0x80/0x80
[ 1405.238779]  ret_from_fork+0x1f/0x30
[ 1405.239500] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1405.239615] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1405.240578] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1405.241646] caller is debug_smp_processor_id+0x1c/0x20
[ 1405.243244] Call Trace:
[ 1405.243280]  dump_stack_lvl+0xa4/0xd3
[ 1405.243364]  dump_stack+0x15/0x17
[ 1405.245415]  check_preemption_disabled+0x167/0x180
[ 1405.246220]  debug_smp_processor_id+0x1c/0x20
[ 1405.246898]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1405.247741]  perf_tp_event+0x331/0x4e0
[ 1405.248672]  ? arch_local_irq_enable+0x10/0x12
[ 1405.249371]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1405.250125]  ? dump_stack_lvl+0xcc/0xd3
[ 1405.250768]  ? dump_stack+0x15/0x17
[ 1405.251330]  ? check_preemption_disabled+0x167/0x180
[ 1405.252170]  ? __get_locked_pte+0x1a2/0x290
[ 1405.252811]  ? __lock_text_start+0x8/0x8
[ 1405.253456]  perf_ftrace_function_call+0x248/0x360
[ 1405.254191]  ? perf_ftrace_function_call+0x248/0x360
[ 1405.255214]  ? 0xffffffffa0098099
[ 1405.255880]  0xffffffffa0098099
[ 1405.256423]  ? cpufreq_stats_record_transition+0x1e0/0x1e0
[ 1405.257278]  ? ftrace_call+0x5/0x44
[ 1405.257861]  ? pmd_page_vaddr+0x2b/0x70
[ 1405.258511]  ? _raw_spin_lock+0x5/0x50
[ 1405.259155]  _raw_spin_lock+0x5/0x50
[ 1405.259730]  __get_locked_pte+0x1a2/0x290
[ 1405.260361]  ? _raw_spin_lock+0x5/0x50
[ 1405.260945]  ? __get_locked_pte+0x1a2/0x290
[ 1405.261623]  ? cpufreq_stats_record_transition+0x1e0/0x1e0
[ 1405.262485]  __text_poke+0xea/0x4e0
[ 1405.263047]  ? cpufreq_stats_record_transition+0x1e0/0x1e0
[ 1405.263900]  ? lock_is_held_type+0xe2/0x140
[ 1405.264568]  ? cpufreq_stats_record_transition+0x1e0/0x1e0
[ 1405.265447]  text_poke+0x2b/0x60
[ 1405.266009]  text_poke_bp_batch+0x1dc/0x2c0
[ 1405.266752]  ? od_register_powersave_bias_handler+0x30/0x30
[ 1405.267645]  text_poke_queue+0xa7/0xc0
[ 1405.268291]  ftrace_replace_code+0xfd/0x170
[ 1405.269007]  ftrace_modify_all_code+0x1b1/0x270
[ 1405.269756]  arch_ftrace_update_code+0x9/0x10
[ 1405.270459]  ftrace_run_update_code+0x30/0xa0
[ 1405.271187]  ftrace_startup_enable+0x5e/0xa0
[ 1405.271881]  ftrace_startup+0x16d/0x240
[ 1405.272575]  register_ftrace_function+0x43/0x90
[ 1405.273303]  perf_ftrace_event_register+0xc1/0xf0
[ 1405.274060]  perf_trace_event_init+0xa0/0x4c0
[ 1405.274799]  perf_trace_init+0xda/0x160
[ 1405.275457]  perf_tp_event_init+0x57/0xa0
[ 1405.276113]  perf_try_init_event+0x83/0x270
[ 1405.276841]  perf_event_alloc+0xe3f/0x1c10
[ 1405.277473]  ? _raw_spin_unlock+0x2c/0x50
[ 1405.278120]  ? alloc_fd+0x20d/0x320
[ 1405.278799]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1405.279561]  ? write_comp_data+0x2f/0x90
[ 1405.280565]  __x64_sys_perf_event_open+0x26/0x30
[ 1405.281291]  do_syscall_64+0x37/0x80
[ 1405.281876]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1405.282654] RIP: 0033:0x7fac0740459d
[ 1405.283221] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1405.285821] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1405.286944] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1405.287971] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1405.289000] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1405.290029] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1405.291066] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1405.292345] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1405.292540] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1405.293399] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1405.294742] caller is debug_smp_processor_id+0x1c/0x20
[ 1405.296093] Call Trace:
[ 1405.297248]  dump_stack_lvl+0xa4/0xd3
[ 1405.297821]  dump_stack+0x15/0x17
[ 1405.298328]  check_preemption_disabled+0x167/0x180
[ 1405.299019]  ? prepare_to_swait_event+0x1b/0xf0
[ 1405.299666]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1405.300341]  debug_smp_processor_id+0x1c/0x20
[ 1405.300980]  perf_ftrace_function_call+0x7c/0x360
[ 1405.301660]  ? ftrace_ops_test+0x71/0xc0
[ 1405.302334]  ? trace_hardirqs_on+0x3f/0x170
[ 1405.302982]  ? write_comp_data+0x2f/0x90
[ 1405.303569]  ? perf_trace_buf_update+0x70/0x70
[ 1405.304214]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1405.304973]  0xffffffffa0098099
[ 1405.305492]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1405.306219]  ? del_timer_sync+0xde/0x130
[ 1405.306825]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1405.307506]  _raw_spin_lock_irqsave+0x5/0x70
[ 1405.308131]  prepare_to_swait_event+0x1b/0xf0
[ 1405.308765]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1405.309401]  ? prepare_to_swait_event+0x1b/0xf0
[ 1405.310099]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1405.310744]  ? rcu_gp_init+0x730/0x730
[ 1405.311298]  rcu_gp_kthread+0xdd/0x170
[ 1405.311899]  kthread+0x1e7/0x230
[ 1405.312398]  ? set_kthread_struct+0x80/0x80
[ 1405.313048]  ret_from_fork+0x1f/0x30
[ 1405.313767] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1405.313936] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1405.314945] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1405.314982] Call Trace:
[ 1405.315033]  dump_stack_lvl+0xa4/0xd3
[ 1405.316074] caller is debug_smp_processor_id+0x1c/0x20
[ 1405.317845]  dump_stack+0x15/0x17
[ 1405.320051]  check_preemption_disabled+0x167/0x180
[ 1405.320865]  ? __get_locked_pte+0x1a2/0x290
[ 1405.321569]  ? __lock_text_start+0x8/0x8
[ 1405.322298]  debug_smp_processor_id+0x1c/0x20
[ 1405.323047]  perf_ftrace_function_call+0x7c/0x360
[ 1405.324130]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1405.324919]  ? write_comp_data+0x2f/0x90
[ 1405.325620]  ? perf_trace_buf_update+0x70/0x70
[ 1405.326517]  0xffffffffa0098099
[ 1405.327136]  ? cpufreq_gov_performance_limits+0x50/0x50
[ 1405.328045]  ? ftrace_call+0x5/0x44
[ 1405.328701]  ? pmd_page_vaddr+0x2b/0x70
[ 1405.329423]  ? _raw_spin_lock+0x5/0x50
[ 1405.330160]  _raw_spin_lock+0x5/0x50
[ 1405.330796]  __get_locked_pte+0x1a2/0x290
[ 1405.331493]  ? _raw_spin_lock+0x5/0x50
[ 1405.332134]  ? __get_locked_pte+0x1a2/0x290
[ 1405.332923]  ? cpufreq_gov_performance_limits+0x50/0x50
[ 1405.333884]  __text_poke+0xea/0x4e0
[ 1405.334548]  ? cpufreq_gov_performance_limits+0x50/0x50
[ 1405.335506]  ? lock_is_held_type+0xe2/0x140
[ 1405.336289]  ? cpufreq_gov_performance_limits+0x50/0x50
[ 1405.337284]  text_poke+0x2b/0x60
[ 1405.337959]  text_poke_bp_batch+0x1dc/0x2c0
[ 1405.338821]  ? od_register_powersave_bias_handler+0x30/0x30
[ 1405.339882]  text_poke_queue+0xa7/0xc0
[ 1405.340656]  ftrace_replace_code+0xfd/0x170
[ 1405.341512]  ftrace_modify_all_code+0x1b1/0x270
[ 1405.342416]  arch_ftrace_update_code+0x9/0x10
[ 1405.343206]  ftrace_run_update_code+0x30/0xa0
[ 1405.344031]  ftrace_startup_enable+0x5e/0xa0
[ 1405.344849]  ftrace_startup+0x16d/0x240
[ 1405.345690]  register_ftrace_function+0x43/0x90
[ 1405.346547]  perf_ftrace_event_register+0xc1/0xf0
[ 1405.347427]  perf_trace_event_init+0xa0/0x4c0
[ 1405.348312]  perf_trace_init+0xda/0x160
[ 1405.349099]  perf_tp_event_init+0x57/0xa0
[ 1405.349873]  perf_try_init_event+0x83/0x270
[ 1405.350818]  perf_event_alloc+0xe3f/0x1c10
[ 1405.351586]  ? _raw_spin_unlock+0x2c/0x50
[ 1405.352364]  ? alloc_fd+0x20d/0x320
[ 1405.353238]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1405.354197]  ? write_comp_data+0x2f/0x90
[ 1405.355561]  __x64_sys_perf_event_open+0x26/0x30
[ 1405.356433]  do_syscall_64+0x37/0x80
[ 1405.357144]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1405.358056] RIP: 0033:0x7fac0740459d
[ 1405.358740] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1405.361736] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1405.362994] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1405.364105] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1405.365215] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1405.366330] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1405.367440] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1405.368924] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1405.369103] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1405.369996] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1405.370020] Call Trace:
[ 1405.370048]  dump_stack_lvl+0xa4/0xd3
[ 1405.370119]  dump_stack+0x15/0x17
[ 1405.370155]  check_preemption_disabled+0x167/0x180
[ 1405.371326] caller is debug_smp_processor_id+0x1c/0x20
[ 1405.372835]  ? finish_swait+0x41/0x80
[ 1405.376024]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1405.376697]  debug_smp_processor_id+0x1c/0x20
[ 1405.377332]  perf_ftrace_function_call+0x7c/0x360
[ 1405.378004]  ? ftrace_ops_test+0x71/0xc0
[ 1405.378592]  ? rcu_advance_cbs+0x70/0x70
[ 1405.379195]  ? write_comp_data+0x2f/0x90
[ 1405.379781]  ? perf_trace_buf_update+0x70/0x70
[ 1405.380426]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1405.381121]  ? write_comp_data+0x2f/0x90
[ 1405.381707]  ? perf_trace_buf_update+0x70/0x70
[ 1405.382355]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1405.383108]  0xffffffffa0098099
[ 1405.383644]  ? trace_hardirqs_on+0x3f/0x170
[ 1405.384320]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1405.385003]  _raw_spin_lock_irqsave+0x5/0x70
[ 1405.385626]  finish_swait+0x41/0x80
[ 1405.386151]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1405.386787]  ? finish_swait+0x41/0x80
[ 1405.387357]  rcu_gp_fqs_loop+0x2da/0x410
[ 1405.387998]  ? rcu_gp_init+0x730/0x730
[ 1405.388552]  rcu_gp_kthread+0xdd/0x170
[ 1405.389151]  kthread+0x1e7/0x230
[ 1405.389649]  ? set_kthread_struct+0x80/0x80
[ 1405.390301]  ret_from_fork+0x1f/0x30
[ 1405.391021] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1405.391142] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1405.392179] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1405.393241] caller is debug_smp_processor_id+0x1c/0x20
[ 1405.394942] Call Trace:
[ 1405.394995]  dump_stack_lvl+0xa4/0xd3
[ 1405.396761]  dump_stack+0x15/0x17
[ 1405.397357]  check_preemption_disabled+0x167/0x180
[ 1405.398259]  debug_smp_processor_id+0x1c/0x20
[ 1405.399007]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1405.399990]  perf_trace_buf_alloc+0x3d/0x100
[ 1405.400727]  ? __get_locked_pte+0x1a2/0x290
[ 1405.401429]  ? __lock_text_start+0x8/0x8
[ 1405.402134]  perf_ftrace_function_call+0x209/0x360
[ 1405.403285]  ? 0xffffffffa0098099
[ 1405.404070]  0xffffffffa0098099
[ 1405.404687]  ? cpufreq_gov_performance_limits+0x50/0x50
[ 1405.405591]  ? ftrace_call+0x5/0x44
[ 1405.406250]  ? pmd_page_vaddr+0x2b/0x70
[ 1405.406972]  ? _raw_spin_lock+0x5/0x50
[ 1405.407701]  _raw_spin_lock+0x5/0x50
[ 1405.408338]  __get_locked_pte+0x1a2/0x290
[ 1405.409035]  ? _raw_spin_lock+0x5/0x50
[ 1405.409675]  ? __get_locked_pte+0x1a2/0x290
[ 1405.410433]  ? cpufreq_gov_performance_limits+0x50/0x50
[ 1405.411339]  __text_poke+0xea/0x4e0
[ 1405.411961]  ? cpufreq_gov_performance_limits+0x50/0x50
[ 1405.412866]  ? lock_is_held_type+0xe2/0x140
[ 1405.413607]  ? cpufreq_gov_performance_limits+0x50/0x50
[ 1405.414551]  text_poke+0x2b/0x60
[ 1405.415188]  text_poke_bp_batch+0x1dc/0x2c0
[ 1405.415979]  ? od_register_powersave_bias_handler+0x30/0x30
[ 1405.416971]  text_poke_queue+0xa7/0xc0
[ 1405.417703]  ftrace_replace_code+0xfd/0x170
[ 1405.418515]  ftrace_modify_all_code+0x1b1/0x270
[ 1405.419357]  arch_ftrace_update_code+0x9/0x10
[ 1405.420102]  ftrace_run_update_code+0x30/0xa0
[ 1405.420885]  ftrace_startup_enable+0x5e/0xa0
[ 1405.421655]  ftrace_startup+0x16d/0x240
[ 1405.422455]  register_ftrace_function+0x43/0x90
[ 1405.423261]  perf_ftrace_event_register+0xc1/0xf0
[ 1405.424093]  perf_trace_event_init+0xa0/0x4c0
[ 1405.424929]  perf_trace_init+0xda/0x160
[ 1405.425672]  perf_tp_event_init+0x57/0xa0
[ 1405.426408]  perf_try_init_event+0x83/0x270
[ 1405.427236]  perf_event_alloc+0xe3f/0x1c10
[ 1405.427927]  ? _raw_spin_unlock+0x2c/0x50
[ 1405.428640]  ? alloc_fd+0x20d/0x320
[ 1405.429437]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1405.430284]  ? write_comp_data+0x2f/0x90
[ 1405.431533]  __x64_sys_perf_event_open+0x26/0x30
[ 1405.432336]  do_syscall_64+0x37/0x80
[ 1405.432986]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1405.433818] RIP: 0033:0x7fac0740459d
[ 1405.434447] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1405.437215] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1405.438465] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1405.439573] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1405.440685] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1405.441802] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1405.442924] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1405.444406] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1405.444578] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20675
[ 1405.445458] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1405.446830] caller is debug_smp_processor_id+0x1c/0x20
[ 1405.448182] Call Trace:
[ 1405.449282]  dump_stack_lvl+0xa4/0xd3
[ 1405.449854]  dump_stack+0x15/0x17
[ 1405.450364]  check_preemption_disabled+0x167/0x180
[ 1405.451054]  ? force_qs_rnp+0xd0/0x2c0
[ 1405.451599]  ? preempt_schedule+0x30/0x30
[ 1405.452204]  debug_smp_processor_id+0x1c/0x20
[ 1405.452838]  perf_ftrace_function_call+0x7c/0x360
[ 1405.453507]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1405.454205]  ? ftrace_ops_test+0x71/0xc0
[ 1405.454790]  ? rcu_advance_cbs+0x70/0x70
[ 1405.455392]  ? write_comp_data+0x2f/0x90
[ 1405.455977]  ? perf_trace_buf_update+0x70/0x70
[ 1405.456619]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1405.457314]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1405.457959]  ? force_qs_rnp+0xcb/0x2c0
[ 1405.458513]  ? sched_show_task+0x70/0x70
[ 1405.459118]  ? rcu_gp_torture_wait+0x20/0x20
[ 1405.459750]  0xffffffffa0098099
[ 1405.460220]  ? rcu_exp_wait_wake+0x4c0/0x4c0
[ 1405.460966]  ? __cond_resched+0x5/0x30
[ 1405.461537]  ? ___might_sleep+0x143/0x170
[ 1405.462128]  __cond_resched+0x5/0x30
[ 1405.462669]  force_qs_rnp+0xd0/0x2c0
[ 1405.463203]  ? __cond_resched+0x5/0x30
[ 1405.463746]  ? force_qs_rnp+0xd0/0x2c0
[ 1405.464364]  rcu_gp_fqs_loop+0x2eb/0x410
[ 1405.465004]  ? rcu_gp_init+0x730/0x730
[ 1405.465558]  rcu_gp_kthread+0xdd/0x170
[ 1405.466162]  kthread+0x1e7/0x230
[ 1405.466660]  ? set_kthread_struct+0x80/0x80
[ 1405.467309]  ret_from_fork+0x1f/0x30
[ 1405.468026] CPU: 0 PID: 20675 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1405.468176] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1405.469104] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1405.470347] caller is debug_smp_processor_id+0x1c/0x20
[ 1405.471863] Call Trace:
[ 1405.472961]  dump_stack_lvl+0xa4/0xd3
[ 1405.473583]  dump_stack+0x15/0x17
[ 1405.474126]  check_preemption_disabled+0x167/0x180
[ 1405.474927]  debug_smp_processor_id+0x1c/0x20
[ 1405.475609]  perf_trace_buf_alloc+0x98/0x100
[ 1405.476279]  ? __get_locked_pte+0x1a2/0x290
[ 1405.476922]  ? __lock_text_start+0x8/0x8
[ 1405.477555]  perf_ftrace_function_call+0x209/0x360
[ 1405.478528]  ? 0xffffffffa0098099
[ 1405.479194]  0xffffffffa0098099
[ 1405.479742]  ? cpufreq_gov_performance_limits+0x50/0x50
[ 1405.480561]  ? ftrace_call+0x5/0x44
[ 1405.481146]  ? pmd_page_vaddr+0x2b/0x70
[ 1405.481783]  ? _raw_spin_lock+0x5/0x50
[ 1405.482446]  _raw_spin_lock+0x5/0x50
[ 1405.483022]  __get_locked_pte+0x1a2/0x290
[ 1405.483653]  ? _raw_spin_lock+0x5/0x50
[ 1405.484237]  ? __get_locked_pte+0x1a2/0x290
[ 1405.484912]  ? cpufreq_gov_performance_limits+0x50/0x50
[ 1405.485731]  __text_poke+0xea/0x4e0
[ 1405.486312]  ? cpufreq_gov_performance_limits+0x50/0x50
[ 1405.487168]  ? lock_is_held_type+0xe2/0x140
[ 1405.487835]  ? cpufreq_gov_performance_limits+0x50/0x50
[ 1405.488676]  text_poke+0x2b/0x60
[ 1405.489237]  text_poke_bp_batch+0x1dc/0x2c0
[ 1405.489939]  ? od_register_powersave_bias_handler+0x30/0x30
[ 1405.490843]  text_poke_queue+0xa7/0xc0
[ 1405.491490]  ftrace_replace_code+0xfd/0x170
[ 1405.492205]  ftrace_modify_all_code+0x1b1/0x270
[ 1405.492954]  arch_ftrace_update_code+0x9/0x10
[ 1405.493632]  ftrace_run_update_code+0x30/0xa0
[ 1405.494340]  ftrace_startup_enable+0x5e/0xa0
[ 1405.495030]  ftrace_startup+0x16d/0x240
[ 1405.495722]  register_ftrace_function+0x43/0x90
[ 1405.496449]  perf_ftrace_event_register+0xc1/0xf0
[ 1405.497200]  perf_trace_event_init+0xa0/0x4c0
[ 1405.497938]  perf_trace_init+0xda/0x160
[ 1405.498606]  perf_tp_event_init+0x57/0xa0
[ 1405.499262]  perf_try_init_event+0x83/0x270
[ 1405.499989]  perf_event_alloc+0xe3f/0x1c10
[ 1405.500621]  ? _raw_spin_unlock+0x2c/0x50
[ 1405.501272]  ? alloc_fd+0x20d/0x320
[ 1405.501950]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1405.502720]  ? write_comp_data+0x2f/0x90
[ 1405.503724]  __x64_sys_perf_event_open+0x26/0x30
[ 1405.504449]  do_syscall_64+0x37/0x80
[ 1405.505033]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1405.505795] RIP: 0033:0x7fac0740459d
[ 1405.506369] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1405.508965] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1405.510088] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1405.511124] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1405.512153] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1405.513190] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1405.514230] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1405.515514] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1405.516653] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1405.518223] Call Trace:
[ 1405.518608]  dump_stack_lvl+0xa4/0xd3
[ 1405.519188]  dump_stack+0x15/0x17
[ 1405.519694]  check_preemption_disabled+0x167/0x180
[ 1405.520391]  ? do_epoll_wait+0x3b3/0xd80
[ 1405.520975]  ? __mutex_lock+0x9f0/0x9f0
[ 1405.521592]  debug_smp_processor_id+0x1c/0x20
[ 1405.522250]  perf_ftrace_function_call+0x7c/0x360
[ 1405.522994]  ? ftrace_call+0x5/0x44
[ 1405.523512]  ? trace_hardirqs_on+0x6a/0x170
[ 1405.524168]  ? finish_task_switch+0xb0/0x2a0
[ 1405.524788]  ? finish_task_switch+0x70/0x2a0
[ 1405.525436]  ? trace_hardirqs_on+0x3f/0x170
[ 1405.526044]  ? finish_task_switch+0x70/0x2a0
[ 1405.526703]  ? preempt_count_sub+0x5/0xa0
[ 1405.527353]  0xffffffffa0098099
[ 1405.527840]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1405.528544]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1405.529358]  ? do_epoll_wait+0x36b/0xd80
[ 1405.529972]  ? mutex_lock_nested+0x5/0x20
[ 1405.530578]  ? write_comp_data+0x2f/0x90
[ 1405.531189]  mutex_lock_nested+0x5/0x20
[ 1405.531772]  do_epoll_wait+0x3b3/0xd80
[ 1405.532337]  ? mutex_lock_nested+0x5/0x20
[ 1405.532925]  ? do_epoll_wait+0x3b3/0xd80
[ 1405.533673]  ? wait_woken+0x90/0x90
[ 1405.534281]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1405.534966]  do_syscall_64+0x37/0x80
[ 1405.535515]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1405.536240] RIP: 0033:0x7f8a39143b20
[ 1405.536776] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1405.539277] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1405.540334] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1405.541323] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1405.542308] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1405.543298] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1405.544281] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1410.169981] check_preemption_disabled: 2502080 callbacks suppressed
[ 1410.169998] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20676
[ 1410.170737] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1410.170799] caller is debug_smp_processor_id+0x1c/0x20
[ 1410.171695] caller is debug_smp_processor_id+0x1c/0x20
[ 1410.172550] CPU: 0 PID: 20676 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1410.174479] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1410.175695] Call Trace:
[ 1410.175977]  dump_stack_lvl+0xa4/0xd3
[ 1410.176398]  dump_stack+0x15/0x17
[ 1410.176776]  check_preemption_disabled+0x167/0x180
[ 1410.177308]  ? text_poke_queue+0x84/0xc0
[ 1410.177749]  ? cpumask_weight+0x20/0x20
[ 1410.178192]  debug_smp_processor_id+0x1c/0x20
[ 1410.178681]  perf_ftrace_function_call+0x7c/0x360
[ 1410.179213]  ? write_comp_data+0x2f/0x90
[ 1410.179661]  ? write_comp_data+0x2f/0x90
[ 1410.180108]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.180630]  ? write_comp_data+0x2f/0x90
[ 1410.181078]  ? write_comp_data+0x2f/0x90
[ 1410.181521]  ? __tty_buffer_request_room+0x1d0/0x1d0
[ 1410.182082]  0xffffffffa0098099
[ 1410.182448]  ? tty_buffer_free+0xc0/0xc0
[ 1410.182887]  ? text_poke_loc_init+0x63/0x140
[ 1410.183374]  ? __tty_buffer_request_room+0x1d0/0x1d0
[ 1410.183924]  ? text_poke_loc_init+0x5/0x140
[ 1410.184391]  ? write_comp_data+0x2f/0x90
[ 1410.184835]  text_poke_loc_init+0x5/0x140
[ 1410.185283]  text_poke_queue+0x84/0xc0
[ 1410.185707]  ? text_poke_loc_init+0x5/0x140
[ 1410.186182]  ? text_poke_queue+0x84/0xc0
[ 1410.186635]  ftrace_replace_code+0xfd/0x170
[ 1410.187113]  ftrace_modify_all_code+0x1b1/0x270
[ 1410.187630]  arch_ftrace_update_code+0x9/0x10
[ 1410.188117]  ftrace_run_update_code+0x30/0xa0
[ 1410.188607]  ftrace_startup_enable+0x5e/0xa0
[ 1410.189089]  ftrace_startup+0x16d/0x240
[ 1410.189534]  register_ftrace_function+0x43/0x90
[ 1410.190042]  perf_ftrace_event_register+0xc1/0xf0
[ 1410.190576]  perf_trace_event_init+0xa0/0x4c0
[ 1410.191073]  perf_trace_init+0xda/0x160
[ 1410.191513]  perf_tp_event_init+0x57/0xa0
[ 1410.191969]  perf_try_init_event+0x83/0x270
[ 1410.192449]  perf_event_alloc+0xe3f/0x1c10
[ 1410.192907]  ? _raw_spin_unlock+0x2c/0x50
[ 1410.193362]  ? alloc_fd+0x20d/0x320
[ 1410.193775]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1410.194316]  ? write_comp_data+0x2f/0x90
[ 1410.194809]  __x64_sys_perf_event_open+0x26/0x30
[ 1410.195323]  do_syscall_64+0x37/0x80
[ 1410.195729]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1410.196288] RIP: 0033:0x7fac0740459d
[ 1410.196692] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1410.198661] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1410.199476] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1410.200240] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1410.201002] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1410.201767] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1410.202539] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1410.203339] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1410.203378] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20676
[ 1410.204215] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1410.205124] caller is debug_smp_processor_id+0x1c/0x20
[ 1410.206458] Call Trace:
[ 1410.206468]  dump_stack_lvl+0xa4/0xd3
[ 1410.206489]  dump_stack+0x15/0x17
[ 1410.208218]  check_preemption_disabled+0x167/0x180
[ 1410.208804]  ? do_nanosleep+0x123/0x2a0
[ 1410.209278]  ? ___might_sleep+0x170/0x170
[ 1410.209775]  debug_smp_processor_id+0x1c/0x20
[ 1410.210320]  perf_ftrace_function_call+0x7c/0x360
[ 1410.210903]  ? 0xffffffffa0098099
[ 1410.211316]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1410.211903]  ? finish_task_switch+0xab/0x2a0
[ 1410.212426]  ? __schedule+0x46e/0xb20
[ 1410.212891]  ? do_nanosleep+0x9c/0x2a0
[ 1410.213357]  0xffffffffa0098099
[ 1410.213750]  ? finish_task_switch+0xb0/0x2a0
[ 1410.214288]  ? do_nanosleep+0x107/0x2a0
[ 1410.214767]  ? __might_sleep+0x5/0x70
[ 1410.215220]  ? write_comp_data+0x2f/0x90
[ 1410.215706]  __might_sleep+0x5/0x70
[ 1410.216139]  do_nanosleep+0x123/0x2a0
[ 1410.216594]  ? __might_sleep+0x5/0x70
[ 1410.217046]  ? do_nanosleep+0x123/0x2a0
[ 1410.217517]  ? write_comp_data+0x2f/0x90
[ 1410.218011]  hrtimer_nanosleep+0xf7/0x1b0
[ 1410.218520]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1410.219090]  __x64_sys_nanosleep+0xfc/0x150
[ 1410.219616]  do_syscall_64+0x37/0x80
[ 1410.220062]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1410.220677] RIP: 0033:0x7fac073cca18
[ 1410.221118] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1410.223283] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1410.224179] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1410.225023] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1410.225867] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1410.226712] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1410.227555] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1410.228434] CPU: 0 PID: 20676 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1410.228453] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1410.229320] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1410.230229] caller is debug_smp_processor_id+0x1c/0x20
[ 1410.231535] Call Trace:
[ 1410.232443]  dump_stack_lvl+0xa4/0xd3
[ 1410.232902]  dump_stack+0x15/0x17
[ 1410.233316]  check_preemption_disabled+0x167/0x180
[ 1410.233900]  ? text_poke_loc_init+0x63/0x140
[ 1410.234425]  ? insn_get_length+0x90/0x90
[ 1410.234913]  debug_smp_processor_id+0x1c/0x20
[ 1410.235448]  perf_ftrace_function_call+0x7c/0x360
[ 1410.236023]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.236601]  ? dump_stack_lvl+0xcc/0xd3
[ 1410.237079]  ? dump_stack+0x15/0x17
[ 1410.237511]  ? write_comp_data+0x2f/0x90
[ 1410.238018]  ? text_poke_queue+0x84/0xc0
[ 1410.238509]  ? cpumask_weight+0x20/0x20
[ 1410.238982]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.239555]  ? text_poke_queue+0x84/0xc0
[ 1410.240040]  ? perf_ftrace_function_call+0x4c/0x360
[ 1410.240651]  ? __tty_buffer_request_room+0x1d0/0x1d0
[ 1410.241267]  0xffffffffa0098099
[ 1410.241657]  ? write_comp_data+0x2f/0x90
[ 1410.242148]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.242721]  ? write_comp_data+0x2f/0x90
[ 1410.243216]  ? insn_decode+0x5/0x170
[ 1410.243665]  insn_decode+0x5/0x170
[ 1410.244087]  text_poke_loc_init+0x63/0x140
[ 1410.244589]  ? insn_decode+0x5/0x170
[ 1410.245038]  ? text_poke_loc_init+0x63/0x140
[ 1410.245572]  ? __tty_buffer_request_room+0x1d0/0x1d0
[ 1410.246185]  ? text_poke_loc_init+0x5/0x140
[ 1410.246698]  ? write_comp_data+0x2f/0x90
[ 1410.247181]  ? __tty_buffer_request_room+0x1d0/0x1d0
[ 1410.247789]  text_poke_queue+0x84/0xc0
[ 1410.248259]  ftrace_replace_code+0xfd/0x170
[ 1410.248780]  ftrace_modify_all_code+0x1b1/0x270
[ 1410.249337]  arch_ftrace_update_code+0x9/0x10
[ 1410.249869]  ftrace_run_update_code+0x30/0xa0
[ 1410.250417]  ftrace_startup_enable+0x5e/0xa0
[ 1410.250943]  ftrace_startup+0x16d/0x240
[ 1410.251427]  register_ftrace_function+0x43/0x90
[ 1410.251989]  perf_ftrace_event_register+0xc1/0xf0
[ 1410.252567]  perf_trace_event_init+0xa0/0x4c0
[ 1410.253109]  perf_trace_init+0xda/0x160
[ 1410.253589]  perf_tp_event_init+0x57/0xa0
[ 1410.254092]  perf_try_init_event+0x83/0x270
[ 1410.254618]  perf_event_alloc+0xe3f/0x1c10
[ 1410.255123]  ? _raw_spin_unlock+0x2c/0x50
[ 1410.255619]  ? alloc_fd+0x20d/0x320
[ 1410.256069]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1410.256656]  ? write_comp_data+0x2f/0x90
[ 1410.257194]  __x64_sys_perf_event_open+0x26/0x30
[ 1410.257757]  do_syscall_64+0x37/0x80
[ 1410.258211]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1410.258825] RIP: 0033:0x7fac0740459d
[ 1410.259264] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1410.261426] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1410.262333] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1410.263168] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1410.264003] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1410.264840] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1410.265676] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1410.266558] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1410.266608] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20676
[ 1410.267423] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1410.268329] caller is debug_smp_processor_id+0x1c/0x20
[ 1410.269648] Call Trace:
[ 1410.270580]  dump_stack_lvl+0xa4/0xd3
[ 1410.271039]  dump_stack+0x15/0x17
[ 1410.271453]  check_preemption_disabled+0x167/0x180
[ 1410.272036]  ? __might_sleep+0x48/0x70
[ 1410.272497]  ? sched_show_task+0x70/0x70
[ 1410.273000]  debug_smp_processor_id+0x1c/0x20
[ 1410.273535]  perf_ftrace_function_call+0x7c/0x360
[ 1410.274116]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.274690]  ? do_nanosleep+0x123/0x2a0
[ 1410.275164]  ? perf_ftrace_function_call+0x4c/0x360
[ 1410.275773]  ? 0xffffffffa0098099
[ 1410.276183]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1410.276770]  ? finish_task_switch+0xab/0x2a0
[ 1410.277291]  ? __schedule+0x46e/0xb20
[ 1410.277750]  ? do_nanosleep+0x9c/0x2a0
[ 1410.278222]  0xffffffffa0098099
[ 1410.278614]  ? do_nanosleep+0x9c/0x2a0
[ 1410.279091]  ? do_nanosleep+0x107/0x2a0
[ 1410.279570]  ? ___might_sleep+0x5/0x170
[ 1410.280049]  ___might_sleep+0x5/0x170
[ 1410.280503]  __might_sleep+0x48/0x70
[ 1410.280946]  ? ___might_sleep+0x5/0x170
[ 1410.281418]  ? __might_sleep+0x48/0x70
[ 1410.281885]  do_nanosleep+0x123/0x2a0
[ 1410.282346]  ? write_comp_data+0x2f/0x90
[ 1410.282842]  hrtimer_nanosleep+0xf7/0x1b0
[ 1410.283354]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1410.283923]  __x64_sys_nanosleep+0xfc/0x150
[ 1410.284449]  do_syscall_64+0x37/0x80
[ 1410.284894]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1410.285508] RIP: 0033:0x7fac073cca18
[ 1410.285947] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1410.288127] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1410.289025] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1410.289867] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1410.290716] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1410.291559] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1410.292402] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1410.293277] CPU: 0 PID: 20676 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1410.293306] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1410.294170] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1410.294180] Call Trace:
[ 1410.294188]  dump_stack_lvl+0xa4/0xd3
[ 1410.295077] caller is debug_smp_processor_id+0x1c/0x20
[ 1410.296406]  dump_stack+0x15/0x17
[ 1410.298137]  check_preemption_disabled+0x167/0x180
[ 1410.298720]  ? insn_decode+0x9b/0x170
[ 1410.299171]  ? insn_get_immediate+0x570/0x570
[ 1410.299705]  debug_smp_processor_id+0x1c/0x20
[ 1410.300237]  perf_ftrace_function_call+0x7c/0x360
[ 1410.300811]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.301383]  ? text_poke_loc_init+0x63/0x140
[ 1410.301905]  ? perf_ftrace_function_call+0x4c/0x360
[ 1410.302502]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.303077]  ? dump_stack_lvl+0xcc/0xd3
[ 1410.303560]  ? dump_stack+0x15/0x17
[ 1410.303993]  ? write_comp_data+0x2f/0x90
[ 1410.304475]  ? text_poke_queue+0x84/0xc0
[ 1410.304958]  ? cpumask_weight+0x20/0x20
[ 1410.305429]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.306013]  0xffffffffa0098099
[ 1410.306410]  ? __tty_buffer_request_room+0x1d0/0x1d0
[ 1410.307013]  ? 0xffffffffa0098099
[ 1410.307422]  ? write_comp_data+0x2f/0x90
[ 1410.307917]  ? insn_get_length+0x5/0x90
[ 1410.308390]  ? write_comp_data+0x2f/0x90
[ 1410.308875]  insn_get_length+0x5/0x90
[ 1410.309328]  insn_decode+0x9b/0x170
[ 1410.309759]  ? insn_get_length+0x5/0x90
[ 1410.310233]  ? insn_decode+0x9b/0x170
[ 1410.310689]  ? __tty_buffer_request_room+0x1d0/0x1d0
[ 1410.311290]  text_poke_loc_init+0x63/0x140
[ 1410.311816]  ? __tty_buffer_request_room+0x1d0/0x1d0
[ 1410.312424]  text_poke_queue+0x84/0xc0
[ 1410.312896]  ftrace_replace_code+0xfd/0x170
[ 1410.313416]  ftrace_modify_all_code+0x1b1/0x270
[ 1410.313975]  arch_ftrace_update_code+0x9/0x10
[ 1410.314516]  ftrace_run_update_code+0x30/0xa0
[ 1410.315051]  ftrace_startup_enable+0x5e/0xa0
[ 1410.315578]  ftrace_startup+0x16d/0x240
[ 1410.316062]  register_ftrace_function+0x43/0x90
[ 1410.316618]  perf_ftrace_event_register+0xc1/0xf0
[ 1410.317197]  perf_trace_event_init+0xa0/0x4c0
[ 1410.317739]  perf_trace_init+0xda/0x160
[ 1410.318229]  perf_tp_event_init+0x57/0xa0
[ 1410.318726]  perf_try_init_event+0x83/0x270
[ 1410.319249]  perf_event_alloc+0xe3f/0x1c10
[ 1410.319751]  ? _raw_spin_unlock+0x2c/0x50
[ 1410.320247]  ? alloc_fd+0x20d/0x320
[ 1410.320696]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1410.321282]  ? write_comp_data+0x2f/0x90
[ 1410.321819]  __x64_sys_perf_event_open+0x26/0x30
[ 1410.322391]  do_syscall_64+0x37/0x80
[ 1410.322836]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1410.323450] RIP: 0033:0x7fac0740459d
[ 1410.323889] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1410.326038] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1410.326937] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1410.327774] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1410.328610] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1410.329448] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1410.330320] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1410.331196] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1410.331229] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20676
[ 1410.332067] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1410.332976] caller is debug_smp_processor_id+0x1c/0x20
[ 1410.334305] Call Trace:
[ 1410.334313]  dump_stack_lvl+0xa4/0xd3
[ 1410.334334]  dump_stack+0x15/0x17
[ 1410.336067]  check_preemption_disabled+0x167/0x180
[ 1410.336653]  ? do_nanosleep+0x155/0x2a0
[ 1410.337126]  ? hrtimer_wakeup+0x40/0x40
[ 1410.337606]  debug_smp_processor_id+0x1c/0x20
[ 1410.338157]  perf_ftrace_function_call+0x7c/0x360
[ 1410.338740]  ? 0xffffffffa0098099
[ 1410.339153]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1410.339741]  ? finish_task_switch+0xab/0x2a0
[ 1410.340265]  ? __schedule+0x46e/0xb20
[ 1410.340724]  ? do_nanosleep+0x9c/0x2a0
[ 1410.341194]  ? do_nanosleep+0x9c/0x2a0
[ 1410.341661]  0xffffffffa0098099
[ 1410.342060]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1410.342641]  ? lock_is_held_type+0xe2/0x140
[ 1410.343161]  ? do_nanosleep+0x140/0x2a0
[ 1410.343640]  ? hrtimer_try_to_cancel+0x5/0x290
[ 1410.344186]  ? write_comp_data+0x2f/0x90
[ 1410.344674]  hrtimer_try_to_cancel+0x5/0x290
[ 1410.345200]  do_nanosleep+0x155/0x2a0
[ 1410.345655]  ? hrtimer_try_to_cancel+0x5/0x290
[ 1410.346207]  ? do_nanosleep+0x155/0x2a0
[ 1410.346682]  ? write_comp_data+0x2f/0x90
[ 1410.347175]  hrtimer_nanosleep+0xf7/0x1b0
[ 1410.347680]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1410.348250]  __x64_sys_nanosleep+0xfc/0x150
[ 1410.348775]  do_syscall_64+0x37/0x80
[ 1410.349221]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1410.349838] RIP: 0033:0x7fac073cca18
[ 1410.350284] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1410.352447] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1410.353344] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1410.354189] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1410.355034] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1410.355882] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1410.356727] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1410.357604] CPU: 0 PID: 20676 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1410.357653] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1410.358495] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1410.358505] Call Trace:
[ 1410.358512]  dump_stack_lvl+0xa4/0xd3
[ 1410.359401] caller is debug_smp_processor_id+0x1c/0x20
[ 1410.360724]  dump_stack+0x15/0x17
[ 1410.362451]  check_preemption_disabled+0x167/0x180
[ 1410.363035]  ? insn_get_length+0x75/0x90
[ 1410.363515]  ? insn_get_displacement+0x270/0x270
[ 1410.364078]  debug_smp_processor_id+0x1c/0x20
[ 1410.364612]  perf_ftrace_function_call+0x7c/0x360
[ 1410.365185]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.365756]  ? insn_decode+0x9b/0x170
[ 1410.366212]  ? perf_ftrace_function_call+0x4c/0x360
[ 1410.366805]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.367378]  ? text_poke_loc_init+0x63/0x140
[ 1410.367902]  ? perf_ftrace_function_call+0x4c/0x360
[ 1410.368496]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.369073]  ? dump_stack_lvl+0xcc/0xd3
[ 1410.369550]  ? dump_stack+0x15/0x17
[ 1410.369982]  ? write_comp_data+0x2f/0x90
[ 1410.370484]  0xffffffffa0098099
[ 1410.370884]  ? __tty_buffer_request_room+0x1d0/0x1d0
[ 1410.371488]  ? insn_get_length+0x41/0x90
[ 1410.371975]  ? insn_get_immediate+0x5/0x570
[ 1410.372486]  ? write_comp_data+0x2f/0x90
[ 1410.372970]  insn_get_immediate+0x5/0x570
[ 1410.373461]  insn_get_length+0x75/0x90
[ 1410.373922]  ? insn_get_immediate+0x5/0x570
[ 1410.374435]  ? insn_get_length+0x75/0x90
[ 1410.374921]  insn_decode+0x9b/0x170
[ 1410.375357]  ? __tty_buffer_request_room+0x1d0/0x1d0
[ 1410.375958]  text_poke_loc_init+0x63/0x140
[ 1410.376481]  ? __tty_buffer_request_room+0x1d0/0x1d0
[ 1410.377088]  text_poke_queue+0x84/0xc0
[ 1410.377558]  ftrace_replace_code+0xfd/0x170
[ 1410.378082]  ftrace_modify_all_code+0x1b1/0x270
[ 1410.378641]  arch_ftrace_update_code+0x9/0x10
[ 1410.379173]  ftrace_run_update_code+0x30/0xa0
[ 1410.379707]  ftrace_startup_enable+0x5e/0xa0
[ 1410.380233]  ftrace_startup+0x16d/0x240
[ 1410.380718]  register_ftrace_function+0x43/0x90
[ 1410.381274]  perf_ftrace_event_register+0xc1/0xf0
[ 1410.381852]  perf_trace_event_init+0xa0/0x4c0
[ 1410.382396]  perf_trace_init+0xda/0x160
[ 1410.382878]  perf_tp_event_init+0x57/0xa0
[ 1410.383374]  perf_try_init_event+0x83/0x270
[ 1410.383897]  perf_event_alloc+0xe3f/0x1c10
[ 1410.384400]  ? _raw_spin_unlock+0x2c/0x50
[ 1410.384896]  ? alloc_fd+0x20d/0x320
[ 1410.385344]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1410.385928]  ? write_comp_data+0x2f/0x90
[ 1410.386465]  __x64_sys_perf_event_open+0x26/0x30
[ 1410.387029]  do_syscall_64+0x37/0x80
[ 1410.387476]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1410.388089] RIP: 0033:0x7fac0740459d
[ 1410.388529] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1410.390693] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1410.391586] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1410.392422] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1410.393260] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1410.394103] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1410.394942] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1410.395815] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1410.395848] BUG: using smp_processor_id() in preemptible [00000000] code: repro/20676
[ 1410.396684] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1410.397594] caller is debug_smp_processor_id+0x1c/0x20
[ 1410.398926] Call Trace:
[ 1410.398934]  dump_stack_lvl+0xa4/0xd3
[ 1410.398954]  dump_stack+0x15/0x17
[ 1410.400687]  check_preemption_disabled+0x167/0x180
[ 1410.401272]  ? hrtimer_try_to_cancel+0x38/0x290
[ 1410.401827]  ? __hrtimer_get_remaining+0x80/0x80
[ 1410.402399]  debug_smp_processor_id+0x1c/0x20
[ 1410.402935]  perf_ftrace_function_call+0x7c/0x360
[ 1410.403510]  ? do_nanosleep+0x155/0x2a0
[ 1410.403984]  ? hrtimer_wakeup+0x40/0x40
[ 1410.404462]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.405036]  ? do_nanosleep+0x155/0x2a0
[ 1410.405510]  ? perf_ftrace_function_call+0x4c/0x360
[ 1410.406114]  ? 0xffffffffa0098099
[ 1410.406527]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1410.407118]  ? do_nanosleep+0x9c/0x2a0
[ 1410.407587]  0xffffffffa0098099
[ 1410.407977]  ? do_nanosleep+0x9c/0x2a0
[ 1410.408448]  ? do_nanosleep+0x9c/0x2a0
[ 1410.408920]  ? do_nanosleep+0x140/0x2a0
[ 1410.409401]  ? hrtimer_active+0x5/0xb0
[ 1410.409870]  ? do_nanosleep+0x140/0x2a0
[ 1410.410348]  hrtimer_active+0x5/0xb0
[ 1410.410794]  hrtimer_try_to_cancel+0x38/0x290
[ 1410.411333]  ? hrtimer_active+0x5/0xb0
[ 1410.411798]  ? hrtimer_try_to_cancel+0x38/0x290
[ 1410.412360]  ? do_nanosleep+0x9c/0x2a0
[ 1410.412827]  do_nanosleep+0x155/0x2a0
[ 1410.413282]  ? write_comp_data+0x2f/0x90
[ 1410.413777]  hrtimer_nanosleep+0xf7/0x1b0
[ 1410.414292]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1410.414862]  __x64_sys_nanosleep+0xfc/0x150
[ 1410.415388]  do_syscall_64+0x37/0x80
[ 1410.415835]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1410.416449] RIP: 0033:0x7fac073cca18
[ 1410.416889] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1410.419063] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1410.419961] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1410.420806] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1410.421650] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1410.422497] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1410.423341] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1410.424217] CPU: 0 PID: 20676 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1410.424244] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1410.425099] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1410.426009] caller is debug_smp_processor_id+0x1c/0x20
[ 1410.427302] Call Trace:
[ 1410.428211]  dump_stack_lvl+0xa4/0xd3
[ 1410.428670]  dump_stack+0x15/0x17
[ 1410.429081]  check_preemption_disabled+0x167/0x180
[ 1410.429663]  ? insn_get_immediate+0x181/0x570
[ 1410.430194]  ? insn_get_sib+0x140/0x140
[ 1410.430669]  debug_smp_processor_id+0x1c/0x20
[ 1410.431202]  perf_ftrace_function_call+0x7c/0x360
[ 1410.431773]  ? insn_get_displacement+0x270/0x270
[ 1410.432331]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.432901]  ? insn_get_length+0x75/0x90
[ 1410.433382]  ? perf_ftrace_function_call+0x4c/0x360
[ 1410.433972]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.434695]  ? insn_decode+0x9b/0x170
[ 1410.435176]  ? perf_ftrace_function_call+0x4c/0x360
[ 1410.435770]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.436342]  ? text_poke_loc_init+0x63/0x140
[ 1410.436863]  ? perf_ftrace_function_call+0x4c/0x360
[ 1410.437456]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.438032]  ? dump_stack_lvl+0xcc/0xd3
[ 1410.438522]  0xffffffffa0098099
[ 1410.438922]  ? 0xffffffffa0098099
[ 1410.439338]  ? insn_get_immediate+0x49/0x570
[ 1410.439863]  ? insn_get_displacement+0x5/0x270
[ 1410.440404]  ? write_comp_data+0x2f/0x90
[ 1410.440891]  insn_get_displacement+0x5/0x270
[ 1410.441418]  insn_get_immediate+0x181/0x570
[ 1410.441933]  ? insn_get_displacement+0x5/0x270
[ 1410.442478]  ? insn_get_immediate+0x181/0x570
[ 1410.443019]  insn_get_length+0x75/0x90
[ 1410.443486]  insn_decode+0x9b/0x170
[ 1410.443923]  ? __tty_buffer_request_room+0x1d0/0x1d0
[ 1410.444525]  text_poke_loc_init+0x63/0x140
[ 1410.445052]  ? __tty_buffer_request_room+0x1d0/0x1d0
[ 1410.445660]  text_poke_queue+0x84/0xc0
[ 1410.446134]  ftrace_replace_code+0xfd/0x170
[ 1410.446656]  ftrace_modify_all_code+0x1b1/0x270
[ 1410.447215]  arch_ftrace_update_code+0x9/0x10
[ 1410.447747]  ftrace_run_update_code+0x30/0xa0
[ 1410.448283]  ftrace_startup_enable+0x5e/0xa0
[ 1410.448809]  ftrace_startup+0x16d/0x240
[ 1410.449294]  register_ftrace_function+0x43/0x90
[ 1410.449850]  perf_ftrace_event_register+0xc1/0xf0
[ 1410.450429]  perf_trace_event_init+0xa0/0x4c0
[ 1410.450973]  perf_trace_init+0xda/0x160
[ 1410.451455]  perf_tp_event_init+0x57/0xa0
[ 1410.451953]  perf_try_init_event+0x83/0x270
[ 1410.452477]  perf_event_alloc+0xe3f/0x1c10
[ 1410.452980]  ? _raw_spin_unlock+0x2c/0x50
[ 1410.453476]  ? alloc_fd+0x20d/0x320
[ 1410.453925]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1410.454513]  ? write_comp_data+0x2f/0x90
[ 1410.455050]  __x64_sys_perf_event_open+0x26/0x30
[ 1410.455613]  do_syscall_64+0x37/0x80
[ 1410.456059]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1410.456672] RIP: 0033:0x7fac0740459d
[ 1410.457112] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1410.459280] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1410.460174] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1410.461011] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1410.461850] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1410.462692] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1410.463529] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1410.464403] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1410.465279] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1410.466621] Call Trace:
[ 1410.466931]  dump_stack_lvl+0xa4/0xd3
[ 1410.467391]  dump_stack+0x15/0x17
[ 1410.467807]  check_preemption_disabled+0x167/0x180
[ 1410.468395]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1410.468969]  ? __bpf_trace_sys_enter+0x10/0x10
[ 1410.469518]  debug_smp_processor_id+0x1c/0x20
[ 1410.470060]  perf_ftrace_function_call+0x7c/0x360
[ 1410.470640]  ? write_comp_data+0x2f/0x90
[ 1410.471132]  ? write_comp_data+0x2f/0x90
[ 1410.471622]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.472201]  ? write_comp_data+0x2f/0x90
[ 1410.472690]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.473274]  0xffffffffa0098099
[ 1410.473665]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.474265]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1410.474929]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1410.475507]  syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1410.476150]  syscall_exit_to_user_mode+0xd/0x60
[ 1410.476704]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1410.477367]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1410.477944]  do_syscall_64+0x46/0x80
[ 1410.478394]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1410.479010] RIP: 0033:0x7fac073cca18
[ 1410.479451] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1410.481619] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1410.482521] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1410.483366] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1410.484210] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1410.485054] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1410.485898] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1547.041796] check_preemption_disabled: 1703683 callbacks suppressed
[ 1547.041814] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23071
[ 1547.043850] caller is debug_smp_processor_id+0x1c/0x20
[ 1547.044549] CPU: 1 PID: 23071 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1547.045528] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1547.047010] Call Trace:
[ 1547.047366]  dump_stack_lvl+0xa4/0xd3
[ 1547.047898]  dump_stack+0x15/0x17
[ 1547.048370]  check_preemption_disabled+0x167/0x180
[ 1547.049026]  ? text_poke+0x2b/0x60
[ 1547.049503]  ? do_sync_core+0x30/0x30
[ 1547.050027]  debug_smp_processor_id+0x1c/0x20
[ 1547.050636]  perf_ftrace_function_call+0x7c/0x360
[ 1547.051276]  ? ftrace_ops_test+0x71/0xc0
[ 1547.051828]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1547.052444]  ? _raw_spin_unlock+0x2c/0x50
[ 1547.053002]  ? preempt_notifier_dec+0x20/0x20
[ 1547.053615]  ? do_sync_core+0x30/0x30
[ 1547.054143]  ? ftrace_call+0x5/0x44
[ 1547.054645]  ? write_comp_data+0x2f/0x90
[ 1547.055202]  ? perf_trace_buf_update+0x70/0x70
[ 1547.055819]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1547.056478]  ? __text_poke+0x4e0/0x4e0
[ 1547.057030]  0xffffffffa009a099
[ 1547.057508]  ? __text_poke+0x4e0/0x4e0
[ 1547.058081]  ? __text_poke+0x4e0/0x4e0
[ 1547.058609]  ? __text_poke+0x5/0x4e0
[ 1547.059139]  __text_poke+0x5/0x4e0
[ 1547.059624]  text_poke+0x2b/0x60
[ 1547.060086]  ? __text_poke+0x5/0x4e0
[ 1547.060587]  ? text_poke+0x2b/0x60
[ 1547.061089]  text_poke_bp_batch+0x93/0x2c0
[ 1547.061686]  ? user_disable_single_step+0x50/0x50
[ 1547.062361]  text_poke_queue+0xa7/0xc0
[ 1547.062910]  ftrace_replace_code+0xfd/0x170
[ 1547.063517]  ftrace_modify_all_code+0x1b1/0x270
[ 1547.064160]  arch_ftrace_update_code+0x9/0x10
[ 1547.064761]  ftrace_run_update_code+0x30/0xa0
[ 1547.065372]  ftrace_shutdown+0x2b8/0x4a0
[ 1547.065952]  unregister_ftrace_function+0x25/0x50
[ 1547.066603]  perf_ftrace_event_register+0x89/0xf0
[ 1547.067246]  ? perf_tp_event_init+0xa0/0xa0
[ 1547.067826]  perf_trace_destroy+0x37/0x60
[ 1547.068389]  tp_perf_event_destroy+0x15/0x20
[ 1547.068984]  _free_event+0xfc/0x7d0
[ 1547.069505]  put_event+0x37/0x50
[ 1547.069975]  perf_event_release_kernel+0x2f4/0x370
[ 1547.070672]  ? perf_event_release_kernel+0x370/0x370
[ 1547.071366]  perf_release+0x19/0x20
[ 1547.071867]  __fput+0x12d/0x460
[ 1547.072374]  ____fput+0x1a/0x20
[ 1547.072832]  task_work_run+0x8e/0xf0
[ 1547.073370]  do_exit+0x616/0x1310
[ 1547.073928]  __x64_sys_exit+0x24/0x30
[ 1547.074468]  do_syscall_64+0x37/0x80
[ 1547.074980]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1547.075668] RIP: 0033:0x7fac0740459d
[ 1547.076170] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1547.077029] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1547.078036] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1547.078975] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1547.079902] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1547.080830] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1547.081757] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1547.082918] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23071
[ 1547.083934] caller is debug_smp_processor_id+0x1c/0x20
[ 1547.084623] CPU: 1 PID: 23071 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1547.085593] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1547.087072] Call Trace:
[ 1547.087428]  dump_stack_lvl+0xa4/0xd3
[ 1547.087962]  dump_stack+0x15/0x17
[ 1547.088435]  check_preemption_disabled+0x167/0x180
[ 1547.089093]  ? text_poke+0x2b/0x60
[ 1547.089570]  ? do_sync_core+0x30/0x30
[ 1547.090099]  debug_smp_processor_id+0x1c/0x20
[ 1547.090702]  perf_ftrace_function_call+0x7c/0x360
[ 1547.091343]  ? ftrace_ops_test+0x71/0xc0
[ 1547.091896]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1547.092514]  ? _raw_spin_unlock+0x2c/0x50
[ 1547.093076]  ? preempt_notifier_dec+0x20/0x20
[ 1547.093688]  ? __text_poke+0x4e0/0x4e0
[ 1547.094227]  ? ftrace_call+0x5/0x44
[ 1547.094722]  ? write_comp_data+0x2f/0x90
[ 1547.095270]  ? perf_trace_buf_update+0x70/0x70
[ 1547.095881]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1547.096530]  ? alternatives_smp_module_del+0x90/0x90
[ 1547.097227]  0xffffffffa009a099
[ 1547.097697]  ? alternatives_smp_module_del+0x90/0x90
[ 1547.098415]  ? alternatives_smp_module_del+0x90/0x90
[ 1547.099087]  ? __text_poke+0x5/0x4e0
[ 1547.099613]  __text_poke+0x5/0x4e0
[ 1547.100092]  text_poke+0x2b/0x60
[ 1547.100548]  ? __text_poke+0x5/0x4e0
[ 1547.101042]  ? text_poke+0x2b/0x60
[ 1547.101537]  text_poke_bp_batch+0x93/0x2c0
[ 1547.102128]  ? user_disable_single_step+0x50/0x50
[ 1547.102797]  text_poke_queue+0xa7/0xc0
[ 1547.103348]  ftrace_replace_code+0xfd/0x170
[ 1547.103957]  ftrace_modify_all_code+0x1b1/0x270
[ 1547.104605]  arch_ftrace_update_code+0x9/0x10
[ 1547.105208]  ftrace_run_update_code+0x30/0xa0
[ 1547.105822]  ftrace_shutdown+0x2b8/0x4a0
[ 1547.106411]  unregister_ftrace_function+0x25/0x50
[ 1547.107063]  perf_ftrace_event_register+0x89/0xf0
[ 1547.107710]  ? perf_tp_event_init+0xa0/0xa0
[ 1547.108290]  perf_trace_destroy+0x37/0x60
[ 1547.108855]  tp_perf_event_destroy+0x15/0x20
[ 1547.109452]  _free_event+0xfc/0x7d0
[ 1547.109974]  put_event+0x37/0x50
[ 1547.110448]  perf_event_release_kernel+0x2f4/0x370
[ 1547.111134]  ? perf_event_release_kernel+0x370/0x370
[ 1547.111817]  perf_release+0x19/0x20
[ 1547.112311]  __fput+0x12d/0x460
[ 1547.112810]  ____fput+0x1a/0x20
[ 1547.113264]  task_work_run+0x8e/0xf0
[ 1547.113792]  do_exit+0x616/0x1310
[ 1547.114348]  __x64_sys_exit+0x24/0x30
[ 1547.114868]  do_syscall_64+0x37/0x80
[ 1547.115375]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1547.116054] RIP: 0033:0x7fac0740459d
[ 1547.116549] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1547.117396] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1547.118394] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1547.119326] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1547.120257] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1547.121189] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1547.122125] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1547.123251] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23071
[ 1547.124345] caller is debug_smp_processor_id+0x1c/0x20
[ 1547.125041] CPU: 1 PID: 23071 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1547.126028] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1547.127490] Call Trace:
[ 1547.127842]  dump_stack_lvl+0xa4/0xd3
[ 1547.128371]  dump_stack+0x15/0x17
[ 1547.128839]  check_preemption_disabled+0x167/0x180
[ 1547.129493]  ? text_poke+0x2b/0x60
[ 1547.129965]  ? do_sync_core+0x30/0x30
[ 1547.130494]  debug_smp_processor_id+0x1c/0x20
[ 1547.131092]  perf_ftrace_function_call+0x7c/0x360
[ 1547.131728]  ? ftrace_ops_test+0x71/0xc0
[ 1547.132283]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1547.132897]  ? _raw_spin_unlock+0x2c/0x50
[ 1547.133452]  ? preempt_notifier_dec+0x20/0x20
[ 1547.134063]  ? alternatives_smp_module_del+0x90/0x90
[ 1547.134755]  ? ftrace_call+0x5/0x44
[ 1547.135254]  ? write_comp_data+0x2f/0x90
[ 1547.135808]  ? perf_trace_buf_update+0x70/0x70
[ 1547.136421]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1547.137079]  ? alternatives_text_reserved+0xa0/0xa0
[ 1547.137771]  0xffffffffa009a099
[ 1547.138255]  ? alternatives_text_reserved+0xa0/0xa0
[ 1547.138964]  ? alternatives_text_reserved+0xa0/0xa0
[ 1547.139631]  ? __text_poke+0x5/0x4e0
[ 1547.140158]  __text_poke+0x5/0x4e0
[ 1547.140641]  text_poke+0x2b/0x60
[ 1547.141102]  ? __text_poke+0x5/0x4e0
[ 1547.141601]  ? text_poke+0x2b/0x60
[ 1547.142108]  text_poke_bp_batch+0x93/0x2c0
[ 1547.142702]  ? user_disable_single_step+0x50/0x50
[ 1547.143364]  text_poke_queue+0xa7/0xc0
[ 1547.143910]  ftrace_replace_code+0xfd/0x170
[ 1547.144513]  ftrace_modify_all_code+0x1b1/0x270
[ 1547.145155]  arch_ftrace_update_code+0x9/0x10
[ 1547.145753]  ftrace_run_update_code+0x30/0xa0
[ 1547.146370]  ftrace_shutdown+0x2b8/0x4a0
[ 1547.146949]  unregister_ftrace_function+0x25/0x50
[ 1547.147595]  perf_ftrace_event_register+0x89/0xf0
[ 1547.148238]  ? perf_tp_event_init+0xa0/0xa0
[ 1547.148815]  perf_trace_destroy+0x37/0x60
[ 1547.149377]  tp_perf_event_destroy+0x15/0x20
[ 1547.149970]  _free_event+0xfc/0x7d0
[ 1547.150499]  put_event+0x37/0x50
[ 1547.150973]  perf_event_release_kernel+0x2f4/0x370
[ 1547.151665]  ? perf_event_release_kernel+0x370/0x370
[ 1547.152354]  perf_release+0x19/0x20
[ 1547.152853]  __fput+0x12d/0x460
[ 1547.153356]  ____fput+0x1a/0x20
[ 1547.153813]  task_work_run+0x8e/0xf0
[ 1547.154357]  do_exit+0x616/0x1310
[ 1547.154911]  __x64_sys_exit+0x24/0x30
[ 1547.155434]  do_syscall_64+0x37/0x80
[ 1547.155945]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1547.156631] RIP: 0033:0x7fac0740459d
[ 1547.157130] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1547.157986] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1547.158986] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1547.159910] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1547.160835] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1547.161763] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1547.162694] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1547.163881] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23071
[ 1547.164907] caller is debug_smp_processor_id+0x1c/0x20
[ 1547.165597] CPU: 1 PID: 23071 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1547.166582] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1547.168060] Call Trace:
[ 1547.168417]  dump_stack_lvl+0xa4/0xd3
[ 1547.168953]  dump_stack+0x15/0x17
[ 1547.169428]  check_preemption_disabled+0x167/0x180
[ 1547.170091]  ? text_poke+0x2b/0x60
[ 1547.170569]  ? do_sync_core+0x30/0x30
[ 1547.171097]  debug_smp_processor_id+0x1c/0x20
[ 1547.171704]  perf_ftrace_function_call+0x7c/0x360
[ 1547.172347]  ? ftrace_ops_test+0x71/0xc0
[ 1547.172903]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1547.173523]  ? _raw_spin_unlock+0x2c/0x50
[ 1547.174089]  ? preempt_notifier_dec+0x20/0x20
[ 1547.174700]  ? alternatives_text_reserved+0xa0/0xa0
[ 1547.175376]  ? ftrace_call+0x5/0x44
[ 1547.175871]  ? write_comp_data+0x2f/0x90
[ 1547.176422]  ? perf_trace_buf_update+0x70/0x70
[ 1547.177032]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1547.177685]  ? text_poke_early+0xc0/0xc0
[ 1547.178258]  0xffffffffa009a099
[ 1547.178731]  ? text_poke_early+0xc0/0xc0
[ 1547.179315]  ? text_poke_early+0xc0/0xc0
[ 1547.179858]  ? __text_poke+0x5/0x4e0
[ 1547.180383]  __text_poke+0x5/0x4e0
[ 1547.180863]  text_poke+0x2b/0x60
[ 1547.181324]  ? __text_poke+0x5/0x4e0
[ 1547.181819]  ? text_poke+0x2b/0x60
[ 1547.182325]  text_poke_bp_batch+0x93/0x2c0
[ 1547.182920]  ? user_disable_single_step+0x50/0x50
[ 1547.183590]  text_poke_queue+0xa7/0xc0
[ 1547.184142]  ftrace_replace_code+0xfd/0x170
[ 1547.184753]  ftrace_modify_all_code+0x1b1/0x270
[ 1547.185402]  arch_ftrace_update_code+0x9/0x10
[ 1547.186006]  ftrace_run_update_code+0x30/0xa0
[ 1547.186629]  ftrace_shutdown+0x2b8/0x4a0
[ 1547.187213]  unregister_ftrace_function+0x25/0x50
[ 1547.187866]  perf_ftrace_event_register+0x89/0xf0
[ 1547.188515]  ? perf_tp_event_init+0xa0/0xa0
[ 1547.189098]  perf_trace_destroy+0x37/0x60
[ 1547.189665]  tp_perf_event_destroy+0x15/0x20
[ 1547.190267]  _free_event+0xfc/0x7d0
[ 1547.190786]  put_event+0x37/0x50
[ 1547.191255]  perf_event_release_kernel+0x2f4/0x370
[ 1547.191941]  ? perf_event_release_kernel+0x370/0x370
[ 1547.192627]  perf_release+0x19/0x20
[ 1547.193124]  __fput+0x12d/0x460
[ 1547.193625]  ____fput+0x1a/0x20
[ 1547.194081]  task_work_run+0x8e/0xf0
[ 1547.194613]  do_exit+0x616/0x1310
[ 1547.195165]  __x64_sys_exit+0x24/0x30
[ 1547.195684]  do_syscall_64+0x37/0x80
[ 1547.196190]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1547.196872] RIP: 0033:0x7fac0740459d
[ 1547.197367] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1547.198228] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1547.199235] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1547.200170] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1547.201104] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1547.202038] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1547.202980] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1547.204109] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23071
[ 1547.205139] caller is debug_smp_processor_id+0x1c/0x20
[ 1547.205836] CPU: 1 PID: 23071 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1547.206822] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1547.208285] Call Trace:
[ 1547.208639]  dump_stack_lvl+0xa4/0xd3
[ 1547.209170]  dump_stack+0x15/0x17
[ 1547.209641]  check_preemption_disabled+0x167/0x180
[ 1547.210303]  ? text_poke+0x2b/0x60
[ 1547.210778]  ? do_sync_core+0x30/0x30
[ 1547.211302]  debug_smp_processor_id+0x1c/0x20
[ 1547.211903]  perf_ftrace_function_call+0x7c/0x360
[ 1547.212540]  ? ftrace_ops_test+0x71/0xc0
[ 1547.213089]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1547.213705]  ? _raw_spin_unlock+0x2c/0x50
[ 1547.214266]  ? preempt_notifier_dec+0x20/0x20
[ 1547.214880]  ? text_poke_early+0xc0/0xc0
[ 1547.215441]  ? ftrace_call+0x5/0x44
[ 1547.215940]  ? write_comp_data+0x2f/0x90
[ 1547.216495]  ? perf_trace_buf_update+0x70/0x70
[ 1547.217110]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1547.217769]  ? apply_alternatives+0x370/0x370
[ 1547.218400]  0xffffffffa009a099
[ 1547.218875]  ? apply_alternatives+0x370/0x370
[ 1547.219521]  ? apply_alternatives+0x370/0x370
[ 1547.220125]  ? __text_poke+0x5/0x4e0
[ 1547.220654]  __text_poke+0x5/0x4e0
[ 1547.221138]  text_poke+0x2b/0x60
[ 1547.221601]  ? __text_poke+0x5/0x4e0
[ 1547.222101]  ? text_poke+0x2b/0x60
[ 1547.222598]  text_poke_bp_batch+0x93/0x2c0
[ 1547.223188]  ? user_disable_single_step+0x50/0x50
[ 1547.223852]  text_poke_queue+0xa7/0xc0
[ 1547.224400]  ftrace_replace_code+0xfd/0x170
[ 1547.225004]  ftrace_modify_all_code+0x1b1/0x270
[ 1547.225649]  arch_ftrace_update_code+0x9/0x10
[ 1547.226255]  ftrace_run_update_code+0x30/0xa0
[ 1547.226865]  ftrace_shutdown+0x2b8/0x4a0
[ 1547.227445]  unregister_ftrace_function+0x25/0x50
[ 1547.228092]  perf_ftrace_event_register+0x89/0xf0
[ 1547.228734]  ? perf_tp_event_init+0xa0/0xa0
[ 1547.229311]  perf_trace_destroy+0x37/0x60
[ 1547.229873]  tp_perf_event_destroy+0x15/0x20
[ 1547.230479]  _free_event+0xfc/0x7d0
[ 1547.231003]  put_event+0x37/0x50
[ 1547.231477]  perf_event_release_kernel+0x2f4/0x370
[ 1547.232168]  ? perf_event_release_kernel+0x370/0x370
[ 1547.232861]  perf_release+0x19/0x20
[ 1547.233362]  __fput+0x12d/0x460
[ 1547.233868]  ____fput+0x1a/0x20
[ 1547.234336]  task_work_run+0x8e/0xf0
[ 1547.234872]  do_exit+0x616/0x1310
[ 1547.235429]  __x64_sys_exit+0x24/0x30
[ 1547.235953]  do_syscall_64+0x37/0x80
[ 1547.236465]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1547.237152] RIP: 0033:0x7fac0740459d
[ 1547.237653] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1547.238512] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1547.239510] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1547.240438] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1547.241361] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1547.242293] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1547.243223] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1547.244361] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23071
[ 1547.245380] caller is debug_smp_processor_id+0x1c/0x20
[ 1547.246136] CPU: 1 PID: 23071 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1547.247121] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1547.248596] Call Trace:
[ 1547.248952]  dump_stack_lvl+0xa4/0xd3
[ 1547.249485]  dump_stack+0x15/0x17
[ 1547.249962]  check_preemption_disabled+0x167/0x180
[ 1547.250628]  ? text_poke+0x2b/0x60
[ 1547.251106]  ? do_sync_core+0x30/0x30
[ 1547.251634]  debug_smp_processor_id+0x1c/0x20
[ 1547.252242]  perf_ftrace_function_call+0x7c/0x360
[ 1547.252886]  ? ftrace_ops_test+0x71/0xc0
[ 1547.253442]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1547.254064]  ? _raw_spin_unlock+0x2c/0x50
[ 1547.254622]  ? preempt_notifier_dec+0x20/0x20
[ 1547.255232]  ? apply_alternatives+0x370/0x370
[ 1547.255843]  ? ftrace_call+0x5/0x44
[ 1547.256340]  ? write_comp_data+0x2f/0x90
[ 1547.256892]  ? perf_trace_buf_update+0x70/0x70
[ 1547.257503]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1547.258158]  ? apply_paravirt+0x150/0x150
[ 1547.258739]  0xffffffffa009a099
[ 1547.259212]  ? apply_paravirt+0x150/0x150
[ 1547.259808]  ? apply_paravirt+0x150/0x150
[ 1547.260365]  ? __text_poke+0x5/0x4e0
[ 1547.260888]  __text_poke+0x5/0x4e0
[ 1547.261369]  text_poke+0x2b/0x60
[ 1547.261828]  ? __text_poke+0x5/0x4e0
[ 1547.262328]  ? text_poke+0x2b/0x60
[ 1547.262830]  text_poke_bp_batch+0x93/0x2c0
[ 1547.263425]  ? user_disable_single_step+0x50/0x50
[ 1547.264094]  text_poke_queue+0xa7/0xc0
[ 1547.264647]  ftrace_replace_code+0xfd/0x170
[ 1547.265258]  ftrace_modify_all_code+0x1b1/0x270
[ 1547.265908]  arch_ftrace_update_code+0x9/0x10
[ 1547.266516]  ftrace_run_update_code+0x30/0xa0
[ 1547.267131]  ftrace_shutdown+0x2b8/0x4a0
[ 1547.267717]  unregister_ftrace_function+0x25/0x50
[ 1547.268371]  perf_ftrace_event_register+0x89/0xf0
[ 1547.269020]  ? perf_tp_event_init+0xa0/0xa0
[ 1547.269603]  perf_trace_destroy+0x37/0x60
[ 1547.270171]  tp_perf_event_destroy+0x15/0x20
[ 1547.270766]  _free_event+0xfc/0x7d0
[ 1547.271286]  put_event+0x37/0x50
[ 1547.271756]  perf_event_release_kernel+0x2f4/0x370
[ 1547.272443]  ? perf_event_release_kernel+0x370/0x370
[ 1547.273129]  perf_release+0x19/0x20
[ 1547.273626]  __fput+0x12d/0x460
[ 1547.274134]  ____fput+0x1a/0x20
[ 1547.274611]  task_work_run+0x8e/0xf0
[ 1547.275145]  do_exit+0x616/0x1310
[ 1547.275697]  __x64_sys_exit+0x24/0x30
[ 1547.276215]  do_syscall_64+0x37/0x80
[ 1547.276723]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1547.277404] RIP: 0033:0x7fac0740459d
[ 1547.277899] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1547.278761] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1547.279769] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1547.280707] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1547.281644] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1547.282587] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1547.283524] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1547.284651] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23071
[ 1547.285679] caller is debug_smp_processor_id+0x1c/0x20
[ 1547.286454] CPU: 1 PID: 23071 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1547.287441] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1547.288902] Call Trace:
[ 1547.289256]  dump_stack_lvl+0xa4/0xd3
[ 1547.289791]  dump_stack+0x15/0x17
[ 1547.290276]  check_preemption_disabled+0x167/0x180
[ 1547.290930]  ? text_poke_bp_batch+0x93/0x2c0
[ 1547.291515]  ? apply_paravirt+0x150/0x150
[ 1547.292087]  debug_smp_processor_id+0x1c/0x20
[ 1547.292694]  perf_ftrace_function_call+0x7c/0x360
[ 1547.293338]  ? preempt_notifier_dec+0x20/0x20
[ 1547.293948]  ? apply_paravirt+0x150/0x150
[ 1547.294522]  ? ftrace_call+0x5/0x44
[ 1547.295016]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1547.295773]  0xffffffffa009a099
[ 1547.296298]  ? text_poke+0x60/0x60
[ 1547.296779]  ? text_poke+0x5/0x60
[ 1547.297273]  text_poke+0x5/0x60
[ 1547.297725]  text_poke_bp_batch+0x93/0x2c0
[ 1547.298296]  ? text_poke+0x5/0x60
[ 1547.298760]  ? text_poke_bp_batch+0x93/0x2c0
[ 1547.299372]  ? user_disable_single_step+0x50/0x50
[ 1547.300041]  text_poke_queue+0xa7/0xc0
[ 1547.300592]  ftrace_replace_code+0xfd/0x170
[ 1547.301198]  ftrace_modify_all_code+0x1b1/0x270
[ 1547.301841]  arch_ftrace_update_code+0x9/0x10
[ 1547.302446]  ftrace_run_update_code+0x30/0xa0
[ 1547.303061]  ftrace_shutdown+0x2b8/0x4a0
[ 1547.303647]  unregister_ftrace_function+0x25/0x50
[ 1547.304298]  perf_ftrace_event_register+0x89/0xf0
[ 1547.304948]  ? perf_tp_event_init+0xa0/0xa0
[ 1547.305533]  perf_trace_destroy+0x37/0x60
[ 1547.306100]  tp_perf_event_destroy+0x15/0x20
[ 1547.306697]  _free_event+0xfc/0x7d0
[ 1547.307218]  put_event+0x37/0x50
[ 1547.307692]  perf_event_release_kernel+0x2f4/0x370
[ 1547.308383]  ? perf_event_release_kernel+0x370/0x370
[ 1547.309069]  perf_release+0x19/0x20
[ 1547.309566]  __fput+0x12d/0x460
[ 1547.310074]  ____fput+0x1a/0x20
[ 1547.310532]  task_work_run+0x8e/0xf0
[ 1547.311063]  do_exit+0x616/0x1310
[ 1547.311622]  __x64_sys_exit+0x24/0x30
[ 1547.312143]  do_syscall_64+0x37/0x80
[ 1547.312656]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1547.313339] RIP: 0033:0x7fac0740459d
[ 1547.313835] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1547.314716] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1547.315723] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1547.316651] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1547.317584] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1547.318524] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1547.319448] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1547.320596] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23071
[ 1547.321613] caller is debug_smp_processor_id+0x1c/0x20
[ 1547.322372] CPU: 1 PID: 23071 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1547.323356] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1547.324817] Call Trace:
[ 1547.325171]  dump_stack_lvl+0xa4/0xd3
[ 1547.325705]  dump_stack+0x15/0x17
[ 1547.326190]  check_preemption_disabled+0x167/0x180
[ 1547.326844]  ? text_poke+0x2b/0x60
[ 1547.327318]  ? do_sync_core+0x30/0x30
[ 1547.327845]  debug_smp_processor_id+0x1c/0x20
[ 1547.328450]  perf_ftrace_function_call+0x7c/0x360
[ 1547.329086]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1547.329725]  ? text_poke_bp_batch+0x93/0x2c0
[ 1547.330320]  ? perf_ftrace_function_call+0x4c/0x360
[ 1547.330989]  ? preempt_notifier_dec+0x20/0x20
[ 1547.331599]  ? apply_paravirt+0x150/0x150
[ 1547.332163]  ? ftrace_call+0x5/0x44
[ 1547.332650]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1547.333341]  ? text_poke+0x60/0x60
[ 1547.333848]  0xffffffffa009a099
[ 1547.334327]  ? text_poke+0x60/0x60
[ 1547.334846]  ? text_poke+0x60/0x60
[ 1547.335325]  ? __text_poke+0x5/0x4e0
[ 1547.335853]  __text_poke+0x5/0x4e0
[ 1547.336335]  text_poke+0x2b/0x60
[ 1547.336792]  ? __text_poke+0x5/0x4e0
[ 1547.337285]  ? text_poke+0x2b/0x60
[ 1547.337780]  text_poke_bp_batch+0x93/0x2c0
[ 1547.338380]  ? user_disable_single_step+0x50/0x50
[ 1547.339047]  text_poke_queue+0xa7/0xc0
[ 1547.339593]  ftrace_replace_code+0xfd/0x170
[ 1547.340198]  ftrace_modify_all_code+0x1b1/0x270
[ 1547.340847]  arch_ftrace_update_code+0x9/0x10
[ 1547.341448]  ftrace_run_update_code+0x30/0xa0
[ 1547.342091]  ftrace_shutdown+0x2b8/0x4a0
[ 1547.342699]  unregister_ftrace_function+0x25/0x50
[ 1547.343352]  perf_ftrace_event_register+0x89/0xf0
[ 1547.343997]  ? perf_tp_event_init+0xa0/0xa0
[ 1547.344573]  perf_trace_destroy+0x37/0x60
[ 1547.345135]  tp_perf_event_destroy+0x15/0x20
[ 1547.345732]  _free_event+0xfc/0x7d0
[ 1547.346259]  put_event+0x37/0x50
[ 1547.346729]  perf_event_release_kernel+0x2f4/0x370
[ 1547.347413]  ? perf_event_release_kernel+0x370/0x370
[ 1547.348097]  perf_release+0x19/0x20
[ 1547.348596]  __fput+0x12d/0x460
[ 1547.349097]  ____fput+0x1a/0x20
[ 1547.349551]  task_work_run+0x8e/0xf0
[ 1547.350086]  do_exit+0x616/0x1310
[ 1547.350639]  __x64_sys_exit+0x24/0x30
[ 1547.351163]  do_syscall_64+0x37/0x80
[ 1547.351671]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1547.352351] RIP: 0033:0x7fac0740459d
[ 1547.352846] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1547.353703] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1547.354707] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1547.355638] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1547.356576] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1547.357504] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1547.358436] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1547.359613] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23071
[ 1547.360635] caller is debug_smp_processor_id+0x1c/0x20
[ 1547.361328] CPU: 1 PID: 23071 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1547.362316] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1547.363781] Call Trace:
[ 1547.364136]  dump_stack_lvl+0xa4/0xd3
[ 1547.364670]  dump_stack+0x15/0x17
[ 1547.365140]  check_preemption_disabled+0x167/0x180
[ 1547.365795]  ? text_poke_bp_batch+0x93/0x2c0
[ 1547.366383]  ? apply_paravirt+0x150/0x150
[ 1547.366955]  debug_smp_processor_id+0x1c/0x20
[ 1547.367556]  perf_ftrace_function_call+0x7c/0x360
[ 1547.368199]  ? preempt_notifier_dec+0x20/0x20
[ 1547.368809]  ? text_poke+0x60/0x60
[ 1547.369304]  ? ftrace_call+0x5/0x44
[ 1547.369799]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1547.370557]  0xffffffffa009a099
[ 1547.371083]  ? alternatives_smp_module_add+0x160/0x160
[ 1547.371783]  ? text_poke+0x5/0x60
[ 1547.372279]  text_poke+0x5/0x60
[ 1547.372726]  text_poke_bp_batch+0x93/0x2c0
[ 1547.373293]  ? text_poke+0x5/0x60
[ 1547.373754]  ? text_poke_bp_batch+0x93/0x2c0
[ 1547.374370]  ? user_disable_single_step+0x50/0x50
[ 1547.375034]  text_poke_queue+0xa7/0xc0
[ 1547.375580]  ftrace_replace_code+0xfd/0x170
[ 1547.376185]  ftrace_modify_all_code+0x1b1/0x270
[ 1547.376830]  arch_ftrace_update_code+0x9/0x10
[ 1547.377434]  ftrace_run_update_code+0x30/0xa0
[ 1547.378046]  ftrace_shutdown+0x2b8/0x4a0
[ 1547.378627]  unregister_ftrace_function+0x25/0x50
[ 1547.379275]  perf_ftrace_event_register+0x89/0xf0
[ 1547.379925]  ? perf_tp_event_init+0xa0/0xa0
[ 1547.380503]  perf_trace_destroy+0x37/0x60
[ 1547.381064]  tp_perf_event_destroy+0x15/0x20
[ 1547.381663]  _free_event+0xfc/0x7d0
[ 1547.382195]  put_event+0x37/0x50
[ 1547.382668]  perf_event_release_kernel+0x2f4/0x370
[ 1547.383357]  ? perf_event_release_kernel+0x370/0x370
[ 1547.384041]  perf_release+0x19/0x20
[ 1547.384542]  __fput+0x12d/0x460
[ 1547.385046]  ____fput+0x1a/0x20
[ 1547.385500]  task_work_run+0x8e/0xf0
[ 1547.386031]  do_exit+0x616/0x1310
[ 1547.386592]  __x64_sys_exit+0x24/0x30
[ 1547.387115]  do_syscall_64+0x37/0x80
[ 1547.387626]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1547.388307] RIP: 0033:0x7fac0740459d
[ 1547.388803] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1547.389656] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1547.390659] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1547.391585] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1547.392521] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1547.393451] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1547.394379] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1547.395546] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23071
[ 1547.396562] caller is debug_smp_processor_id+0x1c/0x20
[ 1547.397254] CPU: 1 PID: 23071 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1547.398240] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1547.399706] Call Trace:
[ 1547.400061]  dump_stack_lvl+0xa4/0xd3
[ 1547.400598]  dump_stack+0x15/0x17
[ 1547.401068]  check_preemption_disabled+0x167/0x180
[ 1547.401723]  ? text_poke+0x2b/0x60
[ 1547.402200]  ? do_sync_core+0x30/0x30
[ 1547.402727]  debug_smp_processor_id+0x1c/0x20
[ 1547.403333]  perf_ftrace_function_call+0x7c/0x360
[ 1547.403969]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1547.404611]  ? text_poke_bp_batch+0x93/0x2c0
[ 1547.405201]  ? perf_ftrace_function_call+0x4c/0x360
[ 1547.405870]  ? preempt_notifier_dec+0x20/0x20
[ 1547.406490]  ? text_poke+0x60/0x60
[ 1547.406980]  ? ftrace_call+0x5/0x44
[ 1547.407470]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1547.408163]  ? alternatives_smp_module_add+0x160/0x160
[ 1547.408885]  0xffffffffa009a099
[ 1547.409356]  ? alternatives_smp_module_add+0x160/0x160
[ 1547.410092]  ? alternatives_smp_module_add+0x160/0x160
[ 1547.410792]  ? __text_poke+0x5/0x4e0
[ 1547.411320]  __text_poke+0x5/0x4e0
[ 1547.411800]  text_poke+0x2b/0x60
[ 1547.412258]  ? __text_poke+0x5/0x4e0
[ 1547.412751]  ? text_poke+0x2b/0x60
[ 1547.413250]  text_poke_bp_batch+0x93/0x2c0
[ 1547.413846]  ? user_disable_single_step+0x50/0x50
[ 1547.414515]  text_poke_queue+0xa7/0xc0
[ 1547.415063]  ftrace_replace_code+0xfd/0x170
[ 1547.415671]  ftrace_modify_all_code+0x1b1/0x270
[ 1547.416318]  arch_ftrace_update_code+0x9/0x10
[ 1547.416915]  ftrace_run_update_code+0x30/0xa0
[ 1547.417525]  ftrace_shutdown+0x2b8/0x4a0
[ 1547.418107]  unregister_ftrace_function+0x25/0x50
[ 1547.418761]  perf_ftrace_event_register+0x89/0xf0
[ 1547.419403]  ? perf_tp_event_init+0xa0/0xa0
[ 1547.419980]  perf_trace_destroy+0x37/0x60
[ 1547.420542]  tp_perf_event_destroy+0x15/0x20
[ 1547.421142]  _free_event+0xfc/0x7d0
[ 1547.421664]  put_event+0x37/0x50
[ 1547.422136]  perf_event_release_kernel+0x2f4/0x370
[ 1547.422824]  ? perf_event_release_kernel+0x370/0x370
[ 1547.423514]  perf_release+0x19/0x20
[ 1547.424014]  __fput+0x12d/0x460
[ 1547.424516]  ____fput+0x1a/0x20
[ 1547.424988]  task_work_run+0x8e/0xf0
[ 1547.425528]  do_exit+0x616/0x1310
[ 1547.426096]  __x64_sys_exit+0x24/0x30
[ 1547.426633]  do_syscall_64+0x37/0x80
[ 1547.427160]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1547.427851] RIP: 0033:0x7fac0740459d
[ 1547.428356] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1547.429220] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1547.430240] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1547.431183] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1547.432117] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1547.433047] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1547.433986] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1552.042057] check_preemption_disabled: 1791487 callbacks suppressed
[ 1552.042084] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23072
[ 1552.042396] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1552.042980] caller is debug_smp_processor_id+0x1c/0x20
[ 1552.044162] caller is debug_smp_processor_id+0x1c/0x20
[ 1552.045232] CPU: 1 PID: 23072 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1552.047706] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1552.049233] Call Trace:
[ 1552.049616]  dump_stack_lvl+0xa4/0xd3
[ 1552.050197]  dump_stack+0x15/0x17
[ 1552.050697]  check_preemption_disabled+0x167/0x180
[ 1552.051388]  ? __get_locked_pte+0x1a2/0x290
[ 1552.051991]  ? __lock_text_start+0x8/0x8
[ 1552.052589]  debug_smp_processor_id+0x1c/0x20
[ 1552.053224]  perf_ftrace_function_call+0x7c/0x360
[ 1552.053923]  ? ftrace_ops_test+0x71/0xc0
[ 1552.054522]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1552.055199]  ? text_poke+0x2b/0x60
[ 1552.055711]  ? perf_ftrace_function_call+0x4c/0x360
[ 1552.056420]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1552.057117]  ? ftrace_ops_test+0x71/0xc0
[ 1552.057694]  ? write_comp_data+0x2f/0x90
[ 1552.058285]  ? perf_trace_buf_update+0x70/0x70
[ 1552.058997]  0xffffffffa009a099
[ 1552.059498]  ? perf_trace_devlink_trap_report+0x410/0x410
[ 1552.060301]  ? ftrace_call+0x5/0x44
[ 1552.060842]  ? pmd_page_vaddr+0x2b/0x70
[ 1552.061437]  ? _raw_spin_lock+0x5/0x50
[ 1552.062030]  _raw_spin_lock+0x5/0x50
[ 1552.062570]  __get_locked_pte+0x1a2/0x290
[ 1552.063159]  ? _raw_spin_lock+0x5/0x50
[ 1552.063707]  ? __get_locked_pte+0x1a2/0x290
[ 1552.064336]  ? perf_trace_devlink_trap_report+0x410/0x410
[ 1552.065122]  __text_poke+0xea/0x4e0
[ 1552.065646]  ? perf_trace_devlink_trap_report+0x410/0x410
[ 1552.066438]  ? lock_is_held_type+0xe2/0x140
[ 1552.067059]  ? perf_trace_devlink_trap_report+0x410/0x410
[ 1552.067864]  text_poke+0x2b/0x60
[ 1552.068381]  text_poke_bp_batch+0x93/0x2c0
[ 1552.069019]  ? gro_cells_init+0xe0/0xe0
[ 1552.069622]  text_poke_queue+0xa7/0xc0
[ 1552.070222]  ftrace_replace_code+0xfd/0x170
[ 1552.070880]  ftrace_modify_all_code+0x1b1/0x270
[ 1552.071575]  arch_ftrace_update_code+0x9/0x10
[ 1552.072209]  ftrace_run_update_code+0x30/0xa0
[ 1552.072861]  ftrace_startup_enable+0x5e/0xa0
[ 1552.073503]  ftrace_startup+0x16d/0x240
[ 1552.074139]  register_ftrace_function+0x43/0x90
[ 1552.074815]  perf_ftrace_event_register+0xc1/0xf0
[ 1552.075514]  perf_trace_event_init+0xa0/0x4c0
[ 1552.076196]  perf_trace_init+0xda/0x160
[ 1552.076803]  perf_tp_event_init+0x57/0xa0
[ 1552.077414]  perf_try_init_event+0x83/0x270
[ 1552.078087]  perf_event_alloc+0xe3f/0x1c10
[ 1552.078682]  ? _raw_spin_unlock+0x2c/0x50
[ 1552.079283]  ? alloc_fd+0x20d/0x320
[ 1552.079900]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1552.080609]  ? write_comp_data+0x2f/0x90
[ 1552.081484]  __x64_sys_perf_event_open+0x26/0x30
[ 1552.082165]  do_syscall_64+0x37/0x80
[ 1552.082707]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1552.083423] RIP: 0033:0x7fac0740459d
[ 1552.083956] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1552.086425] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1552.087475] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1552.088446] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1552.089419] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1552.090402] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1552.091376] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1552.092548] CPU: 0 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1552.092655] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23072
[ 1552.093740] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1552.094863] caller is debug_smp_processor_id+0x1c/0x20
[ 1552.096474] Call Trace:
[ 1552.097594]  dump_stack_lvl+0xa4/0xd3
[ 1552.098308]  dump_stack+0x15/0x17
[ 1552.098903]  check_preemption_disabled+0x167/0x180
[ 1552.099709]  ? lock_timer_base+0x34/0x100
[ 1552.100385]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1552.101187]  debug_smp_processor_id+0x1c/0x20
[ 1552.101932]  perf_ftrace_function_call+0x7c/0x360
[ 1552.103013]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1552.103797]  ? write_comp_data+0x2f/0x90
[ 1552.104494]  ? perf_trace_buf_update+0x70/0x70
[ 1552.105374]  0xffffffffa009a099
[ 1552.106062]  ? ftrace_call+0x5/0x44
[ 1552.106714]  ? lock_timer_base+0xc0/0x100
[ 1552.107458]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1552.108212]  ? write_comp_data+0x2f/0x90
[ 1552.108924]  _raw_spin_lock_irqsave+0x5/0x70
[ 1552.109655]  lock_timer_base+0x34/0x100
[ 1552.110327]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1552.111063]  ? lock_timer_base+0x34/0x100
[ 1552.111860]  try_to_del_timer_sync+0x33/0x90
[ 1552.112574]  ? try_to_del_timer_sync+0x5/0x90
[ 1552.113368]  del_timer_sync+0xd3/0x130
[ 1552.114081]  schedule_timeout+0x34e/0x610
[ 1552.114882]  ? del_timer_sync+0x130/0x130
[ 1552.115645]  ? i915_init_ggtt+0x40/0x6b0
[ 1552.116452]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1552.117257]  ? rcu_gp_init+0x730/0x730
[ 1552.117911]  rcu_gp_kthread+0xdd/0x170
[ 1552.118658]  kthread+0x1e7/0x230
[ 1552.119260]  ? set_kthread_struct+0x80/0x80
[ 1552.120048]  ret_from_fork+0x1f/0x30
[ 1552.121033] CPU: 1 PID: 23072 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1552.121435] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1552.122053] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1552.122079] Call Trace:
[ 1552.122107]  dump_stack_lvl+0xa4/0xd3
[ 1552.122174]  dump_stack+0x15/0x17
[ 1552.123368] caller is debug_smp_processor_id+0x1c/0x20
[ 1552.124875]  check_preemption_disabled+0x167/0x180
[ 1552.127574]  ? __get_locked_pte+0x1a2/0x290
[ 1552.128175]  ? __lock_text_start+0x8/0x8
[ 1552.128771]  debug_smp_processor_id+0x1c/0x20
[ 1552.129407]  perf_ftrace_function_call+0x7c/0x360
[ 1552.130109]  ? ftrace_ops_test+0x71/0xc0
[ 1552.130704]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1552.131382]  ? text_poke+0x2b/0x60
[ 1552.131894]  ? perf_ftrace_function_call+0x4c/0x360
[ 1552.132605]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1552.133303]  ? ftrace_ops_test+0x71/0xc0
[ 1552.133875]  ? write_comp_data+0x2f/0x90
[ 1552.134471]  ? perf_trace_buf_update+0x70/0x70
[ 1552.135182]  0xffffffffa009a099
[ 1552.135682]  ? devlink_fmsg_put_value+0x120/0x120
[ 1552.136381]  ? ftrace_call+0x5/0x44
[ 1552.136920]  ? pmd_page_vaddr+0x2b/0x70
[ 1552.137514]  ? _raw_spin_lock+0x5/0x50
[ 1552.138112]  _raw_spin_lock+0x5/0x50
[ 1552.138647]  __get_locked_pte+0x1a2/0x290
[ 1552.139236]  ? _raw_spin_lock+0x5/0x50
[ 1552.139783]  ? __get_locked_pte+0x1a2/0x290
[ 1552.140412]  ? devlink_fmsg_put_value+0x120/0x120
[ 1552.141111]  __text_poke+0xea/0x4e0
[ 1552.141633]  ? devlink_fmsg_put_value+0x120/0x120
[ 1552.142348]  ? lock_is_held_type+0xe2/0x140
[ 1552.142969]  ? devlink_fmsg_put_value+0x120/0x120
[ 1552.143686]  text_poke+0x2b/0x60
[ 1552.144202]  text_poke_bp_batch+0x93/0x2c0
[ 1552.144841]  ? gro_cells_init+0xe0/0xe0
[ 1552.145444]  text_poke_queue+0xa7/0xc0
[ 1552.146038]  ftrace_replace_code+0xfd/0x170
[ 1552.146708]  ftrace_modify_all_code+0x1b1/0x270
[ 1552.147402]  arch_ftrace_update_code+0x9/0x10
[ 1552.148035]  ftrace_run_update_code+0x30/0xa0
[ 1552.148687]  ftrace_startup_enable+0x5e/0xa0
[ 1552.149327]  ftrace_startup+0x16d/0x240
[ 1552.149960]  register_ftrace_function+0x43/0x90
[ 1552.150644]  perf_ftrace_event_register+0xc1/0xf0
[ 1552.151341]  perf_trace_event_init+0xa0/0x4c0
[ 1552.152022]  perf_trace_init+0xda/0x160
[ 1552.152627]  perf_tp_event_init+0x57/0xa0
[ 1552.153234]  perf_try_init_event+0x83/0x270
[ 1552.153904]  perf_event_alloc+0xe3f/0x1c10
[ 1552.154506]  ? _raw_spin_unlock+0x2c/0x50
[ 1552.155104]  ? alloc_fd+0x20d/0x320
[ 1552.155717]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1552.156425]  ? write_comp_data+0x2f/0x90
[ 1552.157298]  __x64_sys_perf_event_open+0x26/0x30
[ 1552.157975]  do_syscall_64+0x37/0x80
[ 1552.158528]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1552.159244] RIP: 0033:0x7fac0740459d
[ 1552.159771] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1552.162241] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1552.163289] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1552.164261] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1552.165232] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1552.166215] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1552.167186] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1552.168355] CPU: 0 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1552.168457] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23072
[ 1552.169540] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1552.170657] caller is debug_smp_processor_id+0x1c/0x20
[ 1552.172256] Call Trace:
[ 1552.173378]  dump_stack_lvl+0xa4/0xd3
[ 1552.174078]  dump_stack+0x15/0x17
[ 1552.174670]  check_preemption_disabled+0x167/0x180
[ 1552.175562]  debug_smp_processor_id+0x1c/0x20
[ 1552.176303]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1552.177279]  perf_trace_buf_alloc+0x3d/0x100
[ 1552.178008]  ? lock_timer_base+0x34/0x100
[ 1552.178691]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1552.179476]  perf_ftrace_function_call+0x209/0x360
[ 1552.180617]  ? 0xffffffffa009a099
[ 1552.181406]  0xffffffffa009a099
[ 1552.182095]  ? ftrace_call+0x5/0x44
[ 1552.182747]  ? lock_timer_base+0xc0/0x100
[ 1552.183491]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1552.184245]  ? write_comp_data+0x2f/0x90
[ 1552.184957]  _raw_spin_lock_irqsave+0x5/0x70
[ 1552.185686]  lock_timer_base+0x34/0x100
[ 1552.186361]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1552.187106]  ? lock_timer_base+0x34/0x100
[ 1552.187910]  try_to_del_timer_sync+0x33/0x90
[ 1552.188621]  ? try_to_del_timer_sync+0x5/0x90
[ 1552.189414]  del_timer_sync+0xd3/0x130
[ 1552.190126]  schedule_timeout+0x34e/0x610
[ 1552.190925]  ? del_timer_sync+0x130/0x130
[ 1552.191684]  ? i915_init_ggtt+0x40/0x6b0
[ 1552.192490]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1552.193293]  ? rcu_gp_init+0x730/0x730
[ 1552.193945]  rcu_gp_kthread+0xdd/0x170
[ 1552.194693]  kthread+0x1e7/0x230
[ 1552.195291]  ? set_kthread_struct+0x80/0x80
[ 1552.196076]  ret_from_fork+0x1f/0x30
[ 1552.197058] CPU: 1 PID: 23072 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1552.197398] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1552.198081] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1552.198103] Call Trace:
[ 1552.198132]  dump_stack_lvl+0xa4/0xd3
[ 1552.198197]  dump_stack+0x15/0x17
[ 1552.199317] caller is debug_smp_processor_id+0x1c/0x20
[ 1552.200825]  check_preemption_disabled+0x167/0x180
[ 1552.203498]  ? __get_locked_pte+0x1a2/0x290
[ 1552.204097]  ? __lock_text_start+0x8/0x8
[ 1552.204694]  debug_smp_processor_id+0x1c/0x20
[ 1552.205330]  perf_ftrace_function_call+0x7c/0x360
[ 1552.206027]  ? ftrace_ops_test+0x71/0xc0
[ 1552.206633]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1552.207311]  ? text_poke+0x2b/0x60
[ 1552.207822]  ? perf_ftrace_function_call+0x4c/0x360
[ 1552.208533]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1552.209231]  ? ftrace_ops_test+0x71/0xc0
[ 1552.209807]  ? write_comp_data+0x2f/0x90
[ 1552.210401]  ? perf_trace_buf_update+0x70/0x70
[ 1552.211114]  0xffffffffa009a099
[ 1552.211619]  ? devlink_fmsg_bool_put+0x70/0x70
[ 1552.212284]  ? ftrace_call+0x5/0x44
[ 1552.212823]  ? pmd_page_vaddr+0x2b/0x70
[ 1552.213416]  ? _raw_spin_lock+0x5/0x50
[ 1552.214009]  _raw_spin_lock+0x5/0x50
[ 1552.214562]  __get_locked_pte+0x1a2/0x290
[ 1552.215193]  ? _raw_spin_lock+0x5/0x50
[ 1552.215787]  ? __get_locked_pte+0x1a2/0x290
[ 1552.216433]  ? devlink_fmsg_bool_put+0x70/0x70
[ 1552.217096]  __text_poke+0xea/0x4e0
[ 1552.217617]  ? devlink_fmsg_bool_put+0x70/0x70
[ 1552.218295]  ? lock_is_held_type+0xe2/0x140
[ 1552.218917]  ? devlink_fmsg_bool_put+0x70/0x70
[ 1552.219612]  text_poke+0x2b/0x60
[ 1552.220130]  text_poke_bp_batch+0x93/0x2c0
[ 1552.220767]  ? gro_cells_init+0xe0/0xe0
[ 1552.221370]  text_poke_queue+0xa7/0xc0
[ 1552.221963]  ftrace_replace_code+0xfd/0x170
[ 1552.222628]  ftrace_modify_all_code+0x1b1/0x270
[ 1552.223323]  arch_ftrace_update_code+0x9/0x10
[ 1552.223958]  ftrace_run_update_code+0x30/0xa0
[ 1552.224611]  ftrace_startup_enable+0x5e/0xa0
[ 1552.225252]  ftrace_startup+0x16d/0x240
[ 1552.225882]  register_ftrace_function+0x43/0x90
[ 1552.226565]  perf_ftrace_event_register+0xc1/0xf0
[ 1552.227263]  perf_trace_event_init+0xa0/0x4c0
[ 1552.227944]  perf_trace_init+0xda/0x160
[ 1552.228557]  perf_tp_event_init+0x57/0xa0
[ 1552.229164]  perf_try_init_event+0x83/0x270
[ 1552.229831]  perf_event_alloc+0xe3f/0x1c10
[ 1552.230432]  ? _raw_spin_unlock+0x2c/0x50
[ 1552.231031]  ? alloc_fd+0x20d/0x320
[ 1552.231644]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1552.232353]  ? write_comp_data+0x2f/0x90
[ 1552.233226]  __x64_sys_perf_event_open+0x26/0x30
[ 1552.233902]  do_syscall_64+0x37/0x80
[ 1552.234451]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1552.235167] RIP: 0033:0x7fac0740459d
[ 1552.235696] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1552.238163] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1552.239207] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1552.240176] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1552.241146] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1552.242126] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1552.243116] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1552.244284] CPU: 0 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1552.244396] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23072
[ 1552.245401] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1552.246532] caller is debug_smp_processor_id+0x1c/0x20
[ 1552.248025] Call Trace:
[ 1552.249110]  dump_stack_lvl+0xa4/0xd3
[ 1552.249727]  dump_stack+0x15/0x17
[ 1552.250268]  check_preemption_disabled+0x167/0x180
[ 1552.251063]  debug_smp_processor_id+0x1c/0x20
[ 1552.251738]  perf_trace_buf_alloc+0x98/0x100
[ 1552.252402]  ? lock_timer_base+0x34/0x100
[ 1552.253016]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1552.253726]  perf_ftrace_function_call+0x209/0x360
[ 1552.254691]  ? 0xffffffffa009a099
[ 1552.255351]  0xffffffffa009a099
[ 1552.255938]  ? ftrace_call+0x5/0x44
[ 1552.256517]  ? lock_timer_base+0xc0/0x100
[ 1552.257178]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1552.257863]  ? write_comp_data+0x2f/0x90
[ 1552.258510]  _raw_spin_lock_irqsave+0x5/0x70
[ 1552.259175]  lock_timer_base+0x34/0x100
[ 1552.259779]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1552.260453]  ? lock_timer_base+0x34/0x100
[ 1552.261152]  try_to_del_timer_sync+0x33/0x90
[ 1552.261804]  ? try_to_del_timer_sync+0x5/0x90
[ 1552.262518]  del_timer_sync+0xd3/0x130
[ 1552.263147]  schedule_timeout+0x34e/0x610
[ 1552.263848]  ? del_timer_sync+0x130/0x130
[ 1552.264526]  ? i915_init_ggtt+0x40/0x6b0
[ 1552.265227]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1552.265928]  ? rcu_gp_init+0x730/0x730
[ 1552.266524]  rcu_gp_kthread+0xdd/0x170
[ 1552.267176]  kthread+0x1e7/0x230
[ 1552.267712]  ? set_kthread_struct+0x80/0x80
[ 1552.268413]  ret_from_fork+0x1f/0x30
[ 1552.269224] CPU: 1 PID: 23072 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1552.269415] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1552.270248] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1552.270270] Call Trace:
[ 1552.270297]  dump_stack_lvl+0xa4/0xd3
[ 1552.270364]  dump_stack+0x15/0x17
[ 1552.271484] caller is debug_smp_processor_id+0x1c/0x20
[ 1552.272990]  check_preemption_disabled+0x167/0x180
[ 1552.275666]  ? __get_locked_pte+0x1a2/0x290
[ 1552.276267]  ? __lock_text_start+0x8/0x8
[ 1552.276862]  debug_smp_processor_id+0x1c/0x20
[ 1552.277497]  perf_ftrace_function_call+0x7c/0x360
[ 1552.278200]  ? ftrace_ops_test+0x71/0xc0
[ 1552.278795]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1552.279472]  ? text_poke+0x2b/0x60
[ 1552.279981]  ? perf_ftrace_function_call+0x4c/0x360
[ 1552.280692]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1552.281388]  ? ftrace_ops_test+0x71/0xc0
[ 1552.281964]  ? write_comp_data+0x2f/0x90
[ 1552.282554]  ? perf_trace_buf_update+0x70/0x70
[ 1552.283265]  0xffffffffa009a099
[ 1552.283765]  ? devlink_fmsg_u8_put+0x70/0x70
[ 1552.284406]  ? ftrace_call+0x5/0x44
[ 1552.284945]  ? pmd_page_vaddr+0x2b/0x70
[ 1552.285537]  ? _raw_spin_lock+0x5/0x50
[ 1552.286135]  _raw_spin_lock+0x5/0x50
[ 1552.286670]  __get_locked_pte+0x1a2/0x290
[ 1552.287258]  ? _raw_spin_lock+0x5/0x50
[ 1552.287804]  ? __get_locked_pte+0x1a2/0x290
[ 1552.288432]  ? devlink_fmsg_u8_put+0x70/0x70
[ 1552.289073]  __text_poke+0xea/0x4e0
[ 1552.289594]  ? devlink_fmsg_u8_put+0x70/0x70
[ 1552.290238]  ? lock_is_held_type+0xe2/0x140
[ 1552.290859]  ? devlink_fmsg_u8_put+0x70/0x70
[ 1552.291519]  text_poke+0x2b/0x60
[ 1552.292034]  text_poke_bp_batch+0x93/0x2c0
[ 1552.292671]  ? gro_cells_init+0xe0/0xe0
[ 1552.293273]  text_poke_queue+0xa7/0xc0
[ 1552.293867]  ftrace_replace_code+0xfd/0x170
[ 1552.294528]  ftrace_modify_all_code+0x1b1/0x270
[ 1552.295228]  arch_ftrace_update_code+0x9/0x10
[ 1552.295869]  ftrace_run_update_code+0x30/0xa0
[ 1552.296545]  ftrace_startup_enable+0x5e/0xa0
[ 1552.297207]  ftrace_startup+0x16d/0x240
[ 1552.297847]  register_ftrace_function+0x43/0x90
[ 1552.298575]  perf_ftrace_event_register+0xc1/0xf0
[ 1552.299328]  perf_trace_event_init+0xa0/0x4c0
[ 1552.300057]  perf_trace_init+0xda/0x160
[ 1552.300705]  perf_tp_event_init+0x57/0xa0
[ 1552.301358]  perf_try_init_event+0x83/0x270
[ 1552.302097]  perf_event_alloc+0xe3f/0x1c10
[ 1552.302745]  ? _raw_spin_unlock+0x2c/0x50
[ 1552.303384]  ? alloc_fd+0x20d/0x320
[ 1552.304048]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1552.304815]  ? write_comp_data+0x2f/0x90
[ 1552.305754]  __x64_sys_perf_event_open+0x26/0x30
[ 1552.306465]  do_syscall_64+0x37/0x80
[ 1552.307008]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1552.307725] RIP: 0033:0x7fac0740459d
[ 1552.308253] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1552.310723] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1552.311777] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1552.312746] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1552.313716] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1552.314700] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1552.315671] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1552.316839] CPU: 0 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1552.316968] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23072
[ 1552.317977] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1552.318005] Call Trace:
[ 1552.318057]  dump_stack_lvl+0xa4/0xd3
[ 1552.319120] caller is debug_smp_processor_id+0x1c/0x20
[ 1552.320744]  dump_stack+0x15/0x17
[ 1552.322819]  check_preemption_disabled+0x167/0x180
[ 1552.323614]  debug_smp_processor_id+0x1c/0x20
[ 1552.324290]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1552.325128]  perf_tp_event+0x331/0x4e0
[ 1552.325922]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1552.326850]  ? trace_hardirqs_on+0x3f/0x170
[ 1552.327535]  ? arch_local_irq_enable+0x10/0x12
[ 1552.328231]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1552.328983]  ? dump_stack_lvl+0xcc/0xd3
[ 1552.329657]  ? lock_timer_base+0x34/0x100
[ 1552.330278]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1552.330998]  perf_ftrace_function_call+0x248/0x360
[ 1552.331743]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1552.332427]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1552.333145]  ? perf_ftrace_function_call+0x248/0x360
[ 1552.334159]  ? 0xffffffffa009a099
[ 1552.334820]  0xffffffffa009a099
[ 1552.335408]  ? ftrace_call+0x5/0x44
[ 1552.335989]  ? lock_timer_base+0xc0/0x100
[ 1552.336651]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1552.337338]  ? write_comp_data+0x2f/0x90
[ 1552.337976]  _raw_spin_lock_irqsave+0x5/0x70
[ 1552.338649]  lock_timer_base+0x34/0x100
[ 1552.339251]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1552.339924]  ? lock_timer_base+0x34/0x100
[ 1552.340621]  try_to_del_timer_sync+0x33/0x90
[ 1552.341269]  ? try_to_del_timer_sync+0x5/0x90
[ 1552.341979]  del_timer_sync+0xd3/0x130
[ 1552.342638]  schedule_timeout+0x34e/0x610
[ 1552.343337]  ? del_timer_sync+0x130/0x130
[ 1552.344009]  ? i915_init_ggtt+0x40/0x6b0
[ 1552.344709]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1552.345406]  ? rcu_gp_init+0x730/0x730
[ 1552.345994]  rcu_gp_kthread+0xdd/0x170
[ 1552.346653]  kthread+0x1e7/0x230
[ 1552.347189]  ? set_kthread_struct+0x80/0x80
[ 1552.347886]  ret_from_fork+0x1f/0x30
[ 1552.348696] CPU: 1 PID: 23072 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1552.348904] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1552.349714] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1552.351047] caller is debug_smp_processor_id+0x1c/0x20
[ 1552.352430] Call Trace:
[ 1552.353578]  dump_stack_lvl+0xa4/0xd3
[ 1552.354159]  dump_stack+0x15/0x17
[ 1552.354659]  check_preemption_disabled+0x167/0x180
[ 1552.355348]  ? __get_locked_pte+0x1a2/0x290
[ 1552.355949]  ? __lock_text_start+0x8/0x8
[ 1552.356545]  debug_smp_processor_id+0x1c/0x20
[ 1552.357179]  perf_ftrace_function_call+0x7c/0x360
[ 1552.357877]  ? ftrace_ops_test+0x71/0xc0
[ 1552.358476]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1552.359152]  ? text_poke+0x2b/0x60
[ 1552.359662]  ? perf_ftrace_function_call+0x4c/0x360
[ 1552.360371]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1552.361066]  ? ftrace_ops_test+0x71/0xc0
[ 1552.361642]  ? write_comp_data+0x2f/0x90
[ 1552.362230]  ? perf_trace_buf_update+0x70/0x70
[ 1552.362942]  0xffffffffa009a099
[ 1552.363443]  ? devlink_fmsg_u32_put+0x70/0x70
[ 1552.364098]  ? ftrace_call+0x5/0x44
[ 1552.364639]  ? pmd_page_vaddr+0x2b/0x70
[ 1552.365233]  ? _raw_spin_lock+0x5/0x50
[ 1552.365826]  _raw_spin_lock+0x5/0x50
[ 1552.366364]  __get_locked_pte+0x1a2/0x290
[ 1552.366953]  ? _raw_spin_lock+0x5/0x50
[ 1552.367500]  ? __get_locked_pte+0x1a2/0x290
[ 1552.368128]  ? devlink_fmsg_u32_put+0x70/0x70
[ 1552.368780]  __text_poke+0xea/0x4e0
[ 1552.369303]  ? devlink_fmsg_u32_put+0x70/0x70
[ 1552.369957]  ? lock_is_held_type+0xe2/0x140
[ 1552.370583]  ? devlink_fmsg_u32_put+0x70/0x70
[ 1552.371254]  text_poke+0x2b/0x60
[ 1552.371770]  text_poke_bp_batch+0x93/0x2c0
[ 1552.372407]  ? gro_cells_init+0xe0/0xe0
[ 1552.373011]  text_poke_queue+0xa7/0xc0
[ 1552.373606]  ftrace_replace_code+0xfd/0x170
[ 1552.374267]  ftrace_modify_all_code+0x1b1/0x270
[ 1552.374961]  arch_ftrace_update_code+0x9/0x10
[ 1552.375593]  ftrace_run_update_code+0x30/0xa0
[ 1552.376245]  ftrace_startup_enable+0x5e/0xa0
[ 1552.376885]  ftrace_startup+0x16d/0x240
[ 1552.377516]  register_ftrace_function+0x43/0x90
[ 1552.378194]  perf_ftrace_event_register+0xc1/0xf0
[ 1552.378892]  perf_trace_event_init+0xa0/0x4c0
[ 1552.379573]  perf_trace_init+0xda/0x160
[ 1552.380177]  perf_tp_event_init+0x57/0xa0
[ 1552.380785]  perf_try_init_event+0x83/0x270
[ 1552.381454]  perf_event_alloc+0xe3f/0x1c10
[ 1552.382050]  ? _raw_spin_unlock+0x2c/0x50
[ 1552.382649]  ? alloc_fd+0x20d/0x320
[ 1552.383263]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1552.383971]  ? write_comp_data+0x2f/0x90
[ 1552.384844]  __x64_sys_perf_event_open+0x26/0x30
[ 1552.385521]  do_syscall_64+0x37/0x80
[ 1552.386066]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1552.386781] RIP: 0033:0x7fac0740459d
[ 1552.387310] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1552.389770] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1552.390820] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1552.391790] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1552.392760] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1552.393731] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1552.394704] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1552.395872] CPU: 0 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1552.397078] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1552.398803] Call Trace:
[ 1552.399264]  dump_stack_lvl+0xa4/0xd3
[ 1552.399959]  dump_stack+0x15/0x17
[ 1552.400551]  check_preemption_disabled+0x167/0x180
[ 1552.401356]  ? prepare_to_swait_event+0x1b/0xf0
[ 1552.402111]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1552.402911]  debug_smp_processor_id+0x1c/0x20
[ 1552.403654]  perf_ftrace_function_call+0x7c/0x360
[ 1552.404676]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1552.405458]  ? write_comp_data+0x2f/0x90
[ 1552.406159]  ? perf_trace_buf_update+0x70/0x70
[ 1552.406916]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1552.407844]  0xffffffffa009a099
[ 1552.408495]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1552.409357]  ? del_timer_sync+0xde/0x130
[ 1552.410095]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1552.410921]  _raw_spin_lock_irqsave+0x5/0x70
[ 1552.411659]  prepare_to_swait_event+0x1b/0xf0
[ 1552.412401]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1552.413139]  ? prepare_to_swait_event+0x1b/0xf0
[ 1552.413957]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1552.414765]  ? rcu_gp_init+0x730/0x730
[ 1552.415418]  rcu_gp_kthread+0xdd/0x170
[ 1552.416159]  kthread+0x1e7/0x230
[ 1552.416759]  ? set_kthread_struct+0x80/0x80
[ 1552.417547]  ret_from_fork+0x1f/0x30
[ 1557.046084] check_preemption_disabled: 3174990 callbacks suppressed
[ 1557.046111] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1557.046568] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1557.047076] caller is debug_smp_processor_id+0x1c/0x20
[ 1557.048029] caller is debug_smp_processor_id+0x1c/0x20
[ 1557.049093] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1557.051475] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1557.053060] Call Trace:
[ 1557.053460]  dump_stack_lvl+0xa4/0xd3
[ 1557.054069]  dump_stack+0x15/0x17
[ 1557.054593]  check_preemption_disabled+0x167/0x180
[ 1557.055369]  debug_smp_processor_id+0x1c/0x20
[ 1557.056032]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1557.056887]  perf_trace_buf_alloc+0x3d/0x100
[ 1557.057540]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1557.058255]  ? cea_set_pte+0x140/0x140
[ 1557.058849]  perf_ftrace_function_call+0x209/0x360
[ 1557.059778]  ? 0xffffffffa0098099
[ 1557.060383]  ? kprobe_seq_next+0x50/0x50
[ 1557.061001]  0xffffffffa0098099
[ 1557.061593]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1557.062389]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1557.063088]  ? kprobe_seq_next+0x50/0x50
[ 1557.063693]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1557.064484]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1557.065274]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1557.065961]  copy_from_kernel_nofault_allowed+0x5/0x80
[ 1557.066733]  copy_from_kernel_nofault+0x2f/0x220
[ 1557.067432]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1557.068213]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1557.069011]  ftrace_verify_code+0x2c/0x70
[ 1557.069661]  ftrace_replace_code+0x69/0x170
[ 1557.070359]  ftrace_modify_all_code+0x1b1/0x270
[ 1557.071087]  arch_ftrace_update_code+0x9/0x10
[ 1557.071749]  ftrace_run_update_code+0x30/0xa0
[ 1557.072433]  ftrace_startup_enable+0x5e/0xa0
[ 1557.073107]  ftrace_startup+0x16d/0x240
[ 1557.073775]  register_ftrace_function+0x43/0x90
[ 1557.074488]  perf_ftrace_event_register+0xc1/0xf0
[ 1557.075222]  perf_trace_event_init+0xa0/0x4c0
[ 1557.075940]  perf_trace_init+0xda/0x160
[ 1557.076577]  perf_tp_event_init+0x57/0xa0
[ 1557.077216]  perf_try_init_event+0x83/0x270
[ 1557.077922]  perf_event_alloc+0xe3f/0x1c10
[ 1557.078546]  ? _raw_spin_unlock+0x2c/0x50
[ 1557.079175]  ? alloc_fd+0x20d/0x320
[ 1557.079828]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1557.080571]  ? write_comp_data+0x2f/0x90
[ 1557.081518]  __x64_sys_perf_event_open+0x26/0x30
[ 1557.082233]  do_syscall_64+0x37/0x80
[ 1557.082802]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1557.083549] RIP: 0033:0x7fac0740459d
[ 1557.084105] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1557.086661] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1557.087755] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1557.088765] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1557.089774] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1557.090786] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1557.091797] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1557.093034] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1557.093143] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1557.093927] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1557.095028] caller is debug_smp_processor_id+0x1c/0x20
[ 1557.096296] Call Trace:
[ 1557.096305]  dump_stack_lvl+0xa4/0xd3
[ 1557.097726]  dump_stack+0x15/0x17
[ 1557.098155]  check_preemption_disabled+0x167/0x180
[ 1557.098754]  ? do_nanosleep+0x123/0x2a0
[ 1557.099239]  ? ___might_sleep+0x170/0x170
[ 1557.099750]  debug_smp_processor_id+0x1c/0x20
[ 1557.100295]  perf_ftrace_function_call+0x7c/0x360
[ 1557.100892]  ? 0xffffffffa0098099
[ 1557.101314]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1557.101916]  ? finish_task_switch+0xab/0x2a0
[ 1557.102456]  ? __schedule+0x46e/0xb20
[ 1557.102934]  ? do_nanosleep+0x9c/0x2a0
[ 1557.103412]  0xffffffffa0098099
[ 1557.103816]  ? finish_task_switch+0xb0/0x2a0
[ 1557.104361]  ? do_nanosleep+0x107/0x2a0
[ 1557.104852]  ? __might_sleep+0x5/0x70
[ 1557.105317]  ? write_comp_data+0x2f/0x90
[ 1557.105814]  __might_sleep+0x5/0x70
[ 1557.106262]  do_nanosleep+0x123/0x2a0
[ 1557.106728]  ? __might_sleep+0x5/0x70
[ 1557.107191]  ? do_nanosleep+0x123/0x2a0
[ 1557.107675]  ? write_comp_data+0x2f/0x90
[ 1557.108181]  hrtimer_nanosleep+0xf7/0x1b0
[ 1557.108698]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1557.109280]  __x64_sys_nanosleep+0xfc/0x150
[ 1557.109819]  do_syscall_64+0x37/0x80
[ 1557.110279]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1557.110908] RIP: 0033:0x7fac073cca18
[ 1557.111359] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1557.113575] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1557.114498] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1557.115360] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1557.116220] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1557.117080] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1557.117940] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1557.118839] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1557.118865] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1557.119819] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1557.120731] caller is debug_smp_processor_id+0x1c/0x20
[ 1557.122185] Call Trace:
[ 1557.122204]  dump_stack_lvl+0xa4/0xd3
[ 1557.123659]  dump_stack+0x15/0x17
[ 1557.124127]  check_preemption_disabled+0x167/0x180
[ 1557.124808]  debug_smp_processor_id+0x1c/0x20
[ 1557.125409]  perf_trace_buf_alloc+0x98/0x100
[ 1557.125998]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1557.126650]  ? cea_set_pte+0x140/0x140
[ 1557.127176]  perf_ftrace_function_call+0x209/0x360
[ 1557.127931]  ? 0xffffffffa0098099
[ 1557.128435]  ? kprobe_seq_next+0x50/0x50
[ 1557.128984]  0xffffffffa0098099
[ 1557.129473]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1557.130191]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1557.130815]  ? kprobe_seq_next+0x50/0x50
[ 1557.131358]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1557.132072]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1557.132789]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1557.133406]  copy_from_kernel_nofault_allowed+0x5/0x80
[ 1557.134104]  copy_from_kernel_nofault+0x2f/0x220
[ 1557.134735]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1557.135445]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1557.136135]  ftrace_verify_code+0x2c/0x70
[ 1557.136705]  ftrace_replace_code+0x69/0x170
[ 1557.137307]  ftrace_modify_all_code+0x1b1/0x270
[ 1557.137947]  arch_ftrace_update_code+0x9/0x10
[ 1557.138548]  ftrace_run_update_code+0x30/0xa0
[ 1557.139154]  ftrace_startup_enable+0x5e/0xa0
[ 1557.139751]  ftrace_startup+0x16d/0x240
[ 1557.140321]  register_ftrace_function+0x43/0x90
[ 1557.140951]  perf_ftrace_event_register+0xc1/0xf0
[ 1557.141604]  perf_trace_event_init+0xa0/0x4c0
[ 1557.142234]  perf_trace_init+0xda/0x160
[ 1557.142789]  perf_tp_event_init+0x57/0xa0
[ 1557.143355]  perf_try_init_event+0x83/0x270
[ 1557.143965]  perf_event_alloc+0xe3f/0x1c10
[ 1557.144526]  ? _raw_spin_unlock+0x2c/0x50
[ 1557.145087]  ? alloc_fd+0x20d/0x320
[ 1557.145627]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1557.146293]  ? write_comp_data+0x2f/0x90
[ 1557.147005]  __x64_sys_perf_event_open+0x26/0x30
[ 1557.147640]  do_syscall_64+0x37/0x80
[ 1557.148145]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1557.148828] RIP: 0033:0x7fac0740459d
[ 1557.149323] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1557.151693] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1557.152689] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1557.153614] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1557.154544] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1557.155470] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1557.156397] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1557.157436] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1557.157645] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1557.158328] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1557.158338] Call Trace:
[ 1557.158345]  dump_stack_lvl+0xa4/0xd3
[ 1557.158366]  dump_stack+0x15/0x17
[ 1557.158380]  check_preemption_disabled+0x167/0x180
[ 1557.158398]  ? __might_sleep+0x48/0x70
[ 1557.158411]  ? sched_show_task+0x70/0x70
[ 1557.159408] caller is debug_smp_processor_id+0x1c/0x20
[ 1557.160766]  debug_smp_processor_id+0x1c/0x20
[ 1557.164597]  perf_ftrace_function_call+0x7c/0x360
[ 1557.165181]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1557.165766]  ? do_nanosleep+0x123/0x2a0
[ 1557.166254]  ? perf_ftrace_function_call+0x4c/0x360
[ 1557.166867]  ? 0xffffffffa0098099
[ 1557.167286]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1557.167886]  ? finish_task_switch+0xab/0x2a0
[ 1557.168417]  ? __schedule+0x46e/0xb20
[ 1557.168884]  ? do_nanosleep+0x9c/0x2a0
[ 1557.169360]  0xffffffffa0098099
[ 1557.169760]  ? do_nanosleep+0x9c/0x2a0
[ 1557.170251]  ? do_nanosleep+0x107/0x2a0
[ 1557.170741]  ? ___might_sleep+0x5/0x170
[ 1557.171231]  ___might_sleep+0x5/0x170
[ 1557.171695]  __might_sleep+0x48/0x70
[ 1557.172148]  ? ___might_sleep+0x5/0x170
[ 1557.172630]  ? __might_sleep+0x48/0x70
[ 1557.173108]  do_nanosleep+0x123/0x2a0
[ 1557.173570]  ? write_comp_data+0x2f/0x90
[ 1557.174077]  hrtimer_nanosleep+0xf7/0x1b0
[ 1557.174591]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1557.175172]  __x64_sys_nanosleep+0xfc/0x150
[ 1557.175707]  do_syscall_64+0x37/0x80
[ 1557.176161]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1557.176788] RIP: 0033:0x7fac073cca18
[ 1557.177236] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1557.179448] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1557.180367] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1557.181226] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1557.182088] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1557.182946] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1557.183805] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1557.184697] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1557.184753] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1557.185673] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1557.186604] caller is debug_smp_processor_id+0x1c/0x20
[ 1557.188028] Call Trace:
[ 1557.188988]  dump_stack_lvl+0xa4/0xd3
[ 1557.189515]  dump_stack+0x15/0x17
[ 1557.189984]  check_preemption_disabled+0x167/0x180
[ 1557.190668]  debug_smp_processor_id+0x1c/0x20
[ 1557.191266]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1557.192005]  perf_tp_event+0x331/0x4e0
[ 1557.192677]  ? arch_local_irq_enable+0x10/0x12
[ 1557.193291]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1557.193941]  ? dump_stack_lvl+0xcc/0xd3
[ 1557.194497]  ? dump_stack+0x15/0x17
[ 1557.194988]  ? check_preemption_disabled+0x167/0x180
[ 1557.195690]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1557.196337]  ? cea_set_pte+0x140/0x140
[ 1557.196868]  perf_ftrace_function_call+0x248/0x360
[ 1557.197515]  ? perf_ftrace_function_call+0x248/0x360
[ 1557.198303]  ? 0xffffffffa0098099
[ 1557.198806]  ? kprobe_seq_next+0x50/0x50
[ 1557.199357]  0xffffffffa0098099
[ 1557.199846]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1557.200562]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1557.201183]  ? kprobe_seq_next+0x50/0x50
[ 1557.201728]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1557.202468]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1557.203182]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1557.203797]  copy_from_kernel_nofault_allowed+0x5/0x80
[ 1557.204491]  copy_from_kernel_nofault+0x2f/0x220
[ 1557.205122]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1557.205830]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1557.206520]  ftrace_verify_code+0x2c/0x70
[ 1557.207087]  ftrace_replace_code+0x69/0x170
[ 1557.207686]  ftrace_modify_all_code+0x1b1/0x270
[ 1557.208324]  arch_ftrace_update_code+0x9/0x10
[ 1557.208917]  ftrace_run_update_code+0x30/0xa0
[ 1557.209523]  ftrace_startup_enable+0x5e/0xa0
[ 1557.210120]  ftrace_startup+0x16d/0x240
[ 1557.210689]  register_ftrace_function+0x43/0x90
[ 1557.211317]  perf_ftrace_event_register+0xc1/0xf0
[ 1557.211966]  perf_trace_event_init+0xa0/0x4c0
[ 1557.212590]  perf_trace_init+0xda/0x160
[ 1557.213144]  perf_tp_event_init+0x57/0xa0
[ 1557.213707]  perf_try_init_event+0x83/0x270
[ 1557.214317]  perf_event_alloc+0xe3f/0x1c10
[ 1557.214877]  ? _raw_spin_unlock+0x2c/0x50
[ 1557.215435]  ? alloc_fd+0x20d/0x320
[ 1557.215975]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1557.216635]  ? write_comp_data+0x2f/0x90
[ 1557.217351]  __x64_sys_perf_event_open+0x26/0x30
[ 1557.217982]  do_syscall_64+0x37/0x80
[ 1557.218489]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1557.219166] RIP: 0033:0x7fac0740459d
[ 1557.219660] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1557.222015] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1557.223010] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1557.223931] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1557.224854] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1557.225775] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1557.226700] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1557.227738] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1557.227889] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1557.228628] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1557.229706] caller is debug_smp_processor_id+0x1c/0x20
[ 1557.231058] Call Trace:
[ 1557.231067]  dump_stack_lvl+0xa4/0xd3
[ 1557.231088]  dump_stack+0x15/0x17
[ 1557.231102]  check_preemption_disabled+0x167/0x180
[ 1557.231120]  ? do_nanosleep+0x155/0x2a0
[ 1557.231134]  ? hrtimer_wakeup+0x40/0x40
[ 1557.231154]  debug_smp_processor_id+0x1c/0x20
[ 1557.235066]  perf_ftrace_function_call+0x7c/0x360
[ 1557.235659]  ? 0xffffffffa0098099
[ 1557.236078]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1557.236679]  ? finish_task_switch+0xab/0x2a0
[ 1557.237211]  ? __schedule+0x46e/0xb20
[ 1557.237679]  ? do_nanosleep+0x9c/0x2a0
[ 1557.238161]  ? do_nanosleep+0x9c/0x2a0
[ 1557.238637]  0xffffffffa0098099
[ 1557.239041]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1557.239627]  ? lock_is_held_type+0xe2/0x140
[ 1557.240156]  ? do_nanosleep+0x140/0x2a0
[ 1557.240645]  ? hrtimer_try_to_cancel+0x5/0x290
[ 1557.241200]  ? write_comp_data+0x2f/0x90
[ 1557.241697]  hrtimer_try_to_cancel+0x5/0x290
[ 1557.242236]  do_nanosleep+0x155/0x2a0
[ 1557.242701]  ? hrtimer_try_to_cancel+0x5/0x290
[ 1557.243254]  ? do_nanosleep+0x155/0x2a0
[ 1557.243736]  ? write_comp_data+0x2f/0x90
[ 1557.244239]  hrtimer_nanosleep+0xf7/0x1b0
[ 1557.244753]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1557.245334]  __x64_sys_nanosleep+0xfc/0x150
[ 1557.245870]  do_syscall_64+0x37/0x80
[ 1557.246328]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1557.246954] RIP: 0033:0x7fac073cca18
[ 1557.247403] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1557.249611] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1557.250531] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1557.251390] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1557.252248] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1557.253107] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1557.253964] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1557.254857] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1557.254883] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1557.255912] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1557.256820] caller is debug_smp_processor_id+0x1c/0x20
[ 1557.258394] Call Trace:
[ 1557.258428]  dump_stack_lvl+0xa4/0xd3
[ 1557.259967]  dump_stack+0x15/0x17
[ 1557.260491]  check_preemption_disabled+0x167/0x180
[ 1557.261212]  ? ftrace_verify_code+0x2c/0x70
[ 1557.261838]  ? copy_to_user_nofault+0x150/0x150
[ 1557.262556]  debug_smp_processor_id+0x1c/0x20
[ 1557.263223]  perf_ftrace_function_call+0x7c/0x360
[ 1557.264042]  ? 0xffffffffa0098099
[ 1557.264646]  ? kprobe_seq_next+0x50/0x50
[ 1557.265263]  ? 0xffffffffa0098099
[ 1557.265867]  0xffffffffa0098099
[ 1557.266370]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1557.267160]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1557.267855]  ? kprobe_seq_next+0x50/0x50
[ 1557.268450]  ? kprobe_seq_next+0x50/0x50
[ 1557.269067]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1557.269857]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1557.270554]  ? kprobe_seq_stop+0x10/0x30
[ 1557.271170]  ? copy_from_kernel_nofault+0x5/0x220
[ 1557.271923]  copy_from_kernel_nofault+0x5/0x220
[ 1557.272610]  ftrace_verify_code+0x2c/0x70
[ 1557.273227]  ? copy_from_kernel_nofault+0x5/0x220
[ 1557.273925]  ? ftrace_verify_code+0x2c/0x70
[ 1557.274602]  ftrace_replace_code+0x69/0x170
[ 1557.275314]  ftrace_modify_all_code+0x1b1/0x270
[ 1557.276044]  arch_ftrace_update_code+0x9/0x10
[ 1557.276724]  ftrace_run_update_code+0x30/0xa0
[ 1557.277411]  ftrace_startup_enable+0x5e/0xa0
[ 1557.278090]  ftrace_startup+0x16d/0x240
[ 1557.278762]  register_ftrace_function+0x43/0x90
[ 1557.279469]  perf_ftrace_event_register+0xc1/0xf0
[ 1557.280206]  perf_trace_event_init+0xa0/0x4c0
[ 1557.280924]  perf_trace_init+0xda/0x160
[ 1557.281562]  perf_tp_event_init+0x57/0xa0
[ 1557.282211]  perf_try_init_event+0x83/0x270
[ 1557.282916]  perf_event_alloc+0xe3f/0x1c10
[ 1557.283535]  ? _raw_spin_unlock+0x2c/0x50
[ 1557.284162]  ? alloc_fd+0x20d/0x320
[ 1557.284814]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1557.285556]  ? write_comp_data+0x2f/0x90
[ 1557.286511]  __x64_sys_perf_event_open+0x26/0x30
[ 1557.287218]  do_syscall_64+0x37/0x80
[ 1557.287787]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1557.288532] RIP: 0033:0x7fac0740459d
[ 1557.289089] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1557.291641] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1557.292729] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1557.293736] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1557.294755] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1557.295762] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1557.296769] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1557.298002] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1557.298301] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1557.298900] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1557.299987] caller is debug_smp_processor_id+0x1c/0x20
[ 1557.301333] Call Trace:
[ 1557.301341]  dump_stack_lvl+0xa4/0xd3
[ 1557.302824]  dump_stack+0x15/0x17
[ 1557.303248]  check_preemption_disabled+0x167/0x180
[ 1557.303846]  ? hrtimer_try_to_cancel+0x38/0x290
[ 1557.304413]  ? __hrtimer_get_remaining+0x80/0x80
[ 1557.304994]  debug_smp_processor_id+0x1c/0x20
[ 1557.305542]  perf_ftrace_function_call+0x7c/0x360
[ 1557.306140]  ? do_nanosleep+0x155/0x2a0
[ 1557.306630]  ? hrtimer_wakeup+0x40/0x40
[ 1557.307117]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1557.307702]  ? do_nanosleep+0x155/0x2a0
[ 1557.308189]  ? perf_ftrace_function_call+0x4c/0x360
[ 1557.308803]  ? 0xffffffffa0098099
[ 1557.309225]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1557.309830]  ? do_nanosleep+0x9c/0x2a0
[ 1557.310313]  0xffffffffa0098099
[ 1557.310712]  ? do_nanosleep+0x9c/0x2a0
[ 1557.311191]  ? do_nanosleep+0x9c/0x2a0
[ 1557.311673]  ? do_nanosleep+0x140/0x2a0
[ 1557.312162]  ? hrtimer_active+0x5/0xb0
[ 1557.312641]  ? do_nanosleep+0x140/0x2a0
[ 1557.313127]  hrtimer_active+0x5/0xb0
[ 1557.313582]  hrtimer_try_to_cancel+0x38/0x290
[ 1557.314132]  ? hrtimer_active+0x5/0xb0
[ 1557.314607]  ? hrtimer_try_to_cancel+0x38/0x290
[ 1557.315181]  ? do_nanosleep+0x9c/0x2a0
[ 1557.315658]  do_nanosleep+0x155/0x2a0
[ 1557.316121]  ? write_comp_data+0x2f/0x90
[ 1557.316627]  hrtimer_nanosleep+0xf7/0x1b0
[ 1557.317142]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1557.317724]  __x64_sys_nanosleep+0xfc/0x150
[ 1557.318265]  do_syscall_64+0x37/0x80
[ 1557.318722]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1557.319350] RIP: 0033:0x7fac073cca18
[ 1557.319800] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1557.322016] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1557.322939] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1557.323800] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1557.324660] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1557.325520] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1557.326382] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1557.327278] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1557.327306] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1557.328340] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1557.329249] caller is debug_smp_processor_id+0x1c/0x20
[ 1557.330824] Call Trace:
[ 1557.330858]  dump_stack_lvl+0xa4/0xd3
[ 1557.332399]  dump_stack+0x15/0x17
[ 1557.332926]  check_preemption_disabled+0x167/0x180
[ 1557.333707]  debug_smp_processor_id+0x1c/0x20
[ 1557.334379]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1557.335241]  perf_trace_buf_alloc+0x3d/0x100
[ 1557.335896]  ? ftrace_verify_code+0x2c/0x70
[ 1557.336527]  ? copy_to_user_nofault+0x150/0x150
[ 1557.337227]  perf_ftrace_function_call+0x209/0x360
[ 1557.338165]  ? 0xffffffffa0098099
[ 1557.338806]  0xffffffffa0098099
[ 1557.339302]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1557.340094]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1557.340795]  ? kprobe_seq_next+0x50/0x50
[ 1557.341390]  ? kprobe_seq_next+0x50/0x50
[ 1557.342007]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1557.342802]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1557.343488]  ? kprobe_seq_stop+0x10/0x30
[ 1557.344107]  ? copy_from_kernel_nofault+0x5/0x220
[ 1557.344863]  copy_from_kernel_nofault+0x5/0x220
[ 1557.345554]  ftrace_verify_code+0x2c/0x70
[ 1557.346176]  ? copy_from_kernel_nofault+0x5/0x220
[ 1557.346878]  ? ftrace_verify_code+0x2c/0x70
[ 1557.347552]  ftrace_replace_code+0x69/0x170
[ 1557.348250]  ftrace_modify_all_code+0x1b1/0x270
[ 1557.348982]  arch_ftrace_update_code+0x9/0x10
[ 1557.349647]  ftrace_run_update_code+0x30/0xa0
[ 1557.350338]  ftrace_startup_enable+0x5e/0xa0
[ 1557.351013]  ftrace_startup+0x16d/0x240
[ 1557.351684]  register_ftrace_function+0x43/0x90
[ 1557.352396]  perf_ftrace_event_register+0xc1/0xf0
[ 1557.353131]  perf_trace_event_init+0xa0/0x4c0
[ 1557.353853]  perf_trace_init+0xda/0x160
[ 1557.354498]  perf_tp_event_init+0x57/0xa0
[ 1557.355140]  perf_try_init_event+0x83/0x270
[ 1557.355849]  perf_event_alloc+0xe3f/0x1c10
[ 1557.356470]  ? _raw_spin_unlock+0x2c/0x50
[ 1557.357101]  ? alloc_fd+0x20d/0x320
[ 1557.357759]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1557.358508]  ? write_comp_data+0x2f/0x90
[ 1557.359465]  __x64_sys_perf_event_open+0x26/0x30
[ 1557.360175]  do_syscall_64+0x37/0x80
[ 1557.360748]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1557.361497] RIP: 0033:0x7fac0740459d
[ 1557.362056] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1557.364612] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1557.365710] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1557.366728] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1557.367741] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1557.368755] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1557.369767] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1557.371020] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1557.371912] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1557.373276] Call Trace:
[ 1557.373590]  dump_stack_lvl+0xa4/0xd3
[ 1557.374073]  dump_stack+0x15/0x17
[ 1557.374500]  check_preemption_disabled+0x167/0x180
[ 1557.375101]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1557.375687]  ? __bpf_trace_sys_enter+0x10/0x10
[ 1557.376247]  debug_smp_processor_id+0x1c/0x20
[ 1557.376795]  perf_ftrace_function_call+0x7c/0x360
[ 1557.377387]  ? write_comp_data+0x2f/0x90
[ 1557.377888]  ? write_comp_data+0x2f/0x90
[ 1557.378397]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1557.378987]  ? write_comp_data+0x2f/0x90
[ 1557.379487]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1557.380085]  0xffffffffa0098099
[ 1557.380490]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1557.381097]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1557.381775]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1557.382373]  syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1557.383031]  syscall_exit_to_user_mode+0xd/0x60
[ 1557.383599]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1557.384276]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1557.384867]  do_syscall_64+0x46/0x80
[ 1557.385322]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1557.385949] RIP: 0033:0x7fac073cca18
[ 1557.386410] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1557.388634] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1557.389554] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1557.390420] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1557.391281] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1557.392145] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1557.393006] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1562.050123] check_preemption_disabled: 1458811 callbacks suppressed
[ 1562.050150] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1562.052084] caller is debug_smp_processor_id+0x1c/0x20
[ 1562.052830] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1562.053855] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1562.055394] Call Trace:
[ 1562.055836]  dump_stack_lvl+0xa4/0xd3
[ 1562.056490]  dump_stack+0x15/0x17
[ 1562.057047]  check_preemption_disabled+0x167/0x180
[ 1562.057799]  ? __text_poke+0xea/0x4e0
[ 1562.058393]  ? __pmd_alloc+0x420/0x420
[ 1562.059041]  debug_smp_processor_id+0x1c/0x20
[ 1562.059735]  perf_ftrace_function_call+0x7c/0x360
[ 1562.060478]  ? text_poke+0x2b/0x60
[ 1562.061044]  ? perf_ftrace_function_call+0x4c/0x360
[ 1562.062150]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1562.062903]  ? find_get_pages_range_tag+0x1/0x7f0
[ 1562.063678]  0xffffffffa0098099
[ 1562.064258]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1562.064989]  ? do_sync_core+0x30/0x30
[ 1562.065730]  ? __get_locked_pte+0x5/0x290
[ 1562.066457]  __get_locked_pte+0x5/0x290
[ 1562.067082]  __text_poke+0xea/0x4e0
[ 1562.067661]  ? __get_locked_pte+0x5/0x290
[ 1562.068290]  ? __text_poke+0xea/0x4e0
[ 1562.068890]  ? find_get_pages_range_tag+0x1/0x7f0
[ 1562.069663]  ? lock_is_held_type+0xe2/0x140
[ 1562.070361]  ? find_get_pages_range_tag+0x1/0x7f0
[ 1562.071169]  text_poke+0x2b/0x60
[ 1562.071766]  text_poke_bp_batch+0xf5/0x2c0
[ 1562.072495]  ? oom_reaper+0xa20/0xa20
[ 1562.073166]  text_poke_queue+0xa7/0xc0
[ 1562.073852]  ftrace_replace_code+0xfd/0x170
[ 1562.074626]  ftrace_modify_all_code+0x1b1/0x270
[ 1562.075413]  arch_ftrace_update_code+0x9/0x10
[ 1562.076107]  ftrace_run_update_code+0x30/0xa0
[ 1562.076835]  ftrace_startup_enable+0x5e/0xa0
[ 1562.077552]  ftrace_startup+0x16d/0x240
[ 1562.078312]  register_ftrace_function+0x43/0x90
[ 1562.079064]  perf_ftrace_event_register+0xc1/0xf0
[ 1562.079839]  perf_trace_event_init+0xa0/0x4c0
[ 1562.080622]  perf_trace_init+0xda/0x160
[ 1562.081317]  perf_tp_event_init+0x57/0xa0
[ 1562.082002]  perf_try_init_event+0x83/0x270
[ 1562.082777]  perf_event_alloc+0xe3f/0x1c10
[ 1562.083386]  ? _raw_spin_unlock+0x2c/0x50
[ 1562.084018]  ? alloc_fd+0x20d/0x320
[ 1562.084732]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1562.085479]  ? write_comp_data+0x2f/0x90
[ 1562.086636]  __x64_sys_perf_event_open+0x26/0x30
[ 1562.087344]  do_syscall_64+0x37/0x80
[ 1562.087919]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1562.088685] RIP: 0033:0x7fac0740459d
[ 1562.089269] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1562.091755] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1562.092822] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1562.093805] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1562.094806] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1562.095782] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1562.096757] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1562.098393] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1562.098397] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1562.098431] caller is debug_smp_processor_id+0x1c/0x20
[ 1562.099515] caller is debug_smp_processor_id+0x1c/0x20
[ 1562.100573] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1562.102953] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1562.104366] Call Trace:
[ 1562.104721]  dump_stack_lvl+0xa4/0xd3
[ 1562.105258]  dump_stack+0x15/0x17
[ 1562.105724]  check_preemption_disabled+0x167/0x180
[ 1562.106372]  ? do_epoll_wait+0x3bf/0xd80
[ 1562.106903]  ? __ia32_sys_fanotify_init+0x5c0/0x5c0
[ 1562.107575]  debug_smp_processor_id+0x1c/0x20
[ 1562.108168]  perf_ftrace_function_call+0x7c/0x360
[ 1562.108847]  ? ftrace_call+0x5/0x44
[ 1562.109406]  ? do_epoll_wait+0x3b3/0xd80
[ 1562.109993]  ? preempt_count_sub+0x5/0xa0
[ 1562.110610]  0xffffffffa0098099
[ 1562.111060]  ? __mutex_lock+0xfe/0x9f0
[ 1562.111595]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1562.112328]  ? do_epoll_wait+0x3b3/0xd80
[ 1562.112914]  ? ep_start_scan+0x5/0x100
[ 1562.113470]  ep_start_scan+0x5/0x100
[ 1562.113969]  do_epoll_wait+0x3bf/0xd80
[ 1562.114493]  ? ep_start_scan+0x5/0x100
[ 1562.115001]  ? do_epoll_wait+0x3bf/0xd80
[ 1562.115696]  ? wait_woken+0x90/0x90
[ 1562.116257]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1562.116892]  do_syscall_64+0x37/0x80
[ 1562.117398]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1562.118065] RIP: 0033:0x7f8a39143b20
[ 1562.118559] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1562.120831] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1562.121804] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1562.122707] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1562.123604] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1562.124500] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1562.125398] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1562.126495] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1562.126681] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1562.127572] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1562.128611] caller is debug_smp_processor_id+0x1c/0x20
[ 1562.130178] Call Trace:
[ 1562.130232]  dump_stack_lvl+0xa4/0xd3
[ 1562.131882]  dump_stack+0x15/0x17
[ 1562.132439]  check_preemption_disabled+0x167/0x180
[ 1562.133280]  debug_smp_processor_id+0x1c/0x20
[ 1562.133977]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1562.134899]  perf_trace_buf_alloc+0x3d/0x100
[ 1562.135584]  ? __text_poke+0xea/0x4e0
[ 1562.136168]  ? __pmd_alloc+0x420/0x420
[ 1562.136797]  perf_ftrace_function_call+0x209/0x360
[ 1562.137890]  ? 0xffffffffa0098099
[ 1562.138570]  ? find_get_pages_range_tag+0x1/0x7f0
[ 1562.139349]  0xffffffffa0098099
[ 1562.139930]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1562.140664]  ? do_sync_core+0x30/0x30
[ 1562.141408]  ? __get_locked_pte+0x5/0x290
[ 1562.142133]  __get_locked_pte+0x5/0x290
[ 1562.142759]  __text_poke+0xea/0x4e0
[ 1562.143339]  ? __get_locked_pte+0x5/0x290
[ 1562.143972]  ? __text_poke+0xea/0x4e0
[ 1562.144573]  ? find_get_pages_range_tag+0x1/0x7f0
[ 1562.145348]  ? lock_is_held_type+0xe2/0x140
[ 1562.146036]  ? find_get_pages_range_tag+0x1/0x7f0
[ 1562.146854]  text_poke+0x2b/0x60
[ 1562.147453]  text_poke_bp_batch+0xf5/0x2c0
[ 1562.148188]  ? oom_reaper+0xa20/0xa20
[ 1562.148859]  text_poke_queue+0xa7/0xc0
[ 1562.149546]  ftrace_replace_code+0xfd/0x170
[ 1562.150314]  ftrace_modify_all_code+0x1b1/0x270
[ 1562.151105]  arch_ftrace_update_code+0x9/0x10
[ 1562.151811]  ftrace_run_update_code+0x30/0xa0
[ 1562.152540]  ftrace_startup_enable+0x5e/0xa0
[ 1562.153257]  ftrace_startup+0x16d/0x240
[ 1562.154005]  register_ftrace_function+0x43/0x90
[ 1562.154766]  perf_ftrace_event_register+0xc1/0xf0
[ 1562.155543]  perf_trace_event_init+0xa0/0x4c0
[ 1562.156328]  perf_trace_init+0xda/0x160
[ 1562.157023]  perf_tp_event_init+0x57/0xa0
[ 1562.157706]  perf_try_init_event+0x83/0x270
[ 1562.158493]  perf_event_alloc+0xe3f/0x1c10
[ 1562.159136]  ? _raw_spin_unlock+0x2c/0x50
[ 1562.159801]  ? alloc_fd+0x20d/0x320
[ 1562.160554]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1562.161340]  ? write_comp_data+0x2f/0x90
[ 1562.162546]  __x64_sys_perf_event_open+0x26/0x30
[ 1562.163294]  do_syscall_64+0x37/0x80
[ 1562.163900]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1562.164672] RIP: 0033:0x7fac0740459d
[ 1562.165254] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1562.167829] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1562.168951] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1562.169986] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1562.171024] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1562.172054] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1562.173084] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1562.174496] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1562.174667] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1562.175517] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1562.176520] caller is debug_smp_processor_id+0x1c/0x20
[ 1562.177898] Call Trace:
[ 1562.178914]  dump_stack_lvl+0xa4/0xd3
[ 1562.179447]  dump_stack+0x15/0x17
[ 1562.179910]  check_preemption_disabled+0x167/0x180
[ 1562.180547]  ? ep_start_scan+0x68/0x100
[ 1562.181063]  ? _raw_read_lock_irq+0xa0/0xa0
[ 1562.181650]  debug_smp_processor_id+0x1c/0x20
[ 1562.182247]  perf_ftrace_function_call+0x7c/0x360
[ 1562.182877]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1562.183505]  ? do_epoll_wait+0x3bf/0xd80
[ 1562.184042]  ? perf_ftrace_function_call+0x4c/0x360
[ 1562.184738]  ? ftrace_call+0x5/0x44
[ 1562.185294]  ? do_epoll_wait+0x3b3/0xd80
[ 1562.185906]  0xffffffffa0098099
[ 1562.186402]  ? 0xffffffffa0098099
[ 1562.186867]  ? __mutex_lock+0xfe/0x9f0
[ 1562.187382]  ? do_epoll_wait+0x3b3/0xd80
[ 1562.187918]  ? ep_start_scan+0xe0/0x100
[ 1562.188472]  ? _raw_write_lock_irq+0x5/0x60
[ 1562.189039]  ? write_comp_data+0x2f/0x90
[ 1562.189592]  _raw_write_lock_irq+0x5/0x60
[ 1562.190142]  ep_start_scan+0x68/0x100
[ 1562.190648]  ? _raw_write_lock_irq+0x5/0x60
[ 1562.191206]  ? ep_start_scan+0x68/0x100
[ 1562.191770]  do_epoll_wait+0x3bf/0xd80
[ 1562.192444]  ? wait_woken+0x90/0x90
[ 1562.193002]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1562.193636]  do_syscall_64+0x37/0x80
[ 1562.194143]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1562.194806] RIP: 0033:0x7f8a39143b20
[ 1562.195294] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1562.197556] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1562.198524] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1562.199417] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1562.200312] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1562.201207] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1562.202105] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1562.203196] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1562.203361] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1562.204186] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1562.205225] caller is debug_smp_processor_id+0x1c/0x20
[ 1562.206678] Call Trace:
[ 1562.206715]  dump_stack_lvl+0xa4/0xd3
[ 1562.206798]  dump_stack+0x15/0x17
[ 1562.208687]  check_preemption_disabled+0x167/0x180
[ 1562.209428]  debug_smp_processor_id+0x1c/0x20
[ 1562.210060]  perf_trace_buf_alloc+0x98/0x100
[ 1562.210678]  ? __text_poke+0xea/0x4e0
[ 1562.211205]  ? __pmd_alloc+0x420/0x420
[ 1562.211766]  perf_ftrace_function_call+0x209/0x360
[ 1562.212679]  ? 0xffffffffa0098099
[ 1562.213255]  ? find_get_pages_range_tag+0x1/0x7f0
[ 1562.213949]  0xffffffffa0098099
[ 1562.214465]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1562.215125]  ? do_sync_core+0x30/0x30
[ 1562.215761]  ? __get_locked_pte+0x5/0x290
[ 1562.216393]  __get_locked_pte+0x5/0x290
[ 1562.216955]  __text_poke+0xea/0x4e0
[ 1562.217473]  ? __get_locked_pte+0x5/0x290
[ 1562.218047]  ? __text_poke+0xea/0x4e0
[ 1562.218591]  ? find_get_pages_range_tag+0x1/0x7f0
[ 1562.219285]  ? lock_is_held_type+0xe2/0x140
[ 1562.219902]  ? find_get_pages_range_tag+0x1/0x7f0
[ 1562.220618]  text_poke+0x2b/0x60
[ 1562.221141]  text_poke_bp_batch+0xf5/0x2c0
[ 1562.221784]  ? oom_reaper+0xa20/0xa20
[ 1562.222383]  text_poke_queue+0xa7/0xc0
[ 1562.222985]  ftrace_replace_code+0xfd/0x170
[ 1562.223650]  ftrace_modify_all_code+0x1b1/0x270
[ 1562.224346]  arch_ftrace_update_code+0x9/0x10
[ 1562.224971]  ftrace_run_update_code+0x30/0xa0
[ 1562.225620]  ftrace_startup_enable+0x5e/0xa0
[ 1562.226273]  ftrace_startup+0x16d/0x240
[ 1562.226915]  register_ftrace_function+0x43/0x90
[ 1562.227590]  perf_ftrace_event_register+0xc1/0xf0
[ 1562.228291]  perf_trace_event_init+0xa0/0x4c0
[ 1562.228979]  perf_trace_init+0xda/0x160
[ 1562.229587]  perf_tp_event_init+0x57/0xa0
[ 1562.230202]  perf_try_init_event+0x83/0x270
[ 1562.230881]  perf_event_alloc+0xe3f/0x1c10
[ 1562.231464]  ? _raw_spin_unlock+0x2c/0x50
[ 1562.232059]  ? alloc_fd+0x20d/0x320
[ 1562.232695]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1562.233397]  ? write_comp_data+0x2f/0x90
[ 1562.234360]  __x64_sys_perf_event_open+0x26/0x30
[ 1562.235030]  do_syscall_64+0x37/0x80
[ 1562.235571]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1562.236272] RIP: 0033:0x7fac0740459d
[ 1562.236794] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1562.239179] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1562.240204] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1562.241148] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1562.242100] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1562.243043] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1562.243995] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1562.245191] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1562.245359] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1562.246223] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1562.246245] Call Trace:
[ 1562.246273]  dump_stack_lvl+0xa4/0xd3
[ 1562.246338]  dump_stack+0x15/0x17
[ 1562.246375]  check_preemption_disabled+0x167/0x180
[ 1562.247364] caller is debug_smp_processor_id+0x1c/0x20
[ 1562.248766]  ? do_epoll_wait+0x490/0xd80
[ 1562.251716]  ? ep_eventpoll_poll+0x30/0x30
[ 1562.252295]  debug_smp_processor_id+0x1c/0x20
[ 1562.252886]  perf_ftrace_function_call+0x7c/0x360
[ 1562.253536]  ? write_comp_data+0x2f/0x90
[ 1562.254086]  ? perf_trace_buf_update+0x70/0x70
[ 1562.254687]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1562.255336]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1562.255936]  ? _raw_write_unlock_irq+0x38/0x50
[ 1562.256537]  ? preempt_notifier_dec+0x20/0x20
[ 1562.257179]  ? ftrace_call+0x5/0x44
[ 1562.257730]  0xffffffffa0098099
[ 1562.258244]  ? preempt_count_sub+0x5/0xa0
[ 1562.258854]  ? ep_item_poll.isra.21+0x5/0x90
[ 1562.259434]  ? write_comp_data+0x2f/0x90
[ 1562.259988]  ep_item_poll.isra.21+0x5/0x90
[ 1562.260546]  do_epoll_wait+0x490/0xd80
[ 1562.261072]  ? ep_item_poll.isra.21+0x5/0x90
[ 1562.261642]  ? do_epoll_wait+0x490/0xd80
[ 1562.262345]  ? wait_woken+0x90/0x90
[ 1562.262903]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1562.263537]  do_syscall_64+0x37/0x80
[ 1562.264040]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1562.264702] RIP: 0033:0x7f8a39143b20
[ 1562.265191] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1562.267460] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1562.268427] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1562.269322] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1562.270221] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1562.271119] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1562.272015] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1562.273107] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1562.273213] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1562.274105] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1562.274131] Call Trace:
[ 1562.274167]  dump_stack_lvl+0xa4/0xd3
[ 1562.275209] caller is debug_smp_processor_id+0x1c/0x20
[ 1562.276706]  dump_stack+0x15/0x17
[ 1562.278617]  check_preemption_disabled+0x167/0x180
[ 1562.279358]  debug_smp_processor_id+0x1c/0x20
[ 1562.279984]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1562.280763]  perf_tp_event+0x331/0x4e0
[ 1562.281649]  ? arch_local_irq_enable+0x10/0x12
[ 1562.282304]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1562.282998]  ? dump_stack_lvl+0xcc/0xd3
[ 1562.283596]  ? dump_stack+0x15/0x17
[ 1562.284113]  ? check_preemption_disabled+0x167/0x180
[ 1562.284876]  ? __text_poke+0xea/0x4e0
[ 1562.285403]  ? __pmd_alloc+0x420/0x420
[ 1562.285978]  perf_ftrace_function_call+0x248/0x360
[ 1562.286657]  ? perf_ftrace_function_call+0x248/0x360
[ 1562.287614]  ? 0xffffffffa0098099
[ 1562.288189]  ? find_get_pages_range_tag+0x1/0x7f0
[ 1562.288884]  0xffffffffa0098099
[ 1562.289390]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1562.290054]  ? do_sync_core+0x30/0x30
[ 1562.290691]  ? __get_locked_pte+0x5/0x290
[ 1562.291322]  __get_locked_pte+0x5/0x290
[ 1562.291883]  __text_poke+0xea/0x4e0
[ 1562.292402]  ? __get_locked_pte+0x5/0x290
[ 1562.292972]  ? __text_poke+0xea/0x4e0
[ 1562.293512]  ? find_get_pages_range_tag+0x1/0x7f0
[ 1562.294208]  ? lock_is_held_type+0xe2/0x140
[ 1562.294825]  ? find_get_pages_range_tag+0x1/0x7f0
[ 1562.295540]  text_poke+0x2b/0x60
[ 1562.296062]  text_poke_bp_batch+0xf5/0x2c0
[ 1562.296705]  ? oom_reaper+0xa20/0xa20
[ 1562.297293]  text_poke_queue+0xa7/0xc0
[ 1562.297896]  ftrace_replace_code+0xfd/0x170
[ 1562.298563]  ftrace_modify_all_code+0x1b1/0x270
[ 1562.299260]  arch_ftrace_update_code+0x9/0x10
[ 1562.299885]  ftrace_run_update_code+0x30/0xa0
[ 1562.300534]  ftrace_startup_enable+0x5e/0xa0
[ 1562.301175]  ftrace_startup+0x16d/0x240
[ 1562.301821]  register_ftrace_function+0x43/0x90
[ 1562.302499]  perf_ftrace_event_register+0xc1/0xf0
[ 1562.303197]  perf_trace_event_init+0xa0/0x4c0
[ 1562.303888]  perf_trace_init+0xda/0x160
[ 1562.304499]  perf_tp_event_init+0x57/0xa0
[ 1562.305108]  perf_try_init_event+0x83/0x270
[ 1562.305786]  perf_event_alloc+0xe3f/0x1c10
[ 1562.306374]  ? _raw_spin_unlock+0x2c/0x50
[ 1562.306971]  ? alloc_fd+0x20d/0x320
[ 1562.307609]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1562.308315]  ? write_comp_data+0x2f/0x90
[ 1562.309271]  __x64_sys_perf_event_open+0x26/0x30
[ 1562.309942]  do_syscall_64+0x37/0x80
[ 1562.310486]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1562.311190] RIP: 0033:0x7fac0740459d
[ 1562.311714] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1562.314097] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1562.315123] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1562.316070] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1562.317017] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1562.317965] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1562.318919] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1562.320120] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1562.320292] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1562.321154] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1562.322406] caller is debug_smp_processor_id+0x1c/0x20
[ 1562.323637] Call Trace:
[ 1562.324706]  dump_stack_lvl+0xa4/0xd3
[ 1562.325241]  dump_stack+0x15/0x17
[ 1562.325705]  check_preemption_disabled+0x167/0x180
[ 1562.326359]  ? do_epoll_wait+0xabb/0xd80
[ 1562.326887]  ? ep_destroy_wakeup_source+0xe0/0xe0
[ 1562.327535]  debug_smp_processor_id+0x1c/0x20
[ 1562.328125]  perf_ftrace_function_call+0x7c/0x360
[ 1562.328756]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1562.329403]  ? _prb_read_valid+0x3ad/0x3f0
[ 1562.330026]  ? _prb_read_valid+0x5/0x3f0
[ 1562.330725]  0xffffffffa0098099
[ 1562.331182]  ? devkmsg_poll+0xa0/0x100
[ 1562.331762]  ? do_epoll_wait+0x85a/0xd80
[ 1562.332327]  ? ep_done_scan+0x5/0x240
[ 1562.332834]  ? write_comp_data+0x2f/0x90
[ 1562.333387]  ep_done_scan+0x5/0x240
[ 1562.333874]  do_epoll_wait+0xabb/0xd80
[ 1562.334402]  ? ep_done_scan+0x5/0x240
[ 1562.334899]  ? do_epoll_wait+0xabb/0xd80
[ 1562.335594]  ? wait_woken+0x90/0x90
[ 1562.336153]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1562.336791]  do_syscall_64+0x37/0x80
[ 1562.337297]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1562.337960] RIP: 0033:0x7f8a39143b20
[ 1562.338453] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1562.340721] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1562.341689] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1562.342589] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1562.343484] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1562.344381] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1562.345276] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1562.346375] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1562.346478] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1562.347447] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1562.348480] caller is debug_smp_processor_id+0x1c/0x20
[ 1562.350054] Call Trace:
[ 1562.350107]  dump_stack_lvl+0xa4/0xd3
[ 1562.351753]  dump_stack+0x15/0x17
[ 1562.352310]  check_preemption_disabled+0x167/0x180
[ 1562.353065]  ? __get_locked_pte+0x1a2/0x290
[ 1562.353717]  ? __lock_text_start+0x8/0x8
[ 1562.354395]  debug_smp_processor_id+0x1c/0x20
[ 1562.355091]  perf_ftrace_function_call+0x7c/0x360
[ 1562.355816]  ? __pmd_alloc+0x420/0x420
[ 1562.356447]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1562.357187]  ? __text_poke+0xea/0x4e0
[ 1562.357787]  ? perf_ftrace_function_call+0x4c/0x360
[ 1562.358983]  0xffffffffa0098099
[ 1562.359571]  ? find_get_pages_range_tag+0x1/0x7f0
[ 1562.360348]  ? 0xffffffffa0098099
[ 1562.360948]  ? pmd_page_vaddr+0x2b/0x70
[ 1562.361624]  ? _raw_spin_lock+0x5/0x50
[ 1562.362319]  _raw_spin_lock+0x5/0x50
[ 1562.362913]  __get_locked_pte+0x1a2/0x290
[ 1562.363564]  ? _raw_spin_lock+0x5/0x50
[ 1562.364160]  ? __get_locked_pte+0x1a2/0x290
[ 1562.364866]  ? find_get_pages_range_tag+0x1/0x7f0
[ 1562.365641]  __text_poke+0xea/0x4e0
[ 1562.366227]  ? find_get_pages_range_tag+0x1/0x7f0
[ 1562.367000]  ? lock_is_held_type+0xe2/0x140
[ 1562.367689]  ? find_get_pages_range_tag+0x1/0x7f0
[ 1562.368499]  text_poke+0x2b/0x60
[ 1562.369097]  text_poke_bp_batch+0xf5/0x2c0
[ 1562.369828]  ? oom_reaper+0xa20/0xa20
[ 1562.370507]  text_poke_queue+0xa7/0xc0
[ 1562.371194]  ftrace_replace_code+0xfd/0x170
[ 1562.371957]  ftrace_modify_all_code+0x1b1/0x270
[ 1562.372745]  arch_ftrace_update_code+0x9/0x10
[ 1562.373439]  ftrace_run_update_code+0x30/0xa0
[ 1562.374175]  ftrace_startup_enable+0x5e/0xa0
[ 1562.374893]  ftrace_startup+0x16d/0x240
[ 1562.375644]  register_ftrace_function+0x43/0x90
[ 1562.376398]  perf_ftrace_event_register+0xc1/0xf0
[ 1562.377175]  perf_trace_event_init+0xa0/0x4c0
[ 1562.377959]  perf_trace_init+0xda/0x160
[ 1562.378664]  perf_tp_event_init+0x57/0xa0
[ 1562.379349]  perf_try_init_event+0x83/0x270
[ 1562.380128]  perf_event_alloc+0xe3f/0x1c10
[ 1562.380773]  ? _raw_spin_unlock+0x2c/0x50
[ 1562.381440]  ? alloc_fd+0x20d/0x320
[ 1562.382200]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1562.382990]  ? write_comp_data+0x2f/0x90
[ 1562.384193]  __x64_sys_perf_event_open+0x26/0x30
[ 1562.384940]  do_syscall_64+0x37/0x80
[ 1562.385548]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1562.386327] RIP: 0033:0x7fac0740459d
[ 1562.386910] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1562.389467] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1562.390597] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1562.391627] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1562.392656] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1562.393685] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1562.394719] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1562.396120] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1562.397154] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1562.398572] Call Trace:
[ 1562.398927]  dump_stack_lvl+0xa4/0xd3
[ 1562.399463]  dump_stack+0x15/0x17
[ 1562.399929]  check_preemption_disabled+0x167/0x180
[ 1562.400572]  ? ep_done_scan+0x3b/0x240
[ 1562.401082]  ? _raw_read_lock_irq+0xa0/0xa0
[ 1562.401671]  debug_smp_processor_id+0x1c/0x20
[ 1562.402265]  perf_ftrace_function_call+0x7c/0x360
[ 1562.402887]  ? write_comp_data+0x2f/0x90
[ 1562.403425]  ? do_epoll_wait+0xabb/0xd80
[ 1562.403953]  ? ep_destroy_wakeup_source+0xe0/0xe0
[ 1562.404586]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1562.405215]  ? do_epoll_wait+0xabb/0xd80
[ 1562.405755]  ? perf_ftrace_function_call+0x4c/0x360
[ 1562.406410]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1562.407059]  ? _prb_read_valid+0x3ad/0x3f0
[ 1562.407685]  ? _prb_read_valid+0x5/0x3f0
[ 1562.408279]  0xffffffffa0098099
[ 1562.408821]  ? do_epoll_wait+0x85a/0xd80
[ 1562.409389]  ? _raw_write_lock_irq+0x5/0x60
[ 1562.409996]  _raw_write_lock_irq+0x5/0x60
[ 1562.410551]  ep_done_scan+0x3b/0x240
[ 1562.411050]  ? _raw_write_lock_irq+0x5/0x60
[ 1562.411610]  ? ep_done_scan+0x3b/0x240
[ 1562.412203]  do_epoll_wait+0xabb/0xd80
[ 1562.412878]  ? wait_woken+0x90/0x90
[ 1562.413431]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1562.414073]  do_syscall_64+0x37/0x80
[ 1562.414583]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1562.415248] RIP: 0033:0x7f8a39143b20
[ 1562.415738] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1562.418010] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1562.418986] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1562.419885] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1562.420782] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1562.421681] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1562.422587] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1567.054112] check_preemption_disabled: 869791 callbacks suppressed
[ 1567.054142] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1567.056022] caller is debug_smp_processor_id+0x1c/0x20
[ 1567.056724] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1567.057690] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1567.059142] Call Trace:
[ 1567.059531]  dump_stack_lvl+0xa4/0xd3
[ 1567.060122]  dump_stack+0x15/0x17
[ 1567.060623]  check_preemption_disabled+0x167/0x180
[ 1567.061300]  ? insn_get_displacement+0x157/0x270
[ 1567.061939]  ? insn_rip_relative+0xb0/0xb0
[ 1567.062579]  debug_smp_processor_id+0x1c/0x20
[ 1567.063204]  perf_ftrace_function_call+0x7c/0x360
[ 1567.063871]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1567.064534]  ? insn_get_immediate+0x181/0x570
[ 1567.065156]  ? perf_ftrace_function_call+0x4c/0x360
[ 1567.066269]  0xffffffffa0098099
[ 1567.066828]  ? 0xffffffffa0098099
[ 1567.067402]  ? insn_get_displacement+0x47/0x270
[ 1567.068094]  ? insn_get_sib+0x5/0x140
[ 1567.068632]  ? write_comp_data+0x2f/0x90
[ 1567.069237]  insn_get_sib+0x5/0x140
[ 1567.069756]  insn_get_displacement+0x157/0x270
[ 1567.070408]  ? insn_get_sib+0x5/0x140
[ 1567.070931]  ? insn_get_displacement+0x157/0x270
[ 1567.071649]  insn_get_immediate+0x181/0x570
[ 1567.072333]  insn_get_length+0x75/0x90
[ 1567.072934]  insn_decode+0x9b/0x170
[ 1567.073486]  ? security_setprocattr+0xb0/0xb0
[ 1567.074138]  text_poke_loc_init+0x63/0x140
[ 1567.074970]  ? security_setprocattr+0xb0/0xb0
[ 1567.075659]  text_poke_queue+0x84/0xc0
[ 1567.076277]  ftrace_replace_code+0xfd/0x170
[ 1567.076961]  ftrace_modify_all_code+0x1b1/0x270
[ 1567.077669]  arch_ftrace_update_code+0x9/0x10
[ 1567.078309]  ftrace_run_update_code+0x30/0xa0
[ 1567.078964]  ftrace_startup_enable+0x5e/0xa0
[ 1567.079609]  ftrace_startup+0x16d/0x240
[ 1567.080284]  register_ftrace_function+0x43/0x90
[ 1567.080960]  perf_ftrace_event_register+0xc1/0xf0
[ 1567.081657]  perf_trace_event_init+0xa0/0x4c0
[ 1567.082376]  perf_trace_init+0xda/0x160
[ 1567.083004]  perf_tp_event_init+0x57/0xa0
[ 1567.083619]  perf_try_init_event+0x83/0x270
[ 1567.084318]  perf_event_alloc+0xe3f/0x1c10
[ 1567.084895]  ? _raw_spin_unlock+0x2c/0x50
[ 1567.085493]  ? alloc_fd+0x20d/0x320
[ 1567.086191]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1567.086899]  ? write_comp_data+0x2f/0x90
[ 1567.088005]  __x64_sys_perf_event_open+0x26/0x30
[ 1567.088753]  do_syscall_64+0x37/0x80
[ 1567.089358]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1567.090110] RIP: 0033:0x7fac0740459d
[ 1567.090675] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1567.093124] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1567.094206] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1567.095187] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1567.096173] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1567.097152] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1567.098141] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1567.099745] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1567.099760] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1567.099788] caller is debug_smp_processor_id+0x1c/0x20
[ 1567.100865] caller is debug_smp_processor_id+0x1c/0x20
[ 1567.101916] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1567.104299] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1567.105710] Call Trace:
[ 1567.106073]  dump_stack_lvl+0xa4/0xd3
[ 1567.106613]  dump_stack+0x15/0x17
[ 1567.107079]  check_preemption_disabled+0x167/0x180
[ 1567.107723]  ? do_epoll_wait+0x3b3/0xd80
[ 1567.108254]  ? __mutex_lock+0x9f0/0x9f0
[ 1567.108801]  debug_smp_processor_id+0x1c/0x20
[ 1567.109391]  perf_ftrace_function_call+0x7c/0x360
[ 1567.110085]  ? ftrace_call+0x5/0x44
[ 1567.110563]  ? trace_hardirqs_on+0x6a/0x170
[ 1567.111168]  ? finish_task_switch+0xb0/0x2a0
[ 1567.111739]  ? finish_task_switch+0x70/0x2a0
[ 1567.112342]  ? trace_hardirqs_on+0x3f/0x170
[ 1567.112902]  ? finish_task_switch+0x70/0x2a0
[ 1567.113498]  ? preempt_count_sub+0x5/0xa0
[ 1567.114108]  0xffffffffa0098099
[ 1567.114559]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1567.115207]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1567.115958]  ? do_epoll_wait+0x36b/0xd80
[ 1567.116525]  ? mutex_lock_nested+0x5/0x20
[ 1567.117074]  ? write_comp_data+0x2f/0x90
[ 1567.117628]  mutex_lock_nested+0x5/0x20
[ 1567.118164]  do_epoll_wait+0x3b3/0xd80
[ 1567.118688]  ? mutex_lock_nested+0x5/0x20
[ 1567.119225]  ? do_epoll_wait+0x3b3/0xd80
[ 1567.119920]  ? wait_woken+0x90/0x90
[ 1567.120478]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1567.121113]  do_syscall_64+0x37/0x80
[ 1567.121618]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1567.122290] RIP: 0033:0x7f8a39143b20
[ 1567.122782] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1567.125051] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1567.126017] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1567.126923] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1567.127820] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1567.128716] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1567.129612] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1567.130730] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1567.130905] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1567.131810] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1567.132846] caller is debug_smp_processor_id+0x1c/0x20
[ 1567.134422] Call Trace:
[ 1567.134475]  dump_stack_lvl+0xa4/0xd3
[ 1567.136127]  dump_stack+0x15/0x17
[ 1567.136684]  check_preemption_disabled+0x167/0x180
[ 1567.137529]  debug_smp_processor_id+0x1c/0x20
[ 1567.138232]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1567.139158]  perf_trace_buf_alloc+0x3d/0x100
[ 1567.139846]  ? insn_get_displacement+0x157/0x270
[ 1567.140558]  ? insn_rip_relative+0xb0/0xb0
[ 1567.141236]  perf_ftrace_function_call+0x209/0x360
[ 1567.142336]  ? 0xffffffffa0098099
[ 1567.143084]  0xffffffffa0098099
[ 1567.143704]  ? 0xffffffffa0098099
[ 1567.144343]  ? insn_get_displacement+0x47/0x270
[ 1567.145114]  ? insn_get_sib+0x5/0x140
[ 1567.145716]  ? write_comp_data+0x2f/0x90
[ 1567.146391]  insn_get_sib+0x5/0x140
[ 1567.146973]  insn_get_displacement+0x157/0x270
[ 1567.147681]  ? insn_get_sib+0x5/0x140
[ 1567.148265]  ? insn_get_displacement+0x157/0x270
[ 1567.149065]  insn_get_immediate+0x181/0x570
[ 1567.149826]  insn_get_length+0x75/0x90
[ 1567.150498]  insn_decode+0x9b/0x170
[ 1567.151114]  ? security_setprocattr+0xb0/0xb0
[ 1567.151811]  text_poke_loc_init+0x63/0x140
[ 1567.152721]  ? security_setprocattr+0xb0/0xb0
[ 1567.153489]  text_poke_queue+0x84/0xc0
[ 1567.154181]  ftrace_replace_code+0xfd/0x170
[ 1567.154942]  ftrace_modify_all_code+0x1b1/0x270
[ 1567.155732]  arch_ftrace_update_code+0x9/0x10
[ 1567.156427]  ftrace_run_update_code+0x30/0xa0
[ 1567.157158]  ftrace_startup_enable+0x5e/0xa0
[ 1567.157880]  ftrace_startup+0x16d/0x240
[ 1567.158635]  register_ftrace_function+0x43/0x90
[ 1567.159391]  perf_ftrace_event_register+0xc1/0xf0
[ 1567.160170]  perf_trace_event_init+0xa0/0x4c0
[ 1567.160957]  perf_trace_init+0xda/0x160
[ 1567.161656]  perf_tp_event_init+0x57/0xa0
[ 1567.162346]  perf_try_init_event+0x83/0x270
[ 1567.163125]  perf_event_alloc+0xe3f/0x1c10
[ 1567.163771]  ? _raw_spin_unlock+0x2c/0x50
[ 1567.164438]  ? alloc_fd+0x20d/0x320
[ 1567.165193]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1567.165987]  ? write_comp_data+0x2f/0x90
[ 1567.167193]  __x64_sys_perf_event_open+0x26/0x30
[ 1567.167943]  do_syscall_64+0x37/0x80
[ 1567.168553]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1567.169325] RIP: 0033:0x7fac0740459d
[ 1567.169909] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1567.172480] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1567.173604] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1567.174637] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1567.175666] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1567.176695] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1567.177723] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1567.179130] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1567.179301] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1567.180154] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1567.181161] caller is debug_smp_processor_id+0x1c/0x20
[ 1567.182549] Call Trace:
[ 1567.182579]  dump_stack_lvl+0xa4/0xd3
[ 1567.182646]  dump_stack+0x15/0x17
[ 1567.182682]  check_preemption_disabled+0x167/0x180
[ 1567.182721]  ? mutex_lock_nested+0x1b/0x20
[ 1567.185704]  ? mutex_lock_io_nested+0x940/0x940
[ 1567.186337]  debug_smp_processor_id+0x1c/0x20
[ 1567.186927]  perf_ftrace_function_call+0x7c/0x360
[ 1567.187560]  ? perf_ftrace_function_call+0x4c/0x360
[ 1567.188268]  ? ftrace_call+0x5/0x44
[ 1567.188745]  ? trace_hardirqs_on+0x6a/0x170
[ 1567.189352]  ? finish_task_switch+0xb0/0x2a0
[ 1567.189922]  ? finish_task_switch+0x70/0x2a0
[ 1567.190528]  ? trace_hardirqs_on+0x3f/0x170
[ 1567.191088]  ? finish_task_switch+0x70/0x2a0
[ 1567.191741]  0xffffffffa0098099
[ 1567.192191]  ? 0xffffffffa0098099
[ 1567.192659]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1567.193306]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1567.194019]  ? do_epoll_wait+0x3b3/0xd80
[ 1567.194608]  ? __mutex_lock+0x5/0x9f0
[ 1567.195114]  ? mutex_lock_nested+0x5/0x20
[ 1567.195662]  ? write_comp_data+0x2f/0x90
[ 1567.196198]  __mutex_lock+0x5/0x9f0
[ 1567.196683]  mutex_lock_nested+0x1b/0x20
[ 1567.197221]  ? __mutex_lock+0x5/0x9f0
[ 1567.197717]  ? mutex_lock_nested+0x1b/0x20
[ 1567.198280]  do_epoll_wait+0x3b3/0xd80
[ 1567.198956]  ? wait_woken+0x90/0x90
[ 1567.199515]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1567.200150]  do_syscall_64+0x37/0x80
[ 1567.200653]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1567.201318] RIP: 0033:0x7f8a39143b20
[ 1567.201808] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1567.204083] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1567.205052] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1567.205948] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1567.206841] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1567.207723] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1567.208620] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1567.209713] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1567.209828] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1567.210712] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1567.210738] Call Trace:
[ 1567.210774]  dump_stack_lvl+0xa4/0xd3
[ 1567.211818] caller is debug_smp_processor_id+0x1c/0x20
[ 1567.213325]  dump_stack+0x15/0x17
[ 1567.215225]  check_preemption_disabled+0x167/0x180
[ 1567.215972]  debug_smp_processor_id+0x1c/0x20
[ 1567.216604]  perf_trace_buf_alloc+0x98/0x100
[ 1567.217224]  ? insn_get_displacement+0x157/0x270
[ 1567.217879]  ? insn_rip_relative+0xb0/0xb0
[ 1567.218527]  perf_ftrace_function_call+0x209/0x360
[ 1567.219441]  ? 0xffffffffa0098099
[ 1567.220069]  0xffffffffa0098099
[ 1567.220603]  ? 0xffffffffa0098099
[ 1567.221156]  ? insn_get_displacement+0x47/0x270
[ 1567.221843]  ? insn_get_sib+0x5/0x140
[ 1567.222392]  ? write_comp_data+0x2f/0x90
[ 1567.222991]  insn_get_sib+0x5/0x140
[ 1567.223512]  insn_get_displacement+0x157/0x270
[ 1567.224151]  ? insn_get_sib+0x5/0x140
[ 1567.224680]  ? insn_get_displacement+0x157/0x270
[ 1567.225388]  insn_get_immediate+0x181/0x570
[ 1567.226060]  insn_get_length+0x75/0x90
[ 1567.226658]  insn_decode+0x9b/0x170
[ 1567.227204]  ? security_setprocattr+0xb0/0xb0
[ 1567.227836]  text_poke_loc_init+0x63/0x140
[ 1567.228601]  ? security_setprocattr+0xb0/0xb0
[ 1567.229280]  text_poke_queue+0x84/0xc0
[ 1567.229892]  ftrace_replace_code+0xfd/0x170
[ 1567.230569]  ftrace_modify_all_code+0x1b1/0x270
[ 1567.231269]  arch_ftrace_update_code+0x9/0x10
[ 1567.231899]  ftrace_run_update_code+0x30/0xa0
[ 1567.232552]  ftrace_startup_enable+0x5e/0xa0
[ 1567.233195]  ftrace_startup+0x16d/0x240
[ 1567.233845]  register_ftrace_function+0x43/0x90
[ 1567.234534]  perf_ftrace_event_register+0xc1/0xf0
[ 1567.235233]  perf_trace_event_init+0xa0/0x4c0
[ 1567.235925]  perf_trace_init+0xda/0x160
[ 1567.236540]  perf_tp_event_init+0x57/0xa0
[ 1567.237156]  perf_try_init_event+0x83/0x270
[ 1567.237839]  perf_event_alloc+0xe3f/0x1c10
[ 1567.238435]  ? _raw_spin_unlock+0x2c/0x50
[ 1567.239033]  ? alloc_fd+0x20d/0x320
[ 1567.239686]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1567.240393]  ? write_comp_data+0x2f/0x90
[ 1567.241359]  __x64_sys_perf_event_open+0x26/0x30
[ 1567.242033]  do_syscall_64+0x37/0x80
[ 1567.242585]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1567.243289] RIP: 0033:0x7fac0740459d
[ 1567.243814] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1567.246209] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1567.247235] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1567.248182] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1567.249130] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1567.250089] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1567.251051] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1567.252256] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1567.252424] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1567.253282] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1567.254458] caller is debug_smp_processor_id+0x1c/0x20
[ 1567.255725] Call Trace:
[ 1567.256738]  dump_stack_lvl+0xa4/0xd3
[ 1567.257272]  dump_stack+0x15/0x17
[ 1567.257737]  check_preemption_disabled+0x167/0x180
[ 1567.258387]  ? ep_start_scan+0x68/0x100
[ 1567.258906]  ? _raw_read_lock_irq+0xa0/0xa0
[ 1567.259493]  debug_smp_processor_id+0x1c/0x20
[ 1567.260082]  perf_ftrace_function_call+0x7c/0x360
[ 1567.260713]  ? ftrace_ops_test+0x71/0xc0
[ 1567.261258]  ? preempt_notifier_dec+0x20/0x20
[ 1567.261901]  ? ftrace_call+0x5/0x44
[ 1567.262430]  ? write_comp_data+0x2f/0x90
[ 1567.262976]  ? perf_trace_buf_update+0x70/0x70
[ 1567.263574]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1567.264269]  0xffffffffa0098099
[ 1567.264753]  ? ftrace_call+0x5/0x44
[ 1567.265237]  ? __mutex_lock+0xfe/0x9f0
[ 1567.265753]  ? do_epoll_wait+0x3b3/0xd80
[ 1567.266299]  ? ep_start_scan+0xe0/0x100
[ 1567.266854]  ? _raw_write_lock_irq+0x5/0x60
[ 1567.267424]  ? write_comp_data+0x2f/0x90
[ 1567.267977]  _raw_write_lock_irq+0x5/0x60
[ 1567.268527]  ep_start_scan+0x68/0x100
[ 1567.269035]  ? _raw_write_lock_irq+0x5/0x60
[ 1567.269594]  ? ep_start_scan+0x68/0x100
[ 1567.270168]  do_epoll_wait+0x3bf/0xd80
[ 1567.270843]  ? wait_woken+0x90/0x90
[ 1567.271402]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1567.272036]  do_syscall_64+0x37/0x80
[ 1567.272542]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1567.273205] RIP: 0033:0x7f8a39143b20
[ 1567.273696] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1567.275979] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1567.276948] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1567.277846] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1567.278758] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1567.279676] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1567.280574] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1567.281668] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1567.281792] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1567.282668] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1567.282693] Call Trace:
[ 1567.282730]  dump_stack_lvl+0xa4/0xd3
[ 1567.283768] caller is debug_smp_processor_id+0x1c/0x20
[ 1567.285276]  dump_stack+0x15/0x17
[ 1567.287183]  check_preemption_disabled+0x167/0x180
[ 1567.287929]  debug_smp_processor_id+0x1c/0x20
[ 1567.288561]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1567.289345]  perf_tp_event+0x331/0x4e0
[ 1567.290275]  ? arch_local_irq_enable+0x10/0x12
[ 1567.290926]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1567.291623]  ? dump_stack_lvl+0xcc/0xd3
[ 1567.292224]  ? dump_stack+0x15/0x17
[ 1567.292744]  ? check_preemption_disabled+0x167/0x180
[ 1567.293486]  ? insn_get_displacement+0x157/0x270
[ 1567.294135]  ? insn_rip_relative+0xb0/0xb0
[ 1567.294753]  perf_ftrace_function_call+0x248/0x360
[ 1567.295427]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1567.296099]  ? perf_ftrace_function_call+0x248/0x360
[ 1567.297060]  ? 0xffffffffa0098099
[ 1567.297688]  0xffffffffa0098099
[ 1567.298227]  ? 0xffffffffa0098099
[ 1567.298782]  ? insn_get_displacement+0x47/0x270
[ 1567.299468]  ? insn_get_sib+0x5/0x140
[ 1567.300010]  ? write_comp_data+0x2f/0x90
[ 1567.300609]  insn_get_sib+0x5/0x140
[ 1567.301130]  insn_get_displacement+0x157/0x270
[ 1567.301771]  ? insn_get_sib+0x5/0x140
[ 1567.302304]  ? insn_get_displacement+0x157/0x270
[ 1567.303018]  insn_get_immediate+0x181/0x570
[ 1567.303685]  insn_get_length+0x75/0x90
[ 1567.304274]  insn_decode+0x9b/0x170
[ 1567.304818]  ? security_setprocattr+0xb0/0xb0
[ 1567.305448]  text_poke_loc_init+0x63/0x140
[ 1567.306218]  ? security_setprocattr+0xb0/0xb0
[ 1567.306894]  text_poke_queue+0x84/0xc0
[ 1567.307497]  ftrace_replace_code+0xfd/0x170
[ 1567.308164]  ftrace_modify_all_code+0x1b1/0x270
[ 1567.308863]  arch_ftrace_update_code+0x9/0x10
[ 1567.309490]  ftrace_run_update_code+0x30/0xa0
[ 1567.310147]  ftrace_startup_enable+0x5e/0xa0
[ 1567.310791]  ftrace_startup+0x16d/0x240
[ 1567.311440]  register_ftrace_function+0x43/0x90
[ 1567.312115]  perf_ftrace_event_register+0xc1/0xf0
[ 1567.312813]  perf_trace_event_init+0xa0/0x4c0
[ 1567.313503]  perf_trace_init+0xda/0x160
[ 1567.314120]  perf_tp_event_init+0x57/0xa0
[ 1567.314730]  perf_try_init_event+0x83/0x270
[ 1567.315409]  perf_event_alloc+0xe3f/0x1c10
[ 1567.315995]  ? _raw_spin_unlock+0x2c/0x50
[ 1567.316593]  ? alloc_fd+0x20d/0x320
[ 1567.317239]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1567.317967]  ? write_comp_data+0x2f/0x90
[ 1567.318935]  __x64_sys_perf_event_open+0x26/0x30
[ 1567.319608]  do_syscall_64+0x37/0x80
[ 1567.320149]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1567.320853] RIP: 0033:0x7fac0740459d
[ 1567.321378] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1567.323762] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1567.324788] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1567.325737] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1567.326685] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1567.327633] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1567.328579] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1567.329782] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1567.329954] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1567.330822] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1567.331912] caller is debug_smp_processor_id+0x1c/0x20
[ 1567.333293] Call Trace:
[ 1567.334369]  dump_stack_lvl+0xa4/0xd3
[ 1567.334904]  dump_stack+0x15/0x17
[ 1567.335369]  check_preemption_disabled+0x167/0x180
[ 1567.336010]  ? ep_done_scan+0x3b/0x240
[ 1567.336518]  ? _raw_read_lock_irq+0xa0/0xa0
[ 1567.337106]  debug_smp_processor_id+0x1c/0x20
[ 1567.337695]  perf_ftrace_function_call+0x7c/0x360
[ 1567.338332]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1567.338980]  ? ftrace_ops_test+0x71/0xc0
[ 1567.339552]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1567.340200]  ? _prb_read_valid+0x3ad/0x3f0
[ 1567.340805]  ? write_comp_data+0x2f/0x90
[ 1567.341418]  0xffffffffa0098099
[ 1567.341866]  ? ep_destroy_wakeup_source+0xe0/0xe0
[ 1567.342574]  ? do_epoll_wait+0x85a/0xd80
[ 1567.343141]  ? _raw_write_lock_irq+0x5/0x60
[ 1567.343745]  _raw_write_lock_irq+0x5/0x60
[ 1567.344294]  ep_done_scan+0x3b/0x240
[ 1567.344792]  ? _raw_write_lock_irq+0x5/0x60
[ 1567.345351]  ? ep_done_scan+0x3b/0x240
[ 1567.345943]  do_epoll_wait+0xabb/0xd80
[ 1567.346621]  ? wait_woken+0x90/0x90
[ 1567.347180]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1567.347815]  do_syscall_64+0x37/0x80
[ 1567.348319]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1567.348981] RIP: 0033:0x7f8a39143b20
[ 1567.349470] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1567.351741] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1567.352706] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1567.353601] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1567.354499] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1567.355396] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1567.356291] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1567.357386] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1567.357503] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1567.358470] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1567.358506] Call Trace:
[ 1567.358557]  dump_stack_lvl+0xa4/0xd3
[ 1567.359570] caller is debug_smp_processor_id+0x1c/0x20
[ 1567.361214]  dump_stack+0x15/0x17
[ 1567.363249]  check_preemption_disabled+0x167/0x180
[ 1567.364006]  ? insn_get_sib+0x122/0x140
[ 1567.364614]  ? insn_get_opcode+0x3b0/0x3b0
[ 1567.365311]  debug_smp_processor_id+0x1c/0x20
[ 1567.366009]  perf_ftrace_function_call+0x7c/0x360
[ 1567.366759]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1567.367501]  ? insn_get_displacement+0x157/0x270
[ 1567.368231]  ? perf_ftrace_function_call+0x4c/0x360
[ 1567.369441]  0xffffffffa0098099
[ 1567.370064]  ? 0xffffffffa0098099
[ 1567.370702]  ? insn_get_sib+0x43/0x140
[ 1567.371369]  ? insn_get_modrm+0x5/0x2a0
[ 1567.371994]  ? write_comp_data+0x2f/0x90
[ 1567.372667]  insn_get_modrm+0x5/0x2a0
[ 1567.373269]  insn_get_sib+0x122/0x140
[ 1567.373874]  ? insn_get_modrm+0x5/0x2a0
[ 1567.374486]  ? insn_get_sib+0x122/0x140
[ 1567.375182]  insn_get_displacement+0x157/0x270
[ 1567.375961]  insn_get_immediate+0x181/0x570
[ 1567.376723]  insn_get_length+0x75/0x90
[ 1567.377392]  insn_decode+0x9b/0x170
[ 1567.378009]  ? security_setprocattr+0xb0/0xb0
[ 1567.378708]  text_poke_loc_init+0x63/0x140
[ 1567.379618]  ? security_setprocattr+0xb0/0xb0
[ 1567.380387]  text_poke_queue+0x84/0xc0
[ 1567.381075]  ftrace_replace_code+0xfd/0x170
[ 1567.381838]  ftrace_modify_all_code+0x1b1/0x270
[ 1567.382633]  arch_ftrace_update_code+0x9/0x10
[ 1567.383328]  ftrace_run_update_code+0x30/0xa0
[ 1567.384059]  ftrace_startup_enable+0x5e/0xa0
[ 1567.384777]  ftrace_startup+0x16d/0x240
[ 1567.385528]  register_ftrace_function+0x43/0x90
[ 1567.386285]  perf_ftrace_event_register+0xc1/0xf0
[ 1567.387064]  perf_trace_event_init+0xa0/0x4c0
[ 1567.387850]  perf_trace_init+0xda/0x160
[ 1567.388562]  perf_tp_event_init+0x57/0xa0
[ 1567.389264]  perf_try_init_event+0x83/0x270
[ 1567.390086]  perf_event_alloc+0xe3f/0x1c10
[ 1567.390772]  ? _raw_spin_unlock+0x2c/0x50
[ 1567.391481]  ? alloc_fd+0x20d/0x320
[ 1567.392252]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1567.393053]  ? write_comp_data+0x2f/0x90
[ 1567.394279]  __x64_sys_perf_event_open+0x26/0x30
[ 1567.395040]  do_syscall_64+0x37/0x80
[ 1567.395675]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1567.396463] RIP: 0033:0x7fac0740459d
[ 1567.397055] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1567.399644] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1567.400770] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1567.401802] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1567.402856] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1567.403889] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1567.404923] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1567.406338] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1567.407386] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1567.408796] Call Trace:
[ 1567.409151]  dump_stack_lvl+0xa4/0xd3
[ 1567.409689]  dump_stack+0x15/0x17
[ 1567.410168]  check_preemption_disabled+0x167/0x180
[ 1567.410813]  ? do_epoll_wait+0xac3/0xd80
[ 1567.411343]  ? __mutex_unlock_slowpath+0x2e0/0x2e0
[ 1567.412002]  debug_smp_processor_id+0x1c/0x20
[ 1567.412593]  perf_ftrace_function_call+0x7c/0x360
[ 1567.413235]  ? perf_trace_buf_update+0x70/0x70
[ 1567.413835]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1567.414511]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1567.415114]  ? _raw_write_unlock_irq+0x38/0x50
[ 1567.415714]  ? preempt_notifier_dec+0x20/0x20
[ 1567.416359]  ? ftrace_call+0x5/0x44
[ 1567.416843]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1567.417563]  0xffffffffa0098099
[ 1567.418030]  ? preempt_count_sub+0x5/0xa0
[ 1567.418689]  ? mutex_unlock+0x5/0x20
[ 1567.419226]  mutex_unlock+0x5/0x20
[ 1567.419702]  do_epoll_wait+0xac3/0xd80
[ 1567.420221]  ? mutex_unlock+0x5/0x20
[ 1567.420707]  ? do_epoll_wait+0xac3/0xd80
[ 1567.421402]  ? wait_woken+0x90/0x90
[ 1567.421961]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1567.422607]  do_syscall_64+0x37/0x80
[ 1567.423112]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1567.423776] RIP: 0033:0x7f8a39143b20
[ 1567.424266] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1567.426541] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1567.427512] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1567.428408] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1567.429305] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1567.430205] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1567.431102] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1572.058134] check_preemption_disabled: 618054 callbacks suppressed
[ 1572.058162] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1572.060404] caller is debug_smp_processor_id+0x1c/0x20
[ 1572.061270] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1572.062506] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1572.064301] Call Trace:
[ 1572.064780]  dump_stack_lvl+0xa4/0xd3
[ 1572.065499]  dump_stack+0x15/0x17
[ 1572.066123]  check_preemption_disabled+0x167/0x180
[ 1572.067044]  debug_smp_processor_id+0x1c/0x20
[ 1572.067814]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1572.068825]  perf_trace_buf_alloc+0x3d/0x100
[ 1572.069583]  ? __get_locked_pte+0x1a2/0x290
[ 1572.070324]  ? __lock_text_start+0x8/0x8
[ 1572.071044]  perf_ftrace_function_call+0x209/0x360
[ 1572.072219]  ? 0xffffffffa0098099
[ 1572.073023]  0xffffffffa0098099
[ 1572.073656]  ? usb_enable_endpoint+0x1/0x110
[ 1572.074482]  ? ftrace_call+0x5/0x44
[ 1572.075154]  ? pmd_page_vaddr+0x2b/0x70
[ 1572.075895]  ? _raw_spin_lock+0x5/0x50
[ 1572.076642]  _raw_spin_lock+0x5/0x50
[ 1572.077294]  __get_locked_pte+0x1a2/0x290
[ 1572.078008]  ? _raw_spin_lock+0x5/0x50
[ 1572.078696]  ? __get_locked_pte+0x1a2/0x290
[ 1572.079470]  ? usb_enable_endpoint+0x1/0x110
[ 1572.080261]  __text_poke+0xea/0x4e0
[ 1572.080900]  ? usb_enable_endpoint+0x1/0x110
[ 1572.081687]  ? lock_is_held_type+0xe2/0x140
[ 1572.082462]  ? usb_enable_endpoint+0x1/0x110
[ 1572.083285]  text_poke+0x2b/0x60
[ 1572.083936]  text_poke_bp_batch+0xf5/0x2c0
[ 1572.084734]  ? ehci_remove+0x50/0x50
[ 1572.085461]  text_poke_queue+0xa7/0xc0
[ 1572.086223]  ftrace_replace_code+0xfd/0x170
[ 1572.087051]  ftrace_modify_all_code+0x1b1/0x270
[ 1572.087914]  arch_ftrace_update_code+0x9/0x10
[ 1572.088681]  ftrace_run_update_code+0x30/0xa0
[ 1572.089480]  ftrace_startup_enable+0x5e/0xa0
[ 1572.090287]  ftrace_startup+0x16d/0x240
[ 1572.091098]  register_ftrace_function+0x43/0x90
[ 1572.091925]  perf_ftrace_event_register+0xc1/0xf0
[ 1572.092777]  perf_trace_event_init+0xa0/0x4c0
[ 1572.093631]  perf_trace_init+0xda/0x160
[ 1572.094413]  perf_tp_event_init+0x57/0xa0
[ 1572.095159]  perf_try_init_event+0x83/0x270
[ 1572.096005]  perf_event_alloc+0xe3f/0x1c10
[ 1572.096715]  ? _raw_spin_unlock+0x2c/0x50
[ 1572.097445]  ? alloc_fd+0x20d/0x320
[ 1572.098268]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1572.099134]  ? write_comp_data+0x2f/0x90
[ 1572.100400]  __x64_sys_perf_event_open+0x26/0x30
[ 1572.101222]  do_syscall_64+0x37/0x80
[ 1572.101888]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1572.102763] RIP: 0033:0x7fac0740459d
[ 1572.103408] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1572.106284] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1572.107531] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1572.108678] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1572.109831] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1572.111020] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1572.112173] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1572.114119] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1572.114137] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1572.115344] caller is debug_smp_processor_id+0x1c/0x20
[ 1572.116574] caller is debug_smp_processor_id+0x1c/0x20
[ 1572.117381] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1572.119300] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1572.121056] Call Trace:
[ 1572.121499]  dump_stack_lvl+0xa4/0xd3
[ 1572.122189]  dump_stack+0x15/0x17
[ 1572.122768]  check_preemption_disabled+0x167/0x180
[ 1572.123635]  debug_smp_processor_id+0x1c/0x20
[ 1572.124377]  perf_trace_buf_alloc+0x98/0x100
[ 1572.125109]  ? __get_locked_pte+0x1a2/0x290
[ 1572.125810]  ? __lock_text_start+0x8/0x8
[ 1572.126525]  perf_ftrace_function_call+0x209/0x360
[ 1572.127575]  ? 0xffffffffa0098099
[ 1572.128291]  0xffffffffa0098099
[ 1572.128882]  ? usb_enable_endpoint+0x1/0x110
[ 1572.129628]  ? ftrace_call+0x5/0x44
[ 1572.130281]  ? pmd_page_vaddr+0x2b/0x70
[ 1572.130980]  ? _raw_spin_lock+0x5/0x50
[ 1572.131676]  _raw_spin_lock+0x5/0x50
[ 1572.132307]  __get_locked_pte+0x1a2/0x290
[ 1572.132990]  ? _raw_spin_lock+0x5/0x50
[ 1572.133626]  ? __get_locked_pte+0x1a2/0x290
[ 1572.134371]  ? usb_enable_endpoint+0x1/0x110
[ 1572.135118]  __text_poke+0xea/0x4e0
[ 1572.135730]  ? usb_enable_endpoint+0x1/0x110
[ 1572.136481]  ? lock_is_held_type+0xe2/0x140
[ 1572.137170]  ? usb_enable_endpoint+0x1/0x110
[ 1572.137912]  text_poke+0x2b/0x60
[ 1572.138522]  text_poke_bp_batch+0xf5/0x2c0
[ 1572.139238]  ? ehci_remove+0x50/0x50
[ 1572.139884]  text_poke_queue+0xa7/0xc0
[ 1572.140555]  ftrace_replace_code+0xfd/0x170
[ 1572.141296]  ftrace_modify_all_code+0x1b1/0x270
[ 1572.142086]  arch_ftrace_update_code+0x9/0x10
[ 1572.142786]  ftrace_run_update_code+0x30/0xa0
[ 1572.143511]  ftrace_startup_enable+0x5e/0xa0
[ 1572.144227]  ftrace_startup+0x16d/0x240
[ 1572.144942]  register_ftrace_function+0x43/0x90
[ 1572.145731]  perf_ftrace_event_register+0xc1/0xf0
[ 1572.146566]  perf_trace_event_init+0xa0/0x4c0
[ 1572.147367]  perf_trace_init+0xda/0x160
[ 1572.148083]  perf_tp_event_init+0x57/0xa0
[ 1572.148802]  perf_try_init_event+0x83/0x270
[ 1572.149589]  perf_event_alloc+0xe3f/0x1c10
[ 1572.150297]  ? _raw_spin_unlock+0x2c/0x50
[ 1572.150999]  ? alloc_fd+0x20d/0x320
[ 1572.151730]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1572.152558]  ? write_comp_data+0x2f/0x90
[ 1572.153642]  __x64_sys_perf_event_open+0x26/0x30
[ 1572.154440]  do_syscall_64+0x37/0x80
[ 1572.155073]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1572.155909] RIP: 0033:0x7fac0740459d
[ 1572.156528] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1572.159259] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1572.160415] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1572.161491] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1572.162585] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1572.163655] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1572.164727] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1572.166050] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1572.166238] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1572.167205] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1572.168346] caller is debug_smp_processor_id+0x1c/0x20
[ 1572.169888] Call Trace:
[ 1572.171057]  dump_stack_lvl+0xa4/0xd3
[ 1572.171639]  dump_stack+0x15/0x17
[ 1572.172155]  check_preemption_disabled+0x167/0x180
[ 1572.172862]  ? do_epoll_wait+0x3b3/0xd80
[ 1572.173449]  ? __mutex_lock+0x9f0/0x9f0
[ 1572.174047]  debug_smp_processor_id+0x1c/0x20
[ 1572.174705]  perf_ftrace_function_call+0x7c/0x360
[ 1572.175455]  ? ftrace_call+0x5/0x44
[ 1572.175973]  ? trace_hardirqs_on+0x6a/0x170
[ 1572.176637]  ? finish_task_switch+0xb0/0x2a0
[ 1572.177269]  ? finish_task_switch+0x70/0x2a0
[ 1572.177926]  ? trace_hardirqs_on+0x3f/0x170
[ 1572.178586]  ? finish_task_switch+0x70/0x2a0
[ 1572.179271]  ? preempt_count_sub+0x5/0xa0
[ 1572.179959]  0xffffffffa0098099
[ 1572.180472]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1572.181199]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1572.182040]  ? do_epoll_wait+0x36b/0xd80
[ 1572.182668]  ? mutex_lock_nested+0x5/0x20
[ 1572.183273]  ? write_comp_data+0x2f/0x90
[ 1572.183875]  mutex_lock_nested+0x5/0x20
[ 1572.184455]  do_epoll_wait+0x3b3/0xd80
[ 1572.185028]  ? mutex_lock_nested+0x5/0x20
[ 1572.185623]  ? do_epoll_wait+0x3b3/0xd80
[ 1572.186390]  ? wait_woken+0x90/0x90
[ 1572.186993]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1572.187690]  do_syscall_64+0x37/0x80
[ 1572.188238]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1572.188977] RIP: 0033:0x7f8a39143b20
[ 1572.189512] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1572.192061] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1572.193134] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1572.194135] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1572.195117] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1572.196131] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1572.197139] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1572.198354] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1572.198535] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1572.199479] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1572.200620] caller is debug_smp_processor_id+0x1c/0x20
[ 1572.202307] Call Trace:
[ 1572.202345]  dump_stack_lvl+0xa4/0xd3
[ 1572.202428]  dump_stack+0x15/0x17
[ 1572.204547]  check_preemption_disabled+0x167/0x180
[ 1572.205397]  debug_smp_processor_id+0x1c/0x20
[ 1572.206110]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1572.206991]  perf_tp_event+0x331/0x4e0
[ 1572.207951]  ? arch_local_irq_enable+0x10/0x12
[ 1572.208680]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1572.209460]  ? dump_stack_lvl+0xcc/0xd3
[ 1572.210161]  ? dump_stack+0x15/0x17
[ 1572.210760]  ? check_preemption_disabled+0x167/0x180
[ 1572.211608]  ? __get_locked_pte+0x1a2/0x290
[ 1572.212279]  ? __lock_text_start+0x8/0x8
[ 1572.212947]  perf_ftrace_function_call+0x248/0x360
[ 1572.213706]  ? perf_ftrace_function_call+0x248/0x360
[ 1572.214780]  ? 0xffffffffa0098099
[ 1572.215466]  0xffffffffa0098099
[ 1572.216023]  ? usb_enable_endpoint+0x1/0x110
[ 1572.216742]  ? ftrace_call+0x5/0x44
[ 1572.217353]  ? pmd_page_vaddr+0x2b/0x70
[ 1572.218023]  ? _raw_spin_lock+0x5/0x50
[ 1572.218720]  _raw_spin_lock+0x5/0x50
[ 1572.219329]  __get_locked_pte+0x1a2/0x290
[ 1572.220019]  ? _raw_spin_lock+0x5/0x50
[ 1572.220653]  ? __get_locked_pte+0x1a2/0x290
[ 1572.221395]  ? usb_enable_endpoint+0x1/0x110
[ 1572.222168]  __text_poke+0xea/0x4e0
[ 1572.222778]  ? usb_enable_endpoint+0x1/0x110
[ 1572.223535]  ? lock_is_held_type+0xe2/0x140
[ 1572.224268]  ? usb_enable_endpoint+0x1/0x110
[ 1572.225044]  text_poke+0x2b/0x60
[ 1572.225661]  text_poke_bp_batch+0xf5/0x2c0
[ 1572.226427]  ? ehci_remove+0x50/0x50
[ 1572.227107]  text_poke_queue+0xa7/0xc0
[ 1572.227812]  ftrace_replace_code+0xfd/0x170
[ 1572.228590]  ftrace_modify_all_code+0x1b1/0x270
[ 1572.229404]  arch_ftrace_update_code+0x9/0x10
[ 1572.230167]  ftrace_run_update_code+0x30/0xa0
[ 1572.230935]  ftrace_startup_enable+0x5e/0xa0
[ 1572.231685]  ftrace_startup+0x16d/0x240
[ 1572.232444]  register_ftrace_function+0x43/0x90
[ 1572.233240]  perf_ftrace_event_register+0xc1/0xf0
[ 1572.234063]  perf_trace_event_init+0xa0/0x4c0
[ 1572.234867]  perf_trace_init+0xda/0x160
[ 1572.235585]  perf_tp_event_init+0x57/0xa0
[ 1572.236297]  perf_try_init_event+0x83/0x270
[ 1572.237087]  perf_event_alloc+0xe3f/0x1c10
[ 1572.237781]  ? _raw_spin_unlock+0x2c/0x50
[ 1572.238500]  ? alloc_fd+0x20d/0x320
[ 1572.239238]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1572.240076]  ? write_comp_data+0x2f/0x90
[ 1572.241136]  __x64_sys_perf_event_open+0x26/0x30
[ 1572.241903]  do_syscall_64+0x37/0x80
[ 1572.242526]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1572.243320] RIP: 0033:0x7fac0740459d
[ 1572.243903] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1572.246698] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1572.247910] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1572.249047] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1572.250180] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1572.251245] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1572.252314] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1572.253646] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1572.253839] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1572.254790] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1572.254812] Call Trace:
[ 1572.254840]  dump_stack_lvl+0xa4/0xd3
[ 1572.254905]  dump_stack+0x15/0x17
[ 1572.254941]  check_preemption_disabled+0x167/0x180
[ 1572.256158] caller is debug_smp_processor_id+0x1c/0x20
[ 1572.257703]  ? mutex_lock_nested+0x1b/0x20
[ 1572.261041]  ? mutex_lock_io_nested+0x940/0x940
[ 1572.261739]  debug_smp_processor_id+0x1c/0x20
[ 1572.262425]  perf_ftrace_function_call+0x7c/0x360
[ 1572.263124]  ? perf_ftrace_function_call+0x4c/0x360
[ 1572.263890]  ? ftrace_call+0x5/0x44
[ 1572.264414]  ? trace_hardirqs_on+0x6a/0x170
[ 1572.265070]  ? finish_task_switch+0xb0/0x2a0
[ 1572.265711]  ? finish_task_switch+0x70/0x2a0
[ 1572.266397]  ? trace_hardirqs_on+0x3f/0x170
[ 1572.267007]  ? finish_task_switch+0x70/0x2a0
[ 1572.267723]  0xffffffffa0098099
[ 1572.268210]  ? 0xffffffffa0098099
[ 1572.268726]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1572.269430]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1572.270315]  ? do_epoll_wait+0x3b3/0xd80
[ 1572.271000]  ? __mutex_lock+0x5/0x9f0
[ 1572.271581]  ? mutex_lock_nested+0x5/0x20
[ 1572.272219]  ? write_comp_data+0x2f/0x90
[ 1572.272837]  __mutex_lock+0x5/0x9f0
[ 1572.273398]  mutex_lock_nested+0x1b/0x20
[ 1572.274027]  ? __mutex_lock+0x5/0x9f0
[ 1572.274582]  ? mutex_lock_nested+0x1b/0x20
[ 1572.275197]  do_epoll_wait+0x3b3/0xd80
[ 1572.275918]  ? wait_woken+0x90/0x90
[ 1572.276526]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1572.277211]  do_syscall_64+0x37/0x80
[ 1572.277777]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1572.278560] RIP: 0033:0x7f8a39143b20
[ 1572.279101] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1572.281667] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1572.282782] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1572.283772] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1572.284765] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1572.285804] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1572.286834] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1572.288025] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1572.288137] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1572.289231] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1572.290487] caller is debug_smp_processor_id+0x1c/0x20
[ 1572.292193] Call Trace:
[ 1572.293351]  dump_stack_lvl+0xa4/0xd3
[ 1572.294099]  dump_stack+0x15/0x17
[ 1572.294715]  check_preemption_disabled+0x167/0x180
[ 1572.295586]  ? __get_locked_pte+0x1a2/0x290
[ 1572.296362]  ? __lock_text_start+0x8/0x8
[ 1572.297114]  debug_smp_processor_id+0x1c/0x20
[ 1572.297894]  perf_ftrace_function_call+0x7c/0x360
[ 1572.299037]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1572.299856]  ? write_comp_data+0x2f/0x90
[ 1572.300579]  ? perf_trace_buf_update+0x70/0x70
[ 1572.301490]  0xffffffffa0098099
[ 1572.302159]  ? usb_enable_interface+0x1/0xa0
[ 1572.302958]  ? ftrace_call+0x5/0x44
[ 1572.303632]  ? pmd_page_vaddr+0x2b/0x70
[ 1572.304384]  ? _raw_spin_lock+0x5/0x50
[ 1572.305139]  _raw_spin_lock+0x5/0x50
[ 1572.305791]  __get_locked_pte+0x1a2/0x290
[ 1572.306528]  ? _raw_spin_lock+0x5/0x50
[ 1572.307184]  ? __get_locked_pte+0x1a2/0x290
[ 1572.307967]  ? usb_enable_interface+0x1/0xa0
[ 1572.308764]  __text_poke+0xea/0x4e0
[ 1572.309401]  ? usb_enable_interface+0x1/0xa0
[ 1572.310213]  ? lock_is_held_type+0xe2/0x140
[ 1572.310995]  ? usb_enable_interface+0x1/0xa0
[ 1572.311826]  text_poke+0x2b/0x60
[ 1572.312478]  text_poke_bp_batch+0xf5/0x2c0
[ 1572.313287]  ? ehci_remove+0x50/0x50
[ 1572.314016]  text_poke_queue+0xa7/0xc0
[ 1572.314784]  ftrace_replace_code+0xfd/0x170
[ 1572.315624]  ftrace_modify_all_code+0x1b1/0x270
[ 1572.316500]  arch_ftrace_update_code+0x9/0x10
[ 1572.317275]  ftrace_run_update_code+0x30/0xa0
[ 1572.318092]  ftrace_startup_enable+0x5e/0xa0
[ 1572.318909]  ftrace_startup+0x16d/0x240
[ 1572.319735]  register_ftrace_function+0x43/0x90
[ 1572.320565]  perf_ftrace_event_register+0xc1/0xf0
[ 1572.321424]  perf_trace_event_init+0xa0/0x4c0
[ 1572.322323]  perf_trace_init+0xda/0x160
[ 1572.323094]  perf_tp_event_init+0x57/0xa0
[ 1572.323845]  perf_try_init_event+0x83/0x270
[ 1572.324699]  perf_event_alloc+0xe3f/0x1c10
[ 1572.325421]  ? _raw_spin_unlock+0x2c/0x50
[ 1572.326177]  ? alloc_fd+0x20d/0x320
[ 1572.327038]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1572.327919]  ? write_comp_data+0x2f/0x90
[ 1572.329201]  __x64_sys_perf_event_open+0x26/0x30
[ 1572.330034]  do_syscall_64+0x37/0x80
[ 1572.330748]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1572.331608] RIP: 0033:0x7fac0740459d
[ 1572.332260] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1572.335196] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1572.336454] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1572.337612] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1572.338793] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1572.339952] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1572.341122] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1572.342694] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1572.342875] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1572.343824] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1572.345049] caller is debug_smp_processor_id+0x1c/0x20
[ 1572.346598] Call Trace:
[ 1572.346627]  dump_stack_lvl+0xa4/0xd3
[ 1572.346693]  dump_stack+0x15/0x17
[ 1572.346729]  check_preemption_disabled+0x167/0x180
[ 1572.346768]  ? ep_start_scan+0x68/0x100
[ 1572.350110]  ? _raw_read_lock_irq+0xa0/0xa0
[ 1572.350782]  debug_smp_processor_id+0x1c/0x20
[ 1572.351426]  perf_ftrace_function_call+0x7c/0x360
[ 1572.352123]  ? ftrace_ops_test+0x71/0xc0
[ 1572.352716]  ? preempt_notifier_dec+0x20/0x20
[ 1572.353420]  ? ftrace_call+0x5/0x44
[ 1572.353994]  ? write_comp_data+0x2f/0x90
[ 1572.354633]  ? perf_trace_buf_update+0x70/0x70
[ 1572.355295]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1572.356045]  0xffffffffa0098099
[ 1572.356576]  ? ftrace_call+0x5/0x44
[ 1572.357102]  ? __mutex_lock+0xfe/0x9f0
[ 1572.357670]  ? do_epoll_wait+0x3b3/0xd80
[ 1572.358279]  ? ep_start_scan+0xe0/0x100
[ 1572.358893]  ? _raw_write_lock_irq+0x5/0x60
[ 1572.359520]  ? write_comp_data+0x2f/0x90
[ 1572.360120]  _raw_write_lock_irq+0x5/0x60
[ 1572.360724]  ep_start_scan+0x68/0x100
[ 1572.361276]  ? _raw_write_lock_irq+0x5/0x60
[ 1572.361899]  ? ep_start_scan+0x68/0x100
[ 1572.362552]  do_epoll_wait+0x3bf/0xd80
[ 1572.363283]  ? wait_woken+0x90/0x90
[ 1572.363884]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1572.364582]  do_syscall_64+0x37/0x80
[ 1572.365139]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1572.365861] RIP: 0033:0x7f8a39143b20
[ 1572.366429] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1572.368934] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1572.370003] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1572.371037] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1572.372027] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1572.373016] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1572.374005] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1572.375241] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1572.375357] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1572.376450] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1572.377589] caller is debug_smp_processor_id+0x1c/0x20
[ 1572.379413] Call Trace:
[ 1572.379469]  dump_stack_lvl+0xa4/0xd3
[ 1572.381304]  dump_stack+0x15/0x17
[ 1572.381934]  check_preemption_disabled+0x167/0x180
[ 1572.382908]  debug_smp_processor_id+0x1c/0x20
[ 1572.383681]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1572.384701]  perf_trace_buf_alloc+0x3d/0x100
[ 1572.385469]  ? __get_locked_pte+0x1a2/0x290
[ 1572.386212]  ? __lock_text_start+0x8/0x8
[ 1572.386954]  perf_ftrace_function_call+0x209/0x360
[ 1572.388136]  ? 0xffffffffa0098099
[ 1572.388946]  0xffffffffa0098099
[ 1572.389584]  ? usb_enable_interface+0x1/0xa0
[ 1572.390436]  ? ftrace_call+0x5/0x44
[ 1572.391126]  ? pmd_page_vaddr+0x2b/0x70
[ 1572.391877]  ? _raw_spin_lock+0x5/0x50
[ 1572.392624]  _raw_spin_lock+0x5/0x50
[ 1572.393285]  __get_locked_pte+0x1a2/0x290
[ 1572.394008]  ? _raw_spin_lock+0x5/0x50
[ 1572.394707]  ? __get_locked_pte+0x1a2/0x290
[ 1572.395510]  ? usb_enable_interface+0x1/0xa0
[ 1572.396350]  __text_poke+0xea/0x4e0
[ 1572.397006]  ? usb_enable_interface+0x1/0xa0
[ 1572.397805]  ? lock_is_held_type+0xe2/0x140
[ 1572.398608]  ? usb_enable_interface+0x1/0xa0
[ 1572.399433]  text_poke+0x2b/0x60
[ 1572.400095]  text_poke_bp_batch+0xf5/0x2c0
[ 1572.400906]  ? ehci_remove+0x50/0x50
[ 1572.401628]  text_poke_queue+0xa7/0xc0
[ 1572.402429]  ftrace_replace_code+0xfd/0x170
[ 1572.403283]  ftrace_modify_all_code+0x1b1/0x270
[ 1572.404160]  arch_ftrace_update_code+0x9/0x10
[ 1572.404927]  ftrace_run_update_code+0x30/0xa0
[ 1572.405736]  ftrace_startup_enable+0x5e/0xa0
[ 1572.406563]  ftrace_startup+0x16d/0x240
[ 1572.407389]  register_ftrace_function+0x43/0x90
[ 1572.408215]  perf_ftrace_event_register+0xc1/0xf0
[ 1572.409082]  perf_trace_event_init+0xa0/0x4c0
[ 1572.409950]  perf_trace_init+0xda/0x160
[ 1572.410775]  perf_tp_event_init+0x57/0xa0
[ 1572.411527]  perf_try_init_event+0x83/0x270
[ 1572.412383]  perf_event_alloc+0xe3f/0x1c10
[ 1572.413103]  ? _raw_spin_unlock+0x2c/0x50
[ 1572.413835]  ? alloc_fd+0x20d/0x320
[ 1572.414705]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1572.415582]  ? write_comp_data+0x2f/0x90
[ 1572.416858]  __x64_sys_perf_event_open+0x26/0x30
[ 1572.417700]  do_syscall_64+0x37/0x80
[ 1572.418404]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1572.419267] RIP: 0033:0x7fac0740459d
[ 1572.419919] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1572.422843] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1572.424104] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1572.425262] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1572.426424] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1572.427604] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1572.428759] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1572.430310] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1572.430488] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1572.431456] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1572.432595] caller is debug_smp_processor_id+0x1c/0x20
[ 1572.434167] Call Trace:
[ 1572.434197]  dump_stack_lvl+0xa4/0xd3
[ 1572.434262]  dump_stack+0x15/0x17
[ 1572.434299]  check_preemption_disabled+0x167/0x180
[ 1572.434338]  ? ep_done_scan+0x3b/0x240
[ 1572.437617]  ? _raw_read_lock_irq+0xa0/0xa0
[ 1572.438290]  debug_smp_processor_id+0x1c/0x20
[ 1572.438990]  perf_ftrace_function_call+0x7c/0x360
[ 1572.439703]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1572.440409]  ? ftrace_ops_test+0x71/0xc0
[ 1572.441038]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1572.441749]  ? _prb_read_valid+0x3ad/0x3f0
[ 1572.442437]  ? write_comp_data+0x2f/0x90
[ 1572.443127]  0xffffffffa0098099
[ 1572.443690]  ? ep_destroy_wakeup_source+0xe0/0xe0
[ 1572.444542]  ? do_epoll_wait+0x85a/0xd80
[ 1572.445224]  ? _raw_write_lock_irq+0x5/0x60
[ 1572.445950]  _raw_write_lock_irq+0x5/0x60
[ 1572.446623]  ep_done_scan+0x3b/0x240
[ 1572.447223]  ? _raw_write_lock_irq+0x5/0x60
[ 1572.447895]  ? ep_done_scan+0x3b/0x240
[ 1572.448598]  do_epoll_wait+0xabb/0xd80
[ 1572.449387]  ? wait_woken+0x90/0x90
[ 1572.450067]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1572.450841]  do_syscall_64+0x37/0x80
[ 1572.451447]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1572.452247] RIP: 0033:0x7f8a39143b20
[ 1572.452831] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1572.455594] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1572.456756] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1572.457832] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1572.458924] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1572.460005] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1572.461076] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1572.462380] CPU: 0 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1572.463627] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1572.465444] Call Trace:
[ 1572.465902]  dump_stack_lvl+0xa4/0xd3
[ 1572.466625]  dump_stack+0x15/0x17
[ 1572.467227]  check_preemption_disabled+0x167/0x180
[ 1572.468129]  debug_smp_processor_id+0x1c/0x20
[ 1572.468895]  perf_trace_buf_alloc+0x98/0x100
[ 1572.469652]  ? __get_locked_pte+0x1a2/0x290
[ 1572.470398]  ? __lock_text_start+0x8/0x8
[ 1572.471115]  perf_ftrace_function_call+0x209/0x360
[ 1572.472206]  ? 0xffffffffa0098099
[ 1572.472946]  0xffffffffa0098099
[ 1572.473560]  ? usb_enable_interface+0x1/0xa0
[ 1572.474351]  ? ftrace_call+0x5/0x44
[ 1572.475004]  ? pmd_page_vaddr+0x2b/0x70
[ 1572.475733]  ? _raw_spin_lock+0x5/0x50
[ 1572.476457]  _raw_spin_lock+0x5/0x50
[ 1572.477100]  __get_locked_pte+0x1a2/0x290
[ 1572.477812]  ? _raw_spin_lock+0x5/0x50
[ 1572.478491]  ? __get_locked_pte+0x1a2/0x290
[ 1572.479265]  ? usb_enable_interface+0x1/0xa0
[ 1572.480052]  __text_poke+0xea/0x4e0
[ 1572.480662]  ? usb_enable_interface+0x1/0xa0
[ 1572.481389]  ? lock_is_held_type+0xe2/0x140
[ 1572.482106]  ? usb_enable_interface+0x1/0xa0
[ 1572.482847]  text_poke+0x2b/0x60
[ 1572.483437]  text_poke_bp_batch+0xf5/0x2c0
[ 1572.484192]  ? ehci_remove+0x50/0x50
[ 1572.484841]  text_poke_queue+0xa7/0xc0
[ 1572.485520]  ftrace_replace_code+0xfd/0x170
[ 1572.486274]  ftrace_modify_all_code+0x1b1/0x270
[ 1572.487059]  arch_ftrace_update_code+0x9/0x10
[ 1572.487768]  ftrace_run_update_code+0x30/0xa0
[ 1572.488490]  ftrace_startup_enable+0x5e/0xa0
[ 1572.489206]  ftrace_startup+0x16d/0x240
[ 1572.489927]  register_ftrace_function+0x43/0x90
[ 1572.490687]  perf_ftrace_event_register+0xc1/0xf0
[ 1572.491470]  perf_trace_event_init+0xa0/0x4c0
[ 1572.492253]  perf_trace_init+0xda/0x160
[ 1572.492929]  perf_tp_event_init+0x57/0xa0
[ 1572.493611]  perf_try_init_event+0x83/0x270
[ 1572.494379]  perf_event_alloc+0xe3f/0x1c10
[ 1572.495035]  ? _raw_spin_unlock+0x2c/0x50
[ 1572.495731]  ? alloc_fd+0x20d/0x320
[ 1572.496467]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1572.497266]  ? write_comp_data+0x2f/0x90
[ 1572.498347]  __x64_sys_perf_event_open+0x26/0x30
[ 1572.499114]  do_syscall_64+0x37/0x80
[ 1572.499747]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1572.500578] RIP: 0033:0x7fac0740459d
[ 1572.501200] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1572.504058] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1572.505274] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1572.506420] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1572.507545] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1572.508675] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1572.509802] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1577.061984] check_preemption_disabled: 2031687 callbacks suppressed
[ 1577.061997] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1577.062003] BUG: using smp_processor_id() in preemptible [00000000] code: systemctl/23083
[ 1577.062864] caller is debug_smp_processor_id+0x1c/0x20
[ 1577.063889] caller is debug_smp_processor_id+0x1c/0x20
[ 1577.064930] CPU: 1 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1577.067222] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1577.068747] Call Trace:
[ 1577.069093]  dump_stack_lvl+0xa4/0xd3
[ 1577.069603]  dump_stack+0x15/0x17
[ 1577.070077]  check_preemption_disabled+0x167/0x180
[ 1577.070734]  ? __get_locked_pte+0x1a2/0x290
[ 1577.071309]  ? __lock_text_start+0x8/0x8
[ 1577.071857]  debug_smp_processor_id+0x1c/0x20
[ 1577.072453]  perf_ftrace_function_call+0x7c/0x360
[ 1577.073093]  ? __text_poke+0x2f2/0x4e0
[ 1577.073610]  ? _raw_spin_trylock_bh+0x80/0x80
[ 1577.074221]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1577.074863]  ? __text_poke+0x2f2/0x4e0
[ 1577.075391]  ? perf_ftrace_function_call+0x4c/0x360
[ 1577.076060]  ? irqentry_exit+0x3a/0x90
[ 1577.076582]  ? sysvec_apic_timer_interrupt+0xc8/0xd0
[ 1577.077273]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1577.078002]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1577.078658]  ? pmd_page_vaddr+0x2b/0x70
[ 1577.079187]  ? _raw_spin_lock+0x5/0x50
[ 1577.079707]  ? _raw_spin_lock+0x5/0x50
[ 1577.080222]  ? __get_locked_pte+0x1a2/0x290
[ 1577.080801]  ? _raw_spin_lock+0x5/0x50
[ 1577.081316]  ? __get_locked_pte+0x1a2/0x290
[ 1577.081886]  ? dma_async_device_channel_unregister+0x30/0x30
[ 1577.082668]  ? __text_poke+0xea/0x4e0
[ 1577.083177]  ? lock_is_held_type+0xe2/0x140
[ 1577.083748]  ? dma_async_device_channel_unregister+0x30/0x30
[ 1577.084506]  ? text_poke+0x2b/0x60
[ 1577.084976]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1577.085574]  ? register_virtio_driver+0x60/0x60
[ 1577.086201]  ? text_poke_queue+0xa7/0xc0
[ 1577.086739]  ? ftrace_replace_code+0xfd/0x170
[ 1577.087341]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1577.087980]  ? arch_ftrace_update_code+0x9/0x10
[ 1577.088601]  ? ftrace_run_update_code+0x30/0xa0
[ 1577.089228]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1577.089801]  ? unregister_ftrace_function+0x25/0x50
[ 1577.090481]  ? perf_ftrace_event_register+0x89/0xf0
[ 1577.091147]  ? perf_tp_event_init+0xa0/0xa0
[ 1577.091722]  ? perf_trace_destroy+0x37/0x60
[ 1577.092294]  ? tp_perf_event_destroy+0x15/0x20
[ 1577.092902]  ? _free_event+0xfc/0x7d0
[ 1577.093410]  ? put_event+0x37/0x50
[ 1577.093888]  ? perf_event_release_kernel+0x2f4/0x370
[ 1577.094578]  ? perf_event_release_kernel+0x370/0x370
[ 1577.095251]  ? perf_release+0x19/0x20
[ 1577.095755]  ? __fput+0x12d/0x460
[ 1577.096230]  ? ____fput+0x1a/0x20
[ 1577.096693]  ? task_work_run+0x8e/0xf0
[ 1577.097213]  ? do_exit+0x616/0x1310
[ 1577.097700]  ? write_comp_data+0x2f/0x90
[ 1577.098253]  ? do_group_exit+0x7e/0x130
[ 1577.098772]  ? get_signal+0x249/0x13c0
[ 1577.099272]  ? get_signal+0x5/0x13c0
[ 1577.099761]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1577.100422]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1577.101056]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1577.101715]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1577.102360]  ? do_syscall_64+0x46/0x80
[ 1577.102861]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1577.103563] CPU: 0 PID: 23083 Comm: systemctl Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1577.103629] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1577.104584] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1577.105584] caller is debug_smp_processor_id+0x1c/0x20
[ 1577.107061] Call Trace:
[ 1577.107070]  dump_stack_lvl+0xa4/0xd3
[ 1577.108585]  dump_stack+0x15/0x17
[ 1577.109031]  check_preemption_disabled+0x167/0x180
[ 1577.109663]  ? slab_post_alloc_hook+0x7b/0x3e0
[ 1577.110262]  ? kmemleak_free_part_phys+0x20/0x20
[ 1577.110873]  debug_smp_processor_id+0x1c/0x20
[ 1577.111481]  perf_ftrace_function_call+0x7c/0x360
[ 1577.112131]  ? lock_is_held_type+0xe2/0x140
[ 1577.112737]  ? __unlock_page_memcg+0x29/0xa0
[ 1577.113349]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1577.114026]  ? kmemleak_alloc+0x5/0x80
[ 1577.114566]  ? kmemleak_alloc+0x5/0x80
[ 1577.115096]  ? slab_post_alloc_hook+0x7b/0x3e0
[ 1577.115709]  ? kmemleak_alloc+0x5/0x80
[ 1577.116236]  ? slab_post_alloc_hook+0x7b/0x3e0
[ 1577.116842]  ? getname_flags+0x67/0x2d0
[ 1577.117371]  ? kmem_cache_alloc+0x157/0x300
[ 1577.117939]  ? write_comp_data+0x2f/0x90
[ 1577.118491]  ? getname_flags+0x67/0x2d0
[ 1577.119022]  ? getname+0x1e/0x30
[ 1577.119488]  ? do_sys_openat2+0x3b0/0x700
[ 1577.120066]  ? do_sys_open+0x8e/0xe0
[ 1577.120578]  ? __x64_sys_openat+0x29/0x30
[ 1577.121144]  ? do_syscall_64+0x37/0x80
[ 1577.121660]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1577.122399] CPU: 1 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1577.122459] BUG: using smp_processor_id() in preemptible [00000000] code: systemctl/23083
[ 1577.123392] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1577.124460] caller is debug_smp_processor_id+0x1c/0x20
[ 1577.125979] Call Trace:
[ 1577.125988]  dump_stack_lvl+0xa4/0xd3
[ 1577.127514]  dump_stack+0x15/0x17
[ 1577.127962]  check_preemption_disabled+0x167/0x180
[ 1577.128591]  ? __get_locked_pte+0x1a2/0x290
[ 1577.129174]  ? __lock_text_start+0x8/0x8
[ 1577.129703]  debug_smp_processor_id+0x1c/0x20
[ 1577.130299]  perf_ftrace_function_call+0x7c/0x360
[ 1577.130929]  ? __text_poke+0x2f2/0x4e0
[ 1577.131441]  ? _raw_spin_trylock_bh+0x80/0x80
[ 1577.132035]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1577.132666]  ? __text_poke+0x2f2/0x4e0
[ 1577.133178]  ? perf_ftrace_function_call+0x4c/0x360
[ 1577.133835]  ? __lock_acquire+0xa2a/0x1ba0
[ 1577.134412]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1577.135037]  ? pmd_page_vaddr+0x2b/0x70
[ 1577.135558]  ? _raw_spin_lock+0x5/0x50
[ 1577.136071]  ? _raw_spin_lock+0x5/0x50
[ 1577.136604]  ? __get_locked_pte+0x1a2/0x290
[ 1577.137195]  ? _raw_spin_lock+0x5/0x50
[ 1577.137727]  ? __get_locked_pte+0x1a2/0x290
[ 1577.138321]  ? dma_sync_wait+0xe0/0xe0
[ 1577.138835]  ? __text_poke+0xea/0x4e0
[ 1577.139331]  ? lock_is_held_type+0xe2/0x140
[ 1577.139888]  ? dma_sync_wait+0xe0/0xe0
[ 1577.140421]  ? text_poke+0x2b/0x60
[ 1577.140899]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1577.141504]  ? register_virtio_driver+0x60/0x60
[ 1577.142119]  ? text_poke_queue+0xa7/0xc0
[ 1577.142650]  ? ftrace_replace_code+0xfd/0x170
[ 1577.143239]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1577.143870]  ? arch_ftrace_update_code+0x9/0x10
[ 1577.144472]  ? ftrace_run_update_code+0x30/0xa0
[ 1577.145077]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1577.145627]  ? unregister_ftrace_function+0x25/0x50
[ 1577.146293]  ? perf_ftrace_event_register+0x89/0xf0
[ 1577.146937]  ? perf_tp_event_init+0xa0/0xa0
[ 1577.147490]  ? perf_trace_destroy+0x37/0x60
[ 1577.148043]  ? tp_perf_event_destroy+0x15/0x20
[ 1577.148628]  ? _free_event+0xfc/0x7d0
[ 1577.149118]  ? put_event+0x37/0x50
[ 1577.149577]  ? perf_event_release_kernel+0x2f4/0x370
[ 1577.150275]  ? perf_event_release_kernel+0x370/0x370
[ 1577.150972]  ? perf_release+0x19/0x20
[ 1577.151497]  ? __fput+0x12d/0x460
[ 1577.151979]  ? ____fput+0x1a/0x20
[ 1577.152449]  ? task_work_run+0x8e/0xf0
[ 1577.152981]  ? do_exit+0x616/0x1310
[ 1577.153479]  ? write_comp_data+0x2f/0x90
[ 1577.154035]  ? do_group_exit+0x7e/0x130
[ 1577.154593]  ? get_signal+0x249/0x13c0
[ 1577.155125]  ? get_signal+0x5/0x13c0
[ 1577.155637]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1577.156319]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1577.156989]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1577.157680]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1577.158364]  ? do_syscall_64+0x46/0x80
[ 1577.158892]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1577.159637] CPU: 0 PID: 23083 Comm: systemctl Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1577.159691] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1577.160710] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1577.161734] caller is debug_smp_processor_id+0x1c/0x20
[ 1577.163244] Call Trace:
[ 1577.163252]  dump_stack_lvl+0xa4/0xd3
[ 1577.163269]  dump_stack+0x15/0x17
[ 1577.165155]  check_preemption_disabled+0x167/0x180
[ 1577.165788]  ? alloc_fd+0x47/0x320
[ 1577.166264]  ? __lock_text_start+0x8/0x8
[ 1577.166795]  debug_smp_processor_id+0x1c/0x20
[ 1577.167393]  perf_ftrace_function_call+0x7c/0x360
[ 1577.168014]  ? __lock_acquire+0xa2a/0x1ba0
[ 1577.168603]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1577.169270]  ? lock_is_held_type+0xe2/0x140
[ 1577.169860]  ? write_comp_data+0x2f/0x90
[ 1577.170437]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1577.171106]  ? write_comp_data+0x2f/0x90
[ 1577.171666]  ? do_sys_openat2+0x3c2/0x700
[ 1577.172242]  ? _raw_spin_lock+0x5/0x50
[ 1577.172783]  ? write_comp_data+0x2f/0x90
[ 1577.173339]  ? _raw_spin_lock+0x5/0x50
[ 1577.173877]  ? alloc_fd+0x47/0x320
[ 1577.174375]  ? _raw_spin_lock+0x5/0x50
[ 1577.174910]  ? alloc_fd+0x47/0x320
[ 1577.175407]  ? get_unused_fd_flags+0x31/0x40
[ 1577.176013]  ? do_sys_openat2+0x4b6/0x700
[ 1577.176592]  ? do_sys_open+0x8e/0xe0
[ 1577.177109]  ? __x64_sys_openat+0x29/0x30
[ 1577.177677]  ? do_syscall_64+0x37/0x80
[ 1577.178225]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1577.178997] CPU: 1 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1577.179051] BUG: using smp_processor_id() in preemptible [00000000] code: systemctl/23083
[ 1577.180048] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1577.181150] caller is debug_smp_processor_id+0x1c/0x20
[ 1577.182686] Call Trace:
[ 1577.182695]  dump_stack_lvl+0xa4/0xd3
[ 1577.184279]  dump_stack+0x15/0x17
[ 1577.184780]  check_preemption_disabled+0x167/0x180
[ 1577.185493]  ? __get_locked_pte+0x1a2/0x290
[ 1577.186104]  ? __lock_text_start+0x8/0x8
[ 1577.186662]  debug_smp_processor_id+0x1c/0x20
[ 1577.187281]  perf_ftrace_function_call+0x7c/0x360
[ 1577.187941]  ? __text_poke+0x2f2/0x4e0
[ 1577.188470]  ? _raw_spin_trylock_bh+0x80/0x80
[ 1577.189095]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1577.189768]  ? __text_poke+0x2f2/0x4e0
[ 1577.190323]  ? perf_ftrace_function_call+0x4c/0x360
[ 1577.191006]  ? __lock_acquire+0xa2a/0x1ba0
[ 1577.191601]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1577.192265]  ? pmd_page_vaddr+0x2b/0x70
[ 1577.192814]  ? _raw_spin_lock+0x5/0x50
[ 1577.193351]  ? _raw_spin_lock+0x5/0x50
[ 1577.193889]  ? __get_locked_pte+0x1a2/0x290
[ 1577.194504]  ? _raw_spin_lock+0x5/0x50
[ 1577.195036]  ? __get_locked_pte+0x1a2/0x290
[ 1577.195627]  ? dma_wait_for_async_tx+0xf0/0xf0
[ 1577.196260]  ? __text_poke+0xea/0x4e0
[ 1577.196805]  ? lock_is_held_type+0xe2/0x140
[ 1577.197395]  ? dma_wait_for_async_tx+0xf0/0xf0
[ 1577.198031]  ? text_poke+0x2b/0x60
[ 1577.198538]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1577.199165]  ? register_virtio_driver+0x60/0x60
[ 1577.199814]  ? text_poke_queue+0xa7/0xc0
[ 1577.200381]  ? ftrace_replace_code+0xfd/0x170
[ 1577.201015]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1577.201677]  ? arch_ftrace_update_code+0x9/0x10
[ 1577.202331]  ? ftrace_run_update_code+0x30/0xa0
[ 1577.202966]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1577.203553]  ? unregister_ftrace_function+0x25/0x50
[ 1577.204244]  ? perf_ftrace_event_register+0x89/0xf0
[ 1577.204947]  ? perf_tp_event_init+0xa0/0xa0
[ 1577.205545]  ? perf_trace_destroy+0x37/0x60
[ 1577.206147]  ? tp_perf_event_destroy+0x15/0x20
[ 1577.206770]  ? _free_event+0xfc/0x7d0
[ 1577.207297]  ? put_event+0x37/0x50
[ 1577.207781]  ? perf_event_release_kernel+0x2f4/0x370
[ 1577.208473]  ? perf_event_release_kernel+0x370/0x370
[ 1577.209174]  ? perf_release+0x19/0x20
[ 1577.209699]  ? __fput+0x12d/0x460
[ 1577.210182]  ? ____fput+0x1a/0x20
[ 1577.210649]  ? task_work_run+0x8e/0xf0
[ 1577.211173]  ? do_exit+0x616/0x1310
[ 1577.211666]  ? write_comp_data+0x2f/0x90
[ 1577.212217]  ? do_group_exit+0x7e/0x130
[ 1577.212763]  ? get_signal+0x249/0x13c0
[ 1577.213279]  ? get_signal+0x5/0x13c0
[ 1577.213774]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1577.214463]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1577.215131]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1577.215811]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1577.216467]  ? do_syscall_64+0x46/0x80
[ 1577.216991]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1577.217714] CPU: 0 PID: 23083 Comm: systemctl Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1577.217750] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1577.218828] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1577.218839] Call Trace:
[ 1577.218845]  dump_stack_lvl+0xa4/0xd3
[ 1577.219883] caller is debug_smp_processor_id+0x1c/0x20
[ 1577.221487]  dump_stack+0x15/0x17
[ 1577.223544]  check_preemption_disabled+0x167/0x180
[ 1577.224226]  ? slab_post_alloc_hook+0x7b/0x3e0
[ 1577.224866]  ? kmemleak_free_part_phys+0x20/0x20
[ 1577.225525]  debug_smp_processor_id+0x1c/0x20
[ 1577.226154]  perf_ftrace_function_call+0x7c/0x360
[ 1577.226831]  ? __lock_acquire+0x4d6/0x1ba0
[ 1577.227441]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1577.228117]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1577.228803]  ? lock_release+0x13f/0x2c0
[ 1577.229362]  ? kmemleak_alloc+0x5/0x80
[ 1577.229903]  ? debug_smp_processor_id+0x1c/0x20
[ 1577.230558]  ? kmemleak_alloc+0x5/0x80
[ 1577.231102]  ? slab_post_alloc_hook+0x7b/0x3e0
[ 1577.231753]  ? kmemleak_alloc+0x5/0x80
[ 1577.232321]  ? slab_post_alloc_hook+0x7b/0x3e0
[ 1577.232985]  ? __alloc_file+0x31/0x130
[ 1577.233542]  ? kmem_cache_alloc+0x157/0x300
[ 1577.234180]  ? __alloc_file+0x31/0x130
[ 1577.234723]  ? alloc_empty_file+0x73/0x130
[ 1577.235317]  ? path_openat+0x50/0x1320
[ 1577.235866]  ? do_filp_open+0xd2/0x150
[ 1577.236412]  ? alloc_fd+0x20d/0x320
[ 1577.236924]  ? do_raw_spin_unlock+0x4d/0xc0
[ 1577.237529]  ? _raw_spin_unlock+0x2c/0x50
[ 1577.238126]  ? alloc_fd+0x20d/0x320
[ 1577.238636]  ? write_comp_data+0x2f/0x90
[ 1577.239222]  ? do_sys_openat2+0x559/0x700
[ 1577.239829]  ? do_sys_open+0x8e/0xe0
[ 1577.240369]  ? __x64_sys_openat+0x29/0x30
[ 1577.240961]  ? do_syscall_64+0x37/0x80
[ 1577.241523]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1577.242350] CPU: 1 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1577.242411] BUG: using smp_processor_id() in preemptible [00000000] code: systemctl/23083
[ 1577.243387] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1577.244529] caller is debug_smp_processor_id+0x1c/0x20
[ 1577.246101] Call Trace:
[ 1577.246111]  dump_stack_lvl+0xa4/0xd3
[ 1577.246131]  dump_stack+0x15/0x17
[ 1577.248219]  check_preemption_disabled+0x167/0x180
[ 1577.248887]  ? __get_locked_pte+0x1a2/0x290
[ 1577.249475]  ? __lock_text_start+0x8/0x8
[ 1577.250030]  debug_smp_processor_id+0x1c/0x20
[ 1577.250668]  perf_ftrace_function_call+0x7c/0x360
[ 1577.251349]  ? __text_poke+0x2f2/0x4e0
[ 1577.251907]  ? _raw_spin_trylock_bh+0x80/0x80
[ 1577.252526]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1577.253190]  ? __text_poke+0x2f2/0x4e0
[ 1577.253724]  ? perf_ftrace_function_call+0x4c/0x360
[ 1577.254431]  ? __lock_acquire+0xa2a/0x1ba0
[ 1577.255023]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1577.255699]  ? pmd_page_vaddr+0x2b/0x70
[ 1577.256246]  ? _raw_spin_lock+0x5/0x50
[ 1577.256783]  ? _raw_spin_lock+0x5/0x50
[ 1577.257315]  ? __get_locked_pte+0x1a2/0x290
[ 1577.257900]  ? _raw_spin_lock+0x5/0x50
[ 1577.258440]  ? __get_locked_pte+0x1a2/0x290
[ 1577.259035]  ? __get_unmap_pool.part.29+0x10/0x10
[ 1577.259701]  ? __text_poke+0xea/0x4e0
[ 1577.260226]  ? lock_is_held_type+0xe2/0x140
[ 1577.260814]  ? __get_unmap_pool.part.29+0x10/0x10
[ 1577.261473]  ? text_poke+0x2b/0x60
[ 1577.261957]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1577.262585]  ? register_virtio_driver+0x60/0x60
[ 1577.263223]  ? text_poke_queue+0xa7/0xc0
[ 1577.263784]  ? ftrace_replace_code+0xfd/0x170
[ 1577.264399]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1577.265060]  ? arch_ftrace_update_code+0x9/0x10
[ 1577.265690]  ? ftrace_run_update_code+0x30/0xa0
[ 1577.266341]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1577.266919]  ? unregister_ftrace_function+0x25/0x50
[ 1577.267602]  ? perf_ftrace_event_register+0x89/0xf0
[ 1577.268285]  ? perf_tp_event_init+0xa0/0xa0
[ 1577.268870]  ? perf_trace_destroy+0x37/0x60
[ 1577.269460]  ? tp_perf_event_destroy+0x15/0x20
[ 1577.270087]  ? _free_event+0xfc/0x7d0
[ 1577.270606]  ? put_event+0x37/0x50
[ 1577.271077]  ? perf_event_release_kernel+0x2f4/0x370
[ 1577.271751]  ? perf_event_release_kernel+0x370/0x370
[ 1577.272428]  ? perf_release+0x19/0x20
[ 1577.272933]  ? __fput+0x12d/0x460
[ 1577.273409]  ? ____fput+0x1a/0x20
[ 1577.273876]  ? task_work_run+0x8e/0xf0
[ 1577.274433]  ? do_exit+0x616/0x1310
[ 1577.274920]  ? write_comp_data+0x2f/0x90
[ 1577.275467]  ? do_group_exit+0x7e/0x130
[ 1577.275997]  ? get_signal+0x249/0x13c0
[ 1577.276512]  ? get_signal+0x5/0x13c0
[ 1577.277008]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1577.277672]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1577.278343]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1577.279014]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1577.279662]  ? do_syscall_64+0x46/0x80
[ 1577.280175]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1577.280899] CPU: 0 PID: 23083 Comm: systemctl Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1577.280946] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23074
[ 1577.281997] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1577.282008] Call Trace:
[ 1577.282014]  dump_stack_lvl+0xa4/0xd3
[ 1577.283046] caller is debug_smp_processor_id+0x1c/0x20
[ 1577.284667]  dump_stack+0x15/0x17
[ 1577.286704]  check_preemption_disabled+0x167/0x180
[ 1577.287400]  ? put_unused_fd+0x36/0x50
[ 1577.287948]  ? __lock_text_start+0x8/0x8
[ 1577.288522]  debug_smp_processor_id+0x1c/0x20
[ 1577.289153]  perf_ftrace_function_call+0x7c/0x360
[ 1577.289830]  ? write_comp_data+0x2f/0x90
[ 1577.290425]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1577.291126]  ? path_openat+0x331/0x1320
[ 1577.291713]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1577.292407]  ? restore_nameidata+0x65/0x70
[ 1577.293021]  ? do_sys_openat2+0x56b/0x700
[ 1577.293614]  ? _raw_spin_lock+0x5/0x50
[ 1577.294182]  ? alloc_fd+0x20d/0x320
[ 1577.294697]  ? _raw_spin_lock+0x5/0x50
[ 1577.295261]  ? put_unused_fd+0x36/0x50
[ 1577.295830]  ? _raw_spin_lock+0x5/0x50
[ 1577.296408]  ? put_unused_fd+0x36/0x50
[ 1577.296973]  ? do_sys_openat2+0x687/0x700
[ 1577.297580]  ? do_sys_open+0x8e/0xe0
[ 1577.298153]  ? __x64_sys_openat+0x29/0x30
[ 1577.298750]  ? do_syscall_64+0x37/0x80
[ 1577.299317]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1577.300101] CPU: 1 PID: 23074 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1577.300132] BUG: using smp_processor_id() in preemptible [00000000] code: systemctl/23083
[ 1577.301141] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1577.302333] caller is debug_smp_processor_id+0x1c/0x20
[ 1577.303817] Call Trace:
[ 1577.304890]  dump_stack_lvl+0xa4/0xd3
[ 1577.305412]  dump_stack+0x15/0x17
[ 1577.305883]  check_preemption_disabled+0x167/0x180
[ 1577.306562]  ? __get_locked_pte+0x1a2/0x290
[ 1577.307179]  ? __lock_text_start+0x8/0x8
[ 1577.307732]  debug_smp_processor_id+0x1c/0x20
[ 1577.308345]  perf_ftrace_function_call+0x7c/0x360
[ 1577.308991]  ? __text_poke+0x2f2/0x4e0
[ 1577.309506]  ? _raw_spin_trylock_bh+0x80/0x80
[ 1577.310116]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1577.310760]  ? __text_poke+0x2f2/0x4e0
[ 1577.311281]  ? perf_ftrace_function_call+0x4c/0x360
[ 1577.311959]  ? __lock_acquire+0xa2a/0x1ba0
[ 1577.312537]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1577.313190]  ? pmd_page_vaddr+0x2b/0x70
[ 1577.313721]  ? _raw_spin_lock+0x5/0x50
[ 1577.314267]  ? _raw_spin_lock+0x5/0x50
[ 1577.314798]  ? __get_locked_pte+0x1a2/0x290
[ 1577.315393]  ? _raw_spin_lock+0x5/0x50
[ 1577.315918]  ? __get_locked_pte+0x1a2/0x290
[ 1577.316494]  ? dmaengine_get_unmap_data+0xd0/0xd0
[ 1577.317144]  ? __text_poke+0xea/0x4e0
[ 1577.317651]  ? lock_is_held_type+0xe2/0x140
[ 1577.318237]  ? dmaengine_get_unmap_data+0xd0/0xd0
[ 1577.318885]  ? text_poke+0x2b/0x60
[ 1577.319358]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1577.319955]  ? register_virtio_driver+0x60/0x60
[ 1577.320574]  ? text_poke_queue+0xa7/0xc0
[ 1577.321115]  ? ftrace_replace_code+0xfd/0x170
[ 1577.321711]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1577.322368]  ? arch_ftrace_update_code+0x9/0x10
[ 1577.322990]  ? ftrace_run_update_code+0x30/0xa0
[ 1577.323636]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1577.324207]  ? unregister_ftrace_function+0x25/0x50
[ 1577.324875]  ? perf_ftrace_event_register+0x89/0xf0
[ 1577.325533]  ? perf_tp_event_init+0xa0/0xa0
[ 1577.326139]  ? perf_trace_destroy+0x37/0x60
[ 1577.326714]  ? tp_perf_event_destroy+0x15/0x20
[ 1577.327320]  ? _free_event+0xfc/0x7d0
[ 1577.327841]  ? put_event+0x37/0x50
[ 1577.328313]  ? perf_event_release_kernel+0x2f4/0x370
[ 1577.329000]  ? perf_event_release_kernel+0x370/0x370
[ 1577.329676]  ? perf_release+0x19/0x20
[ 1577.330195]  ? __fput+0x12d/0x460
[ 1577.330653]  ? ____fput+0x1a/0x20
[ 1577.331099]  ? task_work_run+0x8e/0xf0
[ 1577.331609]  ? do_exit+0x616/0x1310
[ 1577.332090]  ? write_comp_data+0x2f/0x90
[ 1577.332614]  ? do_group_exit+0x7e/0x130
[ 1577.333133]  ? get_signal+0x249/0x13c0
[ 1577.333647]  ? get_signal+0x5/0x13c0
[ 1577.334140]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1577.334791]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1577.335431]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1577.336122]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1577.336776]  ? do_syscall_64+0x46/0x80
[ 1577.337284]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1577.338014] CPU: 0 PID: 23083 Comm: systemctl Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1577.339128] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1577.340679] Call Trace:
[ 1577.341035]  dump_stack_lvl+0xa4/0xd3
[ 1577.341563]  dump_stack+0x15/0x17
[ 1577.342048]  check_preemption_disabled+0x167/0x180
[ 1577.342735]  ? kmem_cache_free+0x333/0x5a0
[ 1577.343363]  ? mem_cgroup_css_alloc+0x7c0/0x7c0
[ 1577.344018]  debug_smp_processor_id+0x1c/0x20
[ 1577.344643]  perf_ftrace_function_call+0x7c/0x360
[ 1577.345313]  ? put_unused_fd+0x49/0x50
[ 1577.345859]  ? _raw_spin_trylock_bh+0x80/0x80
[ 1577.346512]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1577.347237]  ? put_unused_fd+0x49/0x50
[ 1577.347806]  ? perf_ftrace_function_call+0x4c/0x360
[ 1577.348530]  ? write_comp_data+0x2f/0x90
[ 1577.349118]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1577.349813]  ? path_openat+0x331/0x1320
[ 1577.350414]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1577.351117]  ? kmemleak_free+0x5/0x60
[ 1577.351665]  ? kmemleak_free+0x5/0x60
[ 1577.352217]  ? kmem_cache_free+0x333/0x5a0
[ 1577.352821]  ? kmemleak_free+0x5/0x60
[ 1577.353371]  ? kmem_cache_free+0x333/0x5a0
[ 1577.353976]  ? putname+0xae/0xd0
[ 1577.354474]  ? putname+0xae/0xd0
[ 1577.354961]  ? do_sys_openat2+0x4d7/0x700
[ 1577.355567]  ? do_sys_open+0x8e/0xe0
[ 1577.356109]  ? __x64_sys_openat+0x29/0x30
[ 1577.356707]  ? do_syscall_64+0x37/0x80
[ 1577.357273]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1582.066036] check_preemption_disabled: 1979932 callbacks suppressed
[ 1582.066066] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23086
[ 1582.066401] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1582.066985] caller is debug_smp_processor_id+0x1c/0x20
[ 1582.068170] caller is debug_smp_processor_id+0x1c/0x20
[ 1582.069237] CPU: 1 PID: 23086 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1582.071712] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1582.073236] Call Trace:
[ 1582.073617]  dump_stack_lvl+0xa4/0xd3
[ 1582.074196]  dump_stack+0x15/0x17
[ 1582.074695]  check_preemption_disabled+0x167/0x180
[ 1582.075387]  ? ftrace_replace_code+0xfd/0x170
[ 1582.076011]  ? jump_label_transform+0x70/0x70
[ 1582.076662]  debug_smp_processor_id+0x1c/0x20
[ 1582.077295]  perf_ftrace_function_call+0x7c/0x360
[ 1582.077965]  ? write_comp_data+0x2f/0x90
[ 1582.078575]  ? write_comp_data+0x2f/0x90
[ 1582.079179]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1582.079856]  ? write_comp_data+0x2f/0x90
[ 1582.080460]  ? write_comp_data+0x2f/0x90
[ 1582.081064]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1582.081816]  0xffffffffa0098099
[ 1582.082327]  ? write_comp_data+0x2f/0x90
[ 1582.082988]  ? mmc_device_show+0x40/0x40
[ 1582.083569]  ? text_poke_queue+0x5/0xc0
[ 1582.084136]  ? __fentry__+0x10/0x10
[ 1582.084674]  text_poke_queue+0x5/0xc0
[ 1582.085220]  ftrace_replace_code+0xfd/0x170
[ 1582.085830]  ? text_poke_queue+0x5/0xc0
[ 1582.086390]  ? ftrace_replace_code+0xfd/0x170
[ 1582.087069]  ftrace_modify_all_code+0x1b1/0x270
[ 1582.087762]  arch_ftrace_update_code+0x9/0x10
[ 1582.088394]  ftrace_run_update_code+0x30/0xa0
[ 1582.089044]  ftrace_startup_enable+0x5e/0xa0
[ 1582.089685]  ftrace_startup+0x16d/0x240
[ 1582.090320]  register_ftrace_function+0x43/0x90
[ 1582.090994]  perf_ftrace_event_register+0xc1/0xf0
[ 1582.091690]  perf_trace_event_init+0xa0/0x4c0
[ 1582.092371]  perf_trace_init+0xda/0x160
[ 1582.092975]  perf_tp_event_init+0x57/0xa0
[ 1582.093582]  perf_try_init_event+0x83/0x270
[ 1582.094253]  perf_event_alloc+0xe3f/0x1c10
[ 1582.094844]  ? _raw_spin_unlock+0x2c/0x50
[ 1582.095440]  ? alloc_fd+0x20d/0x320
[ 1582.096054]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1582.096761]  ? write_comp_data+0x2f/0x90
[ 1582.097632]  __x64_sys_perf_event_open+0x26/0x30
[ 1582.098311]  do_syscall_64+0x37/0x80
[ 1582.098853]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1582.099567] RIP: 0033:0x7fac0740459d
[ 1582.100096] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1582.102548] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1582.103586] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1582.104553] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1582.105523] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1582.106496] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1582.107461] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1582.108626] CPU: 0 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1582.108715] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23086
[ 1582.109819] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1582.110926] caller is debug_smp_processor_id+0x1c/0x20
[ 1582.112547] Call Trace:
[ 1582.113669]  dump_stack_lvl+0xa4/0xd3
[ 1582.114376]  dump_stack+0x15/0x17
[ 1582.114970]  check_preemption_disabled+0x167/0x180
[ 1582.115828]  ? lock_timer_base+0x34/0x100
[ 1582.116580]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1582.117395]  debug_smp_processor_id+0x1c/0x20
[ 1582.118171]  perf_ftrace_function_call+0x7c/0x360
[ 1582.119257]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1582.120044]  ? write_comp_data+0x2f/0x90
[ 1582.120740]  ? perf_trace_buf_update+0x70/0x70
[ 1582.121621]  0xffffffffa0098099
[ 1582.122315]  ? ftrace_call+0x5/0x44
[ 1582.122968]  ? lock_timer_base+0xc0/0x100
[ 1582.123719]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1582.124474]  ? write_comp_data+0x2f/0x90
[ 1582.125188]  _raw_spin_lock_irqsave+0x5/0x70
[ 1582.125921]  lock_timer_base+0x34/0x100
[ 1582.126598]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1582.127378]  ? lock_timer_base+0x34/0x100
[ 1582.128178]  try_to_del_timer_sync+0x33/0x90
[ 1582.128892]  ? try_to_del_timer_sync+0x5/0x90
[ 1582.129687]  del_timer_sync+0xd3/0x130
[ 1582.130410]  schedule_timeout+0x34e/0x610
[ 1582.131224]  ? del_timer_sync+0x130/0x130
[ 1582.131985]  ? i915_init_ggtt+0x40/0x6b0
[ 1582.132790]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1582.133593]  ? rcu_gp_init+0x730/0x730
[ 1582.134259]  rcu_gp_kthread+0xdd/0x170
[ 1582.135042]  kthread+0x1e7/0x230
[ 1582.135649]  ? set_kthread_struct+0x80/0x80
[ 1582.136439]  ret_from_fork+0x1f/0x30
[ 1582.137425] CPU: 1 PID: 23086 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1582.137729] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1582.138477] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1582.138500] Call Trace:
[ 1582.138528]  dump_stack_lvl+0xa4/0xd3
[ 1582.138595]  dump_stack+0x15/0x17
[ 1582.139826] caller is debug_smp_processor_id+0x1c/0x20
[ 1582.141335]  check_preemption_disabled+0x167/0x180
[ 1582.144036]  ? ftrace_replace_code+0xfd/0x170
[ 1582.144657]  ? jump_label_transform+0x70/0x70
[ 1582.145308]  debug_smp_processor_id+0x1c/0x20
[ 1582.145941]  perf_ftrace_function_call+0x7c/0x360
[ 1582.146620]  ? write_comp_data+0x2f/0x90
[ 1582.147230]  ? write_comp_data+0x2f/0x90
[ 1582.147833]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1582.148509]  ? write_comp_data+0x2f/0x90
[ 1582.149114]  ? write_comp_data+0x2f/0x90
[ 1582.149717]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1582.150479]  0xffffffffa0098099
[ 1582.150977]  ? write_comp_data+0x2f/0x90
[ 1582.151636]  ? mmc_vendor_show+0x40/0x40
[ 1582.152215]  ? text_poke_queue+0x5/0xc0
[ 1582.152782]  ? __fentry__+0x10/0x10
[ 1582.153320]  text_poke_queue+0x5/0xc0
[ 1582.153865]  ftrace_replace_code+0xfd/0x170
[ 1582.154483]  ? text_poke_queue+0x5/0xc0
[ 1582.155041]  ? ftrace_replace_code+0xfd/0x170
[ 1582.155718]  ftrace_modify_all_code+0x1b1/0x270
[ 1582.156411]  arch_ftrace_update_code+0x9/0x10
[ 1582.157043]  ftrace_run_update_code+0x30/0xa0
[ 1582.157694]  ftrace_startup_enable+0x5e/0xa0
[ 1582.158344]  ftrace_startup+0x16d/0x240
[ 1582.158981]  register_ftrace_function+0x43/0x90
[ 1582.159656]  perf_ftrace_event_register+0xc1/0xf0
[ 1582.160355]  perf_trace_event_init+0xa0/0x4c0
[ 1582.161036]  perf_trace_init+0xda/0x160
[ 1582.161642]  perf_tp_event_init+0x57/0xa0
[ 1582.162261]  perf_try_init_event+0x83/0x270
[ 1582.162930]  perf_event_alloc+0xe3f/0x1c10
[ 1582.163522]  ? _raw_spin_unlock+0x2c/0x50
[ 1582.164121]  ? alloc_fd+0x20d/0x320
[ 1582.164735]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1582.165444]  ? write_comp_data+0x2f/0x90
[ 1582.166322]  __x64_sys_perf_event_open+0x26/0x30
[ 1582.167003]  do_syscall_64+0x37/0x80
[ 1582.167547]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1582.168263] RIP: 0033:0x7fac0740459d
[ 1582.168793] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1582.171264] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1582.172315] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1582.173291] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1582.174269] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1582.175242] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1582.176217] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1582.177388] CPU: 0 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1582.177473] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23086
[ 1582.178587] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1582.178623] Call Trace:
[ 1582.178675]  dump_stack_lvl+0xa4/0xd3
[ 1582.179682] caller is debug_smp_processor_id+0x1c/0x20
[ 1582.181462]  dump_stack+0x15/0x17
[ 1582.183661]  check_preemption_disabled+0x167/0x180
[ 1582.184559]  debug_smp_processor_id+0x1c/0x20
[ 1582.185306]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1582.186297]  perf_trace_buf_alloc+0x3d/0x100
[ 1582.187031]  ? lock_timer_base+0x34/0x100
[ 1582.187709]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1582.188495]  perf_ftrace_function_call+0x209/0x360
[ 1582.189645]  ? 0xffffffffa0098099
[ 1582.190435]  0xffffffffa0098099
[ 1582.191122]  ? ftrace_call+0x5/0x44
[ 1582.191776]  ? lock_timer_base+0xc0/0x100
[ 1582.192523]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1582.193279]  ? write_comp_data+0x2f/0x90
[ 1582.193994]  _raw_spin_lock_irqsave+0x5/0x70
[ 1582.194740]  lock_timer_base+0x34/0x100
[ 1582.195412]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1582.196154]  ? lock_timer_base+0x34/0x100
[ 1582.196954]  try_to_del_timer_sync+0x33/0x90
[ 1582.197689]  ? try_to_del_timer_sync+0x5/0x90
[ 1582.198497]  del_timer_sync+0xd3/0x130
[ 1582.199210]  schedule_timeout+0x34e/0x610
[ 1582.200012]  ? del_timer_sync+0x130/0x130
[ 1582.200776]  ? i915_init_ggtt+0x40/0x6b0
[ 1582.201582]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1582.202394]  ? rcu_gp_init+0x730/0x730
[ 1582.203048]  rcu_gp_kthread+0xdd/0x170
[ 1582.203794]  kthread+0x1e7/0x230
[ 1582.204397]  ? set_kthread_struct+0x80/0x80
[ 1582.205196]  ret_from_fork+0x1f/0x30
[ 1582.206187] CPU: 1 PID: 23086 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1582.206397] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1582.207207] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1582.208329] caller is debug_smp_processor_id+0x1c/0x20
[ 1582.209827] Call Trace:
[ 1582.210935]  dump_stack_lvl+0xa4/0xd3
[ 1582.211509]  dump_stack+0x15/0x17
[ 1582.212008]  check_preemption_disabled+0x167/0x180
[ 1582.212699]  ? ftrace_replace_code+0xfd/0x170
[ 1582.213322]  ? jump_label_transform+0x70/0x70
[ 1582.213975]  debug_smp_processor_id+0x1c/0x20
[ 1582.214658]  perf_ftrace_function_call+0x7c/0x360
[ 1582.215330]  ? write_comp_data+0x2f/0x90
[ 1582.215936]  ? write_comp_data+0x2f/0x90
[ 1582.216541]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1582.217219]  ? write_comp_data+0x2f/0x90
[ 1582.217824]  ? write_comp_data+0x2f/0x90
[ 1582.218440]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1582.219198]  0xffffffffa0098099
[ 1582.219696]  ? write_comp_data+0x2f/0x90
[ 1582.220354]  ? mmc_sd_remove+0x30/0x30
[ 1582.220910]  ? text_poke_queue+0x5/0xc0
[ 1582.221476]  ? __fentry__+0x10/0x10
[ 1582.222014]  text_poke_queue+0x5/0xc0
[ 1582.222572]  ftrace_replace_code+0xfd/0x170
[ 1582.223183]  ? text_poke_queue+0x5/0xc0
[ 1582.223739]  ? ftrace_replace_code+0xfd/0x170
[ 1582.224420]  ftrace_modify_all_code+0x1b1/0x270
[ 1582.225113]  arch_ftrace_update_code+0x9/0x10
[ 1582.225747]  ftrace_run_update_code+0x30/0xa0
[ 1582.226408]  ftrace_startup_enable+0x5e/0xa0
[ 1582.227048]  ftrace_startup+0x16d/0x240
[ 1582.227680]  register_ftrace_function+0x43/0x90
[ 1582.228355]  perf_ftrace_event_register+0xc1/0xf0
[ 1582.229050]  perf_trace_event_init+0xa0/0x4c0
[ 1582.229731]  perf_trace_init+0xda/0x160
[ 1582.230350]  perf_tp_event_init+0x57/0xa0
[ 1582.230986]  perf_try_init_event+0x83/0x270
[ 1582.231674]  perf_event_alloc+0xe3f/0x1c10
[ 1582.232268]  ? _raw_spin_unlock+0x2c/0x50
[ 1582.232869]  ? alloc_fd+0x20d/0x320
[ 1582.233482]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1582.234208]  ? write_comp_data+0x2f/0x90
[ 1582.235081]  __x64_sys_perf_event_open+0x26/0x30
[ 1582.235760]  do_syscall_64+0x37/0x80
[ 1582.236302]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1582.237019] RIP: 0033:0x7fac0740459d
[ 1582.237548] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1582.240028] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1582.241077] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1582.242051] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1582.243027] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1582.243998] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1582.244968] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1582.246145] CPU: 0 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1582.246231] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23086
[ 1582.247254] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1582.248297] caller is debug_smp_processor_id+0x1c/0x20
[ 1582.249872] Call Trace:
[ 1582.250965]  dump_stack_lvl+0xa4/0xd3
[ 1582.251585]  dump_stack+0x15/0x17
[ 1582.252121]  check_preemption_disabled+0x167/0x180
[ 1582.252915]  debug_smp_processor_id+0x1c/0x20
[ 1582.253592]  perf_trace_buf_alloc+0x98/0x100
[ 1582.254267]  ? lock_timer_base+0x34/0x100
[ 1582.254886]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1582.255600]  perf_ftrace_function_call+0x209/0x360
[ 1582.256564]  ? 0xffffffffa0098099
[ 1582.257226]  0xffffffffa0098099
[ 1582.257815]  ? ftrace_call+0x5/0x44
[ 1582.258406]  ? lock_timer_base+0xc0/0x100
[ 1582.259074]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1582.259763]  ? write_comp_data+0x2f/0x90
[ 1582.260402]  _raw_spin_lock_irqsave+0x5/0x70
[ 1582.261066]  lock_timer_base+0x34/0x100
[ 1582.261671]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1582.262357]  ? lock_timer_base+0x34/0x100
[ 1582.263069]  try_to_del_timer_sync+0x33/0x90
[ 1582.263723]  ? try_to_del_timer_sync+0x5/0x90
[ 1582.264436]  del_timer_sync+0xd3/0x130
[ 1582.265068]  schedule_timeout+0x34e/0x610
[ 1582.265766]  ? del_timer_sync+0x130/0x130
[ 1582.266460]  ? i915_init_ggtt+0x40/0x6b0
[ 1582.267162]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1582.267862]  ? rcu_gp_init+0x730/0x730
[ 1582.268454]  rcu_gp_kthread+0xdd/0x170
[ 1582.269107]  kthread+0x1e7/0x230
[ 1582.269644]  ? set_kthread_struct+0x80/0x80
[ 1582.270348]  ret_from_fork+0x1f/0x30
[ 1582.271160] CPU: 1 PID: 23086 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1582.271465] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1582.272176] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1582.273305] caller is debug_smp_processor_id+0x1c/0x20
[ 1582.274808] Call Trace:
[ 1582.274836]  dump_stack_lvl+0xa4/0xd3
[ 1582.274902]  dump_stack+0x15/0x17
[ 1582.274938]  check_preemption_disabled+0x167/0x180
[ 1582.274978]  ? ftrace_replace_code+0xfd/0x170
[ 1582.278287]  ? jump_label_transform+0x70/0x70
[ 1582.278940]  debug_smp_processor_id+0x1c/0x20
[ 1582.279575]  perf_ftrace_function_call+0x7c/0x360
[ 1582.280247]  ? write_comp_data+0x2f/0x90
[ 1582.280851]  ? write_comp_data+0x2f/0x90
[ 1582.281455]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1582.282145]  ? write_comp_data+0x2f/0x90
[ 1582.282749]  ? write_comp_data+0x2f/0x90
[ 1582.283354]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1582.284106]  0xffffffffa0098099
[ 1582.284606]  ? write_comp_data+0x2f/0x90
[ 1582.285265]  ? sd_busy_poweroff_notify_cb+0xa0/0xa0
[ 1582.285966]  ? text_poke_queue+0x5/0xc0
[ 1582.286537]  ? __fentry__+0x10/0x10
[ 1582.287076]  text_poke_queue+0x5/0xc0
[ 1582.287622]  ftrace_replace_code+0xfd/0x170
[ 1582.288233]  ? text_poke_queue+0x5/0xc0
[ 1582.288792]  ? ftrace_replace_code+0xfd/0x170
[ 1582.289470]  ftrace_modify_all_code+0x1b1/0x270
[ 1582.290168]  arch_ftrace_update_code+0x9/0x10
[ 1582.290800]  ftrace_run_update_code+0x30/0xa0
[ 1582.291450]  ftrace_startup_enable+0x5e/0xa0
[ 1582.292090]  ftrace_startup+0x16d/0x240
[ 1582.292721]  register_ftrace_function+0x43/0x90
[ 1582.293395]  perf_ftrace_event_register+0xc1/0xf0
[ 1582.294094]  perf_trace_event_init+0xa0/0x4c0
[ 1582.294774]  perf_trace_init+0xda/0x160
[ 1582.295379]  perf_tp_event_init+0x57/0xa0
[ 1582.295985]  perf_try_init_event+0x83/0x270
[ 1582.296653]  perf_event_alloc+0xe3f/0x1c10
[ 1582.297243]  ? _raw_spin_unlock+0x2c/0x50
[ 1582.297842]  ? alloc_fd+0x20d/0x320
[ 1582.298469]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1582.299177]  ? write_comp_data+0x2f/0x90
[ 1582.300050]  __x64_sys_perf_event_open+0x26/0x30
[ 1582.300726]  do_syscall_64+0x37/0x80
[ 1582.301268]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1582.301981] RIP: 0033:0x7fac0740459d
[ 1582.302514] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1582.305023] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1582.306089] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1582.307060] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1582.308094] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1582.309184] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1582.310287] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1582.311469] CPU: 0 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1582.311559] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23086
[ 1582.312580] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1582.313610] caller is debug_smp_processor_id+0x1c/0x20
[ 1582.315222] Call Trace:
[ 1582.315259]  dump_stack_lvl+0xa4/0xd3
[ 1582.315343]  dump_stack+0x15/0x17
[ 1582.317389]  check_preemption_disabled+0x167/0x180
[ 1582.318202]  debug_smp_processor_id+0x1c/0x20
[ 1582.318882]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1582.319751]  perf_tp_event+0x331/0x4e0
[ 1582.320549]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1582.321471]  ? trace_hardirqs_on+0x3f/0x170
[ 1582.322173]  ? arch_local_irq_enable+0x10/0x12
[ 1582.322872]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1582.323631]  ? dump_stack_lvl+0xcc/0xd3
[ 1582.324307]  ? lock_timer_base+0x34/0x100
[ 1582.324925]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1582.325657]  perf_ftrace_function_call+0x248/0x360
[ 1582.326422]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1582.327118]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1582.327842]  ? perf_ftrace_function_call+0x248/0x360
[ 1582.328855]  ? 0xffffffffa0098099
[ 1582.329519]  0xffffffffa0098099
[ 1582.330118]  ? ftrace_call+0x5/0x44
[ 1582.330712]  ? lock_timer_base+0xc0/0x100
[ 1582.331392]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1582.332084]  ? write_comp_data+0x2f/0x90
[ 1582.332725]  _raw_spin_lock_irqsave+0x5/0x70
[ 1582.333394]  lock_timer_base+0x34/0x100
[ 1582.334001]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1582.334693]  ? lock_timer_base+0x34/0x100
[ 1582.335403]  try_to_del_timer_sync+0x33/0x90
[ 1582.336058]  ? try_to_del_timer_sync+0x5/0x90
[ 1582.336771]  del_timer_sync+0xd3/0x130
[ 1582.337403]  schedule_timeout+0x34e/0x610
[ 1582.338113]  ? del_timer_sync+0x130/0x130
[ 1582.338791]  ? i915_init_ggtt+0x40/0x6b0
[ 1582.339495]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1582.340197]  ? rcu_gp_init+0x730/0x730
[ 1582.340791]  rcu_gp_kthread+0xdd/0x170
[ 1582.341445]  kthread+0x1e7/0x230
[ 1582.341983]  ? set_kthread_struct+0x80/0x80
[ 1582.342690]  ret_from_fork+0x1f/0x30
[ 1582.343506] CPU: 1 PID: 23086 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1582.343737] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1582.344523] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1582.345734] caller is debug_smp_processor_id+0x1c/0x20
[ 1582.347235] Call Trace:
[ 1582.347264]  dump_stack_lvl+0xa4/0xd3
[ 1582.347330]  dump_stack+0x15/0x17
[ 1582.347367]  check_preemption_disabled+0x167/0x180
[ 1582.347406]  ? ftrace_replace_code+0xfd/0x170
[ 1582.350726]  ? jump_label_transform+0x70/0x70
[ 1582.351380]  debug_smp_processor_id+0x1c/0x20
[ 1582.352017]  perf_ftrace_function_call+0x7c/0x360
[ 1582.352689]  ? write_comp_data+0x2f/0x90
[ 1582.353295]  ? write_comp_data+0x2f/0x90
[ 1582.353899]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1582.354582]  ? write_comp_data+0x2f/0x90
[ 1582.355189]  ? write_comp_data+0x2f/0x90
[ 1582.355795]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1582.356551]  0xffffffffa0098099
[ 1582.357052]  ? write_comp_data+0x2f/0x90
[ 1582.357714]  ? mmc_sd_alive+0x30/0x30
[ 1582.358267]  ? text_poke_queue+0x5/0xc0
[ 1582.358834]  ? __fentry__+0x10/0x10
[ 1582.359375]  text_poke_queue+0x5/0xc0
[ 1582.359921]  ftrace_replace_code+0xfd/0x170
[ 1582.360533]  ? text_poke_queue+0x5/0xc0
[ 1582.361092]  ? ftrace_replace_code+0xfd/0x170
[ 1582.361771]  ftrace_modify_all_code+0x1b1/0x270
[ 1582.362469]  arch_ftrace_update_code+0x9/0x10
[ 1582.363103]  ftrace_run_update_code+0x30/0xa0
[ 1582.363756]  ftrace_startup_enable+0x5e/0xa0
[ 1582.364397]  ftrace_startup+0x16d/0x240
[ 1582.365029]  register_ftrace_function+0x43/0x90
[ 1582.365707]  perf_ftrace_event_register+0xc1/0xf0
[ 1582.366422]  perf_trace_event_init+0xa0/0x4c0
[ 1582.367107]  perf_trace_init+0xda/0x160
[ 1582.367713]  perf_tp_event_init+0x57/0xa0
[ 1582.368321]  perf_try_init_event+0x83/0x270
[ 1582.368990]  perf_event_alloc+0xe3f/0x1c10
[ 1582.369581]  ? _raw_spin_unlock+0x2c/0x50
[ 1582.370184]  ? alloc_fd+0x20d/0x320
[ 1582.370800]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1582.371509]  ? write_comp_data+0x2f/0x90
[ 1582.372382]  __x64_sys_perf_event_open+0x26/0x30
[ 1582.373059]  do_syscall_64+0x37/0x80
[ 1582.373601]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1582.374320] RIP: 0033:0x7fac0740459d
[ 1582.374849] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1582.377309] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1582.378363] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1582.379337] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1582.380309] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1582.381281] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1582.382254] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1582.383425] CPU: 0 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1582.384636] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1582.386381] Call Trace:
[ 1582.386842]  dump_stack_lvl+0xa4/0xd3
[ 1582.387542]  dump_stack+0x15/0x17
[ 1582.388136]  check_preemption_disabled+0x167/0x180
[ 1582.388943]  ? prepare_to_swait_event+0x1b/0xf0
[ 1582.389693]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1582.390501]  debug_smp_processor_id+0x1c/0x20
[ 1582.391249]  perf_ftrace_function_call+0x7c/0x360
[ 1582.392273]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1582.393059]  ? write_comp_data+0x2f/0x90
[ 1582.393757]  ? perf_trace_buf_update+0x70/0x70
[ 1582.394518]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1582.395455]  0xffffffffa0098099
[ 1582.396106]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1582.396969]  ? del_timer_sync+0xde/0x130
[ 1582.397703]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1582.398534]  _raw_spin_lock_irqsave+0x5/0x70
[ 1582.399269]  prepare_to_swait_event+0x1b/0xf0
[ 1582.400016]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1582.400761]  ? prepare_to_swait_event+0x1b/0xf0
[ 1582.401599]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1582.402430]  ? rcu_gp_init+0x730/0x730
[ 1582.403108]  rcu_gp_kthread+0xdd/0x170
[ 1582.403858]  kthread+0x1e7/0x230
[ 1582.404467]  ? set_kthread_struct+0x80/0x80
[ 1582.405290]  ret_from_fork+0x1f/0x30
[ 1587.069980] check_preemption_disabled: 3175719 callbacks suppressed
[ 1587.069997] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23087
[ 1587.070061] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1587.070860] caller is debug_smp_processor_id+0x1c/0x20
[ 1587.071863] caller is debug_smp_processor_id+0x1c/0x20
[ 1587.072781] CPU: 1 PID: 23087 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1587.074957] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1587.076326] Call Trace:
[ 1587.076644]  dump_stack_lvl+0xa4/0xd3
[ 1587.077117]  dump_stack+0x15/0x17
[ 1587.077542]  check_preemption_disabled+0x167/0x180
[ 1587.078153]  ? ftrace_verify_code+0x2c/0x70
[ 1587.078680]  ? copy_to_user_nofault+0x150/0x150
[ 1587.079253]  debug_smp_processor_id+0x1c/0x20
[ 1587.079803]  perf_ftrace_function_call+0x7c/0x360
[ 1587.080402]  ? irqentry_exit+0x3a/0x90
[ 1587.080876]  ? sysvec_apic_timer_interrupt+0xc8/0xd0
[ 1587.081497]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1587.082091]  ? lockdep_hardirqs_on+0x59/0x110
[ 1587.082639]  ? irqentry_exit+0x3a/0x90
[ 1587.083116]  ? trace_hardirqs_on+0x6a/0x170
[ 1587.083650]  ? irqentry_exit+0x3a/0x90
[ 1587.084137]  0xffffffffa0098099
[ 1587.084539]  ? nlmsvc_proc_share+0x210/0x210
[ 1587.085088]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1587.085747]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1587.086317]  ? __nlmsvc_proc_unlock+0x200/0x200
[ 1587.086884]  ? copy_from_kernel_nofault+0x5/0x220
[ 1587.087479]  copy_from_kernel_nofault+0x5/0x220
[ 1587.088047]  ftrace_verify_code+0x2c/0x70
[ 1587.088553]  ? copy_from_kernel_nofault+0x5/0x220
[ 1587.089139]  ? ftrace_verify_code+0x2c/0x70
[ 1587.089669]  ftrace_replace_code+0x69/0x170
[ 1587.090207]  ftrace_modify_all_code+0x1b1/0x270
[ 1587.090781]  arch_ftrace_update_code+0x9/0x10
[ 1587.091330]  ftrace_run_update_code+0x30/0xa0
[ 1587.091880]  ftrace_startup_enable+0x5e/0xa0
[ 1587.092419]  ftrace_startup+0x16d/0x240
[ 1587.092917]  register_ftrace_function+0x43/0x90
[ 1587.093487]  perf_ftrace_event_register+0xc1/0xf0
[ 1587.094080]  perf_trace_event_init+0xa0/0x4c0
[ 1587.094637]  perf_trace_init+0xda/0x160
[ 1587.095130]  perf_tp_event_init+0x57/0xa0
[ 1587.095641]  perf_try_init_event+0x83/0x270
[ 1587.096178]  perf_event_alloc+0xe3f/0x1c10
[ 1587.096692]  ? _raw_spin_unlock+0x2c/0x50
[ 1587.097202]  ? alloc_fd+0x20d/0x320
[ 1587.097664]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1587.098269]  ? write_comp_data+0x2f/0x90
[ 1587.098818]  __x64_sys_perf_event_open+0x26/0x30
[ 1587.099397]  do_syscall_64+0x37/0x80
[ 1587.099853]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1587.100482] RIP: 0033:0x7fac0740459d
[ 1587.100937] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1587.103164] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1587.104099] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1587.104968] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1587.105840] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1587.106723] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1587.107645] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1587.108597] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1587.108630] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23087
[ 1587.109607] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1587.110635] caller is debug_smp_processor_id+0x1c/0x20
[ 1587.112140] Call Trace:
[ 1587.113140]  dump_stack_lvl+0xa4/0xd3
[ 1587.113666]  dump_stack+0x15/0x17
[ 1587.114157]  check_preemption_disabled+0x167/0x180
[ 1587.114834]  debug_smp_processor_id+0x1c/0x20
[ 1587.115431]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1587.116168]  perf_tp_event+0x331/0x4e0
[ 1587.116782]  ? preempt_count_sub+0x5/0xa0
[ 1587.117356]  ? preempt_count_sub+0x5/0xa0
[ 1587.117908]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1587.118598]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1587.119249]  ? ___ratelimit+0x36/0x1e0
[ 1587.119800]  ? __printk_ratelimit+0x21/0x30
[ 1587.120382]  ? check_preemption_disabled+0x10e/0x180
[ 1587.121076]  ? __might_fault+0x5e/0xc0
[ 1587.121601]  ? ___might_sleep+0x170/0x170
[ 1587.122180]  perf_ftrace_function_call+0x248/0x360
[ 1587.122830]  ? perf_ftrace_function_call+0x248/0x360
[ 1587.123613]  ? 0xffffffffa0098099
[ 1587.124131]  0xffffffffa0098099
[ 1587.124596]  ? 0xffffffffa0098099
[ 1587.125081]  ? __might_fault+0x35/0xc0
[ 1587.125615]  ? __might_sleep+0x5/0x70
[ 1587.126134]  ? write_comp_data+0x2f/0x90
[ 1587.126688]  __might_sleep+0x5/0x70
[ 1587.127176]  __might_fault+0x5e/0xc0
[ 1587.127673]  ? __might_sleep+0x5/0x70
[ 1587.128177]  ? __might_fault+0x5e/0xc0
[ 1587.128718]  _copy_from_user+0x31/0x140
[ 1587.129281]  get_timespec64+0x3f/0xd0
[ 1587.129828]  __x64_sys_nanosleep+0x3a/0x150
[ 1587.130453]  do_syscall_64+0x37/0x80
[ 1587.130956]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1587.131635] RIP: 0033:0x7fac073cca18
[ 1587.132130] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1587.134561] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1587.135565] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1587.136488] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1587.137413] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1587.138346] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1587.139267] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1587.140300] CPU: 1 PID: 23087 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1587.140418] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1587.141212] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1587.142351] caller is debug_smp_processor_id+0x1c/0x20
[ 1587.143634] Call Trace:
[ 1587.143641]  dump_stack_lvl+0xa4/0xd3
[ 1587.145108]  dump_stack+0x15/0x17
[ 1587.145533]  check_preemption_disabled+0x167/0x180
[ 1587.146142]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1587.146740]  ? cea_set_pte+0x140/0x140
[ 1587.147219]  debug_smp_processor_id+0x1c/0x20
[ 1587.147771]  perf_ftrace_function_call+0x7c/0x360
[ 1587.148361]  ? ftrace_verify_code+0x2c/0x70
[ 1587.148886]  ? copy_to_user_nofault+0x150/0x150
[ 1587.149454]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1587.150045]  ? ftrace_verify_code+0x2c/0x70
[ 1587.150577]  ? perf_ftrace_function_call+0x4c/0x360
[ 1587.151194]  ? irqentry_exit+0x3a/0x90
[ 1587.151669]  ? sysvec_apic_timer_interrupt+0xc8/0xd0
[ 1587.152290]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1587.152879]  ? lockdep_hardirqs_on+0x59/0x110
[ 1587.153432]  ? __nlmsvc_proc_unlock+0x200/0x200
[ 1587.154002]  0xffffffffa0098099
[ 1587.154409]  ? irqentry_exit+0x3a/0x90
[ 1587.154897]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1587.155554]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1587.156122]  ? __nlmsvc_proc_unlock+0x200/0x200
[ 1587.156688]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1587.157346]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1587.158003]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1587.158578]  copy_from_kernel_nofault_allowed+0x5/0x80
[ 1587.159217]  copy_from_kernel_nofault+0x2f/0x220
[ 1587.159797]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1587.160456]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1587.161065]  ftrace_verify_code+0x2c/0x70
[ 1587.161577]  ftrace_replace_code+0x69/0x170
[ 1587.162119]  ftrace_modify_all_code+0x1b1/0x270
[ 1587.162692]  arch_ftrace_update_code+0x9/0x10
[ 1587.163239]  ftrace_run_update_code+0x30/0xa0
[ 1587.163787]  ftrace_startup_enable+0x5e/0xa0
[ 1587.164327]  ftrace_startup+0x16d/0x240
[ 1587.164824]  register_ftrace_function+0x43/0x90
[ 1587.165395]  perf_ftrace_event_register+0xc1/0xf0
[ 1587.165987]  perf_trace_event_init+0xa0/0x4c0
[ 1587.166552]  perf_trace_init+0xda/0x160
[ 1587.167048]  perf_tp_event_init+0x57/0xa0
[ 1587.167645]  perf_try_init_event+0x83/0x270
[ 1587.168184]  perf_event_alloc+0xe3f/0x1c10
[ 1587.168699]  ? _raw_spin_unlock+0x2c/0x50
[ 1587.169204]  ? alloc_fd+0x20d/0x320
[ 1587.169663]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1587.170270]  ? write_comp_data+0x2f/0x90
[ 1587.170818]  __x64_sys_perf_event_open+0x26/0x30
[ 1587.171394]  do_syscall_64+0x37/0x80
[ 1587.171849]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1587.172477] RIP: 0033:0x7fac0740459d
[ 1587.172929] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1587.175156] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1587.176073] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1587.176934] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1587.177795] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1587.178662] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1587.179522] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1587.180422] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1587.180462] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23087
[ 1587.181446] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1587.182399] caller is debug_smp_processor_id+0x1c/0x20
[ 1587.183926] Call Trace:
[ 1587.184925]  dump_stack_lvl+0xa4/0xd3
[ 1587.185523]  dump_stack+0x15/0x17
[ 1587.186047]  check_preemption_disabled+0x167/0x180
[ 1587.186765]  ? __might_sleep+0x48/0x70
[ 1587.187332]  ? sched_show_task+0x70/0x70
[ 1587.187951]  debug_smp_processor_id+0x1c/0x20
[ 1587.188609]  perf_ftrace_function_call+0x7c/0x360
[ 1587.189303]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1587.190005]  ? __might_fault+0x5e/0xc0
[ 1587.190587]  ? perf_ftrace_function_call+0x4c/0x360
[ 1587.191590]  0xffffffffa0098099
[ 1587.192195]  ? __might_fault+0x35/0xc0
[ 1587.192804]  ? ___might_sleep+0x5/0x170
[ 1587.193434]  ___might_sleep+0x5/0x170
[ 1587.194002]  __might_sleep+0x48/0x70
[ 1587.194569]  ? ___might_sleep+0x5/0x170
[ 1587.195146]  ? __might_sleep+0x48/0x70
[ 1587.195754]  __might_fault+0x5e/0xc0
[ 1587.196349]  _copy_from_user+0x31/0x140
[ 1587.196998]  get_timespec64+0x3f/0xd0
[ 1587.197638]  __x64_sys_nanosleep+0x3a/0x150
[ 1587.198341]  do_syscall_64+0x37/0x80
[ 1587.198907]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1587.199649] RIP: 0033:0x7fac073cca18
[ 1587.200198] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1587.202745] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1587.203832] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1587.204836] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1587.205841] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1587.206849] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1587.207854] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1587.209080] CPU: 1 PID: 23087 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1587.209195] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1587.210012] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1587.210024] Call Trace:
[ 1587.210032]  dump_stack_lvl+0xa4/0xd3
[ 1587.210061]  dump_stack+0x15/0x17
[ 1587.210077]  check_preemption_disabled+0x167/0x180
[ 1587.210097]  ? ftrace_verify_code+0x2c/0x70
[ 1587.211161] caller is debug_smp_processor_id+0x1c/0x20
[ 1587.212512]  ? copy_to_user_nofault+0x150/0x150
[ 1587.215979]  debug_smp_processor_id+0x1c/0x20
[ 1587.216524]  perf_ftrace_function_call+0x7c/0x360
[ 1587.217119]  ? irqentry_exit+0x3a/0x90
[ 1587.217592]  ? sysvec_apic_timer_interrupt+0xc8/0xd0
[ 1587.218221]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1587.218807]  ? lockdep_hardirqs_on+0x59/0x110
[ 1587.219358]  ? __nlmsvc_proc_unlock+0x200/0x200
[ 1587.219925]  ? 0xffffffffa0098099
[ 1587.220342]  ? irqentry_exit+0x3a/0x90
[ 1587.220826]  0xffffffffa0098099
[ 1587.221224]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1587.221880]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1587.222467]  ? __nlmsvc_proc_unlock+0x200/0x200
[ 1587.223033]  ? __nlmsvc_proc_unlock+0x200/0x200
[ 1587.223599]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1587.224254]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1587.224823]  ? nlmsvc_proc_unlock+0x30/0x30
[ 1587.225348]  ? copy_from_kernel_nofault+0x5/0x220
[ 1587.225940]  copy_from_kernel_nofault+0x5/0x220
[ 1587.226515]  ftrace_verify_code+0x2c/0x70
[ 1587.227018]  ? copy_from_kernel_nofault+0x5/0x220
[ 1587.227602]  ? ftrace_verify_code+0x2c/0x70
[ 1587.228128]  ftrace_replace_code+0x69/0x170
[ 1587.228659]  ftrace_modify_all_code+0x1b1/0x270
[ 1587.229229]  arch_ftrace_update_code+0x9/0x10
[ 1587.229773]  ftrace_run_update_code+0x30/0xa0
[ 1587.230323]  ftrace_startup_enable+0x5e/0xa0
[ 1587.230859]  ftrace_startup+0x16d/0x240
[ 1587.231354]  register_ftrace_function+0x43/0x90
[ 1587.231922]  perf_ftrace_event_register+0xc1/0xf0
[ 1587.232510]  perf_trace_event_init+0xa0/0x4c0
[ 1587.233064]  perf_trace_init+0xda/0x160
[ 1587.233554]  perf_tp_event_init+0x57/0xa0
[ 1587.234064]  perf_try_init_event+0x83/0x270
[ 1587.234601]  perf_event_alloc+0xe3f/0x1c10
[ 1587.235115]  ? _raw_spin_unlock+0x2c/0x50
[ 1587.235621]  ? alloc_fd+0x20d/0x320
[ 1587.236080]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1587.236679]  ? write_comp_data+0x2f/0x90
[ 1587.237226]  __x64_sys_perf_event_open+0x26/0x30
[ 1587.237802]  do_syscall_64+0x37/0x80
[ 1587.238260]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1587.238887] RIP: 0033:0x7fac0740459d
[ 1587.239336] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1587.241547] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1587.242465] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1587.243324] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1587.244184] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1587.245043] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1587.245901] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1587.246799] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1587.246833] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23087
[ 1587.247833] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1587.248764] caller is debug_smp_processor_id+0x1c/0x20
[ 1587.250327] Call Trace:
[ 1587.250361]  dump_stack_lvl+0xa4/0xd3
[ 1587.251900]  dump_stack+0x15/0x17
[ 1587.252424]  check_preemption_disabled+0x167/0x180
[ 1587.253197]  debug_smp_processor_id+0x1c/0x20
[ 1587.253860]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1587.254718]  perf_trace_buf_alloc+0x3d/0x100
[ 1587.255371]  ? __might_sleep+0x48/0x70
[ 1587.255939]  ? sched_show_task+0x70/0x70
[ 1587.256552]  perf_ftrace_function_call+0x209/0x360
[ 1587.257283]  ? __might_fault+0x5e/0xc0
[ 1587.258034]  ? 0xffffffffa0098099
[ 1587.258673]  0xffffffffa0098099
[ 1587.259284]  ? __might_fault+0x35/0xc0
[ 1587.259896]  ? ___might_sleep+0x5/0x170
[ 1587.260529]  ___might_sleep+0x5/0x170
[ 1587.261099]  __might_sleep+0x48/0x70
[ 1587.261656]  ? ___might_sleep+0x5/0x170
[ 1587.262240]  ? __might_sleep+0x48/0x70
[ 1587.262851]  __might_fault+0x5e/0xc0
[ 1587.263451]  _copy_from_user+0x31/0x140
[ 1587.264105]  get_timespec64+0x3f/0xd0
[ 1587.264748]  __x64_sys_nanosleep+0x3a/0x150
[ 1587.265453]  do_syscall_64+0x37/0x80
[ 1587.266023]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1587.266774] RIP: 0033:0x7fac073cca18
[ 1587.267328] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1587.269880] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1587.270972] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1587.271978] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1587.272984] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1587.273989] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1587.274999] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1587.276229] CPU: 1 PID: 23087 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1587.276444] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1587.277138] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1587.278193] caller is debug_smp_processor_id+0x1c/0x20
[ 1587.279470] Call Trace:
[ 1587.279478]  dump_stack_lvl+0xa4/0xd3
[ 1587.280887]  dump_stack+0x15/0x17
[ 1587.281309]  check_preemption_disabled+0x167/0x180
[ 1587.281905]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1587.282503]  ? cea_set_pte+0x140/0x140
[ 1587.282983]  debug_smp_processor_id+0x1c/0x20
[ 1587.283529]  perf_ftrace_function_call+0x7c/0x360
[ 1587.284116]  ? ftrace_verify_code+0x2c/0x70
[ 1587.284636]  ? copy_to_user_nofault+0x150/0x150
[ 1587.285201]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1587.285790]  ? ftrace_verify_code+0x2c/0x70
[ 1587.286319]  ? perf_ftrace_function_call+0x4c/0x360
[ 1587.286933]  ? irqentry_exit+0x3a/0x90
[ 1587.287404]  ? sysvec_apic_timer_interrupt+0xc8/0xd0
[ 1587.288023]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1587.288611]  ? lockdep_hardirqs_on+0x59/0x110
[ 1587.289161]  ? nlmsvc_proc_unlock+0x30/0x30
[ 1587.289684]  0xffffffffa0098099
[ 1587.290085]  ? irqentry_exit+0x3a/0x90
[ 1587.290573]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1587.291228]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1587.291794]  ? nlmsvc_proc_unlock+0x30/0x30
[ 1587.292316]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1587.292971]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1587.293626]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1587.294194]  copy_from_kernel_nofault_allowed+0x5/0x80
[ 1587.294828]  copy_from_kernel_nofault+0x2f/0x220
[ 1587.295402]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1587.296055]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1587.296661]  ftrace_verify_code+0x2c/0x70
[ 1587.297169]  ftrace_replace_code+0x69/0x170
[ 1587.297700]  ftrace_modify_all_code+0x1b1/0x270
[ 1587.298272]  arch_ftrace_update_code+0x9/0x10
[ 1587.298816]  ftrace_run_update_code+0x30/0xa0
[ 1587.299362]  ftrace_startup_enable+0x5e/0xa0
[ 1587.299899]  ftrace_startup+0x16d/0x240
[ 1587.300393]  register_ftrace_function+0x43/0x90
[ 1587.300959]  perf_ftrace_event_register+0xc1/0xf0
[ 1587.301548]  perf_trace_event_init+0xa0/0x4c0
[ 1587.302103]  perf_trace_init+0xda/0x160
[ 1587.302600]  perf_tp_event_init+0x57/0xa0
[ 1587.303104]  perf_try_init_event+0x83/0x270
[ 1587.303640]  perf_event_alloc+0xe3f/0x1c10
[ 1587.304152]  ? _raw_spin_unlock+0x2c/0x50
[ 1587.304658]  ? alloc_fd+0x20d/0x320
[ 1587.305116]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1587.305714]  ? write_comp_data+0x2f/0x90
[ 1587.306270]  __x64_sys_perf_event_open+0x26/0x30
[ 1587.306846]  do_syscall_64+0x37/0x80
[ 1587.307299]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1587.307925] RIP: 0033:0x7fac0740459d
[ 1587.308375] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1587.310618] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1587.311534] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1587.312393] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1587.313251] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1587.314117] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1587.314976] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1587.315869] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1587.315906] BUG: using smp_processor_id() in preemptible [00000000] code: repro/23087
[ 1587.316821] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1587.317762] caller is debug_smp_processor_id+0x1c/0x20
[ 1587.319219] Call Trace:
[ 1587.319238]  dump_stack_lvl+0xa4/0xd3
[ 1587.320698]  dump_stack+0x15/0x17
[ 1587.321166]  check_preemption_disabled+0x167/0x180
[ 1587.321846]  debug_smp_processor_id+0x1c/0x20
[ 1587.322452]  perf_trace_buf_alloc+0x98/0x100
[ 1587.323037]  ? __might_sleep+0x48/0x70
[ 1587.323551]  ? sched_show_task+0x70/0x70
[ 1587.324097]  perf_ftrace_function_call+0x209/0x360
[ 1587.324852]  ? 0xffffffffa0098099
[ 1587.325370]  0xffffffffa0098099
[ 1587.325866]  ? __might_fault+0x35/0xc0
[ 1587.326409]  ? ___might_sleep+0x5/0x170
[ 1587.326961]  ___might_sleep+0x5/0x170
[ 1587.327470]  __might_sleep+0x48/0x70
[ 1587.327969]  ? ___might_sleep+0x5/0x170
[ 1587.328495]  ? __might_sleep+0x48/0x70
[ 1587.329030]  __might_fault+0x5e/0xc0
[ 1587.329550]  _copy_from_user+0x31/0x140
[ 1587.330122]  get_timespec64+0x3f/0xd0
[ 1587.330669]  __x64_sys_nanosleep+0x3a/0x150
[ 1587.331277]  do_syscall_64+0x37/0x80
[ 1587.331781]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1587.332460] RIP: 0033:0x7fac073cca18
[ 1587.332956] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1587.335324] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1587.336318] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1587.337245] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1587.338182] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1587.339105] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1587.340032] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1587.341070] CPU: 1 PID: 23087 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1587.341190] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1587.341984] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1587.341995] Call Trace:
[ 1587.342002]  dump_stack_lvl+0xa4/0xd3
[ 1587.342023]  dump_stack+0x15/0x17
[ 1587.342038]  check_preemption_disabled+0x167/0x180
[ 1587.342061]  ? ftrace_verify_code+0x2c/0x70
[ 1587.343046] caller is debug_smp_processor_id+0x1c/0x20
[ 1587.344394]  ? copy_to_user_nofault+0x150/0x150
[ 1587.347829]  debug_smp_processor_id+0x1c/0x20
[ 1587.348382]  perf_ftrace_function_call+0x7c/0x360
[ 1587.348977]  ? irqentry_exit+0x3a/0x90
[ 1587.349450]  ? sysvec_apic_timer_interrupt+0xc8/0xd0
[ 1587.350076]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1587.350667]  ? lockdep_hardirqs_on+0x59/0x110
[ 1587.351219]  ? nlmsvc_proc_unlock+0x30/0x30
[ 1587.351746]  ? 0xffffffffa0098099
[ 1587.352170]  ? irqentry_exit+0x3a/0x90
[ 1587.352654]  0xffffffffa0098099
[ 1587.353050]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1587.353707]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1587.354283]  ? nlmsvc_proc_unlock+0x30/0x30
[ 1587.354805]  ? nlmsvc_proc_unlock+0x30/0x30
[ 1587.355330]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1587.355985]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1587.356549]  ? __nlmsvc_proc_cancel+0x200/0x200
[ 1587.357114]  ? copy_from_kernel_nofault+0x5/0x220
[ 1587.357707]  copy_from_kernel_nofault+0x5/0x220
[ 1587.358283]  ftrace_verify_code+0x2c/0x70
[ 1587.358786]  ? copy_from_kernel_nofault+0x5/0x220
[ 1587.359370]  ? ftrace_verify_code+0x2c/0x70
[ 1587.359898]  ftrace_replace_code+0x69/0x170
[ 1587.360430]  ftrace_modify_all_code+0x1b1/0x270
[ 1587.361001]  arch_ftrace_update_code+0x9/0x10
[ 1587.361545]  ftrace_run_update_code+0x30/0xa0
[ 1587.362100]  ftrace_startup_enable+0x5e/0xa0
[ 1587.362637]  ftrace_startup+0x16d/0x240
[ 1587.363139]  register_ftrace_function+0x43/0x90
[ 1587.363709]  perf_ftrace_event_register+0xc1/0xf0
[ 1587.364298]  perf_trace_event_init+0xa0/0x4c0
[ 1587.364853]  perf_trace_init+0xda/0x160
[ 1587.365345]  perf_tp_event_init+0x57/0xa0
[ 1587.365852]  perf_try_init_event+0x83/0x270
[ 1587.366397]  perf_event_alloc+0xe3f/0x1c10
[ 1587.366916]  ? _raw_spin_unlock+0x2c/0x50
[ 1587.367423]  ? alloc_fd+0x20d/0x320
[ 1587.367883]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1587.368481]  ? write_comp_data+0x2f/0x90
[ 1587.369027]  __x64_sys_perf_event_open+0x26/0x30
[ 1587.369604]  do_syscall_64+0x37/0x80
[ 1587.370061]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1587.370692] RIP: 0033:0x7fac0740459d
[ 1587.371142] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1587.373351] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1587.374275] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1587.375135] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1587.375996] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1587.376857] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1587.377717] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1587.378621] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1587.379582] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1587.381048] Call Trace:
[ 1587.381400]  dump_stack_lvl+0xa4/0xd3
[ 1587.381927]  dump_stack+0x15/0x17
[ 1587.382404]  check_preemption_disabled+0x167/0x180
[ 1587.383084]  debug_smp_processor_id+0x1c/0x20
[ 1587.383684]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1587.384420]  perf_tp_event+0x331/0x4e0
[ 1587.385020]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1587.385791]  ? trace_hardirqs_on+0x3f/0x170
[ 1587.386392]  ? arch_local_irq_enable+0x10/0x12
[ 1587.387006]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1587.387658]  ? dump_stack_lvl+0xcc/0xd3
[ 1587.388216]  ? dump_stack+0x15/0x17
[ 1587.388723]  ? __might_sleep+0x48/0x70
[ 1587.389240]  ? sched_show_task+0x70/0x70
[ 1587.389795]  perf_ftrace_function_call+0x248/0x360
[ 1587.390457]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1587.391068]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1587.391717]  ? perf_ftrace_function_call+0x248/0x360
[ 1587.392505]  ? 0xffffffffa0098099
[ 1587.393026]  0xffffffffa0098099
[ 1587.393526]  ? __might_fault+0x35/0xc0
[ 1587.394073]  ? ___might_sleep+0x5/0x170
[ 1587.394654]  ___might_sleep+0x5/0x170
[ 1587.395170]  __might_sleep+0x48/0x70
[ 1587.395674]  ? ___might_sleep+0x5/0x170
[ 1587.396201]  ? __might_sleep+0x48/0x70
[ 1587.396739]  __might_fault+0x5e/0xc0
[ 1587.397261]  _copy_from_user+0x31/0x140
[ 1587.397826]  get_timespec64+0x3f/0xd0
[ 1587.398385]  __x64_sys_nanosleep+0x3a/0x150
[ 1587.398997]  do_syscall_64+0x37/0x80
[ 1587.399506]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1587.400189] RIP: 0033:0x7fac073cca18
[ 1587.400686] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1587.403069] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1587.404072] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1587.405001] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1587.405932] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1587.406870] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1587.407801] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1659.354144] check_preemption_disabled: 701742 callbacks suppressed
[ 1659.354163] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24320
[ 1659.355987] caller is debug_smp_processor_id+0x1c/0x20
[ 1659.356654] CPU: 1 PID: 24320 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1659.357600] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1659.359022] Call Trace:
[ 1659.359360]  dump_stack_lvl+0xa4/0xd3
[ 1659.359888]  dump_stack+0x15/0x17
[ 1659.360338]  check_preemption_disabled+0x167/0x180
[ 1659.360966]  ? text_poke+0x2b/0x60
[ 1659.361437]  ? do_sync_core+0x30/0x30
[ 1659.361933]  debug_smp_processor_id+0x1c/0x20
[ 1659.362530]  perf_ftrace_function_call+0x7c/0x360
[ 1659.363142]  ? ftrace_ops_test+0x71/0xc0
[ 1659.363673]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1659.364276]  ? _raw_spin_unlock+0x2c/0x50
[ 1659.364805]  ? preempt_notifier_dec+0x20/0x20
[ 1659.365410]  ? do_sync_core+0x30/0x30
[ 1659.365908]  ? ftrace_call+0x5/0x44
[ 1659.366402]  ? write_comp_data+0x2f/0x90
[ 1659.366950]  ? perf_trace_buf_update+0x70/0x70
[ 1659.367530]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1659.368174]  ? __text_poke+0x4e0/0x4e0
[ 1659.368694]  0xffffffffa009a099
[ 1659.369151]  ? __text_poke+0x4e0/0x4e0
[ 1659.369705]  ? __text_poke+0x4e0/0x4e0
[ 1659.370213]  ? __text_poke+0x5/0x4e0
[ 1659.370741]  __text_poke+0x5/0x4e0
[ 1659.371200]  text_poke+0x2b/0x60
[ 1659.371636]  ? __text_poke+0x5/0x4e0
[ 1659.372128]  ? text_poke+0x2b/0x60
[ 1659.372607]  text_poke_bp_batch+0x93/0x2c0
[ 1659.373174]  ? user_disable_single_step+0x50/0x50
[ 1659.373825]  text_poke_queue+0xa7/0xc0
[ 1659.374366]  ftrace_replace_code+0xfd/0x170
[ 1659.374966]  ftrace_modify_all_code+0x1b1/0x270
[ 1659.375578]  arch_ftrace_update_code+0x9/0x10
[ 1659.376168]  ftrace_run_update_code+0x30/0xa0
[ 1659.376751]  ftrace_shutdown+0x2b8/0x4a0
[ 1659.377312]  unregister_ftrace_function+0x25/0x50
[ 1659.377961]  perf_ftrace_event_register+0x89/0xf0
[ 1659.378607]  ? perf_tp_event_init+0xa0/0xa0
[ 1659.379172]  perf_trace_destroy+0x37/0x60
[ 1659.379706]  tp_perf_event_destroy+0x15/0x20
[ 1659.380297]  _free_event+0xfc/0x7d0
[ 1659.380790]  put_event+0x37/0x50
[ 1659.381250]  perf_event_release_kernel+0x2f4/0x370
[ 1659.381938]  ? perf_event_release_kernel+0x370/0x370
[ 1659.382625]  perf_release+0x19/0x20
[ 1659.383113]  __fput+0x12d/0x460
[ 1659.383598]  ____fput+0x1a/0x20
[ 1659.384038]  task_work_run+0x8e/0xf0
[ 1659.384558]  do_exit+0x616/0x1310
[ 1659.385083]  __x64_sys_exit+0x24/0x30
[ 1659.385594]  do_syscall_64+0x37/0x80
[ 1659.386105]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1659.386786] RIP: 0033:0x7fac0740459d
[ 1659.387270] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1659.388085] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1659.389047] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1659.389972] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1659.390905] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1659.391798] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1659.392706] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1659.393849] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24320
[ 1659.394937] caller is debug_smp_processor_id+0x1c/0x20
[ 1659.395630] CPU: 1 PID: 24320 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1659.396608] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1659.398078] Call Trace:
[ 1659.398432]  dump_stack_lvl+0xa4/0xd3
[ 1659.398964]  dump_stack+0x15/0x17
[ 1659.399433]  check_preemption_disabled+0x167/0x180
[ 1659.400089]  ? text_poke+0x2b/0x60
[ 1659.400561]  ? do_sync_core+0x30/0x30
[ 1659.401084]  debug_smp_processor_id+0x1c/0x20
[ 1659.401684]  perf_ftrace_function_call+0x7c/0x360
[ 1659.402324]  ? ftrace_ops_test+0x71/0xc0
[ 1659.402874]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1659.403487]  ? _raw_spin_unlock+0x2c/0x50
[ 1659.404042]  ? preempt_notifier_dec+0x20/0x20
[ 1659.404653]  ? __text_poke+0x4e0/0x4e0
[ 1659.405186]  ? ftrace_call+0x5/0x44
[ 1659.405680]  ? write_comp_data+0x2f/0x90
[ 1659.406233]  ? perf_trace_buf_update+0x70/0x70
[ 1659.406837]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1659.407483]  ? alternatives_smp_module_del+0x90/0x90
[ 1659.408180]  0xffffffffa009a099
[ 1659.408651]  ? alternatives_smp_module_del+0x90/0x90
[ 1659.409366]  ? alternatives_smp_module_del+0x90/0x90
[ 1659.410044]  ? __text_poke+0x5/0x4e0
[ 1659.410574]  __text_poke+0x5/0x4e0
[ 1659.411051]  text_poke+0x2b/0x60
[ 1659.411514]  ? __text_poke+0x5/0x4e0
[ 1659.412008]  ? text_poke+0x2b/0x60
[ 1659.412503]  text_poke_bp_batch+0x93/0x2c0
[ 1659.413092]  ? user_disable_single_step+0x50/0x50
[ 1659.413754]  text_poke_queue+0xa7/0xc0
[ 1659.414326]  ftrace_replace_code+0xfd/0x170
[ 1659.414940]  ftrace_modify_all_code+0x1b1/0x270
[ 1659.415583]  arch_ftrace_update_code+0x9/0x10
[ 1659.416180]  ftrace_run_update_code+0x30/0xa0
[ 1659.416789]  ftrace_shutdown+0x2b8/0x4a0
[ 1659.417368]  unregister_ftrace_function+0x25/0x50
[ 1659.418014]  perf_ftrace_event_register+0x89/0xf0
[ 1659.418666]  ? perf_tp_event_init+0xa0/0xa0
[ 1659.419241]  perf_trace_destroy+0x37/0x60
[ 1659.419804]  tp_perf_event_destroy+0x15/0x20
[ 1659.420395]  _free_event+0xfc/0x7d0
[ 1659.420913]  put_event+0x37/0x50
[ 1659.421382]  perf_event_release_kernel+0x2f4/0x370
[ 1659.422072]  ? perf_event_release_kernel+0x370/0x370
[ 1659.422757]  perf_release+0x19/0x20
[ 1659.423252]  __fput+0x12d/0x460
[ 1659.423751]  ____fput+0x1a/0x20
[ 1659.424204]  task_work_run+0x8e/0xf0
[ 1659.424733]  do_exit+0x616/0x1310
[ 1659.425284]  __x64_sys_exit+0x24/0x30
[ 1659.425802]  do_syscall_64+0x37/0x80
[ 1659.426321]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1659.427000] RIP: 0033:0x7fac0740459d
[ 1659.427495] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1659.428343] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1659.429337] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1659.430273] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1659.431204] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1659.432135] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1659.433067] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1659.434205] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24320
[ 1659.435222] caller is debug_smp_processor_id+0x1c/0x20
[ 1659.435912] CPU: 1 PID: 24320 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1659.436887] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1659.438366] Call Trace:
[ 1659.438718]  dump_stack_lvl+0xa4/0xd3
[ 1659.439249]  dump_stack+0x15/0x17
[ 1659.439719]  check_preemption_disabled+0x167/0x180
[ 1659.440371]  ? text_poke+0x2b/0x60
[ 1659.440843]  ? do_sync_core+0x30/0x30
[ 1659.441366]  debug_smp_processor_id+0x1c/0x20
[ 1659.441966]  perf_ftrace_function_call+0x7c/0x360
[ 1659.442615]  ? ftrace_ops_test+0x71/0xc0
[ 1659.443165]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1659.443779]  ? _raw_spin_unlock+0x2c/0x50
[ 1659.444335]  ? preempt_notifier_dec+0x20/0x20
[ 1659.444944]  ? alternatives_smp_module_del+0x90/0x90
[ 1659.445631]  ? ftrace_call+0x5/0x44
[ 1659.446132]  ? write_comp_data+0x2f/0x90
[ 1659.446683]  ? perf_trace_buf_update+0x70/0x70
[ 1659.447292]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1659.447946]  ? alternatives_text_reserved+0xa0/0xa0
[ 1659.448633]  0xffffffffa009a099
[ 1659.449104]  ? alternatives_text_reserved+0xa0/0xa0
[ 1659.449807]  ? alternatives_text_reserved+0xa0/0xa0
[ 1659.450473]  ? __text_poke+0x5/0x4e0
[ 1659.450996]  __text_poke+0x5/0x4e0
[ 1659.451475]  text_poke+0x2b/0x60
[ 1659.451932]  ? __text_poke+0x5/0x4e0
[ 1659.452427]  ? text_poke+0x2b/0x60
[ 1659.452924]  text_poke_bp_batch+0x93/0x2c0
[ 1659.453514]  ? user_disable_single_step+0x50/0x50
[ 1659.454187]  text_poke_queue+0xa7/0xc0
[ 1659.454745]  ftrace_replace_code+0xfd/0x170
[ 1659.455353]  ftrace_modify_all_code+0x1b1/0x270
[ 1659.455996]  arch_ftrace_update_code+0x9/0x10
[ 1659.456600]  ftrace_run_update_code+0x30/0xa0
[ 1659.457211]  ftrace_shutdown+0x2b8/0x4a0
[ 1659.457809]  unregister_ftrace_function+0x25/0x50
[ 1659.458480]  perf_ftrace_event_register+0x89/0xf0
[ 1659.459122]  ? perf_tp_event_init+0xa0/0xa0
[ 1659.459698]  perf_trace_destroy+0x37/0x60
[ 1659.460260]  tp_perf_event_destroy+0x15/0x20
[ 1659.460853]  _free_event+0xfc/0x7d0
[ 1659.461372]  put_event+0x37/0x50
[ 1659.461846]  perf_event_release_kernel+0x2f4/0x370
[ 1659.462542]  ? perf_event_release_kernel+0x370/0x370
[ 1659.463227]  perf_release+0x19/0x20
[ 1659.463723]  __fput+0x12d/0x460
[ 1659.464224]  ____fput+0x1a/0x20
[ 1659.464679]  task_work_run+0x8e/0xf0
[ 1659.465211]  do_exit+0x616/0x1310
[ 1659.465764]  __x64_sys_exit+0x24/0x30
[ 1659.466288]  do_syscall_64+0x37/0x80
[ 1659.466795]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1659.467478] RIP: 0033:0x7fac0740459d
[ 1659.467974] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1659.468824] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1659.469819] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1659.470750] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1659.471679] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1659.472607] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1659.473534] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1659.474677] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24320
[ 1659.475693] caller is debug_smp_processor_id+0x1c/0x20
[ 1659.476381] CPU: 1 PID: 24320 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1659.477354] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1659.478823] Call Trace:
[ 1659.479175]  dump_stack_lvl+0xa4/0xd3
[ 1659.479704]  dump_stack+0x15/0x17
[ 1659.480173]  check_preemption_disabled+0x167/0x180
[ 1659.480825]  ? text_poke+0x2b/0x60
[ 1659.481297]  ? do_sync_core+0x30/0x30
[ 1659.481817]  debug_smp_processor_id+0x1c/0x20
[ 1659.482422]  perf_ftrace_function_call+0x7c/0x360
[ 1659.483059]  ? ftrace_ops_test+0x71/0xc0
[ 1659.483607]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1659.484223]  ? _raw_spin_unlock+0x2c/0x50
[ 1659.484779]  ? preempt_notifier_dec+0x20/0x20
[ 1659.485387]  ? alternatives_text_reserved+0xa0/0xa0
[ 1659.486066]  ? ftrace_call+0x5/0x44
[ 1659.486563]  ? write_comp_data+0x2f/0x90
[ 1659.487112]  ? perf_trace_buf_update+0x70/0x70
[ 1659.487720]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1659.488372]  ? text_poke_early+0xc0/0xc0
[ 1659.488939]  0xffffffffa009a099
[ 1659.489410]  ? text_poke_early+0xc0/0xc0
[ 1659.489993]  ? text_poke_early+0xc0/0xc0
[ 1659.490546]  ? __text_poke+0x5/0x4e0
[ 1659.491069]  __text_poke+0x5/0x4e0
[ 1659.491548]  text_poke+0x2b/0x60
[ 1659.492005]  ? __text_poke+0x5/0x4e0
[ 1659.492500]  ? text_poke+0x2b/0x60
[ 1659.492994]  text_poke_bp_batch+0x93/0x2c0
[ 1659.493582]  ? user_disable_single_step+0x50/0x50
[ 1659.494249]  text_poke_queue+0xa7/0xc0
[ 1659.494796]  ftrace_replace_code+0xfd/0x170
[ 1659.495401]  ftrace_modify_all_code+0x1b1/0x270
[ 1659.496043]  arch_ftrace_update_code+0x9/0x10
[ 1659.496641]  ftrace_run_update_code+0x30/0xa0
[ 1659.497249]  ftrace_shutdown+0x2b8/0x4a0
[ 1659.497827]  unregister_ftrace_function+0x25/0x50
[ 1659.498477]  perf_ftrace_event_register+0x89/0xf0
[ 1659.499118]  ? perf_tp_event_init+0xa0/0xa0
[ 1659.499693]  perf_trace_destroy+0x37/0x60
[ 1659.500253]  tp_perf_event_destroy+0x15/0x20
[ 1659.500846]  _free_event+0xfc/0x7d0
[ 1659.501364]  put_event+0x37/0x50
[ 1659.501832]  perf_event_release_kernel+0x2f4/0x370
[ 1659.502524]  ? perf_event_release_kernel+0x370/0x370
[ 1659.503208]  perf_release+0x19/0x20
[ 1659.503703]  __fput+0x12d/0x460
[ 1659.504202]  ____fput+0x1a/0x20
[ 1659.504656]  task_work_run+0x8e/0xf0
[ 1659.505185]  do_exit+0x616/0x1310
[ 1659.505736]  __x64_sys_exit+0x24/0x30
[ 1659.506264]  do_syscall_64+0x37/0x80
[ 1659.506772]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1659.507452] RIP: 0033:0x7fac0740459d
[ 1659.507948] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1659.508796] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1659.509788] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1659.510716] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1659.511641] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1659.512564] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1659.513487] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1659.514615] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24320
[ 1659.515646] caller is debug_smp_processor_id+0x1c/0x20
[ 1659.516334] CPU: 1 PID: 24320 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1659.517305] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1659.518774] Call Trace:
[ 1659.519126]  dump_stack_lvl+0xa4/0xd3
[ 1659.519655]  dump_stack+0x15/0x17
[ 1659.520122]  check_preemption_disabled+0x167/0x180
[ 1659.520774]  ? text_poke+0x2b/0x60
[ 1659.521245]  ? do_sync_core+0x30/0x30
[ 1659.521767]  debug_smp_processor_id+0x1c/0x20
[ 1659.522377]  perf_ftrace_function_call+0x7c/0x360
[ 1659.523011]  ? ftrace_ops_test+0x71/0xc0
[ 1659.523558]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1659.524171]  ? _raw_spin_unlock+0x2c/0x50
[ 1659.524725]  ? preempt_notifier_dec+0x20/0x20
[ 1659.525332]  ? text_poke_early+0xc0/0xc0
[ 1659.525886]  ? ftrace_call+0x5/0x44
[ 1659.526395]  ? write_comp_data+0x2f/0x90
[ 1659.526944]  ? perf_trace_buf_update+0x70/0x70
[ 1659.527551]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1659.528209]  ? apply_alternatives+0x370/0x370
[ 1659.528829]  0xffffffffa009a099
[ 1659.529300]  ? apply_alternatives+0x370/0x370
[ 1659.529936]  ? apply_alternatives+0x370/0x370
[ 1659.530570]  ? __text_poke+0x5/0x4e0
[ 1659.531104]  __text_poke+0x5/0x4e0
[ 1659.531583]  text_poke+0x2b/0x60
[ 1659.532040]  ? __text_poke+0x5/0x4e0
[ 1659.532533]  ? text_poke+0x2b/0x60
[ 1659.533028]  text_poke_bp_batch+0x93/0x2c0
[ 1659.533616]  ? user_disable_single_step+0x50/0x50
[ 1659.534288]  text_poke_queue+0xa7/0xc0
[ 1659.534834]  ftrace_replace_code+0xfd/0x170
[ 1659.535439]  ftrace_modify_all_code+0x1b1/0x270
[ 1659.536081]  arch_ftrace_update_code+0x9/0x10
[ 1659.536676]  ftrace_run_update_code+0x30/0xa0
[ 1659.537284]  ftrace_shutdown+0x2b8/0x4a0
[ 1659.537862]  unregister_ftrace_function+0x25/0x50
[ 1659.538518]  perf_ftrace_event_register+0x89/0xf0
[ 1659.539160]  ? perf_tp_event_init+0xa0/0xa0
[ 1659.539736]  perf_trace_destroy+0x37/0x60
[ 1659.540296]  tp_perf_event_destroy+0x15/0x20
[ 1659.540895]  _free_event+0xfc/0x7d0
[ 1659.541413]  put_event+0x37/0x50
[ 1659.541881]  perf_event_release_kernel+0x2f4/0x370
[ 1659.542578]  ? perf_event_release_kernel+0x370/0x370
[ 1659.543261]  perf_release+0x19/0x20
[ 1659.543757]  __fput+0x12d/0x460
[ 1659.544257]  ____fput+0x1a/0x20
[ 1659.544710]  task_work_run+0x8e/0xf0
[ 1659.545239]  do_exit+0x616/0x1310
[ 1659.545790]  __x64_sys_exit+0x24/0x30
[ 1659.546319]  do_syscall_64+0x37/0x80
[ 1659.546825]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1659.547506] RIP: 0033:0x7fac0740459d
[ 1659.548001] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1659.548850] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1659.549843] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1659.550777] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1659.551702] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1659.552628] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1659.553552] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1659.554699] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24320
[ 1659.555720] caller is debug_smp_processor_id+0x1c/0x20
[ 1659.556409] CPU: 1 PID: 24320 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1659.557384] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1659.558853] Call Trace:
[ 1659.559207]  dump_stack_lvl+0xa4/0xd3
[ 1659.559739]  dump_stack+0x15/0x17
[ 1659.560208]  check_preemption_disabled+0x167/0x180
[ 1659.560865]  ? text_poke+0x2b/0x60
[ 1659.561338]  ? do_sync_core+0x30/0x30
[ 1659.561862]  debug_smp_processor_id+0x1c/0x20
[ 1659.562465]  perf_ftrace_function_call+0x7c/0x360
[ 1659.563103]  ? ftrace_ops_test+0x71/0xc0
[ 1659.563653]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1659.564265]  ? _raw_spin_unlock+0x2c/0x50
[ 1659.564821]  ? preempt_notifier_dec+0x20/0x20
[ 1659.565432]  ? apply_alternatives+0x370/0x370
[ 1659.566046]  ? ftrace_call+0x5/0x44
[ 1659.566543]  ? write_comp_data+0x2f/0x90
[ 1659.567094]  ? perf_trace_buf_update+0x70/0x70
[ 1659.567704]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1659.568359]  ? apply_paravirt+0x150/0x150
[ 1659.568939]  0xffffffffa009a099
[ 1659.569411]  ? apply_paravirt+0x150/0x150
[ 1659.570016]  ? apply_paravirt+0x150/0x150
[ 1659.570602]  ? __text_poke+0x5/0x4e0
[ 1659.571135]  __text_poke+0x5/0x4e0
[ 1659.571615]  text_poke+0x2b/0x60
[ 1659.572074]  ? __text_poke+0x5/0x4e0
[ 1659.572568]  ? text_poke+0x2b/0x60
[ 1659.573063]  text_poke_bp_batch+0x93/0x2c0
[ 1659.573652]  ? user_disable_single_step+0x50/0x50
[ 1659.574327]  text_poke_queue+0xa7/0xc0
[ 1659.574875]  ftrace_replace_code+0xfd/0x170
[ 1659.575482]  ftrace_modify_all_code+0x1b1/0x270
[ 1659.576126]  arch_ftrace_update_code+0x9/0x10
[ 1659.576726]  ftrace_run_update_code+0x30/0xa0
[ 1659.577336]  ftrace_shutdown+0x2b8/0x4a0
[ 1659.577916]  unregister_ftrace_function+0x25/0x50
[ 1659.578574]  perf_ftrace_event_register+0x89/0xf0
[ 1659.579227]  ? perf_tp_event_init+0xa0/0xa0
[ 1659.579805]  perf_trace_destroy+0x37/0x60
[ 1659.580369]  tp_perf_event_destroy+0x15/0x20
[ 1659.580963]  _free_event+0xfc/0x7d0
[ 1659.581482]  put_event+0x37/0x50
[ 1659.581952]  perf_event_release_kernel+0x2f4/0x370
[ 1659.582650]  ? perf_event_release_kernel+0x370/0x370
[ 1659.583335]  perf_release+0x19/0x20
[ 1659.583830]  __fput+0x12d/0x460
[ 1659.584332]  ____fput+0x1a/0x20
[ 1659.584788]  task_work_run+0x8e/0xf0
[ 1659.585319]  do_exit+0x616/0x1310
[ 1659.585871]  __x64_sys_exit+0x24/0x30
[ 1659.586396]  do_syscall_64+0x37/0x80
[ 1659.586904]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1659.587587] RIP: 0033:0x7fac0740459d
[ 1659.588083] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1659.588932] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1659.589933] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1659.590873] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1659.591799] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1659.592726] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1659.593655] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1659.594788] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24320
[ 1659.595805] caller is debug_smp_processor_id+0x1c/0x20
[ 1659.596491] CPU: 1 PID: 24320 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1659.597462] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1659.598931] Call Trace:
[ 1659.599283]  dump_stack_lvl+0xa4/0xd3
[ 1659.599812]  dump_stack+0x15/0x17
[ 1659.600280]  check_preemption_disabled+0x167/0x180
[ 1659.600938]  ? text_poke_bp_batch+0x93/0x2c0
[ 1659.601517]  ? apply_paravirt+0x150/0x150
[ 1659.602099]  debug_smp_processor_id+0x1c/0x20
[ 1659.602697]  perf_ftrace_function_call+0x7c/0x360
[ 1659.603339]  ? preempt_notifier_dec+0x20/0x20
[ 1659.603948]  ? apply_paravirt+0x150/0x150
[ 1659.604512]  ? ftrace_call+0x5/0x44
[ 1659.605001]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1659.605752]  0xffffffffa009a099
[ 1659.606286]  ? text_poke+0x60/0x60
[ 1659.606764]  ? text_poke+0x5/0x60
[ 1659.607273]  text_poke+0x5/0x60
[ 1659.607723]  text_poke_bp_batch+0x93/0x2c0
[ 1659.608288]  ? text_poke+0x5/0x60
[ 1659.608749]  ? text_poke_bp_batch+0x93/0x2c0
[ 1659.609358]  ? user_disable_single_step+0x50/0x50
[ 1659.610022]  text_poke_queue+0xa7/0xc0
[ 1659.610581]  ftrace_replace_code+0xfd/0x170
[ 1659.611187]  ftrace_modify_all_code+0x1b1/0x270
[ 1659.611836]  arch_ftrace_update_code+0x9/0x10
[ 1659.612433]  ftrace_run_update_code+0x30/0xa0
[ 1659.613043]  ftrace_shutdown+0x2b8/0x4a0
[ 1659.613621]  unregister_ftrace_function+0x25/0x50
[ 1659.614277]  perf_ftrace_event_register+0x89/0xf0
[ 1659.614918]  ? perf_tp_event_init+0xa0/0xa0
[ 1659.615493]  perf_trace_destroy+0x37/0x60
[ 1659.616054]  tp_perf_event_destroy+0x15/0x20
[ 1659.616651]  _free_event+0xfc/0x7d0
[ 1659.617183]  put_event+0x37/0x50
[ 1659.617652]  perf_event_release_kernel+0x2f4/0x370
[ 1659.618344]  ? perf_event_release_kernel+0x370/0x370
[ 1659.619030]  perf_release+0x19/0x20
[ 1659.619526]  __fput+0x12d/0x460
[ 1659.620027]  ____fput+0x1a/0x20
[ 1659.620480]  task_work_run+0x8e/0xf0
[ 1659.621011]  do_exit+0x616/0x1310
[ 1659.621563]  __x64_sys_exit+0x24/0x30
[ 1659.622085]  do_syscall_64+0x37/0x80
[ 1659.622593]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1659.623273] RIP: 0033:0x7fac0740459d
[ 1659.623771] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1659.624622] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1659.625615] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1659.626546] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1659.627475] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1659.628403] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1659.629330] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1659.630511] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24320
[ 1659.631524] caller is debug_smp_processor_id+0x1c/0x20
[ 1659.632215] CPU: 1 PID: 24320 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1659.633188] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1659.634667] Call Trace:
[ 1659.635019]  dump_stack_lvl+0xa4/0xd3
[ 1659.635549]  dump_stack+0x15/0x17
[ 1659.636018]  check_preemption_disabled+0x167/0x180
[ 1659.636671]  ? text_poke+0x2b/0x60
[ 1659.637149]  ? do_sync_core+0x30/0x30
[ 1659.637700]  debug_smp_processor_id+0x1c/0x20
[ 1659.638312]  perf_ftrace_function_call+0x7c/0x360
[ 1659.638947]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1659.639587]  ? text_poke_bp_batch+0x93/0x2c0
[ 1659.640174]  ? perf_ftrace_function_call+0x4c/0x360
[ 1659.640839]  ? preempt_notifier_dec+0x20/0x20
[ 1659.641448]  ? apply_paravirt+0x150/0x150
[ 1659.642014]  ? ftrace_call+0x5/0x44
[ 1659.642513]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1659.643202]  ? text_poke+0x60/0x60
[ 1659.643706]  0xffffffffa009a099
[ 1659.644177]  ? text_poke+0x60/0x60
[ 1659.644697]  ? text_poke+0x60/0x60
[ 1659.645175]  ? __text_poke+0x5/0x4e0
[ 1659.645698]  __text_poke+0x5/0x4e0
[ 1659.646185]  text_poke+0x2b/0x60
[ 1659.646643]  ? __text_poke+0x5/0x4e0
[ 1659.647137]  ? text_poke+0x2b/0x60
[ 1659.647634]  text_poke_bp_batch+0x93/0x2c0
[ 1659.648223]  ? user_disable_single_step+0x50/0x50
[ 1659.648885]  text_poke_queue+0xa7/0xc0
[ 1659.649433]  ftrace_replace_code+0xfd/0x170
[ 1659.650040]  ftrace_modify_all_code+0x1b1/0x270
[ 1659.650688]  arch_ftrace_update_code+0x9/0x10
[ 1659.651284]  ftrace_run_update_code+0x30/0xa0
[ 1659.651894]  ftrace_shutdown+0x2b8/0x4a0
[ 1659.652472]  unregister_ftrace_function+0x25/0x50
[ 1659.653118]  perf_ftrace_event_register+0x89/0xf0
[ 1659.653760]  ? perf_tp_event_init+0xa0/0xa0
[ 1659.654344]  perf_trace_destroy+0x37/0x60
[ 1659.654907]  tp_perf_event_destroy+0x15/0x20
[ 1659.655499]  _free_event+0xfc/0x7d0
[ 1659.656016]  put_event+0x37/0x50
[ 1659.656485]  perf_event_release_kernel+0x2f4/0x370
[ 1659.657175]  ? perf_event_release_kernel+0x370/0x370
[ 1659.657858]  perf_release+0x19/0x20
[ 1659.658362]  __fput+0x12d/0x460
[ 1659.658862]  ____fput+0x1a/0x20
[ 1659.659317]  task_work_run+0x8e/0xf0
[ 1659.659847]  do_exit+0x616/0x1310
[ 1659.660396]  __x64_sys_exit+0x24/0x30
[ 1659.660914]  do_syscall_64+0x37/0x80
[ 1659.661420]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1659.662116] RIP: 0033:0x7fac0740459d
[ 1659.662612] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1659.663460] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1659.664453] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1659.665379] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1659.666317] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1659.667245] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1659.668173] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1659.669295] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24320
[ 1659.670370] caller is debug_smp_processor_id+0x1c/0x20
[ 1659.671069] CPU: 1 PID: 24320 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1659.672052] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1659.673515] Call Trace:
[ 1659.673869]  dump_stack_lvl+0xa4/0xd3
[ 1659.674407]  dump_stack+0x15/0x17
[ 1659.674876]  check_preemption_disabled+0x167/0x180
[ 1659.675529]  ? text_poke_bp_batch+0x93/0x2c0
[ 1659.676109]  ? apply_paravirt+0x150/0x150
[ 1659.676678]  debug_smp_processor_id+0x1c/0x20
[ 1659.677279]  perf_ftrace_function_call+0x7c/0x360
[ 1659.677922]  ? preempt_notifier_dec+0x20/0x20
[ 1659.678535]  ? text_poke+0x60/0x60
[ 1659.679026]  ? ftrace_call+0x5/0x44
[ 1659.679516]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1659.680267]  0xffffffffa009a099
[ 1659.680791]  ? alternatives_smp_module_add+0x160/0x160
[ 1659.681485]  ? text_poke+0x5/0x60
[ 1659.681976]  text_poke+0x5/0x60
[ 1659.682426]  text_poke_bp_batch+0x93/0x2c0
[ 1659.682992]  ? text_poke+0x5/0x60
[ 1659.683453]  ? text_poke_bp_batch+0x93/0x2c0
[ 1659.684062]  ? user_disable_single_step+0x50/0x50
[ 1659.684724]  text_poke_queue+0xa7/0xc0
[ 1659.685271]  ftrace_replace_code+0xfd/0x170
[ 1659.685875]  ftrace_modify_all_code+0x1b1/0x270
[ 1659.686522]  arch_ftrace_update_code+0x9/0x10
[ 1659.687121]  ftrace_run_update_code+0x30/0xa0
[ 1659.687730]  ftrace_shutdown+0x2b8/0x4a0
[ 1659.688308]  unregister_ftrace_function+0x25/0x50
[ 1659.688954]  perf_ftrace_event_register+0x89/0xf0
[ 1659.689597]  ? perf_tp_event_init+0xa0/0xa0
[ 1659.690177]  perf_trace_destroy+0x37/0x60
[ 1659.690740]  tp_perf_event_destroy+0x15/0x20
[ 1659.691333]  _free_event+0xfc/0x7d0
[ 1659.691852]  put_event+0x37/0x50
[ 1659.692321]  perf_event_release_kernel+0x2f4/0x370
[ 1659.693007]  ? perf_event_release_kernel+0x370/0x370
[ 1659.693693]  perf_release+0x19/0x20
[ 1659.694203]  __fput+0x12d/0x460
[ 1659.694704]  ____fput+0x1a/0x20
[ 1659.695158]  task_work_run+0x8e/0xf0
[ 1659.695689]  do_exit+0x616/0x1310
[ 1659.696243]  __x64_sys_exit+0x24/0x30
[ 1659.696763]  do_syscall_64+0x37/0x80
[ 1659.697270]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1659.697950] RIP: 0033:0x7fac0740459d
[ 1659.698454] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1659.699303] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1659.700297] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1659.701224] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1659.702160] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1659.703086] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1659.704016] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1659.705149] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24320
[ 1659.706224] caller is debug_smp_processor_id+0x1c/0x20
[ 1659.706949] CPU: 1 PID: 24320 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1659.707949] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1659.709439] Call Trace:
[ 1659.709796]  dump_stack_lvl+0xa4/0xd3
[ 1659.710344]  dump_stack+0x15/0x17
[ 1659.710816]  check_preemption_disabled+0x167/0x180
[ 1659.711483]  ? text_poke+0x2b/0x60
[ 1659.711960]  ? do_sync_core+0x30/0x30
[ 1659.712485]  debug_smp_processor_id+0x1c/0x20
[ 1659.713094]  perf_ftrace_function_call+0x7c/0x360
[ 1659.713735]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1659.714397]  ? text_poke_bp_batch+0x93/0x2c0
[ 1659.714991]  ? perf_ftrace_function_call+0x4c/0x360
[ 1659.715661]  ? preempt_notifier_dec+0x20/0x20
[ 1659.716278]  ? text_poke+0x60/0x60
[ 1659.716772]  ? ftrace_call+0x5/0x44
[ 1659.717262]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1659.717950]  ? alternatives_smp_module_add+0x160/0x160
[ 1659.718675]  0xffffffffa009a099
[ 1659.719155]  ? alternatives_smp_module_add+0x160/0x160
[ 1659.719891]  ? alternatives_smp_module_add+0x160/0x160
[ 1659.720585]  ? __text_poke+0x5/0x4e0
[ 1659.721108]  __text_poke+0x5/0x4e0
[ 1659.721588]  text_poke+0x2b/0x60
[ 1659.722050]  ? __text_poke+0x5/0x4e0
[ 1659.722546]  ? text_poke+0x2b/0x60
[ 1659.723041]  text_poke_bp_batch+0x93/0x2c0
[ 1659.723630]  ? user_disable_single_step+0x50/0x50
[ 1659.724294]  text_poke_queue+0xa7/0xc0
[ 1659.724840]  ftrace_replace_code+0xfd/0x170
[ 1659.725444]  ftrace_modify_all_code+0x1b1/0x270
[ 1659.726089]  arch_ftrace_update_code+0x9/0x10
[ 1659.726691]  ftrace_run_update_code+0x30/0xa0
[ 1659.727307]  ftrace_shutdown+0x2b8/0x4a0
[ 1659.727888]  unregister_ftrace_function+0x25/0x50
[ 1659.728535]  perf_ftrace_event_register+0x89/0xf0
[ 1659.729178]  ? perf_tp_event_init+0xa0/0xa0
[ 1659.729758]  perf_trace_destroy+0x37/0x60
[ 1659.730326]  tp_perf_event_destroy+0x15/0x20
[ 1659.730921]  _free_event+0xfc/0x7d0
[ 1659.731440]  put_event+0x37/0x50
[ 1659.731908]  perf_event_release_kernel+0x2f4/0x370
[ 1659.732594]  ? perf_event_release_kernel+0x370/0x370
[ 1659.733276]  perf_release+0x19/0x20
[ 1659.733772]  __fput+0x12d/0x460
[ 1659.734276]  ____fput+0x1a/0x20
[ 1659.734731]  task_work_run+0x8e/0xf0
[ 1659.735260]  do_exit+0x616/0x1310
[ 1659.735811]  __x64_sys_exit+0x24/0x30
[ 1659.736328]  do_syscall_64+0x37/0x80
[ 1659.736835]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1659.737516] RIP: 0033:0x7fac0740459d
[ 1659.738012] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1659.738944] RSP: 002b:00007ffebadbff38 EFLAGS: 00000202 ORIG_RAX: 000000000000003c
[ 1659.739942] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1659.740869] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[ 1659.741796] RBP: 00007ffebadbff50 R08: 0000000000000000 R09: 00000000ffffffff
[ 1659.742731] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000401180
[ 1659.743657] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1664.358065] check_preemption_disabled: 2091606 callbacks suppressed
[ 1664.358090] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1664.358131] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1664.359036] caller is debug_smp_processor_id+0x1c/0x20
[ 1664.359983] caller is debug_smp_processor_id+0x1c/0x20
[ 1664.361117] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1664.363519] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1664.365117] Call Trace:
[ 1664.365524]  dump_stack_lvl+0xa4/0xd3
[ 1664.366145]  dump_stack+0x15/0x17
[ 1664.366676]  check_preemption_disabled+0x167/0x180
[ 1664.367406]  ? insn_get_prefixes.part.1+0x114/0x650
[ 1664.368133]  ? bad_get_user+0xd/0xd
[ 1664.368709]  debug_smp_processor_id+0x1c/0x20
[ 1664.369381]  perf_ftrace_function_call+0x7c/0x360
[ 1664.370104]  ? perf_ftrace_function_call+0x248/0x360
[ 1664.370868]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1664.371549]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1664.372264]  ? insn_get_opcode+0x1d5/0x3b0
[ 1664.372897]  ? perf_ftrace_function_call+0x4c/0x360
[ 1664.373855]  0xffffffffa009a099
[ 1664.374482]  ? insn_get_prefixes.part.1+0xb3/0x650
[ 1664.375243]  ? inat_get_opcode_attribute+0x5/0x20
[ 1664.375961]  ? write_comp_data+0x2f/0x90
[ 1664.376594]  inat_get_opcode_attribute+0x5/0x20
[ 1664.377287]  insn_get_prefixes.part.1+0x114/0x650
[ 1664.378003]  ? inat_get_opcode_attribute+0x5/0x20
[ 1664.378718]  ? insn_get_prefixes.part.1+0x114/0x650
[ 1664.379453]  ? write_comp_data+0x2f/0x90
[ 1664.380139]  insn_get_opcode+0x1d5/0x3b0
[ 1664.380804]  insn_get_modrm+0x12b/0x2a0
[ 1664.381456]  insn_get_sib+0x122/0x140
[ 1664.382079]  insn_get_displacement+0x157/0x270
[ 1664.382803]  insn_get_immediate+0x181/0x570
[ 1664.383502]  insn_get_length+0x75/0x90
[ 1664.384120]  insn_decode+0x9b/0x170
[ 1664.384692]  ? release_task+0x20/0x20
[ 1664.385270]  text_poke_loc_init+0x63/0x140
[ 1664.386063]  ? release_task+0x20/0x20
[ 1664.386682]  text_poke_queue+0x84/0xc0
[ 1664.387315]  ftrace_replace_code+0xfd/0x170
[ 1664.388015]  ftrace_modify_all_code+0x1b1/0x270
[ 1664.388752]  arch_ftrace_update_code+0x9/0x10
[ 1664.389420]  ftrace_run_update_code+0x30/0xa0
[ 1664.390115]  ftrace_startup_enable+0x5e/0xa0
[ 1664.390793]  ftrace_startup+0x16d/0x240
[ 1664.391469]  register_ftrace_function+0x43/0x90
[ 1664.392184]  perf_ftrace_event_register+0xc1/0xf0
[ 1664.392924]  perf_trace_event_init+0xa0/0x4c0
[ 1664.393650]  perf_trace_init+0xda/0x160
[ 1664.394302]  perf_tp_event_init+0x57/0xa0
[ 1664.394952]  perf_try_init_event+0x83/0x270
[ 1664.395677]  perf_event_alloc+0xe3f/0x1c10
[ 1664.396303]  ? _raw_spin_unlock+0x2c/0x50
[ 1664.396946]  ? alloc_fd+0x20d/0x320
[ 1664.397610]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1664.398372]  ? write_comp_data+0x2f/0x90
[ 1664.399336]  __x64_sys_perf_event_open+0x26/0x30
[ 1664.400065]  do_syscall_64+0x37/0x80
[ 1664.400648]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1664.401413] RIP: 0033:0x7fac0740459d
[ 1664.401974] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1664.404563] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1664.405659] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1664.406686] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1664.407700] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1664.408713] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1664.409723] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1664.410989] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1664.411119] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1664.411942] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1664.413037] caller is debug_smp_processor_id+0x1c/0x20
[ 1664.414399] Call Trace:
[ 1664.414414]  dump_stack_lvl+0xa4/0xd3
[ 1664.414439]  dump_stack+0x15/0x17
[ 1664.414454]  check_preemption_disabled+0x167/0x180
[ 1664.414473]  ? schedule_timeout+0x34e/0x610
[ 1664.414488]  ? do_init_timer+0xa0/0xa0
[ 1664.414510]  debug_smp_processor_id+0x1c/0x20
[ 1664.418468]  perf_ftrace_function_call+0x7c/0x360
[ 1664.419066]  ? 0xffffffffa009a099
[ 1664.419491]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1664.420096]  ? finish_task_switch+0xab/0x2a0
[ 1664.420631]  ? __schedule+0x46e/0xb20
[ 1664.421114]  0xffffffffa009a099
[ 1664.421520]  ? finish_task_switch+0xb0/0x2a0
[ 1664.422079]  ? del_timer_sync+0x5/0x130
[ 1664.422574]  del_timer_sync+0x5/0x130
[ 1664.423040]  schedule_timeout+0x34e/0x610
[ 1664.423546]  ? del_timer_sync+0x5/0x130
[ 1664.424029]  ? schedule_timeout+0x34e/0x610
[ 1664.424566]  ? del_timer_sync+0x130/0x130
[ 1664.425079]  ? i915_init_ggtt+0x40/0x6b0
[ 1664.425588]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1664.426098]  ? rcu_gp_init+0x730/0x730
[ 1664.426574]  rcu_gp_kthread+0xdd/0x170
[ 1664.427059]  kthread+0x1e7/0x230
[ 1664.427476]  ? set_kthread_struct+0x80/0x80
[ 1664.428010]  ret_from_fork+0x1f/0x30
[ 1664.428506] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1664.428539] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1664.429580] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1664.430558] caller is debug_smp_processor_id+0x1c/0x20
[ 1664.432121] Call Trace:
[ 1664.433135]  dump_stack_lvl+0xa4/0xd3
[ 1664.433749]  dump_stack+0x15/0x17
[ 1664.434285]  check_preemption_disabled+0x167/0x180
[ 1664.435073]  debug_smp_processor_id+0x1c/0x20
[ 1664.435747]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1664.436615]  perf_trace_buf_alloc+0x3d/0x100
[ 1664.437276]  ? insn_get_prefixes.part.1+0x114/0x650
[ 1664.438005]  ? bad_get_user+0xd/0xd
[ 1664.438577]  perf_ftrace_function_call+0x209/0x360
[ 1664.439520]  ? 0xffffffffa009a099
[ 1664.440169]  0xffffffffa009a099
[ 1664.440793]  ? insn_get_prefixes.part.1+0xb3/0x650
[ 1664.441556]  ? inat_get_opcode_attribute+0x5/0x20
[ 1664.442279]  ? write_comp_data+0x2f/0x90
[ 1664.442915]  inat_get_opcode_attribute+0x5/0x20
[ 1664.443612]  insn_get_prefixes.part.1+0x114/0x650
[ 1664.444330]  ? inat_get_opcode_attribute+0x5/0x20
[ 1664.445037]  ? insn_get_prefixes.part.1+0x114/0x650
[ 1664.445772]  ? write_comp_data+0x2f/0x90
[ 1664.446479]  insn_get_opcode+0x1d5/0x3b0
[ 1664.447149]  insn_get_modrm+0x12b/0x2a0
[ 1664.447806]  insn_get_sib+0x122/0x140
[ 1664.448428]  insn_get_displacement+0x157/0x270
[ 1664.449153]  insn_get_immediate+0x181/0x570
[ 1664.449856]  insn_get_length+0x75/0x90
[ 1664.450482]  insn_decode+0x9b/0x170
[ 1664.451059]  ? release_task+0x20/0x20
[ 1664.451638]  text_poke_loc_init+0x63/0x140
[ 1664.452431]  ? release_task+0x20/0x20
[ 1664.453054]  text_poke_queue+0x84/0xc0
[ 1664.453692]  ftrace_replace_code+0xfd/0x170
[ 1664.454401]  ftrace_modify_all_code+0x1b1/0x270
[ 1664.455142]  arch_ftrace_update_code+0x9/0x10
[ 1664.455815]  ftrace_run_update_code+0x30/0xa0
[ 1664.456510]  ftrace_startup_enable+0x5e/0xa0
[ 1664.457193]  ftrace_startup+0x16d/0x240
[ 1664.457873]  register_ftrace_function+0x43/0x90
[ 1664.458599]  perf_ftrace_event_register+0xc1/0xf0
[ 1664.459344]  perf_trace_event_init+0xa0/0x4c0
[ 1664.460075]  perf_trace_init+0xda/0x160
[ 1664.460724]  perf_tp_event_init+0x57/0xa0
[ 1664.461373]  perf_try_init_event+0x83/0x270
[ 1664.462095]  perf_event_alloc+0xe3f/0x1c10
[ 1664.462720]  ? _raw_spin_unlock+0x2c/0x50
[ 1664.463356]  ? alloc_fd+0x20d/0x320
[ 1664.464021]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1664.464774]  ? write_comp_data+0x2f/0x90
[ 1664.465742]  __x64_sys_perf_event_open+0x26/0x30
[ 1664.466464]  do_syscall_64+0x37/0x80
[ 1664.467043]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1664.467800] RIP: 0033:0x7fac0740459d
[ 1664.468360] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1664.470939] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1664.472040] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1664.473058] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1664.474090] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1664.475111] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1664.476130] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1664.477384] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1664.477497] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1664.478332] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1664.478343] Call Trace:
[ 1664.478353]  dump_stack_lvl+0xa4/0xd3
[ 1664.478376]  dump_stack+0x15/0x17
[ 1664.478391]  check_preemption_disabled+0x167/0x180
[ 1664.478410]  ? del_timer_sync+0xd3/0x130
[ 1664.478425]  ? detach_if_pending+0x270/0x270
[ 1664.479431] caller is debug_smp_processor_id+0x1c/0x20
[ 1664.480794]  debug_smp_processor_id+0x1c/0x20
[ 1664.484693]  perf_ftrace_function_call+0x7c/0x360
[ 1664.485281]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1664.485877]  ? register_lock_class+0x42/0x440
[ 1664.486432]  ? del_timer_sync+0x40/0x130
[ 1664.486932]  ? 0xffffffffa009a099
[ 1664.487357]  ? 0xffffffffa009a099
[ 1664.487782]  ? 0xffffffffa009a099
[ 1664.488218]  0xffffffffa009a099
[ 1664.488619]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1664.489222]  ? del_timer_sync+0xa5/0x130
[ 1664.489723]  ? try_to_del_timer_sync+0x5/0x90
[ 1664.490273]  ? write_comp_data+0x2f/0x90
[ 1664.490772]  try_to_del_timer_sync+0x5/0x90
[ 1664.491299]  del_timer_sync+0xd3/0x130
[ 1664.491775]  ? try_to_del_timer_sync+0x5/0x90
[ 1664.492320]  ? del_timer_sync+0xd3/0x130
[ 1664.492822]  schedule_timeout+0x34e/0x610
[ 1664.493339]  ? del_timer_sync+0x130/0x130
[ 1664.493852]  ? i915_init_ggtt+0x40/0x6b0
[ 1664.494364]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1664.494872]  ? rcu_gp_init+0x730/0x730
[ 1664.495347]  rcu_gp_kthread+0xdd/0x170
[ 1664.495831]  kthread+0x1e7/0x230
[ 1664.496250]  ? set_kthread_struct+0x80/0x80
[ 1664.496784]  ret_from_fork+0x1f/0x30
[ 1664.497278] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1664.497325] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1664.498266] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1664.498283] Call Trace:
[ 1664.499247] caller is debug_smp_processor_id+0x1c/0x20
[ 1664.500713]  dump_stack_lvl+0xa4/0xd3
[ 1664.502195]  dump_stack+0x15/0x17
[ 1664.502666]  check_preemption_disabled+0x167/0x180
[ 1664.503353]  debug_smp_processor_id+0x1c/0x20
[ 1664.503957]  perf_trace_buf_alloc+0x98/0x100
[ 1664.504551]  ? insn_get_prefixes.part.1+0x114/0x650
[ 1664.505211]  ? bad_get_user+0xd/0xd
[ 1664.505712]  perf_ftrace_function_call+0x209/0x360
[ 1664.506481]  ? 0xffffffffa009a099
[ 1664.507014]  0xffffffffa009a099
[ 1664.507523]  ? insn_get_prefixes.part.1+0xb3/0x650
[ 1664.508195]  ? inat_get_opcode_attribute+0x5/0x20
[ 1664.508842]  ? write_comp_data+0x2f/0x90
[ 1664.509401]  inat_get_opcode_attribute+0x5/0x20
[ 1664.510027]  insn_get_prefixes.part.1+0x114/0x650
[ 1664.510673]  ? inat_get_opcode_attribute+0x5/0x20
[ 1664.511312]  ? insn_get_prefixes.part.1+0x114/0x650
[ 1664.511978]  ? write_comp_data+0x2f/0x90
[ 1664.512562]  insn_get_opcode+0x1d5/0x3b0
[ 1664.513135]  insn_get_modrm+0x12b/0x2a0
[ 1664.513697]  insn_get_sib+0x122/0x140
[ 1664.514236]  insn_get_displacement+0x157/0x270
[ 1664.514869]  insn_get_immediate+0x181/0x570
[ 1664.515474]  insn_get_length+0x75/0x90
[ 1664.516016]  insn_decode+0x9b/0x170
[ 1664.516518]  ? release_task+0x20/0x20
[ 1664.517032]  text_poke_loc_init+0x63/0x140
[ 1664.517677]  ? release_task+0x20/0x20
[ 1664.518219]  text_poke_queue+0x84/0xc0
[ 1664.518769]  ftrace_replace_code+0xfd/0x170
[ 1664.519377]  ftrace_modify_all_code+0x1b1/0x270
[ 1664.520022]  arch_ftrace_update_code+0x9/0x10
[ 1664.520622]  ftrace_run_update_code+0x30/0xa0
[ 1664.521234]  ftrace_startup_enable+0x5e/0xa0
[ 1664.521835]  ftrace_startup+0x16d/0x240
[ 1664.522414]  register_ftrace_function+0x43/0x90
[ 1664.523048]  perf_ftrace_event_register+0xc1/0xf0
[ 1664.523705]  perf_trace_event_init+0xa0/0x4c0
[ 1664.524335]  perf_trace_init+0xda/0x160
[ 1664.524895]  perf_tp_event_init+0x57/0xa0
[ 1664.525466]  perf_try_init_event+0x83/0x270
[ 1664.526084]  perf_event_alloc+0xe3f/0x1c10
[ 1664.526651]  ? _raw_spin_unlock+0x2c/0x50
[ 1664.527216]  ? alloc_fd+0x20d/0x320
[ 1664.527763]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1664.528428]  ? write_comp_data+0x2f/0x90
[ 1664.529151]  __x64_sys_perf_event_open+0x26/0x30
[ 1664.529792]  do_syscall_64+0x37/0x80
[ 1664.530306]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1664.530993] RIP: 0033:0x7fac0740459d
[ 1664.531492] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1664.533872] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1664.534891] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1664.535865] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1664.536798] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1664.537730] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1664.538665] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1664.539714] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1664.539856] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1664.540660] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1664.541669] caller is debug_smp_processor_id+0x1c/0x20
[ 1664.543026] Call Trace:
[ 1664.543037]  dump_stack_lvl+0xa4/0xd3
[ 1664.543060]  dump_stack+0x15/0x17
[ 1664.543076]  check_preemption_disabled+0x167/0x180
[ 1664.543094]  ? try_to_del_timer_sync+0x33/0x90
[ 1664.543110]  ? calc_wheel_index+0x2d0/0x2d0
[ 1664.543130]  debug_smp_processor_id+0x1c/0x20
[ 1664.547113]  perf_ftrace_function_call+0x7c/0x360
[ 1664.547703]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1664.548291]  ? del_timer_sync+0xd3/0x130
[ 1664.548788]  ? perf_ftrace_function_call+0x4c/0x360
[ 1664.549394]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1664.549989]  ? register_lock_class+0x42/0x440
[ 1664.550543]  ? del_timer_sync+0x40/0x130
[ 1664.551044]  ? 0xffffffffa009a099
[ 1664.551468]  ? 0xffffffffa009a099
[ 1664.551901]  0xffffffffa009a099
[ 1664.552310]  ? 0xffffffffa009a099
[ 1664.552732]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1664.553325]  ? del_timer_sync+0xa5/0x130
[ 1664.553828]  ? lock_timer_base+0x5/0x100
[ 1664.554339]  lock_timer_base+0x5/0x100
[ 1664.554816]  try_to_del_timer_sync+0x33/0x90
[ 1664.555356]  ? lock_timer_base+0x5/0x100
[ 1664.555850]  ? try_to_del_timer_sync+0x33/0x90
[ 1664.556405]  ? try_to_del_timer_sync+0x5/0x90
[ 1664.556959]  del_timer_sync+0xd3/0x130
[ 1664.557442]  schedule_timeout+0x34e/0x610
[ 1664.557960]  ? del_timer_sync+0x130/0x130
[ 1664.558480]  ? i915_init_ggtt+0x40/0x6b0
[ 1664.558990]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1664.559504]  ? rcu_gp_init+0x730/0x730
[ 1664.559981]  rcu_gp_kthread+0xdd/0x170
[ 1664.560466]  kthread+0x1e7/0x230
[ 1664.560884]  ? set_kthread_struct+0x80/0x80
[ 1664.561419]  ret_from_fork+0x1f/0x30
[ 1664.561913] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1664.561941] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1664.562903] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1664.562920] Call Trace:
[ 1664.563894] caller is debug_smp_processor_id+0x1c/0x20
[ 1664.565381]  dump_stack_lvl+0xa4/0xd3
[ 1664.566867]  dump_stack+0x15/0x17
[ 1664.567340]  check_preemption_disabled+0x167/0x180
[ 1664.568028]  debug_smp_processor_id+0x1c/0x20
[ 1664.568633]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1664.569379]  perf_tp_event+0x331/0x4e0
[ 1664.569989]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1664.570796]  ? arch_local_irq_enable+0x10/0x12
[ 1664.571410]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1664.572067]  ? dump_stack_lvl+0xcc/0xd3
[ 1664.572621]  ? dump_stack+0x15/0x17
[ 1664.573115]  ? check_preemption_disabled+0x167/0x180
[ 1664.573807]  ? insn_get_prefixes.part.1+0x114/0x650
[ 1664.574474]  ? bad_get_user+0xd/0xd
[ 1664.574983]  perf_ftrace_function_call+0x248/0x360
[ 1664.575644]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1664.576293]  ? perf_ftrace_function_call+0x248/0x360
[ 1664.577098]  ? 0xffffffffa009a099
[ 1664.577668]  0xffffffffa009a099
[ 1664.578217]  ? insn_get_prefixes.part.1+0xb3/0x650
[ 1664.578892]  ? inat_get_opcode_attribute+0x5/0x20
[ 1664.579542]  ? write_comp_data+0x2f/0x90
[ 1664.580103]  inat_get_opcode_attribute+0x5/0x20
[ 1664.580732]  insn_get_prefixes.part.1+0x114/0x650
[ 1664.581380]  ? inat_get_opcode_attribute+0x5/0x20
[ 1664.582023]  ? insn_get_prefixes.part.1+0x114/0x650
[ 1664.582693]  ? write_comp_data+0x2f/0x90
[ 1664.583280]  insn_get_opcode+0x1d5/0x3b0
[ 1664.583857]  insn_get_modrm+0x12b/0x2a0
[ 1664.584421]  insn_get_sib+0x122/0x140
[ 1664.584958]  insn_get_displacement+0x157/0x270
[ 1664.585594]  insn_get_immediate+0x181/0x570
[ 1664.586206]  insn_get_length+0x75/0x90
[ 1664.586749]  insn_decode+0x9b/0x170
[ 1664.587252]  ? release_task+0x20/0x20
[ 1664.587767]  text_poke_loc_init+0x63/0x140
[ 1664.588415]  ? release_task+0x20/0x20
[ 1664.588953]  text_poke_queue+0x84/0xc0
[ 1664.589504]  ftrace_replace_code+0xfd/0x170
[ 1664.590117]  ftrace_modify_all_code+0x1b1/0x270
[ 1664.590764]  arch_ftrace_update_code+0x9/0x10
[ 1664.591366]  ftrace_run_update_code+0x30/0xa0
[ 1664.591980]  ftrace_startup_enable+0x5e/0xa0
[ 1664.592582]  ftrace_startup+0x16d/0x240
[ 1664.593157]  register_ftrace_function+0x43/0x90
[ 1664.593792]  perf_ftrace_event_register+0xc1/0xf0
[ 1664.594458]  perf_trace_event_init+0xa0/0x4c0
[ 1664.595089]  perf_trace_init+0xda/0x160
[ 1664.595651]  perf_tp_event_init+0x57/0xa0
[ 1664.596222]  perf_try_init_event+0x83/0x270
[ 1664.596836]  perf_event_alloc+0xe3f/0x1c10
[ 1664.597402]  ? _raw_spin_unlock+0x2c/0x50
[ 1664.597967]  ? alloc_fd+0x20d/0x320
[ 1664.598522]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1664.599189]  ? write_comp_data+0x2f/0x90
[ 1664.599914]  __x64_sys_perf_event_open+0x26/0x30
[ 1664.600554]  do_syscall_64+0x37/0x80
[ 1664.601063]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1664.601747] RIP: 0033:0x7fac0740459d
[ 1664.602250] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1664.604618] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1664.605618] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1664.606558] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1664.607491] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1664.608423] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1664.609358] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1664.610412] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1664.610532] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1664.611355] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1664.612446] caller is debug_smp_processor_id+0x1c/0x20
[ 1664.613795] Call Trace:
[ 1664.613806]  dump_stack_lvl+0xa4/0xd3
[ 1664.615291]  dump_stack+0x15/0x17
[ 1664.615717]  check_preemption_disabled+0x167/0x180
[ 1664.616316]  ? lock_timer_base+0x34/0x100
[ 1664.616820]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1664.617390]  debug_smp_processor_id+0x1c/0x20
[ 1664.617937]  perf_ftrace_function_call+0x7c/0x360
[ 1664.618528]  ? try_to_del_timer_sync+0x33/0x90
[ 1664.619086]  ? calc_wheel_index+0x2d0/0x2d0
[ 1664.619612]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1664.620199]  ? try_to_del_timer_sync+0x33/0x90
[ 1664.620756]  ? perf_ftrace_function_call+0x4c/0x360
[ 1664.621365]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1664.621951]  ? del_timer_sync+0xd3/0x130
[ 1664.622451]  ? perf_ftrace_function_call+0x4c/0x360
[ 1664.623057]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1664.623651]  ? register_lock_class+0x42/0x440
[ 1664.624216]  0xffffffffa009a099
[ 1664.624631]  ? 0xffffffffa009a099
[ 1664.625054]  ? lock_timer_base+0xc0/0x100
[ 1664.625564]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1664.626124]  ? write_comp_data+0x2f/0x90
[ 1664.626621]  _raw_spin_lock_irqsave+0x5/0x70
[ 1664.627159]  lock_timer_base+0x34/0x100
[ 1664.627644]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1664.628197]  ? lock_timer_base+0x34/0x100
[ 1664.628713]  try_to_del_timer_sync+0x33/0x90
[ 1664.629249]  ? try_to_del_timer_sync+0x5/0x90
[ 1664.629801]  del_timer_sync+0xd3/0x130
[ 1664.630286]  schedule_timeout+0x34e/0x610
[ 1664.630803]  ? del_timer_sync+0x130/0x130
[ 1664.631316]  ? i915_init_ggtt+0x40/0x6b0
[ 1664.631825]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1664.632331]  ? rcu_gp_init+0x730/0x730
[ 1664.632805]  rcu_gp_kthread+0xdd/0x170
[ 1664.633287]  kthread+0x1e7/0x230
[ 1664.633705]  ? set_kthread_struct+0x80/0x80
[ 1664.634242]  ret_from_fork+0x1f/0x30
[ 1664.634738] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1664.634767] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1664.635812] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1664.636772] caller is debug_smp_processor_id+0x1c/0x20
[ 1664.638361] Call Trace:
[ 1664.638397]  dump_stack_lvl+0xa4/0xd3
[ 1664.639959]  dump_stack+0x15/0x17
[ 1664.640491]  check_preemption_disabled+0x167/0x180
[ 1664.641225]  ? insn_get_prefixes.part.1+0x38a/0x650
[ 1664.641953]  ? bad_get_user+0xd/0xd
[ 1664.642543]  debug_smp_processor_id+0x1c/0x20
[ 1664.643217]  perf_ftrace_function_call+0x7c/0x360
[ 1664.644146]  ? 0xffffffffa009a099
[ 1664.644793]  0xffffffffa009a099
[ 1664.645416]  ? insn_get_prefixes.part.1+0x363/0x650
[ 1664.646200]  ? inat_get_opcode_attribute+0x5/0x20
[ 1664.646917]  ? write_comp_data+0x2f/0x90
[ 1664.647548]  inat_get_opcode_attribute+0x5/0x20
[ 1664.648244]  insn_get_prefixes.part.1+0x38a/0x650
[ 1664.648960]  ? inat_get_opcode_attribute+0x5/0x20
[ 1664.649668]  ? insn_get_prefixes.part.1+0x38a/0x650
[ 1664.650419]  ? write_comp_data+0x20/0x90
[ 1664.651108]  insn_get_opcode+0x1d5/0x3b0
[ 1664.651774]  insn_get_modrm+0x12b/0x2a0
[ 1664.652427]  insn_get_sib+0x122/0x140
[ 1664.653048]  insn_get_displacement+0x157/0x270
[ 1664.653773]  insn_get_immediate+0x181/0x570
[ 1664.654496]  insn_get_length+0x75/0x90
[ 1664.655125]  insn_decode+0x9b/0x170
[ 1664.655702]  ? release_task+0x20/0x20
[ 1664.656279]  text_poke_loc_init+0x63/0x140
[ 1664.657067]  ? release_task+0x20/0x20
[ 1664.657687]  text_poke_queue+0x84/0xc0
[ 1664.658381]  ftrace_replace_code+0xfd/0x170
[ 1664.659147]  ftrace_modify_all_code+0x1b1/0x270
[ 1664.659891]  arch_ftrace_update_code+0x9/0x10
[ 1664.660562]  ftrace_run_update_code+0x30/0xa0
[ 1664.661253]  ftrace_startup_enable+0x5e/0xa0
[ 1664.661940]  ftrace_startup+0x16d/0x240
[ 1664.662628]  register_ftrace_function+0x43/0x90
[ 1664.663345]  perf_ftrace_event_register+0xc1/0xf0
[ 1664.664086]  perf_trace_event_init+0xa0/0x4c0
[ 1664.664814]  perf_trace_init+0xda/0x160
[ 1664.665459]  perf_tp_event_init+0x57/0xa0
[ 1664.666115]  perf_try_init_event+0x83/0x270
[ 1664.666831]  perf_event_alloc+0xe3f/0x1c10
[ 1664.667459]  ? _raw_spin_unlock+0x2c/0x50
[ 1664.668096]  ? alloc_fd+0x20d/0x320
[ 1664.668758]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1664.669511]  ? write_comp_data+0x2f/0x90
[ 1664.670482]  __x64_sys_perf_event_open+0x26/0x30
[ 1664.671201]  do_syscall_64+0x37/0x80
[ 1664.671780]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1664.672537] RIP: 0033:0x7fac0740459d
[ 1664.673098] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1664.675693] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1664.676794] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1664.677812] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1664.678848] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1664.679865] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1664.680884] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1664.682140] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1664.683084] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1664.684446] Call Trace:
[ 1664.684762]  dump_stack_lvl+0xa4/0xd3
[ 1664.685232]  dump_stack+0x15/0x17
[ 1664.685661]  check_preemption_disabled+0x167/0x180
[ 1664.686272]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1664.686786]  ? prepare_to_swait_exclusive+0x90/0x90
[ 1664.687397]  debug_smp_processor_id+0x1c/0x20
[ 1664.687945]  perf_ftrace_function_call+0x7c/0x360
[ 1664.688544]  ? trace_hardirqs_on+0x3f/0x170
[ 1664.689077]  ? preempt_count_sub+0x5/0xa0
[ 1664.689590]  ? preempt_count_sub+0x5/0xa0
[ 1664.690102]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1664.690724]  ? write_comp_data+0x2f/0x90
[ 1664.691231]  0xffffffffa009a099
[ 1664.691630]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1664.692232]  ? del_timer_sync+0xde/0x130
[ 1664.692732]  ? prepare_to_swait_event+0x5/0xf0
[ 1664.693288]  ? i915_init_ggtt+0x40/0x6b0
[ 1664.693787]  prepare_to_swait_event+0x5/0xf0
[ 1664.694329]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1664.694824]  ? prepare_to_swait_event+0x5/0xf0
[ 1664.695379]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1664.695906]  ? rcu_gp_init+0x730/0x730
[ 1664.696380]  rcu_gp_kthread+0xdd/0x170
[ 1664.696870]  kthread+0x1e7/0x230
[ 1664.697290]  ? set_kthread_struct+0x80/0x80
[ 1664.697825]  ret_from_fork+0x1f/0x30
[ 1669.362114] check_preemption_disabled: 1114226 callbacks suppressed
[ 1669.362139] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1669.362241] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1669.362961] caller is debug_smp_processor_id+0x1c/0x20
[ 1669.363834] caller is debug_smp_processor_id+0x1c/0x20
[ 1669.364781] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1669.366865] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1669.368211] Call Trace:
[ 1669.368561]  dump_stack_lvl+0xa4/0xd3
[ 1669.369093]  dump_stack+0x15/0x17
[ 1669.369547]  check_preemption_disabled+0x167/0x180
[ 1669.370241]  debug_smp_processor_id+0x1c/0x20
[ 1669.370815]  perf_trace_buf_alloc+0x98/0x100
[ 1669.371382]  ? ftrace_replace_code+0xfd/0x170
[ 1669.371943]  ? jump_label_transform+0x70/0x70
[ 1669.372529]  perf_ftrace_function_call+0x209/0x360
[ 1669.373371]  ? 0xffffffffa009a099
[ 1669.373948]  0xffffffffa009a099
[ 1669.374421]  ? write_comp_data+0x2f/0x90
[ 1669.375049]  ? ext4_orphan_file_empty+0xe0/0xe0
[ 1669.375648]  ? text_poke_queue+0x5/0xc0
[ 1669.376164]  ? __fentry__+0x10/0x10
[ 1669.376661]  text_poke_queue+0x5/0xc0
[ 1669.377158]  ftrace_replace_code+0xfd/0x170
[ 1669.377712]  ? text_poke_queue+0x5/0xc0
[ 1669.378228]  ? ftrace_replace_code+0xfd/0x170
[ 1669.378857]  ftrace_modify_all_code+0x1b1/0x270
[ 1669.379497]  arch_ftrace_update_code+0x9/0x10
[ 1669.380072]  ftrace_run_update_code+0x30/0xa0
[ 1669.380675]  ftrace_startup_enable+0x5e/0xa0
[ 1669.381260]  ftrace_startup+0x16d/0x240
[ 1669.381855]  register_ftrace_function+0x43/0x90
[ 1669.382479]  perf_ftrace_event_register+0xc1/0xf0
[ 1669.383116]  perf_trace_event_init+0xa0/0x4c0
[ 1669.383748]  perf_trace_init+0xda/0x160
[ 1669.384314]  perf_tp_event_init+0x57/0xa0
[ 1669.384874]  perf_try_init_event+0x83/0x270
[ 1669.385497]  perf_event_alloc+0xe3f/0x1c10
[ 1669.386033]  ? _raw_spin_unlock+0x2c/0x50
[ 1669.386590]  ? alloc_fd+0x20d/0x320
[ 1669.387179]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1669.387823]  ? write_comp_data+0x2f/0x90
[ 1669.388710]  __x64_sys_perf_event_open+0x26/0x30
[ 1669.389322]  do_syscall_64+0x37/0x80
[ 1669.389819]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1669.390469] RIP: 0033:0x7fac0740459d
[ 1669.390953] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1669.393107] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1669.394047] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1669.394915] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1669.395801] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1669.396760] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1669.397715] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1669.398927] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1669.399105] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1669.399893] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1669.400912] caller is debug_smp_processor_id+0x1c/0x20
[ 1669.402284] Call Trace:
[ 1669.402314]  dump_stack_lvl+0xa4/0xd3
[ 1669.402381]  dump_stack+0x15/0x17
[ 1669.402417]  check_preemption_disabled+0x167/0x180
[ 1669.402456]  ? lock_timer_base+0x34/0x100
[ 1669.405396]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1669.406017]  debug_smp_processor_id+0x1c/0x20
[ 1669.406605]  perf_ftrace_function_call+0x7c/0x360
[ 1669.407245]  ? ftrace_ops_test+0x71/0xc0
[ 1669.407810]  ? ftrace_ops_test+0x71/0xc0
[ 1669.408347]  ? perf_trace_buf_update+0x70/0x70
[ 1669.408937]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1669.409574]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1669.410178]  ? write_comp_data+0x2f/0x90
[ 1669.410718]  ? perf_trace_buf_update+0x70/0x70
[ 1669.411375]  0xffffffffa009a099
[ 1669.411872]  ? ftrace_call+0x5/0x44
[ 1669.412368]  ? lock_timer_base+0xc0/0x100
[ 1669.412934]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1669.413527]  ? write_comp_data+0x2f/0x90
[ 1669.414078]  _raw_spin_lock_irqsave+0x5/0x70
[ 1669.414652]  lock_timer_base+0x34/0x100
[ 1669.415170]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1669.415752]  ? lock_timer_base+0x34/0x100
[ 1669.416347]  try_to_del_timer_sync+0x33/0x90
[ 1669.416909]  ? try_to_del_timer_sync+0x5/0x90
[ 1669.417517]  del_timer_sync+0xd3/0x130
[ 1669.418060]  schedule_timeout+0x34e/0x610
[ 1669.418659]  ? del_timer_sync+0x130/0x130
[ 1669.419237]  ? i915_init_ggtt+0x40/0x6b0
[ 1669.419834]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1669.420429]  ? rcu_gp_init+0x730/0x730
[ 1669.420937]  rcu_gp_kthread+0xdd/0x170
[ 1669.421492]  kthread+0x1e7/0x230
[ 1669.421952]  ? set_kthread_struct+0x80/0x80
[ 1669.422557]  ret_from_fork+0x1f/0x30
[ 1669.423236] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1669.423349] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1669.424238] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1669.425208] caller is debug_smp_processor_id+0x1c/0x20
[ 1669.426680] Call Trace:
[ 1669.426718]  dump_stack_lvl+0xa4/0xd3
[ 1669.426801]  dump_stack+0x15/0x17
[ 1669.428694]  check_preemption_disabled+0x167/0x180
[ 1669.429447]  debug_smp_processor_id+0x1c/0x20
[ 1669.430086]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1669.430876]  perf_tp_event+0x331/0x4e0
[ 1669.431638]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1669.432573]  ? arch_local_irq_enable+0x10/0x12
[ 1669.433230]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1669.433933]  ? dump_stack_lvl+0xcc/0xd3
[ 1669.434577]  ? ftrace_replace_code+0xfd/0x170
[ 1669.435200]  ? jump_label_transform+0x70/0x70
[ 1669.435862]  perf_ftrace_function_call+0x248/0x360
[ 1669.436566]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1669.437214]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1669.437892]  ? perf_ftrace_function_call+0x248/0x360
[ 1669.438861]  ? 0xffffffffa009a099
[ 1669.439493]  0xffffffffa009a099
[ 1669.440006]  ? write_comp_data+0x2f/0x90
[ 1669.440694]  ? ext4_orphan_file_empty+0xe0/0xe0
[ 1669.441348]  ? text_poke_queue+0x5/0xc0
[ 1669.441917]  ? __fentry__+0x10/0x10
[ 1669.442469]  text_poke_queue+0x5/0xc0
[ 1669.443020]  ftrace_replace_code+0xfd/0x170
[ 1669.443634]  ? text_poke_queue+0x5/0xc0
[ 1669.444192]  ? ftrace_replace_code+0xfd/0x170
[ 1669.444888]  ftrace_modify_all_code+0x1b1/0x270
[ 1669.445594]  arch_ftrace_update_code+0x9/0x10
[ 1669.446235]  ftrace_run_update_code+0x30/0xa0
[ 1669.446895]  ftrace_startup_enable+0x5e/0xa0
[ 1669.447544]  ftrace_startup+0x16d/0x240
[ 1669.448199]  register_ftrace_function+0x43/0x90
[ 1669.448881]  perf_ftrace_event_register+0xc1/0xf0
[ 1669.449586]  perf_trace_event_init+0xa0/0x4c0
[ 1669.450286]  perf_trace_init+0xda/0x160
[ 1669.450906]  perf_tp_event_init+0x57/0xa0
[ 1669.451522]  perf_try_init_event+0x83/0x270
[ 1669.452209]  perf_event_alloc+0xe3f/0x1c10
[ 1669.452802]  ? _raw_spin_unlock+0x2c/0x50
[ 1669.453407]  ? alloc_fd+0x20d/0x320
[ 1669.454055]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1669.454771]  ? write_comp_data+0x2f/0x90
[ 1669.455734]  __x64_sys_perf_event_open+0x26/0x30
[ 1669.456414]  do_syscall_64+0x37/0x80
[ 1669.456962]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1669.457676] RIP: 0033:0x7fac0740459d
[ 1669.458208] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1669.460624] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1669.461662] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1669.462623] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1669.463583] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1669.464542] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1669.465501] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1669.466714] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1669.466885] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1669.467671] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1669.468773] caller is debug_smp_processor_id+0x1c/0x20
[ 1669.470133] Call Trace:
[ 1669.470161]  dump_stack_lvl+0xa4/0xd3
[ 1669.470227]  dump_stack+0x15/0x17
[ 1669.470264]  check_preemption_disabled+0x167/0x180
[ 1669.470303]  ? prepare_to_swait_event+0x1b/0xf0
[ 1669.473365]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1669.473985]  debug_smp_processor_id+0x1c/0x20
[ 1669.474570]  perf_ftrace_function_call+0x7c/0x360
[ 1669.475182]  ? ftrace_ops_test+0x71/0xc0
[ 1669.475791]  ? trace_hardirqs_on+0x3f/0x170
[ 1669.476387]  ? write_comp_data+0x2f/0x90
[ 1669.476923]  ? perf_trace_buf_update+0x70/0x70
[ 1669.477513]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1669.478210]  0xffffffffa009a099
[ 1669.478689]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1669.479339]  ? del_timer_sync+0xde/0x130
[ 1669.479895]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1669.480524]  _raw_spin_lock_irqsave+0x5/0x70
[ 1669.481096]  prepare_to_swait_event+0x1b/0xf0
[ 1669.481678]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1669.482268]  ? prepare_to_swait_event+0x1b/0xf0
[ 1669.482897]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1669.483490]  ? rcu_gp_init+0x730/0x730
[ 1669.483998]  rcu_gp_kthread+0xdd/0x170
[ 1669.484560]  kthread+0x1e7/0x230
[ 1669.485019]  ? set_kthread_struct+0x80/0x80
[ 1669.485615]  ret_from_fork+0x1f/0x30
[ 1669.486299] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1669.486409] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1669.487390] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1669.488358] caller is debug_smp_processor_id+0x1c/0x20
[ 1669.489951] Call Trace:
[ 1669.491004]  dump_stack_lvl+0xa4/0xd3
[ 1669.491668]  dump_stack+0x15/0x17
[ 1669.492233]  check_preemption_disabled+0x167/0x180
[ 1669.492997]  ? text_poke_loc_init+0x63/0x140
[ 1669.493680]  ? insn_get_length+0x90/0x90
[ 1669.494370]  debug_smp_processor_id+0x1c/0x20
[ 1669.495079]  perf_ftrace_function_call+0x7c/0x360
[ 1669.495852]  ? perf_ftrace_function_call+0x2f5/0x360
[ 1669.496641]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1669.497357]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1669.498116]  ? text_poke_queue+0x84/0xc0
[ 1669.498763]  ? perf_ftrace_function_call+0x4c/0x360
[ 1669.499838]  ? ext4_orphan_file_empty+0xe0/0xe0
[ 1669.500585]  0xffffffffa009a099
[ 1669.501143]  ? write_comp_data+0x2f/0x90
[ 1669.501845]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1669.502761]  ? insn_decode+0x5/0x170
[ 1669.503430]  insn_decode+0x5/0x170
[ 1669.504006]  text_poke_loc_init+0x63/0x140
[ 1669.504675]  ? insn_decode+0x5/0x170
[ 1669.505263]  ? text_poke_loc_init+0x63/0x140
[ 1669.506069]  ? ext4_orphan_file_empty+0xe0/0xe0
[ 1669.506819]  ? text_poke_loc_init+0x5/0x140
[ 1669.507553]  ? ext4_orphan_file_empty+0xe0/0xe0
[ 1669.508354]  text_poke_queue+0x84/0xc0
[ 1669.509050]  ftrace_replace_code+0xfd/0x170
[ 1669.509822]  ftrace_modify_all_code+0x1b1/0x270
[ 1669.510633]  arch_ftrace_update_code+0x9/0x10
[ 1669.511337]  ftrace_run_update_code+0x30/0xa0
[ 1669.512085]  ftrace_startup_enable+0x5e/0xa0
[ 1669.512812]  ftrace_startup+0x16d/0x240
[ 1669.513575]  register_ftrace_function+0x43/0x90
[ 1669.514349]  perf_ftrace_event_register+0xc1/0xf0
[ 1669.515140]  perf_trace_event_init+0xa0/0x4c0
[ 1669.515936]  perf_trace_init+0xda/0x160
[ 1669.516642]  perf_tp_event_init+0x57/0xa0
[ 1669.517344]  perf_try_init_event+0x83/0x270
[ 1669.518144]  perf_event_alloc+0xe3f/0x1c10
[ 1669.518832]  ? _raw_spin_unlock+0x2c/0x50
[ 1669.519509]  ? alloc_fd+0x20d/0x320
[ 1669.520272]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1669.521094]  ? write_comp_data+0x2f/0x90
[ 1669.522312]  __x64_sys_perf_event_open+0x26/0x30
[ 1669.523073]  do_syscall_64+0x37/0x80
[ 1669.523691]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1669.524476] RIP: 0033:0x7fac0740459d
[ 1669.525068] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1669.527698] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1669.528840] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1669.529885] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1669.530973] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1669.532016] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1669.533059] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1669.534511] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1669.534688] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1669.535476] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1669.536584] caller is debug_smp_processor_id+0x1c/0x20
[ 1669.537943] Call Trace:
[ 1669.539030]  dump_stack_lvl+0xa4/0xd3
[ 1669.539559]  dump_stack+0x15/0x17
[ 1669.540017]  check_preemption_disabled+0x167/0x180
[ 1669.540649]  ? finish_swait+0x41/0x80
[ 1669.541152]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1669.541773]  debug_smp_processor_id+0x1c/0x20
[ 1669.542373]  perf_ftrace_function_call+0x7c/0x360
[ 1669.542988]  ? ftrace_ops_test+0x71/0xc0
[ 1669.543524]  ? rcu_advance_cbs+0x70/0x70
[ 1669.544080]  ? write_comp_data+0x2f/0x90
[ 1669.544619]  ? perf_trace_buf_update+0x70/0x70
[ 1669.545210]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1669.545849]  ? write_comp_data+0x2f/0x90
[ 1669.546403]  ? perf_trace_buf_update+0x70/0x70
[ 1669.546994]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1669.547689]  0xffffffffa009a099
[ 1669.548185]  ? trace_hardirqs_on+0x3f/0x170
[ 1669.548808]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1669.549436]  _raw_spin_lock_irqsave+0x5/0x70
[ 1669.550008]  finish_swait+0x41/0x80
[ 1669.550506]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1669.551090]  ? finish_swait+0x41/0x80
[ 1669.551617]  rcu_gp_fqs_loop+0x2da/0x410
[ 1669.552211]  ? rcu_gp_init+0x730/0x730
[ 1669.552721]  rcu_gp_kthread+0xdd/0x170
[ 1669.553276]  kthread+0x1e7/0x230
[ 1669.553735]  ? set_kthread_struct+0x80/0x80
[ 1669.554346]  ret_from_fork+0x1f/0x30
[ 1669.555023] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1669.555138] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1669.556118] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1669.557090] caller is debug_smp_processor_id+0x1c/0x20
[ 1669.558697] Call Trace:
[ 1669.558749]  dump_stack_lvl+0xa4/0xd3
[ 1669.560398]  dump_stack+0x15/0x17
[ 1669.560964]  check_preemption_disabled+0x167/0x180
[ 1669.561819]  debug_smp_processor_id+0x1c/0x20
[ 1669.562547]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1669.563483]  perf_trace_buf_alloc+0x3d/0x100
[ 1669.564180]  ? text_poke_loc_init+0x63/0x140
[ 1669.564855]  ? insn_get_length+0x90/0x90
[ 1669.565517]  perf_ftrace_function_call+0x209/0x360
[ 1669.566313]  ? perf_ftrace_function_call+0x2f5/0x360
[ 1669.567385]  ? 0xffffffffa009a099
[ 1669.568081]  ? ext4_orphan_file_empty+0xe0/0xe0
[ 1669.568828]  0xffffffffa009a099
[ 1669.569380]  ? write_comp_data+0x2f/0x90
[ 1669.570111]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1669.571076]  ? insn_decode+0x5/0x170
[ 1669.571753]  insn_decode+0x5/0x170
[ 1669.572328]  text_poke_loc_init+0x63/0x140
[ 1669.572999]  ? insn_decode+0x5/0x170
[ 1669.573579]  ? text_poke_loc_init+0x63/0x140
[ 1669.574385]  ? ext4_orphan_file_empty+0xe0/0xe0
[ 1669.575140]  ? text_poke_loc_init+0x5/0x140
[ 1669.575900]  ? ext4_orphan_file_empty+0xe0/0xe0
[ 1669.576695]  text_poke_queue+0x84/0xc0
[ 1669.577390]  ftrace_replace_code+0xfd/0x170
[ 1669.578172]  ftrace_modify_all_code+0x1b1/0x270
[ 1669.579001]  arch_ftrace_update_code+0x9/0x10
[ 1669.579715]  ftrace_run_update_code+0x30/0xa0
[ 1669.580455]  ftrace_startup_enable+0x5e/0xa0
[ 1669.581183]  ftrace_startup+0x16d/0x240
[ 1669.581941]  register_ftrace_function+0x43/0x90
[ 1669.582714]  perf_ftrace_event_register+0xc1/0xf0
[ 1669.583508]  perf_trace_event_init+0xa0/0x4c0
[ 1669.584304]  perf_trace_init+0xda/0x160
[ 1669.585011]  perf_tp_event_init+0x57/0xa0
[ 1669.585703]  perf_try_init_event+0x83/0x270
[ 1669.586505]  perf_event_alloc+0xe3f/0x1c10
[ 1669.587159]  ? _raw_spin_unlock+0x2c/0x50
[ 1669.587833]  ? alloc_fd+0x20d/0x320
[ 1669.588595]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1669.589393]  ? write_comp_data+0x2f/0x90
[ 1669.590611]  __x64_sys_perf_event_open+0x26/0x30
[ 1669.591370]  do_syscall_64+0x37/0x80
[ 1669.591986]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1669.592766] RIP: 0033:0x7fac0740459d
[ 1669.593358] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1669.595981] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1669.597123] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1669.598179] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1669.599224] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1669.600269] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1669.601316] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1669.602742] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1669.602913] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1669.603705] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1669.604729] caller is debug_smp_processor_id+0x1c/0x20
[ 1669.606098] Call Trace:
[ 1669.606128]  dump_stack_lvl+0xa4/0xd3
[ 1669.606194]  dump_stack+0x15/0x17
[ 1669.606230]  check_preemption_disabled+0x167/0x180
[ 1669.606269]  ? force_qs_rnp+0xd0/0x2c0
[ 1669.609194]  ? preempt_schedule+0x30/0x30
[ 1669.609754]  debug_smp_processor_id+0x1c/0x20
[ 1669.610348]  perf_ftrace_function_call+0x7c/0x360
[ 1669.610961]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1669.611600]  ? ftrace_ops_test+0x71/0xc0
[ 1669.612136]  ? rcu_advance_cbs+0x70/0x70
[ 1669.612692]  ? write_comp_data+0x2f/0x90
[ 1669.613233]  ? perf_trace_buf_update+0x70/0x70
[ 1669.613825]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1669.614468]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1669.615060]  ? force_qs_rnp+0xcb/0x2c0
[ 1669.615569]  ? sched_show_task+0x70/0x70
[ 1669.616126]  ? rcu_gp_torture_wait+0x20/0x20
[ 1669.616711]  0xffffffffa009a099
[ 1669.617142]  ? rcu_exp_wait_wake+0x4c0/0x4c0
[ 1669.617840]  ? __cond_resched+0x5/0x30
[ 1669.618371]  ? ___might_sleep+0x143/0x170
[ 1669.618911]  __cond_resched+0x5/0x30
[ 1669.619401]  force_qs_rnp+0xd0/0x2c0
[ 1669.619889]  ? __cond_resched+0x5/0x30
[ 1669.620388]  ? force_qs_rnp+0xd0/0x2c0
[ 1669.620961]  rcu_gp_fqs_loop+0x2eb/0x410
[ 1669.621556]  ? rcu_gp_init+0x730/0x730
[ 1669.622069]  rcu_gp_kthread+0xdd/0x170
[ 1669.622625]  kthread+0x1e7/0x230
[ 1669.623084]  ? set_kthread_struct+0x80/0x80
[ 1669.623683]  ret_from_fork+0x1f/0x30
[ 1669.624359] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1669.624509] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1669.625367] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1669.626512] caller is debug_smp_processor_id+0x1c/0x20
[ 1669.627918] Call Trace:
[ 1669.628933]  dump_stack_lvl+0xa4/0xd3
[ 1669.629518]  dump_stack+0x15/0x17
[ 1669.630022]  check_preemption_disabled+0x167/0x180
[ 1669.630780]  debug_smp_processor_id+0x1c/0x20
[ 1669.631416]  perf_trace_buf_alloc+0x98/0x100
[ 1669.632041]  ? text_poke_loc_init+0x63/0x140
[ 1669.632653]  ? insn_get_length+0x90/0x90
[ 1669.633245]  perf_ftrace_function_call+0x209/0x360
[ 1669.634171]  ? 0xffffffffa009a099
[ 1669.634767]  ? ext4_orphan_file_empty+0xe0/0xe0
[ 1669.635436]  0xffffffffa009a099
[ 1669.635926]  ? write_comp_data+0x2f/0x90
[ 1669.636541]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1669.637316]  ? insn_decode+0x5/0x170
[ 1669.637901]  insn_decode+0x5/0x170
[ 1669.638424]  text_poke_loc_init+0x63/0x140
[ 1669.639024]  ? insn_decode+0x5/0x170
[ 1669.639557]  ? text_poke_loc_init+0x63/0x140
[ 1669.640258]  ? ext4_orphan_file_empty+0xe0/0xe0
[ 1669.640927]  ? text_poke_loc_init+0x5/0x140
[ 1669.641575]  ? ext4_orphan_file_empty+0xe0/0xe0
[ 1669.642300]  text_poke_queue+0x84/0xc0
[ 1669.642955]  ftrace_replace_code+0xfd/0x170
[ 1669.643635]  ftrace_modify_all_code+0x1b1/0x270
[ 1669.644340]  arch_ftrace_update_code+0x9/0x10
[ 1669.644975]  ftrace_run_update_code+0x30/0xa0
[ 1669.645634]  ftrace_startup_enable+0x5e/0xa0
[ 1669.646287]  ftrace_startup+0x16d/0x240
[ 1669.646941]  register_ftrace_function+0x43/0x90
[ 1669.647621]  perf_ftrace_event_register+0xc1/0xf0
[ 1669.648325]  perf_trace_event_init+0xa0/0x4c0
[ 1669.649021]  perf_trace_init+0xda/0x160
[ 1669.649639]  perf_tp_event_init+0x57/0xa0
[ 1669.650258]  perf_try_init_event+0x83/0x270
[ 1669.650946]  perf_event_alloc+0xe3f/0x1c10
[ 1669.651540]  ? _raw_spin_unlock+0x2c/0x50
[ 1669.652144]  ? alloc_fd+0x20d/0x320
[ 1669.652790]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1669.653504]  ? write_comp_data+0x2f/0x90
[ 1669.654475]  __x64_sys_perf_event_open+0x26/0x30
[ 1669.655158]  do_syscall_64+0x37/0x80
[ 1669.655708]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1669.656421] RIP: 0033:0x7fac0740459d
[ 1669.656952] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1669.659373] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1669.660411] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1669.661370] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1669.662332] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1669.663291] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1669.664250] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1669.665462] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1669.666514] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1669.667936] Call Trace:
[ 1669.668291]  dump_stack_lvl+0xa4/0xd3
[ 1669.668830]  dump_stack+0x15/0x17
[ 1669.669300]  check_preemption_disabled+0x167/0x180
[ 1669.669945]  ? do_epoll_wait+0x3b3/0xd80
[ 1669.670485]  ? __mutex_lock+0x9f0/0x9f0
[ 1669.671037]  debug_smp_processor_id+0x1c/0x20
[ 1669.671631]  perf_ftrace_function_call+0x7c/0x360
[ 1669.672322]  ? ftrace_call+0x5/0x44
[ 1669.672801]  ? trace_hardirqs_on+0x6a/0x170
[ 1669.673411]  ? finish_task_switch+0xb0/0x2a0
[ 1669.673985]  ? finish_task_switch+0x70/0x2a0
[ 1669.674590]  ? trace_hardirqs_on+0x3f/0x170
[ 1669.675154]  ? finish_task_switch+0x70/0x2a0
[ 1669.675755]  ? preempt_count_sub+0x5/0xa0
[ 1669.676362]  0xffffffffa009a099
[ 1669.676811]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1669.677463]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1669.678223]  ? do_epoll_wait+0x36b/0xd80
[ 1669.678793]  ? mutex_lock_nested+0x5/0x20
[ 1669.679343]  ? write_comp_data+0x2f/0x90
[ 1669.679901]  mutex_lock_nested+0x5/0x20
[ 1669.680432]  do_epoll_wait+0x3b3/0xd80
[ 1669.680955]  ? mutex_lock_nested+0x5/0x20
[ 1669.681496]  ? do_epoll_wait+0x3b3/0xd80
[ 1669.682199]  ? wait_woken+0x90/0x90
[ 1669.682764]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1669.683403]  do_syscall_64+0x37/0x80
[ 1669.683909]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1669.684576] RIP: 0033:0x7f8a39143b20
[ 1669.685071] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1669.687351] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1669.688322] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1669.689223] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1669.690129] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1669.691029] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1669.691931] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1674.366112] check_preemption_disabled: 787193 callbacks suppressed
[ 1674.366139] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1674.367877] caller is debug_smp_processor_id+0x1c/0x20
[ 1674.368531] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1674.369435] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1674.370805] Call Trace:
[ 1674.371155]  dump_stack_lvl+0xa4/0xd3
[ 1674.371688]  dump_stack+0x15/0x17
[ 1674.372145]  check_preemption_disabled+0x167/0x180
[ 1674.372828]  debug_smp_processor_id+0x1c/0x20
[ 1674.373404]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1674.374134]  perf_tp_event+0x331/0x4e0
[ 1674.374906]  ? preempt_count_sub+0x5/0xa0
[ 1674.375487]  ? preempt_count_sub+0x5/0xa0
[ 1674.376022]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1674.376679]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1674.377321]  ? ___ratelimit+0x36/0x1e0
[ 1674.377887]  ? __printk_ratelimit+0x21/0x30
[ 1674.378477]  ? ftrace_replace_code+0xfd/0x170
[ 1674.379027]  ? jump_label_transform+0x70/0x70
[ 1674.379628]  perf_ftrace_function_call+0x248/0x360
[ 1674.380269]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1674.380854]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1674.381466]  ? perf_ftrace_function_call+0x248/0x360
[ 1674.382373]  ? 0xffffffffa009a099
[ 1674.382953]  0xffffffffa009a099
[ 1674.383421]  ? write_comp_data+0x2f/0x90
[ 1674.384052]  ? regulator_get_current_limit+0x30/0x30
[ 1674.384719]  ? text_poke_queue+0x5/0xc0
[ 1674.385236]  ? __fentry__+0x10/0x10
[ 1674.385736]  text_poke_queue+0x5/0xc0
[ 1674.386259]  ftrace_replace_code+0xfd/0x170
[ 1674.386815]  ? text_poke_queue+0x5/0xc0
[ 1674.387321]  ? ftrace_replace_code+0xfd/0x170
[ 1674.387960]  ftrace_modify_all_code+0x1b1/0x270
[ 1674.388603]  arch_ftrace_update_code+0x9/0x10
[ 1674.389180]  ftrace_run_update_code+0x30/0xa0
[ 1674.389770]  ftrace_startup_enable+0x5e/0xa0
[ 1674.390369]  ftrace_startup+0x16d/0x240
[ 1674.390949]  register_ftrace_function+0x43/0x90
[ 1674.391552]  perf_ftrace_event_register+0xc1/0xf0
[ 1674.392176]  perf_trace_event_init+0xa0/0x4c0
[ 1674.392795]  perf_trace_init+0xda/0x160
[ 1674.393343]  perf_tp_event_init+0x57/0xa0
[ 1674.393889]  perf_try_init_event+0x83/0x270
[ 1674.394512]  perf_event_alloc+0xe3f/0x1c10
[ 1674.395034]  ? _raw_spin_unlock+0x2c/0x50
[ 1674.395568]  ? alloc_fd+0x20d/0x320
[ 1674.396142]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1674.396776]  ? write_comp_data+0x2f/0x90
[ 1674.397641]  __x64_sys_perf_event_open+0x26/0x30
[ 1674.398257]  do_syscall_64+0x37/0x80
[ 1674.398742]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1674.399369] RIP: 0033:0x7fac0740459d
[ 1674.399872] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1674.402197] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1674.403188] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1674.404100] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1674.405012] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1674.405925] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1674.406855] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1674.408318] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1674.408331] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1674.409410] caller is debug_smp_processor_id+0x1c/0x20
[ 1674.410679] caller is debug_smp_processor_id+0x1c/0x20
[ 1674.411339] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1674.413083] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1674.414500] Call Trace:
[ 1674.414855]  dump_stack_lvl+0xa4/0xd3
[ 1674.415391]  dump_stack+0x15/0x17
[ 1674.415857]  check_preemption_disabled+0x167/0x180
[ 1674.416499]  ? do_epoll_wait+0x3b3/0xd80
[ 1674.417031]  ? __mutex_lock+0x9f0/0x9f0
[ 1674.417578]  debug_smp_processor_id+0x1c/0x20
[ 1674.418173]  perf_ftrace_function_call+0x7c/0x360
[ 1674.418860]  ? ftrace_call+0x5/0x44
[ 1674.419336]  ? trace_hardirqs_on+0x6a/0x170
[ 1674.419942]  ? finish_task_switch+0xb0/0x2a0
[ 1674.420513]  ? finish_task_switch+0x70/0x2a0
[ 1674.421109]  ? trace_hardirqs_on+0x3f/0x170
[ 1674.421669]  ? finish_task_switch+0x70/0x2a0
[ 1674.422269]  ? preempt_count_sub+0x5/0xa0
[ 1674.422872]  0xffffffffa009a099
[ 1674.423319]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1674.423967]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1674.424718]  ? do_epoll_wait+0x36b/0xd80
[ 1674.425284]  ? mutex_lock_nested+0x5/0x20
[ 1674.425831]  ? write_comp_data+0x2f/0x90
[ 1674.426388]  mutex_lock_nested+0x5/0x20
[ 1674.426914]  do_epoll_wait+0x3b3/0xd80
[ 1674.427432]  ? mutex_lock_nested+0x5/0x20
[ 1674.427969]  ? do_epoll_wait+0x3b3/0xd80
[ 1674.428662]  ? wait_woken+0x90/0x90
[ 1674.429221]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1674.429856]  do_syscall_64+0x37/0x80
[ 1674.430365]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1674.431030] RIP: 0033:0x7f8a39143b20
[ 1674.431522] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1674.433788] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1674.434765] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1674.435663] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1674.436562] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1674.437461] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1674.438362] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1674.439461] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1674.439619] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1674.440552] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1674.441585] caller is debug_smp_processor_id+0x1c/0x20
[ 1674.443182] Call Trace:
[ 1674.443236]  dump_stack_lvl+0xa4/0xd3
[ 1674.444896]  dump_stack+0x15/0x17
[ 1674.445460]  check_preemption_disabled+0x167/0x180
[ 1674.446231]  ? ftrace_replace_code+0xfd/0x170
[ 1674.446920]  ? jump_label_transform+0x70/0x70
[ 1674.447662]  debug_smp_processor_id+0x1c/0x20
[ 1674.448372]  perf_ftrace_function_call+0x7c/0x360
[ 1674.449109]  ? write_comp_data+0x2f/0x90
[ 1674.449808]  ? write_comp_data+0x2f/0x90
[ 1674.450515]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1674.451269]  ? write_comp_data+0x2f/0x90
[ 1674.451968]  ? write_comp_data+0x2f/0x90
[ 1674.452668]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1674.453565]  0xffffffffa009a099
[ 1674.454160]  ? write_comp_data+0x2f/0x90
[ 1674.454966]  ? print_constraints_debug+0x690/0x690
[ 1674.455731]  ? text_poke_queue+0x5/0xc0
[ 1674.456368]  ? __fentry__+0x10/0x10
[ 1674.456990]  text_poke_queue+0x5/0xc0
[ 1674.457603]  ftrace_replace_code+0xfd/0x170
[ 1674.458293]  ? text_poke_queue+0x5/0xc0
[ 1674.458911]  ? ftrace_replace_code+0xfd/0x170
[ 1674.459703]  ftrace_modify_all_code+0x1b1/0x270
[ 1674.460503]  arch_ftrace_update_code+0x9/0x10
[ 1674.461210]  ftrace_run_update_code+0x30/0xa0
[ 1674.461950]  ftrace_startup_enable+0x5e/0xa0
[ 1674.462690]  ftrace_startup+0x16d/0x240
[ 1674.463449]  register_ftrace_function+0x43/0x90
[ 1674.464214]  perf_ftrace_event_register+0xc1/0xf0
[ 1674.465021]  perf_trace_event_init+0xa0/0x4c0
[ 1674.465818]  perf_trace_init+0xda/0x160
[ 1674.466533]  perf_tp_event_init+0x57/0xa0
[ 1674.467227]  perf_try_init_event+0x83/0x270
[ 1674.468018]  perf_event_alloc+0xe3f/0x1c10
[ 1674.468671]  ? _raw_spin_unlock+0x2c/0x50
[ 1674.469349]  ? alloc_fd+0x20d/0x320
[ 1674.470114]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1674.470915]  ? write_comp_data+0x2f/0x90
[ 1674.472127]  __x64_sys_perf_event_open+0x26/0x30
[ 1674.472886]  do_syscall_64+0x37/0x80
[ 1674.473505]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1674.474291] RIP: 0033:0x7fac0740459d
[ 1674.474882] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1674.477490] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1674.478636] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1674.479685] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1674.480728] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1674.481775] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1674.482823] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1674.484245] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1674.484417] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1674.485267] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1674.486533] caller is debug_smp_processor_id+0x1c/0x20
[ 1674.487769] Call Trace:
[ 1674.488857]  dump_stack_lvl+0xa4/0xd3
[ 1674.489391]  dump_stack+0x15/0x17
[ 1674.489855]  check_preemption_disabled+0x167/0x180
[ 1674.490501]  ? mutex_lock_nested+0x1b/0x20
[ 1674.491051]  ? mutex_lock_io_nested+0x940/0x940
[ 1674.491679]  debug_smp_processor_id+0x1c/0x20
[ 1674.492271]  perf_ftrace_function_call+0x7c/0x360
[ 1674.492904]  ? perf_ftrace_function_call+0x4c/0x360
[ 1674.493611]  ? ftrace_call+0x5/0x44
[ 1674.494116]  ? trace_hardirqs_on+0x6a/0x170
[ 1674.494715]  ? finish_task_switch+0xb0/0x2a0
[ 1674.495283]  ? finish_task_switch+0x70/0x2a0
[ 1674.495880]  ? trace_hardirqs_on+0x3f/0x170
[ 1674.496441]  ? finish_task_switch+0x70/0x2a0
[ 1674.497095]  0xffffffffa009a099
[ 1674.497545]  ? 0xffffffffa009a099
[ 1674.498012]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1674.498680]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1674.499393]  ? do_epoll_wait+0x3b3/0xd80
[ 1674.499977]  ? __mutex_lock+0x5/0x9f0
[ 1674.500482]  ? mutex_lock_nested+0x5/0x20
[ 1674.501030]  ? write_comp_data+0x2f/0x90
[ 1674.501567]  __mutex_lock+0x5/0x9f0
[ 1674.502057]  mutex_lock_nested+0x1b/0x20
[ 1674.502597]  ? __mutex_lock+0x5/0x9f0
[ 1674.503094]  ? mutex_lock_nested+0x1b/0x20
[ 1674.503651]  do_epoll_wait+0x3b3/0xd80
[ 1674.504324]  ? wait_woken+0x90/0x90
[ 1674.504883]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1674.505516]  do_syscall_64+0x37/0x80
[ 1674.506020]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1674.506693] RIP: 0033:0x7f8a39143b20
[ 1674.507194] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1674.509461] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1674.510441] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1674.511338] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1674.512233] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1674.513133] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1674.514032] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1674.515136] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1674.515240] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1674.516237] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1674.517268] caller is debug_smp_processor_id+0x1c/0x20
[ 1674.518872] Call Trace:
[ 1674.518925]  dump_stack_lvl+0xa4/0xd3
[ 1674.520592]  dump_stack+0x15/0x17
[ 1674.521161]  check_preemption_disabled+0x167/0x180
[ 1674.522019]  debug_smp_processor_id+0x1c/0x20
[ 1674.522738]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1674.523679]  perf_trace_buf_alloc+0x3d/0x100
[ 1674.524378]  ? ftrace_replace_code+0xfd/0x170
[ 1674.525068]  ? jump_label_transform+0x70/0x70
[ 1674.525798]  perf_ftrace_function_call+0x209/0x360
[ 1674.526915]  ? 0xffffffffa009a099
[ 1674.527671]  0xffffffffa009a099
[ 1674.528261]  ? write_comp_data+0x2f/0x90
[ 1674.529070]  ? print_constraints_debug+0x690/0x690
[ 1674.529837]  ? text_poke_queue+0x5/0xc0
[ 1674.530478]  ? __fentry__+0x10/0x10
[ 1674.531105]  text_poke_queue+0x5/0xc0
[ 1674.531724]  ftrace_replace_code+0xfd/0x170
[ 1674.532410]  ? text_poke_queue+0x5/0xc0
[ 1674.533033]  ? ftrace_replace_code+0xfd/0x170
[ 1674.533830]  ftrace_modify_all_code+0x1b1/0x270
[ 1674.534641]  arch_ftrace_update_code+0x9/0x10
[ 1674.535353]  ftrace_run_update_code+0x30/0xa0
[ 1674.536097]  ftrace_startup_enable+0x5e/0xa0
[ 1674.536830]  ftrace_startup+0x16d/0x240
[ 1674.537592]  register_ftrace_function+0x43/0x90
[ 1674.538365]  perf_ftrace_event_register+0xc1/0xf0
[ 1674.539158]  perf_trace_event_init+0xa0/0x4c0
[ 1674.539955]  perf_trace_init+0xda/0x160
[ 1674.540666]  perf_tp_event_init+0x57/0xa0
[ 1674.541361]  perf_try_init_event+0x83/0x270
[ 1674.542160]  perf_event_alloc+0xe3f/0x1c10
[ 1674.542820]  ? _raw_spin_unlock+0x2c/0x50
[ 1674.543498]  ? alloc_fd+0x20d/0x320
[ 1674.544263]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1674.545064]  ? write_comp_data+0x2f/0x90
[ 1674.546279]  __x64_sys_perf_event_open+0x26/0x30
[ 1674.547041]  do_syscall_64+0x37/0x80
[ 1674.547661]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1674.548447] RIP: 0033:0x7fac0740459d
[ 1674.549040] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1674.551652] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1674.552795] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1674.553845] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1674.554893] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1674.555945] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1674.556998] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1674.558425] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1674.558594] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1674.559447] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1674.560465] caller is debug_smp_processor_id+0x1c/0x20
[ 1674.561847] Call Trace:
[ 1674.562875]  dump_stack_lvl+0xa4/0xd3
[ 1674.563409]  dump_stack+0x15/0x17
[ 1674.563873]  check_preemption_disabled+0x167/0x180
[ 1674.564513]  ? ep_start_scan+0x68/0x100
[ 1674.565031]  ? _raw_read_lock_irq+0xa0/0xa0
[ 1674.565619]  debug_smp_processor_id+0x1c/0x20
[ 1674.566213]  perf_ftrace_function_call+0x7c/0x360
[ 1674.566844]  ? ftrace_ops_test+0x71/0xc0
[ 1674.567392]  ? preempt_notifier_dec+0x20/0x20
[ 1674.568036]  ? ftrace_call+0x5/0x44
[ 1674.568558]  ? write_comp_data+0x2f/0x90
[ 1674.569103]  ? perf_trace_buf_update+0x70/0x70
[ 1674.569700]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1674.570398]  0xffffffffa009a099
[ 1674.570882]  ? ftrace_call+0x5/0x44
[ 1674.571367]  ? __mutex_lock+0xfe/0x9f0
[ 1674.571883]  ? do_epoll_wait+0x3b3/0xd80
[ 1674.572420]  ? ep_start_scan+0xe0/0x100
[ 1674.572975]  ? _raw_write_lock_irq+0x5/0x60
[ 1674.573543]  ? write_comp_data+0x2f/0x90
[ 1674.574098]  _raw_write_lock_irq+0x5/0x60
[ 1674.574648]  ep_start_scan+0x68/0x100
[ 1674.575156]  ? _raw_write_lock_irq+0x5/0x60
[ 1674.575716]  ? ep_start_scan+0x68/0x100
[ 1674.576279]  do_epoll_wait+0x3bf/0xd80
[ 1674.576954]  ? wait_woken+0x90/0x90
[ 1674.577506]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1674.578146]  do_syscall_64+0x37/0x80
[ 1674.578651]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1674.579313] RIP: 0033:0x7f8a39143b20
[ 1674.579803] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1674.582073] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1674.583062] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1674.583960] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1674.584862] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1674.585758] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1674.586661] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1674.587753] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1674.587863] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1674.588754] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1674.589790] caller is debug_smp_processor_id+0x1c/0x20
[ 1674.591277] Call Trace:
[ 1674.591313]  dump_stack_lvl+0xa4/0xd3
[ 1674.591396]  dump_stack+0x15/0x17
[ 1674.593300]  check_preemption_disabled+0x167/0x180
[ 1674.594054]  debug_smp_processor_id+0x1c/0x20
[ 1674.594694]  perf_trace_buf_alloc+0x98/0x100
[ 1674.595318]  ? ftrace_replace_code+0xfd/0x170
[ 1674.595938]  ? jump_label_transform+0x70/0x70
[ 1674.596586]  perf_ftrace_function_call+0x209/0x360
[ 1674.597506]  ? 0xffffffffa009a099
[ 1674.598144]  0xffffffffa009a099
[ 1674.598655]  ? write_comp_data+0x2f/0x90
[ 1674.599344]  ? print_constraints_debug+0x690/0x690
[ 1674.600035]  ? text_poke_queue+0x5/0xc0
[ 1674.600603]  ? __fentry__+0x10/0x10
[ 1674.601151]  text_poke_queue+0x5/0xc0
[ 1674.601721]  ftrace_replace_code+0xfd/0x170
[ 1674.602377]  ? text_poke_queue+0x5/0xc0
[ 1674.602966]  ? ftrace_replace_code+0xfd/0x170
[ 1674.603698]  ftrace_modify_all_code+0x1b1/0x270
[ 1674.604442]  arch_ftrace_update_code+0x9/0x10
[ 1674.605112]  ftrace_run_update_code+0x30/0xa0
[ 1674.605807]  ftrace_startup_enable+0x5e/0xa0
[ 1674.606495]  ftrace_startup+0x16d/0x240
[ 1674.607186]  register_ftrace_function+0x43/0x90
[ 1674.607906]  perf_ftrace_event_register+0xc1/0xf0
[ 1674.608650]  perf_trace_event_init+0xa0/0x4c0
[ 1674.609386]  perf_trace_init+0xda/0x160
[ 1674.610008]  perf_tp_event_init+0x57/0xa0
[ 1674.610637]  perf_try_init_event+0x83/0x270
[ 1674.611325]  perf_event_alloc+0xe3f/0x1c10
[ 1674.611916]  ? _raw_spin_unlock+0x2c/0x50
[ 1674.612519]  ? alloc_fd+0x20d/0x320
[ 1674.613168]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1674.613883]  ? write_comp_data+0x2f/0x90
[ 1674.614850]  __x64_sys_perf_event_open+0x26/0x30
[ 1674.615531]  do_syscall_64+0x37/0x80
[ 1674.616079]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1674.616790] RIP: 0033:0x7fac0740459d
[ 1674.617319] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1674.619736] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1674.620774] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1674.621733] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1674.622717] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1674.623676] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1674.624632] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1674.625843] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1674.626138] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1674.626880] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1674.627902] caller is debug_smp_processor_id+0x1c/0x20
[ 1674.629285] Call Trace:
[ 1674.630327]  dump_stack_lvl+0xa4/0xd3
[ 1674.630902]  dump_stack+0x15/0x17
[ 1674.631394]  check_preemption_disabled+0x167/0x180
[ 1674.632036]  ? ep_done_scan+0x3b/0x240
[ 1674.632544]  ? _raw_read_lock_irq+0xa0/0xa0
[ 1674.633132]  debug_smp_processor_id+0x1c/0x20
[ 1674.633722]  perf_ftrace_function_call+0x7c/0x360
[ 1674.634361]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1674.635013]  ? ftrace_ops_test+0x71/0xc0
[ 1674.635583]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1674.636229]  ? _prb_read_valid+0x3ad/0x3f0
[ 1674.636832]  ? write_comp_data+0x2f/0x90
[ 1674.637444]  0xffffffffa009a099
[ 1674.637891]  ? ep_destroy_wakeup_source+0xe0/0xe0
[ 1674.638606]  ? do_epoll_wait+0x85a/0xd80
[ 1674.639171]  ? _raw_write_lock_irq+0x5/0x60
[ 1674.639796]  _raw_write_lock_irq+0x5/0x60
[ 1674.640346]  ep_done_scan+0x3b/0x240
[ 1674.640865]  ? _raw_write_lock_irq+0x5/0x60
[ 1674.641426]  ? ep_done_scan+0x3b/0x240
[ 1674.642017]  do_epoll_wait+0xabb/0xd80
[ 1674.642711]  ? wait_woken+0x90/0x90
[ 1674.643271]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1674.643906]  do_syscall_64+0x37/0x80
[ 1674.644410]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1674.645071] RIP: 0033:0x7f8a39143b20
[ 1674.645561] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1674.647886] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1674.648858] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1674.649754] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1674.650671] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1674.651569] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1674.652467] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1674.653563] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1674.653675] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1674.654591] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1674.654618] Call Trace:
[ 1674.654654]  dump_stack_lvl+0xa4/0xd3
[ 1674.655700] caller is debug_smp_processor_id+0x1c/0x20
[ 1674.657287]  dump_stack+0x15/0x17
[ 1674.659243]  check_preemption_disabled+0x167/0x180
[ 1674.659997]  debug_smp_processor_id+0x1c/0x20
[ 1674.660635]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1674.661429]  perf_tp_event+0x331/0x4e0
[ 1674.662201]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1674.663142]  ? arch_local_irq_enable+0x10/0x12
[ 1674.663797]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1674.664498]  ? dump_stack_lvl+0xcc/0xd3
[ 1674.665139]  ? ftrace_replace_code+0xfd/0x170
[ 1674.665761]  ? jump_label_transform+0x70/0x70
[ 1674.666430]  perf_ftrace_function_call+0x248/0x360
[ 1674.667132]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1674.667780]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1674.668458]  ? perf_ftrace_function_call+0x248/0x360
[ 1674.669425]  ? 0xffffffffa009a099
[ 1674.670060]  0xffffffffa009a099
[ 1674.670575]  ? write_comp_data+0x2f/0x90
[ 1674.671261]  ? print_constraints_debug+0x690/0x690
[ 1674.671952]  ? text_poke_queue+0x5/0xc0
[ 1674.672522]  ? __fentry__+0x10/0x10
[ 1674.673071]  text_poke_queue+0x5/0xc0
[ 1674.673621]  ftrace_replace_code+0xfd/0x170
[ 1674.674242]  ? text_poke_queue+0x5/0xc0
[ 1674.674798]  ? ftrace_replace_code+0xfd/0x170
[ 1674.675493]  ftrace_modify_all_code+0x1b1/0x270
[ 1674.676197]  arch_ftrace_update_code+0x9/0x10
[ 1674.676832]  ftrace_run_update_code+0x30/0xa0
[ 1674.677492]  ftrace_startup_enable+0x5e/0xa0
[ 1674.678150]  ftrace_startup+0x16d/0x240
[ 1674.678804]  register_ftrace_function+0x43/0x90
[ 1674.679486]  perf_ftrace_event_register+0xc1/0xf0
[ 1674.680191]  perf_trace_event_init+0xa0/0x4c0
[ 1674.680888]  perf_trace_init+0xda/0x160
[ 1674.681516]  perf_tp_event_init+0x57/0xa0
[ 1674.682143]  perf_try_init_event+0x83/0x270
[ 1674.682829]  perf_event_alloc+0xe3f/0x1c10
[ 1674.683421]  ? _raw_spin_unlock+0x2c/0x50
[ 1674.684026]  ? alloc_fd+0x20d/0x320
[ 1674.684677]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1674.685391]  ? write_comp_data+0x2f/0x90
[ 1674.686378]  __x64_sys_perf_event_open+0x26/0x30
[ 1674.687059]  do_syscall_64+0x37/0x80
[ 1674.687606]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1674.688317] RIP: 0033:0x7fac0740459d
[ 1674.688861] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1674.691310] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1674.692348] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1674.693306] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1674.694271] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1674.695229] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1674.696189] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1674.697400] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1674.698459] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1674.699874] Call Trace:
[ 1674.700226]  dump_stack_lvl+0xa4/0xd3
[ 1674.700759]  dump_stack+0x15/0x17
[ 1674.701222]  check_preemption_disabled+0x167/0x180
[ 1674.701867]  ? do_epoll_wait+0xac3/0xd80
[ 1674.702408]  ? __mutex_unlock_slowpath+0x2e0/0x2e0
[ 1674.703066]  debug_smp_processor_id+0x1c/0x20
[ 1674.703654]  perf_ftrace_function_call+0x7c/0x360
[ 1674.704293]  ? perf_trace_buf_update+0x70/0x70
[ 1674.704891]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1674.705545]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1674.706153]  ? _raw_write_unlock_irq+0x38/0x50
[ 1674.706753]  ? preempt_notifier_dec+0x20/0x20
[ 1674.707396]  ? ftrace_call+0x5/0x44
[ 1674.707881]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1674.708599]  0xffffffffa009a099
[ 1674.709065]  ? preempt_count_sub+0x5/0xa0
[ 1674.709712]  ? mutex_unlock+0x5/0x20
[ 1674.710253]  mutex_unlock+0x5/0x20
[ 1674.710728]  do_epoll_wait+0xac3/0xd80
[ 1674.711246]  ? mutex_unlock+0x5/0x20
[ 1674.711732]  ? do_epoll_wait+0xac3/0xd80
[ 1674.712427]  ? wait_woken+0x90/0x90
[ 1674.712985]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1674.713620]  do_syscall_64+0x37/0x80
[ 1674.714132]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1674.714796] RIP: 0033:0x7f8a39143b20
[ 1674.715286] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1674.717551] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1674.718522] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1674.719418] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1674.720316] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1674.721214] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1674.722119] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1679.370106] check_preemption_disabled: 577200 callbacks suppressed
[ 1679.370136] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1679.372059] caller is debug_smp_processor_id+0x1c/0x20
[ 1679.372776] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1679.373769] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1679.375266] Call Trace:
[ 1679.375653]  dump_stack_lvl+0xa4/0xd3
[ 1679.376238]  dump_stack+0x15/0x17
[ 1679.376741]  check_preemption_disabled+0x167/0x180
[ 1679.377497]  debug_smp_processor_id+0x1c/0x20
[ 1679.378139]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1679.378965]  perf_trace_buf_alloc+0x3d/0x100
[ 1679.379653]  ? text_poke_bp_batch+0xf5/0x2c0
[ 1679.380307]  ? apply_paravirt+0x150/0x150
[ 1679.380950]  perf_ftrace_function_call+0x209/0x360
[ 1679.381940]  ? 0xffffffffa009a099
[ 1679.382642]  0xffffffffa009a099
[ 1679.383166]  ? _raw_spin_unlock+0x2c/0x50
[ 1679.383805]  ? write_comp_data+0x2f/0x90
[ 1679.384477]  ? __ia32_sys_ppoll_time32+0x1/0x180
[ 1679.385228]  ? __ia32_sys_ppoll_time32+0x1/0x180
[ 1679.385940]  ? text_poke+0x5/0x60
[ 1679.386540]  text_poke+0x5/0x60
[ 1679.387057]  text_poke_bp_batch+0xf5/0x2c0
[ 1679.387706]  ? text_poke+0x5/0x60
[ 1679.388232]  ? text_poke_bp_batch+0xf5/0x2c0
[ 1679.388950]  ? kernel_halt+0x70/0x70
[ 1679.389576]  text_poke_queue+0xa7/0xc0
[ 1679.390236]  ftrace_replace_code+0xfd/0x170
[ 1679.390955]  ftrace_modify_all_code+0x1b1/0x270
[ 1679.391707]  arch_ftrace_update_code+0x9/0x10
[ 1679.392383]  ftrace_run_update_code+0x30/0xa0
[ 1679.393085]  ftrace_shutdown+0x2b8/0x4a0
[ 1679.393783]  unregister_ftrace_function+0x25/0x50
[ 1679.394539]  perf_ftrace_event_register+0x89/0xf0
[ 1679.395263]  ? perf_tp_event_init+0xa0/0xa0
[ 1679.395916]  perf_trace_destroy+0x37/0x60
[ 1679.396560]  tp_perf_event_destroy+0x15/0x20
[ 1679.397247]  _free_event+0xfc/0x7d0
[ 1679.397876]  put_event+0x37/0x50
[ 1679.398439]  perf_event_release_kernel+0x2f4/0x370
[ 1679.399253]  ? perf_event_release_kernel+0x370/0x370
[ 1679.400041]  perf_release+0x19/0x20
[ 1679.400615]  __fput+0x12d/0x460
[ 1679.401251]  ____fput+0x1a/0x20
[ 1679.401782]  task_work_run+0x8e/0xf0
[ 1679.402441]  do_exit+0x616/0x1310
[ 1679.403075]  ? write_comp_data+0x2f/0x90
[ 1679.403823]  do_group_exit+0x7e/0x130
[ 1679.404510]  get_signal+0x249/0x13c0
[ 1679.405167]  ? get_signal+0x5/0x13c0
[ 1679.405893]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1679.406811]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1679.407710]  exit_to_user_mode_prepare+0x154/0x240
[ 1679.408513]  syscall_exit_to_user_mode+0x2b/0x60
[ 1679.409278]  do_syscall_64+0x46/0x80
[ 1679.409895]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1679.410698] RIP: 0033:0x7fac0740459d
[ 1679.411294] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1679.412278] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1679.413446] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1679.414524] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1679.415597] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1679.416672] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1679.417748] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1679.419378] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1679.419496] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1679.420461] caller is debug_smp_processor_id+0x1c/0x20
[ 1679.421571] caller is debug_smp_processor_id+0x1c/0x20
[ 1679.422423] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1679.424111] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1679.425675] Call Trace:
[ 1679.426067]  dump_stack_lvl+0xa4/0xd3
[ 1679.426648]  dump_stack+0x15/0x17
[ 1679.427156]  check_preemption_disabled+0x167/0x180
[ 1679.427907]  debug_smp_processor_id+0x1c/0x20
[ 1679.428554]  perf_trace_buf_alloc+0x98/0x100
[ 1679.429196]  ? text_poke_bp_batch+0xf5/0x2c0
[ 1679.429823]  ? apply_paravirt+0x150/0x150
[ 1679.430444]  perf_ftrace_function_call+0x209/0x360
[ 1679.431306]  ? 0xffffffffa009a099
[ 1679.431905]  0xffffffffa009a099
[ 1679.432392]  ? _raw_spin_unlock+0x2c/0x50
[ 1679.432994]  ? write_comp_data+0x2f/0x90
[ 1679.433615]  ? __ia32_sys_ppoll_time32+0x1/0x180
[ 1679.434327]  ? __ia32_sys_ppoll_time32+0x1/0x180
[ 1679.435006]  ? text_poke+0x5/0x60
[ 1679.435547]  text_poke+0x5/0x60
[ 1679.436034]  text_poke_bp_batch+0xf5/0x2c0
[ 1679.436645]  ? text_poke+0x5/0x60
[ 1679.437143]  ? text_poke_bp_batch+0xf5/0x2c0
[ 1679.437810]  ? kernel_halt+0x70/0x70
[ 1679.438395]  text_poke_queue+0xa7/0xc0
[ 1679.438996]  ftrace_replace_code+0xfd/0x170
[ 1679.439660]  ftrace_modify_all_code+0x1b1/0x270
[ 1679.440363]  arch_ftrace_update_code+0x9/0x10
[ 1679.441009]  ftrace_run_update_code+0x30/0xa0
[ 1679.441672]  ftrace_shutdown+0x2b8/0x4a0
[ 1679.442317]  unregister_ftrace_function+0x25/0x50
[ 1679.443018]  perf_ftrace_event_register+0x89/0xf0
[ 1679.443721]  ? perf_tp_event_init+0xa0/0xa0
[ 1679.444343]  perf_trace_destroy+0x37/0x60
[ 1679.444951]  tp_perf_event_destroy+0x15/0x20
[ 1679.445593]  _free_event+0xfc/0x7d0
[ 1679.446171]  put_event+0x37/0x50
[ 1679.446684]  perf_event_release_kernel+0x2f4/0x370
[ 1679.447435]  ? perf_event_release_kernel+0x370/0x370
[ 1679.448175]  perf_release+0x19/0x20
[ 1679.448713]  __fput+0x12d/0x460
[ 1679.449273]  ____fput+0x1a/0x20
[ 1679.449767]  task_work_run+0x8e/0xf0
[ 1679.450359]  do_exit+0x616/0x1310
[ 1679.450909]  ? write_comp_data+0x2f/0x90
[ 1679.451554]  do_group_exit+0x7e/0x130
[ 1679.452151]  get_signal+0x249/0x13c0
[ 1679.452725]  ? get_signal+0x5/0x13c0
[ 1679.453340]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1679.454126]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1679.454902]  exit_to_user_mode_prepare+0x154/0x240
[ 1679.455621]  syscall_exit_to_user_mode+0x2b/0x60
[ 1679.456310]  do_syscall_64+0x46/0x80
[ 1679.456860]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1679.457589] RIP: 0033:0x7fac0740459d
[ 1679.458133] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1679.459042] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1679.460116] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1679.461105] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1679.462106] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1679.463098] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1679.464095] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1679.465263] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1679.465391] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1679.466343] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1679.466361] Call Trace:
[ 1679.466379]  dump_stack_lvl+0xa4/0xd3
[ 1679.466424]  dump_stack+0x15/0x17
[ 1679.466450]  check_preemption_disabled+0x167/0x180
[ 1679.467511] caller is debug_smp_processor_id+0x1c/0x20
[ 1679.468970]  ? __check_object_size+0xc7/0x310
[ 1679.472113]  ? pmd_free_pte_page+0xb0/0xb0
[ 1679.472694]  debug_smp_processor_id+0x1c/0x20
[ 1679.473297]  perf_ftrace_function_call+0x7c/0x360
[ 1679.473945]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1679.474605]  ? ftrace_ops_test+0x71/0xc0
[ 1679.475180]  ? write_comp_data+0x2f/0x90
[ 1679.475734]  ? perf_trace_buf_update+0x70/0x70
[ 1679.476349]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1679.477004]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1679.477623]  ? __check_object_size+0x9f/0x310
[ 1679.478229]  ? page_idle_bitmap_write+0x270/0x270
[ 1679.478908]  0xffffffffa009a099
[ 1679.479358]  ? usercopy_warn+0x120/0x120
[ 1679.479950]  ? __check_object_size+0xb1/0x310
[ 1679.480570]  ? __virt_addr_valid+0x5/0x1b0
[ 1679.481150]  ? __sanitizer_cov_trace_switch+0x53/0x90
[ 1679.481839]  __virt_addr_valid+0x5/0x1b0
[ 1679.482398]  __check_object_size+0xc7/0x310
[ 1679.482979]  ? __virt_addr_valid+0x5/0x1b0
[ 1679.483544]  ? __check_object_size+0xc7/0x310
[ 1679.484142]  ? write_comp_data+0x2f/0x90
[ 1679.484727]  devkmsg_read+0x2bf/0x350
[ 1679.485254]  ? devkmsg_read+0x5/0x350
[ 1679.485771]  ? write_comp_data+0x2f/0x90
[ 1679.486338]  ? info_print_ext_header.constprop.38+0xe0/0xe0
[ 1679.487104]  vfs_read+0x14a/0x330
[ 1679.487619]  ksys_read+0x9e/0x170
[ 1679.488127]  __x64_sys_read+0x23/0x30
[ 1679.488648]  do_syscall_64+0x37/0x80
[ 1679.489157]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1679.489842] RIP: 0033:0x7f8a39227da4
[ 1679.490350] Code: c3 0f 1f 44 00 00 41 54 49 89 d4 55 48 89 f5 53 89 fb 48 83 ec 10 e8 6b fc ff ff 41 89 c0 4c 89 e2 48 89 ee 89 df 31 c0 0f 05 <48> 3d 00 f0 ff ff 77 38 44 89 c7 48 89 44 24 08 e8 a7 fc ff ff 48
[ 1679.492730] RSP: 002b:00007fff1b559440 EFLAGS: 00000246 ORIG_RAX: 0000000000000000
[ 1679.493731] RAX: ffffffffffffffda RBX: 0000000000000007 RCX: 00007f8a39227da4
[ 1679.494673] RDX: 0000000000002000 RSI: 00007fff1b559470 RDI: 0000000000000007
[ 1679.495607] RBP: 00007fff1b559470 R08: 0000000000000000 R09: 0000000000000000
[ 1679.496541] R10: 00007fff1b57c0f0 R11: 0000000000000246 R12: 0000000000002000
[ 1679.497473] R13: 00007fff1b55b4b8 R14: 00007fff1b55b4c0 R15: 0000000000000000
[ 1679.498525] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1679.498629] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1679.499567] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1679.500657] caller is debug_smp_processor_id+0x1c/0x20
[ 1679.502199] Call Trace:
[ 1679.502227]  dump_stack_lvl+0xa4/0xd3
[ 1679.502289]  dump_stack+0x15/0x17
[ 1679.504267]  check_preemption_disabled+0x167/0x180
[ 1679.505012]  debug_smp_processor_id+0x1c/0x20
[ 1679.505660]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1679.506464]  perf_tp_event+0x331/0x4e0
[ 1679.507259]  ? arch_local_irq_enable+0x10/0x12
[ 1679.507925]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1679.508636]  ? dump_stack_lvl+0xcc/0xd3
[ 1679.509238]  ? dump_stack+0x15/0x17
[ 1679.509769]  ? check_preemption_disabled+0x167/0x180
[ 1679.510545]  ? text_poke_bp_batch+0xf5/0x2c0
[ 1679.511171]  ? apply_paravirt+0x150/0x150
[ 1679.511789]  perf_ftrace_function_call+0x248/0x360
[ 1679.512488]  ? perf_ftrace_function_call+0x248/0x360
[ 1679.513391]  ? 0xffffffffa009a099
[ 1679.513986]  0xffffffffa009a099
[ 1679.514478]  ? _raw_spin_unlock+0x2c/0x50
[ 1679.515079]  ? write_comp_data+0x2f/0x90
[ 1679.515700]  ? __ia32_sys_ppoll_time32+0x1/0x180
[ 1679.516404]  ? __ia32_sys_ppoll_time32+0x1/0x180
[ 1679.517081]  ? text_poke+0x5/0x60
[ 1679.517621]  text_poke+0x5/0x60
[ 1679.518110]  text_poke_bp_batch+0xf5/0x2c0
[ 1679.518721]  ? text_poke+0x5/0x60
[ 1679.519221]  ? text_poke_bp_batch+0xf5/0x2c0
[ 1679.519889]  ? kernel_halt+0x70/0x70
[ 1679.520463]  text_poke_queue+0xa7/0xc0
[ 1679.521063]  ftrace_replace_code+0xfd/0x170
[ 1679.521728]  ftrace_modify_all_code+0x1b1/0x270
[ 1679.522432]  arch_ftrace_update_code+0x9/0x10
[ 1679.523082]  ftrace_run_update_code+0x30/0xa0
[ 1679.523745]  ftrace_shutdown+0x2b8/0x4a0
[ 1679.524382]  unregister_ftrace_function+0x25/0x50
[ 1679.525082]  perf_ftrace_event_register+0x89/0xf0
[ 1679.525776]  ? perf_tp_event_init+0xa0/0xa0
[ 1679.526407]  perf_trace_destroy+0x37/0x60
[ 1679.527018]  tp_perf_event_destroy+0x15/0x20
[ 1679.527661]  _free_event+0xfc/0x7d0
[ 1679.528233]  put_event+0x37/0x50
[ 1679.528746]  perf_event_release_kernel+0x2f4/0x370
[ 1679.529498]  ? perf_event_release_kernel+0x370/0x370
[ 1679.530249]  perf_release+0x19/0x20
[ 1679.530797]  __fput+0x12d/0x460
[ 1679.531358]  ____fput+0x1a/0x20
[ 1679.531852]  task_work_run+0x8e/0xf0
[ 1679.532436]  do_exit+0x616/0x1310
[ 1679.532987]  ? write_comp_data+0x2f/0x90
[ 1679.533633]  do_group_exit+0x7e/0x130
[ 1679.534233]  get_signal+0x249/0x13c0
[ 1679.534807]  ? get_signal+0x5/0x13c0
[ 1679.535423]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1679.536206]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1679.536983]  exit_to_user_mode_prepare+0x154/0x240
[ 1679.537702]  syscall_exit_to_user_mode+0x2b/0x60
[ 1679.538396]  do_syscall_64+0x46/0x80
[ 1679.538947]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1679.539680] RIP: 0033:0x7fac0740459d
[ 1679.540216] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1679.541127] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1679.542199] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1679.543191] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1679.544181] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1679.545174] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1679.546170] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1679.547336] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1679.547502] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1679.548407] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1679.549554] caller is debug_smp_processor_id+0x1c/0x20
[ 1679.551012] Call Trace:
[ 1679.551030]  dump_stack_lvl+0xa4/0xd3
[ 1679.551074]  dump_stack+0x15/0x17
[ 1679.551100]  check_preemption_disabled+0x167/0x180
[ 1679.551129]  ? do_faccessat+0x331/0x450
[ 1679.554291]  ? get_task_cred+0x270/0x270
[ 1679.554849]  debug_smp_processor_id+0x1c/0x20
[ 1679.555452]  perf_ftrace_function_call+0x7c/0x360
[ 1679.556098]  ? perf_ftrace_function_call+0x4c/0x360
[ 1679.556772]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1679.557428]  ? ftrace_ops_test+0x71/0xc0
[ 1679.557981]  ? ftrace_ops_test+0x71/0xc0
[ 1679.558536]  ? perf_trace_buf_update+0x70/0x70
[ 1679.559151]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1679.559808]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1679.560427]  ? __secure_computing+0x8f/0x190
[ 1679.561038]  ? seccomp_notify_ioctl+0x780/0x780
[ 1679.561701]  0xffffffffa009a099
[ 1679.562210]  ? do_faccessat+0xb0/0x450
[ 1679.562755]  ? prepare_creds+0x5/0x460
[ 1679.563302]  prepare_creds+0x5/0x460
[ 1679.563807]  do_faccessat+0x331/0x450
[ 1679.564324]  ? prepare_creds+0x5/0x460
[ 1679.564844]  ? do_faccessat+0x331/0x450
[ 1679.565441]  __x64_sys_access+0x26/0x30
[ 1679.565986]  do_syscall_64+0x37/0x80
[ 1679.566498]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1679.567186] RIP: 0033:0x7f8a3913198b
[ 1679.567686] Code: 64 89 02 48 c7 c0 ff ff ff ff c3 66 2e 0f 1f 84 00 00 00 00 00 66 2e 0f 1f 84 00 00 00 00 00 f3 0f 1e fa b8 15 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 05 c3 0f 1f 40 00 48 8b 15 e1 b4 0d 00 f7 d8
[ 1679.570087] RSP: 002b:00007fff1b558a08 EFLAGS: 00000246 ORIG_RAX: 0000000000000015
[ 1679.571114] RAX: ffffffffffffffda RBX: 00007fff1b55b580 RCX: 00007f8a3913198b
[ 1679.572047] RDX: 00007f8a398269e8 RSI: 0000000000000000 RDI: 0000560a6f41c090
[ 1679.572978] RBP: 00007fff1b558a50 R08: 0000000000000000 R09: 0000000000000000
[ 1679.573909] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000000000
[ 1679.574849] R13: 0000000000000000 R14: 0000000000000009 R15: 0000560a70da6780
[ 1679.575900] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1679.576031] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1679.577027] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1679.578168] caller is debug_smp_processor_id+0x1c/0x20
[ 1679.579797] Call Trace:
[ 1679.580878]  dump_stack_lvl+0xa4/0xd3
[ 1679.581537]  dump_stack+0x15/0x17
[ 1679.582109]  check_preemption_disabled+0x167/0x180
[ 1679.582887]  ? text_poke+0x2b/0x60
[ 1679.583452]  ? do_sync_core+0x30/0x30
[ 1679.584096]  debug_smp_processor_id+0x1c/0x20
[ 1679.584836]  perf_ftrace_function_call+0x7c/0x360
[ 1679.585589]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1679.586358]  ? text_poke_bp_batch+0xf5/0x2c0
[ 1679.587057]  ? perf_ftrace_function_call+0x4c/0x360
[ 1679.588121]  ? __ia32_sys_ppoll_time32+0x1/0x180
[ 1679.588927]  0xffffffffa009a099
[ 1679.589548]  ? _raw_spin_unlock+0x2c/0x50
[ 1679.590238]  ? __ia32_sys_ppoll_time32+0x1/0x180
[ 1679.591029]  ? __ia32_sys_ppoll_time32+0x1/0x180
[ 1679.591776]  ? __text_poke+0x5/0x4e0
[ 1679.592382]  ? lock_is_held_type+0xe2/0x140
[ 1679.593110]  __text_poke+0x5/0x4e0
[ 1679.593694]  text_poke+0x2b/0x60
[ 1679.594279]  ? __text_poke+0x5/0x4e0
[ 1679.594875]  ? text_poke+0x2b/0x60
[ 1679.595497]  text_poke_bp_batch+0xf5/0x2c0
[ 1679.596232]  ? kernel_halt+0x70/0x70
[ 1679.596905]  text_poke_queue+0xa7/0xc0
[ 1679.597594]  ftrace_replace_code+0xfd/0x170
[ 1679.598366]  ftrace_modify_all_code+0x1b1/0x270
[ 1679.599165]  arch_ftrace_update_code+0x9/0x10
[ 1679.599888]  ftrace_run_update_code+0x30/0xa0
[ 1679.600639]  ftrace_shutdown+0x2b8/0x4a0
[ 1679.601387]  unregister_ftrace_function+0x25/0x50
[ 1679.602193]  perf_ftrace_event_register+0x89/0xf0
[ 1679.602972]  ? perf_tp_event_init+0xa0/0xa0
[ 1679.603671]  perf_trace_destroy+0x37/0x60
[ 1679.604353]  tp_perf_event_destroy+0x15/0x20
[ 1679.605069]  _free_event+0xfc/0x7d0
[ 1679.605731]  put_event+0x37/0x50
[ 1679.606320]  perf_event_release_kernel+0x2f4/0x370
[ 1679.607190]  ? perf_event_release_kernel+0x370/0x370
[ 1679.608057]  perf_release+0x19/0x20
[ 1679.608697]  __fput+0x12d/0x460
[ 1679.609408]  ____fput+0x1a/0x20
[ 1679.609997]  task_work_run+0x8e/0xf0
[ 1679.610720]  do_exit+0x616/0x1310
[ 1679.611396]  ? write_comp_data+0x2f/0x90
[ 1679.612187]  do_group_exit+0x7e/0x130
[ 1679.612913]  get_signal+0x249/0x13c0
[ 1679.613608]  ? get_signal+0x5/0x13c0
[ 1679.614459]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1679.615450]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1679.616350]  exit_to_user_mode_prepare+0x154/0x240
[ 1679.617153]  syscall_exit_to_user_mode+0x2b/0x60
[ 1679.617920]  do_syscall_64+0x46/0x80
[ 1679.618546]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1679.619349] RIP: 0033:0x7fac0740459d
[ 1679.619947] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1679.620935] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1679.622113] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1679.623189] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1679.624268] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1679.625344] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1679.626436] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1679.627809] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1679.628007] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1679.628898] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1679.630176] caller is debug_smp_processor_id+0x1c/0x20
[ 1679.631517] Call Trace:
[ 1679.632635]  dump_stack_lvl+0xa4/0xd3
[ 1679.633168]  dump_stack+0x15/0x17
[ 1679.633638]  check_preemption_disabled+0x167/0x180
[ 1679.634302]  ? do_faccessat+0x391/0x450
[ 1679.634833]  ? profiling_store+0xa0/0xa0
[ 1679.635391]  debug_smp_processor_id+0x1c/0x20
[ 1679.635991]  perf_ftrace_function_call+0x7c/0x360
[ 1679.636631]  ? rcu_advance_cbs+0x70/0x70
[ 1679.637194]  ? write_comp_data+0x2f/0x90
[ 1679.637746]  ? write_comp_data+0x2f/0x90
[ 1679.638306]  ? perf_trace_buf_update+0x70/0x70
[ 1679.638918]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1679.639572]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1679.640188]  ? make_kuid+0x27/0x30
[ 1679.640670]  ? __put_user_ns+0x30/0x30
[ 1679.641248]  0xffffffffa009a099
[ 1679.641752]  ? do_faccessat+0x3ed/0x450
[ 1679.642318]  ? override_creds+0x5/0x30
[ 1679.642866]  override_creds+0x5/0x30
[ 1679.643368]  do_faccessat+0x391/0x450
[ 1679.643884]  ? override_creds+0x5/0x30
[ 1679.644402]  ? do_faccessat+0x391/0x450
[ 1679.644999]  __x64_sys_access+0x26/0x30
[ 1679.645543]  do_syscall_64+0x37/0x80
[ 1679.646055]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1679.646741] RIP: 0033:0x7f8a3913198b
[ 1679.647241] Code: 64 89 02 48 c7 c0 ff ff ff ff c3 66 2e 0f 1f 84 00 00 00 00 00 66 2e 0f 1f 84 00 00 00 00 00 f3 0f 1e fa b8 15 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 05 c3 0f 1f 40 00 48 8b 15 e1 b4 0d 00 f7 d8
[ 1679.649617] RSP: 002b:00007fff1b558a08 EFLAGS: 00000246 ORIG_RAX: 0000000000000015
[ 1679.650619] RAX: ffffffffffffffda RBX: 00007fff1b55b580 RCX: 00007f8a3913198b
[ 1679.651551] RDX: 00007f8a398269e8 RSI: 0000000000000000 RDI: 0000560a6f41c090
[ 1679.652481] RBP: 00007fff1b558a50 R08: 0000000000000000 R09: 0000000000000000
[ 1679.653412] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000000000
[ 1679.654344] R13: 0000000000000000 R14: 0000000000000009 R15: 0000560a70da6780
[ 1679.655396] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1679.655494] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1679.656526] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1679.657611] caller is debug_smp_processor_id+0x1c/0x20
[ 1679.659271] Call Trace:
[ 1679.659315]  dump_stack_lvl+0xa4/0xd3
[ 1679.661000]  dump_stack+0x15/0x17
[ 1679.661567]  check_preemption_disabled+0x167/0x180
[ 1679.662418]  debug_smp_processor_id+0x1c/0x20
[ 1679.663136]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1679.664070]  perf_trace_buf_alloc+0x3d/0x100
[ 1679.664774]  ? text_poke+0x2b/0x60
[ 1679.665338]  ? do_sync_core+0x30/0x30
[ 1679.665968]  perf_ftrace_function_call+0x209/0x360
[ 1679.666761]  ? text_poke_bp_batch+0xf5/0x2c0
[ 1679.667685]  ? 0xffffffffa009a099
[ 1679.668317]  ? __ia32_sys_ppoll_time32+0x1/0x180
[ 1679.669124]  0xffffffffa009a099
[ 1679.669746]  ? _raw_spin_unlock+0x2c/0x50
[ 1679.670431]  ? __ia32_sys_ppoll_time32+0x1/0x180
[ 1679.671224]  ? __ia32_sys_ppoll_time32+0x1/0x180
[ 1679.671975]  ? __text_poke+0x5/0x4e0
[ 1679.672579]  ? lock_is_held_type+0xe2/0x140
[ 1679.673298]  __text_poke+0x5/0x4e0
[ 1679.673879]  text_poke+0x2b/0x60
[ 1679.674439]  ? __text_poke+0x5/0x4e0
[ 1679.675028]  ? text_poke+0x2b/0x60
[ 1679.675649]  text_poke_bp_batch+0xf5/0x2c0
[ 1679.676384]  ? kernel_halt+0x70/0x70
[ 1679.677043]  text_poke_queue+0xa7/0xc0
[ 1679.677729]  ftrace_replace_code+0xfd/0x170
[ 1679.678492]  ftrace_modify_all_code+0x1b1/0x270
[ 1679.679288]  arch_ftrace_update_code+0x9/0x10
[ 1679.680004]  ftrace_run_update_code+0x30/0xa0
[ 1679.680747]  ftrace_shutdown+0x2b8/0x4a0
[ 1679.681484]  unregister_ftrace_function+0x25/0x50
[ 1679.682264]  perf_ftrace_event_register+0x89/0xf0
[ 1679.683030]  ? perf_tp_event_init+0xa0/0xa0
[ 1679.683719]  perf_trace_destroy+0x37/0x60
[ 1679.684401]  tp_perf_event_destroy+0x15/0x20
[ 1679.685118]  _free_event+0xfc/0x7d0
[ 1679.685781]  put_event+0x37/0x50
[ 1679.686373]  perf_event_release_kernel+0x2f4/0x370
[ 1679.687232]  ? perf_event_release_kernel+0x370/0x370
[ 1679.688058]  perf_release+0x19/0x20
[ 1679.688665]  __fput+0x12d/0x460
[ 1679.689334]  ____fput+0x1a/0x20
[ 1679.689892]  task_work_run+0x8e/0xf0
[ 1679.690578]  do_exit+0x616/0x1310
[ 1679.691218]  ? write_comp_data+0x2f/0x90
[ 1679.691968]  do_group_exit+0x7e/0x130
[ 1679.692656]  get_signal+0x249/0x13c0
[ 1679.693317]  ? get_signal+0x5/0x13c0
[ 1679.694049]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1679.694977]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1679.695876]  exit_to_user_mode_prepare+0x154/0x240
[ 1679.696678]  syscall_exit_to_user_mode+0x2b/0x60
[ 1679.697445]  do_syscall_64+0x46/0x80
[ 1679.698066]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1679.698870] RIP: 0033:0x7fac0740459d
[ 1679.699466] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1679.700465] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1679.701630] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1679.702715] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1679.703789] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1679.704862] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1679.705937] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1679.707307] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1679.707476] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1679.708373] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1679.709438] caller is debug_smp_processor_id+0x1c/0x20
[ 1679.710895] Call Trace:
[ 1679.710914]  dump_stack_lvl+0xa4/0xd3
[ 1679.710958]  dump_stack+0x15/0x17
[ 1679.710984]  check_preemption_disabled+0x167/0x180
[ 1679.711013]  ? __check_object_size+0xc7/0x310
[ 1679.714189]  ? pmd_free_pte_page+0xb0/0xb0
[ 1679.714770]  debug_smp_processor_id+0x1c/0x20
[ 1679.715374]  perf_ftrace_function_call+0x7c/0x360
[ 1679.716020]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1679.716673]  ? ftrace_ops_test+0x71/0xc0
[ 1679.717224]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1679.717842]  ? rcu_read_lock_held_common+0x2f/0x50
[ 1679.718510]  ? write_comp_data+0x2f/0x90
[ 1679.719062]  ? perf_trace_buf_update+0x70/0x70
[ 1679.719675]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1679.720330]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1679.720947]  ? __check_object_size+0x9f/0x310
[ 1679.721548]  ? page_idle_bitmap_write+0x270/0x270
[ 1679.722229]  0xffffffffa009a099
[ 1679.722678]  ? usercopy_warn+0x120/0x120
[ 1679.723269]  ? __check_object_size+0xb1/0x310
[ 1679.723888]  ? __virt_addr_valid+0x5/0x1b0
[ 1679.724467]  ? __sanitizer_cov_trace_switch+0x53/0x90
[ 1679.725157]  __virt_addr_valid+0x5/0x1b0
[ 1679.725703]  __check_object_size+0xc7/0x310
[ 1679.726291]  ? __virt_addr_valid+0x5/0x1b0
[ 1679.726855]  ? __check_object_size+0xc7/0x310
[ 1679.727452]  ? write_comp_data+0x2f/0x90
[ 1679.728038]  strncpy_from_user+0x89/0x370
[ 1679.728606]  ? kmem_cache_alloc+0x283/0x300
[ 1679.729230]  getname_flags+0x8c/0x2d0
[ 1679.729784]  user_path_at_empty+0x34/0x90
[ 1679.730382]  do_faccessat+0xe3/0x450
[ 1679.730946]  __x64_sys_access+0x26/0x30
[ 1679.731491]  do_syscall_64+0x37/0x80
[ 1679.731999]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1679.732684] RIP: 0033:0x7f8a3913198b
[ 1679.733182] Code: 64 89 02 48 c7 c0 ff ff ff ff c3 66 2e 0f 1f 84 00 00 00 00 00 66 2e 0f 1f 84 00 00 00 00 00 f3 0f 1e fa b8 15 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 05 c3 0f 1f 40 00 48 8b 15 e1 b4 0d 00 f7 d8
[ 1679.735563] RSP: 002b:00007fff1b558a08 EFLAGS: 00000246 ORIG_RAX: 0000000000000015
[ 1679.736563] RAX: ffffffffffffffda RBX: 00007fff1b55b580 RCX: 00007f8a3913198b
[ 1679.737497] RDX: 00007f8a398269e8 RSI: 0000000000000000 RDI: 0000560a6f41c090
[ 1679.738431] RBP: 00007fff1b558a50 R08: 0000000000000000 R09: 0000000000000000
[ 1679.739364] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000000000
[ 1679.740296] R13: 0000000000000000 R14: 0000000000000009 R15: 0000560a70da6780
[ 1679.741346] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1679.742417] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1679.743980] Call Trace:
[ 1679.744366]  dump_stack_lvl+0xa4/0xd3
[ 1679.744949]  dump_stack+0x15/0x17
[ 1679.745460]  check_preemption_disabled+0x167/0x180
[ 1679.746213]  debug_smp_processor_id+0x1c/0x20
[ 1679.746863]  perf_trace_buf_alloc+0x98/0x100
[ 1679.747502]  ? text_poke+0x2b/0x60
[ 1679.748016]  ? do_sync_core+0x30/0x30
[ 1679.748579]  perf_ftrace_function_call+0x209/0x360
[ 1679.749445]  ? 0xffffffffa009a099
[ 1679.749990]  ? __ia32_sys_ppoll_time32+0x1/0x180
[ 1679.750713]  0xffffffffa009a099
[ 1679.751244]  ? _raw_spin_unlock+0x2c/0x50
[ 1679.751859]  ? __ia32_sys_ppoll_time32+0x1/0x180
[ 1679.752567]  ? __ia32_sys_ppoll_time32+0x1/0x180
[ 1679.753250]  ? __text_poke+0x5/0x4e0
[ 1679.753796]  ? lock_is_held_type+0xe2/0x140
[ 1679.754443]  __text_poke+0x5/0x4e0
[ 1679.754965]  text_poke+0x2b/0x60
[ 1679.755463]  ? __text_poke+0x5/0x4e0
[ 1679.755997]  ? text_poke+0x2b/0x60
[ 1679.756543]  text_poke_bp_batch+0xf5/0x2c0
[ 1679.757190]  ? kernel_halt+0x70/0x70
[ 1679.757768]  text_poke_queue+0xa7/0xc0
[ 1679.758375]  ftrace_replace_code+0xfd/0x170
[ 1679.759041]  ftrace_modify_all_code+0x1b1/0x270
[ 1679.759745]  arch_ftrace_update_code+0x9/0x10
[ 1679.760395]  ftrace_run_update_code+0x30/0xa0
[ 1679.761059]  ftrace_shutdown+0x2b8/0x4a0
[ 1679.761700]  unregister_ftrace_function+0x25/0x50
[ 1679.762409]  perf_ftrace_event_register+0x89/0xf0
[ 1679.763108]  ? perf_tp_event_init+0xa0/0xa0
[ 1679.763734]  perf_trace_destroy+0x37/0x60
[ 1679.764346]  tp_perf_event_destroy+0x15/0x20
[ 1679.764993]  _free_event+0xfc/0x7d0
[ 1679.765568]  put_event+0x37/0x50
[ 1679.766124]  perf_event_release_kernel+0x2f4/0x370
[ 1679.766883]  ? perf_event_release_kernel+0x370/0x370
[ 1679.767628]  perf_release+0x19/0x20
[ 1679.768168]  __fput+0x12d/0x460
[ 1679.768731]  ____fput+0x1a/0x20
[ 1679.769227]  task_work_run+0x8e/0xf0
[ 1679.769814]  do_exit+0x616/0x1310
[ 1679.770388]  ? write_comp_data+0x2f/0x90
[ 1679.771037]  do_group_exit+0x7e/0x130
[ 1679.771635]  get_signal+0x249/0x13c0
[ 1679.772213]  ? get_signal+0x5/0x13c0
[ 1679.772830]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1679.773617]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1679.774400]  exit_to_user_mode_prepare+0x154/0x240
[ 1679.775129]  syscall_exit_to_user_mode+0x2b/0x60
[ 1679.775822]  do_syscall_64+0x46/0x80
[ 1679.776377]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1679.777111] RIP: 0033:0x7fac0740459d
[ 1679.777649] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1679.778571] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1679.779649] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1679.780643] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1679.781636] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1679.782633] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1679.783627] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1684.374062] check_preemption_disabled: 1232853 callbacks suppressed
[ 1684.374086] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1684.376023] caller is debug_smp_processor_id+0x1c/0x20
[ 1684.376753] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1684.377767] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1684.379305] Call Trace:
[ 1684.379692]  dump_stack_lvl+0xa4/0xd3
[ 1684.380272]  dump_stack+0x15/0x17
[ 1684.380785]  check_preemption_disabled+0x167/0x180
[ 1684.381530]  debug_smp_processor_id+0x1c/0x20
[ 1684.382179]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1684.383003]  perf_trace_buf_alloc+0x3d/0x100
[ 1684.383631]  ? text_poke_queue+0x84/0xc0
[ 1684.384205]  ? cpumask_weight+0x20/0x20
[ 1684.384770]  perf_ftrace_function_call+0x209/0x360
[ 1684.385636]  ? 0xffffffffa009a099
[ 1684.386199]  ? pcie_portdrv_mmio_enabled+0x20/0x20
[ 1684.386935]  0xffffffffa009a099
[ 1684.387456]  ? ftrace_call+0x5/0x44
[ 1684.388029]  ? pcie_portdrv_mmio_enabled+0x20/0x20
[ 1684.388711]  ? text_poke_loc_init+0x5/0x140
[ 1684.389329]  ? pcie_portdrv_mmio_enabled+0x20/0x20
[ 1684.390002]  text_poke_loc_init+0x5/0x140
[ 1684.390613]  text_poke_queue+0x84/0xc0
[ 1684.391158]  ? text_poke_loc_init+0x5/0x140
[ 1684.391743]  ? text_poke_queue+0x84/0xc0
[ 1684.392346]  ftrace_replace_code+0xfd/0x170
[ 1684.392992]  ftrace_modify_all_code+0x1b1/0x270
[ 1684.393672]  arch_ftrace_update_code+0x9/0x10
[ 1684.394298]  ftrace_run_update_code+0x30/0xa0
[ 1684.394935]  ftrace_shutdown+0x2b8/0x4a0
[ 1684.395560]  unregister_ftrace_function+0x25/0x50
[ 1684.396231]  perf_ftrace_event_register+0x89/0xf0
[ 1684.396892]  ? perf_tp_event_init+0xa0/0xa0
[ 1684.397486]  perf_trace_destroy+0x37/0x60
[ 1684.398075]  tp_perf_event_destroy+0x15/0x20
[ 1684.398696]  _free_event+0xfc/0x7d0
[ 1684.399257]  put_event+0x37/0x50
[ 1684.399757]  perf_event_release_kernel+0x2f4/0x370
[ 1684.400490]  ? perf_event_release_kernel+0x370/0x370
[ 1684.401207]  perf_release+0x19/0x20
[ 1684.401728]  __fput+0x12d/0x460
[ 1684.402297]  ____fput+0x1a/0x20
[ 1684.402776]  task_work_run+0x8e/0xf0
[ 1684.403355]  do_exit+0x616/0x1310
[ 1684.403896]  ? write_comp_data+0x2f/0x90
[ 1684.404531]  do_group_exit+0x7e/0x130
[ 1684.405114]  get_signal+0x249/0x13c0
[ 1684.405674]  ? get_signal+0x5/0x13c0
[ 1684.406293]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1684.407065]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1684.407857]  exit_to_user_mode_prepare+0x154/0x240
[ 1684.408604]  syscall_exit_to_user_mode+0x2b/0x60
[ 1684.409321]  do_syscall_64+0x46/0x80
[ 1684.409890]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1684.410652] RIP: 0033:0x7fac0740459d
[ 1684.411209] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1684.412135] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1684.413233] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1684.414290] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1684.415358] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1684.416426] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1684.417495] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1684.418986] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1684.419054] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1684.420067] caller is debug_smp_processor_id+0x1c/0x20
[ 1684.421166] caller is debug_smp_processor_id+0x1c/0x20
[ 1684.421883] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1684.423577] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1684.425121] Call Trace:
[ 1684.425491]  dump_stack_lvl+0xa4/0xd3
[ 1684.426052]  dump_stack+0x15/0x17
[ 1684.426551]  check_preemption_disabled+0x167/0x180
[ 1684.427265]  debug_smp_processor_id+0x1c/0x20
[ 1684.427897]  perf_trace_buf_alloc+0x98/0x100
[ 1684.428517]  ? text_poke_queue+0x84/0xc0
[ 1684.429086]  ? cpumask_weight+0x20/0x20
[ 1684.429651]  perf_ftrace_function_call+0x209/0x360
[ 1684.430449]  ? 0xffffffffa009a099
[ 1684.430963]  ? pcie_portdrv_mmio_enabled+0x20/0x20
[ 1684.431677]  0xffffffffa009a099
[ 1684.432169]  ? ftrace_call+0x5/0x44
[ 1684.432723]  ? pcie_portdrv_mmio_enabled+0x20/0x20
[ 1684.433418]  ? text_poke_loc_init+0x5/0x140
[ 1684.434040]  ? pcie_portdrv_mmio_enabled+0x20/0x20
[ 1684.434741]  text_poke_loc_init+0x5/0x140
[ 1684.435331]  text_poke_queue+0x84/0xc0
[ 1684.435884]  ? text_poke_loc_init+0x5/0x140
[ 1684.436490]  ? text_poke_queue+0x84/0xc0
[ 1684.437086]  ftrace_replace_code+0xfd/0x170
[ 1684.437718]  ftrace_modify_all_code+0x1b1/0x270
[ 1684.438404]  arch_ftrace_update_code+0x9/0x10
[ 1684.439033]  ftrace_run_update_code+0x30/0xa0
[ 1684.439674]  ftrace_shutdown+0x2b8/0x4a0
[ 1684.440278]  unregister_ftrace_function+0x25/0x50
[ 1684.440958]  perf_ftrace_event_register+0x89/0xf0
[ 1684.441638]  ? perf_tp_event_init+0xa0/0xa0
[ 1684.442250]  perf_trace_destroy+0x37/0x60
[ 1684.442844]  tp_perf_event_destroy+0x15/0x20
[ 1684.443468]  _free_event+0xfc/0x7d0
[ 1684.444011]  put_event+0x37/0x50
[ 1684.444504]  perf_event_release_kernel+0x2f4/0x370
[ 1684.445225]  ? perf_event_release_kernel+0x370/0x370
[ 1684.445947]  perf_release+0x19/0x20
[ 1684.446473]  __fput+0x12d/0x460
[ 1684.446991]  ____fput+0x1a/0x20
[ 1684.447468]  task_work_run+0x8e/0xf0
[ 1684.448023]  do_exit+0x616/0x1310
[ 1684.448545]  ? write_comp_data+0x2f/0x90
[ 1684.449157]  do_group_exit+0x7e/0x130
[ 1684.449725]  get_signal+0x249/0x13c0
[ 1684.450278]  ? get_signal+0x5/0x13c0
[ 1684.450853]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1684.451589]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1684.452325]  exit_to_user_mode_prepare+0x154/0x240
[ 1684.453024]  syscall_exit_to_user_mode+0x2b/0x60
[ 1684.453696]  do_syscall_64+0x46/0x80
[ 1684.454232]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1684.454952] RIP: 0033:0x7fac0740459d
[ 1684.455474] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1684.456374] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1684.457428] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1684.458412] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1684.459393] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1684.460374] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1684.461355] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1684.462458] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1684.462565] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1684.463519] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1684.464581] caller is debug_smp_processor_id+0x1c/0x20
[ 1684.466031] Call Trace:
[ 1684.466046]  dump_stack_lvl+0xa4/0xd3
[ 1684.466069]  dump_stack+0x15/0x17
[ 1684.466084]  check_preemption_disabled+0x167/0x180
[ 1684.466102]  ? __mutex_lock+0x56/0x9f0
[ 1684.466117]  ? ___might_sleep+0x170/0x170
[ 1684.466136]  debug_smp_processor_id+0x1c/0x20
[ 1684.470265]  perf_ftrace_function_call+0x7c/0x360
[ 1684.470892]  ? perf_ftrace_function_call+0x4c/0x360
[ 1684.471546]  ? write_comp_data+0x2f/0x90
[ 1684.472074]  ? mutex_lock_nested+0x1b/0x20
[ 1684.472624]  ? mutex_lock_io_nested+0x940/0x940
[ 1684.473228]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1684.473853]  ? mutex_lock_nested+0x1b/0x20
[ 1684.474405]  ? perf_ftrace_function_call+0x4c/0x360
[ 1684.475055]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1684.475684]  ? ftrace_ops_test+0x71/0xc0
[ 1684.476228]  0xffffffffa009a099
[ 1684.476654]  ? 0xffffffffa009a099
[ 1684.477101]  ? trace_hardirqs_on+0x6a/0x170
[ 1684.477662]  ? write_comp_data+0x2f/0x90
[ 1684.478195]  ? perf_trace_buf_update+0x70/0x70
[ 1684.478792]  ? do_epoll_wait+0x3b3/0xd80
[ 1684.479330]  ? __might_sleep+0x5/0x70
[ 1684.479833]  __might_sleep+0x5/0x70
[ 1684.480307]  __mutex_lock+0x56/0x9f0
[ 1684.480792]  ? __might_sleep+0x5/0x70
[ 1684.481286]  ? __mutex_lock+0x56/0x9f0
[ 1684.481795]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1684.482512]  ? do_epoll_wait+0x3b3/0xd80
[ 1684.483042]  ? do_epoll_wait+0x3b3/0xd80
[ 1684.483577]  ? __mutex_lock+0x5/0x9f0
[ 1684.484084]  mutex_lock_nested+0x1b/0x20
[ 1684.484612]  ? __mutex_lock+0x5/0x9f0
[ 1684.485106]  ? mutex_lock_nested+0x1b/0x20
[ 1684.485656]  do_epoll_wait+0x3b3/0xd80
[ 1684.486199]  ? wait_woken+0x90/0x90
[ 1684.486688]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1684.487262]  do_syscall_64+0x37/0x80
[ 1684.487747]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1684.488418] RIP: 0033:0x7f8a39143b20
[ 1684.488901] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1684.491260] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1684.492240] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1684.493158] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1684.494083] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1684.495001] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1684.495918] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1684.496871] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1684.496920] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1684.497904] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1684.499016] caller is debug_smp_processor_id+0x1c/0x20
[ 1684.500538] Call Trace:
[ 1684.501563]  dump_stack_lvl+0xa4/0xd3
[ 1684.502128]  dump_stack+0x15/0x17
[ 1684.502636]  check_preemption_disabled+0x167/0x180
[ 1684.503360]  debug_smp_processor_id+0x1c/0x20
[ 1684.503997]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1684.504779]  perf_tp_event+0x331/0x4e0
[ 1684.505411]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1684.506258]  ? arch_local_irq_enable+0x10/0x12
[ 1684.506908]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1684.507598]  ? dump_stack_lvl+0xcc/0xd3
[ 1684.508178]  ? dump_stack+0x15/0x17
[ 1684.508711]  ? text_poke_queue+0x84/0xc0
[ 1684.509282]  ? cpumask_weight+0x20/0x20
[ 1684.509857]  perf_ftrace_function_call+0x248/0x360
[ 1684.510550]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1684.511196]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1684.511887]  ? perf_ftrace_function_call+0x248/0x360
[ 1684.512714]  ? 0xffffffffa009a099
[ 1684.513231]  ? pcie_portdrv_mmio_enabled+0x20/0x20
[ 1684.513945]  0xffffffffa009a099
[ 1684.514450]  ? ftrace_call+0x5/0x44
[ 1684.514999]  ? pcie_portdrv_mmio_enabled+0x20/0x20
[ 1684.515696]  ? text_poke_loc_init+0x5/0x140
[ 1684.516314]  ? pcie_portdrv_mmio_enabled+0x20/0x20
[ 1684.517005]  text_poke_loc_init+0x5/0x140
[ 1684.517592]  text_poke_queue+0x84/0xc0
[ 1684.518152]  ? text_poke_loc_init+0x5/0x140
[ 1684.518756]  ? text_poke_queue+0x84/0xc0
[ 1684.519352]  ftrace_replace_code+0xfd/0x170
[ 1684.519987]  ftrace_modify_all_code+0x1b1/0x270
[ 1684.520668]  arch_ftrace_update_code+0x9/0x10
[ 1684.521301]  ftrace_run_update_code+0x30/0xa0
[ 1684.521950]  ftrace_shutdown+0x2b8/0x4a0
[ 1684.522563]  unregister_ftrace_function+0x25/0x50
[ 1684.523247]  perf_ftrace_event_register+0x89/0xf0
[ 1684.523926]  ? perf_tp_event_init+0xa0/0xa0
[ 1684.524535]  perf_trace_destroy+0x37/0x60
[ 1684.525130]  tp_perf_event_destroy+0x15/0x20
[ 1684.525756]  _free_event+0xfc/0x7d0
[ 1684.526307]  put_event+0x37/0x50
[ 1684.526800]  perf_event_release_kernel+0x2f4/0x370
[ 1684.527524]  ? perf_event_release_kernel+0x370/0x370
[ 1684.528247]  perf_release+0x19/0x20
[ 1684.528770]  __fput+0x12d/0x460
[ 1684.529290]  ____fput+0x1a/0x20
[ 1684.529769]  task_work_run+0x8e/0xf0
[ 1684.530334]  do_exit+0x616/0x1310
[ 1684.530864]  ? write_comp_data+0x2f/0x90
[ 1684.531484]  do_group_exit+0x7e/0x130
[ 1684.532053]  get_signal+0x249/0x13c0
[ 1684.532608]  ? get_signal+0x5/0x13c0
[ 1684.533184]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1684.533923]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1684.534689]  exit_to_user_mode_prepare+0x154/0x240
[ 1684.535395]  syscall_exit_to_user_mode+0x2b/0x60
[ 1684.536073]  do_syscall_64+0x46/0x80
[ 1684.536608]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1684.537331] RIP: 0033:0x7fac0740459d
[ 1684.537854] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1684.538767] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1684.539820] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1684.540808] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1684.541790] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1684.542780] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1684.543760] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1684.544855] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1684.544977] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1684.545914] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1684.547161] caller is debug_smp_processor_id+0x1c/0x20
[ 1684.548517] Call Trace:
[ 1684.548526]  dump_stack_lvl+0xa4/0xd3
[ 1684.550099]  dump_stack+0x15/0x17
[ 1684.550552]  check_preemption_disabled+0x167/0x180
[ 1684.551189]  ? __might_sleep+0x48/0x70
[ 1684.551694]  ? sched_show_task+0x70/0x70
[ 1684.552225]  debug_smp_processor_id+0x1c/0x20
[ 1684.552808]  perf_ftrace_function_call+0x7c/0x360
[ 1684.553433]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1684.554063]  ? __mutex_lock+0x56/0x9f0
[ 1684.554572]  ? perf_ftrace_function_call+0x4c/0x360
[ 1684.555218]  ? perf_ftrace_function_call+0x4c/0x360
[ 1684.555868]  ? write_comp_data+0x2f/0x90
[ 1684.556394]  ? mutex_lock_nested+0x1b/0x20
[ 1684.556943]  ? mutex_lock_io_nested+0x940/0x940
[ 1684.557548]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1684.558179]  ? mutex_lock_nested+0x1b/0x20
[ 1684.558729]  ? perf_ftrace_function_call+0x4c/0x360
[ 1684.559378]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1684.560007]  ? ftrace_ops_test+0x71/0xc0
[ 1684.560545]  0xffffffffa009a099
[ 1684.560979]  ? 0xffffffffa009a099
[ 1684.561427]  ? trace_hardirqs_on+0x6a/0x170
[ 1684.561989]  ? do_epoll_wait+0x3b3/0xd80
[ 1684.562529]  ? ___might_sleep+0x5/0x170
[ 1684.563051]  ___might_sleep+0x5/0x170
[ 1684.563547]  __might_sleep+0x48/0x70
[ 1684.564051]  ? ___might_sleep+0x5/0x170
[ 1684.564572]  ? __might_sleep+0x48/0x70
[ 1684.565082]  __mutex_lock+0x56/0x9f0
[ 1684.565570]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1684.566287]  ? do_epoll_wait+0x3b3/0xd80
[ 1684.566816]  ? do_epoll_wait+0x3b3/0xd80
[ 1684.567349]  ? __mutex_lock+0x5/0x9f0
[ 1684.567855]  mutex_lock_nested+0x1b/0x20
[ 1684.568381]  ? __mutex_lock+0x5/0x9f0
[ 1684.568874]  ? mutex_lock_nested+0x1b/0x20
[ 1684.569425]  do_epoll_wait+0x3b3/0xd80
[ 1684.569957]  ? wait_woken+0x90/0x90
[ 1684.570446]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1684.571018]  do_syscall_64+0x37/0x80
[ 1684.571504]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1684.572172] RIP: 0033:0x7f8a39143b20
[ 1684.572653] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1684.575019] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1684.575999] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1684.576916] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1684.577833] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1684.578755] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1684.579672] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1684.580626] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1684.580657] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1684.581739] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1684.582839] caller is debug_smp_processor_id+0x1c/0x20
[ 1684.584464] Call Trace:
[ 1684.585529]  dump_stack_lvl+0xa4/0xd3
[ 1684.586166]  dump_stack+0x15/0x17
[ 1684.586719]  check_preemption_disabled+0x167/0x180
[ 1684.587478]  ? text_poke_loc_init+0x63/0x140
[ 1684.588152]  ? insn_get_length+0x90/0x90
[ 1684.588811]  debug_smp_processor_id+0x1c/0x20
[ 1684.589513]  perf_ftrace_function_call+0x7c/0x360
[ 1684.590299]  ? dump_stack+0x15/0x17
[ 1684.590908]  ? text_poke_queue+0x84/0xc0
[ 1684.591536]  ? cpumask_weight+0x20/0x20
[ 1684.592183]  ? perf_ftrace_function_call+0x248/0x360
[ 1684.592958]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1684.593667]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1684.594419]  ? text_poke_queue+0x84/0xc0
[ 1684.595056]  ? perf_ftrace_function_call+0x4c/0x360
[ 1684.595894]  ? pcie_portdrv_mmio_enabled+0x20/0x20
[ 1684.596667]  0xffffffffa009a099
[ 1684.597362]  ? insn_decode+0x5/0x170
[ 1684.597992]  insn_decode+0x5/0x170
[ 1684.598564]  text_poke_loc_init+0x63/0x140
[ 1684.599230]  ? insn_decode+0x5/0x170
[ 1684.599805]  ? text_poke_loc_init+0x63/0x140
[ 1684.600555]  ? pcie_portdrv_mmio_enabled+0x20/0x20
[ 1684.601323]  ? text_poke_loc_init+0x5/0x140
[ 1684.602030]  ? pcie_portdrv_mmio_enabled+0x20/0x20
[ 1684.602845]  text_poke_queue+0x84/0xc0
[ 1684.603510]  ftrace_replace_code+0xfd/0x170
[ 1684.604238]  ftrace_modify_all_code+0x1b1/0x270
[ 1684.605006]  arch_ftrace_update_code+0x9/0x10
[ 1684.605706]  ftrace_run_update_code+0x30/0xa0
[ 1684.606439]  ftrace_shutdown+0x2b8/0x4a0
[ 1684.607138]  unregister_ftrace_function+0x25/0x50
[ 1684.607896]  perf_ftrace_event_register+0x89/0xf0
[ 1684.608644]  ? perf_tp_event_init+0xa0/0xa0
[ 1684.609318]  perf_trace_destroy+0x37/0x60
[ 1684.609979]  tp_perf_event_destroy+0x15/0x20
[ 1684.610683]  _free_event+0xfc/0x7d0
[ 1684.611314]  put_event+0x37/0x50
[ 1684.611877]  perf_event_release_kernel+0x2f4/0x370
[ 1684.612703]  ? perf_event_release_kernel+0x370/0x370
[ 1684.613504]  perf_release+0x19/0x20
[ 1684.614098]  __fput+0x12d/0x460
[ 1684.614729]  ____fput+0x1a/0x20
[ 1684.615269]  task_work_run+0x8e/0xf0
[ 1684.615910]  do_exit+0x616/0x1310
[ 1684.616518]  ? write_comp_data+0x2f/0x90
[ 1684.617230]  do_group_exit+0x7e/0x130
[ 1684.617887]  get_signal+0x249/0x13c0
[ 1684.618529]  ? get_signal+0x5/0x13c0
[ 1684.619214]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1684.620081]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1684.620939]  exit_to_user_mode_prepare+0x154/0x240
[ 1684.621726]  syscall_exit_to_user_mode+0x2b/0x60
[ 1684.622485]  do_syscall_64+0x46/0x80
[ 1684.623084]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1684.623876] RIP: 0033:0x7fac0740459d
[ 1684.624459] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1684.625436] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1684.626597] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1684.627665] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1684.628733] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1684.629800] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1684.630875] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1684.632168] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1684.632279] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1684.633241] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1684.634498] caller is debug_smp_processor_id+0x1c/0x20
[ 1684.635869] Call Trace:
[ 1684.635878]  dump_stack_lvl+0xa4/0xd3
[ 1684.637453]  dump_stack+0x15/0x17
[ 1684.637906]  check_preemption_disabled+0x167/0x180
[ 1684.638557]  ? __mutex_lock+0x7b/0x9f0
[ 1684.639062]  ? trace_sched_waking+0xc0/0xc0
[ 1684.639626]  debug_smp_processor_id+0x1c/0x20
[ 1684.640210]  perf_ftrace_function_call+0x7c/0x360
[ 1684.640835]  ? perf_ftrace_function_call+0x4c/0x360
[ 1684.641485]  ? write_comp_data+0x2f/0x90
[ 1684.642013]  ? mutex_lock_nested+0x1b/0x20
[ 1684.642566]  ? mutex_lock_io_nested+0x940/0x940
[ 1684.643187]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1684.643813]  ? mutex_lock_nested+0x1b/0x20
[ 1684.644363]  ? perf_ftrace_function_call+0x4c/0x360
[ 1684.645015]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1684.645645]  ? ftrace_ops_test+0x71/0xc0
[ 1684.646195]  0xffffffffa009a099
[ 1684.646626]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1684.647255]  ? lock_is_held_type+0xe2/0x140
[ 1684.647819]  ? do_epoll_wait+0x3b3/0xd80
[ 1684.648358]  ? preempt_count_add+0x5/0xc0
[ 1684.648904]  preempt_count_add+0x5/0xc0
[ 1684.649420]  __mutex_lock+0x7b/0x9f0
[ 1684.649906]  ? preempt_count_add+0x5/0xc0
[ 1684.650446]  ? __mutex_lock+0x7b/0x9f0
[ 1684.650955]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1684.651668]  ? do_epoll_wait+0x3b3/0xd80
[ 1684.652197]  ? do_epoll_wait+0x3b3/0xd80
[ 1684.652731]  ? __mutex_lock+0x5/0x9f0
[ 1684.653238]  mutex_lock_nested+0x1b/0x20
[ 1684.653767]  ? __mutex_lock+0x5/0x9f0
[ 1684.654265]  ? mutex_lock_nested+0x1b/0x20
[ 1684.654817]  do_epoll_wait+0x3b3/0xd80
[ 1684.655352]  ? wait_woken+0x90/0x90
[ 1684.655839]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1684.656413]  do_syscall_64+0x37/0x80
[ 1684.656899]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1684.657568] RIP: 0033:0x7f8a39143b20
[ 1684.658053] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1684.660419] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1684.661399] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1684.662322] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1684.663240] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1684.664161] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1684.665082] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1684.666056] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1684.666074] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1684.667179] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1684.668261] caller is debug_smp_processor_id+0x1c/0x20
[ 1684.669909] Call Trace:
[ 1684.670989]  dump_stack_lvl+0xa4/0xd3
[ 1684.671627]  dump_stack+0x15/0x17
[ 1684.672182]  check_preemption_disabled+0x167/0x180
[ 1684.673002]  debug_smp_processor_id+0x1c/0x20
[ 1684.673704]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1684.674610]  perf_trace_buf_alloc+0x3d/0x100
[ 1684.675301]  ? text_poke_loc_init+0x63/0x140
[ 1684.675980]  ? insn_get_length+0x90/0x90
[ 1684.676629]  perf_ftrace_function_call+0x209/0x360
[ 1684.677602]  ? 0xffffffffa009a099
[ 1684.678241]  ? pcie_portdrv_mmio_enabled+0x20/0x20
[ 1684.679017]  0xffffffffa009a099
[ 1684.679716]  ? insn_decode+0x5/0x170
[ 1684.680348]  insn_decode+0x5/0x170
[ 1684.680915]  text_poke_loc_init+0x63/0x140
[ 1684.681581]  ? insn_decode+0x5/0x170
[ 1684.682164]  ? text_poke_loc_init+0x63/0x140
[ 1684.682916]  ? pcie_portdrv_mmio_enabled+0x20/0x20
[ 1684.683692]  ? text_poke_loc_init+0x5/0x140
[ 1684.684402]  ? pcie_portdrv_mmio_enabled+0x20/0x20
[ 1684.685210]  text_poke_queue+0x84/0xc0
[ 1684.685872]  ftrace_replace_code+0xfd/0x170
[ 1684.686606]  ftrace_modify_all_code+0x1b1/0x270
[ 1684.687375]  arch_ftrace_update_code+0x9/0x10
[ 1684.688077]  ftrace_run_update_code+0x30/0xa0
[ 1684.688801]  ftrace_shutdown+0x2b8/0x4a0
[ 1684.689508]  unregister_ftrace_function+0x25/0x50
[ 1684.690271]  perf_ftrace_event_register+0x89/0xf0
[ 1684.691015]  ? perf_tp_event_init+0xa0/0xa0
[ 1684.691687]  perf_trace_destroy+0x37/0x60
[ 1684.692353]  tp_perf_event_destroy+0x15/0x20
[ 1684.693052]  _free_event+0xfc/0x7d0
[ 1684.693686]  put_event+0x37/0x50
[ 1684.694256]  perf_event_release_kernel+0x2f4/0x370
[ 1684.695083]  ? perf_event_release_kernel+0x370/0x370
[ 1684.695890]  perf_release+0x19/0x20
[ 1684.696479]  __fput+0x12d/0x460
[ 1684.697105]  ____fput+0x1a/0x20
[ 1684.697647]  task_work_run+0x8e/0xf0
[ 1684.698301]  do_exit+0x616/0x1310
[ 1684.698910]  ? write_comp_data+0x2f/0x90
[ 1684.699636]  do_group_exit+0x7e/0x130
[ 1684.700295]  get_signal+0x249/0x13c0
[ 1684.700935]  ? get_signal+0x5/0x13c0
[ 1684.701623]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1684.702524]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1684.703388]  exit_to_user_mode_prepare+0x154/0x240
[ 1684.704171]  syscall_exit_to_user_mode+0x2b/0x60
[ 1684.704927]  do_syscall_64+0x46/0x80
[ 1684.705529]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1684.706341] RIP: 0033:0x7fac0740459d
[ 1684.706940] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1684.707917] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1684.709070] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1684.710140] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1684.711205] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1684.712271] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1684.713337] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1684.714641] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1684.714755] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1684.715707] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1684.716764] caller is debug_smp_processor_id+0x1c/0x20
[ 1684.718211] Call Trace:
[ 1684.718220]  dump_stack_lvl+0xa4/0xd3
[ 1684.718242]  dump_stack+0x15/0x17
[ 1684.718257]  check_preemption_disabled+0x167/0x180
[ 1684.718275]  ? do_epoll_wait+0x3bf/0xd80
[ 1684.718292]  ? __ia32_sys_fanotify_init+0x5c0/0x5c0
[ 1684.718313]  debug_smp_processor_id+0x1c/0x20
[ 1684.722574]  perf_ftrace_function_call+0x7c/0x360
[ 1684.723208]  ? 0xffffffffa009a099
[ 1684.723669]  ? do_epoll_wait+0x3b3/0xd80
[ 1684.724205]  ? preempt_count_sub+0x5/0xa0
[ 1684.724754]  0xffffffffa009a099
[ 1684.725190]  ? __mutex_lock+0xfe/0x9f0
[ 1684.725699]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1684.726419]  ? do_epoll_wait+0x3b3/0xd80
[ 1684.726955]  ? ep_start_scan+0x5/0x100
[ 1684.727468]  ep_start_scan+0x5/0x100
[ 1684.727953]  do_epoll_wait+0x3bf/0xd80
[ 1684.728460]  ? ep_start_scan+0x5/0x100
[ 1684.728964]  ? do_epoll_wait+0x3bf/0xd80
[ 1684.729518]  ? wait_woken+0x90/0x90
[ 1684.730002]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1684.730577]  do_syscall_64+0x37/0x80
[ 1684.731062]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1684.731729] RIP: 0033:0x7f8a39143b20
[ 1684.732207] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1684.734573] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1684.735550] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1684.736464] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1684.737432] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1684.738361] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1684.739274] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1684.740223] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1684.741273] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1684.742839] Call Trace:
[ 1684.743221]  dump_stack_lvl+0xa4/0xd3
[ 1684.743781]  dump_stack+0x15/0x17
[ 1684.744279]  check_preemption_disabled+0x167/0x180
[ 1684.744997]  debug_smp_processor_id+0x1c/0x20
[ 1684.745633]  perf_trace_buf_alloc+0x98/0x100
[ 1684.746264]  ? text_poke_loc_init+0x63/0x140
[ 1684.746880]  ? insn_get_length+0x90/0x90
[ 1684.747461]  perf_ftrace_function_call+0x209/0x360
[ 1684.748256]  ? 0xffffffffa009a099
[ 1684.748789]  ? pcie_portdrv_mmio_enabled+0x20/0x20
[ 1684.749487]  0xffffffffa009a099
[ 1684.750043]  ? insn_decode+0x5/0x170
[ 1684.750597]  insn_decode+0x5/0x170
[ 1684.751103]  text_poke_loc_init+0x63/0x140
[ 1684.751703]  ? insn_decode+0x5/0x170
[ 1684.752226]  ? text_poke_loc_init+0x63/0x140
[ 1684.752879]  ? pcie_portdrv_mmio_enabled+0x20/0x20
[ 1684.753579]  ? text_poke_loc_init+0x5/0x140
[ 1684.754209]  ? pcie_portdrv_mmio_enabled+0x20/0x20
[ 1684.754924]  text_poke_queue+0x84/0xc0
[ 1684.755501]  ftrace_replace_code+0xfd/0x170
[ 1684.756138]  ftrace_modify_all_code+0x1b1/0x270
[ 1684.756817]  arch_ftrace_update_code+0x9/0x10
[ 1684.757451]  ftrace_run_update_code+0x30/0xa0
[ 1684.758099]  ftrace_shutdown+0x2b8/0x4a0
[ 1684.758708]  unregister_ftrace_function+0x25/0x50
[ 1684.759394]  perf_ftrace_event_register+0x89/0xf0
[ 1684.760076]  ? perf_tp_event_init+0xa0/0xa0
[ 1684.760690]  perf_trace_destroy+0x37/0x60
[ 1684.761355]  tp_perf_event_destroy+0x15/0x20
[ 1684.761988]  _free_event+0xfc/0x7d0
[ 1684.762540]  put_event+0x37/0x50
[ 1684.763037]  perf_event_release_kernel+0x2f4/0x370
[ 1684.763758]  ? perf_event_release_kernel+0x370/0x370
[ 1684.764481]  perf_release+0x19/0x20
[ 1684.765003]  __fput+0x12d/0x460
[ 1684.765525]  ____fput+0x1a/0x20
[ 1684.766003]  task_work_run+0x8e/0xf0
[ 1684.766566]  do_exit+0x616/0x1310
[ 1684.767091]  ? write_comp_data+0x2f/0x90
[ 1684.767705]  do_group_exit+0x7e/0x130
[ 1684.768276]  get_signal+0x249/0x13c0
[ 1684.768827]  ? get_signal+0x5/0x13c0
[ 1684.769404]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1684.770145]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1684.770884]  exit_to_user_mode_prepare+0x154/0x240
[ 1684.771586]  syscall_exit_to_user_mode+0x2b/0x60
[ 1684.772260]  do_syscall_64+0x46/0x80
[ 1684.772795]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1684.773517] RIP: 0033:0x7fac0740459d
[ 1684.774047] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1684.774952] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1684.776010] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1684.776997] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1684.777986] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1684.778980] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1684.779966] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1689.378055] check_preemption_disabled: 1579960 callbacks suppressed
[ 1689.378080] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1689.378150] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1689.378895] caller is debug_smp_processor_id+0x1c/0x20
[ 1689.379758] caller is debug_smp_processor_id+0x1c/0x20
[ 1689.380697] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1689.382734] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1689.384062] Call Trace:
[ 1689.384386]  dump_stack_lvl+0xa4/0xd3
[ 1689.384869]  dump_stack+0x15/0x17
[ 1689.385298]  check_preemption_disabled+0x167/0x180
[ 1689.385921]  debug_smp_processor_id+0x1c/0x20
[ 1689.386475]  perf_trace_buf_alloc+0x98/0x100
[ 1689.387013]  ? text_poke+0x2b/0x60
[ 1689.387445]  ? do_sync_core+0x30/0x30
[ 1689.387915]  perf_ftrace_function_call+0x209/0x360
[ 1689.388608]  ? 0xffffffffa009a099
[ 1689.389056]  ? device_initial_probe+0x30/0x30
[ 1689.389624]  0xffffffffa009a099
[ 1689.390063]  ? _raw_spin_unlock+0x2c/0x50
[ 1689.390607]  ? device_initial_probe+0x30/0x30
[ 1689.391152]  ? __text_poke+0x5/0x4e0
[ 1689.391609]  ? lock_is_held_type+0xe2/0x140
[ 1689.392146]  __text_poke+0x5/0x4e0
[ 1689.392582]  text_poke+0x2b/0x60
[ 1689.392999]  ? __text_poke+0x5/0x4e0
[ 1689.393450]  ? text_poke+0x2b/0x60
[ 1689.393902]  text_poke_bp_batch+0x93/0x2c0
[ 1689.394447]  ? fwnode_property_read_string_array+0x130/0x130
[ 1689.395158]  text_poke_queue+0xa7/0xc0
[ 1689.395656]  ftrace_replace_code+0xfd/0x170
[ 1689.396207]  ftrace_modify_all_code+0x1b1/0x270
[ 1689.396791]  arch_ftrace_update_code+0x9/0x10
[ 1689.397341]  ftrace_run_update_code+0x30/0xa0
[ 1689.397897]  ftrace_shutdown+0x2b8/0x4a0
[ 1689.398430]  unregister_ftrace_function+0x25/0x50
[ 1689.399018]  perf_ftrace_event_register+0x89/0xf0
[ 1689.399603]  ? perf_tp_event_init+0xa0/0xa0
[ 1689.400131]  perf_trace_destroy+0x37/0x60
[ 1689.400644]  tp_perf_event_destroy+0x15/0x20
[ 1689.401186]  _free_event+0xfc/0x7d0
[ 1689.401658]  put_event+0x37/0x50
[ 1689.402092]  perf_event_release_kernel+0x2f4/0x370
[ 1689.402716]  ? perf_event_release_kernel+0x370/0x370
[ 1689.403338]  perf_release+0x19/0x20
[ 1689.403789]  __fput+0x12d/0x460
[ 1689.404243]  ____fput+0x1a/0x20
[ 1689.404656]  task_work_run+0x8e/0xf0
[ 1689.405140]  do_exit+0x616/0x1310
[ 1689.405619]  ? write_comp_data+0x2f/0x90
[ 1689.406181]  do_group_exit+0x7e/0x130
[ 1689.406699]  get_signal+0x249/0x13c0
[ 1689.407197]  ? get_signal+0x5/0x13c0
[ 1689.407700]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1689.408339]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1689.408981]  exit_to_user_mode_prepare+0x154/0x240
[ 1689.409584]  syscall_exit_to_user_mode+0x2b/0x60
[ 1689.410173]  do_syscall_64+0x46/0x80
[ 1689.410635]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1689.411257] RIP: 0033:0x7fac0740459d
[ 1689.411730] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1689.412587] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1689.413592] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1689.414533] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1689.415471] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1689.416407] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1689.417344] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1689.418394] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1689.418510] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1689.419340] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1689.420348] caller is debug_smp_processor_id+0x1c/0x20
[ 1689.421704] Call Trace:
[ 1689.422694]  dump_stack_lvl+0xa4/0xd3
[ 1689.423168]  dump_stack+0x15/0x17
[ 1689.423593]  check_preemption_disabled+0x167/0x180
[ 1689.424193]  ? schedule_timeout+0x34e/0x610
[ 1689.424719]  ? do_init_timer+0xa0/0xa0
[ 1689.425199]  debug_smp_processor_id+0x1c/0x20
[ 1689.425747]  perf_ftrace_function_call+0x7c/0x360
[ 1689.426346]  ? 0xffffffffa009a099
[ 1689.426770]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1689.427372]  ? finish_task_switch+0xab/0x2a0
[ 1689.427907]  ? __schedule+0x46e/0xb20
[ 1689.428389]  0xffffffffa009a099
[ 1689.428793]  ? finish_task_switch+0xb0/0x2a0
[ 1689.429346]  ? del_timer_sync+0x5/0x130
[ 1689.429840]  del_timer_sync+0x5/0x130
[ 1689.430309]  schedule_timeout+0x34e/0x610
[ 1689.430817]  ? del_timer_sync+0x5/0x130
[ 1689.431302]  ? schedule_timeout+0x34e/0x610
[ 1689.431839]  ? del_timer_sync+0x130/0x130
[ 1689.432353]  ? i915_init_ggtt+0x40/0x6b0
[ 1689.432861]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1689.433369]  ? rcu_gp_init+0x730/0x730
[ 1689.433845]  rcu_gp_kthread+0xdd/0x170
[ 1689.434333]  kthread+0x1e7/0x230
[ 1689.434752]  ? set_kthread_struct+0x80/0x80
[ 1689.435284]  ret_from_fork+0x1f/0x30
[ 1689.435774] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1689.435806] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1689.436760] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1689.437722] caller is debug_smp_processor_id+0x1c/0x20
[ 1689.439190] Call Trace:
[ 1689.439211]  dump_stack_lvl+0xa4/0xd3
[ 1689.440677]  dump_stack+0x15/0x17
[ 1689.441149]  check_preemption_disabled+0x167/0x180
[ 1689.441835]  debug_smp_processor_id+0x1c/0x20
[ 1689.442445]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1689.443190]  perf_tp_event+0x331/0x4e0
[ 1689.443796]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1689.444597]  ? arch_local_irq_enable+0x10/0x12
[ 1689.445210]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1689.445868]  ? dump_stack_lvl+0xcc/0xd3
[ 1689.446425]  ? dump_stack+0x15/0x17
[ 1689.446920]  ? check_preemption_disabled+0x167/0x180
[ 1689.447611]  ? text_poke+0x2b/0x60
[ 1689.448088]  ? do_sync_core+0x30/0x30
[ 1689.448615]  perf_ftrace_function_call+0x248/0x360
[ 1689.449275]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1689.449922]  ? perf_ftrace_function_call+0x248/0x360
[ 1689.450717]  ? 0xffffffffa009a099
[ 1689.451211]  ? device_initial_probe+0x30/0x30
[ 1689.451836]  0xffffffffa009a099
[ 1689.452315]  ? _raw_spin_unlock+0x2c/0x50
[ 1689.452909]  ? device_initial_probe+0x30/0x30
[ 1689.453512]  ? __text_poke+0x5/0x4e0
[ 1689.454017]  ? lock_is_held_type+0xe2/0x140
[ 1689.454613]  __text_poke+0x5/0x4e0
[ 1689.455097]  text_poke+0x2b/0x60
[ 1689.455558]  ? __text_poke+0x5/0x4e0
[ 1689.456058]  ? text_poke+0x2b/0x60
[ 1689.456557]  text_poke_bp_batch+0x93/0x2c0
[ 1689.457149]  ? fwnode_property_read_string_array+0x130/0x130
[ 1689.457937]  text_poke_queue+0xa7/0xc0
[ 1689.458491]  ftrace_replace_code+0xfd/0x170
[ 1689.459099]  ftrace_modify_all_code+0x1b1/0x270
[ 1689.459746]  arch_ftrace_update_code+0x9/0x10
[ 1689.460349]  ftrace_run_update_code+0x30/0xa0
[ 1689.460963]  ftrace_shutdown+0x2b8/0x4a0
[ 1689.461544]  unregister_ftrace_function+0x25/0x50
[ 1689.462202]  perf_ftrace_event_register+0x89/0xf0
[ 1689.462852]  ? perf_tp_event_init+0xa0/0xa0
[ 1689.463432]  perf_trace_destroy+0x37/0x60
[ 1689.463999]  tp_perf_event_destroy+0x15/0x20
[ 1689.464599]  _free_event+0xfc/0x7d0
[ 1689.465120]  put_event+0x37/0x50
[ 1689.465592]  perf_event_release_kernel+0x2f4/0x370
[ 1689.466286]  ? perf_event_release_kernel+0x370/0x370
[ 1689.466978]  perf_release+0x19/0x20
[ 1689.467479]  __fput+0x12d/0x460
[ 1689.467979]  ____fput+0x1a/0x20
[ 1689.468436]  task_work_run+0x8e/0xf0
[ 1689.468971]  do_exit+0x616/0x1310
[ 1689.469473]  ? write_comp_data+0x2f/0x90
[ 1689.470064]  do_group_exit+0x7e/0x130
[ 1689.470610]  get_signal+0x249/0x13c0
[ 1689.471135]  ? get_signal+0x5/0x13c0
[ 1689.471688]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1689.472394]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1689.473100]  exit_to_user_mode_prepare+0x154/0x240
[ 1689.473769]  syscall_exit_to_user_mode+0x2b/0x60
[ 1689.474416]  do_syscall_64+0x46/0x80
[ 1689.474928]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1689.475619] RIP: 0033:0x7fac0740459d
[ 1689.476120] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1689.476977] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1689.477985] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1689.478924] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1689.479861] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1689.480798] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1689.481737] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1689.482791] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1689.482899] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1689.483731] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1689.484826] caller is debug_smp_processor_id+0x1c/0x20
[ 1689.486179] Call Trace:
[ 1689.486188]  dump_stack_lvl+0xa4/0xd3
[ 1689.486209]  dump_stack+0x15/0x17
[ 1689.486224]  check_preemption_disabled+0x167/0x180
[ 1689.486242]  ? del_timer_sync+0xd3/0x130
[ 1689.486257]  ? detach_if_pending+0x270/0x270
[ 1689.486278]  debug_smp_processor_id+0x1c/0x20
[ 1689.490277]  perf_ftrace_function_call+0x7c/0x360
[ 1689.490864]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1689.491458]  ? register_lock_class+0x42/0x440
[ 1689.492012]  ? del_timer_sync+0x40/0x130
[ 1689.492513]  ? 0xffffffffa009a099
[ 1689.492938]  ? 0xffffffffa009a099
[ 1689.493363]  ? 0xffffffffa009a099
[ 1689.493798]  0xffffffffa009a099
[ 1689.494204]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1689.494804]  ? del_timer_sync+0xa5/0x130
[ 1689.495306]  ? try_to_del_timer_sync+0x5/0x90
[ 1689.495853]  ? write_comp_data+0x2f/0x90
[ 1689.496351]  try_to_del_timer_sync+0x5/0x90
[ 1689.496878]  del_timer_sync+0xd3/0x130
[ 1689.497354]  ? try_to_del_timer_sync+0x5/0x90
[ 1689.497900]  ? del_timer_sync+0xd3/0x130
[ 1689.498405]  schedule_timeout+0x34e/0x610
[ 1689.498920]  ? del_timer_sync+0x130/0x130
[ 1689.499434]  ? i915_init_ggtt+0x40/0x6b0
[ 1689.499941]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1689.500446]  ? rcu_gp_init+0x730/0x730
[ 1689.500921]  rcu_gp_kthread+0xdd/0x170
[ 1689.501404]  kthread+0x1e7/0x230
[ 1689.501821]  ? set_kthread_struct+0x80/0x80
[ 1689.502358]  ret_from_fork+0x1f/0x30
[ 1689.502848] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1689.502875] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1689.503920] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1689.504880] caller is debug_smp_processor_id+0x1c/0x20
[ 1689.506461] Call Trace:
[ 1689.506496]  dump_stack_lvl+0xa4/0xd3
[ 1689.508050]  dump_stack+0x15/0x17
[ 1689.508582]  check_preemption_disabled+0x167/0x180
[ 1689.509314]  ? __text_poke+0xea/0x4e0
[ 1689.509881]  ? __pmd_alloc+0x420/0x420
[ 1689.510504]  debug_smp_processor_id+0x1c/0x20
[ 1689.511178]  perf_ftrace_function_call+0x7c/0x360
[ 1689.511919]  ? text_poke+0x2b/0x60
[ 1689.512453]  ? do_sync_core+0x30/0x30
[ 1689.513055]  ? perf_ftrace_function_call+0x248/0x360
[ 1689.513811]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1689.514532]  ? text_poke+0x2b/0x60
[ 1689.515075]  ? perf_ftrace_function_call+0x4c/0x360
[ 1689.515949]  ? device_initial_probe+0x30/0x30
[ 1689.516643]  0xffffffffa009a099
[ 1689.517169]  ? 0xffffffffa009a099
[ 1689.517832]  ? __get_locked_pte+0x5/0x290
[ 1689.518504]  __get_locked_pte+0x5/0x290
[ 1689.519107]  __text_poke+0xea/0x4e0
[ 1689.519662]  ? __get_locked_pte+0x5/0x290
[ 1689.520275]  ? __text_poke+0xea/0x4e0
[ 1689.520853]  ? device_initial_probe+0x30/0x30
[ 1689.521550]  ? lock_is_held_type+0xe2/0x140
[ 1689.522220]  ? device_initial_probe+0x30/0x30
[ 1689.522936]  text_poke+0x2b/0x60
[ 1689.523488]  text_poke_bp_batch+0x93/0x2c0
[ 1689.524169]  ? fwnode_property_read_string_array+0x130/0x130
[ 1689.525060]  text_poke_queue+0xa7/0xc0
[ 1689.525696]  ftrace_replace_code+0xfd/0x170
[ 1689.526403]  ftrace_modify_all_code+0x1b1/0x270
[ 1689.527142]  arch_ftrace_update_code+0x9/0x10
[ 1689.527815]  ftrace_run_update_code+0x30/0xa0
[ 1689.528510]  ftrace_shutdown+0x2b8/0x4a0
[ 1689.529187]  unregister_ftrace_function+0x25/0x50
[ 1689.529918]  perf_ftrace_event_register+0x89/0xf0
[ 1689.530643]  ? perf_tp_event_init+0xa0/0xa0
[ 1689.531293]  perf_trace_destroy+0x37/0x60
[ 1689.531932]  tp_perf_event_destroy+0x15/0x20
[ 1689.532604]  _free_event+0xfc/0x7d0
[ 1689.533212]  put_event+0x37/0x50
[ 1689.533758]  perf_event_release_kernel+0x2f4/0x370
[ 1689.534562]  ? perf_event_release_kernel+0x370/0x370
[ 1689.535336]  perf_release+0x19/0x20
[ 1689.535901]  __fput+0x12d/0x460
[ 1689.536507]  ____fput+0x1a/0x20
[ 1689.537027]  task_work_run+0x8e/0xf0
[ 1689.537648]  do_exit+0x616/0x1310
[ 1689.538244]  ? write_comp_data+0x2f/0x90
[ 1689.538932]  do_group_exit+0x7e/0x130
[ 1689.539566]  get_signal+0x249/0x13c0
[ 1689.540175]  ? get_signal+0x5/0x13c0
[ 1689.540841]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1689.541684]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1689.542545]  exit_to_user_mode_prepare+0x154/0x240
[ 1689.543300]  syscall_exit_to_user_mode+0x2b/0x60
[ 1689.544025]  do_syscall_64+0x46/0x80
[ 1689.544602]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1689.545360] RIP: 0033:0x7fac0740459d
[ 1689.545919] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1689.546866] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1689.547970] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1689.548990] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1689.550010] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1689.551051] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1689.552076] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1689.553325] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1689.553437] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1689.554281] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1689.554293] Call Trace:
[ 1689.554301]  dump_stack_lvl+0xa4/0xd3
[ 1689.554322]  dump_stack+0x15/0x17
[ 1689.554337]  check_preemption_disabled+0x167/0x180
[ 1689.554355]  ? try_to_del_timer_sync+0x33/0x90
[ 1689.554371]  ? calc_wheel_index+0x2d0/0x2d0
[ 1689.555465] caller is debug_smp_processor_id+0x1c/0x20
[ 1689.556817]  debug_smp_processor_id+0x1c/0x20
[ 1689.560808]  perf_ftrace_function_call+0x7c/0x360
[ 1689.561396]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1689.561983]  ? del_timer_sync+0xd3/0x130
[ 1689.562487]  ? perf_ftrace_function_call+0x4c/0x360
[ 1689.563092]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1689.563685]  ? register_lock_class+0x42/0x440
[ 1689.564235]  ? del_timer_sync+0x40/0x130
[ 1689.564733]  ? 0xffffffffa009a099
[ 1689.565189]  ? 0xffffffffa009a099
[ 1689.565640]  0xffffffffa009a099
[ 1689.566062]  ? 0xffffffffa009a099
[ 1689.566488]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1689.567077]  ? del_timer_sync+0xa5/0x130
[ 1689.567577]  ? lock_timer_base+0x5/0x100
[ 1689.568077]  lock_timer_base+0x5/0x100
[ 1689.568551]  try_to_del_timer_sync+0x33/0x90
[ 1689.569085]  ? lock_timer_base+0x5/0x100
[ 1689.569578]  ? try_to_del_timer_sync+0x33/0x90
[ 1689.570148]  ? try_to_del_timer_sync+0x5/0x90
[ 1689.570706]  del_timer_sync+0xd3/0x130
[ 1689.571199]  schedule_timeout+0x34e/0x610
[ 1689.571716]  ? del_timer_sync+0x130/0x130
[ 1689.572228]  ? i915_init_ggtt+0x40/0x6b0
[ 1689.572734]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1689.573239]  ? rcu_gp_init+0x730/0x730
[ 1689.573712]  rcu_gp_kthread+0xdd/0x170
[ 1689.574207]  kthread+0x1e7/0x230
[ 1689.574624]  ? set_kthread_struct+0x80/0x80
[ 1689.575156]  ret_from_fork+0x1f/0x30
[ 1689.575645] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1689.575678] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1689.576727] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1689.577686] caller is debug_smp_processor_id+0x1c/0x20
[ 1689.579382] Call Trace:
[ 1689.579418]  dump_stack_lvl+0xa4/0xd3
[ 1689.580980]  dump_stack+0x15/0x17
[ 1689.581514]  check_preemption_disabled+0x167/0x180
[ 1689.582325]  debug_smp_processor_id+0x1c/0x20
[ 1689.583052]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1689.583943]  perf_trace_buf_alloc+0x3d/0x100
[ 1689.584609]  ? __text_poke+0xea/0x4e0
[ 1689.585179]  ? __pmd_alloc+0x420/0x420
[ 1689.585784]  perf_ftrace_function_call+0x209/0x360
[ 1689.586741]  ? 0xffffffffa009a099
[ 1689.587346]  ? device_initial_probe+0x30/0x30
[ 1689.588050]  0xffffffffa009a099
[ 1689.588581]  ? 0xffffffffa009a099
[ 1689.589259]  ? __get_locked_pte+0x5/0x290
[ 1689.589932]  __get_locked_pte+0x5/0x290
[ 1689.590542]  __text_poke+0xea/0x4e0
[ 1689.591098]  ? __get_locked_pte+0x5/0x290
[ 1689.591713]  ? __text_poke+0xea/0x4e0
[ 1689.592292]  ? device_initial_probe+0x30/0x30
[ 1689.592989]  ? lock_is_held_type+0xe2/0x140
[ 1689.593651]  ? device_initial_probe+0x30/0x30
[ 1689.594379]  text_poke+0x2b/0x60
[ 1689.594934]  text_poke_bp_batch+0x93/0x2c0
[ 1689.595618]  ? fwnode_property_read_string_array+0x130/0x130
[ 1689.596513]  text_poke_queue+0xa7/0xc0
[ 1689.597150]  ftrace_replace_code+0xfd/0x170
[ 1689.597855]  ftrace_modify_all_code+0x1b1/0x270
[ 1689.598604]  arch_ftrace_update_code+0x9/0x10
[ 1689.599281]  ftrace_run_update_code+0x30/0xa0
[ 1689.599979]  ftrace_shutdown+0x2b8/0x4a0
[ 1689.600658]  unregister_ftrace_function+0x25/0x50
[ 1689.601390]  perf_ftrace_event_register+0x89/0xf0
[ 1689.602121]  ? perf_tp_event_init+0xa0/0xa0
[ 1689.602772]  perf_trace_destroy+0x37/0x60
[ 1689.603412]  tp_perf_event_destroy+0x15/0x20
[ 1689.604085]  _free_event+0xfc/0x7d0
[ 1689.604697]  put_event+0x37/0x50
[ 1689.605242]  perf_event_release_kernel+0x2f4/0x370
[ 1689.606044]  ? perf_event_release_kernel+0x370/0x370
[ 1689.606831]  perf_release+0x19/0x20
[ 1689.607399]  __fput+0x12d/0x460
[ 1689.608008]  ____fput+0x1a/0x20
[ 1689.608530]  task_work_run+0x8e/0xf0
[ 1689.609161]  do_exit+0x616/0x1310
[ 1689.609751]  ? write_comp_data+0x2f/0x90
[ 1689.610454]  do_group_exit+0x7e/0x130
[ 1689.611092]  get_signal+0x249/0x13c0
[ 1689.611705]  ? get_signal+0x5/0x13c0
[ 1689.612370]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1689.613210]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1689.614043]  exit_to_user_mode_prepare+0x154/0x240
[ 1689.614805]  syscall_exit_to_user_mode+0x2b/0x60
[ 1689.615534]  do_syscall_64+0x46/0x80
[ 1689.616114]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1689.616876] RIP: 0033:0x7fac0740459d
[ 1689.617442] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1689.618386] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1689.619495] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1689.620519] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1689.621544] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1689.622585] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1689.623617] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1689.624874] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1689.624986] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1689.625823] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1689.626937] caller is debug_smp_processor_id+0x1c/0x20
[ 1689.628202] Call Trace:
[ 1689.629184]  dump_stack_lvl+0xa4/0xd3
[ 1689.629657]  dump_stack+0x15/0x17
[ 1689.630087]  check_preemption_disabled+0x167/0x180
[ 1689.630689]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1689.631203]  ? prepare_to_swait_exclusive+0x90/0x90
[ 1689.631818]  debug_smp_processor_id+0x1c/0x20
[ 1689.632369]  perf_ftrace_function_call+0x7c/0x360
[ 1689.632967]  ? trace_hardirqs_on+0x3f/0x170
[ 1689.633502]  ? preempt_count_sub+0x5/0xa0
[ 1689.634016]  ? preempt_count_sub+0x5/0xa0
[ 1689.634526]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1689.635153]  ? write_comp_data+0x2f/0x90
[ 1689.635661]  0xffffffffa009a099
[ 1689.636062]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1689.636665]  ? del_timer_sync+0xde/0x130
[ 1689.637169]  ? prepare_to_swait_event+0x5/0xf0
[ 1689.637727]  ? i915_init_ggtt+0x40/0x6b0
[ 1689.638233]  prepare_to_swait_event+0x5/0xf0
[ 1689.638772]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1689.639270]  ? prepare_to_swait_event+0x5/0xf0
[ 1689.639828]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1689.640356]  ? rcu_gp_init+0x730/0x730
[ 1689.640834]  rcu_gp_kthread+0xdd/0x170
[ 1689.641318]  kthread+0x1e7/0x230
[ 1689.641737]  ? set_kthread_struct+0x80/0x80
[ 1689.642278]  ret_from_fork+0x1f/0x30
[ 1689.642768] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1689.642802] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1689.643757] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1689.644724] caller is debug_smp_processor_id+0x1c/0x20
[ 1689.646192] Call Trace:
[ 1689.646211]  dump_stack_lvl+0xa4/0xd3
[ 1689.647678]  dump_stack+0x15/0x17
[ 1689.648151]  check_preemption_disabled+0x167/0x180
[ 1689.648840]  debug_smp_processor_id+0x1c/0x20
[ 1689.649447]  perf_trace_buf_alloc+0x98/0x100
[ 1689.650047]  ? __text_poke+0xea/0x4e0
[ 1689.650559]  ? __pmd_alloc+0x420/0x420
[ 1689.651091]  perf_ftrace_function_call+0x209/0x360
[ 1689.651851]  ? 0xffffffffa009a099
[ 1689.652356]  ? device_initial_probe+0x30/0x30
[ 1689.652971]  0xffffffffa009a099
[ 1689.653429]  ? 0xffffffffa009a099
[ 1689.653965]  ? __get_locked_pte+0x5/0x290
[ 1689.654549]  __get_locked_pte+0x5/0x290
[ 1689.655089]  __text_poke+0xea/0x4e0
[ 1689.655585]  ? __get_locked_pte+0x5/0x290
[ 1689.656138]  ? __text_poke+0xea/0x4e0
[ 1689.656655]  ? device_initial_probe+0x30/0x30
[ 1689.657269]  ? lock_is_held_type+0xe2/0x140
[ 1689.657858]  ? device_initial_probe+0x30/0x30
[ 1689.658488]  text_poke+0x2b/0x60
[ 1689.658967]  text_poke_bp_batch+0x93/0x2c0
[ 1689.659561]  ? fwnode_property_read_string_array+0x130/0x130
[ 1689.660350]  text_poke_queue+0xa7/0xc0
[ 1689.660901]  ftrace_replace_code+0xfd/0x170
[ 1689.661510]  ftrace_modify_all_code+0x1b1/0x270
[ 1689.662161]  arch_ftrace_update_code+0x9/0x10
[ 1689.662766]  ftrace_run_update_code+0x30/0xa0
[ 1689.663381]  ftrace_shutdown+0x2b8/0x4a0
[ 1689.663962]  unregister_ftrace_function+0x25/0x50
[ 1689.664616]  perf_ftrace_event_register+0x89/0xf0
[ 1689.665267]  ? perf_tp_event_init+0xa0/0xa0
[ 1689.665852]  perf_trace_destroy+0x37/0x60
[ 1689.666426]  tp_perf_event_destroy+0x15/0x20
[ 1689.667023]  _free_event+0xfc/0x7d0
[ 1689.667544]  put_event+0x37/0x50
[ 1689.668016]  perf_event_release_kernel+0x2f4/0x370
[ 1689.668704]  ? perf_event_release_kernel+0x370/0x370
[ 1689.669395]  perf_release+0x19/0x20
[ 1689.669895]  __fput+0x12d/0x460
[ 1689.670397]  ____fput+0x1a/0x20
[ 1689.670855]  task_work_run+0x8e/0xf0
[ 1689.671388]  do_exit+0x616/0x1310
[ 1689.671890]  ? write_comp_data+0x2f/0x90
[ 1689.672477]  do_group_exit+0x7e/0x130
[ 1689.673022]  get_signal+0x249/0x13c0
[ 1689.673549]  ? get_signal+0x5/0x13c0
[ 1689.674104]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1689.674812]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1689.675517]  exit_to_user_mode_prepare+0x154/0x240
[ 1689.676185]  syscall_exit_to_user_mode+0x2b/0x60
[ 1689.676832]  do_syscall_64+0x46/0x80
[ 1689.677343]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1689.678033] RIP: 0033:0x7fac0740459d
[ 1689.678539] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1689.679398] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1689.680403] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1689.681340] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1689.682281] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1689.683216] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1689.684151] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1689.685198] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1689.686146] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1689.687512] Call Trace:
[ 1689.687827]  dump_stack_lvl+0xa4/0xd3
[ 1689.688298]  dump_stack+0x15/0x17
[ 1689.688724]  check_preemption_disabled+0x167/0x180
[ 1689.689323]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1689.689837]  ? rcu_pm_notify+0x40/0x40
[ 1689.690317]  debug_smp_processor_id+0x1c/0x20
[ 1689.690866]  perf_ftrace_function_call+0x7c/0x360
[ 1689.691457]  ? prepare_to_swait_event+0xbb/0xf0
[ 1689.692027]  ? 0xffffffffa009a099
[ 1689.692451]  ? 0xffffffffa009a099
[ 1689.692875]  ? 0xffffffffa009a099
[ 1689.693309]  ? 0xffffffffa009a099
[ 1689.693750]  0xffffffffa009a099
[ 1689.694173]  ? trace_hardirqs_on+0x3f/0x170
[ 1689.694732]  ? preempt_count_sub+0x5/0xa0
[ 1689.695252]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1689.695796]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1689.696418]  rcu_gp_fqs_check_wake+0x5/0x50
[ 1689.696944]  rcu_gp_fqs_loop+0x2bd/0x410
[ 1689.697439]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1689.697995]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1689.698526]  ? rcu_gp_init+0x730/0x730
[ 1689.699001]  rcu_gp_kthread+0xdd/0x170
[ 1689.699482]  kthread+0x1e7/0x230
[ 1689.699899]  ? set_kthread_struct+0x80/0x80
[ 1689.700435]  ret_from_fork+0x1f/0x30
[ 1694.382068] check_preemption_disabled: 1557958 callbacks suppressed
[ 1694.382094] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1694.382148] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1694.382968] caller is debug_smp_processor_id+0x1c/0x20
[ 1694.383827] caller is debug_smp_processor_id+0x1c/0x20
[ 1694.384848] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1694.387025] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1694.388473] Call Trace:
[ 1694.388843]  dump_stack_lvl+0xa4/0xd3
[ 1694.389400]  dump_stack+0x15/0x17
[ 1694.389882]  check_preemption_disabled+0x167/0x180
[ 1694.390552]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1694.391150]  ? apply_paravirt+0x150/0x150
[ 1694.391734]  debug_smp_processor_id+0x1c/0x20
[ 1694.392343]  perf_ftrace_function_call+0x7c/0x360
[ 1694.393036]  ? bpf_sk_ancestor_cgroup_id+0x160/0x160
[ 1694.393757]  ? 0xffffffffa009a099
[ 1694.394250]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1694.395097]  0xffffffffa009a099
[ 1694.395563]  ? _raw_spin_unlock+0x2c/0x50
[ 1694.396173]  ? __text_poke+0x2f2/0x4e0
[ 1694.396718]  ? bpf_sk_ancestor_cgroup_id+0x160/0x160
[ 1694.397420]  ? sk_filter_release+0xa0/0xa0
[ 1694.397998]  ? text_poke+0x5/0x60
[ 1694.398530]  text_poke+0x5/0x60
[ 1694.398992]  text_poke_bp_batch+0x1dc/0x2c0
[ 1694.399580]  ? text_poke+0x5/0x60
[ 1694.400052]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1694.400701]  ? sk_attach_filter+0xa0/0xa0
[ 1694.401313]  text_poke_queue+0xa7/0xc0
[ 1694.401890]  ftrace_replace_code+0xfd/0x170
[ 1694.402535]  ftrace_modify_all_code+0x1b1/0x270
[ 1694.403206]  arch_ftrace_update_code+0x9/0x10
[ 1694.403814]  ftrace_run_update_code+0x30/0xa0
[ 1694.404448]  ftrace_shutdown+0x2b8/0x4a0
[ 1694.405065]  unregister_ftrace_function+0x25/0x50
[ 1694.405725]  perf_ftrace_event_register+0x89/0xf0
[ 1694.406384]  ? perf_tp_event_init+0xa0/0xa0
[ 1694.406972]  perf_trace_destroy+0x37/0x60
[ 1694.407550]  tp_perf_event_destroy+0x15/0x20
[ 1694.408159]  _free_event+0xfc/0x7d0
[ 1694.408713]  put_event+0x37/0x50
[ 1694.409204]  perf_event_release_kernel+0x2f4/0x370
[ 1694.409925]  ? perf_event_release_kernel+0x370/0x370
[ 1694.410636]  perf_release+0x19/0x20
[ 1694.411149]  __fput+0x12d/0x460
[ 1694.411703]  ____fput+0x1a/0x20
[ 1694.412176]  task_work_run+0x8e/0xf0
[ 1694.412742]  do_exit+0x616/0x1310
[ 1694.413277]  ? write_comp_data+0x2f/0x90
[ 1694.413903]  do_group_exit+0x7e/0x130
[ 1694.414507]  get_signal+0x249/0x13c0
[ 1694.415060]  ? get_signal+0x5/0x13c0
[ 1694.415683]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1694.416514]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1694.417343]  exit_to_user_mode_prepare+0x154/0x240
[ 1694.418101]  syscall_exit_to_user_mode+0x2b/0x60
[ 1694.418827]  do_syscall_64+0x46/0x80
[ 1694.419410]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1694.420177] RIP: 0033:0x7fac0740459d
[ 1694.420742] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1694.421687] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1694.422804] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1694.423834] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1694.424862] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1694.425891] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1694.426924] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1694.428180] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1694.428299] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1694.429126] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1694.430336] caller is debug_smp_processor_id+0x1c/0x20
[ 1694.431598] Call Trace:
[ 1694.431612]  dump_stack_lvl+0xa4/0xd3
[ 1694.433102]  dump_stack+0x15/0x17
[ 1694.433527]  check_preemption_disabled+0x167/0x180
[ 1694.434132]  ? schedule_timeout+0x34e/0x610
[ 1694.434658]  ? do_init_timer+0xa0/0xa0
[ 1694.435139]  debug_smp_processor_id+0x1c/0x20
[ 1694.435688]  perf_ftrace_function_call+0x7c/0x360
[ 1694.436282]  ? 0xffffffffa009a099
[ 1694.436705]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1694.437308]  ? finish_task_switch+0xab/0x2a0
[ 1694.437844]  ? __schedule+0x46e/0xb20
[ 1694.438330]  0xffffffffa009a099
[ 1694.438736]  ? finish_task_switch+0xb0/0x2a0
[ 1694.439289]  ? del_timer_sync+0x5/0x130
[ 1694.439782]  del_timer_sync+0x5/0x130
[ 1694.440250]  schedule_timeout+0x34e/0x610
[ 1694.440758]  ? del_timer_sync+0x5/0x130
[ 1694.441243]  ? schedule_timeout+0x34e/0x610
[ 1694.441780]  ? del_timer_sync+0x130/0x130
[ 1694.442297]  ? i915_init_ggtt+0x40/0x6b0
[ 1694.442806]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1694.443312]  ? rcu_gp_init+0x730/0x730
[ 1694.443787]  rcu_gp_kthread+0xdd/0x170
[ 1694.444270]  kthread+0x1e7/0x230
[ 1694.444688]  ? set_kthread_struct+0x80/0x80
[ 1694.445220]  ret_from_fork+0x1f/0x30
[ 1694.445711] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1694.445741] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1694.446800] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1694.447777] caller is debug_smp_processor_id+0x1c/0x20
[ 1694.449382] Call Trace:
[ 1694.450401]  dump_stack_lvl+0xa4/0xd3
[ 1694.451022]  dump_stack+0x15/0x17
[ 1694.451561]  check_preemption_disabled+0x167/0x180
[ 1694.452362]  debug_smp_processor_id+0x1c/0x20
[ 1694.453046]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1694.453926]  perf_trace_buf_alloc+0x3d/0x100
[ 1694.454597]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1694.455265]  ? apply_paravirt+0x150/0x150
[ 1694.455906]  perf_ftrace_function_call+0x209/0x360
[ 1694.456854]  ? 0xffffffffa009a099
[ 1694.457508]  0xffffffffa009a099
[ 1694.458027]  ? _raw_spin_unlock+0x2c/0x50
[ 1694.458709]  ? __text_poke+0x2f2/0x4e0
[ 1694.459315]  ? bpf_sk_ancestor_cgroup_id+0x160/0x160
[ 1694.460100]  ? sk_filter_release+0xa0/0xa0
[ 1694.460743]  ? text_poke+0x5/0x60
[ 1694.461323]  text_poke+0x5/0x60
[ 1694.461837]  text_poke_bp_batch+0x1dc/0x2c0
[ 1694.462494]  ? text_poke+0x5/0x60
[ 1694.463019]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1694.463741]  ? sk_attach_filter+0xa0/0xa0
[ 1694.464415]  text_poke_queue+0xa7/0xc0
[ 1694.465056]  ftrace_replace_code+0xfd/0x170
[ 1694.465755]  ftrace_modify_all_code+0x1b1/0x270
[ 1694.466507]  arch_ftrace_update_code+0x9/0x10
[ 1694.467184]  ftrace_run_update_code+0x30/0xa0
[ 1694.467884]  ftrace_shutdown+0x2b8/0x4a0
[ 1694.468567]  unregister_ftrace_function+0x25/0x50
[ 1694.469303]  perf_ftrace_event_register+0x89/0xf0
[ 1694.470038]  ? perf_tp_event_init+0xa0/0xa0
[ 1694.470698]  perf_trace_destroy+0x37/0x60
[ 1694.471346]  tp_perf_event_destroy+0x15/0x20
[ 1694.472029]  _free_event+0xfc/0x7d0
[ 1694.472645]  put_event+0x37/0x50
[ 1694.473193]  perf_event_release_kernel+0x2f4/0x370
[ 1694.473997]  ? perf_event_release_kernel+0x370/0x370
[ 1694.474791]  perf_release+0x19/0x20
[ 1694.475364]  __fput+0x12d/0x460
[ 1694.475977]  ____fput+0x1a/0x20
[ 1694.476506]  task_work_run+0x8e/0xf0
[ 1694.477136]  do_exit+0x616/0x1310
[ 1694.477730]  ? write_comp_data+0x2f/0x90
[ 1694.478435]  do_group_exit+0x7e/0x130
[ 1694.479077]  get_signal+0x249/0x13c0
[ 1694.479696]  ? get_signal+0x5/0x13c0
[ 1694.480367]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1694.481214]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1694.482056]  exit_to_user_mode_prepare+0x154/0x240
[ 1694.482820]  syscall_exit_to_user_mode+0x2b/0x60
[ 1694.483549]  do_syscall_64+0x46/0x80
[ 1694.484131]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1694.484898] RIP: 0033:0x7fac0740459d
[ 1694.485461] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1694.486437] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1694.487552] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1694.488587] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1694.489621] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1694.490662] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1694.491690] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1694.492950] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1694.493056] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1694.493911] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1694.495051] caller is debug_smp_processor_id+0x1c/0x20
[ 1694.496343] Call Trace:
[ 1694.497328]  dump_stack_lvl+0xa4/0xd3
[ 1694.497802]  dump_stack+0x15/0x17
[ 1694.498243]  check_preemption_disabled+0x167/0x180
[ 1694.498843]  ? del_timer_sync+0xd3/0x130
[ 1694.499340]  ? detach_if_pending+0x270/0x270
[ 1694.499880]  debug_smp_processor_id+0x1c/0x20
[ 1694.500430]  perf_ftrace_function_call+0x7c/0x360
[ 1694.501017]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1694.501612]  ? register_lock_class+0x42/0x440
[ 1694.502171]  ? del_timer_sync+0x40/0x130
[ 1694.502671]  ? 0xffffffffa009a099
[ 1694.503095]  ? 0xffffffffa009a099
[ 1694.503522]  ? 0xffffffffa009a099
[ 1694.503956]  0xffffffffa009a099
[ 1694.504359]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1694.504961]  ? del_timer_sync+0xa5/0x130
[ 1694.505465]  ? try_to_del_timer_sync+0x5/0x90
[ 1694.506014]  ? write_comp_data+0x2f/0x90
[ 1694.506518]  try_to_del_timer_sync+0x5/0x90
[ 1694.507046]  del_timer_sync+0xd3/0x130
[ 1694.507524]  ? try_to_del_timer_sync+0x5/0x90
[ 1694.508071]  ? del_timer_sync+0xd3/0x130
[ 1694.508573]  schedule_timeout+0x34e/0x610
[ 1694.509089]  ? del_timer_sync+0x130/0x130
[ 1694.509603]  ? i915_init_ggtt+0x40/0x6b0
[ 1694.510114]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1694.510621]  ? rcu_gp_init+0x730/0x730
[ 1694.511097]  rcu_gp_kthread+0xdd/0x170
[ 1694.511581]  kthread+0x1e7/0x230
[ 1694.511998]  ? set_kthread_struct+0x80/0x80
[ 1694.512532]  ret_from_fork+0x1f/0x30
[ 1694.513054] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1694.513107] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1694.514093] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1694.514112] Call Trace:
[ 1694.515105] caller is debug_smp_processor_id+0x1c/0x20
[ 1694.516584]  dump_stack_lvl+0xa4/0xd3
[ 1694.518081]  dump_stack+0x15/0x17
[ 1694.518566]  check_preemption_disabled+0x167/0x180
[ 1694.519258]  debug_smp_processor_id+0x1c/0x20
[ 1694.519868]  perf_trace_buf_alloc+0x98/0x100
[ 1694.520468]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1694.521071]  ? apply_paravirt+0x150/0x150
[ 1694.521639]  perf_ftrace_function_call+0x209/0x360
[ 1694.522414]  ? 0xffffffffa009a099
[ 1694.522944]  0xffffffffa009a099
[ 1694.523398]  ? _raw_spin_unlock+0x2c/0x50
[ 1694.523985]  ? __text_poke+0x2f2/0x4e0
[ 1694.524519]  ? bpf_sk_ancestor_cgroup_id+0x160/0x160
[ 1694.525212]  ? sk_filter_release+0xa0/0xa0
[ 1694.525787]  ? text_poke+0x5/0x60
[ 1694.526293]  text_poke+0x5/0x60
[ 1694.526747]  text_poke_bp_batch+0x1dc/0x2c0
[ 1694.527333]  ? text_poke+0x5/0x60
[ 1694.527804]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1694.528432]  ? sk_attach_filter+0xa0/0xa0
[ 1694.529018]  text_poke_queue+0xa7/0xc0
[ 1694.529572]  ftrace_replace_code+0xfd/0x170
[ 1694.530198]  ftrace_modify_all_code+0x1b1/0x270
[ 1694.530857]  arch_ftrace_update_code+0x9/0x10
[ 1694.531465]  ftrace_run_update_code+0x30/0xa0
[ 1694.532083]  ftrace_shutdown+0x2b8/0x4a0
[ 1694.532672]  unregister_ftrace_function+0x25/0x50
[ 1694.533330]  perf_ftrace_event_register+0x89/0xf0
[ 1694.533982]  ? perf_tp_event_init+0xa0/0xa0
[ 1694.534576]  perf_trace_destroy+0x37/0x60
[ 1694.535147]  tp_perf_event_destroy+0x15/0x20
[ 1694.535756]  _free_event+0xfc/0x7d0
[ 1694.536283]  put_event+0x37/0x50
[ 1694.536759]  perf_event_release_kernel+0x2f4/0x370
[ 1694.537455]  ? perf_event_release_kernel+0x370/0x370
[ 1694.538159]  perf_release+0x19/0x20
[ 1694.538662]  __fput+0x12d/0x460
[ 1694.539165]  ____fput+0x1a/0x20
[ 1694.539625]  task_work_run+0x8e/0xf0
[ 1694.540162]  do_exit+0x616/0x1310
[ 1694.540668]  ? write_comp_data+0x2f/0x90
[ 1694.541261]  do_group_exit+0x7e/0x130
[ 1694.541812]  get_signal+0x249/0x13c0
[ 1694.542354]  ? get_signal+0x5/0x13c0
[ 1694.542909]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1694.543620]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1694.544340]  exit_to_user_mode_prepare+0x154/0x240
[ 1694.545048]  syscall_exit_to_user_mode+0x2b/0x60
[ 1694.545739]  do_syscall_64+0x46/0x80
[ 1694.546276]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1694.546975] RIP: 0033:0x7fac0740459d
[ 1694.547482] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1694.548365] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1694.549382] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1694.550361] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1694.551315] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1694.552271] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1694.553226] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1694.554315] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1694.554430] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1694.555274] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1694.556291] caller is debug_smp_processor_id+0x1c/0x20
[ 1694.557646] Call Trace:
[ 1694.558642]  dump_stack_lvl+0xa4/0xd3
[ 1694.559115]  dump_stack+0x15/0x17
[ 1694.559540]  check_preemption_disabled+0x167/0x180
[ 1694.560140]  ? try_to_del_timer_sync+0x33/0x90
[ 1694.560698]  ? calc_wheel_index+0x2d0/0x2d0
[ 1694.561229]  debug_smp_processor_id+0x1c/0x20
[ 1694.561779]  perf_ftrace_function_call+0x7c/0x360
[ 1694.562377]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1694.562966]  ? del_timer_sync+0xd3/0x130
[ 1694.563464]  ? perf_ftrace_function_call+0x4c/0x360
[ 1694.564072]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1694.564666]  ? register_lock_class+0x42/0x440
[ 1694.565220]  ? del_timer_sync+0x40/0x130
[ 1694.565721]  ? 0xffffffffa009a099
[ 1694.566150]  ? 0xffffffffa009a099
[ 1694.566582]  0xffffffffa009a099
[ 1694.566991]  ? 0xffffffffa009a099
[ 1694.567413]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1694.568005]  ? del_timer_sync+0xa5/0x130
[ 1694.568508]  ? lock_timer_base+0x5/0x100
[ 1694.569011]  lock_timer_base+0x5/0x100
[ 1694.569487]  try_to_del_timer_sync+0x33/0x90
[ 1694.570024]  ? lock_timer_base+0x5/0x100
[ 1694.570525]  ? try_to_del_timer_sync+0x33/0x90
[ 1694.571082]  ? try_to_del_timer_sync+0x5/0x90
[ 1694.571635]  del_timer_sync+0xd3/0x130
[ 1694.572116]  schedule_timeout+0x34e/0x610
[ 1694.572633]  ? del_timer_sync+0x130/0x130
[ 1694.573148]  ? i915_init_ggtt+0x40/0x6b0
[ 1694.573659]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1694.574169]  ? rcu_gp_init+0x730/0x730
[ 1694.574644]  rcu_gp_kthread+0xdd/0x170
[ 1694.575128]  kthread+0x1e7/0x230
[ 1694.575546]  ? set_kthread_struct+0x80/0x80
[ 1694.576081]  ret_from_fork+0x1f/0x30
[ 1694.576573] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1694.576618] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1694.577562] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1694.578550] caller is debug_smp_processor_id+0x1c/0x20
[ 1694.580006] Call Trace:
[ 1694.580979]  dump_stack_lvl+0xa4/0xd3
[ 1694.581516]  dump_stack+0x15/0x17
[ 1694.581990]  check_preemption_disabled+0x167/0x180
[ 1694.582680]  debug_smp_processor_id+0x1c/0x20
[ 1694.583287]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1694.584037]  perf_tp_event+0x331/0x4e0
[ 1694.584712]  ? arch_local_irq_enable+0x10/0x12
[ 1694.585333]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1694.585994]  ? dump_stack_lvl+0xcc/0xd3
[ 1694.586552]  ? dump_stack+0x15/0x17
[ 1694.587048]  ? check_preemption_disabled+0x167/0x180
[ 1694.587758]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1694.588360]  ? apply_paravirt+0x150/0x150
[ 1694.588930]  perf_ftrace_function_call+0x248/0x360
[ 1694.589587]  ? perf_ftrace_function_call+0x248/0x360
[ 1694.590385]  ? 0xffffffffa009a099
[ 1694.590914]  0xffffffffa009a099
[ 1694.591367]  ? _raw_spin_unlock+0x2c/0x50
[ 1694.591953]  ? __text_poke+0x2f2/0x4e0
[ 1694.592489]  ? bpf_sk_ancestor_cgroup_id+0x160/0x160
[ 1694.593183]  ? sk_filter_release+0xa0/0xa0
[ 1694.593756]  ? text_poke+0x5/0x60
[ 1694.594254]  text_poke+0x5/0x60
[ 1694.594706]  text_poke_bp_batch+0x1dc/0x2c0
[ 1694.595290]  ? text_poke+0x5/0x60
[ 1694.595758]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1694.596386]  ? sk_attach_filter+0xa0/0xa0
[ 1694.596970]  text_poke_queue+0xa7/0xc0
[ 1694.597522]  ftrace_replace_code+0xfd/0x170
[ 1694.598135]  ftrace_modify_all_code+0x1b1/0x270
[ 1694.598784]  arch_ftrace_update_code+0x9/0x10
[ 1694.599391]  ftrace_run_update_code+0x30/0xa0
[ 1694.600007]  ftrace_shutdown+0x2b8/0x4a0
[ 1694.600590]  unregister_ftrace_function+0x25/0x50
[ 1694.601245]  perf_ftrace_event_register+0x89/0xf0
[ 1694.601897]  ? perf_tp_event_init+0xa0/0xa0
[ 1694.602484]  perf_trace_destroy+0x37/0x60
[ 1694.603054]  tp_perf_event_destroy+0x15/0x20
[ 1694.603655]  _free_event+0xfc/0x7d0
[ 1694.604177]  put_event+0x37/0x50
[ 1694.604650]  perf_event_release_kernel+0x2f4/0x370
[ 1694.605342]  ? perf_event_release_kernel+0x370/0x370
[ 1694.606037]  perf_release+0x19/0x20
[ 1694.606539]  __fput+0x12d/0x460
[ 1694.607040]  ____fput+0x1a/0x20
[ 1694.607499]  task_work_run+0x8e/0xf0
[ 1694.608033]  do_exit+0x616/0x1310
[ 1694.608535]  ? write_comp_data+0x2f/0x90
[ 1694.609122]  do_group_exit+0x7e/0x130
[ 1694.609668]  get_signal+0x249/0x13c0
[ 1694.610199]  ? get_signal+0x5/0x13c0
[ 1694.610754]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1694.611463]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1694.612170]  exit_to_user_mode_prepare+0x154/0x240
[ 1694.612841]  syscall_exit_to_user_mode+0x2b/0x60
[ 1694.613487]  do_syscall_64+0x46/0x80
[ 1694.613999]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1694.614693] RIP: 0033:0x7fac0740459d
[ 1694.615195] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1694.616055] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1694.617063] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1694.618003] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1694.618944] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1694.619882] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1694.620819] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1694.621869] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1694.622065] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24321
[ 1694.622823] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1694.623930] caller is debug_smp_processor_id+0x1c/0x20
[ 1694.625282] Call Trace:
[ 1694.625291]  dump_stack_lvl+0xa4/0xd3
[ 1694.626786]  dump_stack+0x15/0x17
[ 1694.627231]  check_preemption_disabled+0x167/0x180
[ 1694.627833]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1694.628348]  ? prepare_to_swait_exclusive+0x90/0x90
[ 1694.628960]  debug_smp_processor_id+0x1c/0x20
[ 1694.629511]  perf_ftrace_function_call+0x7c/0x360
[ 1694.630112]  ? trace_hardirqs_on+0x3f/0x170
[ 1694.630647]  ? preempt_count_sub+0x5/0xa0
[ 1694.631160]  ? preempt_count_sub+0x5/0xa0
[ 1694.631666]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1694.632290]  ? write_comp_data+0x2f/0x90
[ 1694.632798]  0xffffffffa009a099
[ 1694.633197]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1694.633799]  ? del_timer_sync+0xde/0x130
[ 1694.634306]  ? prepare_to_swait_event+0x5/0xf0
[ 1694.634865]  ? i915_init_ggtt+0x40/0x6b0
[ 1694.635366]  prepare_to_swait_event+0x5/0xf0
[ 1694.635905]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1694.636405]  ? prepare_to_swait_event+0x5/0xf0
[ 1694.636964]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1694.637494]  ? rcu_gp_init+0x730/0x730
[ 1694.637973]  rcu_gp_kthread+0xdd/0x170
[ 1694.638462]  kthread+0x1e7/0x230
[ 1694.638883]  ? set_kthread_struct+0x80/0x80
[ 1694.639418]  ret_from_fork+0x1f/0x30
[ 1694.639911] CPU: 0 PID: 24321 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1694.639942] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1694.640997] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1694.641977] caller is debug_smp_processor_id+0x1c/0x20
[ 1694.643550] Call Trace:
[ 1694.644565]  dump_stack_lvl+0xa4/0xd3
[ 1694.645185]  dump_stack+0x15/0x17
[ 1694.645720]  check_preemption_disabled+0x167/0x180
[ 1694.646461]  ? text_poke+0x2b/0x60
[ 1694.646998]  ? do_sync_core+0x30/0x30
[ 1694.647600]  debug_smp_processor_id+0x1c/0x20
[ 1694.648279]  perf_ftrace_function_call+0x7c/0x360
[ 1694.648994]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1694.649716]  ? text_poke_bp_batch+0x1dc/0x2c0
[ 1694.650396]  ? perf_ftrace_function_call+0x4c/0x360
[ 1694.651356]  ? sk_filter_release+0xa0/0xa0
[ 1694.652039]  0xffffffffa009a099
[ 1694.652608]  ? _raw_spin_unlock+0x2c/0x50
[ 1694.653301]  ? sk_filter_release+0xa0/0xa0
[ 1694.653944]  ? __text_poke+0x5/0x4e0
[ 1694.654519]  ? lock_is_held_type+0xe2/0x140
[ 1694.655195]  __text_poke+0x5/0x4e0
[ 1694.655741]  text_poke+0x2b/0x60
[ 1694.656265]  ? __text_poke+0x5/0x4e0
[ 1694.656824]  ? text_poke+0x2b/0x60
[ 1694.657400]  text_poke_bp_batch+0x1dc/0x2c0
[ 1694.658101]  ? sk_attach_filter+0xa0/0xa0
[ 1694.658776]  text_poke_queue+0xa7/0xc0
[ 1694.659414]  ftrace_replace_code+0xfd/0x170
[ 1694.660120]  ftrace_modify_all_code+0x1b1/0x270
[ 1694.660862]  arch_ftrace_update_code+0x9/0x10
[ 1694.661539]  ftrace_run_update_code+0x30/0xa0
[ 1694.662240]  ftrace_shutdown+0x2b8/0x4a0
[ 1694.662920]  unregister_ftrace_function+0x25/0x50
[ 1694.663650]  perf_ftrace_event_register+0x89/0xf0
[ 1694.664371]  ? perf_tp_event_init+0xa0/0xa0
[ 1694.665021]  perf_trace_destroy+0x37/0x60
[ 1694.665663]  tp_perf_event_destroy+0x15/0x20
[ 1694.666343]  _free_event+0xfc/0x7d0
[ 1694.666955]  put_event+0x37/0x50
[ 1694.667501]  perf_event_release_kernel+0x2f4/0x370
[ 1694.668303]  ? perf_event_release_kernel+0x370/0x370
[ 1694.669084]  perf_release+0x19/0x20
[ 1694.669653]  __fput+0x12d/0x460
[ 1694.670264]  ____fput+0x1a/0x20
[ 1694.670787]  task_work_run+0x8e/0xf0
[ 1694.671412]  do_exit+0x616/0x1310
[ 1694.672000]  ? write_comp_data+0x2f/0x90
[ 1694.672692]  do_group_exit+0x7e/0x130
[ 1694.673330]  get_signal+0x249/0x13c0
[ 1694.673944]  ? get_signal+0x5/0x13c0
[ 1694.674610]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1694.675454]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1694.676284]  exit_to_user_mode_prepare+0x154/0x240
[ 1694.677038]  syscall_exit_to_user_mode+0x2b/0x60
[ 1694.677763]  do_syscall_64+0x46/0x80
[ 1694.678348]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1694.679114] RIP: 0033:0x7fac0740459d
[ 1694.679679] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1694.680624] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1694.681735] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1694.682765] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1694.683794] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1694.684822] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1694.685848] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1694.687107] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1694.688054] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1694.689421] Call Trace:
[ 1694.689739]  dump_stack_lvl+0xa4/0xd3
[ 1694.690225]  dump_stack+0x15/0x17
[ 1694.690651]  check_preemption_disabled+0x167/0x180
[ 1694.691253]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1694.691767]  ? rcu_pm_notify+0x40/0x40
[ 1694.692244]  debug_smp_processor_id+0x1c/0x20
[ 1694.692792]  perf_ftrace_function_call+0x7c/0x360
[ 1694.693382]  ? prepare_to_swait_event+0xbb/0xf0
[ 1694.693951]  ? 0xffffffffa009a099
[ 1694.694384]  ? 0xffffffffa009a099
[ 1694.694810]  ? 0xffffffffa009a099
[ 1694.695246]  ? 0xffffffffa009a099
[ 1694.695681]  0xffffffffa009a099
[ 1694.696086]  ? trace_hardirqs_on+0x3f/0x170
[ 1694.696617]  ? preempt_count_sub+0x5/0xa0
[ 1694.697134]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1694.697681]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1694.698308]  rcu_gp_fqs_check_wake+0x5/0x50
[ 1694.698836]  rcu_gp_fqs_loop+0x2bd/0x410
[ 1694.699332]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1694.699877]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1694.700404]  ? rcu_gp_init+0x730/0x730
[ 1694.700882]  rcu_gp_kthread+0xdd/0x170
[ 1694.701366]  kthread+0x1e7/0x230
[ 1694.701785]  ? set_kthread_struct+0x80/0x80
[ 1694.702329]  ret_from_fork+0x1f/0x30
[ 1699.386055] check_preemption_disabled: 3142551 callbacks suppressed
[ 1699.386076] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1699.386708] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1699.386900] caller is debug_smp_processor_id+0x1c/0x20
[ 1699.387760] caller is debug_smp_processor_id+0x1c/0x20
[ 1699.388651] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1699.390694] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1699.392024] Call Trace:
[ 1699.392347]  dump_stack_lvl+0xa4/0xd3
[ 1699.392830]  dump_stack+0x15/0x17
[ 1699.393257]  check_preemption_disabled+0x167/0x180
[ 1699.393878]  debug_smp_processor_id+0x1c/0x20
[ 1699.394433]  perf_trace_buf_alloc+0x98/0x100
[ 1699.394972]  ? ftrace_verify_code+0x2c/0x70
[ 1699.395492]  ? copy_to_user_nofault+0x150/0x150
[ 1699.396065]  perf_ftrace_function_call+0x209/0x360
[ 1699.396758]  ? 0xffffffffa0098099
[ 1699.397239]  0xffffffffa0098099
[ 1699.397641]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1699.398303]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1699.398871]  ? pick_next_pushable_dl_task+0x70/0x70
[ 1699.399469]  ? pick_next_pushable_dl_task+0x70/0x70
[ 1699.400076]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1699.400729]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1699.401293]  ? check_preempt_curr_dl+0xa0/0xa0
[ 1699.401852]  ? copy_from_kernel_nofault+0x5/0x220
[ 1699.402468]  copy_from_kernel_nofault+0x5/0x220
[ 1699.403034]  ftrace_verify_code+0x2c/0x70
[ 1699.403538]  ? copy_from_kernel_nofault+0x5/0x220
[ 1699.404116]  ? ftrace_verify_code+0x2c/0x70
[ 1699.404654]  ftrace_replace_code+0x69/0x170
[ 1699.405202]  ftrace_modify_all_code+0x1b1/0x270
[ 1699.405784]  arch_ftrace_update_code+0x9/0x10
[ 1699.406335]  ftrace_run_update_code+0x30/0xa0
[ 1699.406889]  ftrace_startup_enable+0x5e/0xa0
[ 1699.407432]  ftrace_startup+0x16d/0x240
[ 1699.407953]  register_ftrace_function+0x43/0x90
[ 1699.408527]  perf_ftrace_event_register+0xc1/0xf0
[ 1699.409122]  perf_trace_event_init+0xa0/0x4c0
[ 1699.409693]  perf_trace_init+0xda/0x160
[ 1699.410208]  perf_tp_event_init+0x57/0xa0
[ 1699.410724]  perf_try_init_event+0x83/0x270
[ 1699.411285]  perf_event_alloc+0xe3f/0x1c10
[ 1699.411794]  ? _raw_spin_unlock+0x2c/0x50
[ 1699.412306]  ? alloc_fd+0x20d/0x320
[ 1699.412803]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1699.413406]  ? write_comp_data+0x2f/0x90
[ 1699.414067]  __x64_sys_perf_event_open+0x26/0x30
[ 1699.414647]  do_syscall_64+0x37/0x80
[ 1699.415107]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1699.415726] RIP: 0033:0x7fac0740459d
[ 1699.416179] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1699.418334] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1699.419236] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1699.420136] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1699.421060] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1699.421982] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1699.422914] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1699.423946] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1699.424162] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1699.424838] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1699.425840] caller is debug_smp_processor_id+0x1c/0x20
[ 1699.427203] Call Trace:
[ 1699.427213]  dump_stack_lvl+0xa4/0xd3
[ 1699.427234]  dump_stack+0x15/0x17
[ 1699.427249]  check_preemption_disabled+0x167/0x180
[ 1699.427266]  ? do_nanosleep+0x123/0x2a0
[ 1699.427281]  ? ___might_sleep+0x170/0x170
[ 1699.427300]  debug_smp_processor_id+0x1c/0x20
[ 1699.431191]  perf_ftrace_function_call+0x7c/0x360
[ 1699.431784]  ? 0xffffffffa0098099
[ 1699.432206]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1699.432807]  ? finish_task_switch+0xab/0x2a0
[ 1699.433341]  ? __schedule+0x46e/0xb20
[ 1699.433816]  ? do_nanosleep+0x9c/0x2a0
[ 1699.434303]  0xffffffffa0098099
[ 1699.434707]  ? finish_task_switch+0xb0/0x2a0
[ 1699.435252]  ? do_nanosleep+0x107/0x2a0
[ 1699.435742]  ? __might_sleep+0x5/0x70
[ 1699.436206]  ? write_comp_data+0x2f/0x90
[ 1699.436704]  __might_sleep+0x5/0x70
[ 1699.437149]  do_nanosleep+0x123/0x2a0
[ 1699.437621]  ? __might_sleep+0x5/0x70
[ 1699.438096]  ? do_nanosleep+0x123/0x2a0
[ 1699.438579]  ? write_comp_data+0x2f/0x90
[ 1699.439084]  hrtimer_nanosleep+0xf7/0x1b0
[ 1699.439600]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1699.440184]  __x64_sys_nanosleep+0xfc/0x150
[ 1699.440721]  do_syscall_64+0x37/0x80
[ 1699.441177]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1699.441805] RIP: 0033:0x7fac073cca18
[ 1699.442264] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1699.444474] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1699.445391] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1699.446255] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1699.447113] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1699.447973] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1699.448830] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1699.449723] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1699.449750] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1699.450702] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1699.450720] Call Trace:
[ 1699.451631] caller is debug_smp_processor_id+0x1c/0x20
[ 1699.453077]  dump_stack_lvl+0xa4/0xd3
[ 1699.454549]  dump_stack+0x15/0x17
[ 1699.455016]  check_preemption_disabled+0x167/0x180
[ 1699.455694]  debug_smp_processor_id+0x1c/0x20
[ 1699.456290]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1699.457026]  perf_tp_event+0x331/0x4e0
[ 1699.457706]  ? arch_local_irq_enable+0x10/0x12
[ 1699.458314]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1699.458963]  ? dump_stack_lvl+0xcc/0xd3
[ 1699.459509]  ? dump_stack+0x15/0x17
[ 1699.459996]  ? check_preemption_disabled+0x167/0x180
[ 1699.460690]  ? ftrace_verify_code+0x2c/0x70
[ 1699.461255]  ? copy_to_user_nofault+0x150/0x150
[ 1699.461882]  perf_ftrace_function_call+0x248/0x360
[ 1699.462538]  ? perf_ftrace_function_call+0x248/0x360
[ 1699.463325]  ? 0xffffffffa0098099
[ 1699.463846]  0xffffffffa0098099
[ 1699.464286]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1699.464998]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1699.465620]  ? pick_next_pushable_dl_task+0x70/0x70
[ 1699.466277]  ? pick_next_pushable_dl_task+0x70/0x70
[ 1699.466942]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1699.467654]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1699.468269]  ? check_preempt_curr_dl+0xa0/0xa0
[ 1699.468880]  ? copy_from_kernel_nofault+0x5/0x220
[ 1699.469542]  copy_from_kernel_nofault+0x5/0x220
[ 1699.470163]  ftrace_verify_code+0x2c/0x70
[ 1699.470716]  ? copy_from_kernel_nofault+0x5/0x220
[ 1699.471350]  ? ftrace_verify_code+0x2c/0x70
[ 1699.471940]  ftrace_replace_code+0x69/0x170
[ 1699.472542]  ftrace_modify_all_code+0x1b1/0x270
[ 1699.473181]  arch_ftrace_update_code+0x9/0x10
[ 1699.473777]  ftrace_run_update_code+0x30/0xa0
[ 1699.474388]  ftrace_startup_enable+0x5e/0xa0
[ 1699.474982]  ftrace_startup+0x16d/0x240
[ 1699.475551]  register_ftrace_function+0x43/0x90
[ 1699.476181]  perf_ftrace_event_register+0xc1/0xf0
[ 1699.476832]  perf_trace_event_init+0xa0/0x4c0
[ 1699.477455]  perf_trace_init+0xda/0x160
[ 1699.478009]  perf_tp_event_init+0x57/0xa0
[ 1699.478576]  perf_try_init_event+0x83/0x270
[ 1699.479184]  perf_event_alloc+0xe3f/0x1c10
[ 1699.479744]  ? _raw_spin_unlock+0x2c/0x50
[ 1699.480302]  ? alloc_fd+0x20d/0x320
[ 1699.480842]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1699.481501]  ? write_comp_data+0x2f/0x90
[ 1699.482218]  __x64_sys_perf_event_open+0x26/0x30
[ 1699.482851]  do_syscall_64+0x37/0x80
[ 1699.483355]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1699.484034] RIP: 0033:0x7fac0740459d
[ 1699.484529] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1699.486894] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1699.487886] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1699.488811] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1699.489737] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1699.490665] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1699.491588] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1699.492625] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1699.492830] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1699.493513] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1699.494688] caller is debug_smp_processor_id+0x1c/0x20
[ 1699.495947] Call Trace:
[ 1699.495956]  dump_stack_lvl+0xa4/0xd3
[ 1699.497424]  dump_stack+0x15/0x17
[ 1699.497848]  check_preemption_disabled+0x167/0x180
[ 1699.498448]  ? __might_sleep+0x48/0x70
[ 1699.498919]  ? sched_show_task+0x70/0x70
[ 1699.499415]  debug_smp_processor_id+0x1c/0x20
[ 1699.499962]  perf_ftrace_function_call+0x7c/0x360
[ 1699.500546]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1699.501130]  ? do_nanosleep+0x123/0x2a0
[ 1699.501615]  ? perf_ftrace_function_call+0x4c/0x360
[ 1699.502231]  ? 0xffffffffa0098099
[ 1699.502652]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1699.503252]  ? finish_task_switch+0xab/0x2a0
[ 1699.503784]  ? __schedule+0x46e/0xb20
[ 1699.504251]  ? do_nanosleep+0x9c/0x2a0
[ 1699.504727]  0xffffffffa0098099
[ 1699.505125]  ? do_nanosleep+0x9c/0x2a0
[ 1699.505612]  ? do_nanosleep+0x107/0x2a0
[ 1699.506103]  ? ___might_sleep+0x5/0x170
[ 1699.506592]  ___might_sleep+0x5/0x170
[ 1699.507055]  __might_sleep+0x48/0x70
[ 1699.507508]  ? ___might_sleep+0x5/0x170
[ 1699.507990]  ? __might_sleep+0x48/0x70
[ 1699.508467]  do_nanosleep+0x123/0x2a0
[ 1699.508929]  ? write_comp_data+0x2f/0x90
[ 1699.509434]  hrtimer_nanosleep+0xf7/0x1b0
[ 1699.509948]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1699.510535]  __x64_sys_nanosleep+0xfc/0x150
[ 1699.511072]  do_syscall_64+0x37/0x80
[ 1699.511525]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1699.512149] RIP: 0033:0x7fac073cca18
[ 1699.512599] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1699.514817] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1699.515734] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1699.516592] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1699.517452] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1699.518314] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1699.519174] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1699.520070] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1699.520110] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1699.521124] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1699.522052] caller is debug_smp_processor_id+0x1c/0x20
[ 1699.523597] Call Trace:
[ 1699.524601]  dump_stack_lvl+0xa4/0xd3
[ 1699.525203]  dump_stack+0x15/0x17
[ 1699.525728]  check_preemption_disabled+0x167/0x180
[ 1699.526454]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1699.527165]  ? cea_set_pte+0x140/0x140
[ 1699.527767]  debug_smp_processor_id+0x1c/0x20
[ 1699.528432]  perf_ftrace_function_call+0x7c/0x360
[ 1699.529132]  ? copy_to_user_nofault+0x150/0x150
[ 1699.529840]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1699.530551]  ? ftrace_verify_code+0x2c/0x70
[ 1699.531194]  ? perf_ftrace_function_call+0x4c/0x360
[ 1699.532131]  ? check_preempt_curr_dl+0xa0/0xa0
[ 1699.532816]  0xffffffffa0098099
[ 1699.533408]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1699.534204]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1699.534898]  ? check_preempt_curr_dl+0xa0/0xa0
[ 1699.535571]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1699.536361]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1699.537152]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1699.537842]  copy_from_kernel_nofault_allowed+0x5/0x80
[ 1699.538618]  copy_from_kernel_nofault+0x2f/0x220
[ 1699.539317]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1699.540096]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1699.540896]  ftrace_verify_code+0x2c/0x70
[ 1699.541544]  ftrace_replace_code+0x69/0x170
[ 1699.542246]  ftrace_modify_all_code+0x1b1/0x270
[ 1699.542974]  arch_ftrace_update_code+0x9/0x10
[ 1699.543637]  ftrace_run_update_code+0x30/0xa0
[ 1699.544321]  ftrace_startup_enable+0x5e/0xa0
[ 1699.544993]  ftrace_startup+0x16d/0x240
[ 1699.545662]  register_ftrace_function+0x43/0x90
[ 1699.546405]  perf_ftrace_event_register+0xc1/0xf0
[ 1699.547139]  perf_trace_event_init+0xa0/0x4c0
[ 1699.547856]  perf_trace_init+0xda/0x160
[ 1699.548495]  perf_tp_event_init+0x57/0xa0
[ 1699.549135]  perf_try_init_event+0x83/0x270
[ 1699.549842]  perf_event_alloc+0xe3f/0x1c10
[ 1699.550468]  ? _raw_spin_unlock+0x2c/0x50
[ 1699.551098]  ? alloc_fd+0x20d/0x320
[ 1699.551751]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1699.552492]  ? write_comp_data+0x2f/0x90
[ 1699.553443]  __x64_sys_perf_event_open+0x26/0x30
[ 1699.554188]  do_syscall_64+0x37/0x80
[ 1699.554758]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1699.555511] RIP: 0033:0x7fac0740459d
[ 1699.556064] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1699.558678] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1699.559806] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1699.560815] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1699.561823] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1699.562847] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1699.563853] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1699.565085] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1699.565283] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1699.565977] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1699.565987] Call Trace:
[ 1699.565994]  dump_stack_lvl+0xa4/0xd3
[ 1699.566015]  dump_stack+0x15/0x17
[ 1699.566029]  check_preemption_disabled+0x167/0x180
[ 1699.566053]  ? do_nanosleep+0x155/0x2a0
[ 1699.566068]  ? hrtimer_wakeup+0x40/0x40
[ 1699.567165] caller is debug_smp_processor_id+0x1c/0x20
[ 1699.568523]  debug_smp_processor_id+0x1c/0x20
[ 1699.572489]  perf_ftrace_function_call+0x7c/0x360
[ 1699.573089]  ? 0xffffffffa0098099
[ 1699.573523]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1699.574135]  ? finish_task_switch+0xab/0x2a0
[ 1699.574669]  ? __schedule+0x46e/0xb20
[ 1699.575146]  ? do_nanosleep+0x9c/0x2a0
[ 1699.575627]  ? do_nanosleep+0x9c/0x2a0
[ 1699.576108]  0xffffffffa0098099
[ 1699.576513]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1699.577103]  ? lock_is_held_type+0xe2/0x140
[ 1699.577635]  ? do_nanosleep+0x140/0x2a0
[ 1699.578137]  ? hrtimer_try_to_cancel+0x5/0x290
[ 1699.578696]  ? write_comp_data+0x2f/0x90
[ 1699.579203]  hrtimer_try_to_cancel+0x5/0x290
[ 1699.579741]  do_nanosleep+0x155/0x2a0
[ 1699.580207]  ? hrtimer_try_to_cancel+0x5/0x290
[ 1699.580765]  ? do_nanosleep+0x155/0x2a0
[ 1699.581248]  ? write_comp_data+0x2f/0x90
[ 1699.581754]  hrtimer_nanosleep+0xf7/0x1b0
[ 1699.582280]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1699.582864]  __x64_sys_nanosleep+0xfc/0x150
[ 1699.583408]  do_syscall_64+0x37/0x80
[ 1699.583865]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1699.584494] RIP: 0033:0x7fac073cca18
[ 1699.584944] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1699.587180] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1699.588101] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1699.588964] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1699.589827] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1699.590702] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1699.591562] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1699.592460] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1699.592485] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1699.593524] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1699.594451] caller is debug_smp_processor_id+0x1c/0x20
[ 1699.595995] Call Trace:
[ 1699.596998]  dump_stack_lvl+0xa4/0xd3
[ 1699.597605]  dump_stack+0x15/0x17
[ 1699.598134]  check_preemption_disabled+0x167/0x180
[ 1699.598911]  debug_smp_processor_id+0x1c/0x20
[ 1699.599576]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1699.600433]  perf_trace_buf_alloc+0x3d/0x100
[ 1699.601087]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1699.601800]  ? cea_set_pte+0x140/0x140
[ 1699.602469]  perf_ftrace_function_call+0x209/0x360
[ 1699.603405]  ? 0xffffffffa0098099
[ 1699.604010]  ? check_preempt_curr_dl+0xa0/0xa0
[ 1699.604696]  0xffffffffa0098099
[ 1699.605290]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1699.606085]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1699.606781]  ? check_preempt_curr_dl+0xa0/0xa0
[ 1699.607453]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1699.608241]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1699.609029]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1699.609712]  copy_from_kernel_nofault_allowed+0x5/0x80
[ 1699.610481]  copy_from_kernel_nofault+0x2f/0x220
[ 1699.611179]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1699.611953]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1699.612750]  ftrace_verify_code+0x2c/0x70
[ 1699.613398]  ftrace_replace_code+0x69/0x170
[ 1699.614100]  ftrace_modify_all_code+0x1b1/0x270
[ 1699.614830]  arch_ftrace_update_code+0x9/0x10
[ 1699.615493]  ftrace_run_update_code+0x30/0xa0
[ 1699.616175]  ftrace_startup_enable+0x5e/0xa0
[ 1699.616848]  ftrace_startup+0x16d/0x240
[ 1699.617520]  register_ftrace_function+0x43/0x90
[ 1699.618237]  perf_ftrace_event_register+0xc1/0xf0
[ 1699.618968]  perf_trace_event_init+0xa0/0x4c0
[ 1699.619685]  perf_trace_init+0xda/0x160
[ 1699.620323]  perf_tp_event_init+0x57/0xa0
[ 1699.620960]  perf_try_init_event+0x83/0x270
[ 1699.621664]  perf_event_alloc+0xe3f/0x1c10
[ 1699.622290]  ? _raw_spin_unlock+0x2c/0x50
[ 1699.622919]  ? alloc_fd+0x20d/0x320
[ 1699.623573]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1699.624314]  ? write_comp_data+0x2f/0x90
[ 1699.625267]  __x64_sys_perf_event_open+0x26/0x30
[ 1699.625974]  do_syscall_64+0x37/0x80
[ 1699.626554]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1699.627301] RIP: 0033:0x7fac0740459d
[ 1699.627854] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1699.630402] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1699.631489] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1699.632492] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1699.633498] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1699.634508] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1699.635511] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1699.636743] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1699.636857] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1699.637630] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1699.638726] caller is debug_smp_processor_id+0x1c/0x20
[ 1699.639985] Call Trace:
[ 1699.639993]  dump_stack_lvl+0xa4/0xd3
[ 1699.641405]  dump_stack+0x15/0x17
[ 1699.641828]  check_preemption_disabled+0x167/0x180
[ 1699.642435]  ? hrtimer_try_to_cancel+0x38/0x290
[ 1699.642999]  ? __hrtimer_get_remaining+0x80/0x80
[ 1699.643578]  debug_smp_processor_id+0x1c/0x20
[ 1699.644123]  perf_ftrace_function_call+0x7c/0x360
[ 1699.644708]  ? do_nanosleep+0x155/0x2a0
[ 1699.645190]  ? hrtimer_wakeup+0x40/0x40
[ 1699.645675]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1699.646275]  ? do_nanosleep+0x155/0x2a0
[ 1699.646763]  ? perf_ftrace_function_call+0x4c/0x360
[ 1699.647376]  ? 0xffffffffa0098099
[ 1699.647796]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1699.648400]  ? do_nanosleep+0x9c/0x2a0
[ 1699.648875]  0xffffffffa0098099
[ 1699.649272]  ? do_nanosleep+0x9c/0x2a0
[ 1699.649751]  ? do_nanosleep+0x9c/0x2a0
[ 1699.650235]  ? do_nanosleep+0x140/0x2a0
[ 1699.650724]  ? hrtimer_active+0x5/0xb0
[ 1699.651200]  ? do_nanosleep+0x140/0x2a0
[ 1699.651683]  hrtimer_active+0x5/0xb0
[ 1699.652137]  hrtimer_try_to_cancel+0x38/0x290
[ 1699.652683]  ? hrtimer_active+0x5/0xb0
[ 1699.653155]  ? hrtimer_try_to_cancel+0x38/0x290
[ 1699.653728]  ? do_nanosleep+0x9c/0x2a0
[ 1699.654211]  do_nanosleep+0x155/0x2a0
[ 1699.654674]  ? write_comp_data+0x2f/0x90
[ 1699.655178]  hrtimer_nanosleep+0xf7/0x1b0
[ 1699.655692]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1699.656272]  __x64_sys_nanosleep+0xfc/0x150
[ 1699.656808]  do_syscall_64+0x37/0x80
[ 1699.657262]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1699.657890] RIP: 0033:0x7fac073cca18
[ 1699.658344] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1699.660558] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1699.661472] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1699.662320] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1699.663178] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1699.664038] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1699.664896] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1699.665788] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1699.665827] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1699.666776] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1699.666792] Call Trace:
[ 1699.667711] caller is debug_smp_processor_id+0x1c/0x20
[ 1699.669159]  dump_stack_lvl+0xa4/0xd3
[ 1699.670631]  dump_stack+0x15/0x17
[ 1699.671096]  check_preemption_disabled+0x167/0x180
[ 1699.671772]  debug_smp_processor_id+0x1c/0x20
[ 1699.672369]  perf_trace_buf_alloc+0x98/0x100
[ 1699.672955]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1699.673619]  ? cea_set_pte+0x140/0x140
[ 1699.674184]  perf_ftrace_function_call+0x209/0x360
[ 1699.674937]  ? 0xffffffffa0098099
[ 1699.675439]  ? check_preempt_curr_dl+0xa0/0xa0
[ 1699.676053]  0xffffffffa0098099
[ 1699.676547]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1699.677258]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1699.677877]  ? check_preempt_curr_dl+0xa0/0xa0
[ 1699.678490]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1699.679200]  ? ftrace_arch_code_modify_prepare+0x12/0x20
[ 1699.679911]  ? ftrace_get_addr_curr+0x1a8/0x280
[ 1699.680527]  copy_from_kernel_nofault_allowed+0x5/0x80
[ 1699.681220]  copy_from_kernel_nofault+0x2f/0x220
[ 1699.681849]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1699.682570]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1699.683257]  ftrace_verify_code+0x2c/0x70
[ 1699.683822]  ftrace_replace_code+0x69/0x170
[ 1699.684420]  ftrace_modify_all_code+0x1b1/0x270
[ 1699.685058]  arch_ftrace_update_code+0x9/0x10
[ 1699.685652]  ftrace_run_update_code+0x30/0xa0
[ 1699.686267]  ftrace_startup_enable+0x5e/0xa0
[ 1699.686860]  ftrace_startup+0x16d/0x240
[ 1699.687428]  register_ftrace_function+0x43/0x90
[ 1699.688055]  perf_ftrace_event_register+0xc1/0xf0
[ 1699.688705]  perf_trace_event_init+0xa0/0x4c0
[ 1699.689327]  perf_trace_init+0xda/0x160
[ 1699.689880]  perf_tp_event_init+0x57/0xa0
[ 1699.690455]  perf_try_init_event+0x83/0x270
[ 1699.691062]  perf_event_alloc+0xe3f/0x1c10
[ 1699.691619]  ? _raw_spin_unlock+0x2c/0x50
[ 1699.692178]  ? alloc_fd+0x20d/0x320
[ 1699.692717]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1699.693375]  ? write_comp_data+0x2f/0x90
[ 1699.694092]  __x64_sys_perf_event_open+0x26/0x30
[ 1699.694736]  do_syscall_64+0x37/0x80
[ 1699.695241]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1699.695918] RIP: 0033:0x7fac0740459d
[ 1699.696410] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1699.698769] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1699.699768] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1699.700691] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1699.701631] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1699.702589] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1699.703514] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1699.704548] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1699.705452] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1699.706834] Call Trace:
[ 1699.707149]  dump_stack_lvl+0xa4/0xd3
[ 1699.707620]  dump_stack+0x15/0x17
[ 1699.708044]  check_preemption_disabled+0x167/0x180
[ 1699.708641]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1699.709228]  ? __bpf_trace_sys_enter+0x10/0x10
[ 1699.709785]  debug_smp_processor_id+0x1c/0x20
[ 1699.710337]  perf_ftrace_function_call+0x7c/0x360
[ 1699.710926]  ? write_comp_data+0x2f/0x90
[ 1699.711427]  ? write_comp_data+0x2f/0x90
[ 1699.711927]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1699.712518]  ? write_comp_data+0x2f/0x90
[ 1699.713017]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1699.713615]  0xffffffffa0098099
[ 1699.714014]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1699.714624]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1699.715301]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1699.715892]  syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1699.716549]  syscall_exit_to_user_mode+0xd/0x60
[ 1699.717118]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1699.717795]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1699.718391]  do_syscall_64+0x46/0x80
[ 1699.718848]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1699.719475] RIP: 0033:0x7fac073cca18
[ 1699.719926] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1699.722141] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1699.723058] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1699.723919] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1699.724780] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1699.725640] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1699.726506] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1704.390115] check_preemption_disabled: 1488956 callbacks suppressed
[ 1704.390137] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1704.390244] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1704.390953] caller is debug_smp_processor_id+0x1c/0x20
[ 1704.391826] caller is debug_smp_processor_id+0x1c/0x20
[ 1704.392776] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1704.394854] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1704.396206] Call Trace:
[ 1704.396558]  dump_stack_lvl+0xa4/0xd3
[ 1704.397090]  dump_stack+0x15/0x17
[ 1704.397548]  check_preemption_disabled+0x167/0x180
[ 1704.398242]  debug_smp_processor_id+0x1c/0x20
[ 1704.398819]  perf_trace_buf_alloc+0x98/0x100
[ 1704.399387]  ? insn_get_opcode+0x1d5/0x3b0
[ 1704.399921]  ? insn_decode_from_regs+0x110/0x110
[ 1704.400536]  perf_ftrace_function_call+0x209/0x360
[ 1704.401380]  ? 0xffffffffa0098099
[ 1704.401959]  0xffffffffa0098099
[ 1704.402475]  ? 0xffffffffa0098099
[ 1704.402971]  ? insn_get_opcode+0x49/0x3b0
[ 1704.403541]  ? insn_get_prefixes.part.1+0x5/0x650
[ 1704.404155]  ? write_comp_data+0x2f/0x90
[ 1704.404705]  insn_get_prefixes.part.1+0x5/0x650
[ 1704.405299]  insn_get_opcode+0x1d5/0x3b0
[ 1704.405824]  ? insn_get_prefixes.part.1+0x5/0x650
[ 1704.406434]  ? insn_get_opcode+0x1d5/0x3b0
[ 1704.407035]  insn_get_modrm+0x12b/0x2a0
[ 1704.407608]  insn_get_sib+0x122/0x140
[ 1704.408150]  insn_get_displacement+0x157/0x270
[ 1704.408780]  insn_get_immediate+0x181/0x570
[ 1704.409392]  insn_get_length+0x75/0x90
[ 1704.409932]  insn_decode+0x9b/0x170
[ 1704.410441]  ? delete_from_page_cache_batch+0x740/0x740
[ 1704.411115]  text_poke_loc_init+0x63/0x140
[ 1704.411822]  ? delete_from_page_cache_batch+0x740/0x740
[ 1704.412540]  text_poke_queue+0x84/0xc0
[ 1704.413094]  ftrace_replace_code+0xfd/0x170
[ 1704.413708]  ftrace_modify_all_code+0x1b1/0x270
[ 1704.414357]  arch_ftrace_update_code+0x9/0x10
[ 1704.414933]  ftrace_run_update_code+0x30/0xa0
[ 1704.415530]  ftrace_startup_enable+0x5e/0xa0
[ 1704.416118]  ftrace_startup+0x16d/0x240
[ 1704.416714]  register_ftrace_function+0x43/0x90
[ 1704.417338]  perf_ftrace_event_register+0xc1/0xf0
[ 1704.417980]  perf_trace_event_init+0xa0/0x4c0
[ 1704.418628]  perf_trace_init+0xda/0x160
[ 1704.419191]  perf_tp_event_init+0x57/0xa0
[ 1704.419752]  perf_try_init_event+0x83/0x270
[ 1704.420384]  perf_event_alloc+0xe3f/0x1c10
[ 1704.420921]  ? _raw_spin_unlock+0x2c/0x50
[ 1704.421470]  ? alloc_fd+0x20d/0x320
[ 1704.422069]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1704.422719]  ? write_comp_data+0x2f/0x90
[ 1704.423619]  __x64_sys_perf_event_open+0x26/0x30
[ 1704.424292]  do_syscall_64+0x37/0x80
[ 1704.424841]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1704.425546] RIP: 0033:0x7fac0740459d
[ 1704.426080] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1704.428457] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1704.429488] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1704.430443] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1704.431389] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1704.432333] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1704.433277] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1704.434486] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1704.434663] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1704.435449] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1704.436455] caller is debug_smp_processor_id+0x1c/0x20
[ 1704.437824] Call Trace:
[ 1704.438850]  dump_stack_lvl+0xa4/0xd3
[ 1704.439387]  dump_stack+0x15/0x17
[ 1704.439845]  check_preemption_disabled+0x167/0x180
[ 1704.440477]  ? lock_timer_base+0x34/0x100
[ 1704.441007]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1704.441628]  debug_smp_processor_id+0x1c/0x20
[ 1704.442217]  perf_ftrace_function_call+0x7c/0x360
[ 1704.442858]  ? ftrace_ops_test+0x71/0xc0
[ 1704.443424]  ? ftrace_ops_test+0x71/0xc0
[ 1704.443969]  ? perf_trace_buf_update+0x70/0x70
[ 1704.444562]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1704.445203]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1704.445805]  ? write_comp_data+0x2f/0x90
[ 1704.446355]  ? perf_trace_buf_update+0x70/0x70
[ 1704.447012]  0xffffffffa0098099
[ 1704.447510]  ? ftrace_call+0x5/0x44
[ 1704.448007]  ? lock_timer_base+0xc0/0x100
[ 1704.448575]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1704.449167]  ? write_comp_data+0x2f/0x90
[ 1704.449715]  _raw_spin_lock_irqsave+0x5/0x70
[ 1704.450291]  lock_timer_base+0x34/0x100
[ 1704.450813]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1704.451396]  ? lock_timer_base+0x34/0x100
[ 1704.451992]  try_to_del_timer_sync+0x33/0x90
[ 1704.452556]  ? try_to_del_timer_sync+0x5/0x90
[ 1704.453166]  del_timer_sync+0xd3/0x130
[ 1704.453704]  schedule_timeout+0x34e/0x610
[ 1704.454308]  ? del_timer_sync+0x130/0x130
[ 1704.454887]  ? i915_init_ggtt+0x40/0x6b0
[ 1704.455483]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1704.456079]  ? rcu_gp_init+0x730/0x730
[ 1704.456589]  rcu_gp_kthread+0xdd/0x170
[ 1704.457145]  kthread+0x1e7/0x230
[ 1704.457606]  ? set_kthread_struct+0x80/0x80
[ 1704.458207]  ret_from_fork+0x1f/0x30
[ 1704.458885] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1704.459055] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1704.459875] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1704.460847] caller is debug_smp_processor_id+0x1c/0x20
[ 1704.462320] Call Trace:
[ 1704.462357]  dump_stack_lvl+0xa4/0xd3
[ 1704.462441]  dump_stack+0x15/0x17
[ 1704.464327]  check_preemption_disabled+0x167/0x180
[ 1704.465069]  debug_smp_processor_id+0x1c/0x20
[ 1704.465705]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1704.466494]  perf_tp_event+0x331/0x4e0
[ 1704.467258]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1704.468183]  ? arch_local_irq_enable+0x10/0x12
[ 1704.468832]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1704.469526]  ? dump_stack_lvl+0xcc/0xd3
[ 1704.470173]  ? insn_get_opcode+0x1d5/0x3b0
[ 1704.470772]  ? insn_decode_from_regs+0x110/0x110
[ 1704.471455]  perf_ftrace_function_call+0x248/0x360
[ 1704.472150]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1704.472790]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1704.473460]  ? perf_ftrace_function_call+0x248/0x360
[ 1704.474428]  ? 0xffffffffa0098099
[ 1704.475054]  0xffffffffa0098099
[ 1704.475600]  ? 0xffffffffa0098099
[ 1704.476138]  ? insn_get_opcode+0x49/0x3b0
[ 1704.476758]  ? insn_get_prefixes.part.1+0x5/0x650
[ 1704.477428]  ? write_comp_data+0x2f/0x90
[ 1704.478026]  insn_get_prefixes.part.1+0x5/0x650
[ 1704.478682]  insn_get_opcode+0x1d5/0x3b0
[ 1704.479255]  ? insn_get_prefixes.part.1+0x5/0x650
[ 1704.479913]  ? insn_get_opcode+0x1d5/0x3b0
[ 1704.480567]  insn_get_modrm+0x12b/0x2a0
[ 1704.481189]  insn_get_sib+0x122/0x140
[ 1704.481778]  insn_get_displacement+0x157/0x270
[ 1704.482471]  insn_get_immediate+0x181/0x570
[ 1704.483138]  insn_get_length+0x75/0x90
[ 1704.483726]  insn_decode+0x9b/0x170
[ 1704.484270]  ? delete_from_page_cache_batch+0x740/0x740
[ 1704.485005]  text_poke_loc_init+0x63/0x140
[ 1704.485769]  ? delete_from_page_cache_batch+0x740/0x740
[ 1704.486559]  text_poke_queue+0x84/0xc0
[ 1704.487162]  ftrace_replace_code+0xfd/0x170
[ 1704.487827]  ftrace_modify_all_code+0x1b1/0x270
[ 1704.488523]  arch_ftrace_update_code+0x9/0x10
[ 1704.489156]  ftrace_run_update_code+0x30/0xa0
[ 1704.489807]  ftrace_startup_enable+0x5e/0xa0
[ 1704.490454]  ftrace_startup+0x16d/0x240
[ 1704.491102]  register_ftrace_function+0x43/0x90
[ 1704.491776]  perf_ftrace_event_register+0xc1/0xf0
[ 1704.492473]  perf_trace_event_init+0xa0/0x4c0
[ 1704.493163]  perf_trace_init+0xda/0x160
[ 1704.493776]  perf_tp_event_init+0x57/0xa0
[ 1704.494394]  perf_try_init_event+0x83/0x270
[ 1704.495073]  perf_event_alloc+0xe3f/0x1c10
[ 1704.495657]  ? _raw_spin_unlock+0x2c/0x50
[ 1704.496253]  ? alloc_fd+0x20d/0x320
[ 1704.496891]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1704.497596]  ? write_comp_data+0x2f/0x90
[ 1704.498557]  __x64_sys_perf_event_open+0x26/0x30
[ 1704.499230]  do_syscall_64+0x37/0x80
[ 1704.499772]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1704.500477] RIP: 0033:0x7fac0740459d
[ 1704.501001] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1704.503381] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1704.504406] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1704.505353] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1704.506302] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1704.507246] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1704.508192] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1704.509392] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1704.509583] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1704.510354] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1704.510375] Call Trace:
[ 1704.510403]  dump_stack_lvl+0xa4/0xd3
[ 1704.510468]  dump_stack+0x15/0x17
[ 1704.510505]  check_preemption_disabled+0x167/0x180
[ 1704.511581] caller is debug_smp_processor_id+0x1c/0x20
[ 1704.512947]  ? prepare_to_swait_event+0x1b/0xf0
[ 1704.515954]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1704.516577]  debug_smp_processor_id+0x1c/0x20
[ 1704.517158]  perf_ftrace_function_call+0x7c/0x360
[ 1704.517770]  ? ftrace_ops_test+0x71/0xc0
[ 1704.518385]  ? trace_hardirqs_on+0x3f/0x170
[ 1704.518982]  ? write_comp_data+0x2f/0x90
[ 1704.519520]  ? perf_trace_buf_update+0x70/0x70
[ 1704.520110]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1704.520802]  0xffffffffa0098099
[ 1704.521281]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1704.521936]  ? del_timer_sync+0xde/0x130
[ 1704.522496]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1704.523123]  _raw_spin_lock_irqsave+0x5/0x70
[ 1704.523695]  prepare_to_swait_event+0x1b/0xf0
[ 1704.524275]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1704.524855]  ? prepare_to_swait_event+0x1b/0xf0
[ 1704.525482]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1704.526081]  ? rcu_gp_init+0x730/0x730
[ 1704.526589]  rcu_gp_kthread+0xdd/0x170
[ 1704.527143]  kthread+0x1e7/0x230
[ 1704.527600]  ? set_kthread_struct+0x80/0x80
[ 1704.528196]  ret_from_fork+0x1f/0x30
[ 1704.528872] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1704.528975] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1704.529946] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1704.530991] caller is debug_smp_processor_id+0x1c/0x20
[ 1704.532488] Call Trace:
[ 1704.533524]  dump_stack_lvl+0xa4/0xd3
[ 1704.534188]  dump_stack+0x15/0x17
[ 1704.534745]  check_preemption_disabled+0x167/0x180
[ 1704.535498]  ? insn_get_prefixes.part.1+0x114/0x650
[ 1704.536243]  ? bad_get_user+0xd/0xd
[ 1704.536858]  debug_smp_processor_id+0x1c/0x20
[ 1704.537555]  perf_ftrace_function_call+0x7c/0x360
[ 1704.538306]  ? perf_ftrace_function_call+0x248/0x360
[ 1704.539104]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1704.539811]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1704.540551]  ? insn_get_opcode+0x1d5/0x3b0
[ 1704.541215]  ? perf_ftrace_function_call+0x4c/0x360
[ 1704.542341]  0xffffffffa0098099
[ 1704.543063]  ? insn_get_prefixes.part.1+0xb3/0x650
[ 1704.543874]  ? inat_get_opcode_attribute+0x5/0x20
[ 1704.544617]  ? write_comp_data+0x2f/0x90
[ 1704.545287]  inat_get_opcode_attribute+0x5/0x20
[ 1704.546008]  insn_get_prefixes.part.1+0x114/0x650
[ 1704.546758]  ? inat_get_opcode_attribute+0x5/0x20
[ 1704.547482]  ? insn_get_prefixes.part.1+0x114/0x650
[ 1704.548246]  ? write_comp_data+0x2f/0x90
[ 1704.549006]  insn_get_opcode+0x1d5/0x3b0
[ 1704.549732]  insn_get_modrm+0x12b/0x2a0
[ 1704.550455]  insn_get_sib+0x122/0x140
[ 1704.551129]  insn_get_displacement+0x157/0x270
[ 1704.551906]  insn_get_immediate+0x181/0x570
[ 1704.552666]  insn_get_length+0x75/0x90
[ 1704.553331]  insn_decode+0x9b/0x170
[ 1704.553944]  ? delete_from_page_cache_batch+0x740/0x740
[ 1704.554762]  text_poke_loc_init+0x63/0x140
[ 1704.555670]  ? delete_from_page_cache_batch+0x740/0x740
[ 1704.556551]  text_poke_queue+0x84/0xc0
[ 1704.557237]  ftrace_replace_code+0xfd/0x170
[ 1704.558000]  ftrace_modify_all_code+0x1b1/0x270
[ 1704.558890]  arch_ftrace_update_code+0x9/0x10
[ 1704.559587]  ftrace_run_update_code+0x30/0xa0
[ 1704.560318]  ftrace_startup_enable+0x5e/0xa0
[ 1704.561046]  ftrace_startup+0x16d/0x240
[ 1704.561795]  register_ftrace_function+0x43/0x90
[ 1704.562563]  perf_ftrace_event_register+0xc1/0xf0
[ 1704.563341]  perf_trace_event_init+0xa0/0x4c0
[ 1704.564154]  perf_trace_init+0xda/0x160
[ 1704.564852]  perf_tp_event_init+0x57/0xa0
[ 1704.565565]  perf_try_init_event+0x83/0x270
[ 1704.566363]  perf_event_alloc+0xe3f/0x1c10
[ 1704.567007]  ? _raw_spin_unlock+0x2c/0x50
[ 1704.567680]  ? alloc_fd+0x20d/0x320
[ 1704.568432]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1704.569218]  ? write_comp_data+0x2f/0x90
[ 1704.570422]  __x64_sys_perf_event_open+0x26/0x30
[ 1704.571169]  do_syscall_64+0x37/0x80
[ 1704.571778]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1704.572550] RIP: 0033:0x7fac0740459d
[ 1704.573134] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1704.575708] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1704.576830] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1704.577857] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1704.578891] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1704.579919] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1704.580945] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1704.582354] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1704.582530] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1704.583317] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1704.584406] caller is debug_smp_processor_id+0x1c/0x20
[ 1704.585809] Call Trace:
[ 1704.586933]  dump_stack_lvl+0xa4/0xd3
[ 1704.587515]  dump_stack+0x15/0x17
[ 1704.588014]  check_preemption_disabled+0x167/0x180
[ 1704.588651]  ? finish_swait+0x41/0x80
[ 1704.589149]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1704.589784]  debug_smp_processor_id+0x1c/0x20
[ 1704.590407]  perf_ftrace_function_call+0x7c/0x360
[ 1704.591022]  ? ftrace_ops_test+0x71/0xc0
[ 1704.591561]  ? rcu_advance_cbs+0x70/0x70
[ 1704.592121]  ? write_comp_data+0x2f/0x90
[ 1704.592660]  ? perf_trace_buf_update+0x70/0x70
[ 1704.593252]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1704.593907]  ? write_comp_data+0x2f/0x90
[ 1704.594464]  ? perf_trace_buf_update+0x70/0x70
[ 1704.595059]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1704.595758]  0xffffffffa0098099
[ 1704.596256]  ? trace_hardirqs_on+0x3f/0x170
[ 1704.596879]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1704.597507]  _raw_spin_lock_irqsave+0x5/0x70
[ 1704.598090]  finish_swait+0x41/0x80
[ 1704.598572]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1704.599155]  ? finish_swait+0x41/0x80
[ 1704.599681]  rcu_gp_fqs_loop+0x2da/0x410
[ 1704.600274]  ? rcu_gp_init+0x730/0x730
[ 1704.600782]  rcu_gp_kthread+0xdd/0x170
[ 1704.601336]  kthread+0x1e7/0x230
[ 1704.601795]  ? set_kthread_struct+0x80/0x80
[ 1704.602403]  ret_from_fork+0x1f/0x30
[ 1704.603086] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1704.603212] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1704.604175] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1704.605145] caller is debug_smp_processor_id+0x1c/0x20
[ 1704.606722] Call Trace:
[ 1704.606775]  dump_stack_lvl+0xa4/0xd3
[ 1704.608413]  dump_stack+0x15/0x17
[ 1704.608970]  check_preemption_disabled+0x167/0x180
[ 1704.609813]  debug_smp_processor_id+0x1c/0x20
[ 1704.610515]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1704.611435]  perf_trace_buf_alloc+0x3d/0x100
[ 1704.612120]  ? insn_get_prefixes.part.1+0x114/0x650
[ 1704.612866]  ? bad_get_user+0xd/0xd
[ 1704.613465]  perf_ftrace_function_call+0x209/0x360
[ 1704.614560]  ? 0xffffffffa0098099
[ 1704.615306]  0xffffffffa0098099
[ 1704.616027]  ? insn_get_prefixes.part.1+0xb3/0x650
[ 1704.616830]  ? inat_get_opcode_attribute+0x5/0x20
[ 1704.617575]  ? write_comp_data+0x2f/0x90
[ 1704.618252]  inat_get_opcode_attribute+0x5/0x20
[ 1704.618972]  insn_get_prefixes.part.1+0x114/0x650
[ 1704.619711]  ? inat_get_opcode_attribute+0x5/0x20
[ 1704.620437]  ? insn_get_prefixes.part.1+0x114/0x650
[ 1704.621201]  ? write_comp_data+0x2f/0x90
[ 1704.621961]  insn_get_opcode+0x1d5/0x3b0
[ 1704.622690]  insn_get_modrm+0x12b/0x2a0
[ 1704.623404]  insn_get_sib+0x122/0x140
[ 1704.624077]  insn_get_displacement+0x157/0x270
[ 1704.624853]  insn_get_immediate+0x181/0x570
[ 1704.625612]  insn_get_length+0x75/0x90
[ 1704.626284]  insn_decode+0x9b/0x170
[ 1704.626899]  ? delete_from_page_cache_batch+0x740/0x740
[ 1704.627710]  text_poke_loc_init+0x63/0x140
[ 1704.628617]  ? delete_from_page_cache_batch+0x740/0x740
[ 1704.629498]  text_poke_queue+0x84/0xc0
[ 1704.630187]  ftrace_replace_code+0xfd/0x170
[ 1704.630951]  ftrace_modify_all_code+0x1b1/0x270
[ 1704.631739]  arch_ftrace_update_code+0x9/0x10
[ 1704.632435]  ftrace_run_update_code+0x30/0xa0
[ 1704.633165]  ftrace_startup_enable+0x5e/0xa0
[ 1704.633883]  ftrace_startup+0x16d/0x240
[ 1704.634642]  register_ftrace_function+0x43/0x90
[ 1704.635395]  perf_ftrace_event_register+0xc1/0xf0
[ 1704.636172]  perf_trace_event_init+0xa0/0x4c0
[ 1704.636956]  perf_trace_init+0xda/0x160
[ 1704.637654]  perf_tp_event_init+0x57/0xa0
[ 1704.638346]  perf_try_init_event+0x83/0x270
[ 1704.639126]  perf_event_alloc+0xe3f/0x1c10
[ 1704.639778]  ? _raw_spin_unlock+0x2c/0x50
[ 1704.640446]  ? alloc_fd+0x20d/0x320
[ 1704.641199]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1704.641985]  ? write_comp_data+0x2f/0x90
[ 1704.643200]  __x64_sys_perf_event_open+0x26/0x30
[ 1704.643952]  do_syscall_64+0x37/0x80
[ 1704.644560]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1704.645331] RIP: 0033:0x7fac0740459d
[ 1704.645915] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1704.648532] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1704.649663] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1704.650705] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1704.651738] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1704.652772] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1704.653802] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1704.655214] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1704.655385] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1704.656174] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1704.657183] caller is debug_smp_processor_id+0x1c/0x20
[ 1704.658576] Call Trace:
[ 1704.658609]  dump_stack_lvl+0xa4/0xd3
[ 1704.658675]  dump_stack+0x15/0x17
[ 1704.658711]  check_preemption_disabled+0x167/0x180
[ 1704.658751]  ? force_qs_rnp+0xd0/0x2c0
[ 1704.661666]  ? preempt_schedule+0x30/0x30
[ 1704.662230]  debug_smp_processor_id+0x1c/0x20
[ 1704.662811]  perf_ftrace_function_call+0x7c/0x360
[ 1704.663425]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1704.664064]  ? ftrace_ops_test+0x71/0xc0
[ 1704.664602]  ? rcu_advance_cbs+0x70/0x70
[ 1704.665156]  ? write_comp_data+0x2f/0x90
[ 1704.665693]  ? perf_trace_buf_update+0x70/0x70
[ 1704.666288]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1704.666925]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1704.667516]  ? force_qs_rnp+0xcb/0x2c0
[ 1704.668023]  ? sched_show_task+0x70/0x70
[ 1704.668580]  ? rcu_gp_torture_wait+0x20/0x20
[ 1704.669161]  0xffffffffa0098099
[ 1704.669595]  ? rcu_exp_wait_wake+0x4c0/0x4c0
[ 1704.670297]  ? __cond_resched+0x5/0x30
[ 1704.670823]  ? ___might_sleep+0x143/0x170
[ 1704.671361]  __cond_resched+0x5/0x30
[ 1704.671851]  force_qs_rnp+0xd0/0x2c0
[ 1704.672340]  ? __cond_resched+0x5/0x30
[ 1704.672839]  ? force_qs_rnp+0xd0/0x2c0
[ 1704.673414]  rcu_gp_fqs_loop+0x2eb/0x410
[ 1704.674007]  ? rcu_gp_init+0x730/0x730
[ 1704.674526]  rcu_gp_kthread+0xdd/0x170
[ 1704.675088]  kthread+0x1e7/0x230
[ 1704.675555]  ? set_kthread_struct+0x80/0x80
[ 1704.676153]  ret_from_fork+0x1f/0x30
[ 1704.676828] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1704.677017] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1704.677821] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1704.678961] caller is debug_smp_processor_id+0x1c/0x20
[ 1704.680345] Call Trace:
[ 1704.681352]  dump_stack_lvl+0xa4/0xd3
[ 1704.681931]  dump_stack+0x15/0x17
[ 1704.682439]  check_preemption_disabled+0x167/0x180
[ 1704.683182]  debug_smp_processor_id+0x1c/0x20
[ 1704.683812]  perf_trace_buf_alloc+0x98/0x100
[ 1704.684430]  ? insn_get_prefixes.part.1+0x114/0x650
[ 1704.685108]  ? bad_get_user+0xd/0xd
[ 1704.685641]  perf_ftrace_function_call+0x209/0x360
[ 1704.686564]  ? 0xffffffffa0098099
[ 1704.687189]  0xffffffffa0098099
[ 1704.687793]  ? insn_get_prefixes.part.1+0xb3/0x650
[ 1704.688510]  ? inat_get_opcode_attribute+0x5/0x20
[ 1704.689183]  ? write_comp_data+0x2f/0x90
[ 1704.689786]  inat_get_opcode_attribute+0x5/0x20
[ 1704.690449]  insn_get_prefixes.part.1+0x114/0x650
[ 1704.691121]  ? inat_get_opcode_attribute+0x5/0x20
[ 1704.691781]  ? insn_get_prefixes.part.1+0x114/0x650
[ 1704.692472]  ? write_comp_data+0x2f/0x90
[ 1704.693135]  insn_get_opcode+0x1d5/0x3b0
[ 1704.693778]  insn_get_modrm+0x12b/0x2a0
[ 1704.694408]  insn_get_sib+0x122/0x140
[ 1704.694998]  insn_get_displacement+0x157/0x270
[ 1704.695684]  insn_get_immediate+0x181/0x570
[ 1704.696349]  insn_get_length+0x75/0x90
[ 1704.696937]  insn_decode+0x9b/0x170
[ 1704.697479]  ? delete_from_page_cache_batch+0x740/0x740
[ 1704.698223]  text_poke_loc_init+0x63/0x140
[ 1704.698987]  ? delete_from_page_cache_batch+0x740/0x740
[ 1704.699770]  text_poke_queue+0x84/0xc0
[ 1704.700370]  ftrace_replace_code+0xfd/0x170
[ 1704.701036]  ftrace_modify_all_code+0x1b1/0x270
[ 1704.701732]  arch_ftrace_update_code+0x9/0x10
[ 1704.702381]  ftrace_run_update_code+0x30/0xa0
[ 1704.703055]  ftrace_startup_enable+0x5e/0xa0
[ 1704.703704]  ftrace_startup+0x16d/0x240
[ 1704.704350]  register_ftrace_function+0x43/0x90
[ 1704.705024]  perf_ftrace_event_register+0xc1/0xf0
[ 1704.705727]  perf_trace_event_init+0xa0/0x4c0
[ 1704.706428]  perf_trace_init+0xda/0x160
[ 1704.707041]  perf_tp_event_init+0x57/0xa0
[ 1704.707650]  perf_try_init_event+0x83/0x270
[ 1704.708329]  perf_event_alloc+0xe3f/0x1c10
[ 1704.708915]  ? _raw_spin_unlock+0x2c/0x50
[ 1704.709512]  ? alloc_fd+0x20d/0x320
[ 1704.710153]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1704.710860]  ? write_comp_data+0x2f/0x90
[ 1704.711814]  __x64_sys_perf_event_open+0x26/0x30
[ 1704.712487]  do_syscall_64+0x37/0x80
[ 1704.713028]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1704.713734] RIP: 0033:0x7fac0740459d
[ 1704.714259] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1704.716643] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1704.717668] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1704.718617] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1704.719565] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1704.720515] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1704.721464] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1704.722673] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1704.723717] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1704.725129] Call Trace:
[ 1704.725483]  dump_stack_lvl+0xa4/0xd3
[ 1704.726020]  dump_stack+0x15/0x17
[ 1704.726499]  check_preemption_disabled+0x167/0x180
[ 1704.727142]  ? do_epoll_wait+0x3b3/0xd80
[ 1704.727673]  ? __mutex_lock+0x9f0/0x9f0
[ 1704.728219]  debug_smp_processor_id+0x1c/0x20
[ 1704.728811]  perf_ftrace_function_call+0x7c/0x360
[ 1704.729500]  ? ftrace_call+0x5/0x44
[ 1704.729976]  ? trace_hardirqs_on+0x6a/0x170
[ 1704.730585]  ? finish_task_switch+0xb0/0x2a0
[ 1704.731155]  ? finish_task_switch+0x70/0x2a0
[ 1704.731751]  ? trace_hardirqs_on+0x3f/0x170
[ 1704.732308]  ? finish_task_switch+0x70/0x2a0
[ 1704.732904]  ? preempt_count_sub+0x5/0xa0
[ 1704.733505]  0xffffffffa0098099
[ 1704.733953]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1704.734605]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1704.735354]  ? do_epoll_wait+0x36b/0xd80
[ 1704.735920]  ? mutex_lock_nested+0x5/0x20
[ 1704.736467]  ? write_comp_data+0x2f/0x90
[ 1704.737022]  mutex_lock_nested+0x5/0x20
[ 1704.737550]  do_epoll_wait+0x3b3/0xd80
[ 1704.738077]  ? mutex_lock_nested+0x5/0x20
[ 1704.738620]  ? do_epoll_wait+0x3b3/0xd80
[ 1704.739314]  ? wait_woken+0x90/0x90
[ 1704.739880]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1704.740515]  do_syscall_64+0x37/0x80
[ 1704.741019]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1704.741681] RIP: 0033:0x7f8a39143b20
[ 1704.742182] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1704.744459] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1704.745424] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1704.746330] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1704.747225] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1704.748122] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1704.749017] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1709.394118] check_preemption_disabled: 879745 callbacks suppressed
[ 1709.394148] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1709.394233] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1709.395096] caller is debug_smp_processor_id+0x1c/0x20
[ 1709.396057] caller is debug_smp_processor_id+0x1c/0x20
[ 1709.397184] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1709.399590] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1709.401189] Call Trace:
[ 1709.401622]  dump_stack_lvl+0xa4/0xd3
[ 1709.402282]  dump_stack+0x15/0x17
[ 1709.402838]  check_preemption_disabled+0x167/0x180
[ 1709.403590]  ? insn_get_displacement+0x157/0x270
[ 1709.404300]  ? insn_rip_relative+0xb0/0xb0
[ 1709.404993]  debug_smp_processor_id+0x1c/0x20
[ 1709.405688]  perf_ftrace_function_call+0x7c/0x360
[ 1709.406435]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1709.407175]  ? insn_get_immediate+0x181/0x570
[ 1709.407866]  ? perf_ftrace_function_call+0x4c/0x360
[ 1709.409074]  0xffffffffa0098099
[ 1709.409692]  ? 0xffffffffa0098099
[ 1709.410331]  ? insn_get_displacement+0x47/0x270
[ 1709.411103]  ? insn_get_sib+0x5/0x140
[ 1709.411704]  ? write_comp_data+0x2f/0x90
[ 1709.412376]  insn_get_sib+0x5/0x140
[ 1709.412955]  insn_get_displacement+0x157/0x270
[ 1709.413660]  ? insn_get_sib+0x5/0x140
[ 1709.414245]  ? insn_get_displacement+0x157/0x270
[ 1709.415042]  insn_get_immediate+0x181/0x570
[ 1709.415799]  insn_get_length+0x75/0x90
[ 1709.416465]  insn_decode+0x9b/0x170
[ 1709.417078]  ? lsm_read+0x50/0x50
[ 1709.417635]  text_poke_loc_init+0x63/0x140
[ 1709.418553]  ? lsm_read+0x50/0x50
[ 1709.419180]  text_poke_queue+0x84/0xc0
[ 1709.419867]  ftrace_replace_code+0xfd/0x170
[ 1709.420628]  ftrace_modify_all_code+0x1b1/0x270
[ 1709.421417]  arch_ftrace_update_code+0x9/0x10
[ 1709.422116]  ftrace_run_update_code+0x30/0xa0
[ 1709.422846]  ftrace_startup_enable+0x5e/0xa0
[ 1709.423564]  ftrace_startup+0x16d/0x240
[ 1709.424314]  register_ftrace_function+0x43/0x90
[ 1709.425067]  perf_ftrace_event_register+0xc1/0xf0
[ 1709.425845]  perf_trace_event_init+0xa0/0x4c0
[ 1709.426632]  perf_trace_init+0xda/0x160
[ 1709.427332]  perf_tp_event_init+0x57/0xa0
[ 1709.428017]  perf_try_init_event+0x83/0x270
[ 1709.428797]  perf_event_alloc+0xe3f/0x1c10
[ 1709.429442]  ? _raw_spin_unlock+0x2c/0x50
[ 1709.430118]  ? alloc_fd+0x20d/0x320
[ 1709.430873]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1709.431661]  ? write_comp_data+0x2f/0x90
[ 1709.432861]  __x64_sys_perf_event_open+0x26/0x30
[ 1709.433605]  do_syscall_64+0x37/0x80
[ 1709.434215]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1709.434986] RIP: 0033:0x7fac0740459d
[ 1709.435567] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1709.438130] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1709.439253] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1709.440278] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1709.441304] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1709.442339] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1709.443366] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1709.444764] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1709.444946] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1709.445726] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1709.446976] caller is debug_smp_processor_id+0x1c/0x20
[ 1709.448191] Call Trace:
[ 1709.449262]  dump_stack_lvl+0xa4/0xd3
[ 1709.449798]  dump_stack+0x15/0x17
[ 1709.450266]  check_preemption_disabled+0x167/0x180
[ 1709.450899]  ? lock_timer_base+0x34/0x100
[ 1709.451431]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1709.452052]  debug_smp_processor_id+0x1c/0x20
[ 1709.452634]  perf_ftrace_function_call+0x7c/0x360
[ 1709.453275]  ? ftrace_ops_test+0x71/0xc0
[ 1709.453839]  ? ftrace_ops_test+0x71/0xc0
[ 1709.454386]  ? perf_trace_buf_update+0x70/0x70
[ 1709.454978]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1709.455616]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1709.456217]  ? write_comp_data+0x2f/0x90
[ 1709.456755]  ? perf_trace_buf_update+0x70/0x70
[ 1709.457410]  0xffffffffa0098099
[ 1709.457907]  ? ftrace_call+0x5/0x44
[ 1709.458413]  ? lock_timer_base+0xc0/0x100
[ 1709.458980]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1709.459571]  ? write_comp_data+0x2f/0x90
[ 1709.460116]  _raw_spin_lock_irqsave+0x5/0x70
[ 1709.460688]  lock_timer_base+0x34/0x100
[ 1709.461207]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1709.461793]  ? lock_timer_base+0x34/0x100
[ 1709.462398]  try_to_del_timer_sync+0x33/0x90
[ 1709.462961]  ? try_to_del_timer_sync+0x5/0x90
[ 1709.463570]  del_timer_sync+0xd3/0x130
[ 1709.464108]  schedule_timeout+0x34e/0x610
[ 1709.464704]  ? del_timer_sync+0x130/0x130
[ 1709.465287]  ? i915_init_ggtt+0x40/0x6b0
[ 1709.465883]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1709.466490]  ? rcu_gp_init+0x730/0x730
[ 1709.467006]  rcu_gp_kthread+0xdd/0x170
[ 1709.467560]  kthread+0x1e7/0x230
[ 1709.468024]  ? set_kthread_struct+0x80/0x80
[ 1709.468619]  ret_from_fork+0x1f/0x30
[ 1709.469296] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1709.469411] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1709.470380] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1709.470416] Call Trace:
[ 1709.470468]  dump_stack_lvl+0xa4/0xd3
[ 1709.471414] caller is debug_smp_processor_id+0x1c/0x20
[ 1709.473058]  dump_stack+0x15/0x17
[ 1709.475084]  check_preemption_disabled+0x167/0x180
[ 1709.475933]  debug_smp_processor_id+0x1c/0x20
[ 1709.476631]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1709.477557]  perf_trace_buf_alloc+0x3d/0x100
[ 1709.478248]  ? insn_get_displacement+0x157/0x270
[ 1709.478959]  ? insn_rip_relative+0xb0/0xb0
[ 1709.479636]  perf_ftrace_function_call+0x209/0x360
[ 1709.480732]  ? 0xffffffffa0098099
[ 1709.481478]  0xffffffffa0098099
[ 1709.482101]  ? 0xffffffffa0098099
[ 1709.482739]  ? insn_get_displacement+0x47/0x270
[ 1709.483510]  ? insn_get_sib+0x5/0x140
[ 1709.484112]  ? write_comp_data+0x2f/0x90
[ 1709.484783]  insn_get_sib+0x5/0x140
[ 1709.485364]  insn_get_displacement+0x157/0x270
[ 1709.486077]  ? insn_get_sib+0x5/0x140
[ 1709.486670]  ? insn_get_displacement+0x157/0x270
[ 1709.487476]  insn_get_immediate+0x181/0x570
[ 1709.488242]  insn_get_length+0x75/0x90
[ 1709.488913]  insn_decode+0x9b/0x170
[ 1709.489533]  ? lsm_read+0x50/0x50
[ 1709.490102]  text_poke_loc_init+0x63/0x140
[ 1709.491014]  ? lsm_read+0x50/0x50
[ 1709.491644]  text_poke_queue+0x84/0xc0
[ 1709.492336]  ftrace_replace_code+0xfd/0x170
[ 1709.493101]  ftrace_modify_all_code+0x1b1/0x270
[ 1709.493891]  arch_ftrace_update_code+0x9/0x10
[ 1709.494594]  ftrace_run_update_code+0x30/0xa0
[ 1709.495331]  ftrace_startup_enable+0x5e/0xa0
[ 1709.496055]  ftrace_startup+0x16d/0x240
[ 1709.496808]  register_ftrace_function+0x43/0x90
[ 1709.497563]  perf_ftrace_event_register+0xc1/0xf0
[ 1709.498356]  perf_trace_event_init+0xa0/0x4c0
[ 1709.499144]  perf_trace_init+0xda/0x160
[ 1709.499846]  perf_tp_event_init+0x57/0xa0
[ 1709.500537]  perf_try_init_event+0x83/0x270
[ 1709.501320]  perf_event_alloc+0xe3f/0x1c10
[ 1709.501971]  ? _raw_spin_unlock+0x2c/0x50
[ 1709.502645]  ? alloc_fd+0x20d/0x320
[ 1709.503399]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1709.504187]  ? write_comp_data+0x2f/0x90
[ 1709.505389]  __x64_sys_perf_event_open+0x26/0x30
[ 1709.506140]  do_syscall_64+0x37/0x80
[ 1709.506750]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1709.507523] RIP: 0033:0x7fac0740459d
[ 1709.508107] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1709.510679] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1709.511805] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1709.512834] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1709.513862] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1709.514898] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1709.515929] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1709.517330] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1709.517499] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1709.518316] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1709.518339] Call Trace:
[ 1709.518367]  dump_stack_lvl+0xa4/0xd3
[ 1709.518433]  dump_stack+0x15/0x17
[ 1709.518469]  check_preemption_disabled+0x167/0x180
[ 1709.519468] caller is debug_smp_processor_id+0x1c/0x20
[ 1709.520838]  ? prepare_to_swait_event+0x1b/0xf0
[ 1709.523844]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1709.524463]  debug_smp_processor_id+0x1c/0x20
[ 1709.525045]  perf_ftrace_function_call+0x7c/0x360
[ 1709.525658]  ? ftrace_ops_test+0x71/0xc0
[ 1709.526277]  ? trace_hardirqs_on+0x3f/0x170
[ 1709.526874]  ? write_comp_data+0x2f/0x90
[ 1709.527412]  ? perf_trace_buf_update+0x70/0x70
[ 1709.528002]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1709.528697]  0xffffffffa0098099
[ 1709.529175]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1709.529832]  ? del_timer_sync+0xde/0x130
[ 1709.530405]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1709.531042]  _raw_spin_lock_irqsave+0x5/0x70
[ 1709.531616]  prepare_to_swait_event+0x1b/0xf0
[ 1709.532198]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1709.532780]  ? prepare_to_swait_event+0x1b/0xf0
[ 1709.533408]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1709.534001]  ? rcu_gp_init+0x730/0x730
[ 1709.534520]  rcu_gp_kthread+0xdd/0x170
[ 1709.535075]  kthread+0x1e7/0x230
[ 1709.535535]  ? set_kthread_struct+0x80/0x80
[ 1709.536133]  ret_from_fork+0x1f/0x30
[ 1709.536808] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1709.536913] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1709.537806] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1709.538850] caller is debug_smp_processor_id+0x1c/0x20
[ 1709.540241] Call Trace:
[ 1709.541238]  dump_stack_lvl+0xa4/0xd3
[ 1709.541818]  dump_stack+0x15/0x17
[ 1709.542337]  check_preemption_disabled+0x167/0x180
[ 1709.543081]  debug_smp_processor_id+0x1c/0x20
[ 1709.543709]  perf_trace_buf_alloc+0x98/0x100
[ 1709.544329]  ? insn_get_displacement+0x157/0x270
[ 1709.544975]  ? insn_rip_relative+0xb0/0xb0
[ 1709.545581]  perf_ftrace_function_call+0x209/0x360
[ 1709.546499]  ? 0xffffffffa0098099
[ 1709.547124]  0xffffffffa0098099
[ 1709.547656]  ? 0xffffffffa0098099
[ 1709.548207]  ? insn_get_displacement+0x47/0x270
[ 1709.548890]  ? insn_get_sib+0x5/0x140
[ 1709.549431]  ? write_comp_data+0x2f/0x90
[ 1709.550028]  insn_get_sib+0x5/0x140
[ 1709.550551]  insn_get_displacement+0x157/0x270
[ 1709.551192]  ? insn_get_sib+0x5/0x140
[ 1709.551720]  ? insn_get_displacement+0x157/0x270
[ 1709.552427]  insn_get_immediate+0x181/0x570
[ 1709.553093]  insn_get_length+0x75/0x90
[ 1709.553680]  insn_decode+0x9b/0x170
[ 1709.554227]  ? lsm_read+0x50/0x50
[ 1709.554728]  text_poke_loc_init+0x63/0x140
[ 1709.555491]  ? lsm_read+0x50/0x50
[ 1709.556038]  text_poke_queue+0x84/0xc0
[ 1709.556640]  ftrace_replace_code+0xfd/0x170
[ 1709.557307]  ftrace_modify_all_code+0x1b1/0x270
[ 1709.558005]  arch_ftrace_update_code+0x9/0x10
[ 1709.558636]  ftrace_run_update_code+0x30/0xa0
[ 1709.559287]  ftrace_startup_enable+0x5e/0xa0
[ 1709.559925]  ftrace_startup+0x16d/0x240
[ 1709.560572]  register_ftrace_function+0x43/0x90
[ 1709.561245]  perf_ftrace_event_register+0xc1/0xf0
[ 1709.561941]  perf_trace_event_init+0xa0/0x4c0
[ 1709.562633]  perf_trace_init+0xda/0x160
[ 1709.563245]  perf_tp_event_init+0x57/0xa0
[ 1709.563854]  perf_try_init_event+0x83/0x270
[ 1709.564533]  perf_event_alloc+0xe3f/0x1c10
[ 1709.565116]  ? _raw_spin_unlock+0x2c/0x50
[ 1709.565716]  ? alloc_fd+0x20d/0x320
[ 1709.566364]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1709.567070]  ? write_comp_data+0x2f/0x90
[ 1709.568028]  __x64_sys_perf_event_open+0x26/0x30
[ 1709.568702]  do_syscall_64+0x37/0x80
[ 1709.569245]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1709.569949] RIP: 0033:0x7fac0740459d
[ 1709.570496] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1709.572899] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1709.573924] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1709.574894] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1709.575844] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1709.576790] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1709.577738] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1709.578975] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1709.579165] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1709.579957] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1709.580972] caller is debug_smp_processor_id+0x1c/0x20
[ 1709.582341] Call Trace:
[ 1709.582370]  dump_stack_lvl+0xa4/0xd3
[ 1709.582436]  dump_stack+0x15/0x17
[ 1709.582472]  check_preemption_disabled+0x167/0x180
[ 1709.582512]  ? finish_swait+0x41/0x80
[ 1709.585414]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1709.586040]  debug_smp_processor_id+0x1c/0x20
[ 1709.586626]  perf_ftrace_function_call+0x7c/0x360
[ 1709.587241]  ? ftrace_ops_test+0x71/0xc0
[ 1709.587779]  ? rcu_advance_cbs+0x70/0x70
[ 1709.588335]  ? write_comp_data+0x2f/0x90
[ 1709.588875]  ? perf_trace_buf_update+0x70/0x70
[ 1709.589468]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1709.590113]  ? write_comp_data+0x2f/0x90
[ 1709.590656]  ? perf_trace_buf_update+0x70/0x70
[ 1709.591249]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1709.591945]  0xffffffffa0098099
[ 1709.592443]  ? trace_hardirqs_on+0x3f/0x170
[ 1709.593071]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1709.593701]  _raw_spin_lock_irqsave+0x5/0x70
[ 1709.594280]  finish_swait+0x41/0x80
[ 1709.594760]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1709.595344]  ? finish_swait+0x41/0x80
[ 1709.595871]  rcu_gp_fqs_loop+0x2da/0x410
[ 1709.596465]  ? rcu_gp_init+0x730/0x730
[ 1709.596974]  rcu_gp_kthread+0xdd/0x170
[ 1709.597529]  kthread+0x1e7/0x230
[ 1709.597989]  ? set_kthread_struct+0x80/0x80
[ 1709.598591]  ret_from_fork+0x1f/0x30
[ 1709.599269] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1709.599376] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1709.600267] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1709.601240] caller is debug_smp_processor_id+0x1c/0x20
[ 1709.602704] Call Trace:
[ 1709.602741]  dump_stack_lvl+0xa4/0xd3
[ 1709.602824]  dump_stack+0x15/0x17
[ 1709.604705]  check_preemption_disabled+0x167/0x180
[ 1709.605450]  debug_smp_processor_id+0x1c/0x20
[ 1709.606085]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1709.606868]  perf_tp_event+0x331/0x4e0
[ 1709.607783]  ? arch_local_irq_enable+0x10/0x12
[ 1709.608434]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1709.609129]  ? dump_stack_lvl+0xcc/0xd3
[ 1709.609729]  ? dump_stack+0x15/0x17
[ 1709.610252]  ? check_preemption_disabled+0x167/0x180
[ 1709.610995]  ? insn_get_displacement+0x157/0x270
[ 1709.611643]  ? insn_rip_relative+0xb0/0xb0
[ 1709.612263]  perf_ftrace_function_call+0x248/0x360
[ 1709.612936]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1709.613608]  ? perf_ftrace_function_call+0x248/0x360
[ 1709.614572]  ? 0xffffffffa0098099
[ 1709.615198]  0xffffffffa0098099
[ 1709.615733]  ? 0xffffffffa0098099
[ 1709.616285]  ? insn_get_displacement+0x47/0x270
[ 1709.616972]  ? insn_get_sib+0x5/0x140
[ 1709.617513]  ? write_comp_data+0x2f/0x90
[ 1709.618116]  insn_get_sib+0x5/0x140
[ 1709.618634]  insn_get_displacement+0x157/0x270
[ 1709.619271]  ? insn_get_sib+0x5/0x140
[ 1709.619800]  ? insn_get_displacement+0x157/0x270
[ 1709.620509]  insn_get_immediate+0x181/0x570
[ 1709.621176]  insn_get_length+0x75/0x90
[ 1709.621766]  insn_decode+0x9b/0x170
[ 1709.622314]  ? lsm_read+0x50/0x50
[ 1709.622815]  text_poke_loc_init+0x63/0x140
[ 1709.623581]  ? lsm_read+0x50/0x50
[ 1709.624131]  text_poke_queue+0x84/0xc0
[ 1709.624735]  ftrace_replace_code+0xfd/0x170
[ 1709.625402]  ftrace_modify_all_code+0x1b1/0x270
[ 1709.626106]  arch_ftrace_update_code+0x9/0x10
[ 1709.626736]  ftrace_run_update_code+0x30/0xa0
[ 1709.627387]  ftrace_startup_enable+0x5e/0xa0
[ 1709.628029]  ftrace_startup+0x16d/0x240
[ 1709.628678]  register_ftrace_function+0x43/0x90
[ 1709.629353]  perf_ftrace_event_register+0xc1/0xf0
[ 1709.630056]  perf_trace_event_init+0xa0/0x4c0
[ 1709.630750]  perf_trace_init+0xda/0x160
[ 1709.631365]  perf_tp_event_init+0x57/0xa0
[ 1709.631977]  perf_try_init_event+0x83/0x270
[ 1709.632661]  perf_event_alloc+0xe3f/0x1c10
[ 1709.633248]  ? _raw_spin_unlock+0x2c/0x50
[ 1709.633847]  ? alloc_fd+0x20d/0x320
[ 1709.634491]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1709.635198]  ? write_comp_data+0x2f/0x90
[ 1709.636159]  __x64_sys_perf_event_open+0x26/0x30
[ 1709.636836]  do_syscall_64+0x37/0x80
[ 1709.637382]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1709.638097] RIP: 0033:0x7fac0740459d
[ 1709.638627] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1709.641009] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1709.642040] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1709.642999] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1709.643950] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1709.644901] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1709.645850] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1709.647060] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1709.647230] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1709.648022] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1709.649119] caller is debug_smp_processor_id+0x1c/0x20
[ 1709.650485] Call Trace:
[ 1709.650514]  dump_stack_lvl+0xa4/0xd3
[ 1709.650580]  dump_stack+0x15/0x17
[ 1709.650616]  check_preemption_disabled+0x167/0x180
[ 1709.650655]  ? force_qs_rnp+0xd0/0x2c0
[ 1709.653625]  ? preempt_schedule+0x30/0x30
[ 1709.654186]  debug_smp_processor_id+0x1c/0x20
[ 1709.654769]  perf_ftrace_function_call+0x7c/0x360
[ 1709.655382]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1709.656021]  ? ftrace_ops_test+0x71/0xc0
[ 1709.656560]  ? rcu_advance_cbs+0x70/0x70
[ 1709.657116]  ? write_comp_data+0x2f/0x90
[ 1709.657655]  ? perf_trace_buf_update+0x70/0x70
[ 1709.658251]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1709.658891]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1709.659481]  ? force_qs_rnp+0xcb/0x2c0
[ 1709.659989]  ? sched_show_task+0x70/0x70
[ 1709.660548]  ? rcu_gp_torture_wait+0x20/0x20
[ 1709.661132]  0xffffffffa0098099
[ 1709.661564]  ? rcu_exp_wait_wake+0x4c0/0x4c0
[ 1709.662266]  ? __cond_resched+0x5/0x30
[ 1709.662793]  ? ___might_sleep+0x143/0x170
[ 1709.663332]  __cond_resched+0x5/0x30
[ 1709.663822]  force_qs_rnp+0xd0/0x2c0
[ 1709.664312]  ? __cond_resched+0x5/0x30
[ 1709.664811]  ? force_qs_rnp+0xd0/0x2c0
[ 1709.665385]  rcu_gp_fqs_loop+0x2eb/0x410
[ 1709.665979]  ? rcu_gp_init+0x730/0x730
[ 1709.666498]  rcu_gp_kthread+0xdd/0x170
[ 1709.667054]  kthread+0x1e7/0x230
[ 1709.667514]  ? set_kthread_struct+0x80/0x80
[ 1709.668113]  ret_from_fork+0x1f/0x30
[ 1709.668790] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1709.668929] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1709.669869] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1709.671004] caller is debug_smp_processor_id+0x1c/0x20
[ 1709.672502] Call Trace:
[ 1709.673554]  dump_stack_lvl+0xa4/0xd3
[ 1709.674214]  dump_stack+0x15/0x17
[ 1709.674771]  check_preemption_disabled+0x167/0x180
[ 1709.675528]  ? insn_get_sib+0x122/0x140
[ 1709.676134]  ? insn_get_opcode+0x3b0/0x3b0
[ 1709.676828]  debug_smp_processor_id+0x1c/0x20
[ 1709.677526]  perf_ftrace_function_call+0x7c/0x360
[ 1709.678273]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1709.679015]  ? insn_get_displacement+0x157/0x270
[ 1709.679744]  ? perf_ftrace_function_call+0x4c/0x360
[ 1709.680953]  0xffffffffa0098099
[ 1709.681571]  ? 0xffffffffa0098099
[ 1709.682209]  ? insn_get_sib+0x43/0x140
[ 1709.682874]  ? insn_get_modrm+0x5/0x2a0
[ 1709.683497]  ? write_comp_data+0x2f/0x90
[ 1709.684166]  insn_get_modrm+0x5/0x2a0
[ 1709.684768]  insn_get_sib+0x122/0x140
[ 1709.685372]  ? insn_get_modrm+0x5/0x2a0
[ 1709.685976]  ? insn_get_sib+0x122/0x140
[ 1709.686673]  insn_get_displacement+0x157/0x270
[ 1709.687449]  insn_get_immediate+0x181/0x570
[ 1709.688211]  insn_get_length+0x75/0x90
[ 1709.688877]  insn_decode+0x9b/0x170
[ 1709.689491]  ? lsm_read+0x50/0x50
[ 1709.690054]  text_poke_loc_init+0x63/0x140
[ 1709.690972]  ? lsm_read+0x50/0x50
[ 1709.691600]  text_poke_queue+0x84/0xc0
[ 1709.692287]  ftrace_replace_code+0xfd/0x170
[ 1709.693047]  ftrace_modify_all_code+0x1b1/0x270
[ 1709.693836]  arch_ftrace_update_code+0x9/0x10
[ 1709.694539]  ftrace_run_update_code+0x30/0xa0
[ 1709.695279]  ftrace_startup_enable+0x5e/0xa0
[ 1709.695999]  ftrace_startup+0x16d/0x240
[ 1709.696748]  register_ftrace_function+0x43/0x90
[ 1709.697502]  perf_ftrace_event_register+0xc1/0xf0
[ 1709.698284]  perf_trace_event_init+0xa0/0x4c0
[ 1709.699068]  perf_trace_init+0xda/0x160
[ 1709.699766]  perf_tp_event_init+0x57/0xa0
[ 1709.700449]  perf_try_init_event+0x83/0x270
[ 1709.701228]  perf_event_alloc+0xe3f/0x1c10
[ 1709.701872]  ? _raw_spin_unlock+0x2c/0x50
[ 1709.702541]  ? alloc_fd+0x20d/0x320
[ 1709.703303]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1709.704092]  ? write_comp_data+0x2f/0x90
[ 1709.705294]  __x64_sys_perf_event_open+0x26/0x30
[ 1709.706046]  do_syscall_64+0x37/0x80
[ 1709.706672]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1709.707447] RIP: 0033:0x7fac0740459d
[ 1709.708030] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1709.710643] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1709.711771] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1709.713419] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1709.715243] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1709.716272] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1709.717301] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1709.718717] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1709.719757] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1709.721170] Call Trace:
[ 1709.721523]  dump_stack_lvl+0xa4/0xd3
[ 1709.722066]  dump_stack+0x15/0x17
[ 1709.722534]  check_preemption_disabled+0x167/0x180
[ 1709.723176]  ? do_epoll_wait+0x3b3/0xd80
[ 1709.723708]  ? __mutex_lock+0x9f0/0x9f0
[ 1709.724254]  debug_smp_processor_id+0x1c/0x20
[ 1709.724846]  perf_ftrace_function_call+0x7c/0x360
[ 1709.725534]  ? ftrace_call+0x5/0x44
[ 1709.726009]  ? trace_hardirqs_on+0x6a/0x170
[ 1709.726621]  ? finish_task_switch+0xb0/0x2a0
[ 1709.727195]  ? finish_task_switch+0x70/0x2a0
[ 1709.727795]  ? trace_hardirqs_on+0x3f/0x170
[ 1709.728354]  ? finish_task_switch+0x70/0x2a0
[ 1709.728953]  ? preempt_count_sub+0x5/0xa0
[ 1709.729559]  0xffffffffa0098099
[ 1709.730008]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1709.730664]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1709.731416]  ? do_epoll_wait+0x36b/0xd80
[ 1709.731984]  ? mutex_lock_nested+0x5/0x20
[ 1709.732534]  ? write_comp_data+0x2f/0x90
[ 1709.733089]  mutex_lock_nested+0x5/0x20
[ 1709.733617]  do_epoll_wait+0x3b3/0xd80
[ 1709.734140]  ? mutex_lock_nested+0x5/0x20
[ 1709.734681]  ? do_epoll_wait+0x3b3/0xd80
[ 1709.735378]  ? wait_woken+0x90/0x90
[ 1709.735939]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1709.736575]  do_syscall_64+0x37/0x80
[ 1709.737080]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1709.737745] RIP: 0033:0x7f8a39143b20
[ 1709.738243] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1709.740518] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1709.741490] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1709.742394] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1709.743293] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1709.744194] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1709.745095] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1714.398152] check_preemption_disabled: 647721 callbacks suppressed
[ 1714.398182] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1714.398245] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1714.399169] caller is debug_smp_processor_id+0x1c/0x20
[ 1714.400185] caller is debug_smp_processor_id+0x1c/0x20
[ 1714.401360] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1714.403885] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1714.405561] Call Trace:
[ 1714.406010]  dump_stack_lvl+0xa4/0xd3
[ 1714.406667]  dump_stack+0x15/0x17
[ 1714.407214]  check_preemption_disabled+0x167/0x180
[ 1714.407957]  ? __get_locked_pte+0x1a2/0x290
[ 1714.408600]  ? __lock_text_start+0x8/0x8
[ 1714.409261]  debug_smp_processor_id+0x1c/0x20
[ 1714.409946]  perf_ftrace_function_call+0x7c/0x360
[ 1714.410956]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1714.411681]  ? write_comp_data+0x2f/0x90
[ 1714.412325]  ? perf_trace_buf_update+0x70/0x70
[ 1714.413139]  0xffffffffa0098099
[ 1714.413710]  ? hwmon_dev_name_is_visible+0x50/0x50
[ 1714.414509]  ? ftrace_call+0x5/0x44
[ 1714.415113]  ? pmd_page_vaddr+0x2b/0x70
[ 1714.415777]  ? _raw_spin_lock+0x5/0x50
[ 1714.416449]  _raw_spin_lock+0x5/0x50
[ 1714.417034]  __get_locked_pte+0x1a2/0x290
[ 1714.417673]  ? _raw_spin_lock+0x5/0x50
[ 1714.418273]  ? __get_locked_pte+0x1a2/0x290
[ 1714.418967]  ? hwmon_dev_name_is_visible+0x50/0x50
[ 1714.419741]  __text_poke+0xea/0x4e0
[ 1714.420312]  ? hwmon_dev_name_is_visible+0x50/0x50
[ 1714.421088]  ? lock_is_held_type+0xe2/0x140
[ 1714.421771]  ? hwmon_dev_name_is_visible+0x50/0x50
[ 1714.422585]  text_poke+0x2b/0x60
[ 1714.423172]  text_poke_bp_batch+0x93/0x2c0
[ 1714.423890]  ? hwmon_attr_show+0x270/0x270
[ 1714.424606]  text_poke_queue+0xa7/0xc0
[ 1714.425279]  ftrace_replace_code+0xfd/0x170
[ 1714.426029]  ftrace_modify_all_code+0x1b1/0x270
[ 1714.426810]  arch_ftrace_update_code+0x9/0x10
[ 1714.427506]  ftrace_run_update_code+0x30/0xa0
[ 1714.428223]  ftrace_startup_enable+0x5e/0xa0
[ 1714.428928]  ftrace_startup+0x16d/0x240
[ 1714.429661]  register_ftrace_function+0x43/0x90
[ 1714.430412]  perf_ftrace_event_register+0xc1/0xf0
[ 1714.431176]  perf_trace_event_init+0xa0/0x4c0
[ 1714.431981]  perf_trace_init+0xda/0x160
[ 1714.432720]  perf_tp_event_init+0x57/0xa0
[ 1714.433450]  perf_try_init_event+0x83/0x270
[ 1714.434278]  perf_event_alloc+0xe3f/0x1c10
[ 1714.434967]  ? _raw_spin_unlock+0x2c/0x50
[ 1714.435677]  ? alloc_fd+0x20d/0x320
[ 1714.436471]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1714.437311]  ? write_comp_data+0x2f/0x90
[ 1714.438563]  __x64_sys_perf_event_open+0x26/0x30
[ 1714.439359]  do_syscall_64+0x37/0x80
[ 1714.440005]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1714.440831] RIP: 0033:0x7fac0740459d
[ 1714.441457] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1714.444228] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1714.445434] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1714.446549] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1714.447654] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1714.448759] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1714.449862] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1714.451342] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1714.451526] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1714.452397] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1714.453571] caller is debug_smp_processor_id+0x1c/0x20
[ 1714.455071] Call Trace:
[ 1714.455102]  dump_stack_lvl+0xa4/0xd3
[ 1714.455169]  dump_stack+0x15/0x17
[ 1714.455205]  check_preemption_disabled+0x167/0x180
[ 1714.455244]  ? lock_timer_base+0x34/0x100
[ 1714.458519]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1714.459195]  debug_smp_processor_id+0x1c/0x20
[ 1714.459830]  perf_ftrace_function_call+0x7c/0x360
[ 1714.460527]  ? ftrace_ops_test+0x71/0xc0
[ 1714.461139]  ? ftrace_ops_test+0x71/0xc0
[ 1714.461724]  ? perf_trace_buf_update+0x70/0x70
[ 1714.462374]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1714.463070]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1714.463724]  ? write_comp_data+0x2f/0x90
[ 1714.464308]  ? perf_trace_buf_update+0x70/0x70
[ 1714.465017]  0xffffffffa0098099
[ 1714.465551]  ? ftrace_call+0x5/0x44
[ 1714.466092]  ? lock_timer_base+0xc0/0x100
[ 1714.466709]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1714.467355]  ? write_comp_data+0x2f/0x90
[ 1714.467948]  _raw_spin_lock_irqsave+0x5/0x70
[ 1714.468566]  lock_timer_base+0x34/0x100
[ 1714.469134]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1714.469769]  ? lock_timer_base+0x34/0x100
[ 1714.470424]  try_to_del_timer_sync+0x33/0x90
[ 1714.471037]  ? try_to_del_timer_sync+0x5/0x90
[ 1714.471697]  del_timer_sync+0xd3/0x130
[ 1714.472280]  schedule_timeout+0x34e/0x610
[ 1714.472923]  ? del_timer_sync+0x130/0x130
[ 1714.473548]  ? i915_init_ggtt+0x40/0x6b0
[ 1714.474209]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1714.474851]  ? rcu_gp_init+0x730/0x730
[ 1714.475402]  rcu_gp_kthread+0xdd/0x170
[ 1714.476002]  kthread+0x1e7/0x230
[ 1714.476502]  ? set_kthread_struct+0x80/0x80
[ 1714.477148]  ret_from_fork+0x1f/0x30
[ 1714.477868] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1714.478086] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1714.479036] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1714.480097] caller is debug_smp_processor_id+0x1c/0x20
[ 1714.481788] Call Trace:
[ 1714.482929]  dump_stack_lvl+0xa4/0xd3
[ 1714.483626]  dump_stack+0x15/0x17
[ 1714.484224]  check_preemption_disabled+0x167/0x180
[ 1714.485119]  debug_smp_processor_id+0x1c/0x20
[ 1714.485865]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1714.486856]  perf_trace_buf_alloc+0x3d/0x100
[ 1714.487590]  ? __get_locked_pte+0x1a2/0x290
[ 1714.488288]  ? __lock_text_start+0x8/0x8
[ 1714.488992]  perf_ftrace_function_call+0x209/0x360
[ 1714.490145]  ? 0xffffffffa0098099
[ 1714.490929]  0xffffffffa0098099
[ 1714.491544]  ? hwmon_dev_name_is_visible+0x50/0x50
[ 1714.492385]  ? ftrace_call+0x5/0x44
[ 1714.493038]  ? pmd_page_vaddr+0x2b/0x70
[ 1714.493758]  ? _raw_spin_lock+0x5/0x50
[ 1714.494503]  _raw_spin_lock+0x5/0x50
[ 1714.495137]  __get_locked_pte+0x1a2/0x290
[ 1714.495832]  ? _raw_spin_lock+0x5/0x50
[ 1714.496469]  ? __get_locked_pte+0x1a2/0x290
[ 1714.497221]  ? hwmon_dev_name_is_visible+0x50/0x50
[ 1714.498075]  __text_poke+0xea/0x4e0
[ 1714.498699]  ? hwmon_dev_name_is_visible+0x50/0x50
[ 1714.499538]  ? lock_is_held_type+0xe2/0x140
[ 1714.500275]  ? hwmon_dev_name_is_visible+0x50/0x50
[ 1714.501151]  text_poke+0x2b/0x60
[ 1714.501785]  text_poke_bp_batch+0x93/0x2c0
[ 1714.502571]  ? hwmon_attr_show+0x270/0x270
[ 1714.503345]  text_poke_queue+0xa7/0xc0
[ 1714.504073]  ftrace_replace_code+0xfd/0x170
[ 1714.504879]  ftrace_modify_all_code+0x1b1/0x270
[ 1714.505718]  arch_ftrace_update_code+0x9/0x10
[ 1714.506465]  ftrace_run_update_code+0x30/0xa0
[ 1714.507245]  ftrace_startup_enable+0x5e/0xa0
[ 1714.508011]  ftrace_startup+0x16d/0x240
[ 1714.508804]  register_ftrace_function+0x43/0x90
[ 1714.509608]  perf_ftrace_event_register+0xc1/0xf0
[ 1714.510447]  perf_trace_event_init+0xa0/0x4c0
[ 1714.511281]  perf_trace_init+0xda/0x160
[ 1714.512021]  perf_tp_event_init+0x57/0xa0
[ 1714.512750]  perf_try_init_event+0x83/0x270
[ 1714.513576]  perf_event_alloc+0xe3f/0x1c10
[ 1714.514269]  ? _raw_spin_unlock+0x2c/0x50
[ 1714.514980]  ? alloc_fd+0x20d/0x320
[ 1714.515772]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1714.516614]  ? write_comp_data+0x2f/0x90
[ 1714.517860]  __x64_sys_perf_event_open+0x26/0x30
[ 1714.518662]  do_syscall_64+0x37/0x80
[ 1714.519314]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1714.520143] RIP: 0033:0x7fac0740459d
[ 1714.520767] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1714.523535] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1714.524740] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1714.525845] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1714.526956] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1714.528063] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1714.529171] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1714.530659] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1714.530828] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1714.531706] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1714.532796] caller is debug_smp_processor_id+0x1c/0x20
[ 1714.534297] Call Trace:
[ 1714.534326]  dump_stack_lvl+0xa4/0xd3
[ 1714.534391]  dump_stack+0x15/0x17
[ 1714.534428]  check_preemption_disabled+0x167/0x180
[ 1714.534467]  ? prepare_to_swait_event+0x1b/0xf0
[ 1714.537755]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1714.538477]  debug_smp_processor_id+0x1c/0x20
[ 1714.539123]  perf_ftrace_function_call+0x7c/0x360
[ 1714.539792]  ? ftrace_ops_test+0x71/0xc0
[ 1714.540452]  ? trace_hardirqs_on+0x3f/0x170
[ 1714.541106]  ? write_comp_data+0x2f/0x90
[ 1714.541692]  ? perf_trace_buf_update+0x70/0x70
[ 1714.542358]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1714.543128]  0xffffffffa0098099
[ 1714.543645]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1714.544359]  ? del_timer_sync+0xde/0x130
[ 1714.544964]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1714.545645]  _raw_spin_lock_irqsave+0x5/0x70
[ 1714.546277]  prepare_to_swait_event+0x1b/0xf0
[ 1714.546910]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1714.547545]  ? prepare_to_swait_event+0x1b/0xf0
[ 1714.548226]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1714.548867]  ? rcu_gp_init+0x730/0x730
[ 1714.549425]  rcu_gp_kthread+0xdd/0x170
[ 1714.550024]  kthread+0x1e7/0x230
[ 1714.550532]  ? set_kthread_struct+0x80/0x80
[ 1714.551180]  ret_from_fork+0x1f/0x30
[ 1714.551899] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1714.551979] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1714.552976] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1714.554113] caller is debug_smp_processor_id+0x1c/0x20
[ 1714.555641] Call Trace:
[ 1714.556724]  dump_stack_lvl+0xa4/0xd3
[ 1714.557341]  dump_stack+0x15/0x17
[ 1714.557877]  check_preemption_disabled+0x167/0x180
[ 1714.558680]  debug_smp_processor_id+0x1c/0x20
[ 1714.559356]  perf_trace_buf_alloc+0x98/0x100
[ 1714.560018]  ? __get_locked_pte+0x1a2/0x290
[ 1714.560656]  ? __lock_text_start+0x8/0x8
[ 1714.561285]  perf_ftrace_function_call+0x209/0x360
[ 1714.562256]  ? 0xffffffffa0098099
[ 1714.562919]  0xffffffffa0098099
[ 1714.563460]  ? hwmon_dev_name_is_visible+0x50/0x50
[ 1714.564215]  ? ftrace_call+0x5/0x44
[ 1714.564796]  ? pmd_page_vaddr+0x2b/0x70
[ 1714.565435]  ? _raw_spin_lock+0x5/0x50
[ 1714.566079]  _raw_spin_lock+0x5/0x50
[ 1714.566652]  __get_locked_pte+0x1a2/0x290
[ 1714.567281]  ? _raw_spin_lock+0x5/0x50
[ 1714.567863]  ? __get_locked_pte+0x1a2/0x290
[ 1714.568534]  ? hwmon_dev_name_is_visible+0x50/0x50
[ 1714.569292]  __text_poke+0xea/0x4e0
[ 1714.569851]  ? hwmon_dev_name_is_visible+0x50/0x50
[ 1714.570637]  ? lock_is_held_type+0xe2/0x140
[ 1714.571301]  ? hwmon_dev_name_is_visible+0x50/0x50
[ 1714.572079]  text_poke+0x2b/0x60
[ 1714.572638]  text_poke_bp_batch+0x93/0x2c0
[ 1714.573328]  ? hwmon_attr_show+0x270/0x270
[ 1714.574018]  text_poke_queue+0xa7/0xc0
[ 1714.574669]  ftrace_replace_code+0xfd/0x170
[ 1714.575380]  ftrace_modify_all_code+0x1b1/0x270
[ 1714.576137]  arch_ftrace_update_code+0x9/0x10
[ 1714.576811]  ftrace_run_update_code+0x30/0xa0
[ 1714.577508]  ftrace_startup_enable+0x5e/0xa0
[ 1714.578202]  ftrace_startup+0x16d/0x240
[ 1714.578891]  register_ftrace_function+0x43/0x90
[ 1714.579613]  perf_ftrace_event_register+0xc1/0xf0
[ 1714.580359]  perf_trace_event_init+0xa0/0x4c0
[ 1714.581094]  perf_trace_init+0xda/0x160
[ 1714.581747]  perf_tp_event_init+0x57/0xa0
[ 1714.582405]  perf_try_init_event+0x83/0x270
[ 1714.583130]  perf_event_alloc+0xe3f/0x1c10
[ 1714.583758]  ? _raw_spin_unlock+0x2c/0x50
[ 1714.584404]  ? alloc_fd+0x20d/0x320
[ 1714.585080]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1714.585835]  ? write_comp_data+0x2f/0x90
[ 1714.586864]  __x64_sys_perf_event_open+0x26/0x30
[ 1714.587584]  do_syscall_64+0x37/0x80
[ 1714.588164]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1714.588926] RIP: 0033:0x7fac0740459d
[ 1714.589488] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1714.592070] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1714.593172] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1714.594202] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1714.595244] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1714.596269] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1714.597295] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1714.598583] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1714.598750] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1714.599634] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1714.600720] caller is debug_smp_processor_id+0x1c/0x20
[ 1714.602223] Call Trace:
[ 1714.602251]  dump_stack_lvl+0xa4/0xd3
[ 1714.602316]  dump_stack+0x15/0x17
[ 1714.602353]  check_preemption_disabled+0x167/0x180
[ 1714.602392]  ? finish_swait+0x41/0x80
[ 1714.605559]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1714.606243]  debug_smp_processor_id+0x1c/0x20
[ 1714.606877]  perf_ftrace_function_call+0x7c/0x360
[ 1714.607547]  ? ftrace_ops_test+0x71/0xc0
[ 1714.608132]  ? rcu_advance_cbs+0x70/0x70
[ 1714.608735]  ? write_comp_data+0x2f/0x90
[ 1714.609321]  ? perf_trace_buf_update+0x70/0x70
[ 1714.609965]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1714.610665]  ? write_comp_data+0x2f/0x90
[ 1714.611251]  ? perf_trace_buf_update+0x70/0x70
[ 1714.611895]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1714.612646]  0xffffffffa0098099
[ 1714.613182]  ? trace_hardirqs_on+0x3f/0x170
[ 1714.613857]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1714.614542]  _raw_spin_lock_irqsave+0x5/0x70
[ 1714.615181]  finish_swait+0x41/0x80
[ 1714.615715]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1714.616353]  ? finish_swait+0x41/0x80
[ 1714.616924]  rcu_gp_fqs_loop+0x2da/0x410
[ 1714.617565]  ? rcu_gp_init+0x730/0x730
[ 1714.618123]  rcu_gp_kthread+0xdd/0x170
[ 1714.618718]  kthread+0x1e7/0x230
[ 1714.619216]  ? set_kthread_struct+0x80/0x80
[ 1714.619864]  ret_from_fork+0x1f/0x30
[ 1714.620581] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1714.620662] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1714.621661] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1714.622814] caller is debug_smp_processor_id+0x1c/0x20
[ 1714.624332] Call Trace:
[ 1714.625413]  dump_stack_lvl+0xa4/0xd3
[ 1714.626031]  dump_stack+0x15/0x17
[ 1714.626575]  check_preemption_disabled+0x167/0x180
[ 1714.627371]  debug_smp_processor_id+0x1c/0x20
[ 1714.628048]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1714.628888]  perf_tp_event+0x331/0x4e0
[ 1714.629817]  ? arch_local_irq_enable+0x10/0x12
[ 1714.630523]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1714.631266]  ? dump_stack_lvl+0xcc/0xd3
[ 1714.631907]  ? dump_stack+0x15/0x17
[ 1714.632463]  ? check_preemption_disabled+0x167/0x180
[ 1714.633285]  ? __get_locked_pte+0x1a2/0x290
[ 1714.633923]  ? __lock_text_start+0x8/0x8
[ 1714.634576]  perf_ftrace_function_call+0x248/0x360
[ 1714.635307]  ? perf_ftrace_function_call+0x248/0x360
[ 1714.636333]  ? 0xffffffffa0098099
[ 1714.637000]  0xffffffffa0098099
[ 1714.637543]  ? hwmon_dev_name_is_visible+0x50/0x50
[ 1714.638319]  ? ftrace_call+0x5/0x44
[ 1714.638910]  ? pmd_page_vaddr+0x2b/0x70
[ 1714.639561]  ? _raw_spin_lock+0x5/0x50
[ 1714.640204]  _raw_spin_lock+0x5/0x50
[ 1714.640777]  __get_locked_pte+0x1a2/0x290
[ 1714.641406]  ? _raw_spin_lock+0x5/0x50
[ 1714.642022]  ? __get_locked_pte+0x1a2/0x290
[ 1714.642743]  ? hwmon_dev_name_is_visible+0x50/0x50
[ 1714.643543]  __text_poke+0xea/0x4e0
[ 1714.644134]  ? hwmon_dev_name_is_visible+0x50/0x50
[ 1714.644934]  ? lock_is_held_type+0xe2/0x140
[ 1714.645639]  ? hwmon_dev_name_is_visible+0x50/0x50
[ 1714.646474]  text_poke+0x2b/0x60
[ 1714.647064]  text_poke_bp_batch+0x93/0x2c0
[ 1714.647791]  ? hwmon_attr_show+0x270/0x270
[ 1714.648517]  text_poke_queue+0xa7/0xc0
[ 1714.649199]  ftrace_replace_code+0xfd/0x170
[ 1714.649964]  ftrace_modify_all_code+0x1b1/0x270
[ 1714.650731]  arch_ftrace_update_code+0x9/0x10
[ 1714.651406]  ftrace_run_update_code+0x30/0xa0
[ 1714.652105]  ftrace_startup_enable+0x5e/0xa0
[ 1714.652792]  ftrace_startup+0x16d/0x240
[ 1714.653483]  register_ftrace_function+0x43/0x90
[ 1714.654214]  perf_ftrace_event_register+0xc1/0xf0
[ 1714.655048]  perf_trace_event_init+0xa0/0x4c0
[ 1714.655864]  perf_trace_init+0xda/0x160
[ 1714.656560]  perf_tp_event_init+0x57/0xa0
[ 1714.657254]  perf_try_init_event+0x83/0x270
[ 1714.658028]  perf_event_alloc+0xe3f/0x1c10
[ 1714.658726]  ? _raw_spin_unlock+0x2c/0x50
[ 1714.659416]  ? alloc_fd+0x20d/0x320
[ 1714.660140]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1714.660948]  ? write_comp_data+0x2f/0x90
[ 1714.662014]  __x64_sys_perf_event_open+0x26/0x30
[ 1714.662795]  do_syscall_64+0x37/0x80
[ 1714.663413]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1714.664225] RIP: 0033:0x7fac0740459d
[ 1714.664824] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1714.667450] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1714.668574] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1714.669600] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1714.670638] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1714.671662] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1714.672688] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1714.674028] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1714.674210] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1714.675102] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1714.676286] caller is debug_smp_processor_id+0x1c/0x20
[ 1714.677779] Call Trace:
[ 1714.678939]  dump_stack_lvl+0xa4/0xd3
[ 1714.679510]  dump_stack+0x15/0x17
[ 1714.680009]  check_preemption_disabled+0x167/0x180
[ 1714.680702]  ? force_qs_rnp+0xd0/0x2c0
[ 1714.681247]  ? preempt_schedule+0x30/0x30
[ 1714.681853]  debug_smp_processor_id+0x1c/0x20
[ 1714.682491]  perf_ftrace_function_call+0x7c/0x360
[ 1714.683162]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1714.683856]  ? ftrace_ops_test+0x71/0xc0
[ 1714.684442]  ? rcu_advance_cbs+0x70/0x70
[ 1714.685046]  ? write_comp_data+0x2f/0x90
[ 1714.685632]  ? perf_trace_buf_update+0x70/0x70
[ 1714.686279]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1714.686974]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1714.687620]  ? force_qs_rnp+0xcb/0x2c0
[ 1714.688172]  ? sched_show_task+0x70/0x70
[ 1714.688777]  ? rcu_gp_torture_wait+0x20/0x20
[ 1714.689412]  0xffffffffa0098099
[ 1714.689884]  ? rcu_exp_wait_wake+0x4c0/0x4c0
[ 1714.690636]  ? __cond_resched+0x5/0x30
[ 1714.691209]  ? ___might_sleep+0x143/0x170
[ 1714.691796]  __cond_resched+0x5/0x30
[ 1714.692329]  force_qs_rnp+0xd0/0x2c0
[ 1714.692860]  ? __cond_resched+0x5/0x30
[ 1714.693404]  ? force_qs_rnp+0xd0/0x2c0
[ 1714.694022]  rcu_gp_fqs_loop+0x2eb/0x410
[ 1714.694674]  ? rcu_gp_init+0x730/0x730
[ 1714.695229]  rcu_gp_kthread+0xdd/0x170
[ 1714.695829]  kthread+0x1e7/0x230
[ 1714.696328]  ? set_kthread_struct+0x80/0x80
[ 1714.696983]  ret_from_fork+0x1f/0x30
[ 1714.697713] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1714.697823] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1714.698877] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1714.698914] Call Trace:
[ 1714.698967]  dump_stack_lvl+0xa4/0xd3
[ 1714.700108] caller is debug_smp_processor_id+0x1c/0x20
[ 1714.701882]  dump_stack+0x15/0x17
[ 1714.704079]  check_preemption_disabled+0x167/0x180
[ 1714.704888]  ? __get_locked_pte+0x1a2/0x290
[ 1714.705590]  ? __lock_text_start+0x8/0x8
[ 1714.706315]  debug_smp_processor_id+0x1c/0x20
[ 1714.707061]  perf_ftrace_function_call+0x7c/0x360
[ 1714.708141]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1714.708928]  ? write_comp_data+0x2f/0x90
[ 1714.709625]  ? perf_trace_buf_update+0x70/0x70
[ 1714.710522]  0xffffffffa0098099
[ 1714.711142]  ? hwmon_thermal_get_temp+0xa0/0xa0
[ 1714.711946]  ? ftrace_call+0x5/0x44
[ 1714.712603]  ? pmd_page_vaddr+0x2b/0x70
[ 1714.713322]  ? _raw_spin_lock+0x5/0x50
[ 1714.714054]  _raw_spin_lock+0x5/0x50
[ 1714.714689]  __get_locked_pte+0x1a2/0x290
[ 1714.715384]  ? _raw_spin_lock+0x5/0x50
[ 1714.716023]  ? __get_locked_pte+0x1a2/0x290
[ 1714.716778]  ? hwmon_thermal_get_temp+0xa0/0xa0
[ 1714.717582]  __text_poke+0xea/0x4e0
[ 1714.718207]  ? hwmon_thermal_get_temp+0xa0/0xa0
[ 1714.719010]  ? lock_is_held_type+0xe2/0x140
[ 1714.719744]  ? hwmon_thermal_get_temp+0xa0/0xa0
[ 1714.720581]  text_poke+0x2b/0x60
[ 1714.721216]  text_poke_bp_batch+0x93/0x2c0
[ 1714.721994]  ? hwmon_attr_show+0x270/0x270
[ 1714.722773]  text_poke_queue+0xa7/0xc0
[ 1714.723503]  ftrace_replace_code+0xfd/0x170
[ 1714.724309]  ftrace_modify_all_code+0x1b1/0x270
[ 1714.725150]  arch_ftrace_update_code+0x9/0x10
[ 1714.725893]  ftrace_run_update_code+0x30/0xa0
[ 1714.726674]  ftrace_startup_enable+0x5e/0xa0
[ 1714.727441]  ftrace_startup+0x16d/0x240
[ 1714.728235]  register_ftrace_function+0x43/0x90
[ 1714.729039]  perf_ftrace_event_register+0xc1/0xf0
[ 1714.729871]  perf_trace_event_init+0xa0/0x4c0
[ 1714.730707]  perf_trace_init+0xda/0x160
[ 1714.731449]  perf_tp_event_init+0x57/0xa0
[ 1714.732178]  perf_try_init_event+0x83/0x270
[ 1714.733006]  perf_event_alloc+0xe3f/0x1c10
[ 1714.733698]  ? _raw_spin_unlock+0x2c/0x50
[ 1714.734423]  ? alloc_fd+0x20d/0x320
[ 1714.735222]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1714.736065]  ? write_comp_data+0x2f/0x90
[ 1714.737316]  __x64_sys_perf_event_open+0x26/0x30
[ 1714.738132]  do_syscall_64+0x37/0x80
[ 1714.738784]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1714.739618] RIP: 0033:0x7fac0740459d
[ 1714.740243] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1714.743024] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1714.744230] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1714.745340] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1714.746459] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1714.747565] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1714.748673] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1714.750187] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1714.751321] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1714.752868] Call Trace:
[ 1714.753252]  dump_stack_lvl+0xa4/0xd3
[ 1714.753831]  dump_stack+0x15/0x17
[ 1714.754378]  check_preemption_disabled+0x167/0x180
[ 1714.755135]  ? do_epoll_wait+0x3b3/0xd80
[ 1714.755721]  ? __mutex_lock+0x9f0/0x9f0
[ 1714.756317]  debug_smp_processor_id+0x1c/0x20
[ 1714.756958]  perf_ftrace_function_call+0x7c/0x360
[ 1714.757700]  ? ftrace_call+0x5/0x44
[ 1714.758224]  ? trace_hardirqs_on+0x6a/0x170
[ 1714.758879]  ? finish_task_switch+0xb0/0x2a0
[ 1714.759499]  ? finish_task_switch+0x70/0x2a0
[ 1714.760146]  ? trace_hardirqs_on+0x3f/0x170
[ 1714.760754]  ? finish_task_switch+0x70/0x2a0
[ 1714.761401]  ? preempt_count_sub+0x5/0xa0
[ 1714.762059]  0xffffffffa0098099
[ 1714.762550]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1714.763255]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1714.764070]  ? do_epoll_wait+0x36b/0xd80
[ 1714.764684]  ? mutex_lock_nested+0x5/0x20
[ 1714.765279]  ? write_comp_data+0x2f/0x90
[ 1714.765880]  mutex_lock_nested+0x5/0x20
[ 1714.766464]  do_epoll_wait+0x3b3/0xd80
[ 1714.767027]  ? mutex_lock_nested+0x5/0x20
[ 1714.767620]  ? do_epoll_wait+0x3b3/0xd80
[ 1714.768362]  ? wait_woken+0x90/0x90
[ 1714.768965]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1714.769649]  do_syscall_64+0x37/0x80
[ 1714.770207]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1714.770934] RIP: 0033:0x7f8a39143b20
[ 1714.771470] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1714.773961] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1714.775025] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1714.776009] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1714.776990] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1714.777971] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1714.778956] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1719.402069] check_preemption_disabled: 882445 callbacks suppressed
[ 1719.402094] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1719.402134] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1719.402986] caller is debug_smp_processor_id+0x1c/0x20
[ 1719.403894] caller is debug_smp_processor_id+0x1c/0x20
[ 1719.404962] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1719.407236] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1719.408740] Call Trace:
[ 1719.409124]  dump_stack_lvl+0xa4/0xd3
[ 1719.409703]  dump_stack+0x15/0x17
[ 1719.410214]  check_preemption_disabled+0x167/0x180
[ 1719.410905]  ? text_poke_bp_batch+0x93/0x2c0
[ 1719.411518]  ? apply_paravirt+0x150/0x150
[ 1719.412127]  debug_smp_processor_id+0x1c/0x20
[ 1719.412761]  perf_ftrace_function_call+0x7c/0x360
[ 1719.413487]  ? nfs3_xdr_dec_fsstat3res+0x190/0x190
[ 1719.414203]  ? 0xffffffffa0098099
[ 1719.414710]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1719.415581]  0xffffffffa0098099
[ 1719.416064]  ? _raw_spin_unlock+0x2c/0x50
[ 1719.416695]  ? __text_poke+0x2f2/0x4e0
[ 1719.417307]  ? nfs3_xdr_dec_link3res+0x130/0x130
[ 1719.417974]  ? text_poke+0x5/0x60
[ 1719.418520]  text_poke+0x5/0x60
[ 1719.419004]  text_poke_bp_batch+0x93/0x2c0
[ 1719.419602]  ? text_poke+0x5/0x60
[ 1719.420090]  ? text_poke_bp_batch+0x93/0x2c0
[ 1719.420749]  ? nfs4_xattr_get_nfs4_user+0x110/0x110
[ 1719.421488]  text_poke_queue+0xa7/0xc0
[ 1719.422091]  ftrace_replace_code+0xfd/0x170
[ 1719.422755]  ftrace_modify_all_code+0x1b1/0x270
[ 1719.423448]  arch_ftrace_update_code+0x9/0x10
[ 1719.424077]  ftrace_run_update_code+0x30/0xa0
[ 1719.424728]  ftrace_shutdown+0x2b8/0x4a0
[ 1719.425364]  unregister_ftrace_function+0x25/0x50
[ 1719.426052]  perf_ftrace_event_register+0x89/0xf0
[ 1719.426760]  ? perf_tp_event_init+0xa0/0xa0
[ 1719.427369]  perf_trace_destroy+0x37/0x60
[ 1719.427968]  tp_perf_event_destroy+0x15/0x20
[ 1719.428598]  _free_event+0xfc/0x7d0
[ 1719.429169]  put_event+0x37/0x50
[ 1719.429677]  perf_event_release_kernel+0x2f4/0x370
[ 1719.430432]  ? perf_event_release_kernel+0x370/0x370
[ 1719.431160]  perf_release+0x19/0x20
[ 1719.431691]  __fput+0x12d/0x460
[ 1719.432261]  ____fput+0x1a/0x20
[ 1719.432749]  task_work_run+0x8e/0xf0
[ 1719.433333]  do_exit+0x616/0x1310
[ 1719.433884]  ? write_comp_data+0x2f/0x90
[ 1719.434542]  do_group_exit+0x7e/0x130
[ 1719.435139]  get_signal+0x249/0x13c0
[ 1719.435729]  ? get_signal+0x5/0x13c0
[ 1719.436406]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1719.437266]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1719.438118]  exit_to_user_mode_prepare+0x154/0x240
[ 1719.438891]  syscall_exit_to_user_mode+0x2b/0x60
[ 1719.439628]  do_syscall_64+0x46/0x80
[ 1719.440221]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1719.440999] RIP: 0033:0x7fac0740459d
[ 1719.441575] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1719.442544] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1719.443687] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1719.444740] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1719.445792] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1719.446848] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1719.447905] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1719.449177] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1719.449297] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1719.450186] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1719.450198] Call Trace:
[ 1719.450208]  dump_stack_lvl+0xa4/0xd3
[ 1719.450230]  dump_stack+0x15/0x17
[ 1719.450245]  check_preemption_disabled+0x167/0x180
[ 1719.450263]  ? schedule_timeout+0x34e/0x610
[ 1719.450279]  ? do_init_timer+0xa0/0xa0
[ 1719.451410] caller is debug_smp_processor_id+0x1c/0x20
[ 1719.452845]  debug_smp_processor_id+0x1c/0x20
[ 1719.456975]  perf_ftrace_function_call+0x7c/0x360
[ 1719.457602]  ? 0xffffffffa0098099
[ 1719.458052]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1719.458691]  ? finish_task_switch+0xab/0x2a0
[ 1719.459257]  ? __schedule+0x46e/0xb20
[ 1719.459765]  0xffffffffa0098099
[ 1719.460191]  ? finish_task_switch+0xb0/0x2a0
[ 1719.460774]  ? del_timer_sync+0x5/0x130
[ 1719.461300]  del_timer_sync+0x5/0x130
[ 1719.461825]  schedule_timeout+0x34e/0x610
[ 1719.462423]  ? del_timer_sync+0x5/0x130
[ 1719.462971]  ? schedule_timeout+0x34e/0x610
[ 1719.463575]  ? del_timer_sync+0x130/0x130
[ 1719.464156]  ? i915_init_ggtt+0x40/0x6b0
[ 1719.464728]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1719.465295]  ? rcu_gp_init+0x730/0x730
[ 1719.465829]  rcu_gp_kthread+0xdd/0x170
[ 1719.466386]  kthread+0x1e7/0x230
[ 1719.466856]  ? set_kthread_struct+0x80/0x80
[ 1719.467462]  ret_from_fork+0x1f/0x30
[ 1719.468014] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1719.468050] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1719.469188] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1719.470299] caller is debug_smp_processor_id+0x1c/0x20
[ 1719.471963] Call Trace:
[ 1719.473027]  dump_stack_lvl+0xa4/0xd3
[ 1719.473659]  dump_stack+0x15/0x17
[ 1719.474219]  check_preemption_disabled+0x167/0x180
[ 1719.475041]  debug_smp_processor_id+0x1c/0x20
[ 1719.475738]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1719.476634]  perf_trace_buf_alloc+0x3d/0x100
[ 1719.477323]  ? text_poke_bp_batch+0x93/0x2c0
[ 1719.477994]  ? apply_paravirt+0x150/0x150
[ 1719.478658]  perf_ftrace_function_call+0x209/0x360
[ 1719.479624]  ? 0xffffffffa0098099
[ 1719.480288]  0xffffffffa0098099
[ 1719.480821]  ? _raw_spin_unlock+0x2c/0x50
[ 1719.481512]  ? __text_poke+0x2f2/0x4e0
[ 1719.482181]  ? nfs3_xdr_dec_link3res+0x130/0x130
[ 1719.482912]  ? text_poke+0x5/0x60
[ 1719.483503]  text_poke+0x5/0x60
[ 1719.484028]  text_poke_bp_batch+0x93/0x2c0
[ 1719.484687]  ? text_poke+0x5/0x60
[ 1719.485226]  ? text_poke_bp_batch+0x93/0x2c0
[ 1719.485951]  ? nfs4_xattr_get_nfs4_user+0x110/0x110
[ 1719.486765]  text_poke_queue+0xa7/0xc0
[ 1719.487418]  ftrace_replace_code+0xfd/0x170
[ 1719.488143]  ftrace_modify_all_code+0x1b1/0x270
[ 1719.488906]  arch_ftrace_update_code+0x9/0x10
[ 1719.489600]  ftrace_run_update_code+0x30/0xa0
[ 1719.490319]  ftrace_shutdown+0x2b8/0x4a0
[ 1719.491018]  unregister_ftrace_function+0x25/0x50
[ 1719.491770]  perf_ftrace_event_register+0x89/0xf0
[ 1719.492513]  ? perf_tp_event_init+0xa0/0xa0
[ 1719.493185]  perf_trace_destroy+0x37/0x60
[ 1719.493845]  tp_perf_event_destroy+0x15/0x20
[ 1719.494543]  _free_event+0xfc/0x7d0
[ 1719.495169]  put_event+0x37/0x50
[ 1719.495727]  perf_event_release_kernel+0x2f4/0x370
[ 1719.496549]  ? perf_event_release_kernel+0x370/0x370
[ 1719.497350]  perf_release+0x19/0x20
[ 1719.497933]  __fput+0x12d/0x460
[ 1719.498562]  ____fput+0x1a/0x20
[ 1719.499100]  task_work_run+0x8e/0xf0
[ 1719.499742]  do_exit+0x616/0x1310
[ 1719.500349]  ? write_comp_data+0x2f/0x90
[ 1719.501059]  do_group_exit+0x7e/0x130
[ 1719.501714]  get_signal+0x249/0x13c0
[ 1719.502347]  ? get_signal+0x5/0x13c0
[ 1719.503029]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1719.503892]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1719.504742]  exit_to_user_mode_prepare+0x154/0x240
[ 1719.505519]  syscall_exit_to_user_mode+0x2b/0x60
[ 1719.506268]  do_syscall_64+0x46/0x80
[ 1719.506865]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1719.507651] RIP: 0033:0x7fac0740459d
[ 1719.508230] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1719.509199] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1719.510346] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1719.511404] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1719.512458] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1719.513514] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1719.514573] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1719.515859] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1719.515969] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1719.516859] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1719.517899] caller is debug_smp_processor_id+0x1c/0x20
[ 1719.519344] Call Trace:
[ 1719.519353]  dump_stack_lvl+0xa4/0xd3
[ 1719.519375]  dump_stack+0x15/0x17
[ 1719.519390]  check_preemption_disabled+0x167/0x180
[ 1719.519408]  ? del_timer_sync+0xd3/0x130
[ 1719.519423]  ? detach_if_pending+0x270/0x270
[ 1719.519444]  debug_smp_processor_id+0x1c/0x20
[ 1719.523633]  perf_ftrace_function_call+0x7c/0x360
[ 1719.524254]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1719.524882]  ? register_lock_class+0x42/0x440
[ 1719.525467]  ? del_timer_sync+0x40/0x130
[ 1719.525995]  ? 0xffffffffa0098099
[ 1719.526448]  ? 0xffffffffa0098099
[ 1719.526900]  ? 0xffffffffa0098099
[ 1719.527359]  0xffffffffa0098099
[ 1719.527783]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1719.528417]  ? del_timer_sync+0xa5/0x130
[ 1719.528949]  ? try_to_del_timer_sync+0x5/0x90
[ 1719.529528]  ? write_comp_data+0x2f/0x90
[ 1719.530060]  try_to_del_timer_sync+0x5/0x90
[ 1719.530622]  del_timer_sync+0xd3/0x130
[ 1719.531131]  ? try_to_del_timer_sync+0x5/0x90
[ 1719.531709]  ? del_timer_sync+0xd3/0x130
[ 1719.532240]  schedule_timeout+0x34e/0x610
[ 1719.532787]  ? del_timer_sync+0x130/0x130
[ 1719.533331]  ? i915_init_ggtt+0x40/0x6b0
[ 1719.533869]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1719.534414]  ? rcu_gp_init+0x730/0x730
[ 1719.534917]  rcu_gp_kthread+0xdd/0x170
[ 1719.535428]  kthread+0x1e7/0x230
[ 1719.535871]  ? set_kthread_struct+0x80/0x80
[ 1719.536436]  ret_from_fork+0x1f/0x30
[ 1719.536953] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1719.536987] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1719.537976] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1719.537994] Call Trace:
[ 1719.539023] caller is debug_smp_processor_id+0x1c/0x20
[ 1719.540544]  dump_stack_lvl+0xa4/0xd3
[ 1719.542105]  dump_stack+0x15/0x17
[ 1719.542594]  check_preemption_disabled+0x167/0x180
[ 1719.543303]  debug_smp_processor_id+0x1c/0x20
[ 1719.543933]  perf_trace_buf_alloc+0x98/0x100
[ 1719.544548]  ? text_poke_bp_batch+0x93/0x2c0
[ 1719.545154]  ? apply_paravirt+0x150/0x150
[ 1719.545737]  perf_ftrace_function_call+0x209/0x360
[ 1719.546527]  ? 0xffffffffa0098099
[ 1719.547069]  0xffffffffa0098099
[ 1719.547535]  ? _raw_spin_unlock+0x2c/0x50
[ 1719.548135]  ? __text_poke+0x2f2/0x4e0
[ 1719.548706]  ? nfs3_xdr_dec_link3res+0x130/0x130
[ 1719.549363]  ? text_poke+0x5/0x60
[ 1719.549871]  text_poke+0x5/0x60
[ 1719.550345]  text_poke_bp_batch+0x93/0x2c0
[ 1719.550935]  ? text_poke+0x5/0x60
[ 1719.551417]  ? text_poke_bp_batch+0x93/0x2c0
[ 1719.552048]  ? nfs4_xattr_get_nfs4_user+0x110/0x110
[ 1719.552761]  text_poke_queue+0xa7/0xc0
[ 1719.553327]  ftrace_replace_code+0xfd/0x170
[ 1719.553954]  ftrace_modify_all_code+0x1b1/0x270
[ 1719.554630]  arch_ftrace_update_code+0x9/0x10
[ 1719.555255]  ftrace_run_update_code+0x30/0xa0
[ 1719.555891]  ftrace_shutdown+0x2b8/0x4a0
[ 1719.556488]  unregister_ftrace_function+0x25/0x50
[ 1719.557164]  perf_ftrace_event_register+0x89/0xf0
[ 1719.557834]  ? perf_tp_event_init+0xa0/0xa0
[ 1719.558446]  perf_trace_destroy+0x37/0x60
[ 1719.559031]  tp_perf_event_destroy+0x15/0x20
[ 1719.559649]  _free_event+0xfc/0x7d0
[ 1719.560185]  put_event+0x37/0x50
[ 1719.560672]  perf_event_release_kernel+0x2f4/0x370
[ 1719.561394]  ? perf_event_release_kernel+0x370/0x370
[ 1719.562113]  perf_release+0x19/0x20
[ 1719.562630]  __fput+0x12d/0x460
[ 1719.563145]  ____fput+0x1a/0x20
[ 1719.563617]  task_work_run+0x8e/0xf0
[ 1719.564167]  do_exit+0x616/0x1310
[ 1719.564684]  ? write_comp_data+0x2f/0x90
[ 1719.565288]  do_group_exit+0x7e/0x130
[ 1719.565849]  get_signal+0x249/0x13c0
[ 1719.566399]  ? get_signal+0x5/0x13c0
[ 1719.566968]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1719.567695]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1719.568423]  exit_to_user_mode_prepare+0x154/0x240
[ 1719.569112]  syscall_exit_to_user_mode+0x2b/0x60
[ 1719.569778]  do_syscall_64+0x46/0x80
[ 1719.570332]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1719.571068] RIP: 0033:0x7fac0740459d
[ 1719.571588] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1719.572475] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1719.573513] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1719.574494] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1719.575466] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1719.576435] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1719.577405] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1719.578496] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1719.578605] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1719.579508] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1719.580550] caller is debug_smp_processor_id+0x1c/0x20
[ 1719.581984] Call Trace:
[ 1719.581993]  dump_stack_lvl+0xa4/0xd3
[ 1719.582015]  dump_stack+0x15/0x17
[ 1719.582030]  check_preemption_disabled+0x167/0x180
[ 1719.582054]  ? try_to_del_timer_sync+0x33/0x90
[ 1719.582072]  ? calc_wheel_index+0x2d0/0x2d0
[ 1719.582093]  debug_smp_processor_id+0x1c/0x20
[ 1719.586310]  perf_ftrace_function_call+0x7c/0x360
[ 1719.586934]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1719.587558]  ? del_timer_sync+0xd3/0x130
[ 1719.588084]  ? perf_ftrace_function_call+0x4c/0x360
[ 1719.588727]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1719.589355]  ? register_lock_class+0x42/0x440
[ 1719.589939]  ? del_timer_sync+0x40/0x130
[ 1719.590472]  ? 0xffffffffa0098099
[ 1719.590919]  ? 0xffffffffa0098099
[ 1719.591376]  0xffffffffa0098099
[ 1719.591807]  ? 0xffffffffa0098099
[ 1719.592253]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1719.592879]  ? del_timer_sync+0xa5/0x130
[ 1719.593411]  ? lock_timer_base+0x5/0x100
[ 1719.593942]  lock_timer_base+0x5/0x100
[ 1719.594451]  try_to_del_timer_sync+0x33/0x90
[ 1719.595020]  ? lock_timer_base+0x5/0x100
[ 1719.595544]  ? try_to_del_timer_sync+0x33/0x90
[ 1719.596133]  ? try_to_del_timer_sync+0x5/0x90
[ 1719.596718]  del_timer_sync+0xd3/0x130
[ 1719.597227]  schedule_timeout+0x34e/0x610
[ 1719.597772]  ? del_timer_sync+0x130/0x130
[ 1719.598318]  ? i915_init_ggtt+0x40/0x6b0
[ 1719.598854]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1719.599389]  ? rcu_gp_init+0x730/0x730
[ 1719.599891]  rcu_gp_kthread+0xdd/0x170
[ 1719.600402]  kthread+0x1e7/0x230
[ 1719.600843]  ? set_kthread_struct+0x80/0x80
[ 1719.601406]  ret_from_fork+0x1f/0x30
[ 1719.601921] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1719.601952] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1719.602941] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1719.603960] caller is debug_smp_processor_id+0x1c/0x20
[ 1719.605470] Call Trace:
[ 1719.606489]  dump_stack_lvl+0xa4/0xd3
[ 1719.607039]  dump_stack+0x15/0x17
[ 1719.607526]  check_preemption_disabled+0x167/0x180
[ 1719.608234]  debug_smp_processor_id+0x1c/0x20
[ 1719.608858]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1719.609628]  perf_tp_event+0x331/0x4e0
[ 1719.610322]  ? arch_local_irq_enable+0x10/0x12
[ 1719.610960]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1719.611639]  ? dump_stack_lvl+0xcc/0xd3
[ 1719.612208]  ? dump_stack+0x15/0x17
[ 1719.612718]  ? check_preemption_disabled+0x167/0x180
[ 1719.613449]  ? text_poke_bp_batch+0x93/0x2c0
[ 1719.614058]  ? apply_paravirt+0x150/0x150
[ 1719.614648]  perf_ftrace_function_call+0x248/0x360
[ 1719.615324]  ? perf_ftrace_function_call+0x248/0x360
[ 1719.616139]  ? 0xffffffffa0098099
[ 1719.616681]  0xffffffffa0098099
[ 1719.617147]  ? _raw_spin_unlock+0x2c/0x50
[ 1719.617749]  ? __text_poke+0x2f2/0x4e0
[ 1719.618324]  ? nfs3_xdr_dec_link3res+0x130/0x130
[ 1719.618981]  ? text_poke+0x5/0x60
[ 1719.619491]  text_poke+0x5/0x60
[ 1719.619957]  text_poke_bp_batch+0x93/0x2c0
[ 1719.620546]  ? text_poke+0x5/0x60
[ 1719.621027]  ? text_poke_bp_batch+0x93/0x2c0
[ 1719.621661]  ? nfs4_xattr_get_nfs4_user+0x110/0x110
[ 1719.622378]  text_poke_queue+0xa7/0xc0
[ 1719.622945]  ftrace_replace_code+0xfd/0x170
[ 1719.623573]  ftrace_modify_all_code+0x1b1/0x270
[ 1719.624238]  arch_ftrace_update_code+0x9/0x10
[ 1719.624860]  ftrace_run_update_code+0x30/0xa0
[ 1719.625495]  ftrace_shutdown+0x2b8/0x4a0
[ 1719.626097]  unregister_ftrace_function+0x25/0x50
[ 1719.626769]  perf_ftrace_event_register+0x89/0xf0
[ 1719.627439]  ? perf_tp_event_init+0xa0/0xa0
[ 1719.628039]  perf_trace_destroy+0x37/0x60
[ 1719.628625]  tp_perf_event_destroy+0x15/0x20
[ 1719.629243]  _free_event+0xfc/0x7d0
[ 1719.629780]  put_event+0x37/0x50
[ 1719.630270]  perf_event_release_kernel+0x2f4/0x370
[ 1719.630981]  ? perf_event_release_kernel+0x370/0x370
[ 1719.631694]  perf_release+0x19/0x20
[ 1719.632208]  __fput+0x12d/0x460
[ 1719.632722]  ____fput+0x1a/0x20
[ 1719.633193]  task_work_run+0x8e/0xf0
[ 1719.633741]  do_exit+0x616/0x1310
[ 1719.634259]  ? write_comp_data+0x2f/0x90
[ 1719.634863]  do_group_exit+0x7e/0x130
[ 1719.635424]  get_signal+0x249/0x13c0
[ 1719.635966]  ? get_signal+0x5/0x13c0
[ 1719.636534]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1719.637260]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1719.637987]  exit_to_user_mode_prepare+0x154/0x240
[ 1719.638679]  syscall_exit_to_user_mode+0x2b/0x60
[ 1719.639344]  do_syscall_64+0x46/0x80
[ 1719.639872]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1719.640591] RIP: 0033:0x7fac0740459d
[ 1719.641110] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1719.641998] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1719.643039] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1719.644006] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1719.644976] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1719.645944] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1719.646921] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1719.647999] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1719.648110] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1719.648996] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1719.650229] caller is debug_smp_processor_id+0x1c/0x20
[ 1719.651588] Call Trace:
[ 1719.651597]  dump_stack_lvl+0xa4/0xd3
[ 1719.653150]  dump_stack+0x15/0x17
[ 1719.653599]  check_preemption_disabled+0x167/0x180
[ 1719.654245]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1719.654790]  ? prepare_to_swait_exclusive+0x90/0x90
[ 1719.655437]  debug_smp_processor_id+0x1c/0x20
[ 1719.656018]  perf_ftrace_function_call+0x7c/0x360
[ 1719.656649]  ? trace_hardirqs_on+0x3f/0x170
[ 1719.657212]  ? preempt_count_sub+0x5/0xa0
[ 1719.657751]  ? preempt_count_sub+0x5/0xa0
[ 1719.658296]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1719.658955]  ? write_comp_data+0x2f/0x90
[ 1719.659489]  0xffffffffa0098099
[ 1719.659913]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1719.660547]  ? del_timer_sync+0xde/0x130
[ 1719.661093]  ? prepare_to_swait_event+0x5/0xf0
[ 1719.661697]  ? i915_init_ggtt+0x40/0x6b0
[ 1719.662235]  prepare_to_swait_event+0x5/0xf0
[ 1719.662803]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1719.663329]  ? prepare_to_swait_event+0x5/0xf0
[ 1719.663919]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1719.664476]  ? rcu_gp_init+0x730/0x730
[ 1719.664979]  rcu_gp_kthread+0xdd/0x170
[ 1719.665489]  kthread+0x1e7/0x230
[ 1719.665930]  ? set_kthread_struct+0x80/0x80
[ 1719.666503]  ret_from_fork+0x1f/0x30
[ 1719.667020] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1719.667048] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1719.668125] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1719.669152] caller is debug_smp_processor_id+0x1c/0x20
[ 1719.670800] Call Trace:
[ 1719.670834]  dump_stack_lvl+0xa4/0xd3
[ 1719.672449]  dump_stack+0x15/0x17
[ 1719.672995]  check_preemption_disabled+0x167/0x180
[ 1719.673750]  ? text_poke+0x2b/0x60
[ 1719.674309]  ? do_sync_core+0x30/0x30
[ 1719.674933]  debug_smp_processor_id+0x1c/0x20
[ 1719.675629]  perf_ftrace_function_call+0x7c/0x360
[ 1719.676361]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1719.677106]  ? text_poke_bp_batch+0x93/0x2c0
[ 1719.677788]  ? perf_ftrace_function_call+0x4c/0x360
[ 1719.678778]  ? nfs3_xdr_dec_link3res+0x130/0x130
[ 1719.679552]  0xffffffffa0098099
[ 1719.680133]  ? _raw_spin_unlock+0x2c/0x50
[ 1719.680880]  ? nfs3_xdr_dec_link3res+0x130/0x130
[ 1719.681613]  ? __text_poke+0x5/0x4e0
[ 1719.682206]  ? lock_is_held_type+0xe2/0x140
[ 1719.682896]  __text_poke+0x5/0x4e0
[ 1719.683454]  text_poke+0x2b/0x60
[ 1719.683988]  ? __text_poke+0x5/0x4e0
[ 1719.684558]  ? text_poke+0x2b/0x60
[ 1719.685147]  text_poke_bp_batch+0x93/0x2c0
[ 1719.685844]  ? nfs4_xattr_get_nfs4_user+0x110/0x110
[ 1719.686656]  text_poke_queue+0xa7/0xc0
[ 1719.687309]  ftrace_replace_code+0xfd/0x170
[ 1719.688029]  ftrace_modify_all_code+0x1b1/0x270
[ 1719.688787]  arch_ftrace_update_code+0x9/0x10
[ 1719.689477]  ftrace_run_update_code+0x30/0xa0
[ 1719.690193]  ftrace_shutdown+0x2b8/0x4a0
[ 1719.690887]  unregister_ftrace_function+0x25/0x50
[ 1719.691637]  perf_ftrace_event_register+0x89/0xf0
[ 1719.692378]  ? perf_tp_event_init+0xa0/0xa0
[ 1719.693045]  perf_trace_destroy+0x37/0x60
[ 1719.693700]  tp_perf_event_destroy+0x15/0x20
[ 1719.694393]  _free_event+0xfc/0x7d0
[ 1719.695019]  put_event+0x37/0x50
[ 1719.695583]  perf_event_release_kernel+0x2f4/0x370
[ 1719.696401]  ? perf_event_release_kernel+0x370/0x370
[ 1719.697198]  perf_release+0x19/0x20
[ 1719.697780]  __fput+0x12d/0x460
[ 1719.698405]  ____fput+0x1a/0x20
[ 1719.698940]  task_work_run+0x8e/0xf0
[ 1719.699578]  do_exit+0x616/0x1310
[ 1719.700182]  ? write_comp_data+0x2f/0x90
[ 1719.700887]  do_group_exit+0x7e/0x130
[ 1719.701538]  get_signal+0x249/0x13c0
[ 1719.702170]  ? get_signal+0x5/0x13c0
[ 1719.702851]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1719.703710]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1719.704564]  exit_to_user_mode_prepare+0x154/0x240
[ 1719.705339]  syscall_exit_to_user_mode+0x2b/0x60
[ 1719.706087]  do_syscall_64+0x46/0x80
[ 1719.706684]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1719.707466] RIP: 0033:0x7fac0740459d
[ 1719.708045] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1719.709015] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1719.710162] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1719.711218] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1719.712275] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1719.713330] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1719.714396] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1719.715687] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1719.716695] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1719.718156] Call Trace:
[ 1719.718492]  dump_stack_lvl+0xa4/0xd3
[ 1719.718991]  dump_stack+0x15/0x17
[ 1719.719440]  check_preemption_disabled+0x167/0x180
[ 1719.720076]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1719.720621]  ? rcu_pm_notify+0x40/0x40
[ 1719.721127]  debug_smp_processor_id+0x1c/0x20
[ 1719.721708]  perf_ftrace_function_call+0x7c/0x360
[ 1719.722346]  ? prepare_to_swait_event+0xbb/0xf0
[ 1719.722954]  ? 0xffffffffa0098099
[ 1719.723403]  ? 0xffffffffa0098099
[ 1719.723854]  ? 0xffffffffa0098099
[ 1719.724314]  ? 0xffffffffa0098099
[ 1719.724772]  0xffffffffa0098099
[ 1719.725198]  ? trace_hardirqs_on+0x3f/0x170
[ 1719.725761]  ? preempt_count_sub+0x5/0xa0
[ 1719.726315]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1719.726895]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1719.727576]  rcu_gp_fqs_check_wake+0x5/0x50
[ 1719.728134]  rcu_gp_fqs_loop+0x2bd/0x410
[ 1719.728659]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1719.729233]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1719.729789]  ? rcu_gp_init+0x730/0x730
[ 1719.730305]  rcu_gp_kthread+0xdd/0x170
[ 1719.730817]  kthread+0x1e7/0x230
[ 1719.731258]  ? set_kthread_struct+0x80/0x80
[ 1719.731823]  ret_from_fork+0x1f/0x30
[ 1724.406057] check_preemption_disabled: 1508797 callbacks suppressed
[ 1724.406089] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1724.406147] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1724.406974] caller is debug_smp_processor_id+0x1c/0x20
[ 1724.407829] caller is debug_smp_processor_id+0x1c/0x20
[ 1724.408855] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1724.411033] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1724.412479] Call Trace:
[ 1724.412848]  dump_stack_lvl+0xa4/0xd3
[ 1724.413407]  dump_stack+0x15/0x17
[ 1724.413890]  check_preemption_disabled+0x167/0x180
[ 1724.414618]  debug_smp_processor_id+0x1c/0x20
[ 1724.415229]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1724.416019]  perf_trace_buf_alloc+0x3d/0x100
[ 1724.416620]  ? text_poke_queue+0x84/0xc0
[ 1724.417167]  ? cpumask_weight+0x20/0x20
[ 1724.417724]  perf_ftrace_function_call+0x209/0x360
[ 1724.418596]  ? 0xffffffffa0098099
[ 1724.419123]  ? drm_self_refresh_helper_cleanup+0x50/0x50
[ 1724.419901]  0xffffffffa0098099
[ 1724.420408]  ? ftrace_call+0x5/0x44
[ 1724.420974]  ? drm_self_refresh_helper_cleanup+0x50/0x50
[ 1724.421710]  ? text_poke_loc_init+0x5/0x140
[ 1724.422326]  ? drm_self_refresh_helper_cleanup+0x50/0x50
[ 1724.423051]  text_poke_loc_init+0x5/0x140
[ 1724.423618]  text_poke_queue+0x84/0xc0
[ 1724.424155]  ? text_poke_loc_init+0x5/0x140
[ 1724.424732]  ? text_poke_queue+0x84/0xc0
[ 1724.425328]  ftrace_replace_code+0xfd/0x170
[ 1724.425967]  ftrace_modify_all_code+0x1b1/0x270
[ 1724.426647]  arch_ftrace_update_code+0x9/0x10
[ 1724.427257]  ftrace_run_update_code+0x30/0xa0
[ 1724.427885]  ftrace_shutdown+0x2b8/0x4a0
[ 1724.428503]  unregister_ftrace_function+0x25/0x50
[ 1724.429163]  perf_ftrace_event_register+0x89/0xf0
[ 1724.429815]  ? perf_tp_event_init+0xa0/0xa0
[ 1724.430410]  perf_trace_destroy+0x37/0x60
[ 1724.430988]  tp_perf_event_destroy+0x15/0x20
[ 1724.431597]  _free_event+0xfc/0x7d0
[ 1724.432151]  put_event+0x37/0x50
[ 1724.432643]  perf_event_release_kernel+0x2f4/0x370
[ 1724.433365]  ? perf_event_release_kernel+0x370/0x370
[ 1724.434072]  perf_release+0x19/0x20
[ 1724.434588]  __fput+0x12d/0x460
[ 1724.435144]  ____fput+0x1a/0x20
[ 1724.435616]  task_work_run+0x8e/0xf0
[ 1724.436182]  do_exit+0x616/0x1310
[ 1724.436717]  ? write_comp_data+0x2f/0x90
[ 1724.437344]  do_group_exit+0x7e/0x130
[ 1724.437921]  get_signal+0x249/0x13c0
[ 1724.438491]  ? get_signal+0x5/0x13c0
[ 1724.439095]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1724.439894]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1724.440711]  exit_to_user_mode_prepare+0x154/0x240
[ 1724.441453]  syscall_exit_to_user_mode+0x2b/0x60
[ 1724.442165]  do_syscall_64+0x46/0x80
[ 1724.442736]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1724.443485] RIP: 0033:0x7fac0740459d
[ 1724.444039] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1724.444965] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1724.446061] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1724.447071] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1724.448080] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1724.449090] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1724.450106] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1724.451344] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1724.451461] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1724.452283] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1724.453274] caller is debug_smp_processor_id+0x1c/0x20
[ 1724.454627] Call Trace:
[ 1724.454638]  dump_stack_lvl+0xa4/0xd3
[ 1724.454660]  dump_stack+0x15/0x17
[ 1724.454675]  check_preemption_disabled+0x167/0x180
[ 1724.454694]  ? schedule_timeout+0x34e/0x610
[ 1724.454709]  ? do_init_timer+0xa0/0xa0
[ 1724.454730]  debug_smp_processor_id+0x1c/0x20
[ 1724.458608]  perf_ftrace_function_call+0x7c/0x360
[ 1724.459200]  ? 0xffffffffa0098099
[ 1724.459619]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1724.460216]  ? finish_task_switch+0xab/0x2a0
[ 1724.460748]  ? __schedule+0x46e/0xb20
[ 1724.461226]  0xffffffffa0098099
[ 1724.461627]  ? finish_task_switch+0xb0/0x2a0
[ 1724.462186]  ? del_timer_sync+0x5/0x130
[ 1724.462681]  del_timer_sync+0x5/0x130
[ 1724.463144]  schedule_timeout+0x34e/0x610
[ 1724.463648]  ? del_timer_sync+0x5/0x130
[ 1724.464130]  ? schedule_timeout+0x34e/0x610
[ 1724.464664]  ? del_timer_sync+0x130/0x130
[ 1724.465174]  ? i915_init_ggtt+0x40/0x6b0
[ 1724.465680]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1724.466197]  ? rcu_gp_init+0x730/0x730
[ 1724.466675]  rcu_gp_kthread+0xdd/0x170
[ 1724.467156]  kthread+0x1e7/0x230
[ 1724.467572]  ? set_kthread_struct+0x80/0x80
[ 1724.468102]  ret_from_fork+0x1f/0x30
[ 1724.468588] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1724.468645] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1724.469560] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1724.470547] caller is debug_smp_processor_id+0x1c/0x20
[ 1724.471971] Call Trace:
[ 1724.472931]  dump_stack_lvl+0xa4/0xd3
[ 1724.473456]  dump_stack+0x15/0x17
[ 1724.473923]  check_preemption_disabled+0x167/0x180
[ 1724.474609]  debug_smp_processor_id+0x1c/0x20
[ 1724.475204]  perf_trace_buf_alloc+0x98/0x100
[ 1724.475789]  ? text_poke_queue+0x84/0xc0
[ 1724.476325]  ? cpumask_weight+0x20/0x20
[ 1724.476860]  perf_ftrace_function_call+0x209/0x360
[ 1724.477611]  ? 0xffffffffa0098099
[ 1724.478104]  ? drm_self_refresh_helper_cleanup+0x50/0x50
[ 1724.478840]  0xffffffffa0098099
[ 1724.479311]  ? ftrace_call+0x5/0x44
[ 1724.479830]  ? drm_self_refresh_helper_cleanup+0x50/0x50
[ 1724.480548]  ? text_poke_loc_init+0x5/0x140
[ 1724.481131]  ? drm_self_refresh_helper_cleanup+0x50/0x50
[ 1724.481845]  text_poke_loc_init+0x5/0x140
[ 1724.482408]  text_poke_queue+0x84/0xc0
[ 1724.482928]  ? text_poke_loc_init+0x5/0x140
[ 1724.483493]  ? text_poke_queue+0x84/0xc0
[ 1724.484056]  ftrace_replace_code+0xfd/0x170
[ 1724.484655]  ftrace_modify_all_code+0x1b1/0x270
[ 1724.485294]  arch_ftrace_update_code+0x9/0x10
[ 1724.485889]  ftrace_run_update_code+0x30/0xa0
[ 1724.486499]  ftrace_shutdown+0x2b8/0x4a0
[ 1724.487072]  unregister_ftrace_function+0x25/0x50
[ 1724.487713]  perf_ftrace_event_register+0x89/0xf0
[ 1724.488353]  ? perf_tp_event_init+0xa0/0xa0
[ 1724.488926]  perf_trace_destroy+0x37/0x60
[ 1724.489485]  tp_perf_event_destroy+0x15/0x20
[ 1724.490078]  _free_event+0xfc/0x7d0
[ 1724.490591]  put_event+0x37/0x50
[ 1724.491056]  perf_event_release_kernel+0x2f4/0x370
[ 1724.491735]  ? perf_event_release_kernel+0x370/0x370
[ 1724.492414]  perf_release+0x19/0x20
[ 1724.492906]  __fput+0x12d/0x460
[ 1724.493399]  ____fput+0x1a/0x20
[ 1724.493850]  task_work_run+0x8e/0xf0
[ 1724.494378]  do_exit+0x616/0x1310
[ 1724.494873]  ? write_comp_data+0x2f/0x90
[ 1724.495452]  do_group_exit+0x7e/0x130
[ 1724.495988]  get_signal+0x249/0x13c0
[ 1724.496507]  ? get_signal+0x5/0x13c0
[ 1724.497051]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1724.497746]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1724.498445]  exit_to_user_mode_prepare+0x154/0x240
[ 1724.499104]  syscall_exit_to_user_mode+0x2b/0x60
[ 1724.499736]  do_syscall_64+0x46/0x80
[ 1724.500239]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1724.500917] RIP: 0033:0x7fac0740459d
[ 1724.501410] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1724.502259] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1724.503254] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1724.504178] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1724.505102] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1724.506026] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1724.506953] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1724.507985] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1724.508103] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1724.508914] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1724.509907] caller is debug_smp_processor_id+0x1c/0x20
[ 1724.511247] Call Trace:
[ 1724.511257]  dump_stack_lvl+0xa4/0xd3
[ 1724.511278]  dump_stack+0x15/0x17
[ 1724.511293]  check_preemption_disabled+0x167/0x180
[ 1724.511312]  ? del_timer_sync+0xd3/0x130
[ 1724.511327]  ? detach_if_pending+0x270/0x270
[ 1724.511347]  debug_smp_processor_id+0x1c/0x20
[ 1724.515241]  perf_ftrace_function_call+0x7c/0x360
[ 1724.515824]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1724.516411]  ? register_lock_class+0x42/0x440
[ 1724.516960]  ? del_timer_sync+0x40/0x130
[ 1724.517455]  ? 0xffffffffa0098099
[ 1724.517875]  ? 0xffffffffa0098099
[ 1724.518303]  ? 0xffffffffa0098099
[ 1724.518733]  0xffffffffa0098099
[ 1724.519132]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1724.519728]  ? del_timer_sync+0xa5/0x130
[ 1724.520225]  ? try_to_del_timer_sync+0x5/0x90
[ 1724.520767]  ? write_comp_data+0x2f/0x90
[ 1724.521261]  try_to_del_timer_sync+0x5/0x90
[ 1724.521784]  del_timer_sync+0xd3/0x130
[ 1724.522269]  ? try_to_del_timer_sync+0x5/0x90
[ 1724.522811]  ? del_timer_sync+0xd3/0x130
[ 1724.523307]  schedule_timeout+0x34e/0x610
[ 1724.523819]  ? del_timer_sync+0x130/0x130
[ 1724.524326]  ? i915_init_ggtt+0x40/0x6b0
[ 1724.524830]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1724.525330]  ? rcu_gp_init+0x730/0x730
[ 1724.525800]  rcu_gp_kthread+0xdd/0x170
[ 1724.526281]  kthread+0x1e7/0x230
[ 1724.526695]  ? set_kthread_struct+0x80/0x80
[ 1724.527224]  ret_from_fork+0x1f/0x30
[ 1724.527708] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1724.527750] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1724.528678] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1724.529629] caller is debug_smp_processor_id+0x1c/0x20
[ 1724.531077] Call Trace:
[ 1724.531096]  dump_stack_lvl+0xa4/0xd3
[ 1724.532539]  dump_stack+0x15/0x17
[ 1724.533003]  check_preemption_disabled+0x167/0x180
[ 1724.533679]  debug_smp_processor_id+0x1c/0x20
[ 1724.534282]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1724.535016]  perf_tp_event+0x331/0x4e0
[ 1724.535613]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1724.536402]  ? arch_local_irq_enable+0x10/0x12
[ 1724.537010]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1724.537657]  ? dump_stack_lvl+0xcc/0xd3
[ 1724.538213]  ? dump_stack+0x15/0x17
[ 1724.538715]  ? text_poke_queue+0x84/0xc0
[ 1724.539251]  ? cpumask_weight+0x20/0x20
[ 1724.539795]  perf_ftrace_function_call+0x248/0x360
[ 1724.540439]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1724.541050]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1724.541688]  ? perf_ftrace_function_call+0x248/0x360
[ 1724.542487]  ? 0xffffffffa0098099
[ 1724.542973]  ? drm_self_refresh_helper_cleanup+0x50/0x50
[ 1724.543716]  0xffffffffa0098099
[ 1724.544182]  ? ftrace_call+0x5/0x44
[ 1724.544698]  ? drm_self_refresh_helper_cleanup+0x50/0x50
[ 1724.545414]  ? text_poke_loc_init+0x5/0x140
[ 1724.545995]  ? drm_self_refresh_helper_cleanup+0x50/0x50
[ 1724.546714]  text_poke_loc_init+0x5/0x140
[ 1724.547268]  text_poke_queue+0x84/0xc0
[ 1724.547789]  ? text_poke_loc_init+0x5/0x140
[ 1724.548353]  ? text_poke_queue+0x84/0xc0
[ 1724.548914]  ftrace_replace_code+0xfd/0x170
[ 1724.549519]  ftrace_modify_all_code+0x1b1/0x270
[ 1724.550162]  arch_ftrace_update_code+0x9/0x10
[ 1724.550756]  ftrace_run_update_code+0x30/0xa0
[ 1724.551359]  ftrace_shutdown+0x2b8/0x4a0
[ 1724.551929]  unregister_ftrace_function+0x25/0x50
[ 1724.552571]  perf_ftrace_event_register+0x89/0xf0
[ 1724.553207]  ? perf_tp_event_init+0xa0/0xa0
[ 1724.553778]  perf_trace_destroy+0x37/0x60
[ 1724.554343]  tp_perf_event_destroy+0x15/0x20
[ 1724.554931]  _free_event+0xfc/0x7d0
[ 1724.555443]  put_event+0x37/0x50
[ 1724.555911]  perf_event_release_kernel+0x2f4/0x370
[ 1724.556588]  ? perf_event_release_kernel+0x370/0x370
[ 1724.557267]  perf_release+0x19/0x20
[ 1724.557758]  __fput+0x12d/0x460
[ 1724.558264]  ____fput+0x1a/0x20
[ 1724.558714]  task_work_run+0x8e/0xf0
[ 1724.559238]  do_exit+0x616/0x1310
[ 1724.559730]  ? write_comp_data+0x2f/0x90
[ 1724.560305]  do_group_exit+0x7e/0x130
[ 1724.560842]  get_signal+0x249/0x13c0
[ 1724.561359]  ? get_signal+0x5/0x13c0
[ 1724.561902]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1724.562607]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1724.563311]  exit_to_user_mode_prepare+0x154/0x240
[ 1724.563989]  syscall_exit_to_user_mode+0x2b/0x60
[ 1724.564623]  do_syscall_64+0x46/0x80
[ 1724.565126]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1724.565802] RIP: 0033:0x7fac0740459d
[ 1724.566303] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1724.567152] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1724.568137] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1724.569055] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1724.569980] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1724.570911] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1724.571829] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1724.572858] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1724.572969] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1724.573815] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1724.574999] caller is debug_smp_processor_id+0x1c/0x20
[ 1724.576240] Call Trace:
[ 1724.576249]  dump_stack_lvl+0xa4/0xd3
[ 1724.577713]  dump_stack+0x15/0x17
[ 1724.578140]  check_preemption_disabled+0x167/0x180
[ 1724.578731]  ? try_to_del_timer_sync+0x33/0x90
[ 1724.579288]  ? calc_wheel_index+0x2d0/0x2d0
[ 1724.579812]  debug_smp_processor_id+0x1c/0x20
[ 1724.580354]  perf_ftrace_function_call+0x7c/0x360
[ 1724.580936]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1724.581516]  ? del_timer_sync+0xd3/0x130
[ 1724.582007]  ? perf_ftrace_function_call+0x4c/0x360
[ 1724.582617]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1724.583205]  ? register_lock_class+0x42/0x440
[ 1724.583751]  ? del_timer_sync+0x40/0x130
[ 1724.584246]  ? 0xffffffffa0098099
[ 1724.584665]  ? 0xffffffffa0098099
[ 1724.585091]  0xffffffffa0098099
[ 1724.585494]  ? 0xffffffffa0098099
[ 1724.585910]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1724.586504]  ? del_timer_sync+0xa5/0x130
[ 1724.587000]  ? lock_timer_base+0x5/0x100
[ 1724.587504]  lock_timer_base+0x5/0x100
[ 1724.587975]  try_to_del_timer_sync+0x33/0x90
[ 1724.588507]  ? lock_timer_base+0x5/0x100
[ 1724.588996]  ? try_to_del_timer_sync+0x33/0x90
[ 1724.589547]  ? try_to_del_timer_sync+0x5/0x90
[ 1724.590111]  del_timer_sync+0xd3/0x130
[ 1724.590588]  schedule_timeout+0x34e/0x610
[ 1724.591099]  ? del_timer_sync+0x130/0x130
[ 1724.591607]  ? i915_init_ggtt+0x40/0x6b0
[ 1724.592110]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1724.592611]  ? rcu_gp_init+0x730/0x730
[ 1724.593081]  rcu_gp_kthread+0xdd/0x170
[ 1724.593558]  kthread+0x1e7/0x230
[ 1724.593971]  ? set_kthread_struct+0x80/0x80
[ 1724.594509]  ret_from_fork+0x1f/0x30
[ 1724.594994] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1724.595023] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1724.596056] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1724.597006] caller is debug_smp_processor_id+0x1c/0x20
[ 1724.598576] Call Trace:
[ 1724.598610]  dump_stack_lvl+0xa4/0xd3
[ 1724.600143]  dump_stack+0x15/0x17
[ 1724.600668]  check_preemption_disabled+0x167/0x180
[ 1724.601390]  ? text_poke_loc_init+0x63/0x140
[ 1724.602038]  ? insn_get_length+0x90/0x90
[ 1724.602673]  debug_smp_processor_id+0x1c/0x20
[ 1724.603345]  perf_ftrace_function_call+0x7c/0x360
[ 1724.604088]  ? dump_stack+0x15/0x17
[ 1724.604668]  ? text_poke_queue+0x84/0xc0
[ 1724.605263]  ? cpumask_weight+0x20/0x20
[ 1724.605877]  ? perf_ftrace_function_call+0x248/0x360
[ 1724.606620]  ? perf_trace_buf_alloc+0xb0/0x100
[ 1724.607295]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1724.608004]  ? text_poke_queue+0x84/0xc0
[ 1724.608609]  ? perf_ftrace_function_call+0x4c/0x360
[ 1724.609405]  ? drm_self_refresh_helper_cleanup+0x50/0x50
[ 1724.610214]  0xffffffffa0098099
[ 1724.610882]  ? insn_decode+0x5/0x170
[ 1724.611482]  insn_decode+0x5/0x170
[ 1724.612017]  text_poke_loc_init+0x63/0x140
[ 1724.612645]  ? insn_decode+0x5/0x170
[ 1724.613191]  ? text_poke_loc_init+0x63/0x140
[ 1724.613906]  ? drm_self_refresh_helper_cleanup+0x50/0x50
[ 1724.614715]  ? text_poke_loc_init+0x5/0x140
[ 1724.615387]  ? drm_self_refresh_helper_cleanup+0x50/0x50
[ 1724.616221]  text_poke_queue+0x84/0xc0
[ 1724.616847]  ftrace_replace_code+0xfd/0x170
[ 1724.617540]  ftrace_modify_all_code+0x1b1/0x270
[ 1724.618278]  arch_ftrace_update_code+0x9/0x10
[ 1724.618941]  ftrace_run_update_code+0x30/0xa0
[ 1724.619625]  ftrace_shutdown+0x2b8/0x4a0
[ 1724.620301]  unregister_ftrace_function+0x25/0x50
[ 1724.621020]  perf_ftrace_event_register+0x89/0xf0
[ 1724.621729]  ? perf_tp_event_init+0xa0/0xa0
[ 1724.622377]  perf_trace_destroy+0x37/0x60
[ 1724.623006]  tp_perf_event_destroy+0x15/0x20
[ 1724.623669]  _free_event+0xfc/0x7d0
[ 1724.624270]  put_event+0x37/0x50
[ 1724.624804]  perf_event_release_kernel+0x2f4/0x370
[ 1724.625589]  ? perf_event_release_kernel+0x370/0x370
[ 1724.626362]  perf_release+0x19/0x20
[ 1724.626922]  __fput+0x12d/0x460
[ 1724.627520]  ____fput+0x1a/0x20
[ 1724.628034]  task_work_run+0x8e/0xf0
[ 1724.628647]  do_exit+0x616/0x1310
[ 1724.629226]  ? write_comp_data+0x2f/0x90
[ 1724.629906]  do_group_exit+0x7e/0x130
[ 1724.630539]  get_signal+0x249/0x13c0
[ 1724.631141]  ? get_signal+0x5/0x13c0
[ 1724.631794]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1724.632620]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1724.633436]  exit_to_user_mode_prepare+0x154/0x240
[ 1724.634182]  syscall_exit_to_user_mode+0x2b/0x60
[ 1724.634892]  do_syscall_64+0x46/0x80
[ 1724.635462]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1724.636209] RIP: 0033:0x7fac0740459d
[ 1724.636761] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1724.637684] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1724.638776] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1724.639784] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1724.640801] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1724.641810] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1724.642824] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1724.644055] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1724.644165] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1724.644988] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1724.646165] caller is debug_smp_processor_id+0x1c/0x20
[ 1724.647406] Call Trace:
[ 1724.647415]  dump_stack_lvl+0xa4/0xd3
[ 1724.648879]  dump_stack+0x15/0x17
[ 1724.649300]  check_preemption_disabled+0x167/0x180
[ 1724.649892]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1724.650403]  ? prepare_to_swait_exclusive+0x90/0x90
[ 1724.651009]  debug_smp_processor_id+0x1c/0x20
[ 1724.651567]  perf_ftrace_function_call+0x7c/0x360
[ 1724.652214]  ? trace_hardirqs_on+0x3f/0x170
[ 1724.652790]  ? preempt_count_sub+0x5/0xa0
[ 1724.653341]  ? preempt_count_sub+0x5/0xa0
[ 1724.653884]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1724.654560]  ? write_comp_data+0x2f/0x90
[ 1724.655106]  0xffffffffa0098099
[ 1724.655537]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1724.656185]  ? del_timer_sync+0xde/0x130
[ 1724.656725]  ? prepare_to_swait_event+0x5/0xf0
[ 1724.657324]  ? i915_init_ggtt+0x40/0x6b0
[ 1724.657862]  prepare_to_swait_event+0x5/0xf0
[ 1724.658444]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1724.658977]  ? prepare_to_swait_event+0x5/0xf0
[ 1724.659574]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1724.660139]  ? rcu_gp_init+0x730/0x730
[ 1724.660650]  rcu_gp_kthread+0xdd/0x170
[ 1724.661198]  kthread+0x1e7/0x230
[ 1724.661647]  ? set_kthread_struct+0x80/0x80
[ 1724.662223]  ret_from_fork+0x1f/0x30
[ 1724.662736] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1724.662768] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1724.663860] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1724.664862] caller is debug_smp_processor_id+0x1c/0x20
[ 1724.666517] Call Trace:
[ 1724.666555]  dump_stack_lvl+0xa4/0xd3
[ 1724.668183]  dump_stack+0x15/0x17
[ 1724.668741]  check_preemption_disabled+0x167/0x180
[ 1724.669565]  debug_smp_processor_id+0x1c/0x20
[ 1724.670279]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1724.671188]  perf_trace_buf_alloc+0x3d/0x100
[ 1724.671881]  ? text_poke_loc_init+0x63/0x140
[ 1724.672559]  ? insn_get_length+0x90/0x90
[ 1724.673211]  perf_ftrace_function_call+0x209/0x360
[ 1724.674201]  ? 0xffffffffa0098099
[ 1724.674842]  ? drm_self_refresh_helper_cleanup+0x50/0x50
[ 1724.675694]  0xffffffffa0098099
[ 1724.676403]  ? insn_decode+0x5/0x170
[ 1724.677040]  insn_decode+0x5/0x170
[ 1724.677606]  text_poke_loc_init+0x63/0x140
[ 1724.678276]  ? insn_decode+0x5/0x170
[ 1724.678856]  ? text_poke_loc_init+0x63/0x140
[ 1724.679618]  ? drm_self_refresh_helper_cleanup+0x50/0x50
[ 1724.680468]  ? text_poke_loc_init+0x5/0x140
[ 1724.681180]  ? drm_self_refresh_helper_cleanup+0x50/0x50
[ 1724.682070]  text_poke_queue+0x84/0xc0
[ 1724.682700]  ftrace_replace_code+0xfd/0x170
[ 1724.683397]  ftrace_modify_all_code+0x1b1/0x270
[ 1724.684127]  arch_ftrace_update_code+0x9/0x10
[ 1724.684793]  ftrace_run_update_code+0x30/0xa0
[ 1724.685479]  ftrace_shutdown+0x2b8/0x4a0
[ 1724.686159]  unregister_ftrace_function+0x25/0x50
[ 1724.686883]  perf_ftrace_event_register+0x89/0xf0
[ 1724.687598]  ? perf_tp_event_init+0xa0/0xa0
[ 1724.688239]  perf_trace_destroy+0x37/0x60
[ 1724.688870]  tp_perf_event_destroy+0x15/0x20
[ 1724.689537]  _free_event+0xfc/0x7d0
[ 1724.690145]  put_event+0x37/0x50
[ 1724.690683]  perf_event_release_kernel+0x2f4/0x370
[ 1724.691471]  ? perf_event_release_kernel+0x370/0x370
[ 1724.692237]  perf_release+0x19/0x20
[ 1724.692797]  __fput+0x12d/0x460
[ 1724.693400]  ____fput+0x1a/0x20
[ 1724.693916]  task_work_run+0x8e/0xf0
[ 1724.694536]  do_exit+0x616/0x1310
[ 1724.695120]  ? write_comp_data+0x2f/0x90
[ 1724.695804]  do_group_exit+0x7e/0x130
[ 1724.696433]  get_signal+0x249/0x13c0
[ 1724.697038]  ? get_signal+0x5/0x13c0
[ 1724.697695]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1724.698530]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1724.699350]  exit_to_user_mode_prepare+0x154/0x240
[ 1724.700093]  syscall_exit_to_user_mode+0x2b/0x60
[ 1724.700805]  do_syscall_64+0x46/0x80
[ 1724.701376]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1724.702129] RIP: 0033:0x7fac0740459d
[ 1724.702685] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1724.703612] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1724.704704] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1724.705719] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1724.706737] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1724.707745] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1724.708754] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1724.709992] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1724.710933] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1724.712285] Call Trace:
[ 1724.712598]  dump_stack_lvl+0xa4/0xd3
[ 1724.713065]  dump_stack+0x15/0x17
[ 1724.713485]  check_preemption_disabled+0x167/0x180
[ 1724.714084]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1724.714593]  ? rcu_pm_notify+0x40/0x40
[ 1724.715067]  debug_smp_processor_id+0x1c/0x20
[ 1724.715611]  perf_ftrace_function_call+0x7c/0x360
[ 1724.716196]  ? prepare_to_swait_event+0xbb/0xf0
[ 1724.716761]  ? 0xffffffffa0098099
[ 1724.717182]  ? 0xffffffffa0098099
[ 1724.717603]  ? 0xffffffffa0098099
[ 1724.718040]  ? 0xffffffffa0098099
[ 1724.718470]  0xffffffffa0098099
[ 1724.718869]  ? trace_hardirqs_on+0x3f/0x170
[ 1724.719591]  ? preempt_count_sub+0x5/0xa0
[ 1724.720106]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1724.720649]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1724.721269]  rcu_gp_fqs_check_wake+0x5/0x50
[ 1724.721792]  rcu_gp_fqs_loop+0x2bd/0x410
[ 1724.722288]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1724.722828]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1724.723350]  ? rcu_gp_init+0x730/0x730
[ 1724.723822]  rcu_gp_kthread+0xdd/0x170
[ 1724.724303]  kthread+0x1e7/0x230
[ 1724.724718]  ? set_kthread_struct+0x80/0x80
[ 1724.725249]  ret_from_fork+0x1f/0x30
[ 1729.410065] check_preemption_disabled: 1553159 callbacks suppressed
[ 1729.410087] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1729.410146] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1729.410912] caller is debug_smp_processor_id+0x1c/0x20
[ 1729.411771] caller is debug_smp_processor_id+0x1c/0x20
[ 1729.412717] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1729.414764] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1729.416091] Call Trace:
[ 1729.416414]  dump_stack_lvl+0xa4/0xd3
[ 1729.416897]  dump_stack+0x15/0x17
[ 1729.417325]  check_preemption_disabled+0x167/0x180
[ 1729.417947]  debug_smp_processor_id+0x1c/0x20
[ 1729.418505]  perf_trace_buf_alloc+0x98/0x100
[ 1729.419043]  ? text_poke+0x2b/0x60
[ 1729.419475]  ? do_sync_core+0x30/0x30
[ 1729.419946]  perf_ftrace_function_call+0x209/0x360
[ 1729.420644]  ? 0xffffffffa0098099
[ 1729.421092]  ? xhci_hub_control+0x38f0/0x38f0
[ 1729.421675]  0xffffffffa0098099
[ 1729.422114]  ? _raw_spin_unlock+0x2c/0x50
[ 1729.422653]  ? xhci_hub_control+0x38f0/0x38f0
[ 1729.423197]  ? __text_poke+0x5/0x4e0
[ 1729.423653]  ? lock_is_held_type+0xe2/0x140
[ 1729.424188]  __text_poke+0x5/0x4e0
[ 1729.424625]  text_poke+0x2b/0x60
[ 1729.425042]  ? __text_poke+0x5/0x4e0
[ 1729.425492]  ? text_poke+0x2b/0x60
[ 1729.425947]  text_poke_bp_batch+0x93/0x2c0
[ 1729.426492]  ? dbc_read_complete+0xb0/0xb0
[ 1729.427029]  text_poke_queue+0xa7/0xc0
[ 1729.427532]  ftrace_replace_code+0xfd/0x170
[ 1729.428083]  ftrace_modify_all_code+0x1b1/0x270
[ 1729.428669]  arch_ftrace_update_code+0x9/0x10
[ 1729.429213]  ftrace_run_update_code+0x30/0xa0
[ 1729.429768]  ftrace_shutdown+0x2b8/0x4a0
[ 1729.430302]  unregister_ftrace_function+0x25/0x50
[ 1729.430893]  perf_ftrace_event_register+0x89/0xf0
[ 1729.431478]  ? perf_tp_event_init+0xa0/0xa0
[ 1729.432005]  perf_trace_destroy+0x37/0x60
[ 1729.432518]  tp_perf_event_destroy+0x15/0x20
[ 1729.433060]  _free_event+0xfc/0x7d0
[ 1729.433532]  put_event+0x37/0x50
[ 1729.433959]  perf_event_release_kernel+0x2f4/0x370
[ 1729.434591]  ? perf_event_release_kernel+0x370/0x370
[ 1729.435212]  perf_release+0x19/0x20
[ 1729.435664]  __fput+0x12d/0x460
[ 1729.436118]  ____fput+0x1a/0x20
[ 1729.436532]  task_work_run+0x8e/0xf0
[ 1729.437016]  do_exit+0x616/0x1310
[ 1729.437470]  ? write_comp_data+0x2f/0x90
[ 1729.438002]  do_group_exit+0x7e/0x130
[ 1729.438502]  get_signal+0x249/0x13c0
[ 1729.438979]  ? get_signal+0x5/0x13c0
[ 1729.439481]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1729.440121]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1729.440760]  exit_to_user_mode_prepare+0x154/0x240
[ 1729.441366]  syscall_exit_to_user_mode+0x2b/0x60
[ 1729.441949]  do_syscall_64+0x46/0x80
[ 1729.442421]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1729.443046] RIP: 0033:0x7fac0740459d
[ 1729.443530] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1729.444394] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1729.445383] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1729.446320] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1729.447256] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1729.448183] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1729.449110] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1729.450154] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1729.450270] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1729.451098] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1729.452093] caller is debug_smp_processor_id+0x1c/0x20
[ 1729.453448] Call Trace:
[ 1729.454430]  dump_stack_lvl+0xa4/0xd3
[ 1729.454901]  dump_stack+0x15/0x17
[ 1729.455326]  check_preemption_disabled+0x167/0x180
[ 1729.455925]  ? schedule_timeout+0x34e/0x610
[ 1729.456450]  ? do_init_timer+0xa0/0xa0
[ 1729.456930]  debug_smp_processor_id+0x1c/0x20
[ 1729.457476]  perf_ftrace_function_call+0x7c/0x360
[ 1729.458074]  ? 0xffffffffa0098099
[ 1729.458497]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1729.459098]  ? finish_task_switch+0xab/0x2a0
[ 1729.459634]  ? __schedule+0x46e/0xb20
[ 1729.460117]  0xffffffffa0098099
[ 1729.460521]  ? finish_task_switch+0xb0/0x2a0
[ 1729.461074]  ? del_timer_sync+0x5/0x130
[ 1729.461567]  del_timer_sync+0x5/0x130
[ 1729.462037]  schedule_timeout+0x34e/0x610
[ 1729.462546]  ? del_timer_sync+0x5/0x130
[ 1729.463031]  ? schedule_timeout+0x34e/0x610
[ 1729.463566]  ? del_timer_sync+0x130/0x130
[ 1729.464079]  ? i915_init_ggtt+0x40/0x6b0
[ 1729.464589]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1729.465096]  ? rcu_gp_init+0x730/0x730
[ 1729.465570]  rcu_gp_kthread+0xdd/0x170
[ 1729.466055]  kthread+0x1e7/0x230
[ 1729.466475]  ? set_kthread_struct+0x80/0x80
[ 1729.467008]  ret_from_fork+0x1f/0x30
[ 1729.467497] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1729.467529] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1729.468476] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1729.469436] caller is debug_smp_processor_id+0x1c/0x20
[ 1729.470907] Call Trace:
[ 1729.470927]  dump_stack_lvl+0xa4/0xd3
[ 1729.472386]  dump_stack+0x15/0x17
[ 1729.472858]  check_preemption_disabled+0x167/0x180
[ 1729.473548]  debug_smp_processor_id+0x1c/0x20
[ 1729.474157]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1729.474898]  perf_tp_event+0x331/0x4e0
[ 1729.475499]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1729.476296]  ? arch_local_irq_enable+0x10/0x12
[ 1729.476906]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1729.477563]  ? dump_stack_lvl+0xcc/0xd3
[ 1729.478122]  ? dump_stack+0x15/0x17
[ 1729.478613]  ? check_preemption_disabled+0x167/0x180
[ 1729.479308]  ? text_poke+0x2b/0x60
[ 1729.479783]  ? do_sync_core+0x30/0x30
[ 1729.480305]  perf_ftrace_function_call+0x248/0x360
[ 1729.480959]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1729.481602]  ? perf_ftrace_function_call+0x248/0x360
[ 1729.482398]  ? 0xffffffffa0098099
[ 1729.482889]  ? xhci_hub_control+0x38f0/0x38f0
[ 1729.483510]  0xffffffffa0098099
[ 1729.483992]  ? _raw_spin_unlock+0x2c/0x50
[ 1729.484582]  ? xhci_hub_control+0x38f0/0x38f0
[ 1729.485181]  ? __text_poke+0x5/0x4e0
[ 1729.485682]  ? lock_is_held_type+0xe2/0x140
[ 1729.486280]  __text_poke+0x5/0x4e0
[ 1729.486762]  text_poke+0x2b/0x60
[ 1729.487221]  ? __text_poke+0x5/0x4e0
[ 1729.487718]  ? text_poke+0x2b/0x60
[ 1729.488213]  text_poke_bp_batch+0x93/0x2c0
[ 1729.488800]  ? dbc_read_complete+0xb0/0xb0
[ 1729.489390]  text_poke_queue+0xa7/0xc0
[ 1729.489936]  ftrace_replace_code+0xfd/0x170
[ 1729.490547]  ftrace_modify_all_code+0x1b1/0x270
[ 1729.491187]  arch_ftrace_update_code+0x9/0x10
[ 1729.491787]  ftrace_run_update_code+0x30/0xa0
[ 1729.492396]  ftrace_shutdown+0x2b8/0x4a0
[ 1729.492973]  unregister_ftrace_function+0x25/0x50
[ 1729.493621]  perf_ftrace_event_register+0x89/0xf0
[ 1729.494277]  ? perf_tp_event_init+0xa0/0xa0
[ 1729.494855]  perf_trace_destroy+0x37/0x60
[ 1729.495418]  tp_perf_event_destroy+0x15/0x20
[ 1729.496013]  _free_event+0xfc/0x7d0
[ 1729.496530]  put_event+0x37/0x50
[ 1729.497001]  perf_event_release_kernel+0x2f4/0x370
[ 1729.497687]  ? perf_event_release_kernel+0x370/0x370
[ 1729.498378]  perf_release+0x19/0x20
[ 1729.498874]  __fput+0x12d/0x460
[ 1729.499370]  ____fput+0x1a/0x20
[ 1729.499824]  task_work_run+0x8e/0xf0
[ 1729.500352]  do_exit+0x616/0x1310
[ 1729.500849]  ? write_comp_data+0x2f/0x90
[ 1729.501431]  do_group_exit+0x7e/0x130
[ 1729.501972]  get_signal+0x249/0x13c0
[ 1729.502497]  ? get_signal+0x5/0x13c0
[ 1729.503045]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1729.503746]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1729.504446]  exit_to_user_mode_prepare+0x154/0x240
[ 1729.505109]  syscall_exit_to_user_mode+0x2b/0x60
[ 1729.505747]  do_syscall_64+0x46/0x80
[ 1729.506256]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1729.506939] RIP: 0033:0x7fac0740459d
[ 1729.507441] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1729.508294] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1729.509293] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1729.510225] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1729.511154] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1729.512082] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1729.513011] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1729.514054] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1729.514166] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1729.514996] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1729.516078] caller is debug_smp_processor_id+0x1c/0x20
[ 1729.517427] Call Trace:
[ 1729.517438]  dump_stack_lvl+0xa4/0xd3
[ 1729.518915]  dump_stack+0x15/0x17
[ 1729.519341]  check_preemption_disabled+0x167/0x180
[ 1729.519939]  ? del_timer_sync+0xd3/0x130
[ 1729.520434]  ? detach_if_pending+0x270/0x270
[ 1729.520982]  debug_smp_processor_id+0x1c/0x20
[ 1729.521534]  perf_ftrace_function_call+0x7c/0x360
[ 1729.522132]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1729.522725]  ? register_lock_class+0x42/0x440
[ 1729.523276]  ? del_timer_sync+0x40/0x130
[ 1729.523779]  ? 0xffffffffa0098099
[ 1729.524204]  ? 0xffffffffa0098099
[ 1729.524627]  ? 0xffffffffa0098099
[ 1729.525060]  0xffffffffa0098099
[ 1729.525462]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1729.526066]  ? del_timer_sync+0xa5/0x130
[ 1729.526573]  ? try_to_del_timer_sync+0x5/0x90
[ 1729.527120]  ? write_comp_data+0x2f/0x90
[ 1729.527619]  try_to_del_timer_sync+0x5/0x90
[ 1729.528146]  del_timer_sync+0xd3/0x130
[ 1729.528623]  ? try_to_del_timer_sync+0x5/0x90
[ 1729.529169]  ? del_timer_sync+0xd3/0x130
[ 1729.529670]  schedule_timeout+0x34e/0x610
[ 1729.530192]  ? del_timer_sync+0x130/0x130
[ 1729.530706]  ? i915_init_ggtt+0x40/0x6b0
[ 1729.531214]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1729.531720]  ? rcu_gp_init+0x730/0x730
[ 1729.532193]  rcu_gp_kthread+0xdd/0x170
[ 1729.532676]  kthread+0x1e7/0x230
[ 1729.533092]  ? set_kthread_struct+0x80/0x80
[ 1729.533624]  ret_from_fork+0x1f/0x30
[ 1729.534116] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1729.534142] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1729.535184] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1729.536141] caller is debug_smp_processor_id+0x1c/0x20
[ 1729.537700] Call Trace:
[ 1729.538710]  dump_stack_lvl+0xa4/0xd3
[ 1729.539315]  dump_stack+0x15/0x17
[ 1729.539840]  check_preemption_disabled+0x167/0x180
[ 1729.540562]  ? __text_poke+0xea/0x4e0
[ 1729.541123]  ? __pmd_alloc+0x420/0x420
[ 1729.541727]  debug_smp_processor_id+0x1c/0x20
[ 1729.542401]  perf_ftrace_function_call+0x7c/0x360
[ 1729.543132]  ? text_poke+0x2b/0x60
[ 1729.543656]  ? do_sync_core+0x30/0x30
[ 1729.544246]  ? perf_ftrace_function_call+0x248/0x360
[ 1729.544990]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1729.545699]  ? text_poke+0x2b/0x60
[ 1729.546237]  ? perf_ftrace_function_call+0x4c/0x360
[ 1729.547099]  ? xhci_hub_control+0x38f0/0x38f0
[ 1729.547785]  0xffffffffa0098099
[ 1729.548304]  ? 0xffffffffa0098099
[ 1729.548961]  ? __get_locked_pte+0x5/0x290
[ 1729.549622]  __get_locked_pte+0x5/0x290
[ 1729.550219]  __text_poke+0xea/0x4e0
[ 1729.550769]  ? __get_locked_pte+0x5/0x290
[ 1729.551373]  ? __text_poke+0xea/0x4e0
[ 1729.551943]  ? xhci_hub_control+0x38f0/0x38f0
[ 1729.552627]  ? lock_is_held_type+0xe2/0x140
[ 1729.553278]  ? xhci_hub_control+0x38f0/0x38f0
[ 1729.553983]  text_poke+0x2b/0x60
[ 1729.554531]  text_poke_bp_batch+0x93/0x2c0
[ 1729.555203]  ? dbc_read_complete+0xb0/0xb0
[ 1729.555877]  text_poke_queue+0xa7/0xc0
[ 1729.556504]  ftrace_replace_code+0xfd/0x170
[ 1729.557197]  ftrace_modify_all_code+0x1b1/0x270
[ 1729.557927]  arch_ftrace_update_code+0x9/0x10
[ 1729.558600]  ftrace_run_update_code+0x30/0xa0
[ 1729.559288]  ftrace_shutdown+0x2b8/0x4a0
[ 1729.559958]  unregister_ftrace_function+0x25/0x50
[ 1729.560678]  perf_ftrace_event_register+0x89/0xf0
[ 1729.561389]  ? perf_tp_event_init+0xa0/0xa0
[ 1729.562029]  perf_trace_destroy+0x37/0x60
[ 1729.562669]  tp_perf_event_destroy+0x15/0x20
[ 1729.563333]  _free_event+0xfc/0x7d0
[ 1729.563935]  put_event+0x37/0x50
[ 1729.564470]  perf_event_release_kernel+0x2f4/0x370
[ 1729.565256]  ? perf_event_release_kernel+0x370/0x370
[ 1729.566022]  perf_release+0x19/0x20
[ 1729.566586]  __fput+0x12d/0x460
[ 1729.567186]  ____fput+0x1a/0x20
[ 1729.567701]  task_work_run+0x8e/0xf0
[ 1729.568315]  do_exit+0x616/0x1310
[ 1729.568895]  ? write_comp_data+0x2f/0x90
[ 1729.569575]  do_group_exit+0x7e/0x130
[ 1729.570224]  get_signal+0x249/0x13c0
[ 1729.570871]  ? get_signal+0x5/0x13c0
[ 1729.571559]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1729.572387]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1729.573216]  exit_to_user_mode_prepare+0x154/0x240
[ 1729.573964]  syscall_exit_to_user_mode+0x2b/0x60
[ 1729.574692]  do_syscall_64+0x46/0x80
[ 1729.575271]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1729.576019] RIP: 0033:0x7fac0740459d
[ 1729.576573] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1729.577499] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1729.578646] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1729.579667] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1729.580674] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1729.581682] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1729.582705] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1729.583979] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1729.584093] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1729.584928] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1729.586129] caller is debug_smp_processor_id+0x1c/0x20
[ 1729.587517] Call Trace:
[ 1729.587528]  dump_stack_lvl+0xa4/0xd3
[ 1729.589096]  dump_stack+0x15/0x17
[ 1729.589546]  check_preemption_disabled+0x167/0x180
[ 1729.590199]  ? try_to_del_timer_sync+0x33/0x90
[ 1729.590791]  ? calc_wheel_index+0x2d0/0x2d0
[ 1729.591358]  debug_smp_processor_id+0x1c/0x20
[ 1729.591939]  perf_ftrace_function_call+0x7c/0x360
[ 1729.592565]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1729.593186]  ? del_timer_sync+0xd3/0x130
[ 1729.593712]  ? perf_ftrace_function_call+0x4c/0x360
[ 1729.594376]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1729.595008]  ? register_lock_class+0x42/0x440
[ 1729.595595]  ? del_timer_sync+0x40/0x130
[ 1729.596127]  ? 0xffffffffa0098099
[ 1729.596569]  ? 0xffffffffa0098099
[ 1729.596999]  0xffffffffa0098099
[ 1729.597407]  ? 0xffffffffa0098099
[ 1729.597827]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1729.598431]  ? del_timer_sync+0xa5/0x130
[ 1729.598933]  ? lock_timer_base+0x5/0x100
[ 1729.599434]  lock_timer_base+0x5/0x100
[ 1729.599909]  try_to_del_timer_sync+0x33/0x90
[ 1729.600446]  ? lock_timer_base+0x5/0x100
[ 1729.600940]  ? try_to_del_timer_sync+0x33/0x90
[ 1729.601497]  ? try_to_del_timer_sync+0x5/0x90
[ 1729.602053]  del_timer_sync+0xd3/0x130
[ 1729.602540]  schedule_timeout+0x34e/0x610
[ 1729.603057]  ? del_timer_sync+0x130/0x130
[ 1729.603572]  ? i915_init_ggtt+0x40/0x6b0
[ 1729.604080]  rcu_gp_fqs_loop+0x2a0/0x410
[ 1729.604586]  ? rcu_gp_init+0x730/0x730
[ 1729.605060]  rcu_gp_kthread+0xdd/0x170
[ 1729.605543]  kthread+0x1e7/0x230
[ 1729.605961]  ? set_kthread_struct+0x80/0x80
[ 1729.606498]  ret_from_fork+0x1f/0x30
[ 1729.606991] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1729.607032] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1729.608060] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1729.609020] caller is debug_smp_processor_id+0x1c/0x20
[ 1729.610597] Call Trace:
[ 1729.610633]  dump_stack_lvl+0xa4/0xd3
[ 1729.612182]  dump_stack+0x15/0x17
[ 1729.612709]  check_preemption_disabled+0x167/0x180
[ 1729.613492]  debug_smp_processor_id+0x1c/0x20
[ 1729.614166]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1729.615029]  perf_trace_buf_alloc+0x3d/0x100
[ 1729.615688]  ? __text_poke+0xea/0x4e0
[ 1729.616252]  ? __pmd_alloc+0x420/0x420
[ 1729.616851]  perf_ftrace_function_call+0x209/0x360
[ 1729.617787]  ? 0xffffffffa0098099
[ 1729.618389]  ? xhci_hub_control+0x38f0/0x38f0
[ 1729.619080]  0xffffffffa0098099
[ 1729.619602]  ? 0xffffffffa0098099
[ 1729.620265]  ? __get_locked_pte+0x5/0x290
[ 1729.620934]  __get_locked_pte+0x5/0x290
[ 1729.621531]  __text_poke+0xea/0x4e0
[ 1729.622088]  ? __get_locked_pte+0x5/0x290
[ 1729.622696]  ? __text_poke+0xea/0x4e0
[ 1729.623269]  ? xhci_hub_control+0x38f0/0x38f0
[ 1729.623958]  ? lock_is_held_type+0xe2/0x140
[ 1729.624614]  ? xhci_hub_control+0x38f0/0x38f0
[ 1729.625324]  text_poke+0x2b/0x60
[ 1729.625873]  text_poke_bp_batch+0x93/0x2c0
[ 1729.626556]  ? dbc_read_complete+0xb0/0xb0
[ 1729.627235]  text_poke_queue+0xa7/0xc0
[ 1729.627870]  ftrace_replace_code+0xfd/0x170
[ 1729.628571]  ftrace_modify_all_code+0x1b1/0x270
[ 1729.629306]  arch_ftrace_update_code+0x9/0x10
[ 1729.629973]  ftrace_run_update_code+0x30/0xa0
[ 1729.630666]  ftrace_shutdown+0x2b8/0x4a0
[ 1729.631340]  unregister_ftrace_function+0x25/0x50
[ 1729.632064]  perf_ftrace_event_register+0x89/0xf0
[ 1729.632779]  ? perf_tp_event_init+0xa0/0xa0
[ 1729.633420]  perf_trace_destroy+0x37/0x60
[ 1729.634056]  tp_perf_event_destroy+0x15/0x20
[ 1729.634724]  _free_event+0xfc/0x7d0
[ 1729.635328]  put_event+0x37/0x50
[ 1729.635866]  perf_event_release_kernel+0x2f4/0x370
[ 1729.636656]  ? perf_event_release_kernel+0x370/0x370
[ 1729.637426]  perf_release+0x19/0x20
[ 1729.637987]  __fput+0x12d/0x460
[ 1729.638595]  ____fput+0x1a/0x20
[ 1729.639112]  task_work_run+0x8e/0xf0
[ 1729.639730]  do_exit+0x616/0x1310
[ 1729.640315]  ? write_comp_data+0x2f/0x90
[ 1729.640999]  do_group_exit+0x7e/0x130
[ 1729.641630]  get_signal+0x249/0x13c0
[ 1729.642238]  ? get_signal+0x5/0x13c0
[ 1729.642898]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1729.643731]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1729.644554]  exit_to_user_mode_prepare+0x154/0x240
[ 1729.645302]  syscall_exit_to_user_mode+0x2b/0x60
[ 1729.646017]  do_syscall_64+0x46/0x80
[ 1729.646594]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1729.647344] RIP: 0033:0x7fac0740459d
[ 1729.647900] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1729.648832] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1729.649926] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1729.650939] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1729.651950] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1729.652969] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1729.654001] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1729.655252] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1729.655362] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1729.656198] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1729.657196] caller is debug_smp_processor_id+0x1c/0x20
[ 1729.658617] Call Trace:
[ 1729.658626]  dump_stack_lvl+0xa4/0xd3
[ 1729.658650]  dump_stack+0x15/0x17
[ 1729.658666]  check_preemption_disabled+0x167/0x180
[ 1729.658685]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1729.658700]  ? prepare_to_swait_exclusive+0x90/0x90
[ 1729.658722]  debug_smp_processor_id+0x1c/0x20
[ 1729.662967]  perf_ftrace_function_call+0x7c/0x360
[ 1729.663599]  ? trace_hardirqs_on+0x3f/0x170
[ 1729.664161]  ? preempt_count_sub+0x5/0xa0
[ 1729.664701]  ? preempt_count_sub+0x5/0xa0
[ 1729.665235]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1729.665892]  ? write_comp_data+0x2f/0x90
[ 1729.666422]  0xffffffffa0098099
[ 1729.666824]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1729.667425]  ? del_timer_sync+0xde/0x130
[ 1729.667928]  ? prepare_to_swait_event+0x5/0xf0
[ 1729.668485]  ? i915_init_ggtt+0x40/0x6b0
[ 1729.668986]  prepare_to_swait_event+0x5/0xf0
[ 1729.669525]  rcu_gp_fqs_loop+0x2b4/0x410
[ 1729.670020]  ? prepare_to_swait_event+0x5/0xf0
[ 1729.670588]  ? rcu_gp_fqs_loop+0x2b4/0x410
[ 1729.671123]  ? rcu_gp_init+0x730/0x730
[ 1729.671600]  rcu_gp_kthread+0xdd/0x170
[ 1729.672083]  kthread+0x1e7/0x230
[ 1729.672502]  ? set_kthread_struct+0x80/0x80
[ 1729.673037]  ret_from_fork+0x1f/0x30
[ 1729.673526] CPU: 0 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1729.673558] BUG: using smp_processor_id() in preemptible [00000000] code: rcu_preempt/14
[ 1729.674518] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1729.674535] Call Trace:
[ 1729.675497] caller is debug_smp_processor_id+0x1c/0x20
[ 1729.676951]  dump_stack_lvl+0xa4/0xd3
[ 1729.678439]  dump_stack+0x15/0x17
[ 1729.678907]  check_preemption_disabled+0x167/0x180
[ 1729.679587]  debug_smp_processor_id+0x1c/0x20
[ 1729.680186]  perf_trace_buf_alloc+0x98/0x100
[ 1729.680775]  ? __text_poke+0xea/0x4e0
[ 1729.681280]  ? __pmd_alloc+0x420/0x420
[ 1729.681808]  perf_ftrace_function_call+0x209/0x360
[ 1729.682568]  ? 0xffffffffa0098099
[ 1729.683068]  ? xhci_hub_control+0x38f0/0x38f0
[ 1729.683676]  0xffffffffa0098099
[ 1729.684134]  ? 0xffffffffa0098099
[ 1729.684665]  ? __get_locked_pte+0x5/0x290
[ 1729.685239]  __get_locked_pte+0x5/0x290
[ 1729.685772]  __text_poke+0xea/0x4e0
[ 1729.686269]  ? __get_locked_pte+0x5/0x290
[ 1729.686817]  ? __text_poke+0xea/0x4e0
[ 1729.687327]  ? xhci_hub_control+0x38f0/0x38f0
[ 1729.687935]  ? lock_is_held_type+0xe2/0x140
[ 1729.688516]  ? xhci_hub_control+0x38f0/0x38f0
[ 1729.689134]  text_poke+0x2b/0x60
[ 1729.689607]  text_poke_bp_batch+0x93/0x2c0
[ 1729.690202]  ? dbc_read_complete+0xb0/0xb0
[ 1729.690790]  text_poke_queue+0xa7/0xc0
[ 1729.691350]  ftrace_replace_code+0xfd/0x170
[ 1729.691953]  ftrace_modify_all_code+0x1b1/0x270
[ 1729.692593]  arch_ftrace_update_code+0x9/0x10
[ 1729.693191]  ftrace_run_update_code+0x30/0xa0
[ 1729.693799]  ftrace_shutdown+0x2b8/0x4a0
[ 1729.694377]  unregister_ftrace_function+0x25/0x50
[ 1729.695023]  perf_ftrace_event_register+0x89/0xf0
[ 1729.695673]  ? perf_tp_event_init+0xa0/0xa0
[ 1729.696252]  perf_trace_destroy+0x37/0x60
[ 1729.696813]  tp_perf_event_destroy+0x15/0x20
[ 1729.697407]  _free_event+0xfc/0x7d0
[ 1729.697924]  put_event+0x37/0x50
[ 1729.698403]  perf_event_release_kernel+0x2f4/0x370
[ 1729.699088]  ? perf_event_release_kernel+0x370/0x370
[ 1729.699772]  perf_release+0x19/0x20
[ 1729.700266]  __fput+0x12d/0x460
[ 1729.700761]  ____fput+0x1a/0x20
[ 1729.701213]  task_work_run+0x8e/0xf0
[ 1729.701740]  do_exit+0x616/0x1310
[ 1729.702247]  ? write_comp_data+0x2f/0x90
[ 1729.702828]  do_group_exit+0x7e/0x130
[ 1729.703367]  get_signal+0x249/0x13c0
[ 1729.703889]  ? get_signal+0x5/0x13c0
[ 1729.704456]  arch_do_signal_or_restart+0xb7/0x7e0
[ 1729.705155]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1729.705859]  exit_to_user_mode_prepare+0x154/0x240
[ 1729.706529]  syscall_exit_to_user_mode+0x2b/0x60
[ 1729.707166]  do_syscall_64+0x46/0x80
[ 1729.707672]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1729.708353] RIP: 0033:0x7fac0740459d
[ 1729.708849] Code: Unable to access opcode bytes at RIP 0x7fac07404573.
[ 1729.709698] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1729.710733] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1729.711674] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1729.712601] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1729.713527] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1729.714457] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1729.715492] CPU: 1 PID: 14 Comm: rcu_preempt Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1729.716442] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1729.717808] Call Trace:
[ 1729.718128]  dump_stack_lvl+0xa4/0xd3
[ 1729.718603]  dump_stack+0x15/0x17
[ 1729.719027]  check_preemption_disabled+0x167/0x180
[ 1729.719628]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1729.720143]  ? rcu_pm_notify+0x40/0x40
[ 1729.720621]  debug_smp_processor_id+0x1c/0x20
[ 1729.721177]  perf_ftrace_function_call+0x7c/0x360
[ 1729.721769]  ? prepare_to_swait_event+0xbb/0xf0
[ 1729.722344]  ? 0xffffffffa0098099
[ 1729.722769]  ? 0xffffffffa0098099
[ 1729.723193]  ? 0xffffffffa0098099
[ 1729.723626]  ? 0xffffffffa0098099
[ 1729.724058]  0xffffffffa0098099
[ 1729.724461]  ? trace_hardirqs_on+0x3f/0x170
[ 1729.724993]  ? preempt_count_sub+0x5/0xa0
[ 1729.725509]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1729.726056]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1729.726679]  rcu_gp_fqs_check_wake+0x5/0x50
[ 1729.727205]  rcu_gp_fqs_loop+0x2bd/0x410
[ 1729.727701]  ? rcu_gp_fqs_check_wake+0x5/0x50
[ 1729.728246]  ? rcu_gp_fqs_loop+0x2bd/0x410
[ 1729.728773]  ? rcu_gp_init+0x730/0x730
[ 1729.729249]  rcu_gp_kthread+0xdd/0x170
[ 1729.729731]  kthread+0x1e7/0x230
[ 1729.730152]  ? set_kthread_struct+0x80/0x80
[ 1729.730685]  ret_from_fork+0x1f/0x30
[ 1734.413980] check_preemption_disabled: 1649837 callbacks suppressed
[ 1734.413994] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1734.413997] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[ 1734.414727] caller is debug_smp_processor_id+0x1c/0x20
[ 1734.415594] caller is debug_smp_processor_id+0x1c/0x20
[ 1734.416480] CPU: 1 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1734.418419] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1734.419650] Call Trace:
[ 1734.419939]  dump_stack_lvl+0xa4/0xd3
[ 1734.420368]  dump_stack+0x15/0x17
[ 1734.420750]  check_preemption_disabled+0x167/0x180
[ 1734.421296]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1734.421840]  ? cea_set_pte+0x140/0x140
[ 1734.422313]  debug_smp_processor_id+0x1c/0x20
[ 1734.422856]  perf_ftrace_function_call+0x7c/0x360
[ 1734.423440]  ? ftrace_verify_code+0x2c/0x70
[ 1734.423961]  ? copy_to_user_nofault+0x150/0x150
[ 1734.424524]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1734.425107]  ? ftrace_verify_code+0x2c/0x70
[ 1734.425628]  ? perf_ftrace_function_call+0x4c/0x360
[ 1734.426246]  ? write_comp_data+0x2f/0x90
[ 1734.426741]  ? optimize_nops.isra.10+0x1e0/0x1e0
[ 1734.427325]  ? snapshot_ioctl+0x760/0x760
[ 1734.427849]  ? ftrace_get_addr_curr+0x103/0x280
[ 1734.428414]  ? snapshot_ioctl+0x760/0x760
[ 1734.428916]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1734.429573]  ? ftrace_get_addr_curr+0x103/0x280
[ 1734.430140]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1734.430796]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1734.431389]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1734.432040]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1734.432644]  ? ftrace_verify_code+0x2c/0x70
[ 1734.433169]  ? ftrace_replace_code+0x69/0x170
[ 1734.433719]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1734.434310]  ? arch_ftrace_update_code+0x9/0x10
[ 1734.434871]  ? ftrace_run_update_code+0x30/0xa0
[ 1734.435437]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1734.435957]  ? unregister_ftrace_function+0x25/0x50
[ 1734.436561]  ? perf_ftrace_event_register+0x89/0xf0
[ 1734.437163]  ? perf_tp_event_init+0xa0/0xa0
[ 1734.437684]  ? perf_trace_destroy+0x37/0x60
[ 1734.438221]  ? tp_perf_event_destroy+0x15/0x20
[ 1734.438776]  ? _free_event+0xfc/0x7d0
[ 1734.439244]  ? put_event+0x37/0x50
[ 1734.439678]  ? perf_event_release_kernel+0x2f4/0x370
[ 1734.440298]  ? perf_event_release_kernel+0x370/0x370
[ 1734.440914]  ? perf_release+0x19/0x20
[ 1734.441377]  ? __fput+0x12d/0x460
[ 1734.441815]  ? ____fput+0x1a/0x20
[ 1734.442246]  ? task_work_run+0x8e/0xf0
[ 1734.442725]  ? do_exit+0x616/0x1310
[ 1734.443176]  ? write_comp_data+0x2f/0x90
[ 1734.443679]  ? do_group_exit+0x7e/0x130
[ 1734.444168]  ? get_signal+0x249/0x13c0
[ 1734.444646]  ? get_signal+0x5/0x13c0
[ 1734.445110]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1734.445731]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1734.446347]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1734.446963]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1734.447558]  ? do_syscall_64+0x46/0x80
[ 1734.448030]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1734.448708] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1734.448738] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1734.449677] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1734.450634] caller is debug_smp_processor_id+0x1c/0x20
[ 1734.451980] Call Trace:
[ 1734.452908]  dump_stack_lvl+0xa4/0xd3
[ 1734.453384]  dump_stack+0x15/0x17
[ 1734.453811]  check_preemption_disabled+0x167/0x180
[ 1734.454422]  ? ext4_mark_iloc_dirty+0x89c/0x1490
[ 1734.455003]  ? __ext4_journal_get_create_access+0x180/0x180
[ 1734.455703]  debug_smp_processor_id+0x1c/0x20
[ 1734.456253]  perf_ftrace_function_call+0x7c/0x360
[ 1734.456858]  ? ext4_mark_iloc_dirty+0x83b/0x1490
[ 1734.457506]  ? __ext4_handle_dirty_metadata+0x5/0x300
[ 1734.458143]  ? write_comp_data+0x2f/0x90
[ 1734.458644]  ? __ext4_handle_dirty_metadata+0x5/0x300
[ 1734.459276]  ? ext4_mark_iloc_dirty+0x89c/0x1490
[ 1734.459857]  ? __ext4_handle_dirty_metadata+0x5/0x300
[ 1734.460488]  ? ext4_mark_iloc_dirty+0x89c/0x1490
[ 1734.461073]  ? __ext4_mark_inode_dirty+0xdd/0x460
[ 1734.461689]  ? __ext4_mark_inode_dirty+0xf6/0x460
[ 1734.462306]  ? ext4_truncate+0x6c2/0x940
[ 1734.462816]  ? ext4_ext_truncate+0x46/0x150
[ 1734.463363]  ? ext4_truncate+0x6db/0x940
[ 1734.463861]  ? write_comp_data+0x2f/0x90
[ 1734.464371]  ? ext4_evict_inode+0x512/0xfb0
[ 1734.464910]  ? ext4_da_write_begin+0x560/0x560
[ 1734.465476]  ? evict+0x102/0x210
[ 1734.465899]  ? iput+0x2e0/0x4f0
[ 1734.466326]  ? dentry_unlink_inode+0x125/0x1b0
[ 1734.466893]  ? __dentry_kill+0x179/0x280
[ 1734.467397]  ? dput.part.36+0x3a/0x870
[ 1734.467878]  ? dput.part.36+0x51e/0x870
[ 1734.468383]  ? dput+0x1a/0x20
[ 1734.468770]  ? do_renameat2+0x601/0x8e0
[ 1734.469317]  ? __x64_sys_rename+0x49/0x50
[ 1734.469832]  ? do_syscall_64+0x37/0x80
[ 1734.470322]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1734.471012] CPU: 1 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1734.471043] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[ 1734.471921] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1734.472912] caller is debug_smp_processor_id+0x1c/0x20
[ 1734.474263] Call Trace:
[ 1734.474272]  dump_stack_lvl+0xa4/0xd3
[ 1734.474293]  dump_stack+0x15/0x17
[ 1734.476056]  check_preemption_disabled+0x167/0x180
[ 1734.476648]  ? ftrace_verify_code+0x2c/0x70
[ 1734.477167]  ? copy_to_user_nofault+0x150/0x150
[ 1734.477732]  debug_smp_processor_id+0x1c/0x20
[ 1734.478282]  perf_ftrace_function_call+0x7c/0x360
[ 1734.478875]  ? write_comp_data+0x2f/0x90
[ 1734.479368]  ? optimize_nops.isra.10+0x1e0/0x1e0
[ 1734.479953]  ? snapshot_ioctl+0x760/0x760
[ 1734.480474]  ? ftrace_get_addr_curr+0x103/0x280
[ 1734.481036]  ? snapshot_ioctl+0x760/0x760
[ 1734.481535]  ? snapshot_ioctl+0x760/0x760
[ 1734.482048]  ? ftrace_get_addr_curr+0x103/0x280
[ 1734.482613]  ? snapshot_compat_ioctl+0xa0/0xa0
[ 1734.483165]  ? copy_from_kernel_nofault+0x5/0x220
[ 1734.483754]  ? copy_from_kernel_nofault+0x5/0x220
[ 1734.484335]  ? ftrace_verify_code+0x2c/0x70
[ 1734.484855]  ? copy_from_kernel_nofault+0x5/0x220
[ 1734.485435]  ? ftrace_verify_code+0x2c/0x70
[ 1734.485960]  ? ftrace_replace_code+0x69/0x170
[ 1734.486516]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1734.487101]  ? arch_ftrace_update_code+0x9/0x10
[ 1734.487661]  ? ftrace_run_update_code+0x30/0xa0
[ 1734.488230]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1734.488749]  ? unregister_ftrace_function+0x25/0x50
[ 1734.489351]  ? perf_ftrace_event_register+0x89/0xf0
[ 1734.489953]  ? perf_tp_event_init+0xa0/0xa0
[ 1734.490483]  ? perf_trace_destroy+0x37/0x60
[ 1734.491008]  ? tp_perf_event_destroy+0x15/0x20
[ 1734.491567]  ? _free_event+0xfc/0x7d0
[ 1734.492035]  ? put_event+0x37/0x50
[ 1734.492468]  ? perf_event_release_kernel+0x2f4/0x370
[ 1734.493088]  ? perf_event_release_kernel+0x370/0x370
[ 1734.493702]  ? perf_release+0x19/0x20
[ 1734.494193]  ? __fput+0x12d/0x460
[ 1734.494630]  ? ____fput+0x1a/0x20
[ 1734.495053]  ? task_work_run+0x8e/0xf0
[ 1734.495530]  ? do_exit+0x616/0x1310
[ 1734.495978]  ? write_comp_data+0x2f/0x90
[ 1734.496479]  ? do_group_exit+0x7e/0x130
[ 1734.496967]  ? get_signal+0x249/0x13c0
[ 1734.497443]  ? get_signal+0x5/0x13c0
[ 1734.497905]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1734.498538]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1734.499145]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1734.499761]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1734.500355]  ? do_syscall_64+0x46/0x80
[ 1734.500826]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1734.501501] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1734.501525] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1734.502472] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1734.502483] Call Trace:
[ 1734.502490]  dump_stack_lvl+0xa4/0xd3
[ 1734.503415] caller is debug_smp_processor_id+0x1c/0x20
[ 1734.504778]  dump_stack+0x15/0x17
[ 1734.506556]  check_preemption_disabled+0x167/0x180
[ 1734.507157]  ? __ext4_handle_dirty_metadata+0x3e/0x300
[ 1734.507797]  ? ___might_sleep+0x170/0x170
[ 1734.508308]  debug_smp_processor_id+0x1c/0x20
[ 1734.508854]  perf_ftrace_function_call+0x7c/0x360
[ 1734.509444]  ? ext4_mark_iloc_dirty+0x89c/0x1490
[ 1734.510022]  ? __ext4_journal_get_create_access+0x180/0x180
[ 1734.510725]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1734.511313]  ? ext4_mark_iloc_dirty+0x89c/0x1490
[ 1734.511893]  ? perf_ftrace_function_call+0x4c/0x360
[ 1734.512515]  ? ext4_mark_iloc_dirty+0x83b/0x1490
[ 1734.513145]  ? __might_sleep+0x5/0x70
[ 1734.513619]  ? __might_sleep+0x5/0x70
[ 1734.514092]  ? __ext4_handle_dirty_metadata+0x3e/0x300
[ 1734.514734]  ? __might_sleep+0x5/0x70
[ 1734.515199]  ? __ext4_handle_dirty_metadata+0x3e/0x300
[ 1734.515853]  ? ext4_mark_iloc_dirty+0x89c/0x1490
[ 1734.516436]  ? __ext4_mark_inode_dirty+0xdd/0x460
[ 1734.517050]  ? __ext4_mark_inode_dirty+0xf6/0x460
[ 1734.517654]  ? ext4_truncate+0x6c2/0x940
[ 1734.518175]  ? ext4_ext_truncate+0x46/0x150
[ 1734.518714]  ? ext4_truncate+0x6db/0x940
[ 1734.519213]  ? write_comp_data+0x2f/0x90
[ 1734.519722]  ? ext4_evict_inode+0x512/0xfb0
[ 1734.520270]  ? ext4_da_write_begin+0x560/0x560
[ 1734.520835]  ? evict+0x102/0x210
[ 1734.521259]  ? iput+0x2e0/0x4f0
[ 1734.521679]  ? dentry_unlink_inode+0x125/0x1b0
[ 1734.522256]  ? __dentry_kill+0x179/0x280
[ 1734.522759]  ? dput.part.36+0x3a/0x870
[ 1734.523238]  ? dput.part.36+0x51e/0x870
[ 1734.523739]  ? dput+0x1a/0x20
[ 1734.524125]  ? do_renameat2+0x601/0x8e0
[ 1734.524695]  ? __x64_sys_rename+0x49/0x50
[ 1734.525219]  ? do_syscall_64+0x37/0x80
[ 1734.525698]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1734.526396] CPU: 1 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1734.526433] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[ 1734.527302] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1734.528289] caller is debug_smp_processor_id+0x1c/0x20
[ 1734.529627] Call Trace:
[ 1734.530575]  dump_stack_lvl+0xa4/0xd3
[ 1734.531047]  dump_stack+0x15/0x17
[ 1734.531467]  check_preemption_disabled+0x167/0x180
[ 1734.532061]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1734.532652]  ? cea_set_pte+0x140/0x140
[ 1734.533127]  debug_smp_processor_id+0x1c/0x20
[ 1734.533669]  perf_ftrace_function_call+0x7c/0x360
[ 1734.534263]  ? ftrace_verify_code+0x2c/0x70
[ 1734.534783]  ? copy_to_user_nofault+0x150/0x150
[ 1734.535345]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1734.535928]  ? ftrace_verify_code+0x2c/0x70
[ 1734.536448]  ? perf_ftrace_function_call+0x4c/0x360
[ 1734.537063]  ? write_comp_data+0x2f/0x90
[ 1734.537557]  ? optimize_nops.isra.10+0x1e0/0x1e0
[ 1734.538147]  ? snapshot_compat_ioctl+0xa0/0xa0
[ 1734.538721]  ? ftrace_get_addr_curr+0x103/0x280
[ 1734.539284]  ? snapshot_compat_ioctl+0xa0/0xa0
[ 1734.539838]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1734.540493]  ? ftrace_get_addr_curr+0x103/0x280
[ 1734.541060]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1734.541728]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1734.542366]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1734.543021]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1734.543627]  ? ftrace_verify_code+0x2c/0x70
[ 1734.544153]  ? ftrace_replace_code+0x69/0x170
[ 1734.544702]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1734.545291]  ? arch_ftrace_update_code+0x9/0x10
[ 1734.545860]  ? ftrace_run_update_code+0x30/0xa0
[ 1734.546437]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1734.546957]  ? unregister_ftrace_function+0x25/0x50
[ 1734.547559]  ? perf_ftrace_event_register+0x89/0xf0
[ 1734.548161]  ? perf_tp_event_init+0xa0/0xa0
[ 1734.548683]  ? perf_trace_destroy+0x37/0x60
[ 1734.549207]  ? tp_perf_event_destroy+0x15/0x20
[ 1734.549759]  ? _free_event+0xfc/0x7d0
[ 1734.550236]  ? put_event+0x37/0x50
[ 1734.550670]  ? perf_event_release_kernel+0x2f4/0x370
[ 1734.551291]  ? perf_event_release_kernel+0x370/0x370
[ 1734.551906]  ? perf_release+0x19/0x20
[ 1734.552369]  ? __fput+0x12d/0x460
[ 1734.552805]  ? ____fput+0x1a/0x20
[ 1734.553228]  ? task_work_run+0x8e/0xf0
[ 1734.553708]  ? do_exit+0x616/0x1310
[ 1734.554167]  ? write_comp_data+0x2f/0x90
[ 1734.554670]  ? do_group_exit+0x7e/0x130
[ 1734.555161]  ? get_signal+0x249/0x13c0
[ 1734.555639]  ? get_signal+0x5/0x13c0
[ 1734.556103]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1734.556723]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1734.557330]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1734.557945]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1734.558549]  ? do_syscall_64+0x46/0x80
[ 1734.559022]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1734.559699] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1734.559725] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1734.560665] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1734.561592] caller is debug_smp_processor_id+0x1c/0x20
[ 1734.562972] Call Trace:
[ 1734.562980]  dump_stack_lvl+0xa4/0xd3
[ 1734.563003]  dump_stack+0x15/0x17
[ 1734.564810]  check_preemption_disabled+0x167/0x180
[ 1734.565414]  ? __might_sleep+0x48/0x70
[ 1734.565890]  ? sched_show_task+0x70/0x70
[ 1734.566407]  debug_smp_processor_id+0x1c/0x20
[ 1734.566959]  perf_ftrace_function_call+0x7c/0x360
[ 1734.567558]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1734.568152]  ? __ext4_handle_dirty_metadata+0x3e/0x300
[ 1734.568796]  ? perf_ftrace_function_call+0x4c/0x360
[ 1734.569410]  ? ext4_mark_iloc_dirty+0x89c/0x1490
[ 1734.569989]  ? __ext4_journal_get_create_access+0x180/0x180
[ 1734.570689]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1734.571281]  ? ext4_mark_iloc_dirty+0x89c/0x1490
[ 1734.571864]  ? perf_ftrace_function_call+0x4c/0x360
[ 1734.572488]  ? ext4_mark_iloc_dirty+0x83b/0x1490
[ 1734.573111]  ? ___might_sleep+0x5/0x170
[ 1734.573606]  ? ___might_sleep+0x5/0x170
[ 1734.574097]  ? __might_sleep+0x48/0x70
[ 1734.574576]  ? ___might_sleep+0x5/0x170
[ 1734.575063]  ? __might_sleep+0x48/0x70
[ 1734.575547]  ? __ext4_handle_dirty_metadata+0x3e/0x300
[ 1734.576203]  ? ext4_mark_iloc_dirty+0x89c/0x1490
[ 1734.576788]  ? __ext4_mark_inode_dirty+0xdd/0x460
[ 1734.577404]  ? __ext4_mark_inode_dirty+0xf6/0x460
[ 1734.578010]  ? ext4_truncate+0x6c2/0x940
[ 1734.578523]  ? ext4_ext_truncate+0x46/0x150
[ 1734.579063]  ? ext4_truncate+0x6db/0x940
[ 1734.579563]  ? write_comp_data+0x2f/0x90
[ 1734.580074]  ? ext4_evict_inode+0x512/0xfb0
[ 1734.580615]  ? ext4_da_write_begin+0x560/0x560
[ 1734.581181]  ? evict+0x102/0x210
[ 1734.581602]  ? iput+0x2e0/0x4f0
[ 1734.582019]  ? dentry_unlink_inode+0x125/0x1b0
[ 1734.582590]  ? __dentry_kill+0x179/0x280
[ 1734.583094]  ? dput.part.36+0x3a/0x870
[ 1734.583575]  ? dput.part.36+0x51e/0x870
[ 1734.584077]  ? dput+0x1a/0x20
[ 1734.584465]  ? do_renameat2+0x601/0x8e0
[ 1734.585005]  ? __x64_sys_rename+0x49/0x50
[ 1734.585519]  ? do_syscall_64+0x37/0x80
[ 1734.585999]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1734.586691] CPU: 1 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1734.586721] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[ 1734.587595] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1734.588585] caller is debug_smp_processor_id+0x1c/0x20
[ 1734.589935] Call Trace:
[ 1734.590875]  dump_stack_lvl+0xa4/0xd3
[ 1734.591343]  dump_stack+0x15/0x17
[ 1734.591766]  check_preemption_disabled+0x167/0x180
[ 1734.592360]  ? ftrace_verify_code+0x2c/0x70
[ 1734.592878]  ? copy_to_user_nofault+0x150/0x150
[ 1734.593445]  debug_smp_processor_id+0x1c/0x20
[ 1734.593988]  perf_ftrace_function_call+0x7c/0x360
[ 1734.594584]  ? write_comp_data+0x2f/0x90
[ 1734.595079]  ? optimize_nops.isra.10+0x1e0/0x1e0
[ 1734.595661]  ? snapshot_compat_ioctl+0xa0/0xa0
[ 1734.596232]  ? ftrace_get_addr_curr+0x103/0x280
[ 1734.596795]  ? snapshot_compat_ioctl+0xa0/0xa0
[ 1734.597344]  ? snapshot_compat_ioctl+0xa0/0xa0
[ 1734.597901]  ? ftrace_get_addr_curr+0x103/0x280
[ 1734.598465]  ? is_hibernate_resume_dev+0x70/0x70
[ 1734.599039]  ? copy_from_kernel_nofault+0x5/0x220
[ 1734.599627]  ? copy_from_kernel_nofault+0x5/0x220
[ 1734.600210]  ? ftrace_verify_code+0x2c/0x70
[ 1734.600731]  ? copy_from_kernel_nofault+0x5/0x220
[ 1734.601312]  ? ftrace_verify_code+0x2c/0x70
[ 1734.601837]  ? ftrace_replace_code+0x69/0x170
[ 1734.602389]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1734.602977]  ? arch_ftrace_update_code+0x9/0x10
[ 1734.603538]  ? ftrace_run_update_code+0x30/0xa0
[ 1734.604102]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1734.604622]  ? unregister_ftrace_function+0x25/0x50
[ 1734.605224]  ? perf_ftrace_event_register+0x89/0xf0
[ 1734.605827]  ? perf_tp_event_init+0xa0/0xa0
[ 1734.606354]  ? perf_trace_destroy+0x37/0x60
[ 1734.606877]  ? tp_perf_event_destroy+0x15/0x20
[ 1734.607430]  ? _free_event+0xfc/0x7d0
[ 1734.607898]  ? put_event+0x37/0x50
[ 1734.608332]  ? perf_event_release_kernel+0x2f4/0x370
[ 1734.608952]  ? perf_event_release_kernel+0x370/0x370
[ 1734.609566]  ? perf_release+0x19/0x20
[ 1734.610028]  ? __fput+0x12d/0x460
[ 1734.610467]  ? ____fput+0x1a/0x20
[ 1734.610889]  ? task_work_run+0x8e/0xf0
[ 1734.611368]  ? do_exit+0x616/0x1310
[ 1734.611817]  ? write_comp_data+0x2f/0x90
[ 1734.612318]  ? do_group_exit+0x7e/0x130
[ 1734.612807]  ? get_signal+0x249/0x13c0
[ 1734.613284]  ? get_signal+0x5/0x13c0
[ 1734.613746]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1734.614368]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1734.614974]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1734.615588]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1734.616182]  ? do_syscall_64+0x46/0x80
[ 1734.616654]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1734.617329] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1734.617353] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24322
[ 1734.618300] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1734.618310] Call Trace:
[ 1734.618318]  dump_stack_lvl+0xa4/0xd3
[ 1734.619243] caller is debug_smp_processor_id+0x1c/0x20
[ 1734.620616]  dump_stack+0x15/0x17
[ 1734.622405]  check_preemption_disabled+0x167/0x180
[ 1734.623009]  ? __ext4_handle_dirty_metadata+0xd2/0x300
[ 1734.623651]  ? jbd2_journal_get_create_access+0x220/0x220
[ 1734.624329]  debug_smp_processor_id+0x1c/0x20
[ 1734.624881]  perf_ftrace_function_call+0x7c/0x360
[ 1734.625474]  ? ext4_mark_iloc_dirty+0x89c/0x1490
[ 1734.626060]  ? __ext4_journal_get_create_access+0x180/0x180
[ 1734.626757]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1734.627350]  ? ext4_mark_iloc_dirty+0x89c/0x1490
[ 1734.627932]  ? perf_ftrace_function_call+0x4c/0x360
[ 1734.628556]  ? ext4_mark_iloc_dirty+0x83b/0x1490
[ 1734.629166]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1734.629760]  ? lock_is_held_type+0xe2/0x140
[ 1734.630299]  ? __ext4_handle_dirty_metadata+0xb5/0x300
[ 1734.630946]  ? jbd2_journal_dirty_metadata+0x5/0x430
[ 1734.631567]  ? write_comp_data+0x2f/0x90
[ 1734.632067]  ? jbd2_journal_dirty_metadata+0x5/0x430
[ 1734.632688]  ? __ext4_handle_dirty_metadata+0xd2/0x300
[ 1734.633329]  ? jbd2_journal_dirty_metadata+0x5/0x430
[ 1734.633947]  ? __ext4_handle_dirty_metadata+0xd2/0x300
[ 1734.634604]  ? ext4_mark_iloc_dirty+0x89c/0x1490
[ 1734.635189]  ? __ext4_mark_inode_dirty+0xdd/0x460
[ 1734.635804]  ? __ext4_mark_inode_dirty+0xf6/0x460
[ 1734.636407]  ? ext4_truncate+0x6c2/0x940
[ 1734.636918]  ? ext4_ext_truncate+0x46/0x150
[ 1734.637457]  ? ext4_truncate+0x6db/0x940
[ 1734.637955]  ? write_comp_data+0x2f/0x90
[ 1734.638467]  ? ext4_evict_inode+0x512/0xfb0
[ 1734.639006]  ? ext4_da_write_begin+0x560/0x560
[ 1734.639571]  ? evict+0x102/0x210
[ 1734.639992]  ? iput+0x2e0/0x4f0
[ 1734.640408]  ? dentry_unlink_inode+0x125/0x1b0
[ 1734.640975]  ? __dentry_kill+0x179/0x280
[ 1734.641478]  ? dput.part.36+0x3a/0x870
[ 1734.641958]  ? dput.part.36+0x51e/0x870
[ 1734.642462]  ? dput+0x1a/0x20
[ 1734.642850]  ? do_renameat2+0x601/0x8e0
[ 1734.643391]  ? __x64_sys_rename+0x49/0x50
[ 1734.643905]  ? do_syscall_64+0x37/0x80
[ 1734.644384]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1734.645080] CPU: 1 PID: 24322 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1734.645095] BUG: using smp_processor_id() in preemptible [00000000] code: in:imjournal/363
[ 1734.645987] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1734.645997] Call Trace:
[ 1734.646005]  dump_stack_lvl+0xa4/0xd3
[ 1734.646992] caller is debug_smp_processor_id+0x1c/0x20
[ 1734.648342]  dump_stack+0x15/0x17
[ 1734.650107]  check_preemption_disabled+0x167/0x180
[ 1734.650701]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1734.651292]  ? cea_set_pte+0x140/0x140
[ 1734.651765]  debug_smp_processor_id+0x1c/0x20
[ 1734.652306]  perf_ftrace_function_call+0x7c/0x360
[ 1734.652890]  ? ftrace_verify_code+0x2c/0x70
[ 1734.653409]  ? copy_to_user_nofault+0x150/0x150
[ 1734.653971]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1734.654562]  ? ftrace_verify_code+0x2c/0x70
[ 1734.655088]  ? perf_ftrace_function_call+0x4c/0x360
[ 1734.655704]  ? write_comp_data+0x2f/0x90
[ 1734.656197]  ? optimize_nops.isra.10+0x1e0/0x1e0
[ 1734.656778]  ? is_hibernate_resume_dev+0x70/0x70
[ 1734.657372]  ? ftrace_get_addr_curr+0x103/0x280
[ 1734.657935]  ? is_hibernate_resume_dev+0x70/0x70
[ 1734.658516]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1734.659172]  ? ftrace_get_addr_curr+0x103/0x280
[ 1734.659734]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1734.660386]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1734.660979]  ? copy_from_kernel_nofault_allowed+0x5/0x80
[ 1734.661630]  ? copy_from_kernel_nofault+0x2f/0x220
[ 1734.662240]  ? ftrace_verify_code+0x2c/0x70
[ 1734.662767]  ? ftrace_replace_code+0x69/0x170
[ 1734.663317]  ? ftrace_modify_all_code+0x1b1/0x270
[ 1734.663905]  ? arch_ftrace_update_code+0x9/0x10
[ 1734.664471]  ? ftrace_run_update_code+0x30/0xa0
[ 1734.665035]  ? ftrace_shutdown+0x2b8/0x4a0
[ 1734.665555]  ? unregister_ftrace_function+0x25/0x50
[ 1734.666169]  ? perf_ftrace_event_register+0x89/0xf0
[ 1734.666771]  ? perf_tp_event_init+0xa0/0xa0
[ 1734.667292]  ? perf_trace_destroy+0x37/0x60
[ 1734.667816]  ? tp_perf_event_destroy+0x15/0x20
[ 1734.668369]  ? _free_event+0xfc/0x7d0
[ 1734.668836]  ? put_event+0x37/0x50
[ 1734.669276]  ? perf_event_release_kernel+0x2f4/0x370
[ 1734.669898]  ? perf_event_release_kernel+0x370/0x370
[ 1734.670524]  ? perf_release+0x19/0x20
[ 1734.670986]  ? __fput+0x12d/0x460
[ 1734.671421]  ? ____fput+0x1a/0x20
[ 1734.671850]  ? task_work_run+0x8e/0xf0
[ 1734.672330]  ? do_exit+0x616/0x1310
[ 1734.672779]  ? write_comp_data+0x2f/0x90
[ 1734.673281]  ? do_group_exit+0x7e/0x130
[ 1734.673771]  ? get_signal+0x249/0x13c0
[ 1734.674256]  ? get_signal+0x5/0x13c0
[ 1734.674720]  ? arch_do_signal_or_restart+0xb7/0x7e0
[ 1734.675339]  ? arch_do_signal_or_restart+0x5/0x7e0
[ 1734.675945]  ? exit_to_user_mode_prepare+0x154/0x240
[ 1734.676558]  ? syscall_exit_to_user_mode+0x2b/0x60
[ 1734.677152]  ? do_syscall_64+0x46/0x80
[ 1734.677625]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1734.678303] CPU: 0 PID: 363 Comm: in:imjournal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1734.679303] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1734.680679] Call Trace:
[ 1734.680996]  dump_stack_lvl+0xa4/0xd3
[ 1734.681470]  dump_stack+0x15/0x17
[ 1734.681898]  check_preemption_disabled+0x167/0x180
[ 1734.682509]  ? ext4_mark_iloc_dirty+0x8ec/0x1490
[ 1734.683092]  ? block_commit_write+0x40/0x40
[ 1734.683626]  debug_smp_processor_id+0x1c/0x20
[ 1734.684177]  perf_ftrace_function_call+0x7c/0x360
[ 1734.684783]  ? ext4_mark_iloc_dirty+0x83b/0x1490
[ 1734.685411]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1734.686007]  ? jbd2_journal_dirty_metadata+0x123/0x430
[ 1734.686660]  ? ext4_mark_iloc_dirty+0xbd2/0x1490
[ 1734.687250]  ? __brelse+0x5/0x60
[ 1734.687666]  ? write_comp_data+0x2f/0x90
[ 1734.688171]  ? __brelse+0x5/0x60
[ 1734.688591]  ? ext4_mark_iloc_dirty+0x8ec/0x1490
[ 1734.689177]  ? __brelse+0x5/0x60
[ 1734.689593]  ? ext4_mark_iloc_dirty+0x8ec/0x1490
[ 1734.690185]  ? __ext4_mark_inode_dirty+0xdd/0x460
[ 1734.690804]  ? __ext4_mark_inode_dirty+0xf6/0x460
[ 1734.691411]  ? ext4_truncate+0x6c2/0x940
[ 1734.691930]  ? ext4_ext_truncate+0x46/0x150
[ 1734.692475]  ? ext4_truncate+0x6db/0x940
[ 1734.692979]  ? write_comp_data+0x2f/0x90
[ 1734.693493]  ? ext4_evict_inode+0x512/0xfb0
[ 1734.694042]  ? ext4_da_write_begin+0x560/0x560
[ 1734.694619]  ? evict+0x102/0x210
[ 1734.695046]  ? iput+0x2e0/0x4f0
[ 1734.695467]  ? dentry_unlink_inode+0x125/0x1b0
[ 1734.696041]  ? __dentry_kill+0x179/0x280
[ 1734.696545]  ? dput.part.36+0x3a/0x870
[ 1734.697026]  ? dput.part.36+0x51e/0x870
[ 1734.697529]  ? dput+0x1a/0x20
[ 1734.697918]  ? do_renameat2+0x601/0x8e0
[ 1734.698467]  ? __x64_sys_rename+0x49/0x50
[ 1734.698982]  ? do_syscall_64+0x37/0x80
[ 1734.699461]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1739.418057] check_preemption_disabled: 2814834 callbacks suppressed
[ 1739.418080] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24325
[ 1739.418484] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1739.418926] caller is debug_smp_processor_id+0x1c/0x20
[ 1739.420013] caller is debug_smp_processor_id+0x1c/0x20
[ 1739.420931] CPU: 1 PID: 24325 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1739.423192] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1739.424575] Call Trace:
[ 1739.424926]  dump_stack_lvl+0xa4/0xd3
[ 1739.425453]  dump_stack+0x15/0x17
[ 1739.425906]  check_preemption_disabled+0x167/0x180
[ 1739.426547]  ? __get_locked_pte+0x1a2/0x290
[ 1739.427099]  ? __lock_text_start+0x8/0x8
[ 1739.427643]  debug_smp_processor_id+0x1c/0x20
[ 1739.428218]  perf_ftrace_function_call+0x7c/0x360
[ 1739.428854]  ? ftrace_ops_test+0x71/0xc0
[ 1739.429394]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1739.430010]  ? text_poke+0x2b/0x60
[ 1739.430485]  ? perf_ftrace_function_call+0x4c/0x360
[ 1739.431129]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1739.431761]  ? ftrace_ops_test+0x71/0xc0
[ 1739.432285]  ? write_comp_data+0x2f/0x90
[ 1739.432817]  ? perf_trace_buf_update+0x70/0x70
[ 1739.433476]  0xffffffffa0098099
[ 1739.433937]  ? sis_old_set_dmamode+0x1/0x100
[ 1739.434548]  ? ftrace_call+0x5/0x44
[ 1739.435040]  ? pmd_page_vaddr+0x2b/0x70
[ 1739.435579]  ? _raw_spin_lock+0x5/0x50
[ 1739.436121]  _raw_spin_lock+0x5/0x50
[ 1739.436607]  __get_locked_pte+0x1a2/0x290
[ 1739.437143]  ? _raw_spin_lock+0x5/0x50
[ 1739.437640]  ? __get_locked_pte+0x1a2/0x290
[ 1739.438221]  ? sis_old_set_dmamode+0x1/0x100
[ 1739.438805]  __text_poke+0xea/0x4e0
[ 1739.439282]  ? sis_old_set_dmamode+0x1/0x100
[ 1739.439867]  ? lock_is_held_type+0xe2/0x140
[ 1739.440437]  ? sis_old_set_dmamode+0x1/0x100
[ 1739.441043]  text_poke+0x2b/0x60
[ 1739.441513]  text_poke_bp_batch+0xf5/0x2c0
[ 1739.442100]  ? spi_new_device+0x110/0x110
[ 1739.442673]  text_poke_queue+0xa7/0xc0
[ 1739.443228]  ftrace_replace_code+0xfd/0x170
[ 1739.443830]  ftrace_modify_all_code+0x1b1/0x270
[ 1739.444462]  arch_ftrace_update_code+0x9/0x10
[ 1739.445040]  ftrace_run_update_code+0x30/0xa0
[ 1739.445633]  ftrace_startup_enable+0x5e/0xa0
[ 1739.446225]  ftrace_startup+0x16d/0x240
[ 1739.446801]  register_ftrace_function+0x43/0x90
[ 1739.447415]  perf_ftrace_event_register+0xc1/0xf0
[ 1739.448049]  perf_trace_event_init+0xa0/0x4c0
[ 1739.448670]  perf_trace_init+0xda/0x160
[ 1739.449227]  perf_tp_event_init+0x57/0xa0
[ 1739.449780]  perf_try_init_event+0x83/0x270
[ 1739.450399]  perf_event_alloc+0xe3f/0x1c10
[ 1739.450935]  ? _raw_spin_unlock+0x2c/0x50
[ 1739.451482]  ? alloc_fd+0x20d/0x320
[ 1739.452095]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1739.452799]  ? write_comp_data+0x2f/0x90
[ 1739.453670]  __x64_sys_perf_event_open+0x26/0x30
[ 1739.454345]  do_syscall_64+0x37/0x80
[ 1739.454885]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1739.455598] RIP: 0033:0x7fac0740459d
[ 1739.456126] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1739.458582] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1739.459624] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1739.460588] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1739.461554] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1739.462522] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1739.463488] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1739.464654] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1739.464758] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24325
[ 1739.465782] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1739.466895] caller is debug_smp_processor_id+0x1c/0x20
[ 1739.468509] Call Trace:
[ 1739.469638]  dump_stack_lvl+0xa4/0xd3
[ 1739.470339]  dump_stack+0x15/0x17
[ 1739.470933]  check_preemption_disabled+0x167/0x180
[ 1739.471740]  ? add_wait_queue+0x1a/0x80
[ 1739.472393]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1739.473197]  debug_smp_processor_id+0x1c/0x20
[ 1739.473940]  perf_ftrace_function_call+0x7c/0x360
[ 1739.474949]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1739.475732]  ? write_comp_data+0x2f/0x90
[ 1739.476430]  ? perf_trace_buf_update+0x70/0x70
[ 1739.477185]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1739.478141]  0xffffffffa0098099
[ 1739.478756]  ? ftrace_call+0x5/0x44
[ 1739.479477]  ? do_wait+0x55e/0x5e0
[ 1739.480136]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1739.480928]  ? add_wait_queue+0x5/0x80
[ 1739.481583]  _raw_spin_lock_irqsave+0x5/0x70
[ 1739.482321]  add_wait_queue+0x1a/0x80
[ 1739.482964]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1739.483704]  ? add_wait_queue+0x1a/0x80
[ 1739.484407]  do_wait+0x90/0x5e0
[ 1739.485082]  kernel_wait4+0x110/0x1f0
[ 1739.485833]  ? task_stopped_code+0xd0/0xd0
[ 1739.486540]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1739.487430]  __do_sys_wait4+0xd7/0xf0
[ 1739.488073]  ? ftrace_call+0x5/0x44
[ 1739.488708]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1739.489534]  ? __audit_syscall_entry+0x190/0x1e0
[ 1739.490353]  ? __do_sys_wait4+0xf0/0xf0
[ 1739.491003]  ? ktime_get_coarse_real_ts64+0xd4/0x140
[ 1739.491886]  ? __x64_sys_wait4+0x5/0x30
[ 1739.492660]  __x64_sys_wait4+0x27/0x30
[ 1739.493335]  do_syscall_64+0x37/0x80
[ 1739.493983]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1739.494824] RIP: 0033:0x7fac074f09a0
[ 1739.495448] Code: b8 ff ff ff ff eb bf 0f 1f 00 f3 0f 1e fa 8b 05 d6 d7 00 00 85 c0 75 22 2e 2e 2e 2e 45 31 d2 2e 2e 2e 2e b8 3d 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 2e 2e 2e 41 54
[ 1739.498220] RSP: 002b:00007ffebadbffc8 EFLAGS: 00000246 ORIG_RAX: 000000000000003d
[ 1739.499428] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac074f09a0
[ 1739.500535] RDX: 0000000040000001 RSI: 00007ffebadbffdc RDI: 00000000ffffffff
[ 1739.501644] RBP: 00007ffebadbfff0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1739.502756] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1739.503864] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1739.505341] CPU: 1 PID: 24325 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1739.505667] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1739.506366] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1739.506389] Call Trace:
[ 1739.506418]  dump_stack_lvl+0xa4/0xd3
[ 1739.506484]  dump_stack+0x15/0x17
[ 1739.507625] caller is debug_smp_processor_id+0x1c/0x20
[ 1739.509138]  check_preemption_disabled+0x167/0x180
[ 1739.511830]  ? __get_locked_pte+0x1a2/0x290
[ 1739.512429]  ? __lock_text_start+0x8/0x8
[ 1739.513023]  debug_smp_processor_id+0x1c/0x20
[ 1739.513655]  perf_ftrace_function_call+0x7c/0x360
[ 1739.514355]  ? ftrace_ops_test+0x71/0xc0
[ 1739.514947]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1739.515620]  ? text_poke+0x2b/0x60
[ 1739.516127]  ? perf_ftrace_function_call+0x4c/0x360
[ 1739.516835]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1739.517528]  ? ftrace_ops_test+0x71/0xc0
[ 1739.518105]  ? write_comp_data+0x2f/0x90
[ 1739.518689]  ? perf_trace_buf_update+0x70/0x70
[ 1739.519397]  0xffffffffa0098099
[ 1739.519894]  ? sis_66_set_dmamode+0x1/0x110
[ 1739.520522]  ? ftrace_call+0x5/0x44
[ 1739.521059]  ? pmd_page_vaddr+0x2b/0x70
[ 1739.521649]  ? _raw_spin_lock+0x5/0x50
[ 1739.522245]  _raw_spin_lock+0x5/0x50
[ 1739.522778]  __get_locked_pte+0x1a2/0x290
[ 1739.523382]  ? _raw_spin_lock+0x5/0x50
[ 1739.523950]  ? __get_locked_pte+0x1a2/0x290
[ 1739.524578]  ? sis_66_set_dmamode+0x1/0x110
[ 1739.525207]  __text_poke+0xea/0x4e0
[ 1739.525727]  ? sis_66_set_dmamode+0x1/0x110
[ 1739.526364]  ? lock_is_held_type+0xe2/0x140
[ 1739.527019]  ? sis_66_set_dmamode+0x1/0x110
[ 1739.527682]  text_poke+0x2b/0x60
[ 1739.528197]  text_poke_bp_batch+0xf5/0x2c0
[ 1739.528832]  ? spi_new_device+0x110/0x110
[ 1739.529457]  text_poke_queue+0xa7/0xc0
[ 1739.530052]  ftrace_replace_code+0xfd/0x170
[ 1739.530731]  ftrace_modify_all_code+0x1b1/0x270
[ 1739.531424]  arch_ftrace_update_code+0x9/0x10
[ 1739.532054]  ftrace_run_update_code+0x30/0xa0
[ 1739.532702]  ftrace_startup_enable+0x5e/0xa0
[ 1739.533339]  ftrace_startup+0x16d/0x240
[ 1739.533969]  register_ftrace_function+0x43/0x90
[ 1739.534650]  perf_ftrace_event_register+0xc1/0xf0
[ 1739.535345]  perf_trace_event_init+0xa0/0x4c0
[ 1739.536022]  perf_trace_init+0xda/0x160
[ 1739.536625]  perf_tp_event_init+0x57/0xa0
[ 1739.537230]  perf_try_init_event+0x83/0x270
[ 1739.537896]  perf_event_alloc+0xe3f/0x1c10
[ 1739.538495]  ? _raw_spin_unlock+0x2c/0x50
[ 1739.539093]  ? alloc_fd+0x20d/0x320
[ 1739.539704]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1739.540408]  ? write_comp_data+0x2f/0x90
[ 1739.541279]  __x64_sys_perf_event_open+0x26/0x30
[ 1739.541952]  do_syscall_64+0x37/0x80
[ 1739.542500]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1739.543213] RIP: 0033:0x7fac0740459d
[ 1739.543740] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1739.546197] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1739.547239] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1739.548212] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1739.549178] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1739.550151] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1739.551116] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1739.552280] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1739.552500] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24325
[ 1739.553498] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1739.554745] caller is debug_smp_processor_id+0x1c/0x20
[ 1739.556446] Call Trace:
[ 1739.557638]  dump_stack_lvl+0xa4/0xd3
[ 1739.558384]  dump_stack+0x15/0x17
[ 1739.559013]  check_preemption_disabled+0x167/0x180
[ 1739.559962]  debug_smp_processor_id+0x1c/0x20
[ 1739.560765]  perf_swevent_get_recursion_context+0x1e/0xd0
[ 1739.561811]  perf_trace_buf_alloc+0x3d/0x100
[ 1739.562598]  ? add_wait_queue+0x1a/0x80
[ 1739.563251]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1739.564063]  perf_ftrace_function_call+0x209/0x360
[ 1739.565211]  ? 0xffffffffa0098099
[ 1739.565992]  0xffffffffa0098099
[ 1739.566633]  ? ftrace_call+0x5/0x44
[ 1739.567358]  ? do_wait+0x55e/0x5e0
[ 1739.568017]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1739.568808]  ? add_wait_queue+0x5/0x80
[ 1739.569473]  _raw_spin_lock_irqsave+0x5/0x70
[ 1739.570235]  add_wait_queue+0x1a/0x80
[ 1739.570880]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1739.571645]  ? add_wait_queue+0x1a/0x80
[ 1739.572350]  do_wait+0x90/0x5e0
[ 1739.573025]  kernel_wait4+0x110/0x1f0
[ 1739.573775]  ? task_stopped_code+0xd0/0xd0
[ 1739.574500]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1739.575391]  __do_sys_wait4+0xd7/0xf0
[ 1739.576035]  ? ftrace_call+0x5/0x44
[ 1739.576671]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1739.577500]  ? __audit_syscall_entry+0x190/0x1e0
[ 1739.578333]  ? __do_sys_wait4+0xf0/0xf0
[ 1739.578986]  ? ktime_get_coarse_real_ts64+0xd4/0x140
[ 1739.579881]  ? __x64_sys_wait4+0x5/0x30
[ 1739.580663]  __x64_sys_wait4+0x27/0x30
[ 1739.581339]  do_syscall_64+0x37/0x80
[ 1739.581987]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1739.582834] RIP: 0033:0x7fac074f09a0
[ 1739.583460] Code: b8 ff ff ff ff eb bf 0f 1f 00 f3 0f 1e fa 8b 05 d6 d7 00 00 85 c0 75 22 2e 2e 2e 2e 45 31 d2 2e 2e 2e 2e b8 3d 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 2e 2e 2e 41 54
[ 1739.586236] RSP: 002b:00007ffebadbffc8 EFLAGS: 00000246 ORIG_RAX: 000000000000003d
[ 1739.587442] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac074f09a0
[ 1739.588547] RDX: 0000000040000001 RSI: 00007ffebadbffdc RDI: 00000000ffffffff
[ 1739.589652] RBP: 00007ffebadbfff0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1739.590763] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1739.591870] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1739.593348] CPU: 1 PID: 24325 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1739.593796] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1739.594384] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1739.594408] Call Trace:
[ 1739.594438]  dump_stack_lvl+0xa4/0xd3
[ 1739.594507]  dump_stack+0x15/0x17
[ 1739.595576] caller is debug_smp_processor_id+0x1c/0x20
[ 1739.597072]  check_preemption_disabled+0x167/0x180
[ 1739.599719]  ? __get_locked_pte+0x1a2/0x290
[ 1739.600317]  ? __lock_text_start+0x8/0x8
[ 1739.600909]  debug_smp_processor_id+0x1c/0x20
[ 1739.601538]  perf_ftrace_function_call+0x7c/0x360
[ 1739.602236]  ? ftrace_ops_test+0x71/0xc0
[ 1739.602828]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1739.603501]  ? text_poke+0x2b/0x60
[ 1739.604009]  ? perf_ftrace_function_call+0x4c/0x360
[ 1739.604715]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1739.605406]  ? ftrace_ops_test+0x71/0xc0
[ 1739.605981]  ? write_comp_data+0x2f/0x90
[ 1739.606566]  ? perf_trace_buf_update+0x70/0x70
[ 1739.607274]  0xffffffffa0098099
[ 1739.607772]  ? sis_pre_reset+0x1/0xa0
[ 1739.608334]  ? ftrace_call+0x5/0x44
[ 1739.608869]  ? pmd_page_vaddr+0x2b/0x70
[ 1739.609459]  ? _raw_spin_lock+0x5/0x50
[ 1739.610052]  _raw_spin_lock+0x5/0x50
[ 1739.610583]  __get_locked_pte+0x1a2/0x290
[ 1739.611167]  ? _raw_spin_lock+0x5/0x50
[ 1739.611710]  ? __get_locked_pte+0x1a2/0x290
[ 1739.612334]  ? sis_pre_reset+0x1/0xa0
[ 1739.612893]  __text_poke+0xea/0x4e0
[ 1739.613411]  ? sis_pre_reset+0x1/0xa0
[ 1739.613970]  ? lock_is_held_type+0xe2/0x140
[ 1739.614589]  ? sis_pre_reset+0x1/0xa0
[ 1739.615168]  text_poke+0x2b/0x60
[ 1739.615680]  text_poke_bp_batch+0xf5/0x2c0
[ 1739.616314]  ? spi_new_device+0x110/0x110
[ 1739.616935]  text_poke_queue+0xa7/0xc0
[ 1739.617525]  ftrace_replace_code+0xfd/0x170
[ 1739.618180]  ftrace_modify_all_code+0x1b1/0x270
[ 1739.618867]  arch_ftrace_update_code+0x9/0x10
[ 1739.619495]  ftrace_run_update_code+0x30/0xa0
[ 1739.620142]  ftrace_startup_enable+0x5e/0xa0
[ 1739.620773]  ftrace_startup+0x16d/0x240
[ 1739.621401]  register_ftrace_function+0x43/0x90
[ 1739.622075]  perf_ftrace_event_register+0xc1/0xf0
[ 1739.622778]  perf_trace_event_init+0xa0/0x4c0
[ 1739.623455]  perf_trace_init+0xda/0x160
[ 1739.624056]  perf_tp_event_init+0x57/0xa0
[ 1739.624659]  perf_try_init_event+0x83/0x270
[ 1739.625323]  perf_event_alloc+0xe3f/0x1c10
[ 1739.625911]  ? _raw_spin_unlock+0x2c/0x50
[ 1739.626515]  ? alloc_fd+0x20d/0x320
[ 1739.627133]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1739.627840]  ? write_comp_data+0x2f/0x90
[ 1739.628710]  __x64_sys_perf_event_open+0x26/0x30
[ 1739.629381]  do_syscall_64+0x37/0x80
[ 1739.629918]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1739.630637] RIP: 0033:0x7fac0740459d
[ 1739.631163] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1739.633600] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1739.634644] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1739.635606] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1739.636566] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1739.637579] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1739.638551] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1739.639714] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1739.639910] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24325
[ 1739.640760] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1739.641793] caller is debug_smp_processor_id+0x1c/0x20
[ 1739.643403] Call Trace:
[ 1739.643440]  dump_stack_lvl+0xa4/0xd3
[ 1739.643522]  dump_stack+0x15/0x17
[ 1739.645575]  check_preemption_disabled+0x167/0x180
[ 1739.646377]  debug_smp_processor_id+0x1c/0x20
[ 1739.647054]  perf_trace_buf_alloc+0x98/0x100
[ 1739.647718]  ? add_wait_queue+0x1a/0x80
[ 1739.648310]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1739.649019]  perf_ftrace_function_call+0x209/0x360
[ 1739.649981]  ? 0xffffffffa0098099
[ 1739.650651]  0xffffffffa0098099
[ 1739.651211]  ? ftrace_call+0x5/0x44
[ 1739.651849]  ? do_wait+0x55e/0x5e0
[ 1739.652430]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1739.653140]  ? add_wait_queue+0x5/0x80
[ 1739.653730]  _raw_spin_lock_irqsave+0x5/0x70
[ 1739.654404]  add_wait_queue+0x1a/0x80
[ 1739.654984]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1739.655699]  ? add_wait_queue+0x1a/0x80
[ 1739.656326]  do_wait+0x90/0x5e0
[ 1739.656908]  kernel_wait4+0x110/0x1f0
[ 1739.657561]  ? task_stopped_code+0xd0/0xd0
[ 1739.658207]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1739.658986]  __do_sys_wait4+0xd7/0xf0
[ 1739.659567]  ? ftrace_call+0x5/0x44
[ 1739.660133]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1739.660875]  ? __audit_syscall_entry+0x190/0x1e0
[ 1739.661608]  ? __do_sys_wait4+0xf0/0xf0
[ 1739.662207]  ? ktime_get_coarse_real_ts64+0xd4/0x140
[ 1739.662995]  ? __x64_sys_wait4+0x5/0x30
[ 1739.663670]  __x64_sys_wait4+0x27/0x30
[ 1739.664274]  do_syscall_64+0x37/0x80
[ 1739.664854]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1739.665610] RIP: 0033:0x7fac074f09a0
[ 1739.666182] Code: b8 ff ff ff ff eb bf 0f 1f 00 f3 0f 1e fa 8b 05 d6 d7 00 00 85 c0 75 22 2e 2e 2e 2e 45 31 d2 2e 2e 2e 2e b8 3d 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 2e 2e 2e 41 54
[ 1739.668901] RSP: 002b:00007ffebadbffc8 EFLAGS: 00000246 ORIG_RAX: 000000000000003d
[ 1739.670071] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac074f09a0
[ 1739.671153] RDX: 0000000040000001 RSI: 00007ffebadbffdc RDI: 00000000ffffffff
[ 1739.672230] RBP: 00007ffebadbfff0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1739.673314] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1739.674405] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1739.675750] CPU: 1 PID: 24325 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1739.675946] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1739.676834] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1739.678102] caller is debug_smp_processor_id+0x1c/0x20
[ 1739.679537] Call Trace:
[ 1739.680690]  dump_stack_lvl+0xa4/0xd3
[ 1739.681293]  dump_stack+0x15/0x17
[ 1739.681819]  check_preemption_disabled+0x167/0x180
[ 1739.683395]  ? __get_locked_pte+0x1a2/0x290
[ 1739.683994]  ? __lock_text_start+0x8/0x8
[ 1739.684590]  debug_smp_processor_id+0x1c/0x20
[ 1739.685227]  perf_ftrace_function_call+0x7c/0x360
[ 1739.685924]  ? ftrace_ops_test+0x71/0xc0
[ 1739.686521]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1739.687197]  ? text_poke+0x2b/0x60
[ 1739.687707]  ? perf_ftrace_function_call+0x4c/0x360
[ 1739.688416]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1739.689112]  ? ftrace_ops_test+0x71/0xc0
[ 1739.689688]  ? write_comp_data+0x2f/0x90
[ 1739.690276]  ? perf_trace_buf_update+0x70/0x70
[ 1739.690986]  0xffffffffa0098099
[ 1739.691485]  ? sis_port_base.isra.2+0x1/0xa0
[ 1739.692124]  ? ftrace_call+0x5/0x44
[ 1739.692662]  ? pmd_page_vaddr+0x2b/0x70
[ 1739.693252]  ? _raw_spin_lock+0x5/0x50
[ 1739.693844]  _raw_spin_lock+0x5/0x50
[ 1739.694385]  __get_locked_pte+0x1a2/0x290
[ 1739.694974]  ? _raw_spin_lock+0x5/0x50
[ 1739.695526]  ? __get_locked_pte+0x1a2/0x290
[ 1739.696170]  ? sis_port_base.isra.2+0x1/0xa0
[ 1739.696811]  __text_poke+0xea/0x4e0
[ 1739.697332]  ? sis_port_base.isra.2+0x1/0xa0
[ 1739.697971]  ? lock_is_held_type+0xe2/0x140
[ 1739.698594]  ? sis_port_base.isra.2+0x1/0xa0
[ 1739.699252]  text_poke+0x2b/0x60
[ 1739.699766]  text_poke_bp_batch+0xf5/0x2c0
[ 1739.700399]  ? spi_new_device+0x110/0x110
[ 1739.701023]  text_poke_queue+0xa7/0xc0
[ 1739.701614]  ftrace_replace_code+0xfd/0x170
[ 1739.702272]  ftrace_modify_all_code+0x1b1/0x270
[ 1739.702963]  arch_ftrace_update_code+0x9/0x10
[ 1739.703593]  ftrace_run_update_code+0x30/0xa0
[ 1739.704242]  ftrace_startup_enable+0x5e/0xa0
[ 1739.704881]  ftrace_startup+0x16d/0x240
[ 1739.705509]  register_ftrace_function+0x43/0x90
[ 1739.706184]  perf_ftrace_event_register+0xc1/0xf0
[ 1739.706880]  perf_trace_event_init+0xa0/0x4c0
[ 1739.707563]  perf_trace_init+0xda/0x160
[ 1739.708166]  perf_tp_event_init+0x57/0xa0
[ 1739.708771]  perf_try_init_event+0x83/0x270
[ 1739.709436]  perf_event_alloc+0xe3f/0x1c10
[ 1739.710029]  ? _raw_spin_unlock+0x2c/0x50
[ 1739.710639]  ? alloc_fd+0x20d/0x320
[ 1739.711250]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1739.711956]  ? write_comp_data+0x2f/0x90
[ 1739.712827]  __x64_sys_perf_event_open+0x26/0x30
[ 1739.713499]  do_syscall_64+0x37/0x80
[ 1739.714042]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1739.714757] RIP: 0033:0x7fac0740459d
[ 1739.715285] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1739.717733] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1739.718776] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1739.719742] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1739.720708] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1739.721673] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1739.722642] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1739.723867] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1739.723974] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24325
[ 1739.724922] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1739.725954] caller is debug_smp_processor_id+0x1c/0x20
[ 1739.727536] Call Trace:
[ 1739.728620]  dump_stack_lvl+0xa4/0xd3
[ 1739.729238]  dump_stack+0x15/0x17
[ 1739.729773]  check_preemption_disabled+0x167/0x180
[ 1739.730572]  debug_smp_processor_id+0x1c/0x20
[ 1739.731250]  perf_swevent_put_recursion_context+0x1b/0x40
[ 1739.732093]  perf_tp_event+0x331/0x4e0
[ 1739.732862]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[ 1739.733786]  ? trace_hardirqs_on+0x3f/0x170
[ 1739.734477]  ? arch_local_irq_enable+0x10/0x12
[ 1739.735166]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1739.735912]  ? dump_stack_lvl+0xcc/0xd3
[ 1739.736551]  ? dump_stack+0x15/0x17
[ 1739.737109]  ? check_preemption_disabled+0x167/0x180
[ 1739.737896]  ? add_wait_queue+0x1a/0x80
[ 1739.738491]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1739.739216]  perf_ftrace_function_call+0x248/0x360
[ 1739.739950]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1739.740670]  ? perf_ftrace_function_call+0x248/0x360
[ 1739.741679]  ? 0xffffffffa0098099
[ 1739.742342]  0xffffffffa0098099
[ 1739.742883]  ? ftrace_call+0x5/0x44
[ 1739.743509]  ? do_wait+0x55e/0x5e0
[ 1739.744092]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1739.744802]  ? add_wait_queue+0x5/0x80
[ 1739.745394]  _raw_spin_lock_irqsave+0x5/0x70
[ 1739.746065]  add_wait_queue+0x1a/0x80
[ 1739.746645]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1739.747321]  ? add_wait_queue+0x1a/0x80
[ 1739.747949]  do_wait+0x90/0x5e0
[ 1739.748534]  kernel_wait4+0x110/0x1f0
[ 1739.749190]  ? task_stopped_code+0xd0/0xd0
[ 1739.749831]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1739.750616]  __do_sys_wait4+0xd7/0xf0
[ 1739.751199]  ? ftrace_call+0x5/0x44
[ 1739.751768]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1739.752514]  ? __audit_syscall_entry+0x190/0x1e0
[ 1739.753253]  ? __do_sys_wait4+0xf0/0xf0
[ 1739.753846]  ? ktime_get_coarse_real_ts64+0xd4/0x140
[ 1739.754643]  ? __x64_sys_wait4+0x5/0x30
[ 1739.755322]  __x64_sys_wait4+0x27/0x30
[ 1739.755928]  do_syscall_64+0x37/0x80
[ 1739.756509]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1739.757266] RIP: 0033:0x7fac074f09a0
[ 1739.757829] Code: b8 ff ff ff ff eb bf 0f 1f 00 f3 0f 1e fa 8b 05 d6 d7 00 00 85 c0 75 22 2e 2e 2e 2e 45 31 d2 2e 2e 2e 2e b8 3d 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 2e 2e 2e 41 54
[ 1739.760404] RSP: 002b:00007ffebadbffc8 EFLAGS: 00000246 ORIG_RAX: 000000000000003d
[ 1739.761508] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac074f09a0
[ 1739.762535] RDX: 0000000040000001 RSI: 00007ffebadbffdc RDI: 00000000ffffffff
[ 1739.763558] RBP: 00007ffebadbfff0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1739.764582] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1739.765607] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1739.766884] CPU: 1 PID: 24325 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1739.767079] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1739.767898] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1739.769042] caller is debug_smp_processor_id+0x1c/0x20
[ 1739.770534] Call Trace:
[ 1739.770563]  dump_stack_lvl+0xa4/0xd3
[ 1739.770630]  dump_stack+0x15/0x17
[ 1739.770666]  check_preemption_disabled+0x167/0x180
[ 1739.773401]  ? __get_locked_pte+0x1a2/0x290
[ 1739.774001]  ? __lock_text_start+0x8/0x8
[ 1739.774600]  debug_smp_processor_id+0x1c/0x20
[ 1739.775233]  perf_ftrace_function_call+0x7c/0x360
[ 1739.775929]  ? ftrace_ops_test+0x71/0xc0
[ 1739.776522]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1739.777198]  ? text_poke+0x2b/0x60
[ 1739.777706]  ? perf_ftrace_function_call+0x4c/0x360
[ 1739.778417]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1739.779112]  ? ftrace_ops_test+0x71/0xc0
[ 1739.779686]  ? write_comp_data+0x2f/0x90
[ 1739.780270]  ? perf_trace_buf_update+0x70/0x70
[ 1739.780979]  0xffffffffa0098099
[ 1739.781476]  ? sis_133_mode_filter+0x1/0xb0
[ 1739.782109]  ? ftrace_call+0x5/0x44
[ 1739.782647]  ? pmd_page_vaddr+0x2b/0x70
[ 1739.783238]  ? _raw_spin_lock+0x5/0x50
[ 1739.783830]  _raw_spin_lock+0x5/0x50
[ 1739.784362]  __get_locked_pte+0x1a2/0x290
[ 1739.784949]  ? _raw_spin_lock+0x5/0x50
[ 1739.785493]  ? __get_locked_pte+0x1a2/0x290
[ 1739.786122]  ? sis_133_mode_filter+0x1/0xb0
[ 1739.786750]  __text_poke+0xea/0x4e0
[ 1739.787269]  ? sis_133_mode_filter+0x1/0xb0
[ 1739.787897]  ? lock_is_held_type+0xe2/0x140
[ 1739.788514]  ? sis_133_mode_filter+0x1/0xb0
[ 1739.789161]  text_poke+0x2b/0x60
[ 1739.789675]  text_poke_bp_batch+0xf5/0x2c0
[ 1739.790312]  ? spi_new_device+0x110/0x110
[ 1739.790935]  text_poke_queue+0xa7/0xc0
[ 1739.791526]  ftrace_replace_code+0xfd/0x170
[ 1739.792181]  ftrace_modify_all_code+0x1b1/0x270
[ 1739.792871]  arch_ftrace_update_code+0x9/0x10
[ 1739.793501]  ftrace_run_update_code+0x30/0xa0
[ 1739.794154]  ftrace_startup_enable+0x5e/0xa0
[ 1739.794794]  ftrace_startup+0x16d/0x240
[ 1739.795423]  register_ftrace_function+0x43/0x90
[ 1739.796094]  perf_ftrace_event_register+0xc1/0xf0
[ 1739.796789]  perf_trace_event_init+0xa0/0x4c0
[ 1739.797467]  perf_trace_init+0xda/0x160
[ 1739.798075]  perf_tp_event_init+0x57/0xa0
[ 1739.798688]  perf_try_init_event+0x83/0x270
[ 1739.799354]  perf_event_alloc+0xe3f/0x1c10
[ 1739.799949]  ? _raw_spin_unlock+0x2c/0x50
[ 1739.800546]  ? alloc_fd+0x20d/0x320
[ 1739.801175]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1739.801880]  ? write_comp_data+0x2f/0x90
[ 1739.802755]  __x64_sys_perf_event_open+0x26/0x30
[ 1739.803428]  do_syscall_64+0x37/0x80
[ 1739.803969]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1739.804680] RIP: 0033:0x7fac0740459d
[ 1739.805206] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1739.807655] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1739.808699] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1739.809668] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1739.810639] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1739.811604] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1739.812568] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1739.813731] CPU: 0 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1739.814890] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1739.816616] Call Trace:
[ 1739.817074]  dump_stack_lvl+0xa4/0xd3
[ 1739.817769]  dump_stack+0x15/0x17
[ 1739.818364]  check_preemption_disabled+0x167/0x180
[ 1739.819170]  ? do_wait+0x10a/0x5e0
[ 1739.819762]  ? _raw_spin_unlock_irqrestore+0x60/0x60
[ 1739.820627]  debug_smp_processor_id+0x1c/0x20
[ 1739.821371]  perf_ftrace_function_call+0x7c/0x360
[ 1739.822169]  ? ftrace_ops_list_func+0x259/0x2e0
[ 1739.822952]  ? write_comp_data+0x2f/0x90
[ 1739.823646]  ? perf_trace_buf_update+0x70/0x70
[ 1739.824400]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1739.825225]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1739.825973]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1739.826805]  ? preempt_notifier_dec+0x20/0x20
[ 1739.827651]  ? ftrace_call+0x5/0x44
[ 1739.828375]  0xffffffffa0098099
[ 1739.828988]  ? trace_hardirqs_on+0x3f/0x170
[ 1739.829809]  ? do_wait+0xae/0x5e0
[ 1739.830456]  ? _raw_read_lock+0x5/0x80
[ 1739.831111]  ? write_comp_data+0x2f/0x90
[ 1739.831823]  _raw_read_lock+0x5/0x80
[ 1739.832453]  do_wait+0x10a/0x5e0
[ 1739.833034]  ? _raw_read_lock+0x5/0x80
[ 1739.833671]  ? do_wait+0x10a/0x5e0
[ 1739.834386]  kernel_wait4+0x110/0x1f0
[ 1739.835135]  ? task_stopped_code+0xd0/0xd0
[ 1739.835997]  __do_sys_wait4+0xd7/0xf0
[ 1739.836641]  ? ftrace_call+0x5/0x44
[ 1739.837273]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1739.838101]  ? __audit_syscall_entry+0x190/0x1e0
[ 1739.838916]  ? __do_sys_wait4+0xf0/0xf0
[ 1739.839565]  ? ktime_get_coarse_real_ts64+0xd4/0x140
[ 1739.840445]  ? __x64_sys_wait4+0x5/0x30
[ 1739.841218]  __x64_sys_wait4+0x27/0x30
[ 1739.841892]  do_syscall_64+0x37/0x80
[ 1739.842542]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1739.843367] RIP: 0033:0x7fac074f09a0
[ 1739.843991] Code: b8 ff ff ff ff eb bf 0f 1f 00 f3 0f 1e fa 8b 05 d6 d7 00 00 85 c0 75 22 2e 2e 2e 2e 45 31 d2 2e 2e 2e 2e b8 3d 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 2e 2e 2e 41 54
[ 1739.846766] RSP: 002b:00007ffebadbffc8 EFLAGS: 00000246 ORIG_RAX: 000000000000003d
[ 1739.847973] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac074f09a0
[ 1739.849080] RDX: 0000000040000001 RSI: 00007ffebadbffdc RDI: 00000000ffffffff
[ 1739.850191] RBP: 00007ffebadbfff0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1739.851298] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1739.852403] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1744.422053] check_preemption_disabled: 1800799 callbacks suppressed
[ 1744.422076] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24327
[ 1744.422084] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1744.422122] caller is debug_smp_processor_id+0x1c/0x20
[ 1744.422877] caller is debug_smp_processor_id+0x1c/0x20
[ 1744.423755] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1744.426543] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1744.427795] Call Trace:
[ 1744.428116]  dump_stack_lvl+0xa4/0xd3
[ 1744.428599]  dump_stack+0x15/0x17
[ 1744.429021]  check_preemption_disabled+0x167/0x180
[ 1744.429602]  ? add_wait_queue+0x1a/0x80
[ 1744.430074]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1744.430641]  debug_smp_processor_id+0x1c/0x20
[ 1744.431171]  perf_ftrace_function_call+0x7c/0x360
[ 1744.431755]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.432338]  ? ftrace_ops_test+0x71/0xc0
[ 1744.432820]  ? write_comp_data+0x2f/0x90
[ 1744.433311]  ? perf_trace_buf_update+0x70/0x70
[ 1744.433850]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.434429]  ? write_comp_data+0x2f/0x90
[ 1744.434918]  ? perf_trace_buf_update+0x70/0x70
[ 1744.435458]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.436103]  0xffffffffa0098099
[ 1744.436523]  ? ftrace_call+0x5/0x44
[ 1744.437019]  ? do_wait+0x55e/0x5e0
[ 1744.437472]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1744.438026]  ? add_wait_queue+0x5/0x80
[ 1744.438496]  _raw_spin_lock_irqsave+0x5/0x70
[ 1744.439016]  add_wait_queue+0x1a/0x80
[ 1744.439469]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1744.439995]  ? add_wait_queue+0x1a/0x80
[ 1744.440484]  do_wait+0x90/0x5e0
[ 1744.440935]  kernel_wait4+0x110/0x1f0
[ 1744.441441]  ? task_stopped_code+0xd0/0xd0
[ 1744.441941]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1744.442552]  __do_sys_wait4+0xd7/0xf0
[ 1744.443006]  ? ftrace_call+0x5/0x44
[ 1744.443450]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.444027]  ? __audit_syscall_entry+0x190/0x1e0
[ 1744.444600]  ? __do_sys_wait4+0xf0/0xf0
[ 1744.445062]  ? ktime_get_coarse_real_ts64+0xd4/0x140
[ 1744.445677]  ? __x64_sys_wait4+0x5/0x30
[ 1744.446222]  __x64_sys_wait4+0x27/0x30
[ 1744.446699]  do_syscall_64+0x37/0x80
[ 1744.447151]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1744.447745] RIP: 0033:0x7fac074f09a0
[ 1744.448185] Code: b8 ff ff ff ff eb bf 0f 1f 00 f3 0f 1e fa 8b 05 d6 d7 00 00 85 c0 75 22 2e 2e 2e 2e 45 31 d2 2e 2e 2e 2e b8 3d 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 2e 2e 2e 41 54
[ 1744.450216] RSP: 002b:00007ffebadbffc8 EFLAGS: 00000246 ORIG_RAX: 000000000000003d
[ 1744.451079] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac074f09a0
[ 1744.451876] RDX: 0000000040000001 RSI: 00007ffebadbffdc RDI: 00000000ffffffff
[ 1744.452673] RBP: 00007ffebadbfff0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1744.453472] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1744.454276] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1744.455265] CPU: 0 PID: 24327 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1744.455380] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1744.456187] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1744.457104] caller is debug_smp_processor_id+0x1c/0x20
[ 1744.458487] Call Trace:
[ 1744.458517]  dump_stack_lvl+0xa4/0xd3
[ 1744.458584]  dump_stack+0x15/0x17
[ 1744.460399]  check_preemption_disabled+0x167/0x180
[ 1744.461039]  ? ftrace_replace_code+0xfd/0x170
[ 1744.461617]  ? jump_label_transform+0x70/0x70
[ 1744.462227]  debug_smp_processor_id+0x1c/0x20
[ 1744.462818]  perf_ftrace_function_call+0x7c/0x360
[ 1744.463439]  ? write_comp_data+0x2f/0x90
[ 1744.464002]  ? write_comp_data+0x2f/0x90
[ 1744.464566]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.465194]  ? write_comp_data+0x2f/0x90
[ 1744.465757]  ? write_comp_data+0x2f/0x90
[ 1744.466323]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.467027]  0xffffffffa0098099
[ 1744.467493]  ? write_comp_data+0x2f/0x90
[ 1744.468112]  ? acpi_ut_remove_address_range+0x1c1/0x1c1
[ 1744.468820]  ? text_poke_queue+0x5/0xc0
[ 1744.469348]  ? __fentry__+0x10/0x10
[ 1744.469849]  text_poke_queue+0x5/0xc0
[ 1744.470364]  ftrace_replace_code+0xfd/0x170
[ 1744.470931]  ? text_poke_queue+0x5/0xc0
[ 1744.471447]  ? ftrace_replace_code+0xfd/0x170
[ 1744.472079]  ftrace_modify_all_code+0x1b1/0x270
[ 1744.472723]  arch_ftrace_update_code+0x9/0x10
[ 1744.473310]  ftrace_run_update_code+0x30/0xa0
[ 1744.473915]  ftrace_startup_enable+0x5e/0xa0
[ 1744.474512]  ftrace_startup+0x16d/0x240
[ 1744.475103]  register_ftrace_function+0x43/0x90
[ 1744.475730]  perf_ftrace_event_register+0xc1/0xf0
[ 1744.476378]  perf_trace_event_init+0xa0/0x4c0
[ 1744.477013]  perf_trace_init+0xda/0x160
[ 1744.477576]  perf_tp_event_init+0x57/0xa0
[ 1744.478144]  perf_try_init_event+0x83/0x270
[ 1744.478766]  perf_event_alloc+0xe3f/0x1c10
[ 1744.479313]  ? _raw_spin_unlock+0x2c/0x50
[ 1744.479869]  ? alloc_fd+0x20d/0x320
[ 1744.480444]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1744.481101]  ? write_comp_data+0x2f/0x90
[ 1744.481932]  __x64_sys_perf_event_open+0x26/0x30
[ 1744.482562]  do_syscall_64+0x37/0x80
[ 1744.483067]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1744.483728] RIP: 0033:0x7fac0740459d
[ 1744.484218] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1744.486481] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1744.487445] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1744.488338] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1744.489231] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1744.490127] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1744.491017] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1744.492107] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1744.492204] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24327
[ 1744.493009] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1744.494051] caller is debug_smp_processor_id+0x1c/0x20
[ 1744.495318] Call Trace:
[ 1744.496289]  dump_stack_lvl+0xa4/0xd3
[ 1744.496815]  dump_stack+0x15/0x17
[ 1744.497272]  check_preemption_disabled+0x167/0x180
[ 1744.497903]  ? do_wait+0x10a/0x5e0
[ 1744.498363]  ? _raw_spin_unlock_irqrestore+0x60/0x60
[ 1744.499032]  debug_smp_processor_id+0x1c/0x20
[ 1744.499611]  perf_ftrace_function_call+0x7c/0x360
[ 1744.500257]  ? write_comp_data+0x2f/0x90
[ 1744.500793]  ? perf_trace_buf_update+0x70/0x70
[ 1744.501414]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.502054]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1744.502643]  ? _raw_spin_unlock_irqrestore+0x3a/0x60
[ 1744.503292]  ? preempt_notifier_dec+0x20/0x20
[ 1744.503921]  ? ftrace_call+0x5/0x44
[ 1744.504453]  0xffffffffa0098099
[ 1744.504910]  ? trace_hardirqs_on+0x3f/0x170
[ 1744.505521]  ? do_wait+0xae/0x5e0
[ 1744.506004]  ? _raw_read_lock+0x5/0x80
[ 1744.506514]  ? write_comp_data+0x2f/0x90
[ 1744.507057]  _raw_read_lock+0x5/0x80
[ 1744.507544]  do_wait+0x10a/0x5e0
[ 1744.507991]  ? _raw_read_lock+0x5/0x80
[ 1744.508488]  ? do_wait+0x10a/0x5e0
[ 1744.509009]  kernel_wait4+0x110/0x1f0
[ 1744.509560]  ? task_stopped_code+0xd0/0xd0
[ 1744.510191]  __do_sys_wait4+0xd7/0xf0
[ 1744.510688]  ? ftrace_call+0x5/0x44
[ 1744.511171]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.511805]  ? __audit_syscall_entry+0x190/0x1e0
[ 1744.512432]  ? __do_sys_wait4+0xf0/0xf0
[ 1744.512938]  ? ktime_get_coarse_real_ts64+0xd4/0x140
[ 1744.513612]  ? __x64_sys_wait4+0x5/0x30
[ 1744.514186]  __x64_sys_wait4+0x27/0x30
[ 1744.514704]  do_syscall_64+0x37/0x80
[ 1744.515198]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1744.515848] RIP: 0033:0x7fac074f09a0
[ 1744.516330] Code: b8 ff ff ff ff eb bf 0f 1f 00 f3 0f 1e fa 8b 05 d6 d7 00 00 85 c0 75 22 2e 2e 2e 2e 45 31 d2 2e 2e 2e 2e b8 3d 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 2e 2e 2e 41 54
[ 1744.518557] RSP: 002b:00007ffebadbffc8 EFLAGS: 00000246 ORIG_RAX: 000000000000003d
[ 1744.519506] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac074f09a0
[ 1744.520384] RDX: 0000000040000001 RSI: 00007ffebadbffdc RDI: 00000000ffffffff
[ 1744.521262] RBP: 00007ffebadbfff0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1744.522142] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1744.523024] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1744.524096] CPU: 0 PID: 24327 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1744.524243] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1744.525031] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1744.525940] caller is debug_smp_processor_id+0x1c/0x20
[ 1744.527348] Call Trace:
[ 1744.528311]  dump_stack_lvl+0xa4/0xd3
[ 1744.528845]  dump_stack+0x15/0x17
[ 1744.529308]  check_preemption_disabled+0x167/0x180
[ 1744.529947]  ? ftrace_replace_code+0xfd/0x170
[ 1744.530558]  ? jump_label_transform+0x70/0x70
[ 1744.531202]  debug_smp_processor_id+0x1c/0x20
[ 1744.531823]  perf_ftrace_function_call+0x7c/0x360
[ 1744.532475]  ? write_comp_data+0x2f/0x90
[ 1744.533068]  ? write_comp_data+0x2f/0x90
[ 1744.533660]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.534329]  ? write_comp_data+0x2f/0x90
[ 1744.534926]  ? write_comp_data+0x2f/0x90
[ 1744.535519]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.536260]  0xffffffffa0098099
[ 1744.536750]  ? write_comp_data+0x2f/0x90
[ 1744.537405]  ? acpi_ut_check_address_range+0x1e3/0x1e3
[ 1744.538132]  ? text_poke_queue+0x5/0xc0
[ 1744.538685]  ? __fentry__+0x10/0x10
[ 1744.539212]  text_poke_queue+0x5/0xc0
[ 1744.539750]  ftrace_replace_code+0xfd/0x170
[ 1744.540352]  ? text_poke_queue+0x5/0xc0
[ 1744.540895]  ? ftrace_replace_code+0xfd/0x170
[ 1744.541561]  ftrace_modify_all_code+0x1b1/0x270
[ 1744.542247]  arch_ftrace_update_code+0x9/0x10
[ 1744.542866]  ftrace_run_update_code+0x30/0xa0
[ 1744.543502]  ftrace_startup_enable+0x5e/0xa0
[ 1744.544128]  ftrace_startup+0x16d/0x240
[ 1744.544750]  register_ftrace_function+0x43/0x90
[ 1744.545409]  perf_ftrace_event_register+0xc1/0xf0
[ 1744.546095]  perf_trace_event_init+0xa0/0x4c0
[ 1744.546765]  perf_trace_init+0xda/0x160
[ 1744.547359]  perf_tp_event_init+0x57/0xa0
[ 1744.547953]  perf_try_init_event+0x83/0x270
[ 1744.548611]  perf_event_alloc+0xe3f/0x1c10
[ 1744.549189]  ? _raw_spin_unlock+0x2c/0x50
[ 1744.549776]  ? alloc_fd+0x20d/0x320
[ 1744.550391]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1744.551084]  ? write_comp_data+0x2f/0x90
[ 1744.551961]  __x64_sys_perf_event_open+0x26/0x30
[ 1744.552621]  do_syscall_64+0x37/0x80
[ 1744.553152]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1744.553847] RIP: 0033:0x7fac0740459d
[ 1744.554367] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1744.556755] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1744.557772] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1744.558720] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1744.559662] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1744.560604] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1744.561544] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1744.562669] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1744.562768] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24327
[ 1744.563598] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1744.564553] caller is debug_smp_processor_id+0x1c/0x20
[ 1744.565905] Call Trace:
[ 1744.566882]  dump_stack_lvl+0xa4/0xd3
[ 1744.567408]  dump_stack+0x15/0x17
[ 1744.567864]  check_preemption_disabled+0x167/0x180
[ 1744.568493]  ? remove_wait_queue+0x17/0x60
[ 1744.569029]  ? _raw_read_lock_irqsave+0x90/0x90
[ 1744.569645]  debug_smp_processor_id+0x1c/0x20
[ 1744.570227]  perf_ftrace_function_call+0x7c/0x360
[ 1744.570882]  ? ftrace_ops_list_func+0x1d2/0x2e0
[ 1744.571468]  ? rcu_read_lock_held_common+0x2f/0x50
[ 1744.572096]  ? rcu_advance_cbs+0x70/0x70
[ 1744.572649]  ? write_comp_data+0x2f/0x90
[ 1744.573186]  ? write_comp_data+0x2f/0x90
[ 1744.573721]  ? perf_trace_buf_update+0x70/0x70
[ 1744.574311]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.575010]  0xffffffffa0098099
[ 1744.575468]  ? ftrace_call+0x5/0x44
[ 1744.575998]  ? do_wait+0x1e8/0x5e0
[ 1744.576492]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1744.577099]  ? remove_wait_queue+0x5/0x60
[ 1744.577634]  _raw_spin_lock_irqsave+0x5/0x70
[ 1744.578205]  remove_wait_queue+0x17/0x60
[ 1744.578731]  ? _raw_spin_lock_irqsave+0x5/0x70
[ 1744.579309]  ? remove_wait_queue+0x17/0x60
[ 1744.579874]  do_wait+0x2e9/0x5e0
[ 1744.580375]  kernel_wait4+0x110/0x1f0
[ 1744.580926]  ? task_stopped_code+0xd0/0xd0
[ 1744.581556]  __do_sys_wait4+0xd7/0xf0
[ 1744.582058]  ? ftrace_call+0x5/0x44
[ 1744.582543]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.583177]  ? __audit_syscall_entry+0x190/0x1e0
[ 1744.583803]  ? __do_sys_wait4+0xf0/0xf0
[ 1744.584311]  ? ktime_get_coarse_real_ts64+0xd4/0x140
[ 1744.584986]  ? __x64_sys_wait4+0x5/0x30
[ 1744.585558]  __x64_sys_wait4+0x27/0x30
[ 1744.586078]  do_syscall_64+0x37/0x80
[ 1744.586575]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1744.587226] RIP: 0033:0x7fac074f09a0
[ 1744.587706] Code: b8 ff ff ff ff eb bf 0f 1f 00 f3 0f 1e fa 8b 05 d6 d7 00 00 85 c0 75 22 2e 2e 2e 2e 45 31 d2 2e 2e 2e 2e b8 3d 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 2e 2e 2e 41 54
[ 1744.589934] RSP: 002b:00007ffebadbffc8 EFLAGS: 00000246 ORIG_RAX: 000000000000003d
[ 1744.590888] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac074f09a0
[ 1744.591769] RDX: 0000000040000001 RSI: 00007ffebadbffdc RDI: 00000000ffffffff
[ 1744.592648] RBP: 00007ffebadbfff0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1744.593527] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1744.594410] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1744.595485] CPU: 0 PID: 24327 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1744.595665] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1744.596421] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1744.597338] caller is debug_smp_processor_id+0x1c/0x20
[ 1744.598716] Call Trace:
[ 1744.598745]  dump_stack_lvl+0xa4/0xd3
[ 1744.598812]  dump_stack+0x15/0x17
[ 1744.600630]  check_preemption_disabled+0x167/0x180
[ 1744.601269]  ? ftrace_replace_code+0xfd/0x170
[ 1744.601844]  ? jump_label_transform+0x70/0x70
[ 1744.602454]  debug_smp_processor_id+0x1c/0x20
[ 1744.603042]  perf_ftrace_function_call+0x7c/0x360
[ 1744.603661]  ? write_comp_data+0x2f/0x90
[ 1744.604222]  ? write_comp_data+0x2f/0x90
[ 1744.604782]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.605408]  ? write_comp_data+0x2f/0x90
[ 1744.605969]  ? write_comp_data+0x2f/0x90
[ 1744.606535]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.607237]  0xffffffffa0098099
[ 1744.607702]  ? write_comp_data+0x2f/0x90
[ 1744.608319]  ? acpi_os_allocate+0x4e/0x4e
[ 1744.608873]  ? text_poke_queue+0x5/0xc0
[ 1744.609400]  ? __fentry__+0x10/0x10
[ 1744.609900]  text_poke_queue+0x5/0xc0
[ 1744.610415]  ftrace_replace_code+0xfd/0x170
[ 1744.610980]  ? text_poke_queue+0x5/0xc0
[ 1744.611496]  ? ftrace_replace_code+0xfd/0x170
[ 1744.612127]  ftrace_modify_all_code+0x1b1/0x270
[ 1744.612770]  arch_ftrace_update_code+0x9/0x10
[ 1744.613355]  ftrace_run_update_code+0x30/0xa0
[ 1744.613959]  ftrace_startup_enable+0x5e/0xa0
[ 1744.614557]  ftrace_startup+0x16d/0x240
[ 1744.615147]  register_ftrace_function+0x43/0x90
[ 1744.615772]  perf_ftrace_event_register+0xc1/0xf0
[ 1744.616419]  perf_trace_event_init+0xa0/0x4c0
[ 1744.617052]  perf_trace_init+0xda/0x160
[ 1744.617616]  perf_tp_event_init+0x57/0xa0
[ 1744.618184]  perf_try_init_event+0x83/0x270
[ 1744.618805]  perf_event_alloc+0xe3f/0x1c10
[ 1744.619353]  ? _raw_spin_unlock+0x2c/0x50
[ 1744.619909]  ? alloc_fd+0x20d/0x320
[ 1744.620483]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1744.621138]  ? write_comp_data+0x2f/0x90
[ 1744.621966]  __x64_sys_perf_event_open+0x26/0x30
[ 1744.622594]  do_syscall_64+0x37/0x80
[ 1744.623104]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1744.623763] RIP: 0033:0x7fac0740459d
[ 1744.624250] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1744.626507] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1744.627471] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1744.628360] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1744.629251] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1744.630153] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1744.631046] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1744.632134] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1744.632230] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24327
[ 1744.633039] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1744.634075] caller is debug_smp_processor_id+0x1c/0x20
[ 1744.635357] Call Trace:
[ 1744.636327]  dump_stack_lvl+0xa4/0xd3
[ 1744.636852]  dump_stack+0x15/0x17
[ 1744.637307]  check_preemption_disabled+0x167/0x180
[ 1744.637941]  ? exit_to_user_mode_prepare+0xab/0x240
[ 1744.638576]  ? __schedule+0xb20/0xb20
[ 1744.639092]  debug_smp_processor_id+0x1c/0x20
[ 1744.639673]  perf_ftrace_function_call+0x7c/0x360
[ 1744.640358]  ? ftrace_call+0x5/0x44
[ 1744.640844]  ? ftrace_call+0x5/0x44
[ 1744.641347]  ? write_comp_data+0x2f/0x90
[ 1744.641883]  ? perf_trace_buf_update+0x70/0x70
[ 1744.642486]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.643189]  0xffffffffa0098099
[ 1744.643648]  ? ftrace_call+0x5/0x44
[ 1744.644134]  ? rcu_read_lock_sched_held+0x4f/0x80
[ 1744.644781]  ? trace_hardirqs_on+0x3f/0x170
[ 1744.645366]  ? schedule+0x5/0xd0
[ 1744.645849]  schedule+0x5/0xd0
[ 1744.646286]  exit_to_user_mode_prepare+0xab/0x240
[ 1744.646904]  ? schedule+0x5/0xd0
[ 1744.647341]  ? exit_to_user_mode_prepare+0xab/0x240
[ 1744.647998]  syscall_exit_to_user_mode+0x2b/0x60
[ 1744.648615]  do_syscall_64+0x46/0x80
[ 1744.649111]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1744.649761] RIP: 0033:0x7fac074f09a0
[ 1744.650250] Code: b8 ff ff ff ff eb bf 0f 1f 00 f3 0f 1e fa 8b 05 d6 d7 00 00 85 c0 75 22 2e 2e 2e 2e 45 31 d2 2e 2e 2e 2e b8 3d 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 60 c3 0f 1f 80 00 00 00 00 2e 2e 2e 2e 41 54
[ 1744.652477] RSP: 002b:00007ffebadbffc8 EFLAGS: 00000246 ORIG_RAX: 000000000000003d
[ 1744.653428] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac074f09a0
[ 1744.654315] RDX: 0000000040000001 RSI: 00007ffebadbffdc RDI: 00000000ffffffff
[ 1744.655198] RBP: 00007ffebadbfff0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1744.656082] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1744.656972] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1744.658058] CPU: 0 PID: 24327 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1744.658244] BUG: using smp_processor_id() in preemptible [00000000] code: systemd-journal/163
[ 1744.658998] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1744.660058] caller is debug_smp_processor_id+0x1c/0x20
[ 1744.661426] Call Trace:
[ 1744.662424]  dump_stack_lvl+0xa4/0xd3
[ 1744.662955]  dump_stack+0x15/0x17
[ 1744.663415]  check_preemption_disabled+0x167/0x180
[ 1744.664051]  ? ftrace_replace_code+0xfd/0x170
[ 1744.664624]  ? jump_label_transform+0x70/0x70
[ 1744.665227]  debug_smp_processor_id+0x1c/0x20
[ 1744.665812]  perf_ftrace_function_call+0x7c/0x360
[ 1744.666438]  ? write_comp_data+0x2f/0x90
[ 1744.666999]  ? write_comp_data+0x2f/0x90
[ 1744.667558]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.668182]  ? write_comp_data+0x2f/0x90
[ 1744.668740]  ? write_comp_data+0x2f/0x90
[ 1744.669298]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.669997]  0xffffffffa0098099
[ 1744.670468]  ? write_comp_data+0x2f/0x90
[ 1744.671083]  ? acpi_ut_create_caches+0x104/0x104
[ 1744.671721]  ? text_poke_queue+0x5/0xc0
[ 1744.672279]  ? __fentry__+0x10/0x10
[ 1744.672808]  text_poke_queue+0x5/0xc0
[ 1744.673344]  ftrace_replace_code+0xfd/0x170
[ 1744.673938]  ? text_poke_queue+0x5/0xc0
[ 1744.674486]  ? ftrace_replace_code+0xfd/0x170
[ 1744.675150]  ftrace_modify_all_code+0x1b1/0x270
[ 1744.675827]  arch_ftrace_update_code+0x9/0x10
[ 1744.676443]  ftrace_run_update_code+0x30/0xa0
[ 1744.677078]  ftrace_startup_enable+0x5e/0xa0
[ 1744.677703]  ftrace_startup+0x16d/0x240
[ 1744.678328]  register_ftrace_function+0x43/0x90
[ 1744.678986]  perf_ftrace_event_register+0xc1/0xf0
[ 1744.679668]  perf_trace_event_init+0xa0/0x4c0
[ 1744.680335]  perf_trace_init+0xda/0x160
[ 1744.680929]  perf_tp_event_init+0x57/0xa0
[ 1744.681523]  perf_try_init_event+0x83/0x270
[ 1744.682182]  perf_event_alloc+0xe3f/0x1c10
[ 1744.682760]  ? _raw_spin_unlock+0x2c/0x50
[ 1744.683350]  ? alloc_fd+0x20d/0x320
[ 1744.683955]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1744.684645]  ? write_comp_data+0x2f/0x90
[ 1744.685522]  __x64_sys_perf_event_open+0x26/0x30
[ 1744.686183]  do_syscall_64+0x37/0x80
[ 1744.686711]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1744.687408] RIP: 0033:0x7fac0740459d
[ 1744.687924] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1744.690291] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1744.691253] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1744.692144] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1744.693035] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1744.693927] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1744.694821] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1744.695907] CPU: 1 PID: 163 Comm: systemd-journal Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1744.696002] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24327
[ 1744.696939] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1744.697888] caller is debug_smp_processor_id+0x1c/0x20
[ 1744.699282] Call Trace:
[ 1744.699311]  dump_stack_lvl+0xa4/0xd3
[ 1744.699377]  dump_stack+0x15/0x17
[ 1744.701233]  check_preemption_disabled+0x167/0x180
[ 1744.701876]  ? do_epoll_wait+0x3b3/0xd80
[ 1744.702412]  ? __mutex_lock+0x9f0/0x9f0
[ 1744.702959]  debug_smp_processor_id+0x1c/0x20
[ 1744.703550]  perf_ftrace_function_call+0x7c/0x360
[ 1744.704239]  ? ftrace_call+0x5/0x44
[ 1744.704715]  ? trace_hardirqs_on+0x6a/0x170
[ 1744.705321]  ? finish_task_switch+0xb0/0x2a0
[ 1744.705892]  ? finish_task_switch+0x70/0x2a0
[ 1744.706495]  ? trace_hardirqs_on+0x3f/0x170
[ 1744.707055]  ? finish_task_switch+0x70/0x2a0
[ 1744.707652]  ? preempt_count_sub+0x5/0xa0
[ 1744.708262]  0xffffffffa0098099
[ 1744.708711]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.709361]  ? schedule_hrtimeout_range_clock+0x139/0x1a0
[ 1744.710119]  ? do_epoll_wait+0x36b/0xd80
[ 1744.710688]  ? mutex_lock_nested+0x5/0x20
[ 1744.711237]  ? write_comp_data+0x2f/0x90
[ 1744.711795]  mutex_lock_nested+0x5/0x20
[ 1744.712323]  do_epoll_wait+0x3b3/0xd80
[ 1744.712843]  ? mutex_lock_nested+0x5/0x20
[ 1744.713381]  ? do_epoll_wait+0x3b3/0xd80
[ 1744.714083]  ? wait_woken+0x90/0x90
[ 1744.714644]  __x64_sys_epoll_wait+0x8d/0xd0
[ 1744.715280]  do_syscall_64+0x37/0x80
[ 1744.715786]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1744.716452] RIP: 0033:0x7f8a39143b20
[ 1744.716944] Code: 41 54 41 89 d4 55 48 89 f5 53 89 fb 48 83 ec 18 e8 75 fd f6 ff 41 89 c0 45 89 ea 44 89 e2 48 89 ee 89 df b8 e8 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 32 44 89 c7 89 44 24 0c e8 ac fd f6 ff 8b 44
[ 1744.719225] RSP: 002b:00007fff1b55b2b0 EFLAGS: 00000293 ORIG_RAX: 00000000000000e8
[ 1744.720196] RAX: ffffffffffffffda RBX: 0000000000000006 RCX: 00007f8a39143b20
[ 1744.721095] RDX: 000000000000001b RSI: 00007fff1b55b2f0 RDI: 0000000000000006
[ 1744.721992] RBP: 00007fff1b55b2f0 R08: 0000000000000000 R09: 00007fff1b55b578
[ 1744.722895] R10: 00000000ffffffff R11: 0000000000000293 R12: 000000000000001b
[ 1744.723795] R13: 00000000ffffffff R14: 00007fff1b55b2f0 R15: 0000000000000001
[ 1744.724890] CPU: 0 PID: 24327 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1744.725889] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1744.727317] Call Trace:
[ 1744.727670]  dump_stack_lvl+0xa4/0xd3
[ 1744.728204]  dump_stack+0x15/0x17
[ 1744.728688]  check_preemption_disabled+0x167/0x180
[ 1744.729331]  ? ftrace_replace_code+0xfd/0x170
[ 1744.729912]  ? jump_label_transform+0x70/0x70
[ 1744.730569]  debug_smp_processor_id+0x1c/0x20
[ 1744.731196]  perf_ftrace_function_call+0x7c/0x360
[ 1744.731853]  ? write_comp_data+0x2f/0x90
[ 1744.732452]  ? write_comp_data+0x2f/0x90
[ 1744.733052]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.733714]  ? write_comp_data+0x2f/0x90
[ 1744.734322]  ? write_comp_data+0x2f/0x90
[ 1744.734893]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1744.735595]  0xffffffffa0098099
[ 1744.736061]  ? write_comp_data+0x2f/0x90
[ 1744.736676]  ? acpi_ut_delete_caches+0x85/0x85
[ 1744.737271]  ? text_poke_queue+0x5/0xc0
[ 1744.737795]  ? __fentry__+0x10/0x10
[ 1744.738311]  text_poke_queue+0x5/0xc0
[ 1744.738817]  ftrace_replace_code+0xfd/0x170
[ 1744.739381]  ? text_poke_queue+0x5/0xc0
[ 1744.739896]  ? ftrace_replace_code+0xfd/0x170
[ 1744.740524]  ftrace_modify_all_code+0x1b1/0x270
[ 1744.741166]  arch_ftrace_update_code+0x9/0x10
[ 1744.741750]  ftrace_run_update_code+0x30/0xa0
[ 1744.742363]  ftrace_startup_enable+0x5e/0xa0
[ 1744.742958]  ftrace_startup+0x16d/0x240
[ 1744.743552]  register_ftrace_function+0x43/0x90
[ 1744.744177]  perf_ftrace_event_register+0xc1/0xf0
[ 1744.744822]  perf_trace_event_init+0xa0/0x4c0
[ 1744.745454]  perf_trace_init+0xda/0x160
[ 1744.746015]  perf_tp_event_init+0x57/0xa0
[ 1744.746589]  perf_try_init_event+0x83/0x270
[ 1744.747209]  perf_event_alloc+0xe3f/0x1c10
[ 1744.747756]  ? _raw_spin_unlock+0x2c/0x50
[ 1744.748310]  ? alloc_fd+0x20d/0x320
[ 1744.748882]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1744.749535]  ? write_comp_data+0x2f/0x90
[ 1744.750367]  __x64_sys_perf_event_open+0x26/0x30
[ 1744.750990]  do_syscall_64+0x37/0x80
[ 1744.751490]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1744.752150] RIP: 0033:0x7fac0740459d
[ 1744.752635] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1744.754893] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1744.755858] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1744.756749] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1744.757641] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1744.758536] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1744.759426] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1749.425980] check_preemption_disabled: 2532013 callbacks suppressed
[ 1749.425996] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24328
[ 1749.426184] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1749.426790] caller is debug_smp_processor_id+0x1c/0x20
[ 1749.427677] caller is debug_smp_processor_id+0x1c/0x20
[ 1749.428537] CPU: 0 PID: 24328 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1749.430550] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1749.431843] Call Trace:
[ 1749.432143]  dump_stack_lvl+0xa4/0xd3
[ 1749.432590]  dump_stack+0x15/0x17
[ 1749.432990]  check_preemption_disabled+0x167/0x180
[ 1749.433557]  ? text_poke_queue+0x84/0xc0
[ 1749.434026]  ? cpumask_weight+0x20/0x20
[ 1749.434504]  debug_smp_processor_id+0x1c/0x20
[ 1749.435024]  perf_ftrace_function_call+0x7c/0x360
[ 1749.435586]  ? irqentry_exit+0x3a/0x90
[ 1749.436036]  ? sysvec_apic_timer_interrupt+0xc8/0xd0
[ 1749.436627]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1749.437188]  ? lockdep_hardirqs_on+0x59/0x110
[ 1749.437721]  ? irqentry_exit+0x3a/0x90
[ 1749.438200]  ? trace_hardirqs_on+0x6a/0x170
[ 1749.438710]  ? irqentry_exit+0x3a/0x90
[ 1749.439142]  ? sysvec_apic_timer_interrupt+0xc8/0xd0
[ 1749.439702]  ? clk_hw_register_composite_pdata+0x70/0x70
[ 1749.440303]  0xffffffffa0098099
[ 1749.440673]  ? ftrace_check_record+0xf3/0x4d0
[ 1749.441177]  ? clk_hw_register_composite_pdata+0x70/0x70
[ 1749.441772]  ? text_poke_loc_init+0x5/0x140
[ 1749.442268]  ? write_comp_data+0x2f/0x90
[ 1749.442719]  text_poke_loc_init+0x5/0x140
[ 1749.443181]  text_poke_queue+0x84/0xc0
[ 1749.443612]  ? text_poke_loc_init+0x5/0x140
[ 1749.444083]  ? text_poke_queue+0x84/0xc0
[ 1749.444537]  ftrace_replace_code+0xfd/0x170
[ 1749.445019]  ftrace_modify_all_code+0x1b1/0x270
[ 1749.445547]  arch_ftrace_update_code+0x9/0x10
[ 1749.446067]  ftrace_run_update_code+0x30/0xa0
[ 1749.446564]  ftrace_startup_enable+0x5e/0xa0
[ 1749.447050]  ftrace_startup+0x16d/0x240
[ 1749.447499]  register_ftrace_function+0x43/0x90
[ 1749.448011]  perf_ftrace_event_register+0xc1/0xf0
[ 1749.448543]  perf_trace_event_init+0xa0/0x4c0
[ 1749.449044]  perf_trace_init+0xda/0x160
[ 1749.449488]  perf_tp_event_init+0x57/0xa0
[ 1749.449950]  perf_try_init_event+0x83/0x270
[ 1749.450445]  perf_event_alloc+0xe3f/0x1c10
[ 1749.450910]  ? _raw_spin_unlock+0x2c/0x50
[ 1749.451370]  ? alloc_fd+0x20d/0x320
[ 1749.451786]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1749.452326]  ? write_comp_data+0x2f/0x90
[ 1749.452823]  __x64_sys_perf_event_open+0x26/0x30
[ 1749.453344]  do_syscall_64+0x37/0x80
[ 1749.453755]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1749.454331] RIP: 0033:0x7fac0740459d
[ 1749.454739] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1749.456724] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1749.457549] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1749.458328] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1749.459101] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1749.459927] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1749.460776] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1749.461661] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1749.461691] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24328
[ 1749.462533] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1749.462545] Call Trace:
[ 1749.462554]  dump_stack_lvl+0xa4/0xd3
[ 1749.463467] caller is debug_smp_processor_id+0x1c/0x20
[ 1749.464789]  dump_stack+0x15/0x17
[ 1749.466529]  check_preemption_disabled+0x167/0x180
[ 1749.467112]  ? do_nanosleep+0x123/0x2a0
[ 1749.467582]  ? ___might_sleep+0x170/0x170
[ 1749.468079]  debug_smp_processor_id+0x1c/0x20
[ 1749.468611]  perf_ftrace_function_call+0x7c/0x360
[ 1749.469191]  ? 0xffffffffa0098099
[ 1749.469601]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1749.470189]  ? finish_task_switch+0xab/0x2a0
[ 1749.470709]  ? __schedule+0x46e/0xb20
[ 1749.471172]  ? do_nanosleep+0x9c/0x2a0
[ 1749.471636]  0xffffffffa0098099
[ 1749.472029]  ? finish_task_switch+0xb0/0x2a0
[ 1749.472559]  ? do_nanosleep+0x107/0x2a0
[ 1749.473037]  ? __might_sleep+0x5/0x70
[ 1749.473487]  ? write_comp_data+0x2f/0x90
[ 1749.473970]  __might_sleep+0x5/0x70
[ 1749.474410]  do_nanosleep+0x123/0x2a0
[ 1749.474862]  ? __might_sleep+0x5/0x70
[ 1749.475310]  ? do_nanosleep+0x123/0x2a0
[ 1749.475780]  ? write_comp_data+0x2f/0x90
[ 1749.476271]  hrtimer_nanosleep+0xf7/0x1b0
[ 1749.476772]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1749.477339]  __x64_sys_nanosleep+0xfc/0x150
[ 1749.477862]  do_syscall_64+0x37/0x80
[ 1749.478307]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1749.478918] RIP: 0033:0x7fac073cca18
[ 1749.479358] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1749.481503] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1749.482397] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1749.483231] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1749.484066] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1749.484901] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1749.485736] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1749.486606] CPU: 0 PID: 24328 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1749.486638] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1749.487507] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1749.488393] caller is debug_smp_processor_id+0x1c/0x20
[ 1749.489725] Call Trace:
[ 1749.490642]  dump_stack_lvl+0xa4/0xd3
[ 1749.491106]  dump_stack+0x15/0x17
[ 1749.491525]  check_preemption_disabled+0x167/0x180
[ 1749.492116]  ? text_poke_loc_init+0x63/0x140
[ 1749.492643]  ? insn_get_length+0x90/0x90
[ 1749.493136]  debug_smp_processor_id+0x1c/0x20
[ 1749.493677]  perf_ftrace_function_call+0x7c/0x360
[ 1749.494263]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1749.494845]  ? dump_stack_lvl+0xcc/0xd3
[ 1749.495328]  ? dump_stack+0x15/0x17
[ 1749.495766]  ? write_comp_data+0x2f/0x90
[ 1749.496254]  ? text_poke_queue+0x84/0xc0
[ 1749.496743]  ? cpumask_weight+0x20/0x20
[ 1749.497220]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1749.497797]  ? text_poke_queue+0x84/0xc0
[ 1749.498290]  ? perf_ftrace_function_call+0x4c/0x360
[ 1749.498898]  ? clk_hw_register_composite_pdata+0x70/0x70
[ 1749.499547]  0xffffffffa0098099
[ 1749.499940]  ? lockdep_hardirqs_on+0x59/0x110
[ 1749.500479]  ? irqentry_exit+0x3a/0x90
[ 1749.500968]  ? insn_decode+0x5/0x170
[ 1749.501421]  insn_decode+0x5/0x170
[ 1749.501847]  text_poke_loc_init+0x63/0x140
[ 1749.502357]  ? insn_decode+0x5/0x170
[ 1749.502803]  ? text_poke_loc_init+0x63/0x140
[ 1749.503328]  ? ftrace_check_record+0xf3/0x4d0
[ 1749.503877]  ? clk_hw_register_composite_pdata+0x70/0x70
[ 1749.504525]  ? text_poke_loc_init+0x5/0x140
[ 1749.505044]  ? write_comp_data+0x2f/0x90
[ 1749.505532]  ? clk_hw_register_composite_pdata+0x70/0x70
[ 1749.506191]  text_poke_queue+0x84/0xc0
[ 1749.506668]  ftrace_replace_code+0xfd/0x170
[ 1749.507195]  ftrace_modify_all_code+0x1b1/0x270
[ 1749.507760]  arch_ftrace_update_code+0x9/0x10
[ 1749.508297]  ftrace_run_update_code+0x30/0xa0
[ 1749.508839]  ftrace_startup_enable+0x5e/0xa0
[ 1749.509371]  ftrace_startup+0x16d/0x240
[ 1749.509862]  register_ftrace_function+0x43/0x90
[ 1749.510427]  perf_ftrace_event_register+0xc1/0xf0
[ 1749.511013]  perf_trace_event_init+0xa0/0x4c0
[ 1749.511560]  perf_trace_init+0xda/0x160
[ 1749.512047]  perf_tp_event_init+0x57/0xa0
[ 1749.512549]  perf_try_init_event+0x83/0x270
[ 1749.513079]  perf_event_alloc+0xe3f/0x1c10
[ 1749.513587]  ? _raw_spin_unlock+0x2c/0x50
[ 1749.514092]  ? alloc_fd+0x20d/0x320
[ 1749.514546]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1749.515134]  ? write_comp_data+0x2f/0x90
[ 1749.515675]  __x64_sys_perf_event_open+0x26/0x30
[ 1749.516244]  do_syscall_64+0x37/0x80
[ 1749.516692]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1749.517309] RIP: 0033:0x7fac0740459d
[ 1749.517752] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1749.519940] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1749.520842] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1749.521700] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1749.522548] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1749.523395] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1749.524243] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1749.525127] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1749.525151] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24328
[ 1749.525988] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1749.525999] Call Trace:
[ 1749.526006]  dump_stack_lvl+0xa4/0xd3
[ 1749.526930] caller is debug_smp_processor_id+0x1c/0x20
[ 1749.528247]  dump_stack+0x15/0x17
[ 1749.529966]  check_preemption_disabled+0x167/0x180
[ 1749.530548]  ? __might_sleep+0x48/0x70
[ 1749.531021]  ? sched_show_task+0x70/0x70
[ 1749.531503]  debug_smp_processor_id+0x1c/0x20
[ 1749.532031]  perf_ftrace_function_call+0x7c/0x360
[ 1749.532597]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1749.533164]  ? do_nanosleep+0x123/0x2a0
[ 1749.533635]  ? perf_ftrace_function_call+0x4c/0x360
[ 1749.534233]  ? 0xffffffffa0098099
[ 1749.534640]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1749.535222]  ? finish_task_switch+0xab/0x2a0
[ 1749.535738]  ? __schedule+0x46e/0xb20
[ 1749.536190]  ? do_nanosleep+0x9c/0x2a0
[ 1749.536651]  0xffffffffa0098099
[ 1749.537038]  ? do_nanosleep+0x9c/0x2a0
[ 1749.537510]  ? do_nanosleep+0x107/0x2a0
[ 1749.537984]  ? ___might_sleep+0x5/0x170
[ 1749.538463]  ___might_sleep+0x5/0x170
[ 1749.538912]  __might_sleep+0x48/0x70
[ 1749.539350]  ? ___might_sleep+0x5/0x170
[ 1749.539817]  ? __might_sleep+0x48/0x70
[ 1749.540278]  do_nanosleep+0x123/0x2a0
[ 1749.540725]  ? write_comp_data+0x2f/0x90
[ 1749.541213]  hrtimer_nanosleep+0xf7/0x1b0
[ 1749.541711]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1749.542283]  __x64_sys_nanosleep+0xfc/0x150
[ 1749.542803]  do_syscall_64+0x37/0x80
[ 1749.543242]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1749.543848] RIP: 0033:0x7fac073cca18
[ 1749.544283] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1749.546428] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1749.547312] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1749.548142] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1749.548972] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1749.549801] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1749.550632] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1749.551496] CPU: 0 PID: 24328 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1749.551549] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1749.552395] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1749.553282] caller is debug_smp_processor_id+0x1c/0x20
[ 1749.554625] Call Trace:
[ 1749.554633]  dump_stack_lvl+0xa4/0xd3
[ 1749.555994]  dump_stack+0x15/0x17
[ 1749.556412]  check_preemption_disabled+0x167/0x180
[ 1749.557001]  ? insn_decode+0x9b/0x170
[ 1749.557456]  ? insn_get_immediate+0x570/0x570
[ 1749.557996]  debug_smp_processor_id+0x1c/0x20
[ 1749.558538]  perf_ftrace_function_call+0x7c/0x360
[ 1749.559118]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1749.559694]  ? text_poke_loc_init+0x63/0x140
[ 1749.560220]  ? perf_ftrace_function_call+0x4c/0x360
[ 1749.560819]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1749.561399]  ? dump_stack_lvl+0xcc/0xd3
[ 1749.561880]  ? dump_stack+0x15/0x17
[ 1749.562322]  ? write_comp_data+0x2f/0x90
[ 1749.562810]  ? text_poke_queue+0x84/0xc0
[ 1749.563296]  ? cpumask_weight+0x20/0x20
[ 1749.563772]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1749.564361]  0xffffffffa0098099
[ 1749.564756]  ? clk_hw_register_composite_pdata+0x70/0x70
[ 1749.565404]  ? 0xffffffffa0098099
[ 1749.565816]  ? lockdep_hardirqs_on+0x59/0x110
[ 1749.566370]  ? insn_get_length+0x5/0x90
[ 1749.566847]  ? write_comp_data+0x2f/0x90
[ 1749.567335]  insn_get_length+0x5/0x90
[ 1749.567791]  insn_decode+0x9b/0x170
[ 1749.568225]  ? insn_get_length+0x5/0x90
[ 1749.568698]  ? insn_decode+0x9b/0x170
[ 1749.569159]  ? clk_hw_register_composite_pdata+0x70/0x70
[ 1749.569823]  text_poke_loc_init+0x63/0x140
[ 1749.570372]  ? clk_hw_register_composite_pdata+0x70/0x70
[ 1749.571036]  text_poke_queue+0x84/0xc0
[ 1749.571523]  ftrace_replace_code+0xfd/0x170
[ 1749.572048]  ftrace_modify_all_code+0x1b1/0x270
[ 1749.572613]  arch_ftrace_update_code+0x9/0x10
[ 1749.573149]  ftrace_run_update_code+0x30/0xa0
[ 1749.573690]  ftrace_startup_enable+0x5e/0xa0
[ 1749.574232]  ftrace_startup+0x16d/0x240
[ 1749.574723]  register_ftrace_function+0x43/0x90
[ 1749.575285]  perf_ftrace_event_register+0xc1/0xf0
[ 1749.575866]  perf_trace_event_init+0xa0/0x4c0
[ 1749.576414]  perf_trace_init+0xda/0x160
[ 1749.576899]  perf_tp_event_init+0x57/0xa0
[ 1749.577401]  perf_try_init_event+0x83/0x270
[ 1749.577933]  perf_event_alloc+0xe3f/0x1c10
[ 1749.578465]  ? _raw_spin_unlock+0x2c/0x50
[ 1749.578966]  ? alloc_fd+0x20d/0x320
[ 1749.579427]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1749.580018]  ? write_comp_data+0x2f/0x90
[ 1749.580559]  __x64_sys_perf_event_open+0x26/0x30
[ 1749.581128]  do_syscall_64+0x37/0x80
[ 1749.581576]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1749.582205] RIP: 0033:0x7fac0740459d
[ 1749.582650] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1749.584837] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1749.585745] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1749.586600] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1749.587472] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1749.588318] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1749.589164] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1749.590050] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1749.590093] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24328
[ 1749.590935] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1749.591855] caller is debug_smp_processor_id+0x1c/0x20
[ 1749.593167] Call Trace:
[ 1749.594083]  dump_stack_lvl+0xa4/0xd3
[ 1749.594539]  dump_stack+0x15/0x17
[ 1749.594950]  check_preemption_disabled+0x167/0x180
[ 1749.595528]  ? do_nanosleep+0x155/0x2a0
[ 1749.595998]  ? hrtimer_wakeup+0x40/0x40
[ 1749.596474]  debug_smp_processor_id+0x1c/0x20
[ 1749.597004]  perf_ftrace_function_call+0x7c/0x360
[ 1749.597581]  ? 0xffffffffa0098099
[ 1749.597990]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1749.598576]  ? finish_task_switch+0xab/0x2a0
[ 1749.599093]  ? __schedule+0x46e/0xb20
[ 1749.599549]  ? do_nanosleep+0x9c/0x2a0
[ 1749.600015]  ? do_nanosleep+0x9c/0x2a0
[ 1749.600478]  0xffffffffa0098099
[ 1749.600870]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1749.601441]  ? lock_is_held_type+0xe2/0x140
[ 1749.601956]  ? do_nanosleep+0x140/0x2a0
[ 1749.602435]  ? hrtimer_try_to_cancel+0x5/0x290
[ 1749.602977]  ? write_comp_data+0x2f/0x90
[ 1749.603466]  hrtimer_try_to_cancel+0x5/0x290
[ 1749.604006]  do_nanosleep+0x155/0x2a0
[ 1749.604462]  ? hrtimer_try_to_cancel+0x5/0x290
[ 1749.605003]  ? do_nanosleep+0x155/0x2a0
[ 1749.605474]  ? write_comp_data+0x2f/0x90
[ 1749.605965]  hrtimer_nanosleep+0xf7/0x1b0
[ 1749.606474]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1749.607042]  __x64_sys_nanosleep+0xfc/0x150
[ 1749.607564]  do_syscall_64+0x37/0x80
[ 1749.608006]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1749.608615] RIP: 0033:0x7fac073cca18
[ 1749.609052] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1749.611201] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1749.612088] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1749.612921] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1749.613755] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1749.614590] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1749.615422] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1749.616289] CPU: 0 PID: 24328 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1749.616316] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1749.617186] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1749.618091] caller is debug_smp_processor_id+0x1c/0x20
[ 1749.619410] Call Trace:
[ 1749.620317]  dump_stack_lvl+0xa4/0xd3
[ 1749.620779]  dump_stack+0x15/0x17
[ 1749.621198]  check_preemption_disabled+0x167/0x180
[ 1749.621788]  ? insn_get_length+0x75/0x90
[ 1749.622276]  ? insn_get_displacement+0x270/0x270
[ 1749.622846]  debug_smp_processor_id+0x1c/0x20
[ 1749.623385]  perf_ftrace_function_call+0x7c/0x360
[ 1749.623963]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1749.624542]  ? insn_decode+0x9b/0x170
[ 1749.624998]  ? perf_ftrace_function_call+0x4c/0x360
[ 1749.625598]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1749.626178]  ? text_poke_loc_init+0x63/0x140
[ 1749.626706]  ? perf_ftrace_function_call+0x4c/0x360
[ 1749.627305]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1749.627885]  ? dump_stack_lvl+0xcc/0xd3
[ 1749.628367]  ? dump_stack+0x15/0x17
[ 1749.628803]  ? write_comp_data+0x2f/0x90
[ 1749.629302]  0xffffffffa0098099
[ 1749.629706]  ? clk_hw_register_composite_pdata+0x70/0x70
[ 1749.630358]  ? insn_get_length+0x41/0x90
[ 1749.630849]  ? insn_get_immediate+0x5/0x570
[ 1749.631366]  ? write_comp_data+0x2f/0x90
[ 1749.631857]  insn_get_immediate+0x5/0x570
[ 1749.632354]  insn_get_length+0x75/0x90
[ 1749.632822]  ? insn_get_immediate+0x5/0x570
[ 1749.633337]  ? insn_get_length+0x75/0x90
[ 1749.633827]  insn_decode+0x9b/0x170
[ 1749.634269]  ? clk_hw_register_composite_pdata+0x70/0x70
[ 1749.634916]  text_poke_loc_init+0x63/0x140
[ 1749.635446]  ? clk_hw_register_composite_pdata+0x70/0x70
[ 1749.636101]  text_poke_queue+0x84/0xc0
[ 1749.636577]  ftrace_replace_code+0xfd/0x170
[ 1749.637102]  ftrace_modify_all_code+0x1b1/0x270
[ 1749.637666]  arch_ftrace_update_code+0x9/0x10
[ 1749.638207]  ftrace_run_update_code+0x30/0xa0
[ 1749.638748]  ftrace_startup_enable+0x5e/0xa0
[ 1749.639277]  ftrace_startup+0x16d/0x240
[ 1749.639766]  register_ftrace_function+0x43/0x90
[ 1749.640328]  perf_ftrace_event_register+0xc1/0xf0
[ 1749.640910]  perf_trace_event_init+0xa0/0x4c0
[ 1749.641458]  perf_trace_init+0xda/0x160
[ 1749.641945]  perf_tp_event_init+0x57/0xa0
[ 1749.642449]  perf_try_init_event+0x83/0x270
[ 1749.642978]  perf_event_alloc+0xe3f/0x1c10
[ 1749.643484]  ? _raw_spin_unlock+0x2c/0x50
[ 1749.643983]  ? alloc_fd+0x20d/0x320
[ 1749.644435]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1749.645026]  ? write_comp_data+0x2f/0x90
[ 1749.645567]  __x64_sys_perf_event_open+0x26/0x30
[ 1749.646138]  do_syscall_64+0x37/0x80
[ 1749.646586]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1749.647203] RIP: 0033:0x7fac0740459d
[ 1749.647646] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1749.649825] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1749.650729] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1749.651575] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1749.652420] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1749.653266] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1749.654116] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1749.654998] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1749.655029] BUG: using smp_processor_id() in preemptible [00000000] code: repro/24328
[ 1749.655859] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1749.656779] caller is debug_smp_processor_id+0x1c/0x20
[ 1749.658107] Call Trace:
[ 1749.658116]  dump_stack_lvl+0xa4/0xd3
[ 1749.658138]  dump_stack+0x15/0x17
[ 1749.659869]  check_preemption_disabled+0x167/0x180
[ 1749.660450]  ? hrtimer_try_to_cancel+0x38/0x290
[ 1749.660998]  ? __hrtimer_get_remaining+0x80/0x80
[ 1749.661562]  debug_smp_processor_id+0x1c/0x20
[ 1749.662097]  perf_ftrace_function_call+0x7c/0x360
[ 1749.662666]  ? do_nanosleep+0x155/0x2a0
[ 1749.663135]  ? hrtimer_wakeup+0x40/0x40
[ 1749.663608]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1749.664176]  ? do_nanosleep+0x155/0x2a0
[ 1749.664647]  ? perf_ftrace_function_call+0x4c/0x360
[ 1749.665242]  ? 0xffffffffa0098099
[ 1749.665651]  ? __this_cpu_preempt_check+0x1c/0x20
[ 1749.666241]  ? do_nanosleep+0x9c/0x2a0
[ 1749.666705]  0xffffffffa0098099
[ 1749.667092]  ? do_nanosleep+0x9c/0x2a0
[ 1749.667559]  ? do_nanosleep+0x9c/0x2a0
[ 1749.668027]  ? do_nanosleep+0x140/0x2a0
[ 1749.668503]  ? hrtimer_active+0x5/0xb0
[ 1749.668968]  ? do_nanosleep+0x140/0x2a0
[ 1749.669439]  hrtimer_active+0x5/0xb0
[ 1749.669882]  hrtimer_try_to_cancel+0x38/0x290
[ 1749.670419]  ? hrtimer_active+0x5/0xb0
[ 1749.670880]  ? hrtimer_try_to_cancel+0x38/0x290
[ 1749.671438]  ? do_nanosleep+0x9c/0x2a0
[ 1749.671902]  do_nanosleep+0x155/0x2a0
[ 1749.672352]  ? write_comp_data+0x2f/0x90
[ 1749.672843]  hrtimer_nanosleep+0xf7/0x1b0
[ 1749.673343]  ? hrtimer_init_sleeper+0x1d0/0x1d0
[ 1749.673907]  __x64_sys_nanosleep+0xfc/0x150
[ 1749.674433]  do_syscall_64+0x37/0x80
[ 1749.674876]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1749.675486] RIP: 0033:0x7fac073cca18
[ 1749.675923] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1749.678087] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1749.678976] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1749.679810] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1749.680642] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1749.681476] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1749.682310] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1749.683176] CPU: 0 PID: 24328 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1749.683203] BUG: using smp_processor_id() in preemptible [00000000] code: repro/571
[ 1749.684075] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1749.684959] caller is debug_smp_processor_id+0x1c/0x20
[ 1749.686296] Call Trace:
[ 1749.686304]  dump_stack_lvl+0xa4/0xd3
[ 1749.687667]  dump_stack+0x15/0x17
[ 1749.688084]  check_preemption_disabled+0x167/0x180
[ 1749.688671]  ? insn_get_immediate+0x181/0x570
[ 1749.689210]  ? insn_get_sib+0x140/0x140
[ 1749.689689]  debug_smp_processor_id+0x1c/0x20
[ 1749.690238]  perf_ftrace_function_call+0x7c/0x360
[ 1749.690821]  ? insn_get_displacement+0x270/0x270
[ 1749.691387]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1749.691965]  ? insn_get_length+0x75/0x90
[ 1749.692451]  ? perf_ftrace_function_call+0x4c/0x360
[ 1749.693048]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1749.693625]  ? insn_decode+0x9b/0x170
[ 1749.694085]  ? perf_ftrace_function_call+0x4c/0x360
[ 1749.694687]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1749.695263]  ? text_poke_loc_init+0x63/0x140
[ 1749.695811]  ? perf_ftrace_function_call+0x4c/0x360
[ 1749.696414]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1749.696998]  ? dump_stack_lvl+0xcc/0xd3
[ 1749.697487]  0xffffffffa0098099
[ 1749.697890]  ? 0xffffffffa0098099
[ 1749.698314]  ? insn_get_immediate+0x49/0x570
[ 1749.698847]  ? insn_get_displacement+0x5/0x270
[ 1749.699393]  ? write_comp_data+0x2f/0x90
[ 1749.699883]  insn_get_displacement+0x5/0x270
[ 1749.700410]  insn_get_immediate+0x181/0x570
[ 1749.700925]  ? insn_get_displacement+0x5/0x270
[ 1749.701471]  ? insn_get_immediate+0x181/0x570
[ 1749.702015]  insn_get_length+0x75/0x90
[ 1749.702489]  insn_decode+0x9b/0x170
[ 1749.702927]  ? clk_hw_register_composite_pdata+0x70/0x70
[ 1749.703572]  text_poke_loc_init+0x63/0x140
[ 1749.704101]  ? clk_hw_register_composite_pdata+0x70/0x70
[ 1749.704753]  text_poke_queue+0x84/0xc0
[ 1749.705229]  ftrace_replace_code+0xfd/0x170
[ 1749.705754]  ftrace_modify_all_code+0x1b1/0x270
[ 1749.706319]  arch_ftrace_update_code+0x9/0x10
[ 1749.706854]  ftrace_run_update_code+0x30/0xa0
[ 1749.707394]  ftrace_startup_enable+0x5e/0xa0
[ 1749.707923]  ftrace_startup+0x16d/0x240
[ 1749.708411]  register_ftrace_function+0x43/0x90
[ 1749.708977]  perf_ftrace_event_register+0xc1/0xf0
[ 1749.709559]  perf_trace_event_init+0xa0/0x4c0
[ 1749.710116]  perf_trace_init+0xda/0x160
[ 1749.710600]  perf_tp_event_init+0x57/0xa0
[ 1749.711107]  perf_try_init_event+0x83/0x270
[ 1749.711638]  perf_event_alloc+0xe3f/0x1c10
[ 1749.712145]  ? _raw_spin_unlock+0x2c/0x50
[ 1749.712646]  ? alloc_fd+0x20d/0x320
[ 1749.713099]  __do_sys_perf_event_open+0x3bf/0x1de0
[ 1749.713690]  ? write_comp_data+0x2f/0x90
[ 1749.714242]  __x64_sys_perf_event_open+0x26/0x30
[ 1749.714811]  do_syscall_64+0x37/0x80
[ 1749.715260]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1749.715879] RIP: 0033:0x7fac0740459d
[ 1749.716324] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d d3 08 0d 00 f7 d8 64 89 01 48
[ 1749.718507] RSP: 002b:00007ffebadbffa8 EFLAGS: 00000246 ORIG_RAX: 000000000000012a
[ 1749.719410] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fac0740459d
[ 1749.720256] RDX: 0000000000000000 RSI: 00000000ffffffff RDI: 00000000200000c0
[ 1749.721102] RBP: 00007ffebadbffc0 R08: 0000000000000000 R09: 00007ffebadbffc0
[ 1749.721950] R10: 00000000ffffffff R11: 0000000000000246 R12: 0000000000401180
[ 1749.722800] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
[ 1749.723683] CPU: 1 PID: 571 Comm: repro Not tainted 5.15.0-rc4-7d380f24fe66+ #1
[ 1749.724551] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[ 1749.725867] Call Trace:
[ 1749.726178]  dump_stack_lvl+0xa4/0xd3
[ 1749.726636]  dump_stack+0x15/0x17
[ 1749.727047]  check_preemption_disabled+0x167/0x180
[ 1749.727627]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1749.728196]  ? __bpf_trace_sys_enter+0x10/0x10
[ 1749.728740]  debug_smp_processor_id+0x1c/0x20
[ 1749.729271]  perf_ftrace_function_call+0x7c/0x360
[ 1749.729843]  ? write_comp_data+0x2f/0x90
[ 1749.730338]  ? write_comp_data+0x2f/0x90
[ 1749.730822]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1749.731393]  ? write_comp_data+0x2f/0x90
[ 1749.731876]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1749.732454]  0xffffffffa0098099
[ 1749.732841]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1749.733432]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1749.734090]  ? __sanitizer_cov_trace_pc+0x21/0x50
[ 1749.734663]  syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1749.735299]  syscall_exit_to_user_mode+0xd/0x60
[ 1749.735849]  ? syscall_exit_to_user_mode_prepare+0x5/0x240
[ 1749.736502]  ? syscall_exit_to_user_mode+0xd/0x60
[ 1749.737071]  do_syscall_64+0x46/0x80
[ 1749.737510]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[ 1749.738118] RIP: 0033:0x7fac073cca18
[ 1749.738553] Code: 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 85 e6 10 00 8b 00 85 c0 75 1f b8 23 00 00 00 0f 05 <0f> 1f 84 00 00 00 00 00 48 3d 00 f0 ff ff 77 48 c3 0f 1f 80 00 00
[ 1749.740687] RSP: 002b:00007ffebadbff78 EFLAGS: 00000246 ORIG_RAX: 0000000000000023
[ 1749.741572] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007fac073cca18
[ 1749.742406] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00007ffebadbff80
[ 1749.743237] RBP: 00007ffebadbffc0 R08: 00007ffebade8080 R09: 0000000000000000
[ 1749.744069] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000401180
[ 1749.744898] R13: 00007ffebadc00e0 R14: 0000000000000000 R15: 0000000000000000
