c[?7l[2J[0mSeaBIOS (version rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org)


iPXE (http://ipxe.org) 00:03.0 CA00 PCI2.10 PnP PMM+7FF91000+7FEF1000 CA00
Press Ctrl-B to configure iPXE (PCI 00:03.0)...                                                                               


Booting from ROM...
c[?7l[2J[    0.000000] Linux version 6.14.0-next-20250325-eb4bc4b07f66 (root@p-mtlp04) (gcc (GCC) 11.5.0 20240719 (Red Hat 11.5.0-5), GNU ld version 2.35.2-63.el9) #1 SMP PREEMPT_DYNAMIC Tue Mar 25 18:30:34 CST 2025
[    0.000000] Command line: console=ttyS0 root=/dev/sda earlyprintk=serial net.ifnames=0 plymouth.enable=0
[    0.000000] KERNEL supported cpus:
[    0.000000]   Intel GenuineIntel
[    0.000000]   AMD AuthenticAMD
[    0.000000]   Hygon HygonGenuine
[    0.000000]   Centaur CentaurHauls
[    0.000000]   zhaoxin   Shanghai  
[    0.000000] x86/split lock detection: #DB: warning on user-space bus_locks
[    0.000000] BIOS-provided physical RAM map:
[    0.000000] BIOS-e820: [mem 0x0000000000000000-0x000000000009fbff] usable
[    0.000000] BIOS-e820: [mem 0x000000000009fc00-0x000000000009ffff] reserved
[    0.000000] BIOS-e820: [mem 0x00000000000f0000-0x00000000000fffff] reserved
[    0.000000] BIOS-e820: [mem 0x0000000000100000-0x000000007ffdffff] usable
[    0.000000] BIOS-e820: [mem 0x000000007ffe0000-0x000000007fffffff] reserved
[    0.000000] BIOS-e820: [mem 0x00000000feffc000-0x00000000feffffff] reserved
[    0.000000] BIOS-e820: [mem 0x00000000fffc0000-0x00000000ffffffff] reserved
[    0.000000] printk: legacy bootconsole [earlyser0] enabled
[    0.000000] NX (Execute Disable) protection: active
[    0.000000] APIC: Static calls initialized
[    0.000000] SMBIOS 2.8 present.
[    0.000000] DMI: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[    0.000000] DMI: Memory slots populated: 1/1
[    0.000000] Hypervisor detected: KVM
[    0.000000] kvm-clock: Using msrs 4b564d01 and 4b564d00
[    0.000003] kvm-clock: using sched offset of 927337842 cycles
[    0.000437] clocksource: kvm-clock: mask: 0xffffffffffffffff max_cycles: 0x1cd42e4dffb, max_idle_ns: 881590591483 ns
[    0.001797] tsc: Detected 2995.200 MHz processor
[    0.009765] last_pfn = 0x7ffe0 max_arch_pfn = 0x400000000
[    0.010290] MTRR map: 4 entries (3 fixed + 1 variable; max 19), built from 8 variable MTRRs
[    0.011014] x86/PAT: Configuration [0-7]: WB  WC  UC- UC  WB  WP  UC- WT  
[    0.021632] found SMP MP-table at [mem 0x000f5ba0-0x000f5baf]
[    0.022272] Using GB pages for direct mapping
[    0.024780] ACPI: Early table checksum verification disabled
[    0.025303] ACPI: RSDP 0x00000000000F59C0 000014 (v00 BOCHS )
[    0.025879] ACPI: RSDT 0x000000007FFE1951 000034 (v01 BOCHS  BXPC     00000001 BXPC 00000001)
[    0.026699] ACPI: FACP 0x000000007FFE17FD 000074 (v01 BOCHS  BXPC     00000001 BXPC 00000001)
[    0.027505] ACPI: DSDT 0x000000007FFE0040 0017BD (v01 BOCHS  BXPC     00000001 BXPC 00000001)
[    0.028317] ACPI: FACS 0x000000007FFE0000 000040
[    0.028748] ACPI: APIC 0x000000007FFE1871 000080 (v01 BOCHS  BXPC     00000001 BXPC 00000001)
[    0.029576] ACPI: HPET 0x000000007FFE18F1 000038 (v01 BOCHS  BXPC     00000001 BXPC 00000001)
[    0.030321] ACPI: WAET 0x000000007FFE1929 000028 (v01 BOCHS  BXPC     00000001 BXPC 00000001)
[    0.031066] ACPI: Reserving FACP table memory at [mem 0x7ffe17fd-0x7ffe1870]
[    0.031675] ACPI: Reserving DSDT table memory at [mem 0x7ffe0040-0x7ffe17fc]
[    0.032281] ACPI: Reserving FACS table memory at [mem 0x7ffe0000-0x7ffe003f]
[    0.032887] ACPI: Reserving APIC table memory at [mem 0x7ffe1871-0x7ffe18f0]
[    0.033495] ACPI: Reserving HPET table memory at [mem 0x7ffe18f1-0x7ffe1928]
[    0.034098] ACPI: Reserving WAET table memory at [mem 0x7ffe1929-0x7ffe1950]
[    0.035302] No NUMA configuration found
[    0.035639] Faking a node at [mem 0x0000000000000000-0x000000007ffdffff]
[    0.036242] NODE_DATA(0) allocated [mem 0x7ffb4fc0-0x7ffdfc7f]
[    0.037436] Zone ranges:
[    0.037672]   DMA      [mem 0x0000000000001000-0x0000000000ffffff]
[    0.038211]   DMA32    [mem 0x0000000001000000-0x000000007ffdffff]
[    0.038754]   Normal   empty
[    0.039012]   Device   empty
[    0.039263] Movable zone start for each node
[    0.039628] Early memory node ranges
[    0.039934]   node   0: [mem 0x0000000000001000-0x000000000009efff]
[    0.040488]   node   0: [mem 0x0000000000100000-0x000000007ffdffff]
[    0.041041] Initmem setup node 0 [mem 0x0000000000001000-0x000000007ffdffff]
[    0.042190] On node 0, zone DMA: 1 pages in unavailable ranges
[    0.043040] On node 0, zone DMA: 97 pages in unavailable ranges
[    0.090845] On node 0, zone DMA32: 32 pages in unavailable ranges
[    0.361544] kasan: KernelAddressSanitizer initialized
[    0.362267] ACPI: PM-Timer IO Port: 0x608
[    0.362646] ACPI: LAPIC_NMI (acpi_id[0xff] dfl dfl lint[0x1])
[    0.363193] IOAPIC[0]: apic_id 0, version 17, address 0xfec00000, GSI 0-23
[    0.363776] ACPI: INT_SRC_OVR (bus 0 bus_irq 0 global_irq 2 dfl dfl)
[    0.364300] ACPI: INT_SRC_OVR (bus 0 bus_irq 5 global_irq 5 high level)
[    0.364841] ACPI: INT_SRC_OVR (bus 0 bus_irq 9 global_irq 9 high level)
[    0.365385] ACPI: INT_SRC_OVR (bus 0 bus_irq 10 global_irq 10 high level)
[    0.365940] ACPI: INT_SRC_OVR (bus 0 bus_irq 11 global_irq 11 high level)
[    0.366509] ACPI: Using ACPI (MADT) for SMP configuration information
[    0.367036] ACPI: HPET id: 0x8086a201 base: 0xfed00000
[    0.367480] TSC deadline timer available
[    0.367810] CPU topo: Max. logical packages:   1
[    0.368188] CPU topo: Max. logical dies:       1
[    0.368565] CPU topo: Max. dies per package:   1
[    0.368946] CPU topo: Max. threads per core:   1
[    0.369324] CPU topo: Num. cores per package:     2
[    0.369723] CPU topo: Num. threads per package:   2
[    0.370123] CPU topo: Allowing 2 present CPUs plus 0 hotplug CPUs
[    0.370679] kvm-guest: APIC: eoi() replaced with kvm_guest_apic_eoi_write()
[    0.371285] kvm-guest: KVM setup pv remote TLB flush
[    0.371693] kvm-guest: setup PV sched yield
[    0.372091] PM: hibernation: Registered nosave memory: [mem 0x00000000-0x00000fff]
[    0.372715] PM: hibernation: Registered nosave memory: [mem 0x0009f000-0x0009ffff]
[    0.373335] PM: hibernation: Registered nosave memory: [mem 0x000a0000-0x000effff]
[    0.373951] PM: hibernation: Registered nosave memory: [mem 0x000f0000-0x000fffff]
[    0.374576] [mem 0x80000000-0xfeffbfff] available for PCI devices
[    0.375079] Booting paravirtualized kernel on KVM
[    0.375496] clocksource: refined-jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 7645519600211568 ns
[    0.376387] setup_percpu: NR_CPUS:8192 nr_cpumask_bits:2 nr_cpu_ids:2 nr_node_ids:1
[    0.378800] percpu: Embedded 80 pages/cpu s290816 r8192 d28672 u1048576
[    0.379531] kvm-guest: PV spinlocks enabled
[    0.379891] PV qspinlock hash table entries: 256 (order: 0, 4096 bytes, linear)
[    0.380513] Kernel command line: net.ifnames=0 console=ttyS0 root=/dev/sda earlyprintk=serial net.ifnames=0 plymouth.enable=0
[    0.381784] random: crng init done
[    0.382073] printk: log buffer data + meta data: 262144 + 917504 = 1179648 bytes
[    0.384081] Dentry cache hash table entries: 262144 (order: 9, 2097152 bytes, linear)
[    0.385295] Inode-cache hash table entries: 131072 (order: 8, 1048576 bytes, linear)
[    0.386244] Fallback order for Node 0: 0 
[    0.386260] Built 1 zonelists, mobility grouping on.  Total pages: 524158
[    0.387117] Policy zone: DMA32
[    0.387368] mem auto-init: stack:off, heap alloc:off, heap free:off
[    0.387866] stackdepot: allocating hash table via alloc_large_system_hash
[    0.388410] stackdepot hash table entries: 1048576 (order: 12, 16777216 bytes, linear)
[    0.450575] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=2, Nodes=1
[    0.451151] kmemleak: Kernel memory leak detector disabled
[    0.484645] ftrace: allocating 73475 entries in 288 pages
[    0.485116] ftrace: allocated 288 pages with 2 groups
[    0.489057] Dynamic Preempt: voluntary
[    0.489744] Running RCU self tests
[    0.490025] Running RCU synchronous self tests
[    0.490382] rcu: Preemptible hierarchical RCU implementation.
[    0.490842] rcu: 	RCU lockdep checking is enabled.
[    0.491229] rcu: 	RCU restricting CPUs from NR_CPUS=8192 to nr_cpu_ids=2.
[    0.491771] 	Trampoline variant of Tasks RCU enabled.
[    0.492178] 	Rude variant of Tasks RCU enabled.
[    0.492539] 	Tracing variant of Tasks RCU enabled.
[    0.492921] rcu: RCU calculated value of scheduler-enlistment delay is 25 jiffies.
[    0.493526] rcu: Adjusting geometry for rcu_fanout_leaf=16, nr_cpu_ids=2
[    0.494107] Running RCU synchronous self tests
[    0.494467] RCU Tasks: Setting shift to 1 and lim to 1 rcu_task_cb_adjust=1 rcu_task_cpu_ids=2.
[    0.495161] RCU Tasks Rude: Setting shift to 1 and lim to 1 rcu_task_cb_adjust=1 rcu_task_cpu_ids=2.
[    0.495899] RCU Tasks Trace: Setting shift to 1 and lim to 1 rcu_task_cb_adjust=1 rcu_task_cpu_ids=2.
[    0.556031] NR_IRQS: 524544, nr_irqs: 440, preallocated irqs: 16
[    0.557050] rcu: srcu_init: Setting srcu_struct sizes based on contention.
[    0.564858] Console: colour VGA+ 80x25
[    0.565241] printk: legacy console [ttyS0] enabled
[    0.565241] printk: legacy console [ttyS0] enabled
[    0.566027] printk: legacy bootconsole [earlyser0] disabled
[    0.566027] printk: legacy bootconsole [earlyser0] disabled
[    0.566940] Lock dependency validator: Copyright (c) 2006 Red Hat, Inc., Ingo Molnar
[    0.567576] ... MAX_LOCKDEP_SUBCLASSES:  8
[    0.567919] ... MAX_LOCK_DEPTH:          48
[    0.568268] ... MAX_LOCKDEP_KEYS:        8192
[    0.568630] ... CLASSHASH_SIZE:          4096
[    0.568984] ... MAX_LOCKDEP_ENTRIES:     524288
[    0.569360] ... MAX_LOCKDEP_CHAINS:      524288
[    0.569737] ... CHAINHASH_SIZE:          262144
[    0.570113]  memory used by lock dependency info: 54145 kB
[    0.570566]  memory used for stack traces: 4224 kB
[    0.570963]  per task-struct memory footprint: 1920 bytes
[    0.571493] ACPI: Core revision 20240827
[    0.572213] clocksource: hpet: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604467 ns
[    0.573142] APIC: Switch to symmetric I/O mode setup
[    0.573733] x2apic enabled
[    0.574330] APIC: Switched APIC routing to: physical x2apic
[    0.574807] kvm-guest: APIC: send_IPI_mask() replaced with kvm_send_ipi_mask()
[    0.575433] kvm-guest: APIC: send_IPI_mask_allbutself() replaced with kvm_send_ipi_mask_allbutself()
[    0.576204] kvm-guest: setup PV IPIs
[    0.577533] ..TIMER: vector=0x30 apic1=0 pin1=2 apic2=-1 pin2=-1
[    0.578070] clocksource: tsc-early: mask: 0xffffffffffffffff max_cycles: 0x2b2c8ec87c7, max_idle_ns: 440795278598 ns
[    0.578970] Calibrating delay loop (skipped) preset value.. 5990.40 BogoMIPS (lpj=11980800)
[    0.579807] x86/cpu: User Mode Instruction Prevention (UMIP) activated
[    0.580453] Last level iTLB entries: 4KB 0, 2MB 0, 4MB 0
[    0.580908] Last level dTLB entries: 4KB 0, 2MB 0, 4MB 0, 1GB 0
[    0.583001] Spectre V1 : Mitigation: usercopy/swapgs barriers and __user pointer sanitization
[    0.583725] Spectre V2 : WARNING: Unprivileged eBPF is enabled with eIBRS on, data leaks possible via Spectre v2 BHB attacks!
[    0.584666] Spectre V2 : Spectre BHI mitigation: SW BHB clearing on syscall and VM exit
[    0.585345] Spectre V2 : Mitigation: Enhanced / Automatic IBRS
[    0.585840] Spectre V2 : Spectre v2 / SpectreRSB mitigation: Filling RSB on context switch
[    0.586550] Spectre V2 : Spectre v2 / PBRSB-eIBRS: Retire a single CALL on VMEXIT
[    0.586969] Spectre V2 : mitigation: Enabling conditional Indirect Branch Prediction Barrier
[    0.587698] Speculative Store Bypass: Mitigation: Speculative Store Bypass disabled via prctl
[    0.588423] MMIO Stale Data: Unknown: No mitigations
[    0.588889] x86/fpu: Supporting XSAVE feature 0x001: 'x87 floating point registers'
[    0.589544] x86/fpu: Supporting XSAVE feature 0x002: 'SSE registers'
[    0.590089] x86/fpu: Supporting XSAVE feature 0x004: 'AVX registers'
[    0.590961] x86/fpu: Supporting XSAVE feature 0x200: 'Protection Keys User registers'
[    0.591632] x86/fpu: xstate_offset[2]:  576, xstate_sizes[2]:  256
[    0.592164] x86/fpu: xstate_offset[9]:  832, xstate_sizes[9]:    8
[    0.592700] x86/fpu: Enabled xstate features 0x207, context size is 840 bytes, using 'compacted' format.
[    0.743105] Freeing SMP alternatives memory: 60K
[    0.743598] pid_max: default: 32768 minimum: 301
[    0.744228] LSM: initializing lsm=capability,yama,ima,evm
[    0.744790] Yama: becoming mindful.
[    0.745482] Mount-cache hash table entries: 4096 (order: 3, 32768 bytes, linear)
[    0.746114] Mountpoint-cache hash table entries: 4096 (order: 3, 32768 bytes, linear)
[    0.748295] Running RCU synchronous self tests
[    0.748709] Running RCU synchronous self tests
[    0.749466] smpboot: CPU0: Intel(R) Core(TM) Ultra 7 155H (family: 0x6, model: 0xaa, stepping: 0x4)
[    0.750957] Performance Events: unsupported CPU family 6 model 170 no PMU driver, software events only.
[    0.750957] signal: max sigframe size: 3632
[    0.750957] rcu: Hierarchical SRCU implementation.
[    0.750957] rcu: 	Max phase no-delay instances is 1000.
[    0.751220] Timer migration: 1 hierarchy levels; 8 children per group; 1 crossnode level
[    0.753905] NMI watchdog: Perf NMI watchdog permanently disabled
[    0.754614] smp: Bringing up secondary CPUs ...
[    0.767222] smpboot: x86: Booting SMP configuration:
[    0.767652] .... node  #0, CPUs:      #1
[    0.768049] smp: Brought up 1 node, 2 CPUs
[    0.768049] smpboot: Total of 2 processors activated (11980.80 BogoMIPS)
[    0.771489] Memory: 1550116K/2096632K available (78527K kernel code, 15286K rwdata, 18232K rodata, 15976K init, 68784K bss, 539472K reserved, 0K cma-reserved)
[    0.773646] devtmpfs: initialized
[    0.775061] x86/mm: Memory block size: 128MB
[    0.784227] Running RCU synchronous self tests
[    0.784227] Running RCU synchronous self tests
[    0.784332] Running RCU Tasks wait API self tests
[    0.787021] Running RCU Tasks Rude wait API self tests
[    0.787423] Running RCU Tasks Trace wait API self tests
[    0.807015] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 7645041785100000 ns
[    0.808144] posixtimers hash table entries: 1024 (order: 4, 73728 bytes, linear)
[    0.811056] futex hash table entries: 512 (order: 4, 65536 bytes, linear)
[    0.812281] pinctrl core: initialized pinctrl subsystem
[    0.813813] 
[    0.813955] *************************************************************
[    0.814491] **     NOTICE NOTICE NOTICE NOTICE NOTICE NOTICE NOTICE    **
[    0.814966] **                                                         **
[    0.815502] **  IOMMU DebugFS SUPPORT HAS BEEN ENABLED IN THIS KERNEL  **
[    0.816047] **                                                         **
[    0.816583] ** This means that this kernel is built to expose internal **
[    0.817117] ** IOMMU data structures, which may compromise security on **
[    0.817653] ** your system.                                            **
[    0.818187] **                                                         **
[    0.818721] ** If you see this message and you are not debugging the   **
[    0.818961] ** kernel, report this immediately to your vendor!         **
[    0.819545] **                                                         **
[    0.820083] **     NOTICE NOTICE NOTICE NOTICE NOTICE NOTICE NOTICE    **
[    0.820620] *************************************************************
[    0.821255] PM: RTC time: 11:06:44, date: 2025-03-27
[    0.825100] NET: Registered PF_NETLINK/PF_ROUTE protocol family
[    0.826910] DMA: preallocated 256 KiB GFP_KERNEL pool for atomic allocations
[    0.826991] DMA: preallocated 256 KiB GFP_KERNEL|GFP_DMA pool for atomic allocations
[    0.827627] DMA: preallocated 256 KiB GFP_KERNEL|GFP_DMA32 pool for atomic allocations
[    0.828359] audit: initializing netlink subsys (disabled)
[    0.828842] audit: type=2000 audit(1743073605.373:1): state=initialized audit_enabled=0 res=1
[    0.829306] thermal_sys: Registered thermal governor 'fair_share'
[    0.829314] thermal_sys: Registered thermal governor 'bang_bang'
[    0.829847] thermal_sys: Registered thermal governor 'step_wise'
[    0.830348] thermal_sys: Registered thermal governor 'user_space'
[    0.830982] cpuidle: using governor ladder
[    0.832549] Callback from call_rcu_tasks_trace() invoked.
[    0.834984] cpuidle: using governor menu
[    0.836430] acpiphp: ACPI Hot Plug PCI Controller Driver version: 0.5
[    0.837692] PCI: Using configuration type 1 for base access
[    0.838436] kprobes: kprobe jump-optimization is enabled. All kprobes are optimized if possible.
[    0.924069] HugeTLB: allocation took 0ms with hugepage_allocation_threads=1
[    0.924797] HugeTLB: registered 1.00 GiB page size, pre-allocated 0 pages
[    0.925444] HugeTLB: 16380 KiB vmemmap can be freed for a 1.00 GiB page
[    0.926073] HugeTLB: registered 2.00 MiB page size, pre-allocated 0 pages
[    0.926714] HugeTLB: 28 KiB vmemmap can be freed for a 2.00 MiB page
[    0.951347] ACPI: Added _OSI(Module Device)
[    0.951721] ACPI: Added _OSI(Processor Device)
[    0.952089] ACPI: Added _OSI(3.0 _SCP Extensions)
[    0.952476] ACPI: Added _OSI(Processor Aggregator Device)
[    0.964699] ACPI: 1 ACPI AML tables successfully acquired and loaded
[    0.971252] ACPI: Interpreter enabled
[    0.972093] ACPI: PM: (supports S0 S3 S4 S5)
[    0.972426] ACPI: Using IOAPIC for interrupt routing
[    0.973418] PCI: Using host bridge windows from ACPI; if necessary, use "pci=nocrs" and report a bug
[    0.974264] PCI: Using E820 reservations for host bridge windows
[    0.976793] ACPI: Enabled 2 GPEs in block 00 to 0F
[    1.021154] ACPI: PCI Root Bridge [PCI0] (domain 0000 [bus 00-ff])
[    1.021753] acpi PNP0A03:00: _OSC: OS supports [ASPM ClockPM Segments MSI EDR HPX-Type3]
[    1.022447] acpi PNP0A03:00: _OSC: not requesting OS control; OS requires [ExtendedConfig ASPM ClockPM MSI]
[    1.023099] acpi PNP0A03:00: fail to add MMCONFIG information, can't access extended configuration space under this bridge
[    1.028296] acpiphp: Slot [3] registered
[    1.028789] acpiphp: Slot [4] registered
[    1.029255] acpiphp: Slot [5] registered
[    1.029736] acpiphp: Slot [6] registered
[    1.030226] acpiphp: Slot [7] registered
[    1.030692] acpiphp: Slot [8] registered
[    1.031086] acpiphp: Slot [9] registered
[    1.031570] acpiphp: Slot [10] registered
[    1.032068] acpiphp: Slot [11] registered
[    1.032547] acpiphp: Slot [12] registered
[    1.033031] acpiphp: Slot [13] registered
[    1.033579] acpiphp: Slot [14] registered
[    1.034135] acpiphp: Slot [15] registered
[    1.034669] acpiphp: Slot [16] registered
[    1.035083] acpiphp: Slot [17] registered
[    1.035559] acpiphp: Slot [18] registered
[    1.036054] acpiphp: Slot [19] registered
[    1.036522] acpiphp: Slot [20] registered
[    1.036984] acpiphp: Slot [21] registered
[    1.037456] acpiphp: Slot [22] registered
[    1.037953] acpiphp: Slot [23] registered
[    1.038420] acpiphp: Slot [24] registered
[    1.038892] acpiphp: Slot [25] registered
[    1.039095] acpiphp: Slot [26] registered
[    1.039591] acpiphp: Slot [27] registered
[    1.040055] acpiphp: Slot [28] registered
[    1.040520] acpiphp: Slot [29] registered
[    1.040992] acpiphp: Slot [30] registered
[    1.041503] acpiphp: Slot [31] registered
[    1.041916] PCI host bridge to bus 0000:00
[    1.042321] pci_bus 0000:00: root bus resource [io  0x0000-0x0cf7 window]
[    1.042901] pci_bus 0000:00: root bus resource [io  0x0d00-0xffff window]
[    1.042967] pci_bus 0000:00: root bus resource [mem 0x000a0000-0x000bffff window]
[    1.043606] pci_bus 0000:00: root bus resource [mem 0x80000000-0xfebfffff window]
[    1.044241] pci_bus 0000:00: root bus resource [mem 0x100000000-0x17fffffff window]
[    1.044901] pci_bus 0000:00: root bus resource [bus 00-ff]
[    1.045481] pci 0000:00:00.0: [8086:1237] type 00 class 0x060000 conventional PCI endpoint
[    1.054742] pci 0000:00:01.0: [8086:7000] type 00 class 0x060100 conventional PCI endpoint
[    1.056243] pci 0000:00:01.1: [8086:7010] type 00 class 0x010180 conventional PCI endpoint
[    1.057454] pci 0000:00:01.1: BAR 4 [io  0xc040-0xc04f]
[    1.057934] pci 0000:00:01.1: BAR 0 [io  0x01f0-0x01f7]: legacy IDE quirk
[    1.058508] pci 0000:00:01.1: BAR 1 [io  0x03f6]: legacy IDE quirk
[    1.058966] pci 0000:00:01.1: BAR 2 [io  0x0170-0x0177]: legacy IDE quirk
[    1.059546] pci 0000:00:01.1: BAR 3 [io  0x0376]: legacy IDE quirk
[    1.060599] pci 0000:00:01.3: [8086:7113] type 00 class 0x068000 conventional PCI endpoint
[    1.061585] pci 0000:00:01.3: quirk: [io  0x0600-0x063f] claimed by PIIX4 ACPI
[    1.062209] pci 0000:00:01.3: quirk: [io  0x0700-0x070f] claimed by PIIX4 SMB
[    1.063309] pci 0000:00:02.0: [1234:1111] type 00 class 0x030000 conventional PCI endpoint
[    1.069867] pci 0000:00:02.0: BAR 0 [mem 0xfd000000-0xfdffffff pref]
[    1.071162] pci 0000:00:02.0: BAR 2 [mem 0xfebf0000-0xfebf0fff]
[    1.074024] pci 0000:00:02.0: ROM [mem 0xfebe0000-0xfebeffff pref]
[    1.076014] pci 0000:00:02.0: Video device with shadowed ROM at [mem 0x000c0000-0x000dffff]
[    1.088240] pci 0000:00:03.0: [8086:100e] type 00 class 0x020000 conventional PCI endpoint
[    1.089977] pci 0000:00:03.0: BAR 0 [mem 0xfebc0000-0xfebdffff]
[    1.090583] pci 0000:00:03.0: BAR 1 [io  0xc000-0xc03f]
[    1.090999] pci 0000:00:03.0: ROM [mem 0xfeb80000-0xfebbffff pref]
[    1.114140] ACPI: PCI: Interrupt link LNKA configured for IRQ 10
[    1.115829] ACPI: PCI: Interrupt link LNKB configured for IRQ 10
[    1.117332] ACPI: PCI: Interrupt link LNKC configured for IRQ 11
[    1.118842] ACPI: PCI: Interrupt link LNKD configured for IRQ 11
[    1.119343] ACPI: PCI: Interrupt link LNKS configured for IRQ 9
[    1.127017] iommu: Default domain type: Translated
[    1.127516] iommu: DMA domain TLB invalidation policy: lazy mode
[    1.131339] SCSI subsystem initialized
[    1.132481] ACPI: bus type USB registered
[    1.133122] usbcore: registered new interface driver usbfs
[    1.133820] usbcore: registered new interface driver hub
[    1.134417] usbcore: registered new device driver usb
[    1.135420] pps_core: LinuxPPS API ver. 1 registered
[    1.135899] pps_core: Software ver. 5.3.6 - Copyright 2005-2007 Rodolfo Giometti <giometti@linux.it>
[    1.136770] PTP clock support registered
[    1.139343] EDAC MC: Ver: 3.0.0
[    1.150131] NetLabel: Initializing
[    1.150470] NetLabel:  domain hash size = 128
[    1.150869] NetLabel:  protocols = UNLABELED CIPSOv4 CALIPSO
[    1.151183] NetLabel:  unlabeled traffic allowed by default
[    1.152008] PCI: Using ACPI for IRQ routing
[    1.152344] pci 0000:00:02.0: vgaarb: setting as boot VGA device
[    1.152344] pci 0000:00:02.0: vgaarb: bridge control possible
[    1.152344] pci 0000:00:02.0: vgaarb: VGA device added: decodes=io+mem,owns=io+mem,locks=none
[    1.154971] vgaarb: loaded
[    1.156206] hpet0: at MMIO 0xfed00000, IRQs 2, 8, 0
[    1.156678] hpet0: 3 comparators, 64-bit 100.000000 MHz counter
[    1.162003] clocksource: Switched to clocksource kvm-clock
[    1.162957] VFS: Disk quotas dquot_6.6.0
[    1.162957] VFS: Dquot-cache hash table entries: 512 (order 0, 4096 bytes)
[    1.166388] pnp: PnP ACPI init
[    1.172953] pnp: PnP ACPI: found 6 devices
[    1.195597] clocksource: acpi_pm: mask: 0xffffff max_cycles: 0xffffff, max_idle_ns: 2085701024 ns
[    1.197045] NET: Registered PF_INET protocol family
[    1.198445] IP idents hash table entries: 32768 (order: 6, 262144 bytes, linear)
[    1.201093] tcp_listen_portaddr_hash hash table entries: 1024 (order: 4, 73728 bytes, linear)
[    1.201992] Table-perturb hash table entries: 65536 (order: 6, 262144 bytes, linear)
[    1.202774] TCP established hash table entries: 16384 (order: 5, 131072 bytes, linear)
[    1.204013] TCP bind hash table entries: 16384 (order: 9, 2359296 bytes, linear)
[    1.207011] TCP: Hash tables configured (established 16384 bind 16384)
[    1.207902] UDP hash table entries: 1024 (order: 6, 262144 bytes, linear)
[    1.208750] UDP-Lite hash table entries: 1024 (order: 6, 262144 bytes, linear)
[    1.209964] NET: Registered PF_UNIX/PF_LOCAL protocol family
[    1.211575] RPC: Registered named UNIX socket transport module.
[    1.212165] RPC: Registered udp transport module.
[    1.212606] RPC: Registered tcp transport module.
[    1.213041] RPC: Registered tcp-with-tls transport module.
[    1.213568] RPC: Registered tcp NFSv4.1 backchannel transport module.
[    1.214214] pci_bus 0000:00: resource 4 [io  0x0000-0x0cf7 window]
[    1.214801] pci_bus 0000:00: resource 5 [io  0x0d00-0xffff window]
[    1.215374] pci_bus 0000:00: resource 6 [mem 0x000a0000-0x000bffff window]
[    1.216009] pci_bus 0000:00: resource 7 [mem 0x80000000-0xfebfffff window]
[    1.216635] pci_bus 0000:00: resource 8 [mem 0x100000000-0x17fffffff window]
[    1.217643] pci 0000:00:01.0: PIIX3: Enabling Passive Release
[    1.218192] pci 0000:00:00.0: Limiting direct PCI/PCI transfers
[    1.218851] PCI: CLS 0 bytes, default 64
[    1.219419] ACPI: bus type thunderbolt registered
[    1.220310] clocksource: tsc: mask: 0xffffffffffffffff max_cycles: 0x2b2c8ec87c7, max_idle_ns: 440795278598 ns
[    3.426029] Initialise system trusted keyrings
[    3.426825] Key type blacklist registered
[    3.428281] workingset: timestamp_bits=36 max_order=19 bucket_order=0
[    3.431072] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    3.433322] NFS: Registering the id_resolver key type
[    3.433807] Key type id_resolver registered
[    3.434171] Key type id_legacy registered
[    3.434570] nfs4filelayout_init: NFSv4 File Layout Driver Registering...
[    3.435193] nfs4flexfilelayout_init: NFSv4 Flexfile Layout Driver Registering...
[    3.436157] fuse: init (API version 7.43)
[    3.437122] SGI XFS with ACLs, security attributes, realtime, quota, no debug enabled
[    3.439683] 9p: Installing v9fs 9p2000 file system support
[    3.453248] Key type asymmetric registered
[    3.453663] Asymmetric key parser 'x509' registered
[    3.454258] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 242)
[    3.455754] io scheduler mq-deadline registered
[    3.456273] io scheduler bfq registered
[    3.457261] ledtrig-cpu: registered to indicate activity on CPUs
[    3.459153] IPMI message handler: version 39.2
[    3.459659] ipmi device interface
[    3.462080] input: Power Button as /devices/LNXSYSTM:00/LNXPWRBN:00/input/input0
[    3.463264] ACPI: button: Power Button [PWRF]
[    3.465547] ERST DBG: ERST support is disabled.
[    3.467317] Serial: 8250/16550 driver, 32 ports, IRQ sharing enabled
[    3.469097] 00:04: ttyS0 at I/O 0x3f8 (irq = 4, base_baud = 115200) is a 16550A
[    3.499766] Linux agpgart interface v0.103
[    3.502715] ACPI: bus type drm_connector registered
[    3.532240] brd: module loaded
[    3.545665] loop: module loaded
[    3.556778] scsi host0: ata_piix
[    3.558357] scsi host1: ata_piix
[    3.559119] ata1: PATA max MWDMA2 cmd 0x1f0 ctl 0x3f6 bmdma 0xc040 irq 14 lpm-pol 0
[    3.559793] ata2: PATA max MWDMA2 cmd 0x170 ctl 0x376 bmdma 0xc048 irq 15 lpm-pol 0
[    3.561494] Callback from call_rcu_tasks() invoked.
[    3.564117] tun: Universal TUN/TAP device driver, 1.6
[    3.565080] e100: Intel(R) PRO/100 Network Driver
[    3.565575] e100: Copyright(c) 1999-2006 Intel Corporation
[    3.566198] e1000: Intel(R) PRO/1000 Network Driver
[    3.566639] e1000: Copyright (c) 1999-2006 Intel Corporation.
[    3.713555] ata1: found unknown device (class 0)
[    3.715010] ata1.00: ATA-7: QEMU HARDDISK, 2.5+, max UDMA/100
[    3.715805] ata1.00: 17196647 sectors, multi 16: LBA48 
[    3.717490] ata2: found unknown device (class 0)
[    3.718387] scsi 0:0:0:0: Direct-Access     ATA      QEMU HARDDISK    2.5+ PQ: 0 ANSI: 5
[    3.718862] ata2.00: ATAPI: QEMU DVD-ROM, 2.5+, max UDMA/100
[    3.728603] sd 0:0:0:0: Attached scsi generic sg0 type 0
[    3.731178] sd 0:0:0:0: [sda] 17196647 512-byte logical blocks: (8.80 GB/8.20 GiB)
[    3.732020] sd 0:0:0:0: [sda] Write Protect is off
[    3.733115] sd 0:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA
[    3.734779] scsi 1:0:0:0: CD-ROM            QEMU     QEMU DVD-ROM     2.5+ PQ: 0 ANSI: 5
[    3.735929] sd 0:0:0:0: [sda] Preferred minimum I/O size 512 bytes
[    3.757775] sd 0:0:0:0: [sda] Attached SCSI disk
[    3.766388] scsi 1:0:0:0: Attached scsi generic sg1 type 5
[    4.257613] ACPI: \_SB_.LNKC: Enabled at IRQ 11
[    4.573636] e1000 0000:00:03.0 eth0: (PCI:33MHz:32-bit) 52:54:00:12:34:56
[    4.574278] e1000 0000:00:03.0 eth0: Intel(R) PRO/1000 Network Connection
[    4.574997] e1000e: Intel(R) PRO/1000 Network Driver
[    4.575428] e1000e: Copyright(c) 1999 - 2015 Intel Corporation.
[    4.576034] igb: Intel(R) Gigabit Ethernet Network Driver
[    4.576494] igb: Copyright (c) 2007-2014 Intel Corporation.
[    4.577734] PPP generic driver version 2.4.2
[    4.579816] VFIO - User Level meta-driver version: 0.3
[    4.582242] usbcore: registered new interface driver uas
[    4.582798] usbcore: registered new interface driver usb-storage
[    4.583656] i8042: PNP: PS/2 Controller [PNP0303:KBD,PNP0f13:MOU] at 0x60,0x64 irq 1,12
[    4.585289] serio: i8042 KBD port at 0x60,0x64 irq 1
[    4.585823] serio: i8042 AUX port at 0x60,0x64 irq 12
[    4.587535] mousedev: PS/2 mouse device common for all mice
[    4.589308] rtc_cmos 00:05: RTC can wake from S4
[    4.590365] input: AT Translated Set 2 keyboard as /devices/platform/i8042/serio0/input/input1
[    4.593631] input: VirtualPS/2 VMware VMMouse as /devices/platform/i8042/serio1/input/input4
[    4.593749] rtc_cmos 00:05: registered as rtc0
[    4.595408] rtc_cmos 00:05: setting system clock to 2025-03-27T11:06:48 UTC (1743073608)
[    4.595615] input: VirtualPS/2 VMware VMMouse as /devices/platform/i8042/serio1/input/input3
[    4.598123] rtc_cmos 00:05: alarms up to one day, y3k, 242 bytes nvram, hpet irqs
[    4.599342] i2c_dev: i2c /dev entries driver
[    4.600096] device-mapper: core: CONFIG_IMA_DISABLE_HTABLE is disabled. Duplicate IMA measurements will not be recorded in the IMA log.
[    4.601761] device-mapper: uevent: version 1.0.3
[    4.602902] device-mapper: ioctl: 4.49.0-ioctl (2025-01-17) initialised: dm-devel@lists.linux.dev
[    4.603969] intel_pstate: CPU model not supported
[    4.604834] sdhci: Secure Digital Host Controller Interface driver
[    4.605588] sdhci: Copyright(c) Pierre Ossman
[    4.606291] sdhci-pltfm: SDHCI platform and OF driver helper
[    4.607645] drop_monitor: Initializing network drop monitor service
[    4.608904] NET: Registered PF_INET6 protocol family
[    4.613706] Segment Routing with IPv6
[    4.614239] In-situ OAM (IOAM) with IPv6
[    4.614818] NET: Registered PF_PACKET protocol family
[    4.615728] 9pnet: Installing 9P2000 support
[    4.616226] Key type dns_resolver registered
[    4.618417] IPI shorthand broadcast: enabled
[    4.672154] sched_clock: Marking stable (4652006785, 17325731)->(4725797258, -56464742)
[    4.674266] registered taskstats version 1
[    4.675307] Loading compiled-in X.509 certificates
[    4.744162] Demotion targets for Node 0: null
[    4.747417] Key type .fscrypt registered
[    4.749443] Key type fscrypt-provisioning registered
[    4.755601] Key type encrypted registered
[    4.756048] ima: No TPM chip found, activating TPM-bypass!
[    4.756547] ima: Allocated hash algorithm: sha1
[    4.757020] ima: No architecture policies found
[    4.757632] evm: Initialising EVM extended attributes:
[    4.758083] evm: security.selinux
[    4.758379] evm: security.SMACK64
[    4.758675] evm: security.SMACK64EXEC
[    4.759007] evm: security.SMACK64TRANSMUTE
[    4.759369] evm: security.SMACK64MMAP
[    4.759695] evm: security.apparmor
[    4.759998] evm: security.ima
[    4.760263] evm: security.capability
[    4.760579] evm: HMAC attrs: 0x1
[    4.763066] PM:   Magic number: 1:242:126
[    4.763565] acpi device:01: hash matches
[    4.765103] RAS: Correctable Errors collector initialized.
[    4.767380] clk: Disabling unused clocks
[    4.768629] PM: genpd: Disabling unused power domains
[    4.770488] md: Waiting for all devices to be available before autodetect
[    4.771221] md: If you don't use raid, use raid=noautodetect
[    4.771771] md: Autodetecting RAID arrays.
[    4.772173] md: autorun ...
[    4.772444] md: ... autorun DONE.
[    4.781984] EXT4-fs (sda): mounted filesystem 088740a9-c8b4-422c-999d-a804eb68a4da ro with ordered data mode. Quota mode: none.
[    4.783195] VFS: Mounted root (ext4 filesystem) readonly on device 8:0.
[    4.786137] devtmpfs: mounted
[    4.815023] Freeing unused decrypted memory: 2028K
[    4.826393] Freeing unused kernel image (initmem) memory: 15976K
[    4.827155] Write protecting the kernel read-only data: 98304k
[    4.830735] Freeing unused kernel image (text/rodata gap) memory: 1344K
[    4.831671] Freeing unused kernel image (rodata/data gap) memory: 200K
[    4.912941] x86/mm: Checked W+X mappings: passed, no W+X pages found.
[    4.913556] Run /sbin/init as init process
[    5.080775] systemd[1]: systemd 252-15.el9 running in system mode (+PAM +AUDIT +SELINUX -APPARMOR +IMA +SMACK +SECCOMP +GCRYPT +GNUTLS +OPENSSL +ACL +BLKID +CURL +ELFUTILS -FIDO2 +IDN2 -IDN -IPTC +KMOD +LIBCRYPTSETUP +LIBFDISK +PCRE2 -PWQUALITY +P11KIT -QRENCODE +TPM2 +BZIP2 +LZ4 +XZ +ZLIB +ZSTD -BPF_FRAMEWORK +XKBCOMMON +UTMP +SYSVINIT default-hierarchy=unified)
[    5.083446] systemd[1]: Detected virtualization kvm.
[    5.083813] systemd[1]: Detected architecture x86-64.

Welcome to [0;31mCentOS Stream 9[0m!

[    5.092052] systemd[1]: Hostname set to <test>.
[    5.349636] systemd-rc-local-generator[123]: /etc/rc.d/rc.local is not marked executable, skipping.
[    5.768979] systemd[1]: Queued start job for default target Multi-User System.
[    5.817438] systemd[1]: Created slice Virtual Machine and Container Slice.
[[0;32m  OK  [0m] Created slice [0;1;39mVirtual Machine and Container Slice[0m.
[    5.824026] systemd[1]: Created slice Slice /system/getty.
[[0;32m  OK  [0m] Created slice [0;1;39mSlice /system/getty[0m.
[    5.827731] systemd[1]: Created slice Slice /system/modprobe.
[[0;32m  OK  [0m] Created slice [0;1;39mSlice /system/modprobe[0m.
[    5.831428] systemd[1]: Created slice Slice /system/serial-getty.
[[0;32m  OK  [0m] Created slice [0;1;39mSlice /system/serial-getty[0m.
[    5.835076] systemd[1]: Created slice Slice /system/sshd-keygen.
[[0;32m  OK  [0m] Created slice [0;1;39mSlice /system/sshd-keygen[0m.
[    5.838543] systemd[1]: Created slice User and Session Slice.
[[0;32m  OK  [0m] Created slice [0;1;39mUser and Session Slice[0m.
[    5.840409] systemd[1]: Started Forward Password Requests to Wall Directory Watch.
[[0;32m  OK  [0m] Started [0;1;39mForward Password Râ€¦uests to Wall Directory Watch[0m.
[    5.843227] systemd[1]: Set up automount Arbitrary Executable File Formats File System Automount Point.
[[0;32m  OK  [0m] Set up automount [0;1;39mArbitraryâ€¦s File System Automount Point[0m.
[    5.845028] systemd[1]: Reached target Local Integrity Protected Volumes.
[[0;32m  OK  [0m] Reached target [0;1;39mLocal Integrity Protected Volumes[0m.
[    5.846666] systemd[1]: Reached target Slice Units.
[[0;32m  OK  [0m] Reached target [0;1;39mSlice Units[0m.
[    5.847819] systemd[1]: Reached target Swaps.
[[0;32m  OK  [0m] Reached target [0;1;39mSwaps[0m.
[    5.848899] systemd[1]: Reached target Local Verity Protected Volumes.
[[0;32m  OK  [0m] Reached target [0;1;39mLocal Verity Protected Volumes[0m.
[    5.850774] systemd[1]: Listening on Device-mapper event daemon FIFOs.
[[0;32m  OK  [0m] Listening on [0;1;39mDevice-mapper event daemon FIFOs[0m.
[    5.852975] systemd[1]: Listening on LVM2 poll daemon socket.
[[0;32m  OK  [0m] Listening on [0;1;39mLVM2 poll daemon socket[0m.
[    5.854582] systemd[1]: multipathd control socket was skipped because of an unmet condition check (ConditionPathExists=/etc/multipath.conf).
[    5.907573] systemd[1]: Listening on RPCbind Server Activation Socket.
[[0;32m  OK  [0m] Listening on [0;1;39mRPCbind Server Activation Socket[0m.
[    5.909105] systemd[1]: Reached target RPC Port Mapper.
[[0;32m  OK  [0m] Reached target [0;1;39mRPC Port Mapper[0m.
[    5.913207] systemd[1]: Listening on Process Core Dump Socket.
[[0;32m  OK  [0m] Listening on [0;1;39mProcess Core Dump Socket[0m.
[    5.916581] systemd[1]: Listening on initctl Compatibility Named Pipe.
[[0;32m  OK  [0m] Listening on [0;1;39minitctl Compatibility Named Pipe[0m.
[    5.923603] systemd[1]: Listening on Journal Socket (/dev/log).
[[0;32m  OK  [0m] Listening on [0;1;39mJournal Socket (/dev/log)[0m.
[    5.927664] systemd[1]: Listening on Journal Socket.
[[0;32m  OK  [0m] Listening on [0;1;39mJournal Socket[0m.
[    5.931546] systemd[1]: Listening on udev Control Socket.
[[0;32m  OK  [0m] Listening on [0;1;39mudev Control Socket[0m.
[    5.934036] systemd[1]: Listening on udev Kernel Socket.
[[0;32m  OK  [0m] Listening on [0;1;39mudev Kernel Socket[0m.
[    5.967026] systemd[1]: Mounting Huge Pages File System...
         Mounting [0;1;39mHuge Pages File System[0m...
[    5.987158] systemd[1]: Mounting POSIX Message Queue File System...
         Mounting [0;1;39mPOSIX Message Queue File System[0m...
[    5.999635] systemd[1]: Mounting Kernel Debug File System...
         Mounting [0;1;39mKernel Debug File System[0m...
[    6.011428] systemd[1]: Mounting Kernel Trace File System...
         Mounting [0;1;39mKernel Trace File System[0m...
[    6.013871] systemd[1]: Kernel Module supporting RPCSEC_GSS was skipped because of an unmet condition check (ConditionPathExists=/etc/krb5.keytab).
[    6.015044] systemd[1]: Create List of Static Device Nodes was skipped because of an unmet condition check (ConditionFileNotEmpty=/lib/modules/6.14.0-next-20250325-eb4bc4b07f66/modules.devname).
[    6.024507] systemd[1]: Starting Monitoring of LVM2 mirrors, snapshots etc. using dmeventd or progress polling...
         Starting [0;1;39mMonitoring of LVMâ€¦meventd or progress polling[0m...
[    6.037135] systemd[1]: Starting Load Kernel Module configfs...
         Starting [0;1;39mLoad Kernel Module configfs[0m...
[    6.057017] systemd[1]: Starting Load Kernel Module drm...
         Starting [0;1;39mLoad Kernel Module drm[0m...
[    6.090432] systemd[1]: Starting Load Kernel Module fuse...
         Starting [0;1;39mLoad Kernel Module fuse[0m...
[    6.103938] systemd[1]: Starting Read and set NIS domainname from /etc/sysconfig/network...
         Starting [0;1;39mRead and set NIS â€¦from /etc/sysconfig/network[0m...
[    6.150473] systemd[1]: Starting Journal Service...
         Starting [0;1;39mJournal Service[0m...
[    6.199538] systemd[1]: Starting Load Kernel Modules...
         Starting [0;1;39mLoad Kernel Modules[0m...
[    6.220666] systemd[1]: Starting Generate network units from Kernel command line...
         Starting [0;1;39mGenerate network â€¦ts from Kernel command line[0m...
[    6.238545] systemd[1]: Starting Remount Root and Kernel File Systems...
         Starting [0;1;39mRemount Root and Kernel File Systems[0m...
[    6.240401] systemd[1]: Repartition Root Disk was skipped because no trigger condition checks were met.
[    6.278893] systemd[1]: Starting Coldplug All udev Devices...
         Starting [0;1;39mColdplug All udev Devices[0m...
[    6.303813] systemd[1]: Mounted Huge Pages File System.
[[0;32m  OK  [0m] Mounted [0;1;39mHuge Pages File System[0m.
[    6.310111] systemd[1]: Mounted POSIX Message Queue File System.
[[0;32m  OK  [0m] Mounted [0;1;39mPOSIX Message Queue File System[0m.
[    6.314891] systemd[1]: Mounted Kernel Debug File System.
[[0;32m  OK  [0m] Mounted [0;1;39mKernel Debug File System[0m.
[    6.318022] systemd[1]: Mounted Kernel Trace File System.
[[0;32m  OK  [0m] Mounted [0;1;39mKernel Trace File System[0m.
[    6.327243] systemd[1]: Finished Monitoring of LVM2 mirrors, snapshots etc. using dmeventd or progress polling.
[[0;32m  OK  [0m] Finished [0;1;39mMonitoring of LVMâ€¦ dmeventd or progress polling[0m.
[    6.335750] systemd[1]: modprobe@configfs.service: Deactivated successfully.
[    6.341805] systemd[1]: Finished Load Kernel Module configfs.
[[0;32m  OK  [0m] Finished [0;1;39mLoad Kernel Module configfs[0m.
[    6.346175] systemd[1]: modprobe@drm.service: Deactivated successfully.
[    6.347914] systemd[1]: Finished Load Kernel Module drm.
[[0;32m  OK  [0m] Finished [0;1;39mLoad Kernel Module drm[0m.
[    6.354354] systemd[1]: modprobe@fuse.service: Deactivated successfully.
[    6.356168] systemd[1]: Finished Load Kernel Module fuse.
[[0;32m  OK  [0m] Finished [0;1;39mLoad Kernel Module fuse[0m.
[    6.360460] EXT4-fs (sda): re-mounted 088740a9-c8b4-422c-999d-a804eb68a4da r/w.
[    6.362125] systemd[1]: Finished Read and set NIS domainname from /etc/sysconfig/network.
[[0;32m  OK  [0m] Finished [0;1;39mRead and set NIS â€¦e from /etc/sysconfig/network[0m.
[    6.372168] systemd[1]: systemd-modules-load.service: Main process exited, code=exited, status=1/FAILURE
[    6.375793] systemd[1]: systemd-modules-load.service: Failed with result 'exit-code'.
[    6.377769] systemd[1]: Failed to start Load Kernel Modules.
[[0;1;31mFAILED[0m] Failed to start [0;1;39mLoad Kernel Modules[0m.
See 'systemctl status systemd-modules-load.service' for details.
[    6.382348] systemd[1]: Finished Generate network units from Kernel command line.
[[0;32m  OK  [0m] Finished [0;1;39mGenerate network units from Kernel command line[0m.
[    6.385660] systemd[1]: Finished Remount Root and Kernel File Systems.
[[0;32m  OK  [0m] Finished [0;1;39mRemount Root and Kernel File Systems[0m.
[    6.387472] systemd[1]: Started Journal Service.
[[0;32m  OK  [0m] Started [0;1;39mJournal Service[0m.
[[0;32m  OK  [0m] Reached target [0;1;39mPreparation for Network[0m.
         Mounting [0;1;39mFUSE Control File System[0m...
         Mounting [0;1;39mKernel Configuration File System[0m...
         Starting [0;1;39mFlush Journal to Persistent Storage[0m...
         Starting [0;1;39mLoad/Save Random Seed[0m...
         Starting [0;1;39mApply Kernel Variables[0m...
         Starting [0;1;39mCreate Static Device Nodes in /dev[0m...
         Starting [0;1;39mSetup Virtual Console[0m...
[    6.547692] systemd-journald[145]: Received client request to flush runtime journal.
[[0;32m  OK  [0m] Mounted [0;1;39mFUSE Control File System[0m.
[[0;32m  OK  [0m] Mounted [0;1;39mKernel Configuration File System[0m.
[[0;32m  OK  [0m] Finished [0;1;39mFlush Journal to Persistent Storage[0m.
[[0;32m  OK  [0m] Finished [0;1;39mLoad/Save Random Seed[0m.
[[0;32m  OK  [0m] Finished [0;1;39mApply Kernel Variables[0m.
[[0;32m  OK  [0m] Finished [0;1;39mCreate Static Device Nodes in /dev[0m.
         Starting [0;1;39mRule-based Manageâ€¦for Device Events and Files[0m...
[[0;32m  OK  [0m] Started [0;1;39mRule-based Manager for Device Events and Files[0m.
         Starting [0;1;39mAuto-connect to sâ€¦E devices found during boot[0m...
[[0;32m  OK  [0m] Finished [0;1;39mAuto-connect to sâ€¦VME devices found during boot[0m.
[[0;32m  OK  [0m] Finished [0;1;39mSetup Virtual Console[0m.
[[0;32m  OK  [0m] Finished [0;1;39mColdplug All udev Devices[0m.
[[0;32m  OK  [0m] Started [0;1;39mDispatch Password â€¦ts to Console Directory Watch[0m.
[[0;32m  OK  [0m] Reached target [0;1;39mLocal Encrypted Volumes[0m.
[[0;32m  OK  [0m] Reached target [0;1;39mPath Units[0m.
         Starting [0;1;39mWait for udev To â€¦plete Device Initialization[0m...
[[0;32m  OK  [0m] Found device [0;1;39m/dev/ttyS0[0m.
[[0;32m  OK  [0m] Listening on [0;1;39mLoad/Save RF â€¦itch Status /dev/rfkill Watch[0m.
[[0;32m  OK  [0m] Finished [0;1;39mWait for udev To Complete Device Initialization[0m.
[[0;32m  OK  [0m] Reached target [0;1;39mPreparation for Local File Systems[0m.
[[0;32m  OK  [0m] Reached target [0;1;39mLocal File Systems[0m.
         Starting [0;1;39mTell Plymouth To Write Out Runtime Data[0m...
         Starting [0;1;39mAutomatic Boot Loader Update[0m...
         Starting [0;1;39mCreate Volatile Files and Directories[0m...
[[0;32m  OK  [0m] Finished [0;1;39mTell Plymouth To Write Out Runtime Data[0m.
[[0;32m  OK  [0m] Finished [0;1;39mAutomatic Boot Loader Update[0m.
[[0;32m  OK  [0m] Finished [0;1;39mCreate Volatile Files and Directories[0m.
         Mounting [0;1;39mRPC Pipe File System[0m...
         Starting [0;1;39mSecurity Auditing Service[0m...
         Starting [0;1;39mRPC Bind[0m...
[[0;32m  OK  [0m] Mounted [0;1;39mRPC Pipe File System[0m.
[[0;32m  OK  [0m] Reached target [0;1;39mrpc_pipefs.target[0m.
[[0;32m  OK  [0m] Started [0;1;39mRPC Bind[0m.
[[0;32m  OK  [0m] Started [0;1;39mSecurity Auditing Service[0m.
         Starting [0;1;39mRecord System Boot/Shutdown in UTMP[0m...
[[0;32m  OK  [0m] Finished [0;1;39mRecord System Boot/Shutdown in UTMP[0m.
[[0;32m  OK  [0m] Reached target [0;1;39mSystem Initialization[0m.
[[0;32m  OK  [0m] Started [0;1;39mDaily rotation of log files[0m.
[[0;32m  OK  [0m] Started [0;1;39mUpdates mlocate database every day[0m.
[[0;32m  OK  [0m] Started [0;1;39mDaily Cleanup of Temporary Directories[0m.
[[0;32m  OK  [0m] Started [0;1;39mdaily update of the root trust anchor for DNSSEC[0m.
[[0;32m  OK  [0m] Reached target [0;1;39mTimer Units[0m.
[[0;32m  OK  [0m] Listening on [0;1;39mD-Bus System Message Bus Socket[0m.
[[0;32m  OK  [0m] Listening on [0;1;39mOpen-iSCSI iscsid Socket[0m.
[[0;32m  OK  [0m] Listening on [0;1;39mOpen-iSCSI iscsiuio Socket[0m.
[[0;32m  OK  [0m] Listening on [0;1;39mSSSD Kerberosâ€¦ache Manager responder socket[0m.
[[0;32m  OK  [0m] Listening on [0;1;39mLibvirt interface local socket[0m.
[[0;32m  OK  [0m] Listening on [0;1;39mVirtual machine lock manager socket[0m.
[[0;32m  OK  [0m] Listening on [0;1;39mVirtual machine log manager socket[0m.
[[0;32m  OK  [0m] Listening on [0;1;39mLibvirt network local socket[0m.
[[0;32m  OK  [0m] Listening on [0;1;39mLibvirt nodedev local socket[0m.
[[0;32m  OK  [0m] Listening on [0;1;39mLibvirt nwfilter local socket[0m.
[[0;32m  OK  [0m] Listening on [0;1;39mLibvirt proxy local socket[0m.
[[0;32m  OK  [0m] Listening on [0;1;39mLibvirt qemu local socket[0m.
[[0;32m  OK  [0m] Listening on [0;1;39mLibvirt qemu admin socket[0m.
[[0;32m  OK  [0m] Listening on [0;1;39mLibvirt qemu local read-only socket[0m.
[[0;32m  OK  [0m] Listening on [0;1;39mLibvirt secret local socket[0m.
[[0;32m  OK  [0m] Listening on [0;1;39mLibvirt storage local socket[0m.
[[0;32m  OK  [0m] Reached target [0;1;39mSocket Units[0m.
         Starting [0;1;39mD-Bus System Message Bus[0m...
[[0;32m  OK  [0m] Started [0;1;39mD-Bus System Message Bus[0m.
[[0;32m  OK  [0m] Reached target [0;1;39mBasic System[0m.
         Starting [0;1;39mNetwork Manager[0m...
         Starting [0;1;39mNTP client/server[0m...
         Starting [0;1;39mRestore /run/initramfs on shutdown[0m...
[[0;32m  OK  [0m] Started [0;1;39mirqbalance daemon[0m.
[[0;32m  OK  [0m] Started [0;1;39mlibstoragemgmt plug-in server daemon[0m.
[[0;32m  OK  [0m] Started [0;1;39mMachine Check Exception Logging Daemon[0m.
[[0;32m  OK  [0m] Reached target [0;1;39msshd-keygen.target[0m.
[[0;32m  OK  [0m] Reached target [0;1;39mUser and Group Name Lookups[0m.
         Starting [0;1;39mUser Login Management[0m...
         Starting [0;1;39mVirtual Machine aâ€¦tainer Registration Service[0m...
         Starting [0;1;39mupdate of the rooâ€¦NSSEC validation in unbound[0m...
         Starting [0;1;39mRotate log files[0m...
[[0;32m  OK  [0m] Started [0;1;39mUpdate a database for mlocate[0m.
[[0;32m  OK  [0m] Finished [0;1;39mRestore /run/initramfs on shutdown[0m.
[[0;32m  OK  [0m] Started [0;1;39mVirtual Machine anâ€¦ontainer Registration Service[0m.
[[0;32m  OK  [0m] Started [0;1;39mNTP client/server[0m.
         Starting [0;1;39mHostname Service[0m...
[[0;32m  OK  [0m] Finished [0;1;39mupdate of the rooâ€¦ DNSSEC validation in unbound[0m.
[[0;32m  OK  [0m] Started [0;1;39mUser Login Management[0m.
[[0;32m  OK  [0m] Started [0;1;39mHostname Service[0m.
         Starting [0;1;39mNetwork Manager Script Dispatcher Service[0m...
[[0;32m  OK  [0m] Finished [0;1;39mRotate log files[0m.
[[0;32m  OK  [0m] Started [0;1;39mNetwork Manager Script Dispatcher Service[0m.
[   11.341967] e1000: eth0 NIC Link is Up 1000 Mbps Full Duplex, Flow Control: RX
[[0;32m  OK  [0m] Started [0;1;39mNetwork Manager[0m.
[[0;32m  OK  [0m] Reached target [0;1;39mNetwork[0m.
[[0;32m  OK  [0m] Reached target [0;1;39mNetwork is Online[0m.
         Starting [0;1;39mGSSAPI Proxy Daemon[0m...
         Starting [0;1;39mNotify NFS peers of a restart[0m...
         Starting [0;1;39mSystem Logging Service[0m...
         Starting [0;1;39mOpenSSH server daemon[0m...
         Starting [0;1;39mDynamic System Tuning Daemon[0m...
[[0;32m  OK  [0m] Started [0;1;39mGSSAPI Proxy Daemon[0m.
[[0;32m  OK  [0m] Started [0;1;39mNotify NFS peers of a restart[0m.
[[0;32m  OK  [0m] Reached target [0;1;39mNFS client services[0m.
[[0;32m  OK  [0m] Reached target [0;1;39mPreparation for Remote File Systems[0m.
[[0;32m  OK  [0m] Reached target [0;1;39mRemote File Systems[0m.
         Starting [0;1;39mPermit User Sessions[0m...
         Starting [0;1;39mVirtualization qemu daemon[0m...
[[0;32m  OK  [0m] Started [0;1;39mOpenSSH server daemon[0m.
[[0;32m  OK  [0m] Finished [0;1;39mPermit User Sessions[0m.
[[0;32m  OK  [0m] Started [0;1;39mDeferred execution scheduler[0m.
[[0;32m  OK  [0m] Started [0;1;39mCommand Scheduler[0m.
         Starting [0;1;39mHold until boot process finishes up[0m...
         Starting [0;1;39mTerminate Plymouth Boot Screen[0m...
[[0;32m  OK  [0m] Started [0;1;39mSystem Logging Service[0m.
[[0;32m  OK  [0m] Started [0;1;39mVirtualization qemu daemon[0m.
[[0;32m  OK  [0m] Finished [0;1;39mHold until boot process finishes up[0m.
[[0;32m  OK  [0m] Started [0;1;39mGetty on tty1[0m.
[[0;32m  OK  [0m] Started [0;1;39mSerial Getty on ttyS0[0m.
[[0;32m  OK  [0m] Reached target [0;1;39mLogin Prompts[0m.
[[0;32m  OK  [0m] Finished [0;1;39mTerminate Plymouth Boot Screen[0m.
         Starting [0;1;39mAuthorization Manager[0m...
[[0;32m  OK  [0m] Started [0;1;39mAuthorization Manager[0m.
[[0;32m  OK  [0m] Started [0;1;39mDynamic System Tuning Daemon[0m.
[[0;32m  OK  [0m] Reached target [0;1;39mMulti-User System[0m.
         Starting [0;1;39mRecord Runlevel Change in UTMP[0m...
[[0;32m  OK  [0m] Finished [0;1;39mRecord Runlevel Change in UTMP[0m.

CentOS Stream 9
Kernel 6.14.0-next-20250325-eb4bc4b07f66 on an x86_64

Activate the web console with: systemctl enable --now cockpit.socket

test login: [   22.162876] iommufd_mock iommufd_mock0: Adding to iommu group 0
[   22.164519] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#1] SMP KASAN NOPTI
[   22.165861] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   22.166769] CPU: 0 UID: 0 PID: 727 Comm: repro Not tainted 6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.167974] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.169286] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.170012] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.172147] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   22.172778] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   22.173623] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   22.174455] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   22.175273] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   22.175747] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   22.176215] FS:  00007f1bc230f600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.176744] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.177127] CR2: 00000000200006c0 CR3: 00000000215c2005 CR4: 0000000000770ef0
[   22.177600] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.178066] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.178537] PKRU: 55555554
[   22.178733] Call Trace:
[   22.178906]  <TASK>
[   22.179066]  ? show_regs+0x6d/0x80
[   22.179323]  ? die_addr+0x45/0xb0
[   22.179561]  ? exc_general_protection+0x1ad/0x340
[   22.179917]  ? asm_exc_general_protection+0x2b/0x30
[   22.180260]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.180608]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   22.180959]  iommufd_device_detach+0x2a/0x2e0
[   22.181268]  iommufd_test+0x2f99/0x5cd0
[   22.181543]  ? __pfx_iommufd_test+0x10/0x10
[   22.181832]  ? __might_fault+0x14a/0x1b0
[   22.182116]  ? __this_cpu_preempt_check+0x21/0x30
[   22.182447]  ? lock_release+0x14f/0x2c0
[   22.182727]  ? __might_fault+0xf1/0x1b0
[   22.182997]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   22.183367]  iommufd_fops_ioctl+0x38e/0x520
[   22.183659]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.183982]  ? __this_cpu_preempt_check+0x21/0x30
[   22.184305]  ? seqcount_lockdep_reader_access.constprop.0+0xb4/0xd0
[   22.184735]  ? lockdep_hardirqs_on+0x89/0x110
[   22.185044]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.185391]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.185719]  __x64_sys_ioctl+0x1ba/0x220
[   22.186006]  x64_sys_call+0x122e/0x2150
[   22.186272]  do_syscall_64+0x6d/0x150
[   22.186530]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   22.186875] RIP: 0033:0x7f1bc203ee5d
[   22.187133] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   22.188345] RSP: 002b:00007ffd2bb987b8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.188850] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f1bc203ee5d
[   22.189321] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.189792] RBP: 00007ffd2bb987d0 R08: 0000000000000800 R09: 0000000000000800
[   22.190265] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd2bb988e8
[   22.190744] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f1bc2358000
[   22.191223]  </TASK>
[   22.191383] Modules linked in:
[   22.191674] ---[ end trace 0000000000000000 ]---
[   22.191993] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.192378] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.193672] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   22.194049] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   22.194534] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   22.195024] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   22.195539] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   22.196014] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   22.196519] FS:  00007f1bc230f600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.197087] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.197511] CR2: 00000000200006c0 CR3: 00000000215c2005 CR4: 0000000000770ef0
[   22.198019] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.198530] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.199021] PKRU: 55555554
[   22.199809] ------------[ cut here ]------------
[   22.200146] WARNING: CPU: 0 PID: 727 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   22.200804] Modules linked in:
[   22.201033] CPU: 0 UID: 0 PID: 727 Comm: repro Tainted: G      D             6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.201871] Tainted: [D]=DIE
[   22.202085] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.202850] RIP: 0010:iommufd_fops_release+0x386/0x420
[   22.203221] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   22.204459] RSP: 0018:ffff8880172cfc08 EFLAGS: 00010293
[   22.204826] RAX: 0000000000000000 RBX: ffff88801ff74008 RCX: ffffffff83afe4ca
[   22.205314] RDX: ffff88801f98ca80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   22.205816] RBP: ffff8880172cfcb8 R08: 0000000000000000 R09: 0000000000000000
[   22.206311] R10: 0000000000000000 R11: ffff888021e10fd0 R12: 0000000000000000
[   22.206796] R13: 0000000000000000 R14: ffff8880172cfc50 R15: 0000000000000000
[   22.207285] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.207835] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.208235] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   22.208725] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.209214] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.209722] PKRU: 55555554
[   22.209923] Call Trace:
[   22.210102]  <TASK>
[   22.210262]  ? show_regs+0x6d/0x80
[   22.210511]  ? __warn+0xf3/0x380
[   22.210762]  ? report_bug+0x25e/0x4b0
[   22.211031]  ? iommufd_fops_release+0x386/0x420
[   22.211357]  ? report_bug+0x2cb/0x4b0
[   22.211624]  ? iommufd_fops_release+0x386/0x420
[   22.211947]  ? iommufd_fops_release+0x386/0x420
[   22.212267]  ? handle_bug+0x2cd/0x510
[   22.212534]  ? iommufd_fops_release+0x388/0x420
[   22.212859]  ? exc_invalid_op+0x3c/0x80
[   22.213138]  ? asm_exc_invalid_op+0x1f/0x30
[   22.213454]  ? iommufd_fops_release+0x21a/0x420
[   22.213781]  ? iommufd_fops_release+0x386/0x420
[   22.214103]  ? iommufd_fops_release+0x386/0x420
[   22.214437]  ? iommufd_fops_release+0x386/0x420
[   22.214767]  ? locks_remove_file+0x3b4/0x5d0
[   22.215094]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.215446]  ? __memcg_slab_free_hook+0xc1/0x540
[   22.215792]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   22.216179]  ? evm_file_release+0x141/0x220
[   22.216496]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.216848]  __fput+0x41c/0xb70
[   22.217093]  ____fput+0x22/0x30
[   22.217355]  task_work_run+0x19b/0x2b0
[   22.217643]  ? __pfx_task_work_run+0x10/0x10
[   22.217961]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   22.218353]  ? switch_task_namespaces+0xc6/0x110
[   22.218699]  do_exit+0xb0e/0x29d0
[   22.218959]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.219321]  ? __pfx_do_exit+0x10/0x10
[   22.219600]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.219940]  ? __x64_sys_ioctl+0x1ba/0x220
[   22.220244]  make_task_dead+0x181/0x3c0
[   22.220528]  rewind_stack_and_make_dead+0x16/0x20
[   22.220868] RIP: 0033:0x7f1bc203ee5d
[   22.221134] Code: Unable to access opcode bytes at 0x7f1bc203ee33.
[   22.221605] RSP: 002b:00007ffd2bb987b8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.222138] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f1bc203ee5d
[   22.222628] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.223126] RBP: 00007ffd2bb987d0 R08: 0000000000000800 R09: 0000000000000800
[   22.223622] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd2bb988e8
[   22.224119] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f1bc2358000
[   22.224626]  </TASK>
[   22.224795] irq event stamp: 3151
[   22.225037] hardirqs last  enabled at (3151): [<ffffffff812e194b>] cond_local_irq_enable.isra.0+0x3b/0x50
[   22.225728] hardirqs last disabled at (3150): [<ffffffff85c6ecc6>] exc_general_protection+0x36/0x340
[   22.226369] softirqs last  enabled at (2862): [<ffffffff8149141e>] __irq_exit_rcu+0x10e/0x170
[   22.226965] softirqs last disabled at (2787): [<ffffffff8149141e>] __irq_exit_rcu+0x10e/0x170
[   22.227553] ---[ end trace 0000000000000000 ]---
[   22.227929] ------------[ cut here ]------------
[   22.228254] WARNING: CPU: 0 PID: 727 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   22.228912] Modules linked in:
[   22.229144] CPU: 0 UID: 0 PID: 727 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.229980] Tainted: [D]=DIE, [W]=WARN
[   22.230250] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.231034] RIP: 0010:iommufd_fops_release+0x392/0x420
[   22.231408] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   22.232658] RSP: 0018:ffff8880172cfc08 EFLAGS: 00010293
[   22.233030] RAX: 0000000000000000 RBX: ffff88801ff74008 RCX: ffffffff83afe4ca
[   22.233538] RDX: ffff88801f98ca80 RSI: ffffffff83afe642 RDI: ffff88801ff740a0
[   22.234032] RBP: ffff8880172cfcb8 R08: 0000000000000000 R09: 0000000000000000
[   22.234520] R10: 0000000000000000 R11: ffff888021e10fd0 R12: 0000000000000000
[   22.235020] R13: 0000000000000000 R14: ffff8880172cfc50 R15: 0000000000000000
[   22.235510] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.236061] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.236464] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   22.236956] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.237465] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.237952] PKRU: 55555554
[   22.238153] Call Trace:
[   22.238335]  <TASK>
[   22.238496]  ? show_regs+0x6d/0x80
[   22.238752]  ? __warn+0xf3/0x380
[   22.238992]  ? report_bug+0x25e/0x4b0
[   22.239259]  ? iommufd_fops_release+0x392/0x420
[   22.239584]  ? report_bug+0x2cb/0x4b0
[   22.239851]  ? iommufd_fops_release+0x392/0x420
[   22.240175]  ? iommufd_fops_release+0x392/0x420
[   22.240499]  ? handle_bug+0x2cd/0x510
[   22.240766]  ? iommufd_fops_release+0x394/0x420
[   22.241093]  ? exc_invalid_op+0x3c/0x80
[   22.241389]  ? asm_exc_invalid_op+0x1f/0x30
[   22.241686]  ? iommufd_fops_release+0x21a/0x420
[   22.242010]  ? iommufd_fops_release+0x392/0x420
[   22.242340]  ? iommufd_fops_release+0x392/0x420
[   22.242668]  ? iommufd_fops_release+0x392/0x420
[   22.242992]  ? locks_remove_file+0x3b4/0x5d0
[   22.243303]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.243646]  ? __memcg_slab_free_hook+0xc1/0x540
[   22.243977]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   22.244355]  ? evm_file_release+0x141/0x220
[   22.244654]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.245000]  __fput+0x41c/0xb70
[   22.245236]  ____fput+0x22/0x30
[   22.245483]  task_work_run+0x19b/0x2b0
[   22.245756]  ? __pfx_task_work_run+0x10/0x10
[   22.246064]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   22.246441]  ? switch_task_namespaces+0xc6/0x110
[   22.246775]  do_exit+0xb0e/0x29d0
[   22.247017]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.247368]  ? __pfx_do_exit+0x10/0x10
[   22.247641]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.247978]  ? __x64_sys_ioctl+0x1ba/0x220
[   22.248274]  make_task_dead+0x181/0x3c0
[   22.248554]  rewind_stack_and_make_dead+0x16/0x20
[   22.248889] RIP: 0033:0x7f1bc203ee5d
[   22.249148] Code: Unable to access opcode bytes at 0x7f1bc203ee33.
[   22.249591] RSP: 002b:00007ffd2bb987b8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.250126] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f1bc203ee5d
[   22.250607] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.251099] RBP: 00007ffd2bb987d0 R08: 0000000000000800 R09: 0000000000000800
[   22.251603] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd2bb988e8
[   22.252101] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f1bc2358000
[   22.252608]  </TASK>
[   22.252775] irq event stamp: 3151
[   22.253016] hardirqs last  enabled at (3151): [<ffffffff812e194b>] cond_local_irq_enable.isra.0+0x3b/0x50
[   22.253696] hardirqs last disabled at (3150): [<ffffffff85c6ecc6>] exc_general_protection+0x36/0x340
[   22.254340] softirqs last  enabled at (2862): [<ffffffff8149141e>] __irq_exit_rcu+0x10e/0x170
[   22.254927] softirqs last disabled at (2787): [<ffffffff8149141e>] __irq_exit_rcu+0x10e/0x170
[   22.255512] ---[ end trace 0000000000000000 ]---
[   22.264753] iommufd_mock iommufd_mock1: Adding to iommu group 1
[   22.265741] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#2] SMP KASAN NOPTI
[   22.267064] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   22.267958] CPU: 0 UID: 0 PID: 730 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.269346] Tainted: [D]=DIE, [W]=WARN
[   22.269833] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.271156] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.271847] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.273967] RSP: 0018:ffff8880126bfb78 EFLAGS: 00010246
[   22.274595] RAX: dffffc0000000000 RBX: ffff88801206b600 RCX: 1ffffffff0dd8bdc
[   22.275438] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801375ad3c
[   22.276277] RBP: ffff8880126bfbc8 R08: 0000000000000000 R09: 0000000000000000
[   22.277114] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   22.277952] R13: 0000000000000001 R14: ffff8880126bfe18 R15: ffff88801637ac08
[   22.278970] FS:  00007f442cfcd600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.279807] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.280424] CR2: 00000000200006c0 CR3: 00000000215c2002 CR4: 0000000000770ef0
[   22.281182] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.281931] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.282684] PKRU: 55555554
[   22.282996] Call Trace:
[   22.283275]  <TASK>
[   22.283524]  ? show_regs+0x6d/0x80
[   22.283919]  ? die_addr+0x45/0xb0
[   22.284307]  ? exc_general_protection+0x1ad/0x340
[   22.284826]  ? asm_exc_general_protection+0x2b/0x30
[   22.285345]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.285887]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   22.286426]  iommufd_device_detach+0x2a/0x2e0
[   22.286906]  iommufd_test+0x2f99/0x5cd0
[   22.287319]  ? do_raw_spin_unlock+0x15c/0x210
[   22.287795]  ? __pfx_iommufd_test+0x10/0x10
[   22.288240]  ? debug_smp_processor_id+0x20/0x30
[   22.288726]  ? rcu_is_watching+0x19/0xc0
[   22.289171]  ? lock_release+0x1ea/0x2c0
[   22.289587]  ? __might_fault+0xf1/0x1b0
[   22.290015]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   22.290575]  iommufd_fops_ioctl+0x38e/0x520
[   22.291011]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.291501]  ? trace_irq_enable+0xd1/0x110
[   22.291941]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.292446]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.292854]  __x64_sys_ioctl+0x1ba/0x220
[   22.293195]  x64_sys_call+0x122e/0x2150
[   22.293516]  do_syscall_64+0x6d/0x150
[   22.293831]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   22.294242] RIP: 0033:0x7f442cc3ee5d
[   22.294498] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   22.295713] RSP: 002b:00007ffc1ef2aea8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.296229] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f442cc3ee5d
[   22.296711] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.297191] RBP: 00007ffc1ef2aec0 R08: 0000000000000800 R09: 0000000000000800
[   22.297672] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc1ef2afd8
[   22.298152] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f442d016000
[   22.298639]  </TASK>
[   22.298806] Modules linked in:
[   22.299154] ---[ end trace 0000000000000000 ]---
[   22.299481] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.299890] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.301127] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   22.301510] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   22.302010] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   22.302502] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   22.302985] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   22.303470] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   22.303956] FS:  00007f442cfcd600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.304499] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.304892] CR2: 00000000200006c0 CR3: 00000000215c2002 CR4: 0000000000770ef0
[   22.305404] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.305883] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.306365] PKRU: 55555554
[   22.306990] ------------[ cut here ]------------
[   22.307319] WARNING: CPU: 0 PID: 730 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   22.307964] Modules linked in:
[   22.308189] CPU: 0 UID: 0 PID: 730 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.308990] Tainted: [D]=DIE, [W]=WARN
[   22.309252] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.310030] RIP: 0010:iommufd_fops_release+0x386/0x420
[   22.310391] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   22.311620] RSP: 0018:ffff8880126bfc08 EFLAGS: 00010293
[   22.311981] RAX: 0000000000000000 RBX: ffff88801ff72008 RCX: ffffffff83afe4ca
[   22.312462] RDX: ffff88801375a540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   22.312947] RBP: ffff8880126bfcb8 R08: 0000000000000000 R09: 0000000000000000
[   22.313442] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   22.313924] R13: 0000000000000000 R14: ffff8880126bfc50 R15: 0000000000000000
[   22.314407] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.314953] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.315346] CR2: 00000000200006c0 CR3: 0000000007086003 CR4: 0000000000770ef0
[   22.315852] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.316343] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.316832] PKRU: 55555554
[   22.317030] Call Trace:
[   22.317211]  <TASK>
[   22.317390]  ? show_regs+0x6d/0x80
[   22.317646]  ? __warn+0xf3/0x380
[   22.317894]  ? report_bug+0x25e/0x4b0
[   22.318163]  ? iommufd_fops_release+0x386/0x420
[   22.318491]  ? report_bug+0x2cb/0x4b0
[   22.318764]  ? iommufd_fops_release+0x386/0x420
[   22.319093]  ? iommufd_fops_release+0x386/0x420
[   22.319427]  ? handle_bug+0x2cd/0x510
[   22.319698]  ? iommufd_fops_release+0x388/0x420
[   22.320026]  ? exc_invalid_op+0x3c/0x80
[   22.320309]  ? asm_exc_invalid_op+0x1f/0x30
[   22.320610]  ? iommufd_fops_release+0x21a/0x420
[   22.320939]  ? iommufd_fops_release+0x386/0x420
[   22.321268]  ? iommufd_fops_release+0x386/0x420
[   22.321627]  ? iommufd_fops_release+0x386/0x420
[   22.321954]  ? locks_remove_file+0x3b4/0x5d0
[   22.322268]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.322618]  ? __memcg_slab_free_hook+0xc1/0x540
[   22.322955]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   22.323336]  ? evm_file_release+0x141/0x220
[   22.323643]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.323991]  __fput+0x41c/0xb70
[   22.324232]  ____fput+0x22/0x30
[   22.324467]  task_work_run+0x19b/0x2b0
[   22.324742]  ? __pfx_task_work_run+0x10/0x10
[   22.325052]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   22.325447]  ? switch_task_namespaces+0xc6/0x110
[   22.325784]  do_exit+0xb0e/0x29d0
[   22.326035]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.326389]  ? __pfx_do_exit+0x10/0x10
[   22.326665]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.327004]  ? __x64_sys_ioctl+0x1ba/0x220
[   22.327301]  make_task_dead+0x181/0x3c0
[   22.327582]  rewind_stack_and_make_dead+0x16/0x20
[   22.327918] RIP: 0033:0x7f442cc3ee5d
[   22.328179] Code: Unable to access opcode bytes at 0x7f442cc3ee33.
[   22.328605] RSP: 002b:00007ffc1ef2aea8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.329130] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f442cc3ee5d
[   22.329637] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.330123] RBP: 00007ffc1ef2aec0 R08: 0000000000000800 R09: 0000000000000800
[   22.330602] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc1ef2afd8
[   22.331088] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f442d016000
[   22.331579]  </TASK>
[   22.331742] irq event stamp: 0
[   22.331961] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   22.332391] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   22.332950] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   22.333524] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   22.333954] ---[ end trace 0000000000000000 ]---
[   22.334326] ------------[ cut here ]------------
[   22.334647] WARNING: CPU: 0 PID: 730 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   22.335298] Modules linked in:
[   22.335523] CPU: 0 UID: 0 PID: 730 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.336320] Tainted: [D]=DIE, [W]=WARN
[   22.336582] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.337359] RIP: 0010:iommufd_fops_release+0x392/0x420
[   22.337721] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   22.338951] RSP: 0018:ffff8880126bfc08 EFLAGS: 00010293
[   22.339313] RAX: 0000000000000000 RBX: ffff88801ff72008 RCX: ffffffff83afe4ca
[   22.339795] RDX: ffff88801375a540 RSI: ffffffff83afe642 RDI: ffff88801ff720a0
[   22.340274] RBP: ffff8880126bfcb8 R08: 0000000000000000 R09: 0000000000000000
[   22.340756] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   22.341236] R13: 0000000000000000 R14: ffff8880126bfc50 R15: 0000000000000000
[   22.341738] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.342281] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.342692] CR2: 00000000200006c0 CR3: 0000000007086003 CR4: 0000000000770ef0
[   22.343185] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.343674] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.344160] PKRU: 55555554
[   22.344357] Call Trace:
[   22.344537]  <TASK>
[   22.344699]  ? show_regs+0x6d/0x80
[   22.344950]  ? __warn+0xf3/0x380
[   22.345189]  ? report_bug+0x25e/0x4b0
[   22.345474]  ? iommufd_fops_release+0x392/0x420
[   22.345793]  ? report_bug+0x2cb/0x4b0
[   22.346056]  ? iommufd_fops_release+0x392/0x420
[   22.346379]  ? iommufd_fops_release+0x392/0x420
[   22.346702]  ? handle_bug+0x2cd/0x510
[   22.346973]  ? iommufd_fops_release+0x394/0x420
[   22.347298]  ? exc_invalid_op+0x3c/0x80
[   22.347576]  ? asm_exc_invalid_op+0x1f/0x30
[   22.347876]  ? iommufd_fops_release+0x21a/0x420
[   22.348203]  ? iommufd_fops_release+0x392/0x420
[   22.348524]  ? iommufd_fops_release+0x392/0x420
[   22.348848]  ? iommufd_fops_release+0x392/0x420
[   22.349177]  ? locks_remove_file+0x3b4/0x5d0
[   22.349511]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.349862]  ? __memcg_slab_free_hook+0xc1/0x540
[   22.350204]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   22.350580]  ? evm_file_release+0x141/0x220
[   22.350882]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.351219]  __fput+0x41c/0xb70
[   22.351449]  ____fput+0x22/0x30
[   22.351675]  task_work_run+0x19b/0x2b0
[   22.351941]  ? __pfx_task_work_run+0x10/0x10
[   22.352243]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   22.352608]  ? switch_task_namespaces+0xc6/0x110
[   22.352930]  do_exit+0xb0e/0x29d0
[   22.353170]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.353532]  ? __pfx_do_exit+0x10/0x10
[   22.353798]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.354121]  ? __x64_sys_ioctl+0x1ba/0x220
[   22.354405]  make_task_dead+0x181/0x3c0
[   22.354674]  rewind_stack_and_make_dead+0x16/0x20
[   22.355001] RIP: 0033:0x7f442cc3ee5d
[   22.355251] Code: Unable to access opcode bytes at 0x7f442cc3ee33.
[   22.355658] RSP: 002b:00007ffc1ef2aea8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.356162] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f442cc3ee5d
[   22.356633] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.357107] RBP: 00007ffc1ef2aec0 R08: 0000000000000800 R09: 0000000000000800
[   22.357597] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc1ef2afd8
[   22.358074] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f442d016000
[   22.358551]  </TASK>
[   22.358715] irq event stamp: 0
[   22.358932] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   22.359353] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   22.359898] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   22.360442] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   22.360860] ---[ end trace 0000000000000000 ]---
[   22.366535] iommufd_mock iommufd_mock2: Adding to iommu group 2
[   22.367050] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#3] SMP KASAN NOPTI
[   22.367750] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   22.368225] CPU: 0 UID: 0 PID: 731 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.368953] Tainted: [D]=DIE, [W]=WARN
[   22.369191] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.369877] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.370242] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.371355] RSP: 0018:ffff888015237b78 EFLAGS: 00010246
[   22.371683] RAX: dffffc0000000000 RBX: ffff88801206be00 RCX: 1ffffffff0dd8bdc
[   22.372120] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880137587fc
[   22.372556] RBP: ffff888015237bc8 R08: 0000000000000000 R09: 0000000000000000
[   22.372991] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   22.373427] R13: 0000000000000001 R14: ffff888015237e18 R15: ffff88801637a808
[   22.373862] FS:  00007fee853d7600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.374357] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.374718] CR2: 00000000200006c0 CR3: 00000000215c2006 CR4: 0000000000770ef0
[   22.375157] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.375592] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.376028] PKRU: 55555554
[   22.376203] Call Trace:
[   22.376365]  <TASK>
[   22.376509]  ? show_regs+0x6d/0x80
[   22.376734]  ? die_addr+0x45/0xb0
[   22.376955]  ? exc_general_protection+0x1ad/0x340
[   22.377266]  ? asm_exc_general_protection+0x2b/0x30
[   22.377580]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.377905]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   22.378231]  iommufd_device_detach+0x2a/0x2e0
[   22.378516]  iommufd_test+0x2f99/0x5cd0
[   22.378769]  ? do_raw_spin_unlock+0x15c/0x210
[   22.379055]  ? __pfx_iommufd_test+0x10/0x10
[   22.379324]  ? debug_smp_processor_id+0x20/0x30
[   22.379617]  ? rcu_is_watching+0x19/0xc0
[   22.379874]  ? lock_release+0x1ea/0x2c0
[   22.380124]  ? __might_fault+0xf1/0x1b0
[   22.380378]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   22.380720]  iommufd_fops_ioctl+0x38e/0x520
[   22.380992]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.381293]  ? trace_irq_enable+0xd1/0x110
[   22.381565]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.381881]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.382183]  __x64_sys_ioctl+0x1ba/0x220
[   22.382441]  x64_sys_call+0x122e/0x2150
[   22.382687]  do_syscall_64+0x6d/0x150
[   22.382930]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   22.383247] RIP: 0033:0x7fee8503ee5d
[   22.383480] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   22.384579] RSP: 002b:00007ffe5883d708 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.385050] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fee8503ee5d
[   22.385487] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.385924] RBP: 00007ffe5883d720 R08: 0000000000000800 R09: 0000000000000800
[   22.386360] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe5883d838
[   22.386801] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fee85420000
[   22.387243]  </TASK>
[   22.387391] Modules linked in:
[   22.387860] ---[ end trace 0000000000000000 ]---
[   22.388159] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.388518] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.389642] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   22.389973] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   22.390411] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   22.390856] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   22.391295] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   22.391734] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   22.392171] FS:  00007fee853d7600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.392663] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.393020] CR2: 00000000200006c0 CR3: 00000000215c2006 CR4: 0000000000770ef0
[   22.393471] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.393908] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.394345] PKRU: 55555554
[   22.394929] ------------[ cut here ]------------
[   22.395227] WARNING: CPU: 0 PID: 731 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   22.395812] Modules linked in:
[   22.396017] CPU: 0 UID: 0 PID: 731 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.396742] Tainted: [D]=DIE, [W]=WARN
[   22.396981] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.397681] RIP: 0010:iommufd_fops_release+0x386/0x420
[   22.398017] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   22.399124] RSP: 0018:ffff888015237c08 EFLAGS: 00010293
[   22.399453] RAX: 0000000000000000 RBX: ffff88801ff74808 RCX: ffffffff83afe4ca
[   22.399886] RDX: ffff888013758000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   22.400318] RBP: ffff888015237cb8 R08: 0000000000000000 R09: 0000000000000000
[   22.400750] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   22.401183] R13: 0000000000000000 R14: ffff888015237c50 R15: 0000000000000000
[   22.401653] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.402142] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.402497] CR2: 00000000200006c0 CR3: 0000000007086003 CR4: 0000000000770ef0
[   22.402935] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.403369] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.403804] PKRU: 55555554
[   22.403981] Call Trace:
[   22.404143]  <TASK>
[   22.404287]  ? show_regs+0x6d/0x80
[   22.404512]  ? __warn+0xf3/0x380
[   22.404728]  ? report_bug+0x25e/0x4b0
[   22.404967]  ? iommufd_fops_release+0x386/0x420
[   22.405258]  ? report_bug+0x2cb/0x4b0
[   22.405522]  ? iommufd_fops_release+0x386/0x420
[   22.405815]  ? iommufd_fops_release+0x386/0x420
[   22.406105]  ? handle_bug+0x2cd/0x510
[   22.406344]  ? iommufd_fops_release+0x388/0x420
[   22.406635]  ? exc_invalid_op+0x3c/0x80
[   22.406890]  ? asm_exc_invalid_op+0x1f/0x30
[   22.407160]  ? iommufd_fops_release+0x21a/0x420
[   22.407450]  ? iommufd_fops_release+0x386/0x420
[   22.407741]  ? iommufd_fops_release+0x386/0x420
[   22.408032]  ? iommufd_fops_release+0x386/0x420
[   22.408325]  ? locks_remove_file+0x3b4/0x5d0
[   22.408603]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.408914]  ? __memcg_slab_free_hook+0xc1/0x540
[   22.409212]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   22.409563]  ? evm_file_release+0x141/0x220
[   22.409837]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.410147]  __fput+0x41c/0xb70
[   22.410359]  ____fput+0x22/0x30
[   22.410567]  task_work_run+0x19b/0x2b0
[   22.410818]  ? __pfx_task_work_run+0x10/0x10
[   22.411095]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   22.411434]  ? switch_task_namespaces+0xc6/0x110
[   22.411732]  do_exit+0xb0e/0x29d0
[   22.411952]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.412268]  ? __pfx_do_exit+0x10/0x10
[   22.412513]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.412814]  ? __x64_sys_ioctl+0x1ba/0x220
[   22.413078]  make_task_dead+0x181/0x3c0
[   22.413342]  rewind_stack_and_make_dead+0x16/0x20
[   22.413646] RIP: 0033:0x7fee8503ee5d
[   22.413885] Code: Unable to access opcode bytes at 0x7fee8503ee33.
[   22.414277] RSP: 002b:00007ffe5883d708 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.414760] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fee8503ee5d
[   22.415209] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.415658] RBP: 00007ffe5883d720 R08: 0000000000000800 R09: 0000000000000800
[   22.416105] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe5883d838
[   22.416564] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fee85420000
[   22.417022]  </TASK>
[   22.417174] irq event stamp: 0
[   22.417394] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   22.417795] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   22.418318] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   22.418847] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   22.419246] ---[ end trace 0000000000000000 ]---
[   22.419590] ------------[ cut here ]------------
[   22.419879] WARNING: CPU: 0 PID: 731 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   22.420460] Modules linked in:
[   22.420664] CPU: 0 UID: 0 PID: 731 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.421404] Tainted: [D]=DIE, [W]=WARN
[   22.421644] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.422329] RIP: 0010:iommufd_fops_release+0x392/0x420
[   22.422653] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   22.423759] RSP: 0018:ffff888015237c08 EFLAGS: 00010293
[   22.424088] RAX: 0000000000000000 RBX: ffff88801ff74808 RCX: ffffffff83afe4ca
[   22.424524] RDX: ffff888013758000 RSI: ffffffff83afe642 RDI: ffff88801ff748a0
[   22.424960] RBP: ffff888015237cb8 R08: 0000000000000000 R09: 0000000000000000
[   22.425418] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   22.425858] R13: 0000000000000000 R14: ffff888015237c50 R15: 0000000000000000
[   22.426293] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.426788] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.427143] CR2: 00000000200006c0 CR3: 0000000007086003 CR4: 0000000000770ef0
[   22.427580] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.428016] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.428452] PKRU: 55555554
[   22.428630] Call Trace:
[   22.428792]  <TASK>
[   22.428936]  ? show_regs+0x6d/0x80
[   22.429160]  ? __warn+0xf3/0x380
[   22.429403]  ? report_bug+0x25e/0x4b0
[   22.429644]  ? iommufd_fops_release+0x392/0x420
[   22.429934]  ? report_bug+0x2cb/0x4b0
[   22.430172]  ? iommufd_fops_release+0x392/0x420
[   22.430463]  ? iommufd_fops_release+0x392/0x420
[   22.430759]  ? handle_bug+0x2cd/0x510
[   22.430999]  ? iommufd_fops_release+0x394/0x420
[   22.431288]  ? exc_invalid_op+0x3c/0x80
[   22.431536]  ? asm_exc_invalid_op+0x1f/0x30
[   22.431803]  ? iommufd_fops_release+0x21a/0x420
[   22.432092]  ? iommufd_fops_release+0x392/0x420
[   22.432378]  ? iommufd_fops_release+0x392/0x420
[   22.432667]  ? iommufd_fops_release+0x392/0x420
[   22.432955]  ? locks_remove_file+0x3b4/0x5d0
[   22.433232]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.433565]  ? __memcg_slab_free_hook+0xc1/0x540
[   22.433861]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   22.434196]  ? evm_file_release+0x141/0x220
[   22.434462]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.434779]  __fput+0x41c/0xb70
[   22.434989]  ____fput+0x22/0x30
[   22.435197]  task_work_run+0x19b/0x2b0
[   22.435441]  ? __pfx_task_work_run+0x10/0x10
[   22.435716]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   22.436053]  ? switch_task_namespaces+0xc6/0x110
[   22.436349]  do_exit+0xb0e/0x29d0
[   22.436568]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.436879]  ? __pfx_do_exit+0x10/0x10
[   22.437122]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.437441]  ? __x64_sys_ioctl+0x1ba/0x220
[   22.437708]  make_task_dead+0x181/0x3c0
[   22.437958]  rewind_stack_and_make_dead+0x16/0x20
[   22.438258] RIP: 0033:0x7fee8503ee5d
[   22.438490] Code: Unable to access opcode bytes at 0x7fee8503ee33.
[   22.438873] RSP: 002b:00007ffe5883d708 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.439340] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fee8503ee5d
[   22.439780] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.440215] RBP: 00007ffe5883d720 R08: 0000000000000800 R09: 0000000000000800
[   22.440652] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe5883d838
[   22.441089] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fee85420000
[   22.441547]  </TASK>
[   22.441696] irq event stamp: 0
[   22.441895] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   22.442282] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   22.442790] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   22.443292] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   22.444201] ---[ end trace 0000000000000000 ]---
[   22.448851] iommufd_mock iommufd_mock3: Adding to iommu group 3
[   22.449622] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#4] SMP KASAN NOPTI
[   22.450311] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   22.450786] CPU: 0 UID: 0 PID: 732 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.451513] Tainted: [D]=DIE, [W]=WARN
[   22.451751] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.452483] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.452859] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.453973] RSP: 0018:ffff8880126bfb78 EFLAGS: 00010246
[   22.454303] RAX: dffffc0000000000 RBX: ffff88801206b000 RCX: 1ffffffff0dd8bdc
[   22.454747] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff888012e82d3c
[   22.455190] RBP: ffff8880126bfbc8 R08: 0000000000000000 R09: 0000000000000000
[   22.455642] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   22.456093] R13: 0000000000000001 R14: ffff8880126bfe18 R15: ffff888016149808
[   22.456546] FS:  00007efe0c797600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.457053] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.457421] CR2: 000055f8b3b65dc0 CR3: 000000001115e004 CR4: 0000000000770ef0
[   22.457876] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.458332] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.458786] PKRU: 55555554
[   22.458970] Call Trace:
[   22.459137]  <TASK>
[   22.459286]  ? show_regs+0x6d/0x80
[   22.459520]  ? die_addr+0x45/0xb0
[   22.459749]  ? exc_general_protection+0x1ad/0x340
[   22.460070]  ? asm_exc_general_protection+0x2b/0x30
[   22.460395]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.460731]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   22.461069]  iommufd_device_detach+0x2a/0x2e0
[   22.461365]  iommufd_test+0x2f99/0x5cd0
[   22.461624]  ? do_raw_spin_unlock+0x15c/0x210
[   22.461920]  ? __pfx_iommufd_test+0x10/0x10
[   22.462198]  ? debug_smp_processor_id+0x20/0x30
[   22.462501]  ? rcu_is_watching+0x19/0xc0
[   22.462770]  ? lock_release+0x1ea/0x2c0
[   22.463032]  ? __might_fault+0xf1/0x1b0
[   22.463294]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   22.463657]  iommufd_fops_ioctl+0x38e/0x520
[   22.463938]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.464254]  ? trace_irq_enable+0xd1/0x110
[   22.464536]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.464866]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.465178]  __x64_sys_ioctl+0x1ba/0x220
[   22.465445]  x64_sys_call+0x122e/0x2150
[   22.465703]  do_syscall_64+0x6d/0x150
[   22.465953]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   22.466284] RIP: 0033:0x7efe0c43ee5d
[   22.466515] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   22.467630] RSP: 002b:00007ffc0664dbc8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.468098] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007efe0c43ee5d
[   22.468535] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.468972] RBP: 00007ffc0664dbe0 R08: 0000000000000800 R09: 0000000000000800
[   22.469409] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc0664dcf8
[   22.469845] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007efe0c7e0000
[   22.470290]  </TASK>
[   22.470438] Modules linked in:
[   22.470730] ---[ end trace 0000000000000000 ]---
[   22.471025] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.471387] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.472519] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   22.472859] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   22.473311] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   22.473833] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   22.474288] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   22.474743] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   22.475194] FS:  00007efe0c797600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.475703] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.476072] CR2: 000055f8b3b65dc0 CR3: 000000001115e004 CR4: 0000000000770ef0
[   22.476525] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.476978] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.477472] PKRU: 55555554
[   22.478522] ------------[ cut here ]------------
[   22.478932] WARNING: CPU: 0 PID: 732 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   22.479715] Modules linked in:
[   22.479934] CPU: 0 UID: 0 PID: 732 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.480799] Tainted: [D]=DIE, [W]=WARN
[   22.481051] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.481796] RIP: 0010:iommufd_fops_release+0x386/0x420
[   22.482140] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   22.483327] RSP: 0018:ffff8880126bfc08 EFLAGS: 00010293
[   22.483752] RAX: 0000000000000000 RBX: ffff88801ff71808 RCX: ffffffff83afe4ca
[   22.484218] RDX: ffff888012e82540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   22.484714] RBP: ffff8880126bfcb8 R08: 0000000000000000 R09: 0000000000000000
[   22.485255] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   22.485746] R13: 0000000000000000 R14: ffff8880126bfc50 R15: 0000000000000000
[   22.486208] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.486770] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.487220] CR2: 000055f8b3b65dc0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   22.487687] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.488219] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.488660] PKRU: 55555554
[   22.488852] Call Trace:
[   22.489018]  <TASK>
[   22.489181]  ? show_regs+0x6d/0x80
[   22.489500]  ? __warn+0xf3/0x380
[   22.489728]  ? report_bug+0x25e/0x4b0
[   22.489985]  ? iommufd_fops_release+0x386/0x420
[   22.490294]  ? report_bug+0x2cb/0x4b0
[   22.490555]  ? iommufd_fops_release+0x386/0x420
[   22.490912]  ? iommufd_fops_release+0x386/0x420
[   22.491276]  ? handle_bug+0x2cd/0x510
[   22.491534]  ? iommufd_fops_release+0x388/0x420
[   22.491869]  ? exc_invalid_op+0x3c/0x80
[   22.492200]  ? asm_exc_invalid_op+0x1f/0x30
[   22.492488]  ? iommufd_fops_release+0x21a/0x420
[   22.492795]  ? iommufd_fops_release+0x386/0x420
[   22.493099]  ? iommufd_fops_release+0x386/0x420
[   22.493515]  ? iommufd_fops_release+0x386/0x420
[   22.493838]  ? locks_remove_file+0x3b4/0x5d0
[   22.494133]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.494475]  ? __memcg_slab_free_hook+0xc1/0x540
[   22.494795]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   22.495157]  ? evm_file_release+0x141/0x220
[   22.495484]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.495865]  __fput+0x41c/0xb70
[   22.496093]  ____fput+0x22/0x30
[   22.496316]  task_work_run+0x19b/0x2b0
[   22.496586]  ? __pfx_task_work_run+0x10/0x10
[   22.496966]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   22.497344]  ? switch_task_namespaces+0xc6/0x110
[   22.497664]  do_exit+0xb0e/0x29d0
[   22.497901]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.498236]  ? __pfx_do_exit+0x10/0x10
[   22.498509]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.498903]  ? __x64_sys_ioctl+0x1ba/0x220
[   22.499181]  make_task_dead+0x181/0x3c0
[   22.499440]  rewind_stack_and_make_dead+0x16/0x20
[   22.499760] RIP: 0033:0x7efe0c43ee5d
[   22.500081] Code: Unable to access opcode bytes at 0x7efe0c43ee33.
[   22.500475] RSP: 002b:00007ffc0664dbc8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.500954] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007efe0c43ee5d
[   22.501526] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.501980] RBP: 00007ffc0664dbe0 R08: 0000000000000800 R09: 0000000000000800
[   22.502431] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc0664dcf8
[   22.502889] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007efe0c7e0000
[   22.503374]  </TASK>
[   22.503585] irq event stamp: 0
[   22.503794] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   22.504288] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   22.504815] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   22.505371] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   22.505873] ---[ end trace 0000000000000000 ]---
[   22.506235] ------------[ cut here ]------------
[   22.506534] WARNING: CPU: 0 PID: 732 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   22.507157] Modules linked in:
[   22.507435] CPU: 0 UID: 0 PID: 732 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.508226] Tainted: [D]=DIE, [W]=WARN
[   22.508471] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.509348] RIP: 0010:iommufd_fops_release+0x392/0x420
[   22.509691] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   22.510996] RSP: 0018:ffff8880126bfc08 EFLAGS: 00010293
[   22.511353] RAX: 0000000000000000 RBX: ffff88801ff71808 RCX: ffffffff83afe4ca
[   22.511937] RDX: ffff888012e82540 RSI: ffffffff83afe642 RDI: ffff88801ff718a0
[   22.512391] RBP: ffff8880126bfcb8 R08: 0000000000000000 R09: 0000000000000000
[   22.512886] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   22.513454] R13: 0000000000000000 R14: ffff8880126bfc50 R15: 0000000000000000
[   22.513906] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.514458] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.514930] CR2: 000055f8b3b65dc0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   22.515421] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.515971] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.516424] PKRU: 55555554
[   22.516626] Call Trace:
[   22.516818]  <TASK>
[   22.517071]  ? show_regs+0x6d/0x80
[   22.517307]  ? __warn+0xf3/0x380
[   22.517544]  ? report_bug+0x25e/0x4b0
[   22.517794]  ? iommufd_fops_release+0x392/0x420
[   22.518149]  ? report_bug+0x2cb/0x4b0
[   22.518501]  ? iommufd_fops_release+0x392/0x420
[   22.518809]  ? iommufd_fops_release+0x392/0x420
[   22.519110]  ? handle_bug+0x2cd/0x510
[   22.519358]  ? iommufd_fops_release+0x394/0x420
[   22.519675]  ? exc_invalid_op+0x3c/0x80
[   22.520059]  ? asm_exc_invalid_op+0x1f/0x30
[   22.520341]  ? iommufd_fops_release+0x21a/0x420
[   22.520641]  ? iommufd_fops_release+0x392/0x420
[   22.520941]  ? iommufd_fops_release+0x392/0x420
[   22.521276]  ? iommufd_fops_release+0x392/0x420
[   22.521680]  ? locks_remove_file+0x3b4/0x5d0
[   22.521973]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.522310]  ? __memcg_slab_free_hook+0xc1/0x540
[   22.522644]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   22.523139]  ? evm_file_release+0x141/0x220
[   22.523423]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.523792]  __fput+0x41c/0xb70
[   22.524119]  ____fput+0x22/0x30
[   22.524340]  task_work_run+0x19b/0x2b0
[   22.524600]  ? __pfx_task_work_run+0x10/0x10
[   22.524887]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   22.525291]  ? switch_task_namespaces+0xc6/0x110
[   22.525711]  do_exit+0xb0e/0x29d0
[   22.525946]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.526276]  ? __pfx_do_exit+0x10/0x10
[   22.526531]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.526849]  ? __x64_sys_ioctl+0x1ba/0x220
[   22.527173]  make_task_dead+0x181/0x3c0
[   22.527538]  rewind_stack_and_make_dead+0x16/0x20
[   22.527849] RIP: 0033:0x7efe0c43ee5d
[   22.528131] Code: Unable to access opcode bytes at 0x7efe0c43ee33.
[   22.528629] RSP: 002b:00007ffc0664dbc8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.529112] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007efe0c43ee5d
[   22.529730] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.530184] RBP: 00007ffc0664dbe0 R08: 0000000000000800 R09: 0000000000000800
[   22.530635] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc0664dcf8
[   22.531176] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007efe0c7e0000
[   22.531826]  </TASK>
[   22.531994] irq event stamp: 0
[   22.532215] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   22.532640] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   22.533188] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   22.533761] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   22.534192] ---[ end trace 0000000000000000 ]---
[   22.539321] iommufd_mock iommufd_mock4: Adding to iommu group 4
[   22.540766] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#5] SMP KASAN NOPTI
[   22.541611] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   22.542236] CPU: 1 UID: 0 PID: 733 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.543078] Tainted: [D]=DIE, [W]=WARN
[   22.543406] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.544180] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.544665] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.545998] RSP: 0018:ffff888026dafb78 EFLAGS: 00010246
[   22.546359] RAX: dffffc0000000000 RBX: ffff888010d33000 RCX: 1ffffffff0dd8bdd
[   22.546843] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801375d27c
[   22.547444] RBP: ffff888026dafbc8 R08: 0000000000000000 R09: 0000000000000000
[   22.547931] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   22.548408] R13: 0000000000000001 R14: ffff888026dafe18 R15: ffff8880115ce808
[   22.548959] FS:  00007fbf7e08e600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   22.549498] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.549901] CR2: 00000000200006c0 CR3: 0000000011120004 CR4: 0000000000770ef0
[   22.550455] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.550937] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.551449] PKRU: 55555554
[   22.551703] Call Trace:
[   22.551881]  <TASK>
[   22.552037]  ? show_regs+0x6d/0x80
[   22.552287]  ? die_addr+0x45/0xb0
[   22.552545]  ? exc_general_protection+0x1ad/0x340
[   22.552976]  ? asm_exc_general_protection+0x2b/0x30
[   22.553320]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.553694]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   22.554164]  iommufd_device_detach+0x2a/0x2e0
[   22.554486]  iommufd_test+0x2f99/0x5cd0
[   22.554773]  ? do_raw_spin_unlock+0x15c/0x210
[   22.555112]  ? __pfx_iommufd_test+0x10/0x10
[   22.555505]  ? debug_smp_processor_id+0x20/0x30
[   22.555836]  ? rcu_is_watching+0x19/0xc0
[   22.556126]  ? lock_release+0x1ea/0x2c0
[   22.556408]  ? __might_fault+0xf1/0x1b0
[   22.556693]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   22.557077]  iommufd_fops_ioctl+0x38e/0x520
[   22.557381]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.557884]  ? trace_irq_enable+0xd1/0x110
[   22.558192]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.558547]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.558907]  __x64_sys_ioctl+0x1ba/0x220
[   22.559335]  x64_sys_call+0x122e/0x2150
[   22.559607]  do_syscall_64+0x6d/0x150
[   22.559869]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   22.560218] RIP: 0033:0x7fbf7de3ee5d
[   22.560514] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   22.561837] RSP: 002b:00007fffcaf918c8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.562442] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fbf7de3ee5d
[   22.562938] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.563535] RBP: 00007fffcaf918e0 R08: 0000000000000800 R09: 0000000000000800
[   22.564022] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fffcaf919f8
[   22.564650] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fbf7e0d7000
[   22.565157]  </TASK>
[   22.565431] Modules linked in:
[   22.565727] ---[ end trace 0000000000000000 ]---
[   22.566061] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.566592] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.567985] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   22.568496] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   22.568979] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   22.569635] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   22.570117] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   22.570763] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   22.571252] FS:  00007fbf7e08e600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   22.571917] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.572344] CR2: 00000000200006c0 CR3: 0000000011120004 CR4: 0000000000770ef0
[   22.572995] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.573633] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.574145] PKRU: 55555554
[   22.576289] ------------[ cut here ]------------
[   22.576604] WARNING: CPU: 0 PID: 733 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   22.577202] Modules linked in:
[   22.577569] CPU: 0 UID: 0 PID: 733 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.578456] Tainted: [D]=DIE, [W]=WARN
[   22.578700] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.579581] RIP: 0010:iommufd_fops_release+0x386/0x420
[   22.579914] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   22.581180] RSP: 0018:ffff888026dafc08 EFLAGS: 00010293
[   22.581644] RAX: 0000000000000000 RBX: ffff888018d74008 RCX: ffffffff83afe4ca
[   22.582093] RDX: ffff88801375ca80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   22.582535] RBP: ffff888026dafcb8 R08: 0000000000000000 R09: 0000000000000000
[   22.582982] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   22.583465] R13: 0000000000000000 R14: ffff888026dafc50 R15: 0000000000000000
[   22.583987] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.584609] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.584973] CR2: 00007f082013a0b8 CR3: 0000000007086001 CR4: 0000000000770ef0
[   22.585542] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.585987] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.586460] PKRU: 55555554
[   22.586729] Call Trace:
[   22.586896]  <TASK>
[   22.587042]  ? show_regs+0x6d/0x80
[   22.587287]  ? __warn+0xf3/0x380
[   22.587598]  ? report_bug+0x25e/0x4b0
[   22.587845]  ? iommufd_fops_release+0x386/0x420
[   22.588149]  ? report_bug+0x2cb/0x4b0
[   22.588480]  ? iommufd_fops_release+0x386/0x420
[   22.588777]  ? iommufd_fops_release+0x386/0x420
[   22.589104]  ? handle_bug+0x2cd/0x510
[   22.589447]  ? iommufd_fops_release+0x388/0x420
[   22.589747]  ? exc_invalid_op+0x3c/0x80
[   22.590001]  ? asm_exc_invalid_op+0x1f/0x30
[   22.590275]  ? iommufd_fops_release+0x21a/0x420
[   22.590678]  ? iommufd_fops_release+0x386/0x420
[   22.590980]  ? iommufd_fops_release+0x386/0x420
[   22.591296]  ? iommufd_fops_release+0x386/0x420
[   22.591665]  ? locks_remove_file+0x3b4/0x5d0
[   22.591952]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.592303]  ? __memcg_slab_free_hook+0xc1/0x540
[   22.592664]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   22.593030]  ? evm_file_release+0x141/0x220
[   22.593403]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.593720]  __fput+0x41c/0xb70
[   22.593937]  ____fput+0x22/0x30
[   22.594149]  task_work_run+0x19b/0x2b0
[   22.594402]  ? __pfx_task_work_run+0x10/0x10
[   22.594682]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   22.595030]  ? switch_task_namespaces+0xc6/0x110
[   22.595331]  do_exit+0xb0e/0x29d0
[   22.595556]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.595873]  ? __pfx_do_exit+0x10/0x10
[   22.596120]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.596424]  ? __x64_sys_ioctl+0x1ba/0x220
[   22.596691]  make_task_dead+0x181/0x3c0
[   22.596949]  rewind_stack_and_make_dead+0x16/0x20
[   22.597251] RIP: 0033:0x7fbf7de3ee5d
[   22.597535] Code: Unable to access opcode bytes at 0x7fbf7de3ee33.
[   22.597923] RSP: 002b:00007fffcaf918c8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.598394] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fbf7de3ee5d
[   22.598838] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.599280] RBP: 00007fffcaf918e0 R08: 0000000000000800 R09: 0000000000000800
[   22.599720] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fffcaf919f8
[   22.600161] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fbf7e0d7000
[   22.600608]  </TASK>
[   22.600759] irq event stamp: 0
[   22.600963] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   22.601370] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   22.601883] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   22.602391] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   22.602786] ---[ end trace 0000000000000000 ]---
[   22.603133] ------------[ cut here ]------------
[   22.603426] WARNING: CPU: 0 PID: 733 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   22.604013] Modules linked in:
[   22.604220] CPU: 0 UID: 0 PID: 733 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.604950] Tainted: [D]=DIE, [W]=WARN
[   22.605189] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.605901] RIP: 0010:iommufd_fops_release+0x392/0x420
[   22.606232] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   22.607358] RSP: 0018:ffff888026dafc08 EFLAGS: 00010293
[   22.607688] RAX: 0000000000000000 RBX: ffff888018d74008 RCX: ffffffff83afe4ca
[   22.608128] RDX: ffff88801375ca80 RSI: ffffffff83afe642 RDI: ffff888018d740a0
[   22.608567] RBP: ffff888026dafcb8 R08: 0000000000000000 R09: 0000000000000000
[   22.609008] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   22.609463] R13: 0000000000000000 R14: ffff888026dafc50 R15: 0000000000000000
[   22.609904] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.610400] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.610764] CR2: 00007f082013a0b8 CR3: 0000000007086001 CR4: 0000000000770ef0
[   22.611205] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.611647] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.612088] PKRU: 55555554
[   22.612269] Call Trace:
[   22.612433]  <TASK>
[   22.612579]  ? show_regs+0x6d/0x80
[   22.612808]  ? __warn+0xf3/0x380
[   22.613024]  ? report_bug+0x25e/0x4b0
[   22.613266]  ? iommufd_fops_release+0x392/0x420
[   22.613574]  ? report_bug+0x2cb/0x4b0
[   22.613820]  ? iommufd_fops_release+0x392/0x420
[   22.614114]  ? iommufd_fops_release+0x392/0x420
[   22.614408]  ? handle_bug+0x2cd/0x510
[   22.614650]  ? iommufd_fops_release+0x394/0x420
[   22.614949]  ? exc_invalid_op+0x3c/0x80
[   22.615202]  ? asm_exc_invalid_op+0x1f/0x30
[   22.615474]  ? iommufd_fops_release+0x21a/0x420
[   22.615765]  ? iommufd_fops_release+0x392/0x420
[   22.616059]  ? iommufd_fops_release+0x392/0x420
[   22.616353]  ? iommufd_fops_release+0x392/0x420
[   22.616646]  ? locks_remove_file+0x3b4/0x5d0
[   22.616927]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.617241]  ? __memcg_slab_free_hook+0xc1/0x540
[   22.617558]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   22.617902]  ? evm_file_release+0x141/0x220
[   22.618178]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.618491]  __fput+0x41c/0xb70
[   22.618711]  ____fput+0x22/0x30
[   22.618923]  task_work_run+0x19b/0x2b0
[   22.619170]  ? __pfx_task_work_run+0x10/0x10
[   22.619452]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   22.619794]  ? switch_task_namespaces+0xc6/0x110
[   22.620099]  do_exit+0xb0e/0x29d0
[   22.620324]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.620644]  ? __pfx_do_exit+0x10/0x10
[   22.620895]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.621200]  ? __x64_sys_ioctl+0x1ba/0x220
[   22.621481]  make_task_dead+0x181/0x3c0
[   22.621739]  rewind_stack_and_make_dead+0x16/0x20
[   22.622045] RIP: 0033:0x7fbf7de3ee5d
[   22.622281] Code: Unable to access opcode bytes at 0x7fbf7de3ee33.
[   22.622665] RSP: 002b:00007fffcaf918c8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.623140] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fbf7de3ee5d
[   22.623584] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.624025] RBP: 00007fffcaf918e0 R08: 0000000000000800 R09: 0000000000000800
[   22.624465] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fffcaf919f8
[   22.624910] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fbf7e0d7000
[   22.625377]  </TASK>
[   22.625529] irq event stamp: 0
[   22.625732] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   22.626126] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   22.626638] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   22.627152] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   22.627545] ---[ end trace 0000000000000000 ]---
[   22.632226] iommufd_mock iommufd_mock5: Adding to iommu group 5
[   22.632791] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#6] SMP KASAN NOPTI
[   22.633540] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   22.634014] CPU: 0 UID: 0 PID: 734 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.634763] Tainted: [D]=DIE, [W]=WARN
[   22.635003] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.635699] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.636068] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.637194] RSP: 0018:ffff88801dd6fb78 EFLAGS: 00010246
[   22.637526] RAX: dffffc0000000000 RBX: ffff88801206a600 RCX: 1ffffffff0dd8bdc
[   22.637969] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880215807fc
[   22.638411] RBP: ffff88801dd6fbc8 R08: 0000000000000000 R09: 0000000000000000
[   22.638858] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   22.639302] R13: 0000000000000001 R14: ffff88801dd6fe18 R15: ffff88801614a408
[   22.639744] FS:  00007f8c47704600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.640243] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.640604] CR2: 00000000200006c0 CR3: 0000000011120006 CR4: 0000000000770ef0
[   22.641048] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.641490] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.641932] PKRU: 55555554
[   22.642111] Call Trace:
[   22.642275]  <TASK>
[   22.642421]  ? show_regs+0x6d/0x80
[   22.642652]  ? die_addr+0x45/0xb0
[   22.642881]  ? exc_general_protection+0x1ad/0x340
[   22.643197]  ? asm_exc_general_protection+0x2b/0x30
[   22.643517]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.643846]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   22.644181]  iommufd_device_detach+0x2a/0x2e0
[   22.644470]  iommufd_test+0x2f99/0x5cd0
[   22.644724]  ? do_raw_spin_unlock+0x15c/0x210
[   22.645014]  ? __pfx_iommufd_test+0x10/0x10
[   22.645286]  ? debug_smp_processor_id+0x20/0x30
[   22.645598]  ? rcu_is_watching+0x19/0xc0
[   22.645861]  ? lock_release+0x1ea/0x2c0
[   22.646113]  ? __might_fault+0xf1/0x1b0
[   22.646371]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   22.646720]  iommufd_fops_ioctl+0x38e/0x520
[   22.646996]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.647305]  ? trace_irq_enable+0xd1/0x110
[   22.647581]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.647904]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.648209]  __x64_sys_ioctl+0x1ba/0x220
[   22.648472]  x64_sys_call+0x122e/0x2150
[   22.648725]  do_syscall_64+0x6d/0x150
[   22.648968]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   22.649290] RIP: 0033:0x7f8c4743ee5d
[   22.649527] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   22.650772] RSP: 002b:00007ffcf6a8c018 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.651275] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f8c4743ee5d
[   22.651724] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.652169] RBP: 00007ffcf6a8c030 R08: 0000000000000800 R09: 0000000000000800
[   22.652622] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcf6a8c148
[   22.653080] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f8c4774d000
[   22.653550]  </TASK>
[   22.653700] Modules linked in:
[   22.654038] ---[ end trace 0000000000000000 ]---
[   22.654373] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.654824] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.655976] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   22.656310] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   22.656773] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   22.657228] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   22.657750] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   22.658204] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   22.658652] FS:  00007f8c47704600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.659160] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.659528] CR2: 00000000200006c0 CR3: 0000000011120006 CR4: 0000000000770ef0
[   22.659982] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.660433] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.660882] PKRU: 55555554
[   22.662458] ------------[ cut here ]------------
[   22.662841] WARNING: CPU: 0 PID: 734 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   22.663595] Modules linked in:
[   22.663812] CPU: 0 UID: 0 PID: 734 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.664561] Tainted: [D]=DIE, [W]=WARN
[   22.664804] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.665591] RIP: 0010:iommufd_fops_release+0x386/0x420
[   22.665955] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   22.667114] RSP: 0018:ffff88801dd6fc08 EFLAGS: 00010293
[   22.667451] RAX: 0000000000000000 RBX: ffff888012ddf808 RCX: ffffffff83afe4ca
[   22.667910] RDX: ffff888021580000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   22.668359] RBP: ffff88801dd6fcb8 R08: 0000000000000000 R09: 0000000000000000
[   22.668807] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   22.669265] R13: 0000000000000000 R14: ffff88801dd6fc50 R15: 0000000000000000
[   22.669794] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.670311] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.670680] CR2: 00007f25f80d9000 CR3: 000000001206e002 CR4: 0000000000770ef0
[   22.671136] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.671590] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.672043] PKRU: 55555554
[   22.672227] Call Trace:
[   22.672393]  <TASK>
[   22.672540]  ? show_regs+0x6d/0x80
[   22.672774]  ? __warn+0xf3/0x380
[   22.673008]  ? report_bug+0x25e/0x4b0
[   22.673275]  ? iommufd_fops_release+0x386/0x420
[   22.673639]  ? report_bug+0x2cb/0x4b0
[   22.673895]  ? iommufd_fops_release+0x386/0x420
[   22.674203]  ? iommufd_fops_release+0x386/0x420
[   22.674507]  ? handle_bug+0x2cd/0x510
[   22.674768]  ? iommufd_fops_release+0x388/0x420
[   22.675070]  ? exc_invalid_op+0x3c/0x80
[   22.675331]  ? asm_exc_invalid_op+0x1f/0x30
[   22.675615]  ? iommufd_fops_release+0x21a/0x420
[   22.675919]  ? iommufd_fops_release+0x386/0x420
[   22.676220]  ? iommufd_fops_release+0x386/0x420
[   22.676525]  ? iommufd_fops_release+0x386/0x420
[   22.676822]  ? locks_remove_file+0x3b4/0x5d0
[   22.677121]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.677498]  ? __memcg_slab_free_hook+0xc1/0x540
[   22.677812]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   22.678166]  ? evm_file_release+0x141/0x220
[   22.678447]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.678768]  __fput+0x41c/0xb70
[   22.678987]  ____fput+0x22/0x30
[   22.679199]  task_work_run+0x19b/0x2b0
[   22.679454]  ? __pfx_task_work_run+0x10/0x10
[   22.679746]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   22.680093]  ? switch_task_namespaces+0xc6/0x110
[   22.680401]  do_exit+0xb0e/0x29d0
[   22.680631]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.680957]  ? __pfx_do_exit+0x10/0x10
[   22.681206]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.681568]  ? __x64_sys_ioctl+0x1ba/0x220
[   22.681845]  make_task_dead+0x181/0x3c0
[   22.682104]  rewind_stack_and_make_dead+0x16/0x20
[   22.682410] RIP: 0033:0x7f8c4743ee5d
[   22.682650] Code: Unable to access opcode bytes at 0x7f8c4743ee33.
[   22.683050] RSP: 002b:00007ffcf6a8c018 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.683526] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f8c4743ee5d
[   22.683970] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.684421] RBP: 00007ffcf6a8c030 R08: 0000000000000800 R09: 0000000000000800
[   22.684880] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcf6a8c148
[   22.685388] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f8c4774d000
[   22.685854]  </TASK>
[   22.686013] irq event stamp: 0
[   22.686220] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   22.686622] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   22.687151] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   22.687672] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   22.688073] ---[ end trace 0000000000000000 ]---
[   22.688426] ------------[ cut here ]------------
[   22.688725] WARNING: CPU: 0 PID: 734 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   22.689381] Modules linked in:
[   22.689601] CPU: 0 UID: 0 PID: 734 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.690384] Tainted: [D]=DIE, [W]=WARN
[   22.690629] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.691338] RIP: 0010:iommufd_fops_release+0x392/0x420
[   22.691673] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   22.692828] RSP: 0018:ffff88801dd6fc08 EFLAGS: 00010293
[   22.693169] RAX: 0000000000000000 RBX: ffff888012ddf808 RCX: ffffffff83afe4ca
[   22.693654] RDX: ffff888021580000 RSI: ffffffff83afe642 RDI: ffff888012ddf8a0
[   22.694111] RBP: ffff88801dd6fcb8 R08: 0000000000000000 R09: 0000000000000000
[   22.694563] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   22.695018] R13: 0000000000000000 R14: ffff88801dd6fc50 R15: 0000000000000000
[   22.695470] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.695983] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.696349] CR2: 00007f25f80d9000 CR3: 000000001206e002 CR4: 0000000000770ef0
[   22.696806] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.697262] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.697760] PKRU: 55555554
[   22.697943] Call Trace:
[   22.698108]  <TASK>
[   22.698253]  ? show_regs+0x6d/0x80
[   22.698482]  ? __warn+0xf3/0x380
[   22.698714]  ? report_bug+0x25e/0x4b0
[   22.698958]  ? iommufd_fops_release+0x392/0x420
[   22.699261]  ? report_bug+0x2cb/0x4b0
[   22.699510]  ? iommufd_fops_release+0x392/0x420
[   22.699811]  ? iommufd_fops_release+0x392/0x420
[   22.700111]  ? handle_bug+0x2cd/0x510
[   22.700355]  ? iommufd_fops_release+0x394/0x420
[   22.700657]  ? exc_invalid_op+0x3c/0x80
[   22.700915]  ? asm_exc_invalid_op+0x1f/0x30
[   22.701201]  ? iommufd_fops_release+0x21a/0x420
[   22.701548]  ? iommufd_fops_release+0x392/0x420
[   22.701885]  ? iommufd_fops_release+0x392/0x420
[   22.702227]  ? iommufd_fops_release+0x392/0x420
[   22.702534]  ? locks_remove_file+0x3b4/0x5d0
[   22.702824]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.703146]  ? __memcg_slab_free_hook+0xc1/0x540
[   22.703452]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   22.703804]  ? evm_file_release+0x141/0x220
[   22.704085]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.704409]  __fput+0x41c/0xb70
[   22.704627]  ____fput+0x22/0x30
[   22.704840]  task_work_run+0x19b/0x2b0
[   22.705099]  ? __pfx_task_work_run+0x10/0x10
[   22.705423]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   22.705804]  ? switch_task_namespaces+0xc6/0x110
[   22.706133]  do_exit+0xb0e/0x29d0
[   22.706360]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.706692]  ? __pfx_do_exit+0x10/0x10
[   22.706948]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.707262]  ? __x64_sys_ioctl+0x1ba/0x220
[   22.707537]  make_task_dead+0x181/0x3c0
[   22.707797]  rewind_stack_and_make_dead+0x16/0x20
[   22.708118] RIP: 0033:0x7f8c4743ee5d
[   22.708359] Code: Unable to access opcode bytes at 0x7f8c4743ee33.
[   22.708758] RSP: 002b:00007ffcf6a8c018 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.709246] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f8c4743ee5d
[   22.709706] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.710146] RBP: 00007ffcf6a8c030 R08: 0000000000000800 R09: 0000000000000800
[   22.710584] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcf6a8c148
[   22.711025] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f8c4774d000
[   22.711494]  </TASK>
[   22.711644] irq event stamp: 0
[   22.711838] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   22.712219] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   22.712735] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   22.713256] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   22.713664] ---[ end trace 0000000000000000 ]---
[   22.719204] iommufd_mock iommufd_mock6: Adding to iommu group 6
[   22.720063] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#7] SMP KASAN NOPTI
[   22.720736] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   22.721192] CPU: 0 UID: 0 PID: 735 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.721993] Tainted: [D]=DIE, [W]=WARN
[   22.722396] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.723081] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.723437] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.724519] RSP: 0018:ffff888026ebfb78 EFLAGS: 00010246
[   22.724839] RAX: dffffc0000000000 RBX: ffff888011120000 RCX: 1ffffffff0dd8bdc
[   22.725266] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff888017072d3c
[   22.725690] RBP: ffff888026ebfbc8 R08: 0000000000000000 R09: 0000000000000000
[   22.726113] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   22.726538] R13: 0000000000000001 R14: ffff888026ebfe18 R15: ffff88801614b808
[   22.726971] FS:  00007efc0fbac600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.727451] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.727798] CR2: 00000000200006c0 CR3: 0000000013454001 CR4: 0000000000770ef0
[   22.728224] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.728660] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.729106] PKRU: 55555554
[   22.729285] Call Trace:
[   22.729448]  <TASK>
[   22.729593]  ? show_regs+0x6d/0x80
[   22.729822]  ? die_addr+0x45/0xb0
[   22.730044]  ? exc_general_protection+0x1ad/0x340
[   22.730358]  ? asm_exc_general_protection+0x2b/0x30
[   22.730675]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.731005]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   22.731333]  iommufd_device_detach+0x2a/0x2e0
[   22.731617]  iommufd_test+0x2f99/0x5cd0
[   22.731873]  ? do_raw_spin_unlock+0x15c/0x210
[   22.732157]  ? __pfx_iommufd_test+0x10/0x10
[   22.732416]  ? debug_smp_processor_id+0x20/0x30
[   22.732699]  ? rcu_is_watching+0x19/0xc0
[   22.732948]  ? lock_release+0x1ea/0x2c0
[   22.733189]  ? __might_fault+0xf1/0x1b0
[   22.733436]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   22.733766]  iommufd_fops_ioctl+0x38e/0x520
[   22.734034]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.734327]  ? trace_irq_enable+0xd1/0x110
[   22.734591]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.734909]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.735202]  __x64_sys_ioctl+0x1ba/0x220
[   22.735451]  x64_sys_call+0x122e/0x2150
[   22.735693]  do_syscall_64+0x6d/0x150
[   22.735925]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   22.736231] RIP: 0033:0x7efc0f83ee5d
[   22.736458] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   22.737530] RSP: 002b:00007ffdf173c758 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.737979] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007efc0f83ee5d
[   22.738410] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.738837] RBP: 00007ffdf173c770 R08: 0000000000000800 R09: 0000000000000800
[   22.739259] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffdf173c888
[   22.739680] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007efc0fbf5000
[   22.740106]  </TASK>
[   22.740249] Modules linked in:
[   22.740529] ---[ end trace 0000000000000000 ]---
[   22.740813] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.741163] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.742290] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   22.742615] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   22.743060] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   22.743509] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   22.743938] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   22.744365] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   22.744798] FS:  00007efc0fbac600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.745274] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.745636] CR2: 00000000200006c0 CR3: 0000000013454001 CR4: 0000000000770ef0
[   22.746069] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.746501] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.746935] PKRU: 55555554
[   22.747923] ------------[ cut here ]------------
[   22.748220] WARNING: CPU: 0 PID: 735 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   22.748955] Modules linked in:
[   22.749162] CPU: 0 UID: 0 PID: 735 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.749897] Tainted: [D]=DIE, [W]=WARN
[   22.750130] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.750805] RIP: 0010:iommufd_fops_release+0x386/0x420
[   22.751123] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   22.752203] RSP: 0018:ffff888026ebfc08 EFLAGS: 00010293
[   22.752523] RAX: 0000000000000000 RBX: ffff888012dde008 RCX: ffffffff83afe4ca
[   22.752951] RDX: ffff888017072540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   22.753871] RBP: ffff888026ebfcb8 R08: 0000000000000000 R09: 0000000000000000
[   22.754354] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   22.754912] R13: 0000000000000000 R14: ffff888026ebfc50 R15: 0000000000000000
[   22.755343] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.755824] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.756173] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   22.756602] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.757029] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.757471] PKRU: 55555554
[   22.757646] Call Trace:
[   22.757805]  <TASK>
[   22.757945]  ? show_regs+0x6d/0x80
[   22.758174]  ? __warn+0xf3/0x380
[   22.758385]  ? report_bug+0x25e/0x4b0
[   22.758619]  ? iommufd_fops_release+0x386/0x420
[   22.758914]  ? report_bug+0x2cb/0x4b0
[   22.759154]  ? iommufd_fops_release+0x386/0x420
[   22.759447]  ? iommufd_fops_release+0x386/0x420
[   22.759739]  ? handle_bug+0x2cd/0x510
[   22.759981]  ? iommufd_fops_release+0x388/0x420
[   22.760276]  ? exc_invalid_op+0x3c/0x80
[   22.760529]  ? asm_exc_invalid_op+0x1f/0x30
[   22.760801]  ? iommufd_fops_release+0x21a/0x420
[   22.761093]  ? iommufd_fops_release+0x386/0x420
[   22.761403]  ? iommufd_fops_release+0x386/0x420
[   22.761699]  ? iommufd_fops_release+0x386/0x420
[   22.761989]  ? locks_remove_file+0x3b4/0x5d0
[   22.762270]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.762581]  ? __memcg_slab_free_hook+0xc1/0x540
[   22.762884]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   22.763236]  ? evm_file_release+0x141/0x220
[   22.763507]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.763819]  __fput+0x41c/0xb70
[   22.764033]  ____fput+0x22/0x30
[   22.764243]  task_work_run+0x19b/0x2b0
[   22.764490]  ? __pfx_task_work_run+0x10/0x10
[   22.764768]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   22.765106]  ? switch_task_namespaces+0xc6/0x110
[   22.765423]  do_exit+0xb0e/0x29d0
[   22.765647]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.765966]  ? __pfx_do_exit+0x10/0x10
[   22.766210]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.766511]  ? __x64_sys_ioctl+0x1ba/0x220
[   22.766781]  make_task_dead+0x181/0x3c0
[   22.767031]  rewind_stack_and_make_dead+0x16/0x20
[   22.767331] RIP: 0033:0x7efc0f83ee5d
[   22.767565] Code: Unable to access opcode bytes at 0x7efc0f83ee33.
[   22.767936] RSP: 002b:00007ffdf173c758 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.768399] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007efc0f83ee5d
[   22.768853] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.769297] RBP: 00007ffdf173c770 R08: 0000000000000800 R09: 0000000000000800
[   22.769754] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffdf173c888
[   22.770183] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007efc0fbf5000
[   22.770629]  </TASK>
[   22.770778] irq event stamp: 0
[   22.770979] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   22.771375] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   22.771908] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   22.772427] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   22.772830] ---[ end trace 0000000000000000 ]---
[   22.773193] ------------[ cut here ]------------
[   22.773495] WARNING: CPU: 0 PID: 735 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   22.774068] Modules linked in:
[   22.774271] CPU: 0 UID: 0 PID: 735 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.774990] Tainted: [D]=DIE, [W]=WARN
[   22.775229] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.775935] RIP: 0010:iommufd_fops_release+0x392/0x420
[   22.776266] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   22.777415] RSP: 0018:ffff888026ebfc08 EFLAGS: 00010293
[   22.777747] RAX: 0000000000000000 RBX: ffff888012dde008 RCX: ffffffff83afe4ca
[   22.778187] RDX: ffff888017072540 RSI: ffffffff83afe642 RDI: ffff888012dde0a0
[   22.778626] RBP: ffff888026ebfcb8 R08: 0000000000000000 R09: 0000000000000000
[   22.779068] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   22.779505] R13: 0000000000000000 R14: ffff888026ebfc50 R15: 0000000000000000
[   22.779946] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   22.780439] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.780797] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   22.781238] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.781698] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.782152] PKRU: 55555554
[   22.782334] Call Trace:
[   22.782496]  <TASK>
[   22.782639]  ? show_regs+0x6d/0x80
[   22.782869]  ? __warn+0xf3/0x380
[   22.783085]  ? report_bug+0x25e/0x4b0
[   22.783322]  ? iommufd_fops_release+0x392/0x420
[   22.783613]  ? report_bug+0x2cb/0x4b0
[   22.783853]  ? iommufd_fops_release+0x392/0x420
[   22.784144]  ? iommufd_fops_release+0x392/0x420
[   22.784434]  ? handle_bug+0x2cd/0x510
[   22.784673]  ? iommufd_fops_release+0x394/0x420
[   22.784965]  ? exc_invalid_op+0x3c/0x80
[   22.785215]  ? asm_exc_invalid_op+0x1f/0x30
[   22.785503]  ? iommufd_fops_release+0x21a/0x420
[   22.785790]  ? iommufd_fops_release+0x392/0x420
[   22.786075]  ? iommufd_fops_release+0x392/0x420
[   22.786356]  ? iommufd_fops_release+0x392/0x420
[   22.786645]  ? locks_remove_file+0x3b4/0x5d0
[   22.786930]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.787246]  ? __memcg_slab_free_hook+0xc1/0x540
[   22.787539]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   22.787878]  ? evm_file_release+0x141/0x220
[   22.788155]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.788472]  __fput+0x41c/0xb70
[   22.788684]  ____fput+0x22/0x30
[   22.788900]  task_work_run+0x19b/0x2b0
[   22.789145]  ? __pfx_task_work_run+0x10/0x10
[   22.789430]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   22.789765]  ? switch_task_namespaces+0xc6/0x110
[   22.790056]  do_exit+0xb0e/0x29d0
[   22.790272]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.790579]  ? __pfx_do_exit+0x10/0x10
[   22.790822]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.791135]  ? __x64_sys_ioctl+0x1ba/0x220
[   22.791406]  make_task_dead+0x181/0x3c0
[   22.791661]  rewind_stack_and_make_dead+0x16/0x20
[   22.791968] RIP: 0033:0x7efc0f83ee5d
[   22.792201] Code: Unable to access opcode bytes at 0x7efc0f83ee33.
[   22.792583] RSP: 002b:00007ffdf173c758 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.793051] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007efc0f83ee5d
[   22.793507] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.793957] RBP: 00007ffdf173c770 R08: 0000000000000800 R09: 0000000000000800
[   22.794402] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffdf173c888
[   22.794846] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007efc0fbf5000
[   22.795293]  </TASK>
[   22.795442] irq event stamp: 0
[   22.795642] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   22.796032] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   22.796540] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   22.797049] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   22.797454] ---[ end trace 0000000000000000 ]---
[   22.804347] iommufd_mock iommufd_mock7: Adding to iommu group 7
[   22.804903] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#8] SMP KASAN NOPTI
[   22.805756] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   22.806210] CPU: 1 UID: 0 PID: 736 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.806985] Tainted: [D]=DIE, [W]=WARN
[   22.807225] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.807959] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.808299] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.809333] RSP: 0018:ffff888026f37b78 EFLAGS: 00010246
[   22.809639] RAX: dffffc0000000000 RBX: ffff888010d32400 RCX: 1ffffffff0dd8bdd
[   22.810046] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801707527c
[   22.810454] RBP: ffff888026f37bc8 R08: 0000000000000000 R09: 0000000000000000
[   22.810865] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   22.811271] R13: 0000000000000001 R14: ffff888026f37e18 R15: ffff88800e92e408
[   22.811679] FS:  00007f5a7e5f4600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   22.812139] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.812479] CR2: 00000000200006c0 CR3: 0000000021422004 CR4: 0000000000770ef0
[   22.812891] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.813298] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.813706] PKRU: 55555554
[   22.813872] Call Trace:
[   22.814025]  <TASK>
[   22.814160]  ? show_regs+0x6d/0x80
[   22.814373]  ? die_addr+0x45/0xb0
[   22.814580]  ? exc_general_protection+0x1ad/0x340
[   22.814874]  ? asm_exc_general_protection+0x2b/0x30
[   22.815168]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.815472]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   22.815777]  iommufd_device_detach+0x2a/0x2e0
[   22.816044]  iommufd_test+0x2f99/0x5cd0
[   22.816277]  ? do_raw_spin_unlock+0x15c/0x210
[   22.816547]  ? __pfx_iommufd_test+0x10/0x10
[   22.816799]  ? debug_smp_processor_id+0x20/0x30
[   22.817074]  ? rcu_is_watching+0x19/0xc0
[   22.817314]  ? lock_release+0x1ea/0x2c0
[   22.817548]  ? __might_fault+0xf1/0x1b0
[   22.817786]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   22.818105]  iommufd_fops_ioctl+0x38e/0x520
[   22.818360]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.818644]  ? trace_irq_enable+0xd1/0x110
[   22.818902]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.819208]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.819488]  __x64_sys_ioctl+0x1ba/0x220
[   22.819726]  x64_sys_call+0x122e/0x2150
[   22.819955]  do_syscall_64+0x6d/0x150
[   22.820178]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   22.820472] RIP: 0033:0x7f5a7e23ee5d
[   22.820687] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   22.821711] RSP: 002b:00007ffe6f8d55d8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.822140] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f5a7e23ee5d
[   22.822542] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.822951] RBP: 00007ffe6f8d55f0 R08: 0000000000000800 R09: 0000000000000800
[   22.823352] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe6f8d5708
[   22.823755] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f5a7e63d000
[   22.824162]  </TASK>
[   22.824298] Modules linked in:
[   22.824583] ---[ end trace 0000000000000000 ]---
[   22.824865] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.825201] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.826295] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   22.826600] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   22.827012] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   22.827425] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   22.827834] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   22.828253] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   22.828678] FS:  00007f5a7e5f4600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   22.829130] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.829547] CR2: 00000000200006c0 CR3: 0000000021422004 CR4: 0000000000770ef0
[   22.830038] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.830459] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.830957] PKRU: 55555554
[   22.831701] ------------[ cut here ]------------
[   22.832055] WARNING: CPU: 1 PID: 736 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   22.832647] Modules linked in:
[   22.832910] CPU: 1 UID: 0 PID: 736 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.834188] Tainted: [D]=DIE, [W]=WARN
[   22.834435] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.835206] RIP: 0010:iommufd_fops_release+0x386/0x420
[   22.835556] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   22.836752] RSP: 0018:ffff888026f37c08 EFLAGS: 00010293
[   22.837172] RAX: 0000000000000000 RBX: ffff88801ac36808 RCX: ffffffff83afe4ca
[   22.837675] RDX: ffff888017074a80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   22.838176] RBP: ffff888026f37cb8 R08: 0000000000000000 R09: 0000000000000000
[   22.838600] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   22.839066] R13: 0000000000000000 R14: ffff888026f37c50 R15: 0000000000000000
[   22.839559] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   22.840068] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.840480] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   22.840934] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.841496] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.841907] PKRU: 55555554
[   22.842095] Call Trace:
[   22.842327]  <TASK>
[   22.842465]  ? show_regs+0x6d/0x80
[   22.842773]  ? __warn+0xf3/0x380
[   22.842997]  ? report_bug+0x25e/0x4b0
[   22.843266]  ? iommufd_fops_release+0x386/0x420
[   22.843623]  ? report_bug+0x2cb/0x4b0
[   22.843850]  ? iommufd_fops_release+0x386/0x420
[   22.844195]  ? iommufd_fops_release+0x386/0x420
[   22.844559]  ? handle_bug+0x2cd/0x510
[   22.844783]  ? iommufd_fops_release+0x388/0x420
[   22.845077]  ? exc_invalid_op+0x3c/0x80
[   22.845413]  ? asm_exc_invalid_op+0x1f/0x30
[   22.845757]  ? iommufd_fops_release+0x21a/0x420
[   22.846029]  ? iommufd_fops_release+0x386/0x420
[   22.846379]  ? iommufd_fops_release+0x386/0x420
[   22.846748]  ? iommufd_fops_release+0x386/0x420
[   22.847021]  ? locks_remove_file+0x3b4/0x5d0
[   22.847284]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.847642]  ? __memcg_slab_free_hook+0xc1/0x540
[   22.848012]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   22.848334]  ? evm_file_release+0x141/0x220
[   22.848653]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.849039]  __fput+0x41c/0xb70
[   22.849243]  ____fput+0x22/0x30
[   22.849501]  task_work_run+0x19b/0x2b0
[   22.849737]  ? __pfx_task_work_run+0x10/0x10
[   22.850056]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   22.850459]  ? switch_task_namespaces+0xc6/0x110
[   22.850753]  do_exit+0xb0e/0x29d0
[   22.850982]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.851399]  ? __pfx_do_exit+0x10/0x10
[   22.851636]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.851917]  ? __x64_sys_ioctl+0x1ba/0x220
[   22.852227]  make_task_dead+0x181/0x3c0
[   22.852548]  rewind_stack_and_make_dead+0x16/0x20
[   22.852825] RIP: 0033:0x7f5a7e23ee5d
[   22.853057] Code: Unable to access opcode bytes at 0x7f5a7e23ee33.
[   22.853543] RSP: 002b:00007ffe6f8d55d8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.854116] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f5a7e23ee5d
[   22.854523] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.854934] RBP: 00007ffe6f8d55f0 R08: 0000000000000800 R09: 0000000000000800
[   22.855339] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe6f8d5708
[   22.855768] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f5a7e63d000
[   22.856294]  </TASK>
[   22.856433] irq event stamp: 0
[   22.856619] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   22.857076] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   22.857617] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   22.858204] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   22.858578] ---[ end trace 0000000000000000 ]---
[   22.858932] ------------[ cut here ]------------
[   22.859278] WARNING: CPU: 1 PID: 736 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   22.859839] Modules linked in:
[   22.860039] CPU: 1 UID: 0 PID: 736 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.860819] Tainted: [D]=DIE, [W]=WARN
[   22.861059] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.861846] RIP: 0010:iommufd_fops_release+0x392/0x420
[   22.862164] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   22.863327] RSP: 0018:ffff888026f37c08 EFLAGS: 00010293
[   22.863705] RAX: 0000000000000000 RBX: ffff88801ac36808 RCX: ffffffff83afe4ca
[   22.864127] RDX: ffff888017074a80 RSI: ffffffff83afe642 RDI: ffff88801ac368a0
[   22.864611] RBP: ffff888026f37cb8 R08: 0000000000000000 R09: 0000000000000000
[   22.865020] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   22.865567] R13: 0000000000000000 R14: ffff888026f37c50 R15: 0000000000000000
[   22.865987] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   22.866478] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.866918] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   22.867345] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.867861] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.868311] PKRU: 55555554
[   22.868501] Call Trace:
[   22.868714]  <TASK>
[   22.868883]  ? show_regs+0x6d/0x80
[   22.869096]  ? __warn+0xf3/0x380
[   22.869300]  ? report_bug+0x25e/0x4b0
[   22.869587]  ? iommufd_fops_release+0x392/0x420
[   22.869912]  ? report_bug+0x2cb/0x4b0
[   22.870136]  ? iommufd_fops_release+0x392/0x420
[   22.870414]  ? iommufd_fops_release+0x392/0x420
[   22.870711]  ? handle_bug+0x2cd/0x510
[   22.871001]  ? iommufd_fops_release+0x394/0x420
[   22.871274]  ? exc_invalid_op+0x3c/0x80
[   22.871508]  ? asm_exc_invalid_op+0x1f/0x30
[   22.871816]  ? iommufd_fops_release+0x21a/0x420
[   22.872131]  ? iommufd_fops_release+0x392/0x420
[   22.872408]  ? iommufd_fops_release+0x392/0x420
[   22.872709]  ? iommufd_fops_release+0x392/0x420
[   22.873029]  ? locks_remove_file+0x3b4/0x5d0
[   22.873314]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.873673]  ? __memcg_slab_free_hook+0xc1/0x540
[   22.874003]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   22.874335]  ? evm_file_release+0x141/0x220
[   22.874594]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.874913]  __fput+0x41c/0xb70
[   22.875132]  ____fput+0x22/0x30
[   22.875386]  task_work_run+0x19b/0x2b0
[   22.875651]  ? __pfx_task_work_run+0x10/0x10
[   22.875910]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   22.876296]  ? switch_task_namespaces+0xc6/0x110
[   22.876607]  do_exit+0xb0e/0x29d0
[   22.876842]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.877215]  ? __pfx_do_exit+0x10/0x10
[   22.877529]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.877853]  ? __x64_sys_ioctl+0x1ba/0x220
[   22.878103]  make_task_dead+0x181/0x3c0
[   22.878393]  rewind_stack_and_make_dead+0x16/0x20
[   22.878674] RIP: 0033:0x7f5a7e23ee5d
[   22.878896] Code: Unable to access opcode bytes at 0x7f5a7e23ee33.
[   22.879283] RSP: 002b:00007ffe6f8d55d8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.879746] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f5a7e23ee5d
[   22.880170] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.880630] RBP: 00007ffe6f8d55f0 R08: 0000000000000800 R09: 0000000000000800
[   22.881040] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe6f8d5708
[   22.881500] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f5a7e63d000
[   22.881919]  </TASK>
[   22.882060] irq event stamp: 0
[   22.882246] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   22.882609] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   22.883087] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   22.883562] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   22.883932] ---[ end trace 0000000000000000 ]---
[   22.888166] iommufd_mock iommufd_mock8: Adding to iommu group 8
[   22.889365] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#9] SMP KASAN NOPTI
[   22.890009] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   22.890441] CPU: 1 UID: 0 PID: 737 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.891127] Tainted: [D]=DIE, [W]=WARN
[   22.891349] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.891990] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.892326] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.893363] RSP: 0018:ffff888026f97b78 EFLAGS: 00010246
[   22.893670] RAX: dffffc0000000000 RBX: ffff888010d33a00 RCX: 1ffffffff0dd8bdd
[   22.894078] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880172987fc
[   22.894485] RBP: ffff888026f97bc8 R08: 0000000000000000 R09: 0000000000000000
[   22.894899] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   22.895305] R13: 0000000000000001 R14: ffff888026f97e18 R15: ffff888010d3d008
[   22.895713] FS:  00007faede316600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   22.896170] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.896504] CR2: 000055f8b3c26a90 CR3: 0000000021422003 CR4: 0000000000770ef0
[   22.896914] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.897321] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.897728] PKRU: 55555554
[   22.897893] Call Trace:
[   22.898044]  <TASK>
[   22.898178]  ? show_regs+0x6d/0x80
[   22.898391]  ? die_addr+0x45/0xb0
[   22.898598]  ? exc_general_protection+0x1ad/0x340
[   22.898892]  ? asm_exc_general_protection+0x2b/0x30
[   22.899186]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.899491]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   22.899798]  iommufd_device_detach+0x2a/0x2e0
[   22.900066]  iommufd_test+0x2f99/0x5cd0
[   22.900299]  ? trace_hardirqs_on+0x51/0x60
[   22.900547]  ? irqentry_exit+0x3e/0xa0
[   22.900779]  ? __pfx_iommufd_test+0x10/0x10
[   22.901030]  ? debug_smp_processor_id+0x20/0x30
[   22.901305]  ? rcu_is_watching+0x19/0xc0
[   22.901547]  ? lock_release+0x1ea/0x2c0
[   22.901783]  ? __might_fault+0xf1/0x1b0
[   22.902021]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   22.902341]  iommufd_fops_ioctl+0x38e/0x520
[   22.902594]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.902891]  ? trace_irq_enable+0xd1/0x110
[   22.903145]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.903438]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.903717]  __x64_sys_ioctl+0x1ba/0x220
[   22.903955]  x64_sys_call+0x122e/0x2150
[   22.904185]  do_syscall_64+0x6d/0x150
[   22.904407]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   22.904703] RIP: 0033:0x7faede03ee5d
[   22.904918] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   22.905938] RSP: 002b:00007fff48fcd838 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.906366] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007faede03ee5d
[   22.906781] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.907190] RBP: 00007fff48fcd850 R08: 0000000000000800 R09: 0000000000000800
[   22.907597] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff48fcd968
[   22.908007] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007faede35f000
[   22.908422]  </TASK>
[   22.908560] Modules linked in:
[   22.908776] ---[ end trace 0000000000000000 ]---
[   22.909051] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.909395] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.910434] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   22.910746] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   22.911157] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   22.911565] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   22.911975] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   22.912384] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   22.912797] FS:  00007faede316600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   22.913259] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.913608] CR2: 000055f8b3c26a90 CR3: 0000000021422003 CR4: 0000000000770ef0
[   22.914020] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.914430] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.914842] PKRU: 55555554
[   22.915406] ------------[ cut here ]------------
[   22.915685] WARNING: CPU: 1 PID: 737 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   22.916230] Modules linked in:
[   22.916420] CPU: 1 UID: 0 PID: 737 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.917097] Tainted: [D]=DIE, [W]=WARN
[   22.917319] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.917982] RIP: 0010:iommufd_fops_release+0x386/0x420
[   22.918288] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   22.919332] RSP: 0018:ffff888026f97c08 EFLAGS: 00010293
[   22.919639] RAX: 0000000000000000 RBX: ffff88802143a808 RCX: ffffffff83afe4ca
[   22.920048] RDX: ffff888017298000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   22.920457] RBP: ffff888026f97cb8 R08: 0000000000000000 R09: 0000000000000000
[   22.920877] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   22.921282] R13: 0000000000000000 R14: ffff888026f97c50 R15: 0000000000000000
[   22.921703] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   22.922164] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.922495] CR2: 000055f8b3c26a90 CR3: 0000000007086001 CR4: 0000000000770ef0
[   22.922907] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.923309] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.923712] PKRU: 55555554
[   22.923876] Call Trace:
[   22.924025]  <TASK>
[   22.924157]  ? show_regs+0x6d/0x80
[   22.924366]  ? __warn+0xf3/0x380
[   22.924566]  ? report_bug+0x25e/0x4b0
[   22.924788]  ? iommufd_fops_release+0x386/0x420
[   22.925059]  ? report_bug+0x2cb/0x4b0
[   22.925283]  ? iommufd_fops_release+0x386/0x420
[   22.925571]  ? iommufd_fops_release+0x386/0x420
[   22.925842]  ? handle_bug+0x2cd/0x510
[   22.926064]  ? iommufd_fops_release+0x388/0x420
[   22.926335]  ? exc_invalid_op+0x3c/0x80
[   22.926566]  ? asm_exc_invalid_op+0x1f/0x30
[   22.926820]  ? iommufd_fops_release+0x21a/0x420
[   22.927090]  ? iommufd_fops_release+0x386/0x420
[   22.927359]  ? iommufd_fops_release+0x386/0x420
[   22.927628]  ? iommufd_fops_release+0x386/0x420
[   22.927896]  ? locks_remove_file+0x3b4/0x5d0
[   22.928157]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.928442]  ? __memcg_slab_free_hook+0xc1/0x540
[   22.928718]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   22.929031]  ? evm_file_release+0x141/0x220
[   22.929285]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.929591]  __fput+0x41c/0xb70
[   22.929790]  ____fput+0x22/0x30
[   22.929983]  task_work_run+0x19b/0x2b0
[   22.930214]  ? __pfx_task_work_run+0x10/0x10
[   22.930469]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   22.930788]  ? switch_task_namespaces+0xc6/0x110
[   22.931073]  do_exit+0xb0e/0x29d0
[   22.931283]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.931577]  ? __pfx_do_exit+0x10/0x10
[   22.931805]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.932087]  ? __x64_sys_ioctl+0x1ba/0x220
[   22.932334]  make_task_dead+0x181/0x3c0
[   22.932574]  rewind_stack_and_make_dead+0x16/0x20
[   22.932854] RIP: 0033:0x7faede03ee5d
[   22.933071] Code: Unable to access opcode bytes at 0x7faede03ee33.
[   22.933438] RSP: 002b:00007fff48fcd838 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.933873] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007faede03ee5d
[   22.934279] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.934685] RBP: 00007fff48fcd850 R08: 0000000000000800 R09: 0000000000000800
[   22.935101] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff48fcd968
[   22.935511] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007faede35f000
[   22.935920]  </TASK>
[   22.936058] irq event stamp: 0
[   22.936244] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   22.936604] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   22.937074] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   22.937557] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   22.937920] ---[ end trace 0000000000000000 ]---
[   22.938239] ------------[ cut here ]------------
[   22.938507] WARNING: CPU: 1 PID: 737 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   22.939051] Modules linked in:
[   22.939240] CPU: 1 UID: 0 PID: 737 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.939913] Tainted: [D]=DIE, [W]=WARN
[   22.940133] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.940768] RIP: 0010:iommufd_fops_release+0x392/0x420
[   22.941070] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   22.942112] RSP: 0018:ffff888026f97c08 EFLAGS: 00010293
[   22.942419] RAX: 0000000000000000 RBX: ffff88802143a808 RCX: ffffffff83afe4ca
[   22.942828] RDX: ffff888017298000 RSI: ffffffff83afe642 RDI: ffff88802143a8a0
[   22.943234] RBP: ffff888026f97cb8 R08: 0000000000000000 R09: 0000000000000000
[   22.943640] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   22.944046] R13: 0000000000000000 R14: ffff888026f97c50 R15: 0000000000000000
[   22.944451] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   22.944908] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.945240] CR2: 000055f8b3c26a90 CR3: 0000000007086001 CR4: 0000000000770ef0
[   22.945667] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.946073] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.946487] PKRU: 55555554
[   22.946652] Call Trace:
[   22.946807]  <TASK>
[   22.946941]  ? show_regs+0x6d/0x80
[   22.947150]  ? __warn+0xf3/0x380
[   22.947350]  ? report_bug+0x25e/0x4b0
[   22.947571]  ? iommufd_fops_release+0x392/0x420
[   22.947843]  ? report_bug+0x2cb/0x4b0
[   22.948065]  ? iommufd_fops_release+0x392/0x420
[   22.948334]  ? iommufd_fops_release+0x392/0x420
[   22.948605]  ? handle_bug+0x2cd/0x510
[   22.948827]  ? iommufd_fops_release+0x394/0x420
[   22.949100]  ? exc_invalid_op+0x3c/0x80
[   22.949344]  ? asm_exc_invalid_op+0x1f/0x30
[   22.949597]  ? iommufd_fops_release+0x21a/0x420
[   22.949867]  ? iommufd_fops_release+0x392/0x420
[   22.950139]  ? iommufd_fops_release+0x392/0x420
[   22.950409]  ? iommufd_fops_release+0x392/0x420
[   22.950681]  ? locks_remove_file+0x3b4/0x5d0
[   22.950944]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.951232]  ? __memcg_slab_free_hook+0xc1/0x540
[   22.951508]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   22.951831]  ? evm_file_release+0x141/0x220
[   22.952083]  ? __pfx_iommufd_fops_release+0x10/0x10
[   22.952373]  __fput+0x41c/0xb70
[   22.952782]  ____fput+0x22/0x30
[   22.952979]  task_work_run+0x19b/0x2b0
[   22.953209]  ? __pfx_task_work_run+0x10/0x10
[   22.953483]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   22.953800]  ? switch_task_namespaces+0xc6/0x110
[   22.954079]  do_exit+0xb0e/0x29d0
[   22.954285]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.954579]  ? __pfx_do_exit+0x10/0x10
[   22.954813]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.955093]  ? __x64_sys_ioctl+0x1ba/0x220
[   22.955410]  make_task_dead+0x181/0x3c0
[   22.955724]  rewind_stack_and_make_dead+0x16/0x20
[   22.956014] RIP: 0033:0x7faede03ee5d
[   22.956231] Code: Unable to access opcode bytes at 0x7faede03ee33.
[   22.956648] RSP: 002b:00007fff48fcd838 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.957164] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007faede03ee5d
[   22.957584] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.957995] RBP: 00007fff48fcd850 R08: 0000000000000800 R09: 0000000000000800
[   22.958402] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff48fcd968
[   22.958829] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007faede35f000
[   22.959346]  </TASK>
[   22.959485] irq event stamp: 0
[   22.959670] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   22.960031] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   22.960569] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   22.961150] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   22.961533] ---[ end trace 0000000000000000 ]---
[   22.966288] iommufd_mock iommufd_mock9: Adding to iommu group 9
[   22.967620] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#10] SMP KASAN NOPTI
[   22.968310] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   22.968840] CPU: 1 UID: 0 PID: 738 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.969521] Tainted: [D]=DIE, [W]=WARN
[   22.969746] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.970505] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.970853] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.972004] RSP: 0018:ffff888012d57b78 EFLAGS: 00010246
[   22.972314] RAX: dffffc0000000000 RBX: ffff888010d32800 RCX: 1ffffffff0dd8bdd
[   22.972726] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880170707fc
[   22.973187] RBP: ffff888012d57bc8 R08: 0000000000000000 R09: 0000000000000000
[   22.973677] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   22.974088] R13: 0000000000000001 R14: ffff888012d57e18 R15: ffff888010d3d808
[   22.974541] FS:  00007f313193f600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   22.975093] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.975430] CR2: 000055dee2f4c790 CR3: 0000000010e68002 CR4: 0000000000770ef0
[   22.975886] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.976373] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.976784] PKRU: 55555554
[   22.976950] Call Trace:
[   22.977123]  <TASK>
[   22.977288]  ? show_regs+0x6d/0x80
[   22.977582]  ? die_addr+0x45/0xb0
[   22.977790]  ? exc_general_protection+0x1ad/0x340
[   22.978083]  ? asm_exc_general_protection+0x2b/0x30
[   22.978379]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.978732]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   22.979116]  iommufd_device_detach+0x2a/0x2e0
[   22.979386]  iommufd_test+0x2f99/0x5cd0
[   22.979621]  ? do_raw_spin_unlock+0x15c/0x210
[   22.979936]  ? __pfx_iommufd_test+0x10/0x10
[   22.980272]  ? debug_smp_processor_id+0x20/0x30
[   22.980546]  ? rcu_is_watching+0x19/0xc0
[   22.980787]  ? lock_release+0x1ea/0x2c0
[   22.981075]  ? __might_fault+0xf1/0x1b0
[   22.981314]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   22.981717]  iommufd_fops_ioctl+0x38e/0x520
[   22.981970]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.982253]  ? trace_irq_enable+0xd1/0x110
[   22.982552]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   22.982939]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   22.983222]  __x64_sys_ioctl+0x1ba/0x220
[   22.983463]  x64_sys_call+0x122e/0x2150
[   22.983694]  do_syscall_64+0x6d/0x150
[   22.983919]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   22.984273] RIP: 0033:0x7f313163ee5d
[   22.984583] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   22.985669] RSP: 002b:00007ffce4fffaa8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   22.986187] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f313163ee5d
[   22.986605] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   22.987123] RBP: 00007ffce4fffac0 R08: 0000000000000800 R09: 0000000000000800
[   22.987541] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffce4fffbd8
[   22.987998] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f3131988000
[   22.988491]  </TASK>
[   22.988629] Modules linked in:
[   22.988862] ---[ end trace 0000000000000000 ]---
[   22.989136] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   22.989484] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   22.990540] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   22.990906] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   22.991342] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   22.991751] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   22.992165] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   22.992575] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   22.992989] FS:  00007f313193f600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   22.993486] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   22.993829] CR2: 000055dee2f4c790 CR3: 0000000010e68002 CR4: 0000000000770ef0
[   22.994241] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   22.994669] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   22.995089] PKRU: 55555554
[   22.995652] ------------[ cut here ]------------
[   22.995936] WARNING: CPU: 1 PID: 738 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   22.996489] Modules linked in:
[   22.996682] CPU: 1 UID: 0 PID: 738 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   22.997437] Tainted: [D]=DIE, [W]=WARN
[   22.997666] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   22.998323] RIP: 0010:iommufd_fops_release+0x386/0x420
[   22.998632] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   22.999688] RSP: 0018:ffff888012d57c08 EFLAGS: 00010293
[   22.999997] RAX: 0000000000000000 RBX: ffff88802143f808 RCX: ffffffff83afe4ca
[   23.000412] RDX: ffff888017070000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   23.000824] RBP: ffff888012d57cb8 R08: 0000000000000000 R09: 0000000000000000
[   23.001235] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   23.001697] R13: 0000000000000000 R14: ffff888012d57c50 R15: 0000000000000000
[   23.002119] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   23.002581] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.002921] CR2: 000055dee2f4c790 CR3: 0000000007086005 CR4: 0000000000770ef0
[   23.003334] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.003746] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.004158] PKRU: 55555554
[   23.004325] Call Trace:
[   23.004476]  <TASK>
[   23.004611]  ? show_regs+0x6d/0x80
[   23.004825]  ? __warn+0xf3/0x380
[   23.005032]  ? report_bug+0x25e/0x4b0
[   23.005258]  ? iommufd_fops_release+0x386/0x420
[   23.005602]  ? report_bug+0x2cb/0x4b0
[   23.005836]  ? iommufd_fops_release+0x386/0x420
[   23.006117]  ? iommufd_fops_release+0x386/0x420
[   23.006395]  ? handle_bug+0x2cd/0x510
[   23.006623]  ? iommufd_fops_release+0x388/0x420
[   23.006903]  ? exc_invalid_op+0x3c/0x80
[   23.007140]  ? asm_exc_invalid_op+0x1f/0x30
[   23.007394]  ? iommufd_fops_release+0x21a/0x420
[   23.007677]  ? iommufd_fops_release+0x386/0x420
[   23.007952]  ? iommufd_fops_release+0x386/0x420
[   23.008223]  ? iommufd_fops_release+0x386/0x420
[   23.008494]  ? locks_remove_file+0x3b4/0x5d0
[   23.008762]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.009050]  ? __memcg_slab_free_hook+0xc1/0x540
[   23.009373]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   23.009701]  ? evm_file_release+0x141/0x220
[   23.009962]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.010258]  __fput+0x41c/0xb70
[   23.010463]  ____fput+0x22/0x30
[   23.010658]  task_work_run+0x19b/0x2b0
[   23.010897]  ? __pfx_task_work_run+0x10/0x10
[   23.011155]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   23.011475]  ? switch_task_namespaces+0xc6/0x110
[   23.011755]  do_exit+0xb0e/0x29d0
[   23.011962]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.012257]  ? __pfx_do_exit+0x10/0x10
[   23.012487]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.012767]  ? __x64_sys_ioctl+0x1ba/0x220
[   23.013016]  make_task_dead+0x181/0x3c0
[   23.013250]  rewind_stack_and_make_dead+0x16/0x20
[   23.013575] RIP: 0033:0x7f313163ee5d
[   23.013799] Code: Unable to access opcode bytes at 0x7f313163ee33.
[   23.014166] RSP: 002b:00007ffce4fffaa8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.014606] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f313163ee5d
[   23.015017] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.015423] RBP: 00007ffce4fffac0 R08: 0000000000000800 R09: 0000000000000800
[   23.015830] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffce4fffbd8
[   23.016235] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f3131988000
[   23.016649]  </TASK>
[   23.016788] irq event stamp: 0
[   23.016974] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   23.017378] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   23.017864] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   23.018333] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   23.018693] ---[ end trace 0000000000000000 ]---
[   23.019022] ------------[ cut here ]------------
[   23.019292] WARNING: CPU: 1 PID: 738 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   23.019837] Modules linked in:
[   23.020027] CPU: 1 UID: 0 PID: 738 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.020704] Tainted: [D]=DIE, [W]=WARN
[   23.020927] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.021617] RIP: 0010:iommufd_fops_release+0x392/0x420
[   23.021933] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   23.022975] RSP: 0018:ffff888012d57c08 EFLAGS: 00010293
[   23.023284] RAX: 0000000000000000 RBX: ffff88802143f808 RCX: ffffffff83afe4ca
[   23.023698] RDX: ffff888017070000 RSI: ffffffff83afe642 RDI: ffff88802143f8a0
[   23.024111] RBP: ffff888012d57cb8 R08: 0000000000000000 R09: 0000000000000000
[   23.024527] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   23.024937] R13: 0000000000000000 R14: ffff888012d57c50 R15: 0000000000000000
[   23.025384] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   23.025860] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.026197] CR2: 000055dee2f4c790 CR3: 0000000007086005 CR4: 0000000000770ef0
[   23.026611] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.027025] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.027438] PKRU: 55555554
[   23.027604] Call Trace:
[   23.027757]  <TASK>
[   23.027892]  ? show_regs+0x6d/0x80
[   23.028104]  ? __warn+0xf3/0x380
[   23.028306]  ? report_bug+0x25e/0x4b0
[   23.028529]  ? iommufd_fops_release+0x392/0x420
[   23.028803]  ? report_bug+0x2cb/0x4b0
[   23.029028]  ? iommufd_fops_release+0x392/0x420
[   23.029302]  ? iommufd_fops_release+0x392/0x420
[   23.029614]  ? handle_bug+0x2cd/0x510
[   23.029849]  ? iommufd_fops_release+0x394/0x420
[   23.030133]  ? exc_invalid_op+0x3c/0x80
[   23.030377]  ? asm_exc_invalid_op+0x1f/0x30
[   23.030632]  ? iommufd_fops_release+0x21a/0x420
[   23.030908]  ? iommufd_fops_release+0x392/0x420
[   23.031183]  ? iommufd_fops_release+0x392/0x420
[   23.031459]  ? iommufd_fops_release+0x392/0x420
[   23.031732]  ? locks_remove_file+0x3b4/0x5d0
[   23.031993]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.032290]  ? __memcg_slab_free_hook+0xc1/0x540
[   23.032579]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   23.032898]  ? evm_file_release+0x141/0x220
[   23.033152]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.033476]  __fput+0x41c/0xb70
[   23.033682]  ____fput+0x22/0x30
[   23.033881]  task_work_run+0x19b/0x2b0
[   23.034117]  ? __pfx_task_work_run+0x10/0x10
[   23.034378]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   23.034699]  ? switch_task_namespaces+0xc6/0x110
[   23.034991]  do_exit+0xb0e/0x29d0
[   23.035199]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.035496]  ? __pfx_do_exit+0x10/0x10
[   23.035724]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.036003]  ? __x64_sys_ioctl+0x1ba/0x220
[   23.036249]  make_task_dead+0x181/0x3c0
[   23.036482]  rewind_stack_and_make_dead+0x16/0x20
[   23.036761] RIP: 0033:0x7f313163ee5d
[   23.036980] Code: Unable to access opcode bytes at 0x7f313163ee33.
[   23.037369] RSP: 002b:00007ffce4fffaa8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.037811] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f313163ee5d
[   23.038229] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.038640] RBP: 00007ffce4fffac0 R08: 0000000000000800 R09: 0000000000000800
[   23.039054] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffce4fffbd8
[   23.039465] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f3131988000
[   23.039882]  </TASK>
[   23.040025] irq event stamp: 0
[   23.040213] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   23.040577] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   23.041052] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   23.041563] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   23.041942] ---[ end trace 0000000000000000 ]---
[   23.046824] iommufd_mock iommufd_mock10: Adding to iommu group 10
[   23.049868] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#11] SMP KASAN NOPTI
[   23.051587] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   23.052101] CPU: 0 UID: 0 PID: 739 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.052893] Tainted: [D]=DIE, [W]=WARN
[   23.053152] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.053893] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.054284] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   23.055505] RSP: 0018:ffff888012a3fb78 EFLAGS: 00010246
[   23.055864] RAX: dffffc0000000000 RBX: ffff888011121400 RCX: 1ffffffff0dd8bdc
[   23.056344] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880115687fc
[   23.056823] RBP: ffff888012a3fbc8 R08: 0000000000000000 R09: 0000000000000000
[   23.057298] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   23.057777] R13: 0000000000000001 R14: ffff888012a3fe18 R15: ffff888010759c08
[   23.058256] FS:  00007f64208d5600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.058799] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.059188] CR2: 000055dee2f4abbc CR3: 0000000010e68002 CR4: 0000000000770ef0
[   23.059669] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.060147] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.060626] PKRU: 55555554
[   23.060818] Call Trace:
[   23.060995]  <TASK>
[   23.061152]  ? show_regs+0x6d/0x80
[   23.061400]  ? die_addr+0x45/0xb0
[   23.061641]  ? exc_general_protection+0x1ad/0x340
[   23.061980]  ? asm_exc_general_protection+0x2b/0x30
[   23.062322]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.062678]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   23.063042]  iommufd_device_detach+0x2a/0x2e0
[   23.063354]  iommufd_test+0x2f99/0x5cd0
[   23.063628]  ? do_raw_spin_unlock+0x15c/0x210
[   23.063941]  ? __pfx_iommufd_test+0x10/0x10
[   23.064235]  ? debug_smp_processor_id+0x20/0x30
[   23.064561]  ? rcu_is_watching+0x19/0xc0
[   23.064860]  ? lock_release+0x1ea/0x2c0
[   23.065141]  ? __might_fault+0xf1/0x1b0
[   23.065428]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   23.065816]  iommufd_fops_ioctl+0x38e/0x520
[   23.066123]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.066457]  ? trace_irq_enable+0xd1/0x110
[   23.066758]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.067106]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.067439]  __x64_sys_ioctl+0x1ba/0x220
[   23.067720]  x64_sys_call+0x122e/0x2150
[   23.067992]  do_syscall_64+0x6d/0x150
[   23.068257]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   23.068607] RIP: 0033:0x7f642063ee5d
[   23.068864] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   23.070083] RSP: 002b:00007ffd5338f338 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.070594] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f642063ee5d
[   23.071076] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.071553] RBP: 00007ffd5338f350 R08: 0000000000000800 R09: 0000000000000800
[   23.072033] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd5338f468
[   23.072513] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f642091e000
[   23.072998]  </TASK>
[   23.073159] Modules linked in:
[   23.073463] ---[ end trace 0000000000000000 ]---
[   23.073789] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.074185] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   23.075409] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   23.075769] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   23.076250] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   23.076610] systemd-journald[145]: Data hash table of /run/log/journal/938775788448454bb5b34822d5730c41/system.journal has a fill level at 75.0 (5259 of 7011 items, 4038656 file size, 767 bytes per hash table item), suggesting rotation.
[   23.076726] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   23.076733] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   23.076738] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   23.082956] systemd-journald[145]: /run/log/journal/938775788448454bb5b34822d5730c41/system.journal: Journal header limits reached or header out-of-date, rotating.
[   23.083290] FS:  00007f64208d5600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.087946] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.088574] CR2: 000055dee2f4abbc CR3: 0000000010e68002 CR4: 0000000000770ef0
[   23.089391] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.090157] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.090934] PKRU: 55555554
[   23.131008] ------------[ cut here ]------------
[   23.131629] WARNING: CPU: 1 PID: 739 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   23.132933] Modules linked in:
[   23.133311] CPU: 1 UID: 0 PID: 739 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.134695] Tainted: [D]=DIE, [W]=WARN
[   23.135212] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.136395] RIP: 0010:iommufd_fops_release+0x386/0x420
[   23.136953] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   23.138890] RSP: 0018:ffff888012a3fc08 EFLAGS: 00010293
[   23.139446] RAX: 0000000000000000 RBX: ffff888021439808 RCX: ffffffff83afe4ca
[   23.140192] RDX: ffff888011568000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   23.140938] RBP: ffff888012a3fcb8 R08: 0000000000000000 R09: 0000000000000000
[   23.141702] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   23.142454] R13: 0000000000000000 R14: ffff888012a3fc50 R15: 0000000000000000
[   23.143201] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   23.144039] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.144649] CR2: 00007f25f8d76930 CR3: 0000000007086001 CR4: 0000000000770ef0
[   23.145421] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.146170] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.146920] PKRU: 55555554
[   23.147223] Call Trace:
[   23.147500]  <TASK>
[   23.147746]  ? show_regs+0x6d/0x80
[   23.148135]  ? __warn+0xf3/0x380
[   23.148502]  ? report_bug+0x25e/0x4b0
[   23.148913]  ? iommufd_fops_release+0x386/0x420
[   23.149429]  ? report_bug+0x2cb/0x4b0
[   23.149840]  ? iommufd_fops_release+0x386/0x420
[   23.150337]  ? iommufd_fops_release+0x386/0x420
[   23.150838]  ? handle_bug+0x2cd/0x510
[   23.151248]  ? iommufd_fops_release+0x388/0x420
[   23.151746]  ? exc_invalid_op+0x3c/0x80
[   23.152171]  ? asm_exc_invalid_op+0x1f/0x30
[   23.152632]  ? iommufd_fops_release+0x21a/0x420
[   23.153127]  ? iommufd_fops_release+0x386/0x420
[   23.153642]  ? iommufd_fops_release+0x386/0x420
[   23.154141]  ? iommufd_fops_release+0x386/0x420
[   23.154638]  ? locks_remove_file+0x3b4/0x5d0
[   23.155125]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.155657]  ? __memcg_slab_free_hook+0xc1/0x540
[   23.156167]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   23.156751]  ? evm_file_release+0x141/0x220
[   23.157217]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.157769]  __fput+0x41c/0xb70
[   23.158135]  ____fput+0x22/0x30
[   23.158492]  task_work_run+0x19b/0x2b0
[   23.158918]  ? __pfx_task_work_run+0x10/0x10
[   23.159389]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   23.159972]  ? switch_task_namespaces+0xc6/0x110
[   23.160485]  do_exit+0xb0e/0x29d0
[   23.160863]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.161430]  ? __pfx_do_exit+0x10/0x10
[   23.161852]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.162371]  ? __x64_sys_ioctl+0x1ba/0x220
[   23.162832]  make_task_dead+0x181/0x3c0
[   23.163260]  rewind_stack_and_make_dead+0x16/0x20
[   23.163770] RIP: 0033:0x7f642063ee5d
[   23.164170] Code: Unable to access opcode bytes at 0x7f642063ee33.
[   23.164821] RSP: 002b:00007ffd5338f338 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.165635] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f642063ee5d
[   23.166399] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.167150] RBP: 00007ffd5338f350 R08: 0000000000000800 R09: 0000000000000800
[   23.167895] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd5338f468
[   23.168643] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f642091e000
[   23.169420]  </TASK>
[   23.169682] irq event stamp: 0
[   23.170022] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   23.170686] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   23.171552] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   23.172416] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   23.173084] ---[ end trace 0000000000000000 ]---
[   23.173682] ------------[ cut here ]------------
[   23.174177] WARNING: CPU: 1 PID: 739 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   23.175177] Modules linked in:
[   23.175524] CPU: 1 UID: 0 PID: 739 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.176761] Tainted: [D]=DIE, [W]=WARN
[   23.177169] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.178364] RIP: 0010:iommufd_fops_release+0x392/0x420
[   23.178935] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   23.181084] RSP: 0018:ffff888012a3fc08 EFLAGS: 00010293
[   23.181676] RAX: 0000000000000000 RBX: ffff888021439808 RCX: ffffffff83afe4ca
[   23.182425] RDX: ffff888011568000 RSI: ffffffff83afe642 RDI: ffff8880214398a0
[   23.183190] RBP: ffff888012a3fcb8 R08: 0000000000000000 R09: 0000000000000000
[   23.183938] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   23.184688] R13: 0000000000000000 R14: ffff888012a3fc50 R15: 0000000000000000
[   23.185458] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   23.186302] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.186918] CR2: 00007f25f8d76930 CR3: 0000000007086001 CR4: 0000000000770ef0
[   23.187671] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.188421] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.189169] PKRU: 55555554
[   23.189495] Call Trace:
[   23.189775]  <TASK>
[   23.190021]  ? show_regs+0x6d/0x80
[   23.190403]  ? __warn+0xf3/0x380
[   23.190776]  ? report_bug+0x25e/0x4b0
[   23.191180]  ? iommufd_fops_release+0x392/0x420
[   23.191679]  ? report_bug+0x2cb/0x4b0
[   23.192089]  ? iommufd_fops_release+0x392/0x420
[   23.192591]  ? iommufd_fops_release+0x392/0x420
[   23.193087]  ? handle_bug+0x2cd/0x510
[   23.193518]  ? iommufd_fops_release+0x394/0x420
[   23.194026]  ? exc_invalid_op+0x3c/0x80
[   23.194454]  ? asm_exc_invalid_op+0x1f/0x30
[   23.194920]  ? iommufd_fops_release+0x21a/0x420
[   23.195416]  ? iommufd_fops_release+0x392/0x420
[   23.195913]  ? iommufd_fops_release+0x392/0x420
[   23.196410]  ? iommufd_fops_release+0x392/0x420
[   23.196908]  ? locks_remove_file+0x3b4/0x5d0
[   23.197414]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.197948]  ? __memcg_slab_free_hook+0xc1/0x540
[   23.198457]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   23.199059]  ? evm_file_release+0x141/0x220
[   23.199522]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.200049]  __fput+0x41c/0xb70
[   23.200410]  ____fput+0x22/0x30
[   23.200764]  task_work_run+0x19b/0x2b0
[   23.201186]  ? __pfx_task_work_run+0x10/0x10
[   23.201675]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   23.202267]  ? switch_task_namespaces+0xc6/0x110
[   23.202785]  do_exit+0xb0e/0x29d0
[   23.203161]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.203701]  ? __pfx_do_exit+0x10/0x10
[   23.204118]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.204630]  ? __x64_sys_ioctl+0x1ba/0x220
[   23.205081]  make_task_dead+0x181/0x3c0
[   23.205532]  rewind_stack_and_make_dead+0x16/0x20
[   23.206045] RIP: 0033:0x7f642063ee5d
[   23.206439] Code: Unable to access opcode bytes at 0x7f642063ee33.
[   23.207092] RSP: 002b:00007ffd5338f338 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.207888] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f642063ee5d
[   23.208634] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.209405] RBP: 00007ffd5338f350 R08: 0000000000000800 R09: 0000000000000800
[   23.210156] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd5338f468
[   23.210916] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f642091e000
[   23.211834]  </TASK>
[   23.212088] irq event stamp: 0
[   23.212427] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   23.213129] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   23.214109] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   23.214988] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   23.215791] ---[ end trace 0000000000000000 ]---
[   23.224606] iommufd_mock iommufd_mock11: Adding to iommu group 11
[   23.227716] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#12] SMP KASAN NOPTI
[   23.229282] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   23.230298] CPU: 1 UID: 0 PID: 741 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.231839] Tainted: [D]=DIE, [W]=WARN
[   23.232285] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.233459] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.234087] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   23.236003] RSP: 0018:ffff88801f987b78 EFLAGS: 00010246
[   23.236562] RAX: dffffc0000000000 RBX: ffff888010d32600 RCX: 1ffffffff0dd8bdd
[   23.237308] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff888021582d3c
[   23.238054] RBP: ffff88801f987bc8 R08: 0000000000000000 R09: 0000000000000000
[   23.238807] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   23.239555] R13: 0000000000000001 R14: ffff88801f987e18 R15: ffff888010e22808
[   23.240303] FS:  00007f9761dc4600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   23.241145] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.241754] CR2: 000055dee2f4abbc CR3: 000000000ff76004 CR4: 0000000000770ef0
[   23.242504] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.243257] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.244005] PKRU: 55555554
[   23.244307] Call Trace:
[   23.244585]  <TASK>
[   23.244835]  ? show_regs+0x6d/0x80
[   23.245231]  ? die_addr+0x45/0xb0
[   23.245646]  ? exc_general_protection+0x1ad/0x340
[   23.246213]  ? asm_exc_general_protection+0x2b/0x30
[   23.246840]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.247438]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   23.248046]  iommufd_device_detach+0x2a/0x2e0
[   23.248571]  iommufd_test+0x2f99/0x5cd0
[   23.249033]  ? do_raw_spin_unlock+0x15c/0x210
[   23.249581]  ? __pfx_iommufd_test+0x10/0x10
[   23.250081]  ? debug_smp_processor_id+0x20/0x30
[   23.250632]  ? rcu_is_watching+0x19/0xc0
[   23.251124]  ? lock_release+0x1ea/0x2c0
[   23.251587]  ? __might_fault+0xf1/0x1b0
[   23.252055]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   23.252693]  iommufd_fops_ioctl+0x38e/0x520
[   23.253208]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.253790]  ? trace_irq_enable+0xd1/0x110
[   23.254294]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.254878]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.255426]  __x64_sys_ioctl+0x1ba/0x220
[   23.255895]  x64_sys_call+0x122e/0x2150
[   23.256354]  do_syscall_64+0x6d/0x150
[   23.256787]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   23.257380] RIP: 0033:0x7f9761a3ee5d
[   23.257807] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   23.259837] RSP: 002b:00007ffd1d008ba8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.260692] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f9761a3ee5d
[   23.261520] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.262327] RBP: 00007ffd1d008bc0 R08: 0000000000000800 R09: 0000000000000800
[   23.263082] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd1d008cd8
[   23.263827] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f9761e0d000
[   23.264583]  </TASK>
[   23.264846] Modules linked in:
[   23.265297] ---[ end trace 0000000000000000 ]---
[   23.265910] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.266543] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   23.268462] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   23.269012] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   23.269832] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   23.270562] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   23.271296] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   23.272025] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   23.272752] FS:  00007f9761dc4600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   23.273639] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.274254] CR2: 000055dee2f4abbc CR3: 000000000ff76004 CR4: 0000000000770ef0
[   23.275006] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.275734] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.276461] PKRU: 55555554
[   23.277566] ------------[ cut here ]------------
[   23.278062] WARNING: CPU: 0 PID: 741 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   23.278980] Modules linked in:
[   23.279297] CPU: 0 UID: 0 PID: 741 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.280416] Tainted: [D]=DIE, [W]=WARN
[   23.280791] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.282236] RIP: 0010:iommufd_fops_release+0x386/0x420
[   23.282760] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   23.284517] RSP: 0018:ffff88801f987c08 EFLAGS: 00010293
[   23.285037] RAX: 0000000000000000 RBX: ffff88802143d808 RCX: ffffffff83afe4ca
[   23.285749] RDX: ffff888021582540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   23.286451] RBP: ffff88801f987cb8 R08: 0000000000000000 R09: 0000000000000000
[   23.287148] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   23.287839] R13: 0000000000000000 R14: ffff88801f987c50 R15: 0000000000000000
[   23.288531] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.289308] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.289898] CR2: 00007f25f7c32000 CR3: 0000000007086002 CR4: 0000000000770ef0
[   23.290643] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.291339] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.292025] PKRU: 55555554
[   23.292307] Call Trace:
[   23.292560]  <TASK>
[   23.292786]  ? show_regs+0x6d/0x80
[   23.293145]  ? __warn+0xf3/0x380
[   23.293506]  ? report_bug+0x25e/0x4b0
[   23.293915]  ? iommufd_fops_release+0x386/0x420
[   23.294381]  ? report_bug+0x2cb/0x4b0
[   23.294771]  ? iommufd_fops_release+0x386/0x420
[   23.295229]  ? iommufd_fops_release+0x386/0x420
[   23.295689]  ? handle_bug+0x2cd/0x510
[   23.296079]  ? iommufd_fops_release+0x388/0x420
[   23.296542]  ? exc_invalid_op+0x3c/0x80
[   23.296938]  ? asm_exc_invalid_op+0x1f/0x30
[   23.297389]  ? iommufd_fops_release+0x21a/0x420
[   23.297871]  ? iommufd_fops_release+0x386/0x420
[   23.298347]  ? iommufd_fops_release+0x386/0x420
[   23.298826]  ? iommufd_fops_release+0x386/0x420
[   23.299289]  ? locks_remove_file+0x3b4/0x5d0
[   23.299730]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.300219]  ? __memcg_slab_free_hook+0xc1/0x540
[   23.300689]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   23.301228]  ? evm_file_release+0x141/0x220
[   23.301701]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.302295]  __fput+0x41c/0xb70
[   23.302633]  ____fput+0x22/0x30
[   23.302967]  task_work_run+0x19b/0x2b0
[   23.303360]  ? __pfx_task_work_run+0x10/0x10
[   23.303800]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   23.304335]  ? switch_task_namespaces+0xc6/0x110
[   23.304806]  do_exit+0xb0e/0x29d0
[   23.305155]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.305682]  ? __pfx_do_exit+0x10/0x10
[   23.306073]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.306549]  ? __x64_sys_ioctl+0x1ba/0x220
[   23.306973]  make_task_dead+0x181/0x3c0
[   23.307365]  rewind_stack_and_make_dead+0x16/0x20
[   23.307837] RIP: 0033:0x7f9761a3ee5d
[   23.308201] Code: Unable to access opcode bytes at 0x7f9761a3ee33.
[   23.308801] RSP: 002b:00007ffd1d008ba8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.309555] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f9761a3ee5d
[   23.310243] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.310937] RBP: 00007ffd1d008bc0 R08: 0000000000000800 R09: 0000000000000800
[   23.311626] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd1d008cd8
[   23.312319] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f9761e0d000
[   23.313018]  </TASK>
[   23.313251] irq event stamp: 0
[   23.313587] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   23.314200] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   23.314994] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   23.315839] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   23.316459] ---[ end trace 0000000000000000 ]---
[   23.316993] ------------[ cut here ]------------
[   23.317481] WARNING: CPU: 0 PID: 741 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   23.318405] Modules linked in:
[   23.318741] CPU: 0 UID: 0 PID: 741 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.319891] Tainted: [D]=DIE, [W]=WARN
[   23.320270] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.321382] RIP: 0010:iommufd_fops_release+0x392/0x420
[   23.321904] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   23.323669] RSP: 0018:ffff88801f987c08 EFLAGS: 00010293
[   23.324188] RAX: 0000000000000000 RBX: ffff88802143d808 RCX: ffffffff83afe4ca
[   23.324874] RDX: ffff888021582540 RSI: ffffffff83afe642 RDI: ffff88802143d8a0
[   23.325593] RBP: ffff88801f987cb8 R08: 0000000000000000 R09: 0000000000000000
[   23.326285] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   23.326985] R13: 0000000000000000 R14: ffff88801f987c50 R15: 0000000000000000
[   23.327673] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.328448] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.329013] CR2: 00007f25f7c32000 CR3: 0000000007086002 CR4: 0000000000770ef0
[   23.329733] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.330442] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.331184] PKRU: 55555554
[   23.331538] Call Trace:
[   23.332092]  <TASK>
[   23.332345]  ? show_regs+0x6d/0x80
[   23.332744]  ? __warn+0xf3/0x380
[   23.333439]  ? report_bug+0x25e/0x4b0
[   23.333828]  ? iommufd_fops_release+0x392/0x420
[   23.334297]  ? report_bug+0x2cb/0x4b0
[   23.334673]  ? iommufd_fops_release+0x392/0x420
[   23.335160]  ? iommufd_fops_release+0x392/0x420
[   23.335626]  ? handle_bug+0x2cd/0x510
[   23.335995]  ? iommufd_fops_release+0x394/0x420
[   23.336446]  ? exc_invalid_op+0x3c/0x80
[   23.336833]  ? asm_exc_invalid_op+0x1f/0x30
[   23.337252]  ? iommufd_fops_release+0x21a/0x420
[   23.337733]  ? iommufd_fops_release+0x392/0x420
[   23.338188]  ? iommufd_fops_release+0x392/0x420
[   23.338639]  ? iommufd_fops_release+0x392/0x420
[   23.339102]  ? locks_remove_file+0x3b4/0x5d0
[   23.339537]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.340020]  ? __memcg_slab_free_hook+0xc1/0x540
[   23.340484]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   23.341012]  ? evm_file_release+0x141/0x220
[   23.341455]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.341941]  __fput+0x41c/0xb70
[   23.342270]  ____fput+0x22/0x30
[   23.342594]  task_work_run+0x19b/0x2b0
[   23.342983]  ? __pfx_task_work_run+0x10/0x10
[   23.343415]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   23.343946]  ? switch_task_namespaces+0xc6/0x110
[   23.344412]  do_exit+0xb0e/0x29d0
[   23.344757]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.345247]  ? __pfx_do_exit+0x10/0x10
[   23.345647]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.346120]  ? __x64_sys_ioctl+0x1ba/0x220
[   23.346543]  make_task_dead+0x181/0x3c0
[   23.346939]  rewind_stack_and_make_dead+0x16/0x20
[   23.347414] RIP: 0033:0x7f9761a3ee5d
[   23.347774] Code: Unable to access opcode bytes at 0x7f9761a3ee33.
[   23.348359] RSP: 002b:00007ffd1d008ba8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.349079] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f9761a3ee5d
[   23.349773] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.350445] RBP: 00007ffd1d008bc0 R08: 0000000000000800 R09: 0000000000000800
[   23.351124] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd1d008cd8
[   23.351800] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f9761e0d000
[   23.352483]  </TASK>
[   23.352712] irq event stamp: 0
[   23.353016] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   23.353635] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   23.354420] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   23.355205] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   23.355802] ---[ end trace 0000000000000000 ]---
[   23.362387] iommufd_mock iommufd_mock12: Adding to iommu group 12
[   23.363237] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#13] SMP KASAN NOPTI
[   23.364505] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   23.365318] CPU: 0 UID: 0 PID: 742 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.366637] Tainted: [D]=DIE, [W]=WARN
[   23.367096] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.368294] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.368905] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   23.370802] RSP: 0018:ffff88801ff57b78 EFLAGS: 00010246
[   23.371374] RAX: dffffc0000000000 RBX: ffff888011121800 RCX: 1ffffffff0dd8bdc
[   23.372133] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880215907fc
[   23.372902] RBP: ffff88801ff57bc8 R08: 0000000000000000 R09: 0000000000000000
[   23.373709] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   23.374589] R13: 0000000000000001 R14: ffff88801ff57e18 R15: ffff888010bb7408
[   23.375356] FS:  00007f8b07662600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.376244] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.376921] CR2: 00000000200006c0 CR3: 000000000ff76006 CR4: 0000000000770ef0
[   23.377717] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.378468] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.379205] PKRU: 55555554
[   23.379502] Call Trace:
[   23.379774]  <TASK>
[   23.380017]  ? show_regs+0x6d/0x80
[   23.380403]  ? die_addr+0x45/0xb0
[   23.380773]  ? exc_general_protection+0x1ad/0x340
[   23.381294]  ? asm_exc_general_protection+0x2b/0x30
[   23.381823]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.382369]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   23.382924]  iommufd_device_detach+0x2a/0x2e0
[   23.383403]  iommufd_test+0x2f99/0x5cd0
[   23.383826]  ? do_raw_spin_unlock+0x15c/0x210
[   23.384307]  ? __pfx_iommufd_test+0x10/0x10
[   23.384760]  ? debug_smp_processor_id+0x20/0x30
[   23.385253]  ? rcu_is_watching+0x19/0xc0
[   23.385683]  ? lock_release+0x1ea/0x2c0
[   23.386116]  ? __might_fault+0xf1/0x1b0
[   23.386580]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   23.387172]  iommufd_fops_ioctl+0x38e/0x520
[   23.387667]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.388183]  ? trace_irq_enable+0xd1/0x110
[   23.388636]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.389185]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.389698]  __x64_sys_ioctl+0x1ba/0x220
[   23.390188]  x64_sys_call+0x122e/0x2150
[   23.390668]  do_syscall_64+0x6d/0x150
[   23.391093]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   23.391726] RIP: 0033:0x7f8b0743ee5d
[   23.392154] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   23.394204] RSP: 002b:00007ffeedc4d208 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.395174] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f8b0743ee5d
[   23.396036] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.396876] RBP: 00007ffeedc4d220 R08: 0000000000000800 R09: 0000000000000800
[   23.397763] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffeedc4d338
[   23.398663] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f8b076ab000
[   23.399574]  </TASK>
[   23.399856] Modules linked in:
[   23.400367] ---[ end trace 0000000000000000 ]---
[   23.400949] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.401928] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   23.404155] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   23.404981] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   23.405857] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   23.406721] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   23.407690] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   23.408586] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   23.409540] FS:  00007f8b07662600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.410388] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.410995] CR2: 00000000200006c0 CR3: 000000000ff76006 CR4: 0000000000770ef0
[   23.411881] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.412611] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.413471] PKRU: 55555554
[   23.414698] ------------[ cut here ]------------
[   23.415231] WARNING: CPU: 0 PID: 742 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   23.416215] Modules linked in:
[   23.416559] CPU: 0 UID: 0 PID: 742 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.417847] Tainted: [D]=DIE, [W]=WARN
[   23.418264] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.419505] RIP: 0010:iommufd_fops_release+0x386/0x420
[   23.420073] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   23.422188] RSP: 0018:ffff88801ff57c08 EFLAGS: 00010293
[   23.422776] RAX: 0000000000000000 RBX: ffff888012ddb008 RCX: ffffffff83afe4ca
[   23.423514] RDX: ffff888021590000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   23.424247] RBP: ffff88801ff57cb8 R08: 0000000000000000 R09: 0000000000000000
[   23.424980] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   23.425745] R13: 0000000000000000 R14: ffff88801ff57c50 R15: 0000000000000000
[   23.426486] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.427305] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.427897] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   23.428625] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.429370] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.430168] PKRU: 55555554
[   23.430507] Call Trace:
[   23.430830]  <TASK>
[   23.431086]  ? show_regs+0x6d/0x80
[   23.431564]  ? __warn+0xf3/0x380
[   23.431920]  ? report_bug+0x25e/0x4b0
[   23.432319]  ? iommufd_fops_release+0x386/0x420
[   23.432802]  ? report_bug+0x2cb/0x4b0
[   23.433199]  ? iommufd_fops_release+0x386/0x420
[   23.433703]  ? iommufd_fops_release+0x386/0x420
[   23.434197]  ? handle_bug+0x2cd/0x510
[   23.434604]  ? iommufd_fops_release+0x388/0x420
[   23.435108]  ? exc_invalid_op+0x3c/0x80
[   23.435533]  ? asm_exc_invalid_op+0x1f/0x30
[   23.435992]  ? iommufd_fops_release+0x21a/0x420
[   23.436485]  ? iommufd_fops_release+0x386/0x420
[   23.436979]  ? iommufd_fops_release+0x386/0x420
[   23.437493]  ? iommufd_fops_release+0x386/0x420
[   23.437989]  ? locks_remove_file+0x3b4/0x5d0
[   23.438463]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.438995]  ? __memcg_slab_free_hook+0xc1/0x540
[   23.439501]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   23.440076]  ? evm_file_release+0x141/0x220
[   23.440537]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.441063]  __fput+0x41c/0xb70
[   23.441442]  ____fput+0x22/0x30
[   23.441801]  task_work_run+0x19b/0x2b0
[   23.442228]  ? __pfx_task_work_run+0x10/0x10
[   23.442699]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   23.443286]  ? switch_task_namespaces+0xc6/0x110
[   23.443801]  do_exit+0xb0e/0x29d0
[   23.444179]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.444717]  ? __pfx_do_exit+0x10/0x10
[   23.445132]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.445671]  ? __x64_sys_ioctl+0x1ba/0x220
[   23.446122]  make_task_dead+0x181/0x3c0
[   23.446583]  rewind_stack_and_make_dead+0x16/0x20
[   23.447083] RIP: 0033:0x7f8b0743ee5d
[   23.447478] Code: Unable to access opcode bytes at 0x7f8b0743ee33.
[   23.448124] RSP: 002b:00007ffeedc4d208 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.448917] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f8b0743ee5d
[   23.449682] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.450425] RBP: 00007ffeedc4d220 R08: 0000000000000800 R09: 0000000000000800
[   23.451173] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffeedc4d338
[   23.451915] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f8b076ab000
[   23.452670]  </TASK>
[   23.452923] irq event stamp: 0
[   23.453260] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   23.453943] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   23.454854] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   23.455712] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   23.456375] ---[ end trace 0000000000000000 ]---
[   23.456946] ------------[ cut here ]------------
[   23.457478] WARNING: CPU: 0 PID: 742 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   23.458523] Modules linked in:
[   23.458879] CPU: 0 UID: 0 PID: 742 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.460110] Tainted: [D]=DIE, [W]=WARN
[   23.460512] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.461704] RIP: 0010:iommufd_fops_release+0x392/0x420
[   23.462316] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   23.464310] RSP: 0018:ffff88801ff57c08 EFLAGS: 00010293
[   23.464895] RAX: 0000000000000000 RBX: ffff888012ddb008 RCX: ffffffff83afe4ca
[   23.465685] RDX: ffff888021590000 RSI: ffffffff83afe642 RDI: ffff888012ddb0a0
[   23.466453] RBP: ffff88801ff57cb8 R08: 0000000000000000 R09: 0000000000000000
[   23.467221] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   23.467986] R13: 0000000000000000 R14: ffff88801ff57c50 R15: 0000000000000000
[   23.468743] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.469621] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.470266] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   23.471024] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.471782] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.472542] PKRU: 55555554
[   23.472854] Call Trace:
[   23.473152]  <TASK>
[   23.473440]  ? show_regs+0x6d/0x80
[   23.473857]  ? __warn+0xf3/0x380
[   23.474251]  ? report_bug+0x25e/0x4b0
[   23.474692]  ? iommufd_fops_release+0x392/0x420
[   23.475212]  ? report_bug+0x2cb/0x4b0
[   23.475633]  ? iommufd_fops_release+0x392/0x420
[   23.476143]  ? iommufd_fops_release+0x392/0x420
[   23.476653]  ? handle_bug+0x2cd/0x510
[   23.477076]  ? iommufd_fops_release+0x394/0x420
[   23.477640]  ? exc_invalid_op+0x3c/0x80
[   23.478109]  ? asm_exc_invalid_op+0x1f/0x30
[   23.478616]  ? iommufd_fops_release+0x21a/0x420
[   23.479136]  ? iommufd_fops_release+0x392/0x420
[   23.479640]  ? iommufd_fops_release+0x392/0x420
[   23.480150]  ? iommufd_fops_release+0x392/0x420
[   23.480658]  ? locks_remove_file+0x3b4/0x5d0
[   23.481141]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.481703]  ? __memcg_slab_free_hook+0xc1/0x540
[   23.482232]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   23.482835]  ? evm_file_release+0x141/0x220
[   23.483312]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.483860]  __fput+0x41c/0xb70
[   23.484226]  ____fput+0x22/0x30
[   23.484592]  task_work_run+0x19b/0x2b0
[   23.485034]  ? __pfx_task_work_run+0x10/0x10
[   23.485557]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   23.486170]  ? switch_task_namespaces+0xc6/0x110
[   23.486699]  do_exit+0xb0e/0x29d0
[   23.487088]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.487649]  ? __pfx_do_exit+0x10/0x10
[   23.488079]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.488605]  ? __x64_sys_ioctl+0x1ba/0x220
[   23.489073]  make_task_dead+0x181/0x3c0
[   23.489527]  rewind_stack_and_make_dead+0x16/0x20
[   23.490060] RIP: 0033:0x7f8b0743ee5d
[   23.490490] Code: Unable to access opcode bytes at 0x7f8b0743ee33.
[   23.491151] RSP: 002b:00007ffeedc4d208 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.491942] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f8b0743ee5d
[   23.492701] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.493503] RBP: 00007ffeedc4d220 R08: 0000000000000800 R09: 0000000000000800
[   23.494284] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffeedc4d338
[   23.495056] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f8b076ab000
[   23.495849]  </TASK>
[   23.496118] irq event stamp: 0
[   23.496473] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   23.497155] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   23.498071] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   23.498993] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   23.499689] ---[ end trace 0000000000000000 ]---
[   23.507228] iommufd_mock iommufd_mock13: Adding to iommu group 13
[   23.508247] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#14] SMP KASAN NOPTI
[   23.509506] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   23.510290] CPU: 0 UID: 0 PID: 743 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.511517] Tainted: [D]=DIE, [W]=WARN
[   23.511913] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.513059] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.513663] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   23.515532] RSP: 0018:ffff88802708fb78 EFLAGS: 00010246
[   23.516092] RAX: dffffc0000000000 RBX: ffff888011120400 RCX: 1ffffffff0dd8bdc
[   23.516852] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801156d27c
[   23.517620] RBP: ffff88802708fbc8 R08: 0000000000000000 R09: 0000000000000000
[   23.518403] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   23.519177] R13: 0000000000000001 R14: ffff88802708fe18 R15: ffff8880117e4c08
[   23.519951] FS:  00007ffbf67d6600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.520817] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.521443] CR2: 00000000200006c0 CR3: 000000000ff70003 CR4: 0000000000770ef0
[   23.522214] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.522972] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.523729] PKRU: 55555554
[   23.524034] Call Trace:
[   23.524323]  <TASK>
[   23.524581]  ? show_regs+0x6d/0x80
[   23.524977]  ? die_addr+0x45/0xb0
[   23.525356]  ? exc_general_protection+0x1ad/0x340
[   23.525898]  ? asm_exc_general_protection+0x2b/0x30
[   23.526447]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.527016]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   23.527579]  iommufd_device_detach+0x2a/0x2e0
[   23.528074]  iommufd_test+0x2f99/0x5cd0
[   23.528515]  ? do_raw_spin_unlock+0x15c/0x210
[   23.529025]  ? __pfx_iommufd_test+0x10/0x10
[   23.529491]  ? debug_smp_processor_id+0x20/0x30
[   23.530003]  ? rcu_is_watching+0x19/0xc0
[   23.530453]  ? lock_release+0x1ea/0x2c0
[   23.530897]  ? __might_fault+0xf1/0x1b0
[   23.531344]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   23.531951]  iommufd_fops_ioctl+0x38e/0x520
[   23.532430]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.532959]  ? trace_irq_enable+0xd1/0x110
[   23.533430]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.533983]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.534544]  __x64_sys_ioctl+0x1ba/0x220
[   23.535033]  x64_sys_call+0x122e/0x2150
[   23.535468]  do_syscall_64+0x6d/0x150
[   23.535898]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   23.536459] RIP: 0033:0x7ffbf643ee5d
[   23.536874] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   23.538833] RSP: 002b:00007fffd9d8cae8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.539659] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007ffbf643ee5d
[   23.540427] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.541213] RBP: 00007fffd9d8cb00 R08: 0000000000000800 R09: 0000000000000800
[   23.541964] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fffd9d8cc18
[   23.542749] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007ffbf681f000
[   23.543525]  </TASK>
[   23.543781] Modules linked in:
[   23.544252] ---[ end trace 0000000000000000 ]---
[   23.544754] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.545440] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   23.547349] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   23.547908] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   23.548659] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   23.549427] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   23.550181] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   23.550938] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   23.551708] FS:  00007ffbf67d6600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.552572] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.553201] CR2: 00000000200006c0 CR3: 000000000ff70003 CR4: 0000000000770ef0
[   23.553990] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.554747] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.555497] PKRU: 55555554
[   23.556811] ------------[ cut here ]------------
[   23.557360] WARNING: CPU: 0 PID: 743 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   23.558419] Modules linked in:
[   23.558899] CPU: 0 UID: 0 PID: 743 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.560318] Tainted: [D]=DIE, [W]=WARN
[   23.560733] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.562329] RIP: 0010:iommufd_fops_release+0x386/0x420
[   23.562904] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   23.564997] RSP: 0018:ffff88802708fc08 EFLAGS: 00010293
[   23.565592] RAX: 0000000000000000 RBX: ffff888012ddb808 RCX: ffffffff83afe4ca
[   23.566341] RDX: ffff88801156ca80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   23.567091] RBP: ffff88802708fcb8 R08: 0000000000000000 R09: 0000000000000000
[   23.567838] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   23.568578] R13: 0000000000000000 R14: ffff88802708fc50 R15: 0000000000000000
[   23.569317] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.570181] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.570791] CR2: 00000000200006c0 CR3: 0000000007086004 CR4: 0000000000770ef0
[   23.571538] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.572275] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.573020] PKRU: 55555554
[   23.573319] Call Trace:
[   23.573623]  <TASK>
[   23.573868]  ? show_regs+0x6d/0x80
[   23.574253]  ? __warn+0xf3/0x380
[   23.574619]  ? report_bug+0x25e/0x4b0
[   23.575029]  ? iommufd_fops_release+0x386/0x420
[   23.575526]  ? report_bug+0x2cb/0x4b0
[   23.575932]  ? iommufd_fops_release+0x386/0x420
[   23.576428]  ? iommufd_fops_release+0x386/0x420
[   23.576920]  ? handle_bug+0x2cd/0x510
[   23.577349]  ? iommufd_fops_release+0x388/0x420
[   23.577862]  ? exc_invalid_op+0x3c/0x80
[   23.578288]  ? asm_exc_invalid_op+0x1f/0x30
[   23.578751]  ? iommufd_fops_release+0x21a/0x420
[   23.579245]  ? iommufd_fops_release+0x386/0x420
[   23.579742]  ? iommufd_fops_release+0x386/0x420
[   23.580236]  ? iommufd_fops_release+0x386/0x420
[   23.580730]  ? locks_remove_file+0x3b4/0x5d0
[   23.581201]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.581749]  ? __memcg_slab_free_hook+0xc1/0x540
[   23.582262]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   23.582845]  ? evm_file_release+0x141/0x220
[   23.583303]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.583829]  __fput+0x41c/0xb70
[   23.584188]  ____fput+0x22/0x30
[   23.584544]  task_work_run+0x19b/0x2b0
[   23.584967]  ? __pfx_task_work_run+0x10/0x10
[   23.585461]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   23.586045]  ? switch_task_namespaces+0xc6/0x110
[   23.586553]  do_exit+0xb0e/0x29d0
[   23.586936]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.587473]  ? __pfx_do_exit+0x10/0x10
[   23.587889]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.588399]  ? __x64_sys_ioctl+0x1ba/0x220
[   23.588848]  make_task_dead+0x181/0x3c0
[   23.589271]  rewind_stack_and_make_dead+0x16/0x20
[   23.589800] RIP: 0033:0x7ffbf643ee5d
[   23.590201] Code: Unable to access opcode bytes at 0x7ffbf643ee33.
[   23.590851] RSP: 002b:00007fffd9d8cae8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.591644] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007ffbf643ee5d
[   23.592387] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.593125] RBP: 00007fffd9d8cb00 R08: 0000000000000800 R09: 0000000000000800
[   23.593891] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fffd9d8cc18
[   23.594641] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007ffbf681f000
[   23.595402]  </TASK>
[   23.595658] irq event stamp: 0
[   23.595997] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   23.596655] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   23.597536] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   23.598401] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   23.599068] ---[ end trace 0000000000000000 ]---
[   23.599645] ------------[ cut here ]------------
[   23.600138] WARNING: CPU: 0 PID: 743 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   23.601129] Modules linked in:
[   23.601513] CPU: 0 UID: 0 PID: 743 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.602767] Tainted: [D]=DIE, [W]=WARN
[   23.603173] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.604344] RIP: 0010:iommufd_fops_release+0x392/0x420
[   23.604897] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   23.606819] RSP: 0018:ffff88802708fc08 EFLAGS: 00010293
[   23.607383] RAX: 0000000000000000 RBX: ffff888012ddb808 RCX: ffffffff83afe4ca
[   23.608131] RDX: ffff88801156ca80 RSI: ffffffff83afe642 RDI: ffff888012ddb8a0
[   23.608875] RBP: ffff88802708fcb8 R08: 0000000000000000 R09: 0000000000000000
[   23.609639] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   23.610387] R13: 0000000000000000 R14: ffff88802708fc50 R15: 0000000000000000
[   23.611139] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.611979] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.612589] CR2: 00000000200006c0 CR3: 0000000007086004 CR4: 0000000000770ef0
[   23.613355] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.614107] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.614852] PKRU: 55555554
[   23.615153] Call Trace:
[   23.615428]  <TASK>
[   23.615673]  ? show_regs+0x6d/0x80
[   23.616056]  ? __warn+0xf3/0x380
[   23.616421]  ? report_bug+0x25e/0x4b0
[   23.616827]  ? iommufd_fops_release+0x392/0x420
[   23.617319]  ? report_bug+0x2cb/0x4b0
[   23.617753]  ? iommufd_fops_release+0x392/0x420
[   23.618256]  ? iommufd_fops_release+0x392/0x420
[   23.618754]  ? handle_bug+0x2cd/0x510
[   23.619163]  ? iommufd_fops_release+0x394/0x420
[   23.619656]  ? exc_invalid_op+0x3c/0x80
[   23.620081]  ? asm_exc_invalid_op+0x1f/0x30
[   23.620539]  ? iommufd_fops_release+0x21a/0x420
[   23.621034]  ? iommufd_fops_release+0x392/0x420
[   23.621551]  ? iommufd_fops_release+0x392/0x420
[   23.622060]  ? iommufd_fops_release+0x392/0x420
[   23.622556]  ? locks_remove_file+0x3b4/0x5d0
[   23.623035]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.623564]  ? __memcg_slab_free_hook+0xc1/0x540
[   23.624072]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   23.624653]  ? evm_file_release+0x141/0x220
[   23.625112]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.625660]  __fput+0x41c/0xb70
[   23.626029]  ____fput+0x22/0x30
[   23.626384]  task_work_run+0x19b/0x2b0
[   23.626809]  ? __pfx_task_work_run+0x10/0x10
[   23.627279]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   23.627856]  ? switch_task_namespaces+0xc6/0x110
[   23.628365]  do_exit+0xb0e/0x29d0
[   23.628740]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.629277]  ? __pfx_do_exit+0x10/0x10
[   23.629715]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.630235]  ? __x64_sys_ioctl+0x1ba/0x220
[   23.630684]  make_task_dead+0x181/0x3c0
[   23.631116]  rewind_stack_and_make_dead+0x16/0x20
[   23.631626] RIP: 0033:0x7ffbf643ee5d
[   23.632022] Code: Unable to access opcode bytes at 0x7ffbf643ee33.
[   23.632669] RSP: 002b:00007fffd9d8cae8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.633489] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007ffbf643ee5d
[   23.634265] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.635021] RBP: 00007fffd9d8cb00 R08: 0000000000000800 R09: 0000000000000800
[   23.635778] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fffd9d8cc18
[   23.636519] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007ffbf681f000
[   23.637274]  </TASK>
[   23.637548] irq event stamp: 0
[   23.637900] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   23.638560] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   23.639429] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   23.640286] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   23.640947] ---[ end trace 0000000000000000 ]---
[   23.648619] iommufd_mock iommufd_mock14: Adding to iommu group 14
[   23.650977] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#15] SMP KASAN NOPTI
[   23.652203] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   23.653080] CPU: 0 UID: 0 PID: 744 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.654339] Tainted: [D]=DIE, [W]=WARN
[   23.654748] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.655899] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.656511] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   23.658381] RSP: 0018:ffff888027097b78 EFLAGS: 00010246
[   23.658944] RAX: dffffc0000000000 RBX: ffff888011121a00 RCX: 1ffffffff0dd8bdc
[   23.659680] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801156ad3c
[   23.660418] RBP: ffff888027097bc8 R08: 0000000000000000 R09: 0000000000000000
[   23.661157] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   23.661891] R13: 0000000000000001 R14: ffff888027097e18 R15: ffff8880117e4008
[   23.662633] FS:  00007fe97cc17600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.663468] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.664076] CR2: 00000000200006c0 CR3: 000000000ff76002 CR4: 0000000000770ef0
[   23.664816] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.665554] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.666289] PKRU: 55555554
[   23.666589] Call Trace:
[   23.666878]  <TASK>
[   23.667124]  ? show_regs+0x6d/0x80
[   23.667509]  ? die_addr+0x45/0xb0
[   23.667884]  ? exc_general_protection+0x1ad/0x340
[   23.668406]  ? asm_exc_general_protection+0x2b/0x30
[   23.668936]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.669484]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   23.670034]  iommufd_device_detach+0x2a/0x2e0
[   23.670516]  iommufd_test+0x2f99/0x5cd0
[   23.670941]  ? do_raw_spin_unlock+0x15c/0x210
[   23.671428]  ? __pfx_iommufd_test+0x10/0x10
[   23.671878]  ? debug_smp_processor_id+0x20/0x30
[   23.672373]  ? rcu_is_watching+0x19/0xc0
[   23.672807]  ? lock_release+0x1ea/0x2c0
[   23.673228]  ? __might_fault+0xf1/0x1b0
[   23.673654]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   23.674232]  iommufd_fops_ioctl+0x38e/0x520
[   23.674688]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.675205]  ? trace_irq_enable+0xd1/0x110
[   23.675660]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.676198]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.676705]  __x64_sys_ioctl+0x1ba/0x220
[   23.677141]  x64_sys_call+0x122e/0x2150
[   23.677557]  do_syscall_64+0x6d/0x150
[   23.677964]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   23.678501] RIP: 0033:0x7fe97ca3ee5d
[   23.678898] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   23.680764] RSP: 002b:00007ffc372a8e18 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.681552] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fe97ca3ee5d
[   23.682288] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.683034] RBP: 00007ffc372a8e30 R08: 0000000000000800 R09: 0000000000000800
[   23.683766] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc372a8f48
[   23.684502] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fe97cc60000
[   23.685251]  </TASK>
[   23.685499] Modules linked in:
[   23.686131] ---[ end trace 0000000000000000 ]---
[   23.686635] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.687333] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   23.689221] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   23.689836] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   23.690581] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   23.691330] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   23.692074] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   23.692813] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   23.693612] FS:  00007fe97cc17600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.694446] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.695052] CR2: 00000000200006c0 CR3: 000000000ff76002 CR4: 0000000000770ef0
[   23.695797] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.696538] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.697275] PKRU: 55555554
[   23.698713] ------------[ cut here ]------------
[   23.699216] WARNING: CPU: 0 PID: 744 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   23.700388] Modules linked in:
[   23.700754] CPU: 0 UID: 0 PID: 744 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.702174] Tainted: [D]=DIE, [W]=WARN
[   23.702579] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.703903] RIP: 0010:iommufd_fops_release+0x386/0x420
[   23.704460] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   23.706547] RSP: 0018:ffff888027097c08 EFLAGS: 00010293
[   23.707135] RAX: 0000000000000000 RBX: ffff888012dde808 RCX: ffffffff83afe4ca
[   23.708015] RDX: ffff88801156a540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   23.708828] RBP: ffff888027097cb8 R08: 0000000000000000 R09: 0000000000000000
[   23.709716] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   23.710629] R13: 0000000000000000 R14: ffff888027097c50 R15: 0000000000000000
[   23.711384] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.712380] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.713113] CR2: 00000000200006c0 CR3: 0000000007086005 CR4: 0000000000770ef0
[   23.713887] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.714687] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.715522] PKRU: 55555554
[   23.715830] Call Trace:
[   23.716143]  <TASK>
[   23.716464]  ? show_regs+0x6d/0x80
[   23.716850]  ? __warn+0xf3/0x380
[   23.717220]  ? report_bug+0x25e/0x4b0
[   23.717757]  ? iommufd_fops_release+0x386/0x420
[   23.718263]  ? report_bug+0x2cb/0x4b0
[   23.718673]  ? iommufd_fops_release+0x386/0x420
[   23.719336]  ? iommufd_fops_release+0x386/0x420
[   23.719836]  ? handle_bug+0x2cd/0x510
[   23.720388]  ? iommufd_fops_release+0x388/0x420
[   23.720889]  ? exc_invalid_op+0x3c/0x80
[   23.721363]  ? asm_exc_invalid_op+0x1f/0x30
[   23.721921]  ? iommufd_fops_release+0x21a/0x420
[   23.722418]  ? iommufd_fops_release+0x386/0x420
[   23.722921]  ? iommufd_fops_release+0x386/0x420
[   23.723479]  ? iommufd_fops_release+0x386/0x420
[   23.724061]  ? locks_remove_file+0x3b4/0x5d0
[   23.724545]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.725210]  ? __memcg_slab_free_hook+0xc1/0x540
[   23.725741]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   23.726344]  ? evm_file_release+0x141/0x220
[   23.726927]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.727476]  __fput+0x41c/0xb70
[   23.727947]  ____fput+0x22/0x30
[   23.728305]  task_work_run+0x19b/0x2b0
[   23.728724]  ? __pfx_task_work_run+0x10/0x10
[   23.729308]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   23.729919]  ? switch_task_namespaces+0xc6/0x110
[   23.730456]  do_exit+0xb0e/0x29d0
[   23.730922]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.731579]  ? __pfx_do_exit+0x10/0x10
[   23.732000]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.732515]  ? __x64_sys_ioctl+0x1ba/0x220
[   23.733109]  make_task_dead+0x181/0x3c0
[   23.733560]  rewind_stack_and_make_dead+0x16/0x20
[   23.734076] RIP: 0033:0x7fe97ca3ee5d
[   23.734474] Code: Unable to access opcode bytes at 0x7fe97ca3ee33.
[   23.735263] RSP: 002b:00007ffc372a8e18 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.736066] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fe97ca3ee5d
[   23.736925] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.737841] RBP: 00007ffc372a8e30 R08: 0000000000000800 R09: 0000000000000800
[   23.738595] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc372a8f48
[   23.739388] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fe97cc60000
[   23.740239]  </TASK>
[   23.740494] irq event stamp: 0
[   23.740962] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   23.741650] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   23.742646] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   23.743659] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   23.744325] ---[ end trace 0000000000000000 ]---
[   23.744919] ------------[ cut here ]------------
[   23.745546] WARNING: CPU: 0 PID: 744 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   23.746698] Modules linked in:
[   23.747056] CPU: 0 UID: 0 PID: 744 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.748435] Tainted: [D]=DIE, [W]=WARN
[   23.748842] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.750184] RIP: 0010:iommufd_fops_release+0x392/0x420
[   23.750754] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   23.752797] RSP: 0018:ffff888027097c08 EFLAGS: 00010293
[   23.753392] RAX: 0000000000000000 RBX: ffff888012dde808 RCX: ffffffff83afe4ca
[   23.754140] RDX: ffff88801156a540 RSI: ffffffff83afe642 RDI: ffff888012dde8a0
[   23.754892] RBP: ffff888027097cb8 R08: 0000000000000000 R09: 0000000000000000
[   23.755634] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   23.756374] R13: 0000000000000000 R14: ffff888027097c50 R15: 0000000000000000
[   23.757121] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.757977] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.758587] CR2: 00000000200006c0 CR3: 0000000007086005 CR4: 0000000000770ef0
[   23.759337] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.760080] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.760824] PKRU: 55555554
[   23.761125] Call Trace:
[   23.761420]  <TASK>
[   23.761666]  ? show_regs+0x6d/0x80
[   23.762050]  ? __warn+0xf3/0x380
[   23.762418]  ? report_bug+0x25e/0x4b0
[   23.762829]  ? iommufd_fops_release+0x392/0x420
[   23.763324]  ? report_bug+0x2cb/0x4b0
[   23.763732]  ? iommufd_fops_release+0x392/0x420
[   23.764231]  ? iommufd_fops_release+0x392/0x420
[   23.764740]  ? handle_bug+0x2cd/0x510
[   23.765163]  ? iommufd_fops_release+0x394/0x420
[   23.765699]  ? exc_invalid_op+0x3c/0x80
[   23.766221]  ? asm_exc_invalid_op+0x1f/0x30
[   23.766755]  ? iommufd_fops_release+0x21a/0x420
[   23.767270]  ? iommufd_fops_release+0x392/0x420
[   23.767776]  ? iommufd_fops_release+0x392/0x420
[   23.768284]  ? iommufd_fops_release+0x392/0x420
[   23.768781]  ? locks_remove_file+0x3b4/0x5d0
[   23.769255]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.769806]  ? __memcg_slab_free_hook+0xc1/0x540
[   23.770329]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   23.770915]  ? evm_file_release+0x141/0x220
[   23.771375]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.771904]  __fput+0x41c/0xb70
[   23.772265]  ____fput+0x22/0x30
[   23.772620]  task_work_run+0x19b/0x2b0
[   23.773038]  ? __pfx_task_work_run+0x10/0x10
[   23.773532]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   23.774143]  ? switch_task_namespaces+0xc6/0x110
[   23.774656]  do_exit+0xb0e/0x29d0
[   23.775042]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.775584]  ? __pfx_do_exit+0x10/0x10
[   23.776000]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.776511]  ? __x64_sys_ioctl+0x1ba/0x220
[   23.776963]  make_task_dead+0x181/0x3c0
[   23.777414]  rewind_stack_and_make_dead+0x16/0x20
[   23.777965] RIP: 0033:0x7fe97ca3ee5d
[   23.778371] Code: Unable to access opcode bytes at 0x7fe97ca3ee33.
[   23.779042] RSP: 002b:00007ffc372a8e18 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.779841] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fe97ca3ee5d
[   23.780587] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.781365] RBP: 00007ffc372a8e30 R08: 0000000000000800 R09: 0000000000000800
[   23.782110] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc372a8f48
[   23.782860] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fe97cc60000
[   23.783610]  </TASK>
[   23.783862] irq event stamp: 0
[   23.784199] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   23.784860] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   23.785742] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   23.786607] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   23.787275] ---[ end trace 0000000000000000 ]---
[   23.794659] iommufd_mock iommufd_mock15: Adding to iommu group 15
[   23.795965] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#16] SMP KASAN NOPTI
[   23.797258] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   23.798187] CPU: 0 UID: 0 PID: 745 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.799468] Tainted: [D]=DIE, [W]=WARN
[   23.799862] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.801002] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.801608] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   23.803412] RSP: 0018:ffff88802708fb78 EFLAGS: 00010246
[   23.803910] RAX: dffffc0000000000 RBX: ffff888011120800 RCX: 1ffffffff0dd8bdc
[   23.804655] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801729ad3c
[   23.805403] RBP: ffff88802708fbc8 R08: 0000000000000000 R09: 0000000000000000
[   23.806146] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   23.806895] R13: 0000000000000001 R14: ffff88802708fe18 R15: ffff8880117e7408
[   23.807640] FS:  00007fe8272dc600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.808478] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.809085] CR2: 00000000200006c0 CR3: 000000000ff70003 CR4: 0000000000770ef0
[   23.809834] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.810579] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.811334] PKRU: 55555554
[   23.811638] Call Trace:
[   23.811915]  <TASK>
[   23.812162]  ? show_regs+0x6d/0x80
[   23.812548]  ? die_addr+0x45/0xb0
[   23.812926]  ? exc_general_protection+0x1ad/0x340
[   23.813460]  ? asm_exc_general_protection+0x2b/0x30
[   23.813998]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.814553]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   23.815114]  iommufd_device_detach+0x2a/0x2e0
[   23.815600]  iommufd_test+0x2f99/0x5cd0
[   23.816027]  ? do_raw_spin_unlock+0x15c/0x210
[   23.816519]  ? __pfx_iommufd_test+0x10/0x10
[   23.816980]  ? debug_smp_processor_id+0x20/0x30
[   23.817481]  ? rcu_is_watching+0x19/0xc0
[   23.817920]  ? lock_release+0x1ea/0x2c0
[   23.818350]  ? __might_fault+0xf1/0x1b0
[   23.818801]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   23.819398]  iommufd_fops_ioctl+0x38e/0x520
[   23.819864]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.820382]  ? trace_irq_enable+0xd1/0x110
[   23.820843]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.821416]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.821932]  __x64_sys_ioctl+0x1ba/0x220
[   23.822371]  x64_sys_call+0x122e/0x2150
[   23.822804]  do_syscall_64+0x6d/0x150
[   23.823231]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   23.823783] RIP: 0033:0x7fe82703ee5d
[   23.824185] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   23.826129] RSP: 002b:00007ffe5cce5658 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.826925] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fe82703ee5d
[   23.827673] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.828412] RBP: 00007ffe5cce5670 R08: 0000000000000800 R09: 0000000000000800
[   23.829156] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe5cce5788
[   23.829896] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fe827325000
[   23.830644]  </TASK>
[   23.830896] Modules linked in:
[   23.831385] ---[ end trace 0000000000000000 ]---
[   23.831891] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.832510] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   23.834541] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   23.835126] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   23.835879] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   23.836624] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   23.837503] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   23.838245] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   23.838996] FS:  00007fe8272dc600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.839828] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.840439] CR2: 00000000200006c0 CR3: 000000000ff70003 CR4: 0000000000770ef0
[   23.841187] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.842014] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.842776] PKRU: 55555554
[   23.843945] ------------[ cut here ]------------
[   23.844483] WARNING: CPU: 1 PID: 745 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   23.845738] Modules linked in:
[   23.846116] CPU: 1 UID: 0 PID: 745 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.847526] Tainted: [D]=DIE, [W]=WARN
[   23.847985] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.849456] RIP: 0010:iommufd_fops_release+0x386/0x420
[   23.850048] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   23.852229] RSP: 0018:ffff88802708fc08 EFLAGS: 00010293
[   23.852927] RAX: 0000000000000000 RBX: ffff888012ddd008 RCX: ffffffff83afe4ca
[   23.853782] RDX: ffff88801729a540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   23.854630] RBP: ffff88802708fcb8 R08: 0000000000000000 R09: 0000000000000000
[   23.855516] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   23.856335] R13: 0000000000000000 R14: ffff88802708fc50 R15: 0000000000000000
[   23.857191] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   23.858222] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.859020] CR2: 00007f25f7c7e028 CR3: 0000000007086006 CR4: 0000000000770ef0
[   23.859809] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.860624] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.861542] PKRU: 55555554
[   23.861848] Call Trace:
[   23.862161]  <TASK>
[   23.862451]  ? show_regs+0x6d/0x80
[   23.862844]  ? __warn+0xf3/0x380
[   23.863243]  ? report_bug+0x25e/0x4b0
[   23.863716]  ? iommufd_fops_release+0x386/0x420
[   23.864220]  ? report_bug+0x2cb/0x4b0
[   23.864702]  ? iommufd_fops_release+0x386/0x420
[   23.865203]  ? iommufd_fops_release+0x386/0x420
[   23.865811]  ? handle_bug+0x2cd/0x510
[   23.866225]  ? iommufd_fops_release+0x388/0x420
[   23.866731]  ? exc_invalid_op+0x3c/0x80
[   23.867165]  ? asm_exc_invalid_op+0x1f/0x30
[   23.867706]  ? iommufd_fops_release+0x21a/0x420
[   23.868205]  ? iommufd_fops_release+0x386/0x420
[   23.868761]  ? iommufd_fops_release+0x386/0x420
[   23.869306]  ? iommufd_fops_release+0x386/0x420
[   23.869821]  ? locks_remove_file+0x3b4/0x5d0
[   23.870300]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.870834]  ? __memcg_slab_free_hook+0xc1/0x540
[   23.871337]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   23.871922]  ? evm_file_release+0x141/0x220
[   23.872394]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.872928]  __fput+0x41c/0xb70
[   23.873290]  ____fput+0x22/0x30
[   23.873725]  task_work_run+0x19b/0x2b0
[   23.874152]  ? __pfx_task_work_run+0x10/0x10
[   23.874620]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   23.875208]  ? switch_task_namespaces+0xc6/0x110
[   23.875716]  do_exit+0xb0e/0x29d0
[   23.876093]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.876630]  ? __pfx_do_exit+0x10/0x10
[   23.877045]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.877630]  ? __x64_sys_ioctl+0x1ba/0x220
[   23.878139]  make_task_dead+0x181/0x3c0
[   23.878563]  rewind_stack_and_make_dead+0x16/0x20
[   23.879084] RIP: 0033:0x7fe82703ee5d
[   23.879493] Code: Unable to access opcode bytes at 0x7fe82703ee33.
[   23.880173] RSP: 002b:00007ffe5cce5658 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.880989] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fe82703ee5d
[   23.881829] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.882657] RBP: 00007ffe5cce5670 R08: 0000000000000800 R09: 0000000000000800
[   23.883406] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe5cce5788
[   23.884153] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fe827325000
[   23.884912]  </TASK>
[   23.885166] irq event stamp: 0
[   23.885567] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   23.886242] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   23.887122] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   23.887985] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   23.888651] ---[ end trace 0000000000000000 ]---
[   23.889229] ------------[ cut here ]------------
[   23.889788] WARNING: CPU: 1 PID: 745 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   23.890804] Modules linked in:
[   23.891155] CPU: 1 UID: 0 PID: 745 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.892388] Tainted: [D]=DIE, [W]=WARN
[   23.892795] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.894022] RIP: 0010:iommufd_fops_release+0x392/0x420
[   23.894594] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   23.896506] RSP: 0018:ffff88802708fc08 EFLAGS: 00010293
[   23.897068] RAX: 0000000000000000 RBX: ffff888012ddd008 RCX: ffffffff83afe4ca
[   23.897877] RDX: ffff88801729a540 RSI: ffffffff83afe642 RDI: ffff888012ddd0a0
[   23.898637] RBP: ffff88802708fcb8 R08: 0000000000000000 R09: 0000000000000000
[   23.899389] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   23.900140] R13: 0000000000000000 R14: ffff88802708fc50 R15: 0000000000000000
[   23.900887] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   23.901788] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.902399] CR2: 00007f25f7c7e028 CR3: 0000000007086006 CR4: 0000000000770ef0
[   23.903155] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.903900] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.904645] PKRU: 55555554
[   23.904946] Call Trace:
[   23.905222]  <TASK>
[   23.905520]  ? show_regs+0x6d/0x80
[   23.905911]  ? __warn+0xf3/0x380
[   23.906277]  ? report_bug+0x25e/0x4b0
[   23.906685]  ? iommufd_fops_release+0x392/0x420
[   23.907187]  ? report_bug+0x2cb/0x4b0
[   23.907603]  ? iommufd_fops_release+0x392/0x420
[   23.908098]  ? iommufd_fops_release+0x392/0x420
[   23.908595]  ? handle_bug+0x2cd/0x510
[   23.909003]  ? iommufd_fops_release+0x394/0x420
[   23.909525]  ? exc_invalid_op+0x3c/0x80
[   23.909959]  ? asm_exc_invalid_op+0x1f/0x30
[   23.910431]  ? iommufd_fops_release+0x21a/0x420
[   23.910933]  ? iommufd_fops_release+0x392/0x420
[   23.911431]  ? iommufd_fops_release+0x392/0x420
[   23.911927]  ? iommufd_fops_release+0x392/0x420
[   23.912422]  ? locks_remove_file+0x3b4/0x5d0
[   23.912898]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.913458]  ? __memcg_slab_free_hook+0xc1/0x540
[   23.914054]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   23.914632]  ? evm_file_release+0x141/0x220
[   23.915098]  ? __pfx_iommufd_fops_release+0x10/0x10
[   23.915625]  __fput+0x41c/0xb70
[   23.915987]  ____fput+0x22/0x30
[   23.916342]  task_work_run+0x19b/0x2b0
[   23.916761]  ? __pfx_task_work_run+0x10/0x10
[   23.917231]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   23.917830]  ? switch_task_namespaces+0xc6/0x110
[   23.918342]  do_exit+0xb0e/0x29d0
[   23.918723]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.919260]  ? __pfx_do_exit+0x10/0x10
[   23.919678]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.920190]  ? __x64_sys_ioctl+0x1ba/0x220
[   23.920639]  make_task_dead+0x181/0x3c0
[   23.921065]  rewind_stack_and_make_dead+0x16/0x20
[   23.921594] RIP: 0033:0x7fe82703ee5d
[   23.921990] Code: Unable to access opcode bytes at 0x7fe82703ee33.
[   23.922639] RSP: 002b:00007ffe5cce5658 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.923436] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fe82703ee5d
[   23.924181] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.924926] RBP: 00007ffe5cce5670 R08: 0000000000000800 R09: 0000000000000800
[   23.925696] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe5cce5788
[   23.926443] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fe827325000
[   23.927197]  </TASK>
[   23.927449] irq event stamp: 0
[   23.927793] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   23.928450] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   23.929309] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   23.930198] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   23.930864] ---[ end trace 0000000000000000 ]---
[   23.938005] iommufd_mock iommufd_mock16: Adding to iommu group 16
[   23.938922] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#17] SMP KASAN NOPTI
[   23.940154] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   23.940929] CPU: 0 UID: 0 PID: 746 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.942137] Tainted: [D]=DIE, [W]=WARN
[   23.942533] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.943679] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.944283] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   23.946126] RSP: 0018:ffff8880215efb78 EFLAGS: 00010246
[   23.946677] RAX: dffffc0000000000 RBX: ffff888011120600 RCX: 1ffffffff0dd8bdc
[   23.947406] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801729d27c
[   23.948129] RBP: ffff8880215efbc8 R08: 0000000000000000 R09: 0000000000000000
[   23.948851] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   23.949576] R13: 0000000000000001 R14: ffff8880215efe18 R15: ffff8880117e4808
[   23.950300] FS:  00007fe0d0960600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.951119] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.951713] CR2: 000055dee2f4abbc CR3: 000000000ff70006 CR4: 0000000000770ef0
[   23.952450] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.953190] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.953932] PKRU: 55555554
[   23.954233] Call Trace:
[   23.954507]  <TASK>
[   23.954757]  ? show_regs+0x6d/0x80
[   23.955144]  ? die_addr+0x45/0xb0
[   23.955520]  ? exc_general_protection+0x1ad/0x340
[   23.956044]  ? asm_exc_general_protection+0x2b/0x30
[   23.956577]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.957128]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   23.957682]  iommufd_device_detach+0x2a/0x2e0
[   23.958165]  iommufd_test+0x2f99/0x5cd0
[   23.958589]  ? do_raw_spin_unlock+0x15c/0x210
[   23.959078]  ? __pfx_iommufd_test+0x10/0x10
[   23.959533]  ? debug_smp_processor_id+0x20/0x30
[   23.960031]  ? rcu_is_watching+0x19/0xc0
[   23.960466]  ? lock_release+0x1ea/0x2c0
[   23.960894]  ? __might_fault+0xf1/0x1b0
[   23.961327]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   23.961909]  iommufd_fops_ioctl+0x38e/0x520
[   23.962369]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.962891]  ? trace_irq_enable+0xd1/0x110
[   23.963352]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   23.963895]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   23.964409]  __x64_sys_ioctl+0x1ba/0x220
[   23.964842]  x64_sys_call+0x122e/0x2150
[   23.965263]  do_syscall_64+0x6d/0x150
[   23.965672]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   23.966214] RIP: 0033:0x7fe0d063ee5d
[   23.966609] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   23.968499] RSP: 002b:00007ffe3b70ec78 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   23.969288] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fe0d063ee5d
[   23.970031] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   23.970778] RBP: 00007ffe3b70ec90 R08: 0000000000000800 R09: 0000000000000800
[   23.971522] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe3b70eda8
[   23.972264] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fe0d09a9000
[   23.973015]  </TASK>
[   23.973270] Modules linked in:
[   23.973944] ---[ end trace 0000000000000000 ]---
[   23.974447] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   23.975052] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   23.976907] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   23.977499] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   23.978233] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   23.978950] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   23.979695] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   23.980443] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   23.981170] FS:  00007fe0d0960600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.982016] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.982616] CR2: 000055dee2f4abbc CR3: 000000000ff70006 CR4: 0000000000770ef0
[   23.983350] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   23.984074] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   23.984799] PKRU: 55555554
[   23.985786] ------------[ cut here ]------------
[   23.986303] WARNING: CPU: 0 PID: 746 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   23.987309] Modules linked in:
[   23.987661] CPU: 0 UID: 0 PID: 746 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   23.988898] Tainted: [D]=DIE, [W]=WARN
[   23.989303] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   23.990523] RIP: 0010:iommufd_fops_release+0x386/0x420
[   23.991094] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   23.992985] RSP: 0018:ffff8880215efc08 EFLAGS: 00010293
[   23.993569] RAX: 0000000000000000 RBX: ffff888021439008 RCX: ffffffff83afe4ca
[   23.994316] RDX: ffff88801729ca80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   23.995060] RBP: ffff8880215efcb8 R08: 0000000000000000 R09: 0000000000000000
[   23.995802] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   23.996542] R13: 0000000000000000 R14: ffff8880215efc50 R15: 0000000000000000
[   23.997285] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   23.998144] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   23.998760] CR2: 000055dee2f4abbc CR3: 0000000007086001 CR4: 0000000000770ef0
[   23.999501] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.000245] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.000992] PKRU: 55555554
[   24.001295] Call Trace:
[   24.001590]  <TASK>
[   24.001836]  ? show_regs+0x6d/0x80
[   24.002220]  ? __warn+0xf3/0x380
[   24.002587]  ? report_bug+0x25e/0x4b0
[   24.002998]  ? iommufd_fops_release+0x386/0x420
[   24.003492]  ? report_bug+0x2cb/0x4b0
[   24.003899]  ? iommufd_fops_release+0x386/0x420
[   24.004393]  ? iommufd_fops_release+0x386/0x420
[   24.004888]  ? handle_bug+0x2cd/0x510
[   24.005297]  ? iommufd_fops_release+0x388/0x420
[   24.005821]  ? exc_invalid_op+0x3c/0x80
[   24.006250]  ? asm_exc_invalid_op+0x1f/0x30
[   24.006715]  ? iommufd_fops_release+0x21a/0x420
[   24.007212]  ? iommufd_fops_release+0x386/0x420
[   24.007712]  ? iommufd_fops_release+0x386/0x420
[   24.008205]  ? iommufd_fops_release+0x386/0x420
[   24.008698]  ? locks_remove_file+0x3b4/0x5d0
[   24.009174]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.009727]  ? __memcg_slab_free_hook+0xc1/0x540
[   24.010238]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   24.010821]  ? evm_file_release+0x141/0x220
[   24.011285]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.011816]  __fput+0x41c/0xb70
[   24.012177]  ____fput+0x22/0x30
[   24.012532]  task_work_run+0x19b/0x2b0
[   24.012956]  ? __pfx_task_work_run+0x10/0x10
[   24.013448]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   24.014028]  ? switch_task_namespaces+0xc6/0x110
[   24.014538]  do_exit+0xb0e/0x29d0
[   24.014922]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.015463]  ? __pfx_do_exit+0x10/0x10
[   24.015881]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.016395]  ? __x64_sys_ioctl+0x1ba/0x220
[   24.016850]  make_task_dead+0x181/0x3c0
[   24.017275]  rewind_stack_and_make_dead+0x16/0x20
[   24.017808] RIP: 0033:0x7fe0d063ee5d
[   24.018207] Code: Unable to access opcode bytes at 0x7fe0d063ee33.
[   24.018879] RSP: 002b:00007ffe3b70ec78 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.019675] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fe0d063ee5d
[   24.020419] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.021163] RBP: 00007ffe3b70ec90 R08: 0000000000000800 R09: 0000000000000800
[   24.021939] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe3b70eda8
[   24.022688] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fe0d09a9000
[   24.023448]  </TASK>
[   24.023703] irq event stamp: 0
[   24.024042] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   24.024706] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   24.025613] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   24.026514] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   24.027250] ---[ end trace 0000000000000000 ]---
[   24.027823] ------------[ cut here ]------------
[   24.028314] WARNING: CPU: 0 PID: 746 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   24.029310] Modules linked in:
[   24.029680] CPU: 0 UID: 0 PID: 746 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.030927] Tainted: [D]=DIE, [W]=WARN
[   24.031332] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.032548] RIP: 0010:iommufd_fops_release+0x392/0x420
[   24.033128] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   24.035115] RSP: 0018:ffff8880215efc08 EFLAGS: 00010293
[   24.035683] RAX: 0000000000000000 RBX: ffff888021439008 RCX: ffffffff83afe4ca
[   24.036427] RDX: ffff88801729ca80 RSI: ffffffff83afe642 RDI: ffff8880214390a0
[   24.037172] RBP: ffff8880215efcb8 R08: 0000000000000000 R09: 0000000000000000
[   24.037957] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   24.038711] R13: 0000000000000000 R14: ffff8880215efc50 R15: 0000000000000000
[   24.039454] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   24.040325] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.040955] CR2: 000055dee2f4abbc CR3: 0000000007086001 CR4: 0000000000770ef0
[   24.041748] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.042533] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.043317] PKRU: 55555554
[   24.043621] Call Trace:
[   24.043895]  <TASK>
[   24.044141]  ? show_regs+0x6d/0x80
[   24.044525]  ? __warn+0xf3/0x380
[   24.044890]  ? report_bug+0x25e/0x4b0
[   24.045295]  ? iommufd_fops_release+0x392/0x420
[   24.045812]  ? report_bug+0x2cb/0x4b0
[   24.046226]  ? iommufd_fops_release+0x392/0x420
[   24.046723]  ? iommufd_fops_release+0x392/0x420
[   24.047234]  ? handle_bug+0x2cd/0x510
[   24.047641]  ? iommufd_fops_release+0x394/0x420
[   24.048138]  ? exc_invalid_op+0x3c/0x80
[   24.048568]  ? asm_exc_invalid_op+0x1f/0x30
[   24.049029]  ? iommufd_fops_release+0x21a/0x420
[   24.049545]  ? iommufd_fops_release+0x392/0x420
[   24.050039]  ? iommufd_fops_release+0x392/0x420
[   24.050537]  ? iommufd_fops_release+0x392/0x420
[   24.051051]  ? locks_remove_file+0x3b4/0x5d0
[   24.051525]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.052078]  ? __memcg_slab_free_hook+0xc1/0x540
[   24.052586]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   24.053164]  ? evm_file_release+0x141/0x220
[   24.053646]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.054178]  __fput+0x41c/0xb70
[   24.054538]  ____fput+0x22/0x30
[   24.054924]  task_work_run+0x19b/0x2b0
[   24.055347]  ? __pfx_task_work_run+0x10/0x10
[   24.055855]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   24.056435]  ? switch_task_namespaces+0xc6/0x110
[   24.056946]  do_exit+0xb0e/0x29d0
[   24.057348]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.057941]  ? __pfx_do_exit+0x10/0x10
[   24.058374]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.058914]  ? __x64_sys_ioctl+0x1ba/0x220
[   24.059401]  make_task_dead+0x181/0x3c0
[   24.059827]  rewind_stack_and_make_dead+0x16/0x20
[   24.060336] RIP: 0033:0x7fe0d063ee5d
[   24.060743] Code: Unable to access opcode bytes at 0x7fe0d063ee33.
[   24.061432] RSP: 002b:00007ffe3b70ec78 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.062277] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fe0d063ee5d
[   24.063123] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.063907] RBP: 00007ffe3b70ec90 R08: 0000000000000800 R09: 0000000000000800
[   24.064673] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe3b70eda8
[   24.065457] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fe0d09a9000
[   24.066218]  </TASK>
[   24.066469] irq event stamp: 0
[   24.066817] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   24.067478] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   24.068342] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   24.069198] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   24.069873] ---[ end trace 0000000000000000 ]---
[   24.079895] iommufd_mock iommufd_mock17: Adding to iommu group 17
[   24.080884] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#18] SMP KASAN NOPTI
[   24.082131] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   24.083016] CPU: 1 UID: 0 PID: 747 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.084221] Tainted: [D]=DIE, [W]=WARN
[   24.084618] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.085775] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.086395] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   24.088340] RSP: 0018:ffff88801cba7b78 EFLAGS: 00010246
[   24.088901] RAX: dffffc0000000000 RBX: ffff888010d32200 RCX: 1ffffffff0dd8bdd
[   24.089654] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801c8b527c
[   24.090399] RBP: ffff88801cba7bc8 R08: 0000000000000000 R09: 0000000000000000
[   24.091159] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   24.091907] R13: 0000000000000001 R14: ffff88801cba7e18 R15: ffff8880134f2408
[   24.092656] FS:  00007f71d8e8f600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   24.093497] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.094107] CR2: 00000000200006c0 CR3: 0000000011574003 CR4: 0000000000770ef0
[   24.094862] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.095608] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.096354] PKRU: 55555554
[   24.096654] Call Trace:
[   24.096929]  <TASK>
[   24.097173]  ? show_regs+0x6d/0x80
[   24.097563]  ? die_addr+0x45/0xb0
[   24.097938]  ? exc_general_protection+0x1ad/0x340
[   24.098465]  ? asm_exc_general_protection+0x2b/0x30
[   24.099015]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.099573]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   24.100129]  iommufd_device_detach+0x2a/0x2e0
[   24.100625]  iommufd_test+0x2f99/0x5cd0
[   24.101053]  ? do_raw_spin_unlock+0x15c/0x210
[   24.101541]  ? __pfx_iommufd_test+0x10/0x10
[   24.102001]  ? debug_smp_processor_id+0x20/0x30
[   24.102501]  ? rcu_is_watching+0x19/0xc0
[   24.102944]  ? lock_release+0x1ea/0x2c0
[   24.103372]  ? __might_fault+0xf1/0x1b0
[   24.103806]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   24.104389]  iommufd_fops_ioctl+0x38e/0x520
[   24.104853]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.105373]  ? trace_irq_enable+0xd1/0x110
[   24.105834]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.106378]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.106904]  __x64_sys_ioctl+0x1ba/0x220
[   24.107342]  x64_sys_call+0x122e/0x2150
[   24.107764]  do_syscall_64+0x6d/0x150
[   24.108173]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   24.108719] RIP: 0033:0x7f71d8c3ee5d
[   24.109117] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   24.111028] RSP: 002b:00007ffc7bd51df8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.111824] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f71d8c3ee5d
[   24.112572] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.113319] RBP: 00007ffc7bd51e10 R08: 0000000000000800 R09: 0000000000000800
[   24.114076] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc7bd51f28
[   24.114828] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f71d8ed8000
[   24.115582]  </TASK>
[   24.115836] Modules linked in:
[   24.116257] ---[ end trace 0000000000000000 ]---
[   24.116772] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.117427] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   24.119450] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   24.120019] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   24.120775] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   24.121598] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   24.122366] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   24.123238] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   24.124098] FS:  00007f71d8e8f600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   24.125037] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.125690] CR2: 00000000200006c0 CR3: 0000000011574003 CR4: 0000000000770ef0
[   24.126451] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.127218] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.128070] PKRU: 55555554
[   24.129039] ------------[ cut here ]------------
[   24.129646] WARNING: CPU: 1 PID: 747 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   24.130701] Modules linked in:
[   24.131080] CPU: 1 UID: 0 PID: 747 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.132459] Tainted: [D]=DIE, [W]=WARN
[   24.132893] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.134537] RIP: 0010:iommufd_fops_release+0x386/0x420
[   24.135136] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   24.137237] RSP: 0018:ffff88801cba7c08 EFLAGS: 00010293
[   24.137892] RAX: 0000000000000000 RBX: ffff888021438808 RCX: ffffffff83afe4ca
[   24.138738] RDX: ffff88801c8b4a80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   24.139583] RBP: ffff88801cba7cb8 R08: 0000000000000000 R09: 0000000000000000
[   24.140393] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   24.141245] R13: 0000000000000000 R14: ffff88801cba7c50 R15: 0000000000000000
[   24.142168] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   24.143066] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.143723] CR2: 00000000200006c0 CR3: 0000000007086004 CR4: 0000000000770ef0
[   24.144538] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.145402] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.146224] PKRU: 55555554
[   24.146549] Call Trace:
[   24.146913]  <TASK>
[   24.147168]  ? show_regs+0x6d/0x80
[   24.147574]  ? __warn+0xf3/0x380
[   24.147965]  ? report_bug+0x25e/0x4b0
[   24.148390]  ? iommufd_fops_release+0x386/0x420
[   24.148984]  ? report_bug+0x2cb/0x4b0
[   24.149494]  ? iommufd_fops_release+0x386/0x420
[   24.150036]  ? iommufd_fops_release+0x386/0x420
[   24.150573]  ? handle_bug+0x2cd/0x510
[   24.151105]  ? iommufd_fops_release+0x388/0x420
[   24.151632]  ? exc_invalid_op+0x3c/0x80
[   24.152089]  ? asm_exc_invalid_op+0x1f/0x30
[   24.152625]  ? iommufd_fops_release+0x21a/0x420
[   24.153176]  ? iommufd_fops_release+0x386/0x420
[   24.153765]  ? iommufd_fops_release+0x386/0x420
[   24.154362]  ? iommufd_fops_release+0x386/0x420
[   24.154879]  ? locks_remove_file+0x3b4/0x5d0
[   24.155373]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.155934]  ? __memcg_slab_free_hook+0xc1/0x540
[   24.156531]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   24.157159]  ? evm_file_release+0x141/0x220
[   24.157705]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.158251]  __fput+0x41c/0xb70
[   24.158637]  ____fput+0x22/0x30
[   24.159089]  task_work_run+0x19b/0x2b0
[   24.159538]  ? __pfx_task_work_run+0x10/0x10
[   24.160035]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   24.160717]  ? switch_task_namespaces+0xc6/0x110
[   24.161249]  do_exit+0xb0e/0x29d0
[   24.161710]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.162354]  ? __pfx_do_exit+0x10/0x10
[   24.162799]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.163346]  ? __x64_sys_ioctl+0x1ba/0x220
[   24.163843]  make_task_dead+0x181/0x3c0
[   24.164361]  rewind_stack_and_make_dead+0x16/0x20
[   24.164894] RIP: 0033:0x7f71d8c3ee5d
[   24.165304] Code: Unable to access opcode bytes at 0x7f71d8c3ee33.
[   24.166202] RSP: 002b:00007ffc7bd51df8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.167077] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f71d8c3ee5d
[   24.167951] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.168767] RBP: 00007ffc7bd51e10 R08: 0000000000000800 R09: 0000000000000800
[   24.169718] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc7bd51f28
[   24.170521] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f71d8ed8000
[   24.171407]  </TASK>
[   24.171680] irq event stamp: 0
[   24.172046] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   24.172813] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   24.173804] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   24.174779] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   24.175461] ---[ end trace 0000000000000000 ]---
[   24.176071] ------------[ cut here ]------------
[   24.176574] WARNING: CPU: 1 PID: 747 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   24.177749] Modules linked in:
[   24.178121] CPU: 1 UID: 0 PID: 747 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.179528] Tainted: [D]=DIE, [W]=WARN
[   24.179964] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.181305] RIP: 0010:iommufd_fops_release+0x392/0x420
[   24.181982] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   24.184125] RSP: 0018:ffff88801cba7c08 EFLAGS: 00010293
[   24.184803] RAX: 0000000000000000 RBX: ffff888021438808 RCX: ffffffff83afe4ca
[   24.185685] RDX: ffff88801c8b4a80 RSI: ffffffff83afe642 RDI: ffff8880214388a0
[   24.186547] RBP: ffff88801cba7cb8 R08: 0000000000000000 R09: 0000000000000000
[   24.187360] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   24.188250] R13: 0000000000000000 R14: ffff88801cba7c50 R15: 0000000000000000
[   24.189058] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   24.190117] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.190784] CR2: 00000000200006c0 CR3: 0000000007086004 CR4: 0000000000770ef0
[   24.191664] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.192472] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.193405] PKRU: 55555554
[   24.193729] Call Trace:
[   24.194031]  <TASK>
[   24.194295]  ? show_regs+0x6d/0x80
[   24.194713]  ? __warn+0xf3/0x380
[   24.195171]  ? report_bug+0x25e/0x4b0
[   24.195609]  ? iommufd_fops_release+0x392/0x420
[   24.196161]  ? report_bug+0x2cb/0x4b0
[   24.196650]  ? iommufd_fops_release+0x392/0x420
[   24.197202]  ? iommufd_fops_release+0x392/0x420
[   24.197800]  ? handle_bug+0x2cd/0x510
[   24.198304]  ? iommufd_fops_release+0x394/0x420
[   24.198830]  ? exc_invalid_op+0x3c/0x80
[   24.199278]  ? asm_exc_invalid_op+0x1f/0x30
[   24.199761]  ? iommufd_fops_release+0x21a/0x420
[   24.200332]  ? iommufd_fops_release+0x392/0x420
[   24.200922]  ? iommufd_fops_release+0x392/0x420
[   24.201478]  ? iommufd_fops_release+0x392/0x420
[   24.202102]  ? locks_remove_file+0x3b4/0x5d0
[   24.202615]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.203192]  ? __memcg_slab_free_hook+0xc1/0x540
[   24.203758]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   24.204447]  ? evm_file_release+0x141/0x220
[   24.204950]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.205592]  __fput+0x41c/0xb70
[   24.205965]  ____fput+0x22/0x30
[   24.206340]  task_work_run+0x19b/0x2b0
[   24.206781]  ? __pfx_task_work_run+0x10/0x10
[   24.207274]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   24.207922]  ? switch_task_namespaces+0xc6/0x110
[   24.208530]  do_exit+0xb0e/0x29d0
[   24.208925]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.209560]  ? __pfx_do_exit+0x10/0x10
[   24.210062]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.210619]  ? __x64_sys_ioctl+0x1ba/0x220
[   24.211100]  make_task_dead+0x181/0x3c0
[   24.211655]  rewind_stack_and_make_dead+0x16/0x20
[   24.212188] RIP: 0033:0x7f71d8c3ee5d
[   24.212605] Code: Unable to access opcode bytes at 0x7f71d8c3ee33.
[   24.213408] RSP: 002b:00007ffc7bd51df8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.214252] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f71d8c3ee5d
[   24.215048] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.215926] RBP: 00007ffc7bd51e10 R08: 0000000000000800 R09: 0000000000000800
[   24.216711] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc7bd51f28
[   24.217621] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f71d8ed8000
[   24.218396]  </TASK>
[   24.218663] irq event stamp: 0
[   24.219048] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   24.219842] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   24.220747] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   24.221712] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   24.222430] ---[ end trace 0000000000000000 ]---
[   24.228421] iommufd_mock iommufd_mock18: Adding to iommu group 18
[   24.229231] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#19] SMP KASAN NOPTI
[   24.230381] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   24.231167] CPU: 0 UID: 0 PID: 748 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.232372] Tainted: [D]=DIE, [W]=WARN
[   24.232777] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.233945] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.234566] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   24.236638] RSP: 0018:ffff888020fafb78 EFLAGS: 00010246
[   24.237256] RAX: dffffc0000000000 RBX: ffff888011120200 RCX: 1ffffffff0dd8bdc
[   24.238062] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88802159527c
[   24.238810] RBP: ffff888020fafbc8 R08: 0000000000000000 R09: 0000000000000000
[   24.239559] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   24.240308] R13: 0000000000000001 R14: ffff888020fafe18 R15: ffff888010d96408
[   24.241060] FS:  00007f472e16e600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   24.241900] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.242547] CR2: 00000000200006c0 CR3: 000000001dcfe005 CR4: 0000000000770ef0
[   24.243357] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.244128] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.244901] PKRU: 55555554
[   24.245202] Call Trace:
[   24.245478]  <TASK>
[   24.245736]  ? show_regs+0x6d/0x80
[   24.246161]  ? die_addr+0x45/0xb0
[   24.246576]  ? exc_general_protection+0x1ad/0x340
[   24.247114]  ? asm_exc_general_protection+0x2b/0x30
[   24.247687]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.248283]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   24.248873]  iommufd_device_detach+0x2a/0x2e0
[   24.249407]  iommufd_test+0x2f99/0x5cd0
[   24.249873]  ? do_raw_spin_unlock+0x15c/0x210
[   24.250417]  ? __pfx_iommufd_test+0x10/0x10
[   24.250905]  ? debug_smp_processor_id+0x20/0x30
[   24.251408]  ? rcu_is_watching+0x19/0xc0
[   24.251847]  ? lock_release+0x1ea/0x2c0
[   24.252275]  ? __might_fault+0xf1/0x1b0
[   24.252706]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   24.253298]  iommufd_fops_ioctl+0x38e/0x520
[   24.253762]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.254276]  ? trace_irq_enable+0xd1/0x110
[   24.254741]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.255280]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.255799]  __x64_sys_ioctl+0x1ba/0x220
[   24.256254]  x64_sys_call+0x122e/0x2150
[   24.256703]  do_syscall_64+0x6d/0x150
[   24.257159]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   24.257750] RIP: 0033:0x7f472de3ee5d
[   24.258155] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   24.260132] RSP: 002b:00007fff16a21288 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.260996] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f472de3ee5d
[   24.261758] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.262500] RBP: 00007fff16a212a0 R08: 0000000000000800 R09: 0000000000000800
[   24.263250] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff16a213b8
[   24.263998] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f472e1b7000
[   24.264755]  </TASK>
[   24.265008] Modules linked in:
[   24.265504] ---[ end trace 0000000000000000 ]---
[   24.266018] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.266652] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   24.268618] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   24.269171] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   24.269965] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   24.270717] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   24.271448] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   24.272176] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   24.272905] FS:  00007f472e16e600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   24.273799] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.274407] CR2: 00000000200006c0 CR3: 000000001dcfe005 CR4: 0000000000770ef0
[   24.275199] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.275927] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.276654] PKRU: 55555554
[   24.278330] ------------[ cut here ]------------
[   24.278852] WARNING: CPU: 1 PID: 748 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   24.279819] Modules linked in:
[   24.280160] CPU: 1 UID: 0 PID: 748 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.281456] Tainted: [D]=DIE, [W]=WARN
[   24.281893] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.283069] RIP: 0010:iommufd_fops_release+0x386/0x420
[   24.283626] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   24.285575] RSP: 0018:ffff888020fafc08 EFLAGS: 00010293
[   24.286161] RAX: 0000000000000000 RBX: ffff8880138ce008 RCX: ffffffff83afe4ca
[   24.286912] RDX: ffff888021594a80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   24.287655] RBP: ffff888020fafcb8 R08: 0000000000000000 R09: 0000000000000000
[   24.288403] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   24.289251] R13: 0000000000000000 R14: ffff888020fafc50 R15: 0000000000000000
[   24.290237] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   24.291310] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.292037] CR2: 00007f25f7ca5000 CR3: 000000001206e002 CR4: 0000000000770ef0
[   24.292917] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.293746] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.294511] PKRU: 55555554
[   24.294829] Call Trace:
[   24.295106]  <TASK>
[   24.295357]  ? show_regs+0x6d/0x80
[   24.295752]  ? __warn+0xf3/0x380
[   24.296125]  ? report_bug+0x25e/0x4b0
[   24.296526]  ? iommufd_fops_release+0x386/0x420
[   24.297011]  ? report_bug+0x2cb/0x4b0
[   24.297436]  ? iommufd_fops_release+0x386/0x420
[   24.297922]  ? iommufd_fops_release+0x386/0x420
[   24.298406]  ? handle_bug+0x2cd/0x510
[   24.298808]  ? iommufd_fops_release+0x388/0x420
[   24.299270]  ? exc_invalid_op+0x3c/0x80
[   24.299685]  ? asm_exc_invalid_op+0x1f/0x30
[   24.300135]  ? iommufd_fops_release+0x21a/0x420
[   24.300620]  ? iommufd_fops_release+0x386/0x420
[   24.301108]  ? iommufd_fops_release+0x386/0x420
[   24.301622]  ? iommufd_fops_release+0x386/0x420
[   24.302116]  ? locks_remove_file+0x3b4/0x5d0
[   24.302585]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.303112]  ? __memcg_slab_free_hook+0xc1/0x540
[   24.303614]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   24.304216]  ? evm_file_release+0x141/0x220
[   24.304669]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.305209]  __fput+0x41c/0xb70
[   24.305599]  ____fput+0x22/0x30
[   24.305970]  task_work_run+0x19b/0x2b0
[   24.306390]  ? __pfx_task_work_run+0x10/0x10
[   24.306866]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   24.307452]  ? switch_task_namespaces+0xc6/0x110
[   24.307963]  do_exit+0xb0e/0x29d0
[   24.308346]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.308898]  ? __pfx_do_exit+0x10/0x10
[   24.309320]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.309859]  ? __x64_sys_ioctl+0x1ba/0x220
[   24.310317]  make_task_dead+0x181/0x3c0
[   24.310755]  rewind_stack_and_make_dead+0x16/0x20
[   24.311268] RIP: 0033:0x7f472de3ee5d
[   24.311668] Code: Unable to access opcode bytes at 0x7f472de3ee33.
[   24.312318] RSP: 002b:00007fff16a21288 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.313113] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f472de3ee5d
[   24.313890] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.314646] RBP: 00007fff16a212a0 R08: 0000000000000800 R09: 0000000000000800
[   24.315411] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff16a213b8
[   24.316173] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f472e1b7000
[   24.316951]  </TASK>
[   24.317208] irq event stamp: 0
[   24.317574] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   24.318242] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   24.319116] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   24.319994] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   24.320652] ---[ end trace 0000000000000000 ]---
[   24.321246] ------------[ cut here ]------------
[   24.321771] WARNING: CPU: 1 PID: 748 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   24.322780] Modules linked in:
[   24.323147] CPU: 1 UID: 0 PID: 748 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.324412] Tainted: [D]=DIE, [W]=WARN
[   24.324820] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.326042] RIP: 0010:iommufd_fops_release+0x392/0x420
[   24.326603] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   24.328531] RSP: 0018:ffff888020fafc08 EFLAGS: 00010293
[   24.329103] RAX: 0000000000000000 RBX: ffff8880138ce008 RCX: ffffffff83afe4ca
[   24.329877] RDX: ffff888021594a80 RSI: ffffffff83afe642 RDI: ffff8880138ce0a0
[   24.330623] RBP: ffff888020fafcb8 R08: 0000000000000000 R09: 0000000000000000
[   24.331390] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   24.332142] R13: 0000000000000000 R14: ffff888020fafc50 R15: 0000000000000000
[   24.332886] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   24.333753] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.334360] CR2: 00007f25f7ca5000 CR3: 000000001206e002 CR4: 0000000000770ef0
[   24.335120] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.335860] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.336600] PKRU: 55555554
[   24.336903] Call Trace:
[   24.337180]  <TASK>
[   24.337443]  ? show_regs+0x6d/0x80
[   24.337835]  ? __warn+0xf3/0x380
[   24.338202]  ? report_bug+0x25e/0x4b0
[   24.338608]  ? iommufd_fops_release+0x392/0x420
[   24.339113]  ? report_bug+0x2cb/0x4b0
[   24.339518]  ? iommufd_fops_release+0x392/0x420
[   24.340015]  ? iommufd_fops_release+0x392/0x420
[   24.340522]  ? handle_bug+0x2cd/0x510
[   24.340925]  ? iommufd_fops_release+0x394/0x420
[   24.341435]  ? exc_invalid_op+0x3c/0x80
[   24.341858]  ? asm_exc_invalid_op+0x1f/0x30
[   24.342316]  ? iommufd_fops_release+0x21a/0x420
[   24.342811]  ? iommufd_fops_release+0x392/0x420
[   24.343299]  ? iommufd_fops_release+0x392/0x420
[   24.343788]  ? iommufd_fops_release+0x392/0x420
[   24.344276]  ? locks_remove_file+0x3b4/0x5d0
[   24.344746]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.345280]  ? __memcg_slab_free_hook+0xc1/0x540
[   24.345803]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   24.346378]  ? evm_file_release+0x141/0x220
[   24.346838]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.347360]  __fput+0x41c/0xb70
[   24.347715]  ____fput+0x22/0x30
[   24.348065]  task_work_run+0x19b/0x2b0
[   24.348486]  ? __pfx_task_work_run+0x10/0x10
[   24.348952]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   24.349544]  ? switch_task_namespaces+0xc6/0x110
[   24.350050]  do_exit+0xb0e/0x29d0
[   24.350422]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.350961]  ? __pfx_do_exit+0x10/0x10
[   24.351375]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.351885]  ? __x64_sys_ioctl+0x1ba/0x220
[   24.352329]  make_task_dead+0x181/0x3c0
[   24.352747]  rewind_stack_and_make_dead+0x16/0x20
[   24.353251] RIP: 0033:0x7f472de3ee5d
[   24.353672] Code: Unable to access opcode bytes at 0x7f472de3ee33.
[   24.354319] RSP: 002b:00007fff16a21288 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.355119] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f472de3ee5d
[   24.355865] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.356609] RBP: 00007fff16a212a0 R08: 0000000000000800 R09: 0000000000000800
[   24.357380] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff16a213b8
[   24.358132] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f472e1b7000
[   24.358888]  </TASK>
[   24.359141] irq event stamp: 0
[   24.359479] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   24.360139] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   24.361002] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   24.361883] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   24.362547] ---[ end trace 0000000000000000 ]---
[   24.370889] iommufd_mock iommufd_mock19: Adding to iommu group 19
[   24.371718] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#20] SMP KASAN NOPTI
[   24.372946] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   24.373731] CPU: 1 UID: 0 PID: 749 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.374958] Tainted: [D]=DIE, [W]=WARN
[   24.375360] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.376526] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.377134] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   24.379004] RSP: 0018:ffff888011917b78 EFLAGS: 00010246
[   24.379558] RAX: dffffc0000000000 RBX: ffff888010d32a00 RCX: 1ffffffff0dd8bdd
[   24.380290] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801c8b07fc
[   24.381028] RBP: ffff888011917bc8 R08: 0000000000000000 R09: 0000000000000000
[   24.381772] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   24.382508] R13: 0000000000000001 R14: ffff888011917e18 R15: ffff888011e99008
[   24.383250] FS:  00007f7708bea600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   24.384081] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.384684] CR2: 00000000200006c0 CR3: 000000001af40003 CR4: 0000000000770ef0
[   24.385426] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.386166] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.386911] PKRU: 55555554
[   24.387212] Call Trace:
[   24.387488]  <TASK>
[   24.387741]  ? show_regs+0x6d/0x80
[   24.388127]  ? die_addr+0x45/0xb0
[   24.388502]  ? exc_general_protection+0x1ad/0x340
[   24.389028]  ? asm_exc_general_protection+0x2b/0x30
[   24.389563]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.390114]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   24.390667]  iommufd_device_detach+0x2a/0x2e0
[   24.391154]  iommufd_test+0x2f99/0x5cd0
[   24.391578]  ? do_raw_spin_unlock+0x15c/0x210
[   24.392069]  ? __pfx_iommufd_test+0x10/0x10
[   24.392527]  ? debug_smp_processor_id+0x20/0x30
[   24.393024]  ? rcu_is_watching+0x19/0xc0
[   24.393460]  ? lock_release+0x1ea/0x2c0
[   24.393884]  ? __might_fault+0xf1/0x1b0
[   24.394315]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   24.394900]  iommufd_fops_ioctl+0x38e/0x520
[   24.395361]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.395878]  ? trace_irq_enable+0xd1/0x110
[   24.396338]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.396878]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.397399]  __x64_sys_ioctl+0x1ba/0x220
[   24.397837]  x64_sys_call+0x122e/0x2150
[   24.398255]  do_syscall_64+0x6d/0x150
[   24.398665]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   24.399213] RIP: 0033:0x7f770883ee5d
[   24.399610] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   24.401491] RSP: 002b:00007ffc1dfe9478 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.402286] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f770883ee5d
[   24.403058] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.403878] RBP: 00007ffc1dfe9490 R08: 0000000000000800 R09: 0000000000000800
[   24.404714] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc1dfe95a8
[   24.405470] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f7708c33000
[   24.406209]  </TASK>
[   24.406456] Modules linked in:
[   24.406918] ---[ end trace 0000000000000000 ]---
[   24.407423] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.408050] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   24.410063] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   24.410658] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   24.411510] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   24.412322] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   24.413114] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   24.413917] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   24.414703] FS:  00007f7708bea600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   24.415562] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.416228] CR2: 00000000200006c0 CR3: 000000001af40003 CR4: 0000000000770ef0
[   24.417077] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.417946] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.418742] PKRU: 55555554
[   24.420241] ------------[ cut here ]------------
[   24.420816] WARNING: CPU: 1 PID: 749 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   24.422024] Modules linked in:
[   24.422399] CPU: 1 UID: 0 PID: 749 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.423782] Tainted: [D]=DIE, [W]=WARN
[   24.424235] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.425600] RIP: 0010:iommufd_fops_release+0x386/0x420
[   24.426161] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   24.428159] RSP: 0018:ffff888011917c08 EFLAGS: 00010293
[   24.428769] RAX: 0000000000000000 RBX: ffff88802143b808 RCX: ffffffff83afe4ca
[   24.429715] RDX: ffff88801c8b0000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   24.430468] RBP: ffff888011917cb8 R08: 0000000000000000 R09: 0000000000000000
[   24.431299] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   24.432121] R13: 0000000000000000 R14: ffff888011917c50 R15: 0000000000000000
[   24.432853] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   24.433829] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.434461] CR2: 00000000200006c0 CR3: 000000001af88004 CR4: 0000000000770ef0
[   24.435263] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.436098] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.436896] PKRU: 55555554
[   24.437195] Call Trace:
[   24.437562]  <TASK>
[   24.437805]  ? show_regs+0x6d/0x80
[   24.438234]  ? __warn+0xf3/0x380
[   24.438660]  ? report_bug+0x25e/0x4b0
[   24.439100]  ? iommufd_fops_release+0x386/0x420
[   24.439688]  ? report_bug+0x2cb/0x4b0
[   24.440113]  ? iommufd_fops_release+0x386/0x420
[   24.440719]  ? iommufd_fops_release+0x386/0x420
[   24.441233]  ? handle_bug+0x2cd/0x510
[   24.441747]  ? iommufd_fops_release+0x388/0x420
[   24.442304]  ? exc_invalid_op+0x3c/0x80
[   24.442731]  ? asm_exc_invalid_op+0x1f/0x30
[   24.443270]  ? iommufd_fops_release+0x21a/0x420
[   24.443759]  ? iommufd_fops_release+0x386/0x420
[   24.444255]  ? iommufd_fops_release+0x386/0x420
[   24.444860]  ? iommufd_fops_release+0x386/0x420
[   24.445436]  ? locks_remove_file+0x3b4/0x5d0
[   24.445951]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.446545]  ? __memcg_slab_free_hook+0xc1/0x540
[   24.447088]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   24.447736]  ? evm_file_release+0x141/0x220
[   24.448245]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.448828]  __fput+0x41c/0xb70
[   24.449221]  ____fput+0x22/0x30
[   24.449721]  task_work_run+0x19b/0x2b0
[   24.450161]  ? __pfx_task_work_run+0x10/0x10
[   24.450648]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   24.451329]  ? switch_task_namespaces+0xc6/0x110
[   24.451858]  do_exit+0xb0e/0x29d0
[   24.452323]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.452869]  ? __pfx_do_exit+0x10/0x10
[   24.453321]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.453967]  ? __x64_sys_ioctl+0x1ba/0x220
[   24.454428]  make_task_dead+0x181/0x3c0
[   24.454948]  rewind_stack_and_make_dead+0x16/0x20
[   24.455469] RIP: 0033:0x7f770883ee5d
[   24.455872] Code: Unable to access opcode bytes at 0x7f770883ee33.
[   24.456617] RSP: 002b:00007ffc1dfe9478 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.457590] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f770883ee5d
[   24.458461] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.459220] RBP: 00007ffc1dfe9490 R08: 0000000000000800 R09: 0000000000000800
[   24.460075] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc1dfe95a8
[   24.460838] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f7708c33000
[   24.461718]  </TASK>
[   24.461973] irq event stamp: 0
[   24.462306] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   24.463089] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   24.463943] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   24.464787] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   24.465477] ---[ end trace 0000000000000000 ]---
[   24.466062] ------------[ cut here ]------------
[   24.466560] WARNING: CPU: 1 PID: 749 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   24.467559] Modules linked in:
[   24.467907] CPU: 1 UID: 0 PID: 749 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.469148] Tainted: [D]=DIE, [W]=WARN
[   24.469575] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.470748] RIP: 0010:iommufd_fops_release+0x392/0x420
[   24.471303] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   24.473200] RSP: 0018:ffff888011917c08 EFLAGS: 00010293
[   24.473785] RAX: 0000000000000000 RBX: ffff88802143b808 RCX: ffffffff83afe4ca
[   24.474528] RDX: ffff88801c8b0000 RSI: ffffffff83afe642 RDI: ffff88802143b8a0
[   24.475282] RBP: ffff888011917cb8 R08: 0000000000000000 R09: 0000000000000000
[   24.476022] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   24.476762] R13: 0000000000000000 R14: ffff888011917c50 R15: 0000000000000000
[   24.477546] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   24.478391] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.479007] CR2: 00000000200006c0 CR3: 000000001af88004 CR4: 0000000000770ef0
[   24.479759] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.480506] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.481237] PKRU: 55555554
[   24.481589] Call Trace:
[   24.481867]  <TASK>
[   24.482115]  ? show_regs+0x6d/0x80
[   24.482505]  ? __warn+0xf3/0x380
[   24.482876]  ? report_bug+0x25e/0x4b0
[   24.483285]  ? iommufd_fops_release+0x392/0x420
[   24.483776]  ? report_bug+0x2cb/0x4b0
[   24.484183]  ? iommufd_fops_release+0x392/0x420
[   24.484676]  ? iommufd_fops_release+0x392/0x420
[   24.485173]  ? handle_bug+0x2cd/0x510
[   24.485609]  ? iommufd_fops_release+0x394/0x420
[   24.486107]  ? exc_invalid_op+0x3c/0x80
[   24.486536]  ? asm_exc_invalid_op+0x1f/0x30
[   24.486997]  ? iommufd_fops_release+0x21a/0x420
[   24.487489]  ? iommufd_fops_release+0x392/0x420
[   24.487986]  ? iommufd_fops_release+0x392/0x420
[   24.488482]  ? iommufd_fops_release+0x392/0x420
[   24.488974]  ? locks_remove_file+0x3b4/0x5d0
[   24.489472]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.490001]  ? __memcg_slab_free_hook+0xc1/0x540
[   24.490504]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   24.491087]  ? evm_file_release+0x141/0x220
[   24.491548]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.492071]  __fput+0x41c/0xb70
[   24.492433]  ____fput+0x22/0x30
[   24.492791]  task_work_run+0x19b/0x2b0
[   24.493215]  ? __pfx_task_work_run+0x10/0x10
[   24.493711]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   24.494291]  ? switch_task_namespaces+0xc6/0x110
[   24.494805]  do_exit+0xb0e/0x29d0
[   24.495184]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.495722]  ? __pfx_do_exit+0x10/0x10
[   24.496141]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.496652]  ? __x64_sys_ioctl+0x1ba/0x220
[   24.497105]  make_task_dead+0x181/0x3c0
[   24.497555]  rewind_stack_and_make_dead+0x16/0x20
[   24.498066] RIP: 0033:0x7f770883ee5d
[   24.498461] Code: Unable to access opcode bytes at 0x7f770883ee33.
[   24.499110] RSP: 002b:00007ffc1dfe9478 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.499893] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f770883ee5d
[   24.500638] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.501409] RBP: 00007ffc1dfe9490 R08: 0000000000000800 R09: 0000000000000800
[   24.502158] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc1dfe95a8
[   24.502913] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f7708c33000
[   24.503669]  </TASK>
[   24.503915] irq event stamp: 0
[   24.504250] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   24.504898] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   24.505765] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   24.506613] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   24.507266] ---[ end trace 0000000000000000 ]---
[   24.513145] iommufd_mock iommufd_mock20: Adding to iommu group 20
[   24.514595] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#21] SMP KASAN NOPTI
[   24.515787] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   24.516555] CPU: 0 UID: 0 PID: 750 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.517747] Tainted: [D]=DIE, [W]=WARN
[   24.518136] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.519268] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.519866] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   24.521685] RSP: 0018:ffff888020fafb78 EFLAGS: 00010246
[   24.522225] RAX: dffffc0000000000 RBX: ffff888011120a00 RCX: 1ffffffff0dd8bdc
[   24.522949] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff888021592d3c
[   24.523663] RBP: ffff888020fafbc8 R08: 0000000000000000 R09: 0000000000000000
[   24.524382] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   24.525099] R13: 0000000000000001 R14: ffff888020fafe18 R15: ffff888015024008
[   24.525818] FS:  00007f4ae99a2600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   24.526623] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.527213] CR2: 00000000200006c0 CR3: 000000001390c002 CR4: 0000000000770ef0
[   24.527945] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.528684] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.529424] PKRU: 55555554
[   24.529728] Call Trace:
[   24.529994]  <TASK>
[   24.530231]  ? show_regs+0x6d/0x80
[   24.530611]  ? die_addr+0x45/0xb0
[   24.530983]  ? exc_general_protection+0x1ad/0x340
[   24.531494]  ? asm_exc_general_protection+0x2b/0x30
[   24.532011]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.532548]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   24.533083]  iommufd_device_detach+0x2a/0x2e0
[   24.533555]  iommufd_test+0x2f99/0x5cd0
[   24.533966]  ? do_raw_spin_unlock+0x15c/0x210
[   24.534437]  ? __pfx_iommufd_test+0x10/0x10
[   24.534887]  ? debug_smp_processor_id+0x20/0x30
[   24.535370]  ? rcu_is_watching+0x19/0xc0
[   24.535791]  ? lock_release+0x1ea/0x2c0
[   24.536201]  ? __might_fault+0xf1/0x1b0
[   24.536615]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   24.537173]  iommufd_fops_ioctl+0x38e/0x520
[   24.537619]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.538116]  ? trace_irq_enable+0xd1/0x110
[   24.538559]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.539092]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.539613]  __x64_sys_ioctl+0x1ba/0x220
[   24.540045]  x64_sys_call+0x122e/0x2150
[   24.540453]  do_syscall_64+0x6d/0x150
[   24.540850]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   24.541373] RIP: 0033:0x7f4ae963ee5d
[   24.541753] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   24.543575] RSP: 002b:00007ffcbee42df8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.544336] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f4ae963ee5d
[   24.545065] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.545798] RBP: 00007ffcbee42e10 R08: 0000000000000800 R09: 0000000000000800
[   24.546534] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcbee42f28
[   24.547273] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f4ae99eb000
[   24.548015]  </TASK>
[   24.548262] Modules linked in:
[   24.548768] ---[ end trace 0000000000000000 ]---
[   24.549265] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.549884] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   24.551748] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   24.552303] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   24.553035] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   24.553786] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   24.554525] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   24.555264] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   24.555998] FS:  00007f4ae99a2600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   24.556828] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.557442] CR2: 00000000200006c0 CR3: 000000001390c002 CR4: 0000000000770ef0
[   24.558181] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.558917] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.559649] PKRU: 55555554
[   24.560671] ------------[ cut here ]------------
[   24.561172] WARNING: CPU: 0 PID: 750 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   24.562172] Modules linked in:
[   24.562517] CPU: 0 UID: 0 PID: 750 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.563737] Tainted: [D]=DIE, [W]=WARN
[   24.564136] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.565287] RIP: 0010:iommufd_fops_release+0x386/0x420
[   24.565853] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   24.567721] RSP: 0018:ffff888020fafc08 EFLAGS: 00010293
[   24.568286] RAX: 0000000000000000 RBX: ffff8880138cd808 RCX: ffffffff83afe4ca
[   24.569058] RDX: ffff888021592540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   24.569873] RBP: ffff888020fafcb8 R08: 0000000000000000 R09: 0000000000000000
[   24.570850] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   24.571631] R13: 0000000000000000 R14: ffff888020fafc50 R15: 0000000000000000
[   24.572399] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   24.573277] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.573941] CR2: 00000000200006c0 CR3: 0000000007086003 CR4: 0000000000770ef0
[   24.574782] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.575564] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.576303] PKRU: 55555554
[   24.576619] Call Trace:
[   24.576907]  <TASK>
[   24.577157]  ? show_regs+0x6d/0x80
[   24.577560]  ? __warn+0xf3/0x380
[   24.577925]  ? report_bug+0x25e/0x4b0
[   24.578328]  ? iommufd_fops_release+0x386/0x420
[   24.578831]  ? report_bug+0x2cb/0x4b0
[   24.579245]  ? iommufd_fops_release+0x386/0x420
[   24.579751]  ? iommufd_fops_release+0x386/0x420
[   24.580238]  ? handle_bug+0x2cd/0x510
[   24.580651]  ? iommufd_fops_release+0x388/0x420
[   24.581152]  ? exc_invalid_op+0x3c/0x80
[   24.581607]  ? asm_exc_invalid_op+0x1f/0x30
[   24.582105]  ? iommufd_fops_release+0x21a/0x420
[   24.582618]  ? iommufd_fops_release+0x386/0x420
[   24.583111]  ? iommufd_fops_release+0x386/0x420
[   24.583594]  ? iommufd_fops_release+0x386/0x420
[   24.584074]  ? locks_remove_file+0x3b4/0x5d0
[   24.584538]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.585057]  ? __memcg_slab_free_hook+0xc1/0x540
[   24.585600]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   24.586197]  ? evm_file_release+0x141/0x220
[   24.586683]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.587201]  __fput+0x41c/0xb70
[   24.587561]  ____fput+0x22/0x30
[   24.587923]  task_work_run+0x19b/0x2b0
[   24.588353]  ? __pfx_task_work_run+0x10/0x10
[   24.588826]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   24.589433]  ? switch_task_namespaces+0xc6/0x110
[   24.589981]  do_exit+0xb0e/0x29d0
[   24.590384]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.590945]  ? __pfx_do_exit+0x10/0x10
[   24.591367]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.591886]  ? __x64_sys_ioctl+0x1ba/0x220
[   24.592338]  make_task_dead+0x181/0x3c0
[   24.592761]  rewind_stack_and_make_dead+0x16/0x20
[   24.593285] RIP: 0033:0x7f4ae963ee5d
[   24.593727] Code: Unable to access opcode bytes at 0x7f4ae963ee33.
[   24.594423] RSP: 002b:00007ffcbee42df8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.595221] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f4ae963ee5d
[   24.596014] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.596785] RBP: 00007ffcbee42e10 R08: 0000000000000800 R09: 0000000000000800
[   24.597578] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcbee42f28
[   24.598363] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f4ae99eb000
[   24.599121]  </TASK>
[   24.599386] irq event stamp: 0
[   24.599731] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   24.600435] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   24.601358] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   24.602272] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   24.602941] ---[ end trace 0000000000000000 ]---
[   24.603507] ------------[ cut here ]------------
[   24.603994] WARNING: CPU: 0 PID: 750 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   24.604973] Modules linked in:
[   24.605317] CPU: 0 UID: 0 PID: 750 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.606581] Tainted: [D]=DIE, [W]=WARN
[   24.606987] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.608138] RIP: 0010:iommufd_fops_release+0x392/0x420
[   24.608683] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   24.610575] RSP: 0018:ffff888020fafc08 EFLAGS: 00010293
[   24.611134] RAX: 0000000000000000 RBX: ffff8880138cd808 RCX: ffffffff83afe4ca
[   24.611867] RDX: ffff888021592540 RSI: ffffffff83afe642 RDI: ffff8880138cd8a0
[   24.612655] RBP: ffff888020fafcb8 R08: 0000000000000000 R09: 0000000000000000
[   24.613418] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   24.614154] R13: 0000000000000000 R14: ffff888020fafc50 R15: 0000000000000000
[   24.614900] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   24.615729] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.616330] CR2: 00000000200006c0 CR3: 0000000007086003 CR4: 0000000000770ef0
[   24.617066] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.617848] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.618593] PKRU: 55555554
[   24.618902] Call Trace:
[   24.619172]  <TASK>
[   24.619413]  ? show_regs+0x6d/0x80
[   24.619792]  ? __warn+0xf3/0x380
[   24.620153]  ? report_bug+0x25e/0x4b0
[   24.620553]  ? iommufd_fops_release+0x392/0x420
[   24.621045]  ? report_bug+0x2cb/0x4b0
[   24.621480]  ? iommufd_fops_release+0x392/0x420
[   24.621972]  ? iommufd_fops_release+0x392/0x420
[   24.622460]  ? handle_bug+0x2cd/0x510
[   24.622870]  ? iommufd_fops_release+0x394/0x420
[   24.623353]  ? exc_invalid_op+0x3c/0x80
[   24.623765]  ? asm_exc_invalid_op+0x1f/0x30
[   24.624212]  ? iommufd_fops_release+0x21a/0x420
[   24.624693]  ? iommufd_fops_release+0x392/0x420
[   24.625173]  ? iommufd_fops_release+0x392/0x420
[   24.625680]  ? iommufd_fops_release+0x392/0x420
[   24.626164]  ? locks_remove_file+0x3b4/0x5d0
[   24.626626]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.627157]  ? __memcg_slab_free_hook+0xc1/0x540
[   24.627647]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   24.628207]  ? evm_file_release+0x141/0x220
[   24.628653]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.629166]  __fput+0x41c/0xb70
[   24.629535]  ____fput+0x22/0x30
[   24.629890]  task_work_run+0x19b/0x2b0
[   24.630281]  ? __pfx_task_work_run+0x10/0x10
[   24.630746]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   24.631304]  ? switch_task_namespaces+0xc6/0x110
[   24.631796]  do_exit+0xb0e/0x29d0
[   24.632159]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.632677]  ? __pfx_do_exit+0x10/0x10
[   24.633077]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.633587]  ? __x64_sys_ioctl+0x1ba/0x220
[   24.634027]  make_task_dead+0x181/0x3c0
[   24.634438]  rewind_stack_and_make_dead+0x16/0x20
[   24.634944] RIP: 0033:0x7f4ae963ee5d
[   24.635327] Code: Unable to access opcode bytes at 0x7f4ae963ee33.
[   24.635961] RSP: 002b:00007ffcbee42df8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.636739] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f4ae963ee5d
[   24.637485] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.638215] RBP: 00007ffcbee42e10 R08: 0000000000000800 R09: 0000000000000800
[   24.638949] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcbee42f28
[   24.639677] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f4ae99eb000
[   24.640414]  </TASK>
[   24.640660] irq event stamp: 0
[   24.640991] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   24.641654] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   24.642498] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   24.643349] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   24.643992] ---[ end trace 0000000000000000 ]---
[   24.653100] iommufd_mock iommufd_mock21: Adding to iommu group 21
[   24.654300] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#22] SMP KASAN NOPTI
[   24.655497] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   24.656252] CPU: 0 UID: 0 PID: 751 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.657435] Tainted: [D]=DIE, [W]=WARN
[   24.657822] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.658950] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.659542] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   24.661348] RSP: 0018:ffff888021d17b78 EFLAGS: 00010246
[   24.661883] RAX: dffffc0000000000 RBX: ffff888011121200 RCX: 1ffffffff0dd8bdc
[   24.662593] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801dda07fc
[   24.663308] RBP: ffff888021d17bc8 R08: 0000000000000000 R09: 0000000000000000
[   24.664036] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   24.664762] R13: 0000000000000001 R14: ffff888021d17e18 R15: ffff88800eaa6008
[   24.665506] FS:  00007f3dc44f5600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   24.666333] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.666933] CR2: 00000000200006c0 CR3: 000000001390c001 CR4: 0000000000770ef0
[   24.667662] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.668386] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.669117] PKRU: 55555554
[   24.669412] Call Trace:
[   24.669683]  <TASK>
[   24.669925]  ? show_regs+0x6d/0x80
[   24.670303]  ? die_addr+0x45/0xb0
[   24.670674]  ? exc_general_protection+0x1ad/0x340
[   24.671199]  ? asm_exc_general_protection+0x2b/0x30
[   24.671723]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.672264]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   24.672806]  iommufd_device_detach+0x2a/0x2e0
[   24.673269]  iommufd_test+0x2f99/0x5cd0
[   24.673675]  ? do_raw_spin_unlock+0x15c/0x210
[   24.674141]  ? __pfx_iommufd_test+0x10/0x10
[   24.674580]  ? debug_smp_processor_id+0x20/0x30
[   24.675063]  ? rcu_is_watching+0x19/0xc0
[   24.675483]  ? lock_release+0x1ea/0x2c0
[   24.675892]  ? __might_fault+0xf1/0x1b0
[   24.676307]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   24.676864]  iommufd_fops_ioctl+0x38e/0x520
[   24.677307]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.677801]  ? trace_irq_enable+0xd1/0x110
[   24.678243]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.678765]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.679258]  __x64_sys_ioctl+0x1ba/0x220
[   24.679675]  x64_sys_call+0x122e/0x2150
[   24.680079]  do_syscall_64+0x6d/0x150
[   24.680474]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   24.681002] RIP: 0033:0x7f3dc423ee5d
[   24.681387] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   24.683208] RSP: 002b:00007ffdd5d7bd28 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.683964] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f3dc423ee5d
[   24.684676] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.685388] RBP: 00007ffdd5d7bd40 R08: 0000000000000800 R09: 0000000000000800
[   24.686118] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffdd5d7be58
[   24.686856] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f3dc453e000
[   24.687593]  </TASK>
[   24.687839] Modules linked in:
[   24.688224] ---[ end trace 0000000000000000 ]---
[   24.688713] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.689309] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   24.691203] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   24.691748] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   24.692481] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   24.693207] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   24.694324] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   24.695076] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   24.695802] FS:  00007f3dc44f5600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   24.696629] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.697223] CR2: 00000000200006c0 CR3: 000000001390c001 CR4: 0000000000770ef0
[   24.697969] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.698698] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.699435] PKRU: 55555554
[   24.700438] ------------[ cut here ]------------
[   24.700969] WARNING: CPU: 0 PID: 751 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   24.702007] Modules linked in:
[   24.702350] CPU: 0 UID: 0 PID: 751 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.703598] Tainted: [D]=DIE, [W]=WARN
[   24.704045] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.705394] RIP: 0010:iommufd_fops_release+0x386/0x420
[   24.705937] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   24.707728] RSP: 0018:ffff888021d17c08 EFLAGS: 00010293
[   24.708278] RAX: 0000000000000000 RBX: ffff8880138c9008 RCX: ffffffff83afe4ca
[   24.709257] RDX: ffff88801dda0000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   24.710029] RBP: ffff888021d17cb8 R08: 0000000000000000 R09: 0000000000000000
[   24.710759] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   24.711479] R13: 0000000000000000 R14: ffff888021d17c50 R15: 0000000000000000
[   24.712251] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   24.713246] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.713858] CR2: 00000000200006c0 CR3: 0000000007086003 CR4: 0000000000770ef0
[   24.714596] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.715362] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.716306] PKRU: 55555554
[   24.716745] Call Trace:
[   24.717032]  <TASK>
[   24.717283]  ? show_regs+0x6d/0x80
[   24.717697]  ? __warn+0xf3/0x380
[   24.718075]  ? report_bug+0x25e/0x4b0
[   24.718494]  ? iommufd_fops_release+0x386/0x420
[   24.719028]  ? report_bug+0x2cb/0x4b0
[   24.719437]  ? iommufd_fops_release+0x386/0x420
[   24.719953]  ? iommufd_fops_release+0x386/0x420
[   24.720671]  ? handle_bug+0x2cd/0x510
[   24.721095]  ? iommufd_fops_release+0x388/0x420
[   24.721637]  ? exc_invalid_op+0x3c/0x80
[   24.722090]  ? asm_exc_invalid_op+0x1f/0x30
[   24.722576]  ? iommufd_fops_release+0x21a/0x420
[   24.723161]  ? iommufd_fops_release+0x386/0x420
[   24.723845]  ? iommufd_fops_release+0x386/0x420
[   24.724376]  ? iommufd_fops_release+0x386/0x420
[   24.724888]  ? locks_remove_file+0x3b4/0x5d0
[   24.725395]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.726109]  ? __memcg_slab_free_hook+0xc1/0x540
[   24.726693]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   24.727314]  ? evm_file_release+0x141/0x220
[   24.727894]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.728565]  __fput+0x41c/0xb70
[   24.728934]  ____fput+0x22/0x30
[   24.729283]  task_work_run+0x19b/0x2b0
[   24.729730]  ? __pfx_task_work_run+0x10/0x10
[   24.730204]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   24.730778]  ? switch_task_namespaces+0xc6/0x110
[   24.731289]  do_exit+0xb0e/0x29d0
[   24.731662]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.732329]  ? __pfx_do_exit+0x10/0x10
[   24.732869]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.733404]  ? __x64_sys_ioctl+0x1ba/0x220
[   24.733871]  make_task_dead+0x181/0x3c0
[   24.734316]  rewind_stack_and_make_dead+0x16/0x20
[   24.734837] RIP: 0033:0x7f3dc423ee5d
[   24.735249] Code: Unable to access opcode bytes at 0x7f3dc423ee33.
[   24.735973] RSP: 002b:00007ffdd5d7bd28 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.736941] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f3dc423ee5d
[   24.737707] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.738472] RBP: 00007ffdd5d7bd40 R08: 0000000000000800 R09: 0000000000000800
[   24.739412] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffdd5d7be58
[   24.740183] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f3dc453e000
[   24.740993]  </TASK>
[   24.741264] irq event stamp: 0
[   24.741645] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   24.742343] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   24.743247] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   24.744285] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   24.744937] ---[ end trace 0000000000000000 ]---
[   24.745547] ------------[ cut here ]------------
[   24.746076] WARNING: CPU: 0 PID: 751 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   24.747316] Modules linked in:
[   24.747691] CPU: 0 UID: 0 PID: 751 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.748966] Tainted: [D]=DIE, [W]=WARN
[   24.749398] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.750638] RIP: 0010:iommufd_fops_release+0x392/0x420
[   24.751190] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   24.753395] RSP: 0018:ffff888021d17c08 EFLAGS: 00010293
[   24.753981] RAX: 0000000000000000 RBX: ffff8880138c9008 RCX: ffffffff83afe4ca
[   24.754768] RDX: ffff88801dda0000 RSI: ffffffff83afe642 RDI: ffff8880138c90a0
[   24.755529] RBP: ffff888021d17cb8 R08: 0000000000000000 R09: 0000000000000000
[   24.756564] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   24.757362] R13: 0000000000000000 R14: ffff888021d17c50 R15: 0000000000000000
[   24.758141] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   24.758998] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.759641] CR2: 00000000200006c0 CR3: 0000000007086003 CR4: 0000000000770ef0
[   24.760613] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.761392] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.762150] PKRU: 55555554
[   24.762456] Call Trace:
[   24.762785]  <TASK>
[   24.763117]  ? show_regs+0x6d/0x80
[   24.763658]  ? __warn+0xf3/0x380
[   24.764064]  ? report_bug+0x25e/0x4b0
[   24.764455]  ? iommufd_fops_release+0x392/0x420
[   24.764932]  ? report_bug+0x2cb/0x4b0
[   24.765344]  ? iommufd_fops_release+0x392/0x420
[   24.765822]  ? iommufd_fops_release+0x392/0x420
[   24.766297]  ? handle_bug+0x2cd/0x510
[   24.766693]  ? iommufd_fops_release+0x394/0x420
[   24.767177]  ? exc_invalid_op+0x3c/0x80
[   24.767622]  ? asm_exc_invalid_op+0x1f/0x30
[   24.768136]  ? iommufd_fops_release+0x21a/0x420
[   24.768728]  ? iommufd_fops_release+0x392/0x420
[   24.769206]  ? iommufd_fops_release+0x392/0x420
[   24.769715]  ? iommufd_fops_release+0x392/0x420
[   24.770192]  ? locks_remove_file+0x3b4/0x5d0
[   24.770646]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.771154]  ? __memcg_slab_free_hook+0xc1/0x540
[   24.771636]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   24.772295]  ? evm_file_release+0x141/0x220
[   24.772860]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.773394]  __fput+0x41c/0xb70
[   24.773744]  ____fput+0x22/0x30
[   24.774092]  task_work_run+0x19b/0x2b0
[   24.774499]  ? __pfx_task_work_run+0x10/0x10
[   24.774963]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   24.775528]  ? switch_task_namespaces+0xc6/0x110
[   24.776135]  do_exit+0xb0e/0x29d0
[   24.776624]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.777158]  ? __pfx_do_exit+0x10/0x10
[   24.777588]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.778089]  ? __x64_sys_ioctl+0x1ba/0x220
[   24.778537]  make_task_dead+0x181/0x3c0
[   24.778953]  rewind_stack_and_make_dead+0x16/0x20
[   24.779448] RIP: 0033:0x7f3dc423ee5d
[   24.779830] Code: Unable to access opcode bytes at 0x7f3dc423ee33.
[   24.780480] RSP: 002b:00007ffdd5d7bd28 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.781304] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f3dc423ee5d
[   24.782293] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.783038] RBP: 00007ffdd5d7bd40 R08: 0000000000000800 R09: 0000000000000800
[   24.783779] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffdd5d7be58
[   24.784517] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f3dc453e000
[   24.785259]  </TASK>
[   24.785534] irq event stamp: 0
[   24.785866] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   24.786522] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   24.787422] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   24.788454] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   24.789149] ---[ end trace 0000000000000000 ]---
[   24.796941] iommufd_mock iommufd_mock22: Adding to iommu group 22
[   24.799430] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#23] SMP KASAN NOPTI
[   24.800583] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   24.801353] CPU: 0 UID: 0 PID: 752 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.802673] Tainted: [D]=DIE, [W]=WARN
[   24.803082] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.804224] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.804826] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   24.806643] RSP: 0018:ffff888020fafb78 EFLAGS: 00010246
[   24.807188] RAX: dffffc0000000000 RBX: ffff888011121000 RCX: 1ffffffff0dd8bdc
[   24.807906] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801c8b2d3c
[   24.808623] RBP: ffff888020fafbc8 R08: 0000000000000000 R09: 0000000000000000
[   24.809348] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   24.810081] R13: 0000000000000001 R14: ffff888020fafe18 R15: ffff88800dea3008
[   24.810824] FS:  00007f12e0df8600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   24.811644] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.812242] CR2: 00000000200006c0 CR3: 0000000016352005 CR4: 0000000000770ef0
[   24.812977] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.813705] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.814437] PKRU: 55555554
[   24.814741] Call Trace:
[   24.815013]  <TASK>
[   24.815265]  ? show_regs+0x6d/0x80
[   24.815680]  ? die_addr+0x45/0xb0
[   24.816086]  ? exc_general_protection+0x1ad/0x340
[   24.816639]  ? asm_exc_general_protection+0x2b/0x30
[   24.817181]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.817743]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   24.818303]  iommufd_device_detach+0x2a/0x2e0
[   24.818792]  iommufd_test+0x2f99/0x5cd0
[   24.819206]  ? do_raw_spin_unlock+0x15c/0x210
[   24.819676]  ? __pfx_iommufd_test+0x10/0x10
[   24.820114]  ? debug_smp_processor_id+0x20/0x30
[   24.820631]  ? rcu_is_watching+0x19/0xc0
[   24.821096]  ? lock_release+0x1ea/0x2c0
[   24.821520]  ? __might_fault+0xf1/0x1b0
[   24.821966]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   24.822529]  iommufd_fops_ioctl+0x38e/0x520
[   24.822976]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.823471]  ? trace_irq_enable+0xd1/0x110
[   24.823912]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.824431]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.824923]  __x64_sys_ioctl+0x1ba/0x220
[   24.825343]  x64_sys_call+0x122e/0x2150
[   24.825756]  do_syscall_64+0x6d/0x150
[   24.826152]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   24.826674] RIP: 0033:0x7f12e0a3ee5d
[   24.827060] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   24.828873] RSP: 002b:00007fff1eb73948 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.829634] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f12e0a3ee5d
[   24.830350] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.831069] RBP: 00007fff1eb73960 R08: 0000000000000800 R09: 0000000000000800
[   24.831782] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff1eb73a78
[   24.832494] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f12e0e41000
[   24.833218]  </TASK>
[   24.833474] Modules linked in:
[   24.834198] ---[ end trace 0000000000000000 ]---
[   24.834718] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.835312] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   24.837126] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   24.837738] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   24.838455] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   24.839181] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   24.839896] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   24.840610] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   24.841396] FS:  00007f12e0df8600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   24.842250] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.842870] CR2: 00000000200006c0 CR3: 0000000016352005 CR4: 0000000000770ef0
[   24.843622] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.844360] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.845089] PKRU: 55555554
[   24.846640] ------------[ cut here ]------------
[   24.847140] WARNING: CPU: 0 PID: 752 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   24.848114] Modules linked in:
[   24.848455] CPU: 0 UID: 0 PID: 752 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.849821] Tainted: [D]=DIE, [W]=WARN
[   24.850223] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.851368] RIP: 0010:iommufd_fops_release+0x386/0x420
[   24.851907] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   24.853764] RSP: 0018:ffff888020fafc08 EFLAGS: 00010293
[   24.854309] RAX: 0000000000000000 RBX: ffff8880138c8808 RCX: ffffffff83afe4ca
[   24.855183] RDX: ffff88801c8b2540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   24.856036] RBP: ffff888020fafcb8 R08: 0000000000000000 R09: 0000000000000000
[   24.856753] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   24.857497] R13: 0000000000000000 R14: ffff888020fafc50 R15: 0000000000000000
[   24.858214] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   24.859009] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.859683] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   24.860522] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.861268] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.862022] PKRU: 55555554
[   24.862322] Call Trace:
[   24.862592]  <TASK>
[   24.862834]  ? show_regs+0x6d/0x80
[   24.863213]  ? __warn+0xf3/0x380
[   24.863571]  ? report_bug+0x25e/0x4b0
[   24.863992]  ? iommufd_fops_release+0x386/0x420
[   24.864561]  ? report_bug+0x2cb/0x4b0
[   24.865078]  ? iommufd_fops_release+0x386/0x420
[   24.865594]  ? iommufd_fops_release+0x386/0x420
[   24.866083]  ? handle_bug+0x2cd/0x510
[   24.866485]  ? iommufd_fops_release+0x388/0x420
[   24.866980]  ? exc_invalid_op+0x3c/0x80
[   24.867400]  ? asm_exc_invalid_op+0x1f/0x30
[   24.867853]  ? iommufd_fops_release+0x21a/0x420
[   24.868366]  ? iommufd_fops_release+0x386/0x420
[   24.869061]  ? iommufd_fops_release+0x386/0x420
[   24.869573]  ? iommufd_fops_release+0x386/0x420
[   24.870059]  ? locks_remove_file+0x3b4/0x5d0
[   24.870529]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.871051]  ? __memcg_slab_free_hook+0xc1/0x540
[   24.871549]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   24.872117]  ? evm_file_release+0x141/0x220
[   24.872568]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.873084]  __fput+0x41c/0xb70
[   24.873458]  ____fput+0x22/0x30
[   24.873845]  task_work_run+0x19b/0x2b0
[   24.874306]  ? __pfx_task_work_run+0x10/0x10
[   24.874895]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   24.875467]  ? switch_task_namespaces+0xc6/0x110
[   24.875966]  do_exit+0xb0e/0x29d0
[   24.876335]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.876863]  ? __pfx_do_exit+0x10/0x10
[   24.877272]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.877793]  ? __x64_sys_ioctl+0x1ba/0x220
[   24.878236]  make_task_dead+0x181/0x3c0
[   24.878656]  rewind_stack_and_make_dead+0x16/0x20
[   24.879160] RIP: 0033:0x7f12e0a3ee5d
[   24.879597] Code: Unable to access opcode bytes at 0x7f12e0a3ee33.
[   24.880406] RSP: 002b:00007fff1eb73948 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.881186] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f12e0a3ee5d
[   24.881933] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.882662] RBP: 00007fff1eb73960 R08: 0000000000000800 R09: 0000000000000800
[   24.883398] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff1eb73a78
[   24.884177] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f12e0e41000
[   24.885023]  </TASK>
[   24.885418] irq event stamp: 0
[   24.885758] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   24.886410] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   24.887277] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   24.888127] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   24.888788] ---[ end trace 0000000000000000 ]---
[   24.889400] ------------[ cut here ]------------
[   24.889971] WARNING: CPU: 0 PID: 752 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   24.891057] Modules linked in:
[   24.891366] CPU: 0 UID: 0 PID: 752 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.892588] Tainted: [D]=DIE, [W]=WARN
[   24.893096] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.894246] RIP: 0010:iommufd_fops_release+0x392/0x420
[   24.894792] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   24.896825] RSP: 0018:ffff888020fafc08 EFLAGS: 00010293
[   24.897383] RAX: 0000000000000000 RBX: ffff8880138c8808 RCX: ffffffff83afe4ca
[   24.898097] RDX: ffff88801c8b2540 RSI: ffffffff83afe642 RDI: ffff8880138c88a0
[   24.898821] RBP: ffff888020fafcb8 R08: 0000000000000000 R09: 0000000000000000
[   24.899536] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   24.900251] R13: 0000000000000000 R14: ffff888020fafc50 R15: 0000000000000000
[   24.901179] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   24.902005] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.902592] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   24.903317] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.904031] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.904759] PKRU: 55555554
[   24.905055] Call Trace:
[   24.905383]  <TASK>
[   24.905681]  ? show_regs+0x6d/0x80
[   24.906177]  ? __warn+0xf3/0x380
[   24.906539]  ? report_bug+0x25e/0x4b0
[   24.906948]  ? iommufd_fops_release+0x392/0x420
[   24.907423]  ? report_bug+0x2cb/0x4b0
[   24.907815]  ? iommufd_fops_release+0x392/0x420
[   24.908288]  ? iommufd_fops_release+0x392/0x420
[   24.908762]  ? handle_bug+0x2cd/0x510
[   24.909175]  ? iommufd_fops_release+0x394/0x420
[   24.909745]  ? exc_invalid_op+0x3c/0x80
[   24.910277]  ? asm_exc_invalid_op+0x1f/0x30
[   24.910734]  ? iommufd_fops_release+0x21a/0x420
[   24.911228]  ? iommufd_fops_release+0x392/0x420
[   24.911709]  ? iommufd_fops_release+0x392/0x420
[   24.912188]  ? iommufd_fops_release+0x392/0x420
[   24.912666]  ? locks_remove_file+0x3b4/0x5d0
[   24.913137]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.913690]  ? __memcg_slab_free_hook+0xc1/0x540
[   24.914190]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   24.914759]  ? evm_file_release+0x141/0x220
[   24.915159]  ? __pfx_iommufd_fops_release+0x10/0x10
[   24.915736]  __fput+0x41c/0xb70
[   24.916267]  ____fput+0x22/0x30
[   24.916612]  task_work_run+0x19b/0x2b0
[   24.917015]  ? __pfx_task_work_run+0x10/0x10
[   24.917499]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   24.918057]  ? switch_task_namespaces+0xc6/0x110
[   24.918543]  do_exit+0xb0e/0x29d0
[   24.918909]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.919422]  ? __pfx_do_exit+0x10/0x10
[   24.919820]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.920396]  ? __x64_sys_ioctl+0x1ba/0x220
[   24.921010]  make_task_dead+0x181/0x3c0
[   24.921443]  rewind_stack_and_make_dead+0x16/0x20
[   24.921935] RIP: 0033:0x7f12e0a3ee5d
[   24.922313] Code: Unable to access opcode bytes at 0x7f12e0a3ee33.
[   24.922940] RSP: 002b:00007fff1eb73948 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.923699] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f12e0a3ee5d
[   24.924413] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.925124] RBP: 00007fff1eb73960 R08: 0000000000000800 R09: 0000000000000800
[   24.925925] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff1eb73a78
[   24.926830] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f12e0e41000
[   24.927553]  </TASK>
[   24.927796] irq event stamp: 0
[   24.928120] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   24.928768] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   24.929630] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   24.930475] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   24.931129] ---[ end trace 0000000000000000 ]---
[   24.939852] iommufd_mock iommufd_mock23: Adding to iommu group 23
[   24.942733] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#24] SMP KASAN NOPTI
[   24.943982] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   24.944788] CPU: 0 UID: 0 PID: 753 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.946005] Tainted: [D]=DIE, [W]=WARN
[   24.946392] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.947692] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.948290] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   24.950108] RSP: 0018:ffff888021d17b78 EFLAGS: 00010246
[   24.950643] RAX: dffffc0000000000 RBX: ffff888011121c00 RCX: 1ffffffff0dd8bdc
[   24.951365] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880217ead3c
[   24.952080] RBP: ffff888021d17bc8 R08: 0000000000000000 R09: 0000000000000000
[   24.952794] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   24.953509] R13: 0000000000000001 R14: ffff888021d17e18 R15: ffff88800dea0008
[   24.954222] FS:  00007fb4b5591600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   24.955030] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.955612] CR2: 00000000200006c0 CR3: 000000001390c004 CR4: 0000000000770ef0
[   24.956330] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.957044] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.957787] PKRU: 55555554
[   24.958082] Call Trace:
[   24.958355]  <TASK>
[   24.958598]  ? show_regs+0x6d/0x80
[   24.958984]  ? die_addr+0x45/0xb0
[   24.959357]  ? exc_general_protection+0x1ad/0x340
[   24.959878]  ? asm_exc_general_protection+0x2b/0x30
[   24.960407]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.960948]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   24.961497]  iommufd_device_detach+0x2a/0x2e0
[   24.961977]  iommufd_test+0x2f99/0x5cd0
[   24.962399]  ? do_raw_spin_unlock+0x15c/0x210
[   24.962890]  ? __pfx_iommufd_test+0x10/0x10
[   24.963344]  ? debug_smp_processor_id+0x20/0x30
[   24.963835]  ? rcu_is_watching+0x19/0xc0
[   24.964268]  ? lock_release+0x1ea/0x2c0
[   24.964687]  ? __might_fault+0xf1/0x1b0
[   24.965110]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   24.965681]  iommufd_fops_ioctl+0x38e/0x520
[   24.966140]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.966656]  ? trace_irq_enable+0xd1/0x110
[   24.967114]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   24.967656]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   24.968165]  __x64_sys_ioctl+0x1ba/0x220
[   24.968603]  x64_sys_call+0x122e/0x2150
[   24.969075]  do_syscall_64+0x6d/0x150
[   24.969510]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   24.970054] RIP: 0033:0x7fb4b523ee5d
[   24.970446] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   24.972322] RSP: 002b:00007ffc1b23a758 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   24.973110] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fb4b523ee5d
[   24.973851] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   24.974587] RBP: 00007ffc1b23a770 R08: 0000000000000800 R09: 0000000000000800
[   24.975334] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc1b23a888
[   24.976070] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fb4b55da000
[   24.976821]  </TASK>
[   24.977073] Modules linked in:
[   24.977610] ---[ end trace 0000000000000000 ]---
[   24.978128] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   24.978744] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   24.980406] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   24.980921] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   24.981680] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   24.982568] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   24.983342] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   24.984116] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   24.984833] FS:  00007fb4b5591600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   24.985774] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   24.986414] CR2: 00000000200006c0 CR3: 000000001390c004 CR4: 0000000000770ef0
[   24.987142] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   24.987861] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   24.988576] PKRU: 55555554
[   24.994114] ------------[ cut here ]------------
[   24.994724] WARNING: CPU: 0 PID: 753 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   24.995983] Modules linked in:
[   24.996362] CPU: 0 UID: 0 PID: 753 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   24.997701] Tainted: [D]=DIE, [W]=WARN
[   24.998123] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   24.999296] RIP: 0010:iommufd_fops_release+0x386/0x420
[   24.999856] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   25.001788] RSP: 0018:ffff888021d17c08 EFLAGS: 00010293
[   25.002377] RAX: 0000000000000000 RBX: ffff8880138c8008 RCX: ffffffff83afe4ca
[   25.003178] RDX: ffff8880217ea540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   25.003983] RBP: ffff888021d17cb8 R08: 0000000000000000 R09: 0000000000000000
[   25.004797] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   25.005607] R13: 0000000000000000 R14: ffff888021d17c50 R15: 0000000000000000
[   25.006438] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.007350] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.007963] CR2: 00000000200006c0 CR3: 000000001206e006 CR4: 0000000000770ef0
[   25.008792] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.009599] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.010406] PKRU: 55555554
[   25.010730] Call Trace:
[   25.010988]  <TASK>
[   25.011230]  ? show_regs+0x6d/0x80
[   25.011615]  ? __warn+0xf3/0x380
[   25.011981]  ? report_bug+0x25e/0x4b0
[   25.012389]  ? iommufd_fops_release+0x386/0x420
[   25.012883]  ? report_bug+0x2cb/0x4b0
[   25.013296]  ? iommufd_fops_release+0x386/0x420
[   25.013809]  ? iommufd_fops_release+0x386/0x420
[   25.014341]  ? handle_bug+0x2cd/0x510
[   25.014781]  ? iommufd_fops_release+0x388/0x420
[   25.015278]  ? exc_invalid_op+0x3c/0x80
[   25.015700]  ? asm_exc_invalid_op+0x1f/0x30
[   25.016154]  ? iommufd_fops_release+0x21a/0x420
[   25.016641]  ? iommufd_fops_release+0x386/0x420
[   25.017132]  ? iommufd_fops_release+0x386/0x420
[   25.017644]  ? iommufd_fops_release+0x386/0x420
[   25.018170]  ? locks_remove_file+0x3b4/0x5d0
[   25.018646]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.019174]  ? __memcg_slab_free_hook+0xc1/0x540
[   25.019676]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   25.020253]  ? evm_file_release+0x141/0x220
[   25.020712]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.021236]  __fput+0x41c/0xb70
[   25.021619]  ____fput+0x22/0x30
[   25.021989]  task_work_run+0x19b/0x2b0
[   25.022408]  ? __pfx_task_work_run+0x10/0x10
[   25.022883]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   25.023455]  ? switch_task_namespaces+0xc6/0x110
[   25.023960]  do_exit+0xb0e/0x29d0
[   25.024340]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.024882]  ? __pfx_do_exit+0x10/0x10
[   25.025307]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.025854]  ? __x64_sys_ioctl+0x1ba/0x220
[   25.026301]  make_task_dead+0x181/0x3c0
[   25.026730]  rewind_stack_and_make_dead+0x16/0x20
[   25.027236] RIP: 0033:0x7fb4b523ee5d
[   25.027630] Code: Unable to access opcode bytes at 0x7fb4b523ee33.
[   25.028269] RSP: 002b:00007ffc1b23a758 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.029065] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fb4b523ee5d
[   25.029826] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.030588] RBP: 00007ffc1b23a770 R08: 0000000000000800 R09: 0000000000000800
[   25.031337] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc1b23a888
[   25.032082] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fb4b55da000
[   25.032835]  </TASK>
[   25.033087] irq event stamp: 0
[   25.033448] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   25.034116] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   25.034981] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   25.035842] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   25.036503] ---[ end trace 0000000000000000 ]---
[   25.037066] ------------[ cut here ]------------
[   25.037573] WARNING: CPU: 0 PID: 753 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   25.038546] Modules linked in:
[   25.038900] CPU: 0 UID: 0 PID: 753 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.040152] Tainted: [D]=DIE, [W]=WARN
[   25.040567] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.041750] RIP: 0010:iommufd_fops_release+0x392/0x420
[   25.042321] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   25.044235] RSP: 0018:ffff888021d17c08 EFLAGS: 00010293
[   25.044795] RAX: 0000000000000000 RBX: ffff8880138c8008 RCX: ffffffff83afe4ca
[   25.045567] RDX: ffff8880217ea540 RSI: ffffffff83afe642 RDI: ffff8880138c80a0
[   25.046329] RBP: ffff888021d17cb8 R08: 0000000000000000 R09: 0000000000000000
[   25.047094] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   25.047846] R13: 0000000000000000 R14: ffff888021d17c50 R15: 0000000000000000
[   25.048604] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.049489] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.050113] CR2: 00000000200006c0 CR3: 000000001206e006 CR4: 0000000000770ef0
[   25.050867] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.051621] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.052371] PKRU: 55555554
[   25.052676] Call Trace:
[   25.052956]  <TASK>
[   25.053197]  ? show_regs+0x6d/0x80
[   25.053591]  ? __warn+0xf3/0x380
[   25.053960]  ? report_bug+0x25e/0x4b0
[   25.054366]  ? iommufd_fops_release+0x392/0x420
[   25.054870]  ? report_bug+0x2cb/0x4b0
[   25.055281]  ? iommufd_fops_release+0x392/0x420
[   25.055778]  ? iommufd_fops_release+0x392/0x420
[   25.056272]  ? handle_bug+0x2cd/0x510
[   25.056687]  ? iommufd_fops_release+0x394/0x420
[   25.057183]  ? exc_invalid_op+0x3c/0x80
[   25.057631]  ? asm_exc_invalid_op+0x1f/0x30
[   25.058104]  ? iommufd_fops_release+0x21a/0x420
[   25.058599]  ? iommufd_fops_release+0x392/0x420
[   25.059088]  ? iommufd_fops_release+0x392/0x420
[   25.059574]  ? iommufd_fops_release+0x392/0x420
[   25.060072]  ? locks_remove_file+0x3b4/0x5d0
[   25.060548]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.061097]  ? __memcg_slab_free_hook+0xc1/0x540
[   25.061633]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   25.062229]  ? evm_file_release+0x141/0x220
[   25.062686]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.063225]  __fput+0x41c/0xb70
[   25.063589]  ____fput+0x22/0x30
[   25.063947]  task_work_run+0x19b/0x2b0
[   25.064370]  ? __pfx_task_work_run+0x10/0x10
[   25.064851]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   25.065460]  ? switch_task_namespaces+0xc6/0x110
[   25.066004]  do_exit+0xb0e/0x29d0
[   25.066377]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.066920]  ? __pfx_do_exit+0x10/0x10
[   25.067348]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.067867]  ? __x64_sys_ioctl+0x1ba/0x220
[   25.068328]  make_task_dead+0x181/0x3c0
[   25.068757]  rewind_stack_and_make_dead+0x16/0x20
[   25.069273] RIP: 0033:0x7fb4b523ee5d
[   25.069686] Code: Unable to access opcode bytes at 0x7fb4b523ee33.
[   25.070366] RSP: 002b:00007ffc1b23a758 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.071170] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fb4b523ee5d
[   25.071920] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.072664] RBP: 00007ffc1b23a770 R08: 0000000000000800 R09: 0000000000000800
[   25.073438] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc1b23a888
[   25.074189] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fb4b55da000
[   25.074952]  </TASK>
[   25.075204] irq event stamp: 0
[   25.075550] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   25.076220] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   25.077081] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   25.077959] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   25.078627] ---[ end trace 0000000000000000 ]---
[   25.094995] iommufd_mock iommufd_mock24: Adding to iommu group 24
[   25.097542] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#25] SMP KASAN NOPTI
[   25.099552] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   25.100709] CPU: 1 UID: 0 PID: 754 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.102385] Tainted: [D]=DIE, [W]=WARN
[   25.103017] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.104566] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.105509] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   25.108116] RSP: 0018:ffff888026c17b78 EFLAGS: 00010246
[   25.108906] RAX: dffffc0000000000 RBX: ffff888010d33200 RCX: 1ffffffff0dd8bdd
[   25.109912] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801dda2d3c
[   25.110875] RBP: ffff888026c17bc8 R08: 0000000000000000 R09: 0000000000000000
[   25.111861] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   25.112862] R13: 0000000000000001 R14: ffff888026c17e18 R15: ffff88801519a008
[   25.113861] FS:  00007f0b5f198600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   25.115865] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.117808] CR2: 00000000200006c0 CR3: 0000000013bfc002 CR4: 0000000000770ef0
[   25.121033] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.123831] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.126153] PKRU: 55555554
[   25.127180] Call Trace:
[   25.128098]  <TASK>
[   25.128910]  ? show_regs+0x6d/0x80
[   25.130071]  ? die_addr+0x45/0xb0
[   25.130950]  ? exc_general_protection+0x1ad/0x340
[   25.131510]  ? asm_exc_general_protection+0x2b/0x30
[   25.132090]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.132697]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   25.133272]  iommufd_device_detach+0x2a/0x2e0
[   25.133785]  iommufd_test+0x2f99/0x5cd0
[   25.134234]  ? do_raw_spin_unlock+0x15c/0x210
[   25.134739]  ? __pfx_iommufd_test+0x10/0x10
[   25.135192]  ? debug_smp_processor_id+0x20/0x30
[   25.135684]  ? rcu_is_watching+0x19/0xc0
[   25.136118]  ? lock_release+0x1ea/0x2c0
[   25.136537]  ? __might_fault+0xf1/0x1b0
[   25.136963]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   25.137537]  iommufd_fops_ioctl+0x38e/0x520
[   25.137992]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.138504]  ? trace_irq_enable+0xd1/0x110
[   25.139011]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.139598]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.140104]  __x64_sys_ioctl+0x1ba/0x220
[   25.140549]  x64_sys_call+0x122e/0x2150
[   25.140976]  do_syscall_64+0x6d/0x150
[   25.141391]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   25.141942] RIP: 0033:0x7f0b5ee3ee5d
[   25.142347] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   25.144242] RSP: 002b:00007ffd75677738 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.145041] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f0b5ee3ee5d
[   25.145779] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.146511] RBP: 00007ffd75677750 R08: 0000000000000800 R09: 0000000000000800
[   25.147266] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd75677868
[   25.147999] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f0b5f1e1000
[   25.148771]  </TASK>
[   25.149024] Modules linked in:
[   25.149523] ---[ end trace 0000000000000000 ]---
[   25.150057] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.150702] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   25.152676] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   25.153235] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   25.154110] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   25.154881] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   25.155625] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   25.156359] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   25.157217] FS:  00007f0b5f198600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   25.158120] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.158762] CR2: 00000000200006c0 CR3: 0000000013bfc002 CR4: 0000000000770ef0
[   25.159510] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.160245] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.160982] PKRU: 55555554
[   25.162109] ------------[ cut here ]------------
[   25.162794] WARNING: CPU: 0 PID: 754 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   25.163789] Modules linked in:
[   25.164143] CPU: 0 UID: 0 PID: 754 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.165487] Tainted: [D]=DIE, [W]=WARN
[   25.165909] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.167075] RIP: 0010:iommufd_fops_release+0x386/0x420
[   25.167631] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   25.169702] RSP: 0018:ffff888026c17c08 EFLAGS: 00010293
[   25.170311] RAX: 0000000000000000 RBX: ffff88802143a008 RCX: ffffffff83afe4ca
[   25.171099] RDX: ffff88801dda2540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   25.171891] RBP: ffff888026c17cb8 R08: 0000000000000000 R09: 0000000000000000
[   25.172642] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   25.173470] R13: 0000000000000000 R14: ffff888026c17c50 R15: 0000000000000000
[   25.174217] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.175090] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.175705] CR2: 00007f25f7cf1010 CR3: 0000000007086006 CR4: 0000000000770ef0
[   25.176456] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.177264] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.178094] PKRU: 55555554
[   25.178404] Call Trace:
[   25.178675]  <TASK>
[   25.178921]  ? show_regs+0x6d/0x80
[   25.179301]  ? __warn+0xf3/0x380
[   25.179661]  ? report_bug+0x25e/0x4b0
[   25.180063]  ? iommufd_fops_release+0x386/0x420
[   25.180550]  ? report_bug+0x2cb/0x4b0
[   25.180951]  ? iommufd_fops_release+0x386/0x420
[   25.181509]  ? iommufd_fops_release+0x386/0x420
[   25.182020]  ? handle_bug+0x2cd/0x510
[   25.182421]  ? iommufd_fops_release+0x388/0x420
[   25.182918]  ? exc_invalid_op+0x3c/0x80
[   25.183340]  ? asm_exc_invalid_op+0x1f/0x30
[   25.183800]  ? iommufd_fops_release+0x21a/0x420
[   25.184289]  ? iommufd_fops_release+0x386/0x420
[   25.184787]  ? iommufd_fops_release+0x386/0x420
[   25.185289]  ? iommufd_fops_release+0x386/0x420
[   25.185862]  ? locks_remove_file+0x3b4/0x5d0
[   25.186390]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.186930]  ? __memcg_slab_free_hook+0xc1/0x540
[   25.187433]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   25.188012]  ? evm_file_release+0x141/0x220
[   25.188476]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.189006]  __fput+0x41c/0xb70
[   25.189446]  ____fput+0x22/0x30
[   25.189855]  task_work_run+0x19b/0x2b0
[   25.190282]  ? __pfx_task_work_run+0x10/0x10
[   25.190778]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   25.191385]  ? switch_task_namespaces+0xc6/0x110
[   25.191914]  do_exit+0xb0e/0x29d0
[   25.192308]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.192866]  ? __pfx_do_exit+0x10/0x10
[   25.193309]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.193940]  ? __x64_sys_ioctl+0x1ba/0x220
[   25.194431]  make_task_dead+0x181/0x3c0
[   25.194887]  rewind_stack_and_make_dead+0x16/0x20
[   25.195414] RIP: 0033:0x7f0b5ee3ee5d
[   25.195826] Code: Unable to access opcode bytes at 0x7f0b5ee3ee33.
[   25.196482] RSP: 002b:00007ffd75677738 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.197295] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f0b5ee3ee5d
[   25.198156] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.198909] RBP: 00007ffd75677750 R08: 0000000000000800 R09: 0000000000000800
[   25.199769] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd75677868
[   25.200582] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f0b5f1e1000
[   25.201477]  </TASK>
[   25.201764] irq event stamp: 0
[   25.202155] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   25.202832] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   25.203703] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   25.204566] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   25.205228] ---[ end trace 0000000000000000 ]---
[   25.205879] ------------[ cut here ]------------
[   25.206377] WARNING: CPU: 0 PID: 754 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   25.207382] Modules linked in:
[   25.207733] CPU: 0 UID: 0 PID: 754 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.208977] Tainted: [D]=DIE, [W]=WARN
[   25.209451] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.210828] RIP: 0010:iommufd_fops_release+0x392/0x420
[   25.211392] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   25.213280] RSP: 0018:ffff888026c17c08 EFLAGS: 00010293
[   25.213927] RAX: 0000000000000000 RBX: ffff88802143a008 RCX: ffffffff83afe4ca
[   25.214675] RDX: ffff88801dda2540 RSI: ffffffff83afe642 RDI: ffff88802143a0a0
[   25.215423] RBP: ffff888026c17cb8 R08: 0000000000000000 R09: 0000000000000000
[   25.216159] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   25.216908] R13: 0000000000000000 R14: ffff888026c17c50 R15: 0000000000000000
[   25.217733] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.218570] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.219169] CR2: 00007f25f7cf1010 CR3: 0000000007086006 CR4: 0000000000770ef0
[   25.219902] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.220631] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.221425] PKRU: 55555554
[   25.221731] Call Trace:
[   25.222005]  <TASK>
[   25.222249]  ? show_regs+0x6d/0x80
[   25.222631]  ? __warn+0xf3/0x380
[   25.223067]  ? report_bug+0x25e/0x4b0
[   25.223522]  ? iommufd_fops_release+0x392/0x420
[   25.224055]  ? report_bug+0x2cb/0x4b0
[   25.224492]  ? iommufd_fops_release+0x392/0x420
[   25.225000]  ? iommufd_fops_release+0x392/0x420
[   25.225588]  ? handle_bug+0x2cd/0x510
[   25.226011]  ? iommufd_fops_release+0x394/0x420
[   25.226499]  ? exc_invalid_op+0x3c/0x80
[   25.226924]  ? asm_exc_invalid_op+0x1f/0x30
[   25.227369]  ? iommufd_fops_release+0x21a/0x420
[   25.227850]  ? iommufd_fops_release+0x392/0x420
[   25.228330]  ? iommufd_fops_release+0x392/0x420
[   25.228810]  ? iommufd_fops_release+0x392/0x420
[   25.229287]  ? locks_remove_file+0x3b4/0x5d0
[   25.229806]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.230321]  ? __memcg_slab_free_hook+0xc1/0x540
[   25.230817]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   25.231390]  ? evm_file_release+0x141/0x220
[   25.231845]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.232370]  __fput+0x41c/0xb70
[   25.232727]  ____fput+0x22/0x30
[   25.233080]  task_work_run+0x19b/0x2b0
[   25.233564]  ? __pfx_task_work_run+0x10/0x10
[   25.234029]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   25.234598]  ? switch_task_namespaces+0xc6/0x110
[   25.235112]  do_exit+0xb0e/0x29d0
[   25.235482]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.236043]  ? __pfx_do_exit+0x10/0x10
[   25.237028]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.237905]  ? __x64_sys_ioctl+0x1ba/0x220
[   25.238335]  make_task_dead+0x181/0x3c0
[   25.238736]  rewind_stack_and_make_dead+0x16/0x20
[   25.239200] RIP: 0033:0x7f0b5ee3ee5d
[   25.239559] Code: Unable to access opcode bytes at 0x7f0b5ee3ee33.
[   25.240147] RSP: 002b:00007ffd75677738 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.240869] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f0b5ee3ee5d
[   25.241662] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.242350] RBP: 00007ffd75677750 R08: 0000000000000800 R09: 0000000000000800
[   25.243035] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd75677868
[   25.243711] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f0b5f1e1000
[   25.244398]  </TASK>
[   25.244630] irq event stamp: 0
[   25.244939] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   25.245596] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   25.246385] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   25.247177] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   25.247779] ---[ end trace 0000000000000000 ]---
[   25.255083] iommufd_mock iommufd_mock25: Adding to iommu group 25
[   25.257553] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#26] SMP KASAN NOPTI
[   25.258923] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   25.259652] CPU: 0 UID: 0 PID: 755 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.260776] Tainted: [D]=DIE, [W]=WARN
[   25.261145] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.262218] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.262789] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   25.264525] RSP: 0018:ffff888020cd7b78 EFLAGS: 00010246
[   25.265043] RAX: dffffc0000000000 RBX: ffff888011121600 RCX: 1ffffffff0dd8bdc
[   25.265729] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880217ed27c
[   25.266417] RBP: ffff888020cd7bc8 R08: 0000000000000000 R09: 0000000000000000
[   25.267109] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   25.267799] R13: 0000000000000001 R14: ffff888020cd7e18 R15: ffff8880110b8408
[   25.268490] FS:  00007f41dc735600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.269262] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.269826] CR2: 000055f8b3cb2298 CR3: 000000001ae9e005 CR4: 0000000000770ef0
[   25.270517] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.271206] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.271889] PKRU: 55555554
[   25.272164] Call Trace:
[   25.272418]  <TASK>
[   25.272642]  ? show_regs+0x6d/0x80
[   25.272993]  ? die_addr+0x45/0xb0
[   25.273339]  ? exc_general_protection+0x1ad/0x340
[   25.273821]  ? asm_exc_general_protection+0x2b/0x30
[   25.274311]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.274822]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   25.275331]  iommufd_device_detach+0x2a/0x2e0
[   25.275775]  iommufd_test+0x2f99/0x5cd0
[   25.276163]  ? do_raw_spin_unlock+0x15c/0x210
[   25.276610]  ? __pfx_iommufd_test+0x10/0x10
[   25.277027]  ? debug_smp_processor_id+0x20/0x30
[   25.277481]  ? rcu_is_watching+0x19/0xc0
[   25.277881]  ? lock_release+0x1ea/0x2c0
[   25.278270]  ? __might_fault+0xf1/0x1b0
[   25.278663]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   25.279199]  iommufd_fops_ioctl+0x38e/0x520
[   25.279620]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.280093]  ? trace_irq_enable+0xd1/0x110
[   25.280515]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.281009]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.281480]  __x64_sys_ioctl+0x1ba/0x220
[   25.281879]  x64_sys_call+0x122e/0x2150
[   25.282265]  do_syscall_64+0x6d/0x150
[   25.282639]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   25.283141] RIP: 0033:0x7f41dc43ee5d
[   25.283509] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   25.285256] RSP: 002b:00007ffc409697e8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.285989] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f41dc43ee5d
[   25.286677] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.287371] RBP: 00007ffc40969800 R08: 0000000000000800 R09: 0000000000000800
[   25.288062] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc40969918
[   25.288751] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f41dc77e000
[   25.289449]  </TASK>
[   25.289681] Modules linked in:
[   25.290105] ---[ end trace 0000000000000000 ]---
[   25.290568] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.291138] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   25.292881] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   25.293464] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   25.294159] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   25.294852] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   25.295539] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   25.296230] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   25.296919] FS:  00007f41dc735600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.297718] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.298282] CR2: 000055f8b3cb2298 CR3: 000000001ae9e005 CR4: 0000000000770ef0
[   25.298975] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.299671] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.300367] PKRU: 55555554
[   25.301805] ------------[ cut here ]------------
[   25.302282] WARNING: CPU: 0 PID: 755 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   25.303209] Modules linked in:
[   25.303532] CPU: 0 UID: 0 PID: 755 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.304897] Tainted: [D]=DIE, [W]=WARN
[   25.305270] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.306908] RIP: 0010:iommufd_fops_release+0x386/0x420
[   25.307420] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   25.309141] RSP: 0018:ffff888020cd7c08 EFLAGS: 00010293
[   25.309752] RAX: 0000000000000000 RBX: ffff8880138ca008 RCX: ffffffff83afe4ca
[   25.310437] RDX: ffff8880217eca80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   25.311123] RBP: ffff888020cd7cb8 R08: 0000000000000000 R09: 0000000000000000
[   25.311801] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   25.312481] R13: 0000000000000000 R14: ffff888020cd7c50 R15: 0000000000000000
[   25.313163] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.313998] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.314560] CR2: 000055f8b3cb2298 CR3: 0000000007086002 CR4: 0000000000770ef0
[   25.315251] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.315928] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.316609] PKRU: 55555554
[   25.316929] Call Trace:
[   25.317207]  <TASK>
[   25.317513]  ? show_regs+0x6d/0x80
[   25.317880]  ? __warn+0xf3/0x380
[   25.318223]  ? report_bug+0x25e/0x4b0
[   25.318656]  ? iommufd_fops_release+0x386/0x420
[   25.319178]  ? report_bug+0x2cb/0x4b0
[   25.319563]  ? iommufd_fops_release+0x386/0x420
[   25.320028]  ? iommufd_fops_release+0x386/0x420
[   25.320493]  ? handle_bug+0x2cd/0x510
[   25.320872]  ? iommufd_fops_release+0x388/0x420
[   25.321400]  ? exc_invalid_op+0x3c/0x80
[   25.321809]  ? asm_exc_invalid_op+0x1f/0x30
[   25.322239]  ? iommufd_fops_release+0x21a/0x420
[   25.322703]  ? iommufd_fops_release+0x386/0x420
[   25.323177]  ? iommufd_fops_release+0x386/0x420
[   25.323639]  ? iommufd_fops_release+0x386/0x420
[   25.324100]  ? locks_remove_file+0x3b4/0x5d0
[   25.324547]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.325044]  ? __memcg_slab_free_hook+0xc1/0x540
[   25.325536]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   25.326090]  ? evm_file_release+0x141/0x220
[   25.326521]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.327020]  __fput+0x41c/0xb70
[   25.327359]  ____fput+0x22/0x30
[   25.327691]  task_work_run+0x19b/0x2b0
[   25.328085]  ? __pfx_task_work_run+0x10/0x10
[   25.328526]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   25.329066]  ? switch_task_namespaces+0xc6/0x110
[   25.329562]  do_exit+0xb0e/0x29d0
[   25.329920]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.330426]  ? __pfx_do_exit+0x10/0x10
[   25.330823]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.331307]  ? __x64_sys_ioctl+0x1ba/0x220
[   25.331731]  make_task_dead+0x181/0x3c0
[   25.332130]  rewind_stack_and_make_dead+0x16/0x20
[   25.332608] RIP: 0033:0x7f41dc43ee5d
[   25.332979] Code: Unable to access opcode bytes at 0x7f41dc43ee33.
[   25.333603] RSP: 002b:00007ffc409697e8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.334351] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f41dc43ee5d
[   25.335053] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.335746] RBP: 00007ffc40969800 R08: 0000000000000800 R09: 0000000000000800
[   25.336440] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc40969918
[   25.337164] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f41dc77e000
[   25.337885]  </TASK>
[   25.338121] irq event stamp: 0
[   25.338442] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   25.339065] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   25.339859] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   25.340646] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   25.341248] ---[ end trace 0000000000000000 ]---
[   25.341797] ------------[ cut here ]------------
[   25.342247] WARNING: CPU: 0 PID: 755 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   25.343162] Modules linked in:
[   25.343478] CPU: 0 UID: 0 PID: 755 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.344605] Tainted: [D]=DIE, [W]=WARN
[   25.344974] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.346057] RIP: 0010:iommufd_fops_release+0x392/0x420
[   25.346573] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   25.348302] RSP: 0018:ffff888020cd7c08 EFLAGS: 00010293
[   25.348813] RAX: 0000000000000000 RBX: ffff8880138ca008 RCX: ffffffff83afe4ca
[   25.349522] RDX: ffff8880217eca80 RSI: ffffffff83afe642 RDI: ffff8880138ca0a0
[   25.350219] RBP: ffff888020cd7cb8 R08: 0000000000000000 R09: 0000000000000000
[   25.350902] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   25.351583] R13: 0000000000000000 R14: ffff888020cd7c50 R15: 0000000000000000
[   25.352263] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.353070] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.353658] CR2: 000055f8b3cb2298 CR3: 0000000007086002 CR4: 0000000000770ef0
[   25.354359] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.355057] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.355750] PKRU: 55555554
[   25.356030] Call Trace:
[   25.356287]  <TASK>
[   25.356517]  ? show_regs+0x6d/0x80
[   25.356877]  ? __warn+0xf3/0x380
[   25.357220]  ? report_bug+0x25e/0x4b0
[   25.357627]  ? iommufd_fops_release+0x392/0x420
[   25.358113]  ? report_bug+0x2cb/0x4b0
[   25.358508]  ? iommufd_fops_release+0x392/0x420
[   25.358985]  ? iommufd_fops_release+0x392/0x420
[   25.359450]  ? handle_bug+0x2cd/0x510
[   25.359832]  ? iommufd_fops_release+0x394/0x420
[   25.360306]  ? exc_invalid_op+0x3c/0x80
[   25.360708]  ? asm_exc_invalid_op+0x1f/0x30
[   25.361139]  ? iommufd_fops_release+0x21a/0x420
[   25.361624]  ? iommufd_fops_release+0x392/0x420
[   25.362092]  ? iommufd_fops_release+0x392/0x420
[   25.362556]  ? iommufd_fops_release+0x392/0x420
[   25.363028]  ? locks_remove_file+0x3b4/0x5d0
[   25.363473]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.363970]  ? __memcg_slab_free_hook+0xc1/0x540
[   25.364443]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   25.364984]  ? evm_file_release+0x141/0x220
[   25.365433]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.365933]  __fput+0x41c/0xb70
[   25.366270]  ____fput+0x22/0x30
[   25.366608]  task_work_run+0x19b/0x2b0
[   25.367008]  ? __pfx_task_work_run+0x10/0x10
[   25.367449]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   25.367985]  ? switch_task_namespaces+0xc6/0x110
[   25.368461]  do_exit+0xb0e/0x29d0
[   25.368814]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.369319]  ? __pfx_do_exit+0x10/0x10
[   25.369731]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.370207]  ? __x64_sys_ioctl+0x1ba/0x220
[   25.370628]  make_task_dead+0x181/0x3c0
[   25.371031]  rewind_stack_and_make_dead+0x16/0x20
[   25.371510] RIP: 0033:0x7f41dc43ee5d
[   25.371878] Code: Unable to access opcode bytes at 0x7f41dc43ee33.
[   25.372482] RSP: 002b:00007ffc409697e8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.373226] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f41dc43ee5d
[   25.373938] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.374636] RBP: 00007ffc40969800 R08: 0000000000000800 R09: 0000000000000800
[   25.375338] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc40969918
[   25.376034] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f41dc77e000
[   25.376739]  </TASK>
[   25.376978] irq event stamp: 0
[   25.377292] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   25.377948] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   25.378773] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   25.379574] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   25.380193] ---[ end trace 0000000000000000 ]---
[   25.389581] iommufd_mock iommufd_mock26: Adding to iommu group 26
[   25.391389] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#27] SMP KASAN NOPTI
[   25.393105] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   25.394156] CPU: 1 UID: 0 PID: 756 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.395688] Tainted: [D]=DIE, [W]=WARN
[   25.396083] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.397252] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.397903] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   25.400175] RSP: 0018:ffff8880217b7b78 EFLAGS: 00010246
[   25.400803] RAX: dffffc0000000000 RBX: ffff88800de5dc00 RCX: 1ffffffff0dd8bdd
[   25.401635] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801dda527c
[   25.402435] RBP: ffff8880217b7bc8 R08: 0000000000000000 R09: 0000000000000000
[   25.403288] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   25.404141] R13: 0000000000000001 R14: ffff8880217b7e18 R15: ffff88801151f408
[   25.404963] FS:  00007f850216e600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   25.405876] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.406570] CR2: 00000000200006c0 CR3: 00000000173b0002 CR4: 0000000000770ef0
[   25.407423] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.408225] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.409104] PKRU: 55555554
[   25.409437] Call Trace:
[   25.409809]  <TASK>
[   25.410065]  ? show_regs+0x6d/0x80
[   25.410465]  ? die_addr+0x45/0xb0
[   25.410964]  ? exc_general_protection+0x1ad/0x340
[   25.411526]  ? asm_exc_general_protection+0x2b/0x30
[   25.412180]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.412753]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   25.413407]  iommufd_device_detach+0x2a/0x2e0
[   25.413917]  iommufd_test+0x2f99/0x5cd0
[   25.414409]  ? do_raw_spin_unlock+0x15c/0x210
[   25.414926]  ? __pfx_iommufd_test+0x10/0x10
[   25.415412]  ? debug_smp_processor_id+0x20/0x30
[   25.415979]  ? rcu_is_watching+0x19/0xc0
[   25.416430]  ? lock_release+0x1ea/0x2c0
[   25.416939]  ? __might_fault+0xf1/0x1b0
[   25.417384]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   25.418069]  iommufd_fops_ioctl+0x38e/0x520
[   25.418570]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.419231]  ? trace_irq_enable+0xd1/0x110
[   25.419716]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.420275]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.420791]  __x64_sys_ioctl+0x1ba/0x220
[   25.421227]  x64_sys_call+0x122e/0x2150
[   25.421648]  do_syscall_64+0x6d/0x150
[   25.422061]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   25.422601] RIP: 0033:0x7f8501e3ee5d
[   25.423001] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   25.424874] RSP: 002b:00007ffd6a3c6db8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.425661] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f8501e3ee5d
[   25.426402] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.427149] RBP: 00007ffd6a3c6dd0 R08: 0000000000000800 R09: 0000000000000800
[   25.427891] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd6a3c6ee8
[   25.428629] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f85021b7000
[   25.429379]  </TASK>
[   25.429628] Modules linked in:
[   25.430099] ---[ end trace 0000000000000000 ]---
[   25.430618] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.431254] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   25.433308] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   25.433959] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   25.434703] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   25.435457] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   25.436201] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   25.436943] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   25.437770] FS:  00007f850216e600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   25.438632] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.439247] CR2: 00000000200006c0 CR3: 00000000173b0002 CR4: 0000000000770ef0
[   25.439992] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.440732] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.441567] PKRU: 55555554
[   25.442631] ------------[ cut here ]------------
[   25.443238] WARNING: CPU: 0 PID: 756 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   25.444282] Modules linked in:
[   25.444647] CPU: 0 UID: 0 PID: 756 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.445994] Tainted: [D]=DIE, [W]=WARN
[   25.446404] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.447563] RIP: 0010:iommufd_fops_release+0x386/0x420
[   25.448110] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   25.450122] RSP: 0018:ffff8880217b7c08 EFLAGS: 00010293
[   25.450682] RAX: 0000000000000000 RBX: ffff88801ff74008 RCX: ffffffff83afe4ca
[   25.451417] RDX: ffff88801dda4a80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   25.452143] RBP: ffff8880217b7cb8 R08: 0000000000000000 R09: 0000000000000000
[   25.452869] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   25.453672] R13: 0000000000000000 R14: ffff8880217b7c50 R15: 0000000000000000
[   25.454413] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.455236] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.455829] CR2: 00007f25f7d41018 CR3: 0000000007086002 CR4: 0000000000770ef0
[   25.456558] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.457282] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.458075] PKRU: 55555554
[   25.458379] Call Trace:
[   25.458658]  <TASK>
[   25.458927]  ? show_regs+0x6d/0x80
[   25.459313]  ? __warn+0xf3/0x380
[   25.459680]  ? report_bug+0x25e/0x4b0
[   25.460089]  ? iommufd_fops_release+0x386/0x420
[   25.460587]  ? report_bug+0x2cb/0x4b0
[   25.460994]  ? iommufd_fops_release+0x386/0x420
[   25.461561]  ? iommufd_fops_release+0x386/0x420
[   25.462076]  ? handle_bug+0x2cd/0x510
[   25.462497]  ? iommufd_fops_release+0x388/0x420
[   25.462998]  ? exc_invalid_op+0x3c/0x80
[   25.463424]  ? asm_exc_invalid_op+0x1f/0x30
[   25.463881]  ? iommufd_fops_release+0x21a/0x420
[   25.464376]  ? iommufd_fops_release+0x386/0x420
[   25.464870]  ? iommufd_fops_release+0x386/0x420
[   25.465440]  ? iommufd_fops_release+0x386/0x420
[   25.465947]  ? locks_remove_file+0x3b4/0x5d0
[   25.466421]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.466950]  ? __memcg_slab_free_hook+0xc1/0x540
[   25.467458]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   25.468036]  ? evm_file_release+0x141/0x220
[   25.468501]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.469030]  __fput+0x41c/0xb70
[   25.469456]  ____fput+0x22/0x30
[   25.469823]  task_work_run+0x19b/0x2b0
[   25.470245]  ? __pfx_task_work_run+0x10/0x10
[   25.470719]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   25.471292]  ? switch_task_namespaces+0xc6/0x110
[   25.471799]  do_exit+0xb0e/0x29d0
[   25.472178]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.472717]  ? __pfx_do_exit+0x10/0x10
[   25.473134]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.473720]  ? __x64_sys_ioctl+0x1ba/0x220
[   25.474185]  make_task_dead+0x181/0x3c0
[   25.474610]  rewind_stack_and_make_dead+0x16/0x20
[   25.475120] RIP: 0033:0x7f8501e3ee5d
[   25.475518] Code: Unable to access opcode bytes at 0x7f8501e3ee33.
[   25.476167] RSP: 002b:00007ffd6a3c6db8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.476964] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f8501e3ee5d
[   25.477785] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.478537] RBP: 00007ffd6a3c6dd0 R08: 0000000000000800 R09: 0000000000000800
[   25.479289] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd6a3c6ee8
[   25.480037] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f85021b7000
[   25.480792]  </TASK>
[   25.481046] irq event stamp: 0
[   25.481449] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   25.482139] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   25.483004] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   25.483864] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   25.484525] ---[ end trace 0000000000000000 ]---
[   25.485102] ------------[ cut here ]------------
[   25.485664] WARNING: CPU: 0 PID: 756 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   25.486675] Modules linked in:
[   25.487033] CPU: 0 UID: 0 PID: 756 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.488263] Tainted: [D]=DIE, [W]=WARN
[   25.488670] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.489914] RIP: 0010:iommufd_fops_release+0x392/0x420
[   25.490503] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   25.492731] RSP: 0018:ffff8880217b7c08 EFLAGS: 00010293
[   25.493409] RAX: 0000000000000000 RBX: ffff88801ff74008 RCX: ffffffff83afe4ca
[   25.494344] RDX: ffff88801dda4a80 RSI: ffffffff83afe642 RDI: ffff88801ff740a0
[   25.495089] RBP: ffff8880217b7cb8 R08: 0000000000000000 R09: 0000000000000000
[   25.495820] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   25.496550] R13: 0000000000000000 R14: ffff8880217b7c50 R15: 0000000000000000
[   25.497279] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.498158] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.498780] CR2: 00007f25f7d41018 CR3: 0000000007086002 CR4: 0000000000770ef0
[   25.499512] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.500244] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.500975] PKRU: 55555554
[   25.501270] Call Trace:
[   25.501603]  <TASK>
[   25.501867]  ? show_regs+0x6d/0x80
[   25.502243]  ? __warn+0xf3/0x380
[   25.502601]  ? report_bug+0x25e/0x4b0
[   25.503004]  ? iommufd_fops_release+0x392/0x420
[   25.503487]  ? report_bug+0x2cb/0x4b0
[   25.503889]  ? iommufd_fops_release+0x392/0x420
[   25.504373]  ? iommufd_fops_release+0x392/0x420
[   25.504856]  ? handle_bug+0x2cd/0x510
[   25.505255]  ? iommufd_fops_release+0x394/0x420
[   25.505804]  ? exc_invalid_op+0x3c/0x80
[   25.506268]  ? asm_exc_invalid_op+0x1f/0x30
[   25.506733]  ? iommufd_fops_release+0x21a/0x420
[   25.507242]  ? iommufd_fops_release+0x392/0x420
[   25.507737]  ? iommufd_fops_release+0x392/0x420
[   25.508231]  ? iommufd_fops_release+0x392/0x420
[   25.508725]  ? locks_remove_file+0x3b4/0x5d0
[   25.509198]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.509786]  ? __memcg_slab_free_hook+0xc1/0x540
[   25.510314]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   25.510897]  ? evm_file_release+0x141/0x220
[   25.511356]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.511885]  __fput+0x41c/0xb70
[   25.512243]  ____fput+0x22/0x30
[   25.512598]  task_work_run+0x19b/0x2b0
[   25.513015]  ? __pfx_task_work_run+0x10/0x10
[   25.513544]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   25.514151]  ? switch_task_namespaces+0xc6/0x110
[   25.514657]  do_exit+0xb0e/0x29d0
[   25.515041]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.515579]  ? __pfx_do_exit+0x10/0x10
[   25.515997]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.516510]  ? __x64_sys_ioctl+0x1ba/0x220
[   25.516959]  make_task_dead+0x181/0x3c0
[   25.517447]  rewind_stack_and_make_dead+0x16/0x20
[   25.517976] RIP: 0033:0x7f8501e3ee5d
[   25.518370] Code: Unable to access opcode bytes at 0x7f8501e3ee33.
[   25.519023] RSP: 002b:00007ffd6a3c6db8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.519820] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f8501e3ee5d
[   25.520564] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.521301] RBP: 00007ffd6a3c6dd0 R08: 0000000000000800 R09: 0000000000000800
[   25.522172] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd6a3c6ee8
[   25.522961] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f85021b7000
[   25.523721]  </TASK>
[   25.523979] irq event stamp: 0
[   25.524318] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   25.524984] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   25.525882] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   25.526764] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   25.527423] ---[ end trace 0000000000000000 ]---
[   25.537084] iommufd_mock iommufd_mock27: Adding to iommu group 27
[   25.537989] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#28] SMP KASAN NOPTI
[   25.539233] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   25.540067] CPU: 0 UID: 0 PID: 757 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.541335] Tainted: [D]=DIE, [W]=WARN
[   25.541735] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.542902] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.543510] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   25.545364] RSP: 0018:ffff888026dcfb78 EFLAGS: 00010246
[   25.545909] RAX: dffffc0000000000 RBX: ffff888011121e00 RCX: 1ffffffff0dd8bdc
[   25.546641] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880137587fc
[   25.547375] RBP: ffff888026dcfbc8 R08: 0000000000000000 R09: 0000000000000000
[   25.548101] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   25.548830] R13: 0000000000000001 R14: ffff888026dcfe18 R15: ffff88800d7bc008
[   25.549562] FS:  00007f842e5ce600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.550384] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.550992] CR2: 00000000200006c0 CR3: 0000000012f7a004 CR4: 0000000000770ef0
[   25.551738] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.552485] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.553233] PKRU: 55555554
[   25.553538] Call Trace:
[   25.553814]  <TASK>
[   25.554060]  ? show_regs+0x6d/0x80
[   25.554446]  ? die_addr+0x45/0xb0
[   25.554826]  ? exc_general_protection+0x1ad/0x340
[   25.555352]  ? asm_exc_general_protection+0x2b/0x30
[   25.555889]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.556445]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   25.557001]  iommufd_device_detach+0x2a/0x2e0
[   25.557487]  iommufd_test+0x2f99/0x5cd0
[   25.557913]  ? do_raw_spin_unlock+0x15c/0x210
[   25.558400]  ? __pfx_iommufd_test+0x10/0x10
[   25.558863]  ? debug_smp_processor_id+0x20/0x30
[   25.559363]  ? rcu_is_watching+0x19/0xc0
[   25.559799]  ? lock_release+0x1ea/0x2c0
[   25.560226]  ? __might_fault+0xf1/0x1b0
[   25.560659]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   25.561243]  iommufd_fops_ioctl+0x38e/0x520
[   25.561707]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.562225]  ? trace_irq_enable+0xd1/0x110
[   25.562694]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.563241]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.563757]  __x64_sys_ioctl+0x1ba/0x220
[   25.564197]  x64_sys_call+0x122e/0x2150
[   25.564620]  do_syscall_64+0x6d/0x150
[   25.565034]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   25.565577] RIP: 0033:0x7f842e23ee5d
[   25.565974] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   25.567872] RSP: 002b:00007fff149b0438 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.568661] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f842e23ee5d
[   25.569412] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.570160] RBP: 00007fff149b0450 R08: 0000000000000800 R09: 0000000000000800
[   25.570911] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff149b0568
[   25.571654] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f842e617000
[   25.572402]  </TASK>
[   25.572655] Modules linked in:
[   25.573264] ---[ end trace 0000000000000000 ]---
[   25.573847] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.574478] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   25.576427] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   25.577015] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   25.577842] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   25.578586] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   25.579334] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   25.580075] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   25.580817] FS:  00007f842e5ce600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.581729] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.582350] CR2: 00000000200006c0 CR3: 0000000012f7a004 CR4: 0000000000770ef0
[   25.583100] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.583842] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.584587] PKRU: 55555554
[   25.586203] ------------[ cut here ]------------
[   25.586840] WARNING: CPU: 1 PID: 757 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   25.587866] Modules linked in:
[   25.588308] CPU: 1 UID: 0 PID: 757 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.589785] Tainted: [D]=DIE, [W]=WARN
[   25.590230] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.591555] RIP: 0010:iommufd_fops_release+0x386/0x420
[   25.592191] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   25.594348] RSP: 0018:ffff888026dcfc08 EFLAGS: 00010293
[   25.594993] RAX: 0000000000000000 RBX: ffff8880138c9808 RCX: ffffffff83afe4ca
[   25.595826] RDX: ffff888013758000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   25.596627] RBP: ffff888026dcfcb8 R08: 0000000000000000 R09: 0000000000000000
[   25.597572] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   25.598390] R13: 0000000000000000 R14: ffff888026dcfc50 R15: 0000000000000000
[   25.599253] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   25.600222] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.600948] CR2: 00007f25f7d4e000 CR3: 0000000007086006 CR4: 0000000000770ef0
[   25.601829] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.602697] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.603516] PKRU: 55555554
[   25.603855] Call Trace:
[   25.604131]  <TASK>
[   25.604375]  ? show_regs+0x6d/0x80
[   25.604859]  ? __warn+0xf3/0x380
[   25.605248]  ? report_bug+0x25e/0x4b0
[   25.605756]  ? iommufd_fops_release+0x386/0x420
[   25.606336]  ? report_bug+0x2cb/0x4b0
[   25.606764]  ? iommufd_fops_release+0x386/0x420
[   25.607273]  ? iommufd_fops_release+0x386/0x420
[   25.607849]  ? handle_bug+0x2cd/0x510
[   25.608275]  ? iommufd_fops_release+0x388/0x420
[   25.608913]  ? exc_invalid_op+0x3c/0x80
[   25.609447]  ? asm_exc_invalid_op+0x1f/0x30
[   25.610028]  ? iommufd_fops_release+0x21a/0x420
[   25.610568]  ? iommufd_fops_release+0x386/0x420
[   25.611097]  ? iommufd_fops_release+0x386/0x420
[   25.611687]  ? iommufd_fops_release+0x386/0x420
[   25.612214]  ? locks_remove_file+0x3b4/0x5d0
[   25.612780]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.613440]  ? __memcg_slab_free_hook+0xc1/0x540
[   25.614002]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   25.614636]  ? evm_file_release+0x141/0x220
[   25.615221]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.615779]  __fput+0x41c/0xb70
[   25.616221]  ____fput+0x22/0x30
[   25.616595]  task_work_run+0x19b/0x2b0
[   25.617032]  ? __pfx_task_work_run+0x10/0x10
[   25.617649]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   25.618243]  ? switch_task_namespaces+0xc6/0x110
[   25.618796]  do_exit+0xb0e/0x29d0
[   25.619241]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.619823]  ? __pfx_do_exit+0x10/0x10
[   25.620316]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.620862]  ? __x64_sys_ioctl+0x1ba/0x220
[   25.621474]  make_task_dead+0x181/0x3c0
[   25.621929]  rewind_stack_and_make_dead+0x16/0x20
[   25.622530] RIP: 0033:0x7f842e23ee5d
[   25.622937] Code: Unable to access opcode bytes at 0x7f842e23ee33.
[   25.623613] RSP: 002b:00007fff149b0438 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.624517] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f842e23ee5d
[   25.625386] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.626153] RBP: 00007fff149b0450 R08: 0000000000000800 R09: 0000000000000800
[   25.626931] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff149b0568
[   25.627673] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f842e617000
[   25.628427]  </TASK>
[   25.628681] irq event stamp: 0
[   25.629019] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   25.629752] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   25.630631] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   25.631492] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   25.632150] ---[ end trace 0000000000000000 ]---
[   25.632725] ------------[ cut here ]------------
[   25.633215] WARNING: CPU: 1 PID: 757 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   25.634354] Modules linked in:
[   25.634732] CPU: 1 UID: 0 PID: 757 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.635961] Tainted: [D]=DIE, [W]=WARN
[   25.636363] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.637559] RIP: 0010:iommufd_fops_release+0x392/0x420
[   25.638128] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   25.640019] RSP: 0018:ffff888026dcfc08 EFLAGS: 00010293
[   25.640576] RAX: 0000000000000000 RBX: ffff8880138c9808 RCX: ffffffff83afe4ca
[   25.641318] RDX: ffff888013758000 RSI: ffffffff83afe642 RDI: ffff8880138c98a0
[   25.642102] RBP: ffff888026dcfcb8 R08: 0000000000000000 R09: 0000000000000000
[   25.642851] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   25.643591] R13: 0000000000000000 R14: ffff888026dcfc50 R15: 0000000000000000
[   25.644330] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   25.645168] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.645797] CR2: 00007f25f7d4e000 CR3: 0000000007086006 CR4: 0000000000770ef0
[   25.646556] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.647301] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.648042] PKRU: 55555554
[   25.648344] Call Trace:
[   25.648619]  <TASK>
[   25.648863]  ? show_regs+0x6d/0x80
[   25.649249]  ? __warn+0xf3/0x380
[   25.649639]  ? report_bug+0x25e/0x4b0
[   25.650070]  ? iommufd_fops_release+0x392/0x420
[   25.650566]  ? report_bug+0x2cb/0x4b0
[   25.650975]  ? iommufd_fops_release+0x392/0x420
[   25.651470]  ? iommufd_fops_release+0x392/0x420
[   25.651964]  ? handle_bug+0x2cd/0x510
[   25.652369]  ? iommufd_fops_release+0x394/0x420
[   25.652872]  ? exc_invalid_op+0x3c/0x80
[   25.653299]  ? asm_exc_invalid_op+0x1f/0x30
[   25.653785]  ? iommufd_fops_release+0x21a/0x420
[   25.654319]  ? iommufd_fops_release+0x392/0x420
[   25.654819]  ? iommufd_fops_release+0x392/0x420
[   25.655313]  ? iommufd_fops_release+0x392/0x420
[   25.655809]  ? locks_remove_file+0x3b4/0x5d0
[   25.656342]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.656869]  ? __memcg_slab_free_hook+0xc1/0x540
[   25.657399]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   25.657993]  ? evm_file_release+0x141/0x220
[   25.658452]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.658982]  __fput+0x41c/0xb70
[   25.659343]  ____fput+0x22/0x30
[   25.659697]  task_work_run+0x19b/0x2b0
[   25.660115]  ? __pfx_task_work_run+0x10/0x10
[   25.660584]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   25.661162]  ? switch_task_namespaces+0xc6/0x110
[   25.661729]  do_exit+0xb0e/0x29d0
[   25.662182]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.662748]  ? __pfx_do_exit+0x10/0x10
[   25.663163]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.663675]  ? __x64_sys_ioctl+0x1ba/0x220
[   25.664126]  make_task_dead+0x181/0x3c0
[   25.664549]  rewind_stack_and_make_dead+0x16/0x20
[   25.665056] RIP: 0033:0x7f842e23ee5d
[   25.665474] Code: Unable to access opcode bytes at 0x7f842e23ee33.
[   25.666134] RSP: 002b:00007fff149b0438 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.666927] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f842e23ee5d
[   25.667671] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.668410] RBP: 00007fff149b0450 R08: 0000000000000800 R09: 0000000000000800
[   25.669152] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff149b0568
[   25.669923] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f842e617000
[   25.670690]  </TASK>
[   25.670948] irq event stamp: 0
[   25.671286] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   25.671941] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   25.672798] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   25.673674] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   25.674351] ---[ end trace 0000000000000000 ]---
[   25.680943] iommufd_mock iommufd_mock28: Adding to iommu group 28
[   25.682938] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#29] SMP KASAN NOPTI
[   25.684206] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   25.685004] CPU: 0 UID: 0 PID: 758 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.686295] Tainted: [D]=DIE, [W]=WARN
[   25.686686] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.687834] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.688434] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   25.690279] RSP: 0018:ffff88802141fb78 EFLAGS: 00010246
[   25.690840] RAX: dffffc0000000000 RBX: ffff888011120e00 RCX: 1ffffffff0dd8bdc
[   25.691583] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880217e87fc
[   25.692322] RBP: ffff88802141fbc8 R08: 0000000000000000 R09: 0000000000000000
[   25.693065] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   25.693814] R13: 0000000000000001 R14: ffff88802141fe18 R15: ffff888010526408
[   25.694555] FS:  00007f7267ee7600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.695393] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.695997] CR2: 000055dee2f4c790 CR3: 0000000012f7a005 CR4: 0000000000770ef0
[   25.696741] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.697481] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.698220] PKRU: 55555554
[   25.698518] Call Trace:
[   25.698798]  <TASK>
[   25.699041]  ? show_regs+0x6d/0x80
[   25.699424]  ? die_addr+0x45/0xb0
[   25.699799]  ? exc_general_protection+0x1ad/0x340
[   25.700339]  ? asm_exc_general_protection+0x2b/0x30
[   25.700908]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.701479]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   25.702031]  iommufd_device_detach+0x2a/0x2e0
[   25.702554]  iommufd_test+0x2f99/0x5cd0
[   25.702995]  ? do_raw_spin_unlock+0x15c/0x210
[   25.703531]  ? __pfx_iommufd_test+0x10/0x10
[   25.704031]  ? debug_smp_processor_id+0x20/0x30
[   25.704571]  ? rcu_is_watching+0x19/0xc0
[   25.705035]  ? lock_release+0x1ea/0x2c0
[   25.705479]  ? __might_fault+0xf1/0x1b0
[   25.705955]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   25.706579]  iommufd_fops_ioctl+0x38e/0x520
[   25.707063]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.707631]  ? trace_irq_enable+0xd1/0x110
[   25.708126]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.708710]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.709261]  __x64_sys_ioctl+0x1ba/0x220
[   25.709718]  x64_sys_call+0x122e/0x2150
[   25.710178]  do_syscall_64+0x6d/0x150
[   25.710603]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   25.711171] RIP: 0033:0x7f7267c3ee5d
[   25.711605] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   25.713614] RSP: 002b:00007ffedf242678 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.714479] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f7267c3ee5d
[   25.715281] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.716100] RBP: 00007ffedf242690 R08: 0000000000000800 R09: 0000000000000800
[   25.716915] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffedf2427a8
[   25.717729] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f7267f30000
[   25.718545]  </TASK>
[   25.718816] Modules linked in:
[   25.719513] ---[ end trace 0000000000000000 ]---
[   25.720045] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.720694] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   25.722730] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   25.723336] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   25.724152] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   25.724969] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   25.725786] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   25.726569] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   25.727348] FS:  00007f7267ee7600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.728204] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.728862] CR2: 000055dee2f4c790 CR3: 0000000012f7a005 CR4: 0000000000770ef0
[   25.729674] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.730446] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.731235] PKRU: 55555554
[   25.732352] ------------[ cut here ]------------
[   25.732890] WARNING: CPU: 0 PID: 758 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   25.734000] Modules linked in:
[   25.734359] CPU: 0 UID: 0 PID: 758 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.735697] Tainted: [D]=DIE, [W]=WARN
[   25.736146] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.737461] RIP: 0010:iommufd_fops_release+0x386/0x420
[   25.738061] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   25.740038] RSP: 0018:ffff88802141fc08 EFLAGS: 00010293
[   25.740604] RAX: 0000000000000000 RBX: ffff88801ff71808 RCX: ffffffff83afe4ca
[   25.741421] RDX: ffff8880217e8000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   25.742187] RBP: ffff88802141fcb8 R08: 0000000000000000 R09: 0000000000000000
[   25.742936] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   25.743681] R13: 0000000000000000 R14: ffff88802141fc50 R15: 0000000000000000
[   25.744426] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.745265] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.745891] CR2: 000055dee2f4c790 CR3: 0000000007086006 CR4: 0000000000770ef0
[   25.746650] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.747398] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.748155] PKRU: 55555554
[   25.748944] Call Trace:
[   25.749220]  <TASK>
[   25.749478]  ? show_regs+0x6d/0x80
[   25.749862]  ? __warn+0xf3/0x380
[   25.750345]  ? report_bug+0x25e/0x4b0
[   25.750741]  ? iommufd_fops_release+0x386/0x420
[   25.751203]  ? report_bug+0x2cb/0x4b0
[   25.751581]  ? iommufd_fops_release+0x386/0x420
[   25.752042]  ? iommufd_fops_release+0x386/0x420
[   25.752630]  ? handle_bug+0x2cd/0x510
[   25.753013]  ? iommufd_fops_release+0x388/0x420
[   25.753551]  ? exc_invalid_op+0x3c/0x80
[   25.754028]  ? asm_exc_invalid_op+0x1f/0x30
[   25.754459]  ? iommufd_fops_release+0x21a/0x420
[   25.754945]  ? iommufd_fops_release+0x386/0x420
[   25.755489]  ? iommufd_fops_release+0x386/0x420
[   25.755993]  ? iommufd_fops_release+0x386/0x420
[   25.756518]  ? locks_remove_file+0x3b4/0x5d0
[   25.756996]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.757577]  ? __memcg_slab_free_hook+0xc1/0x540
[   25.758045]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   25.758675]  ? evm_file_release+0x141/0x220
[   25.759119]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.759699]  __fput+0x41c/0xb70
[   25.760044]  ____fput+0x22/0x30
[   25.760450]  task_work_run+0x19b/0x2b0
[   25.760838]  ? __pfx_task_work_run+0x10/0x10
[   25.761397]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   25.761930]  ? switch_task_namespaces+0xc6/0x110
[   25.762426]  do_exit+0xb0e/0x29d0
[   25.762854]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.763379]  ? __pfx_do_exit+0x10/0x10
[   25.763834]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.764336]  ? __x64_sys_ioctl+0x1ba/0x220
[   25.764821]  make_task_dead+0x181/0x3c0
[   25.765242]  rewind_stack_and_make_dead+0x16/0x20
[   25.765802] RIP: 0033:0x7f7267c3ee5d
[   25.766169] Code: Unable to access opcode bytes at 0x7f7267c3ee33.
[   25.766873] RSP: 002b:00007ffedf242678 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.767627] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f7267c3ee5d
[   25.768404] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.769088] RBP: 00007ffedf242690 R08: 0000000000000800 R09: 0000000000000800
[   25.769799] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffedf2427a8
[   25.770500] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f7267f30000
[   25.771208]  </TASK>
[   25.771445] irq event stamp: 0
[   25.771761] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   25.772380] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   25.773184] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   25.774004] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   25.774621] ---[ end trace 0000000000000000 ]---
[   25.775171] ------------[ cut here ]------------
[   25.775630] WARNING: CPU: 0 PID: 758 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   25.776556] Modules linked in:
[   25.776883] CPU: 0 UID: 0 PID: 758 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.778067] Tainted: [D]=DIE, [W]=WARN
[   25.778447] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.779544] RIP: 0010:iommufd_fops_release+0x392/0x420
[   25.780061] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   25.781845] RSP: 0018:ffff88802141fc08 EFLAGS: 00010293
[   25.782369] RAX: 0000000000000000 RBX: ffff88801ff71808 RCX: ffffffff83afe4ca
[   25.783068] RDX: ffff8880217e8000 RSI: ffffffff83afe642 RDI: ffff88801ff718a0
[   25.783765] RBP: ffff88802141fcb8 R08: 0000000000000000 R09: 0000000000000000
[   25.784461] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   25.785156] R13: 0000000000000000 R14: ffff88802141fc50 R15: 0000000000000000
[   25.785869] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.786651] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.787223] CR2: 000055dee2f4c790 CR3: 0000000007086006 CR4: 0000000000770ef0
[   25.787920] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.788616] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.789310] PKRU: 55555554
[   25.789612] Call Trace:
[   25.789873]  <TASK>
[   25.790102]  ? show_regs+0x6d/0x80
[   25.790463]  ? __warn+0xf3/0x380
[   25.790811]  ? report_bug+0x25e/0x4b0
[   25.791191]  ? iommufd_fops_release+0x392/0x420
[   25.791657]  ? report_bug+0x2cb/0x4b0
[   25.792036]  ? iommufd_fops_release+0x392/0x420
[   25.792498]  ? iommufd_fops_release+0x392/0x420
[   25.792960]  ? handle_bug+0x2cd/0x510
[   25.793359]  ? iommufd_fops_release+0x394/0x420
[   25.793828]  ? exc_invalid_op+0x3c/0x80
[   25.794229]  ? asm_exc_invalid_op+0x1f/0x30
[   25.794658]  ? iommufd_fops_release+0x21a/0x420
[   25.795123]  ? iommufd_fops_release+0x392/0x420
[   25.795585]  ? iommufd_fops_release+0x392/0x420
[   25.796049]  ? iommufd_fops_release+0x392/0x420
[   25.796510]  ? locks_remove_file+0x3b4/0x5d0
[   25.796953]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.797460]  ? __memcg_slab_free_hook+0xc1/0x540
[   25.797936]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   25.798476]  ? evm_file_release+0x141/0x220
[   25.798912]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.799407]  __fput+0x41c/0xb70
[   25.799744]  ____fput+0x22/0x30
[   25.800075]  task_work_run+0x19b/0x2b0
[   25.800468]  ? __pfx_task_work_run+0x10/0x10
[   25.800908]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   25.801464]  ? switch_task_namespaces+0xc6/0x110
[   25.801940]  do_exit+0xb0e/0x29d0
[   25.802294]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.802799]  ? __pfx_do_exit+0x10/0x10
[   25.803180]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.803647]  ? __x64_sys_ioctl+0x1ba/0x220
[   25.804058]  make_task_dead+0x181/0x3c0
[   25.804447]  rewind_stack_and_make_dead+0x16/0x20
[   25.804913] RIP: 0033:0x7f7267c3ee5d
[   25.805278] Code: Unable to access opcode bytes at 0x7f7267c3ee33.
[   25.805885] RSP: 002b:00007ffedf242678 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.806611] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f7267c3ee5d
[   25.807295] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.807975] RBP: 00007ffedf242690 R08: 0000000000000800 R09: 0000000000000800
[   25.808653] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffedf2427a8
[   25.809350] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f7267f30000
[   25.810042]  </TASK>
[   25.810272] irq event stamp: 0
[   25.810582] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   25.811184] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   25.811970] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   25.812755] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   25.813375] ---[ end trace 0000000000000000 ]---
[   25.822034] iommufd_mock iommufd_mock29: Adding to iommu group 29
[   25.823388] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#30] SMP KASAN NOPTI
[   25.824717] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   25.825573] CPU: 1 UID: 0 PID: 759 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.826803] Tainted: [D]=DIE, [W]=WARN
[   25.827212] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.828309] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.828906] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   25.830638] RSP: 0018:ffff888026d9fb78 EFLAGS: 00010246
[   25.831156] RAX: dffffc0000000000 RBX: ffff88800de5da00 RCX: 1ffffffff0dd8bdd
[   25.831838] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801375d27c
[   25.832518] RBP: ffff888026d9fbc8 R08: 0000000000000000 R09: 0000000000000000
[   25.833197] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   25.833878] R13: 0000000000000001 R14: ffff888026d9fe18 R15: ffff8880115cc808
[   25.834560] FS:  00007f35ec0f7600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   25.835334] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.835906] CR2: 00000000200006c0 CR3: 0000000017096004 CR4: 0000000000770ef0
[   25.836603] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.837296] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.837984] PKRU: 55555554
[   25.838266] Call Trace:
[   25.838522]  <TASK>
[   25.838755]  ? show_regs+0x6d/0x80
[   25.839116]  ? die_addr+0x45/0xb0
[   25.839467]  ? exc_general_protection+0x1ad/0x340
[   25.839959]  ? asm_exc_general_protection+0x2b/0x30
[   25.840462]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.840977]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   25.841494]  iommufd_device_detach+0x2a/0x2e0
[   25.841948]  iommufd_test+0x2f99/0x5cd0
[   25.842346]  ? do_raw_spin_unlock+0x15c/0x210
[   25.842806]  ? __pfx_iommufd_test+0x10/0x10
[   25.843234]  ? debug_smp_processor_id+0x20/0x30
[   25.843707]  ? rcu_is_watching+0x19/0xc0
[   25.844117]  ? lock_release+0x1ea/0x2c0
[   25.844515]  ? __might_fault+0xf1/0x1b0
[   25.844918]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   25.845462]  iommufd_fops_ioctl+0x38e/0x520
[   25.845894]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.846379]  ? trace_irq_enable+0xd1/0x110
[   25.846817]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.847324]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.847804]  __x64_sys_ioctl+0x1ba/0x220
[   25.848213]  x64_sys_call+0x122e/0x2150
[   25.848608]  do_syscall_64+0x6d/0x150
[   25.848994]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   25.849502] RIP: 0033:0x7f35ebe3ee5d
[   25.849872] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   25.851643] RSP: 002b:00007ffffd06c7f8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.852386] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f35ebe3ee5d
[   25.853112] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.853885] RBP: 00007ffffd06c810 R08: 0000000000000800 R09: 0000000000000800
[   25.854621] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffffd06c928
[   25.855319] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f35ec140000
[   25.856022]  </TASK>
[   25.856257] Modules linked in:
[   25.856705] ---[ end trace 0000000000000000 ]---
[   25.857208] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.857883] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   25.859786] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   25.860328] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   25.861056] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   25.861887] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   25.862603] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   25.863319] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   25.864029] FS:  00007f35ec0f7600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   25.864845] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.865475] CR2: 00000000200006c0 CR3: 0000000017096004 CR4: 0000000000770ef0
[   25.866188] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.866914] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.867626] PKRU: 55555554
[   25.868841] ------------[ cut here ]------------
[   25.869613] WARNING: CPU: 0 PID: 759 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   25.870609] Modules linked in:
[   25.870970] CPU: 0 UID: 0 PID: 759 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.872245] Tainted: [D]=DIE, [W]=WARN
[   25.872623] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.873841] RIP: 0010:iommufd_fops_release+0x386/0x420
[   25.874394] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   25.876367] RSP: 0018:ffff888026d9fc08 EFLAGS: 00010293
[   25.876948] RAX: 0000000000000000 RBX: ffff88801ff72008 RCX: ffffffff83afe4ca
[   25.877769] RDX: ffff88801375ca80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   25.878537] RBP: ffff888026d9fcb8 R08: 0000000000000000 R09: 0000000000000000
[   25.879315] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   25.880099] R13: 0000000000000000 R14: ffff888026d9fc50 R15: 0000000000000000
[   25.880878] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.881787] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.882399] CR2: 00007f25f7d67028 CR3: 0000000007086006 CR4: 0000000000770ef0
[   25.883175] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.883911] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.884652] PKRU: 55555554
[   25.884965] Call Trace:
[   25.885256]  <TASK>
[   25.885550]  ? show_regs+0x6d/0x80
[   25.885941]  ? __warn+0xf3/0x380
[   25.886310]  ? report_bug+0x25e/0x4b0
[   25.886735]  ? iommufd_fops_release+0x386/0x420
[   25.887239]  ? report_bug+0x2cb/0x4b0
[   25.887652]  ? iommufd_fops_release+0x386/0x420
[   25.888150]  ? iommufd_fops_release+0x386/0x420
[   25.888655]  ? handle_bug+0x2cd/0x510
[   25.889076]  ? iommufd_fops_release+0x388/0x420
[   25.889675]  ? exc_invalid_op+0x3c/0x80
[   25.890108]  ? asm_exc_invalid_op+0x1f/0x30
[   25.890541]  ? iommufd_fops_release+0x21a/0x420
[   25.891035]  ? iommufd_fops_release+0x386/0x420
[   25.891553]  ? iommufd_fops_release+0x386/0x420
[   25.892068]  ? iommufd_fops_release+0x386/0x420
[   25.892557]  ? locks_remove_file+0x3b4/0x5d0
[   25.893049]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.893632]  ? __memcg_slab_free_hook+0xc1/0x540
[   25.894138]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   25.894724]  ? evm_file_release+0x141/0x220
[   25.895179]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.895706]  __fput+0x41c/0xb70
[   25.896074]  ____fput+0x22/0x30
[   25.896437]  task_work_run+0x19b/0x2b0
[   25.896868]  ? __pfx_task_work_run+0x10/0x10
[   25.897400]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   25.897986]  ? switch_task_namespaces+0xc6/0x110
[   25.898506]  do_exit+0xb0e/0x29d0
[   25.898883]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.899409]  ? __pfx_do_exit+0x10/0x10
[   25.899800]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.900317]  ? __x64_sys_ioctl+0x1ba/0x220
[   25.900767]  make_task_dead+0x181/0x3c0
[   25.901174]  rewind_stack_and_make_dead+0x16/0x20
[   25.901712] RIP: 0033:0x7f35ebe3ee5d
[   25.902086] Code: Unable to access opcode bytes at 0x7f35ebe3ee33.
[   25.902751] RSP: 002b:00007ffffd06c7f8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.903575] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f35ebe3ee5d
[   25.904344] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.905042] RBP: 00007ffffd06c810 R08: 0000000000000800 R09: 0000000000000800
[   25.905766] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffffd06c928
[   25.906469] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f35ec140000
[   25.907181]  </TASK>
[   25.907419] irq event stamp: 0
[   25.907737] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   25.908357] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   25.909164] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   25.909989] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   25.910609] ---[ end trace 0000000000000000 ]---
[   25.911155] ------------[ cut here ]------------
[   25.911618] WARNING: CPU: 0 PID: 759 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   25.912543] Modules linked in:
[   25.912869] CPU: 0 UID: 0 PID: 759 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.914042] Tainted: [D]=DIE, [W]=WARN
[   25.914423] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.915527] RIP: 0010:iommufd_fops_release+0x392/0x420
[   25.916054] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   25.917848] RSP: 0018:ffff888026d9fc08 EFLAGS: 00010293
[   25.918376] RAX: 0000000000000000 RBX: ffff88801ff72008 RCX: ffffffff83afe4ca
[   25.919082] RDX: ffff88801375ca80 RSI: ffffffff83afe642 RDI: ffff88801ff720a0
[   25.919783] RBP: ffff888026d9fcb8 R08: 0000000000000000 R09: 0000000000000000
[   25.920480] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   25.921180] R13: 0000000000000000 R14: ffff888026d9fc50 R15: 0000000000000000
[   25.921896] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.922685] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.923265] CR2: 00007f25f7d67028 CR3: 0000000007086006 CR4: 0000000000770ef0
[   25.923965] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.924663] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.925377] PKRU: 55555554
[   25.925663] Call Trace:
[   25.925923]  <TASK>
[   25.926152]  ? show_regs+0x6d/0x80
[   25.926511]  ? __warn+0xf3/0x380
[   25.926860]  ? report_bug+0x25e/0x4b0
[   25.927243]  ? iommufd_fops_release+0x392/0x420
[   25.927708]  ? report_bug+0x2cb/0x4b0
[   25.928089]  ? iommufd_fops_release+0x392/0x420
[   25.928553]  ? iommufd_fops_release+0x392/0x420
[   25.929018]  ? handle_bug+0x2cd/0x510
[   25.929421]  ? iommufd_fops_release+0x394/0x420
[   25.929896]  ? exc_invalid_op+0x3c/0x80
[   25.930298]  ? asm_exc_invalid_op+0x1f/0x30
[   25.930737]  ? iommufd_fops_release+0x21a/0x420
[   25.931203]  ? iommufd_fops_release+0x392/0x420
[   25.931669]  ? iommufd_fops_release+0x392/0x420
[   25.932132]  ? iommufd_fops_release+0x392/0x420
[   25.932596]  ? locks_remove_file+0x3b4/0x5d0
[   25.933041]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.933558]  ? __memcg_slab_free_hook+0xc1/0x540
[   25.934033]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   25.934576]  ? evm_file_release+0x141/0x220
[   25.935014]  ? __pfx_iommufd_fops_release+0x10/0x10
[   25.935509]  __fput+0x41c/0xb70
[   25.935852]  ____fput+0x22/0x30
[   25.936186]  task_work_run+0x19b/0x2b0
[   25.936579]  ? __pfx_task_work_run+0x10/0x10
[   25.937023]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   25.937583]  ? switch_task_namespaces+0xc6/0x110
[   25.938062]  do_exit+0xb0e/0x29d0
[   25.938416]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.938927]  ? __pfx_do_exit+0x10/0x10
[   25.939318]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.939800]  ? __x64_sys_ioctl+0x1ba/0x220
[   25.940227]  make_task_dead+0x181/0x3c0
[   25.940629]  rewind_stack_and_make_dead+0x16/0x20
[   25.941109] RIP: 0033:0x7f35ebe3ee5d
[   25.941498] Code: Unable to access opcode bytes at 0x7f35ebe3ee33.
[   25.942105] RSP: 002b:00007ffffd06c7f8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.942855] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f35ebe3ee5d
[   25.943556] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.944256] RBP: 00007ffffd06c810 R08: 0000000000000800 R09: 0000000000000800
[   25.944953] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffffd06c928
[   25.945668] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f35ec140000
[   25.946378]  </TASK>
[   25.946615] irq event stamp: 0
[   25.946936] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   25.947555] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   25.948363] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   25.949173] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   25.949814] ---[ end trace 0000000000000000 ]---
[   25.955540] iommufd_mock iommufd_mock30: Adding to iommu group 30
[   25.956422] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#31] SMP KASAN NOPTI
[   25.957551] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   25.958278] CPU: 0 UID: 0 PID: 760 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   25.959414] Tainted: [D]=DIE, [W]=WARN
[   25.959785] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   25.960860] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.961427] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   25.963164] RSP: 0018:ffff888010757b78 EFLAGS: 00010246
[   25.963676] RAX: dffffc0000000000 RBX: ffff888011120c00 RCX: 1ffffffff0dd8bdc
[   25.964354] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801375ad3c
[   25.965049] RBP: ffff888010757bc8 R08: 0000000000000000 R09: 0000000000000000
[   25.965742] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   25.966436] R13: 0000000000000001 R14: ffff888010757e18 R15: ffff888010524008
[   25.967131] FS:  00007fbbae4a5600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.967913] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.968482] CR2: 00000000200006c0 CR3: 0000000017096001 CR4: 0000000000770ef0
[   25.969179] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.969862] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.970558] PKRU: 55555554
[   25.970845] Call Trace:
[   25.971103]  <TASK>
[   25.971332]  ? show_regs+0x6d/0x80
[   25.971694]  ? die_addr+0x45/0xb0
[   25.972049]  ? exc_general_protection+0x1ad/0x340
[   25.972545]  ? asm_exc_general_protection+0x2b/0x30
[   25.973050]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.973570]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   25.974093]  iommufd_device_detach+0x2a/0x2e0
[   25.974549]  iommufd_test+0x2f99/0x5cd0
[   25.974951]  ? do_raw_spin_unlock+0x15c/0x210
[   25.975410]  ? __pfx_iommufd_test+0x10/0x10
[   25.975840]  ? debug_smp_processor_id+0x20/0x30
[   25.976309]  ? rcu_is_watching+0x19/0xc0
[   25.976721]  ? lock_release+0x1ea/0x2c0
[   25.977121]  ? __might_fault+0xf1/0x1b0
[   25.977527]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   25.978073]  iommufd_fops_ioctl+0x38e/0x520
[   25.978508]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.978998]  ? trace_irq_enable+0xd1/0x110
[   25.979429]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   25.979935]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   25.980417]  __x64_sys_ioctl+0x1ba/0x220
[   25.980827]  x64_sys_call+0x122e/0x2150
[   25.981222]  do_syscall_64+0x6d/0x150
[   25.981610]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   25.982123] RIP: 0033:0x7fbbae23ee5d
[   25.982495] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   25.984261] RSP: 002b:00007ffeaeea31e8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   25.985004] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fbbae23ee5d
[   25.985703] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   25.986403] RBP: 00007ffeaeea3200 R08: 0000000000000800 R09: 0000000000000800
[   25.987104] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffeaeea3318
[   25.987806] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fbbae4ee000
[   25.988513]  </TASK>
[   25.988749] Modules linked in:
[   25.989300] ---[ end trace 0000000000000000 ]---
[   25.989787] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   25.990362] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   25.992114] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   25.992626] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   25.993311] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   25.994011] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   25.994695] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   25.995384] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   25.996064] FS:  00007fbbae4a5600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   25.996831] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   25.997403] CR2: 00000000200006c0 CR3: 0000000017096001 CR4: 0000000000770ef0
[   25.998090] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   25.998779] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   25.999461] PKRU: 55555554
[   26.000361] ------------[ cut here ]------------
[   26.000823] WARNING: CPU: 0 PID: 760 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   26.001759] Modules linked in:
[   26.002078] CPU: 0 UID: 0 PID: 760 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.003681] Tainted: [D]=DIE, [W]=WARN
[   26.004064] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.005362] RIP: 0010:iommufd_fops_release+0x386/0x420
[   26.005902] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   26.007715] RSP: 0018:ffff888010757c08 EFLAGS: 00010293
[   26.008242] RAX: 0000000000000000 RBX: ffff8880138cd008 RCX: ffffffff83afe4ca
[   26.008946] RDX: ffff88801375a540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   26.009656] RBP: ffff888010757cb8 R08: 0000000000000000 R09: 0000000000000000
[   26.010348] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   26.011056] R13: 0000000000000000 R14: ffff888010757c50 R15: 0000000000000000
[   26.011747] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   26.012530] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.013098] CR2: 00000000200006c0 CR3: 0000000007086003 CR4: 0000000000770ef0
[   26.013817] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.014518] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.015215] PKRU: 55555554
[   26.015495] Call Trace:
[   26.015752]  <TASK>
[   26.015979]  ? show_regs+0x6d/0x80
[   26.016339]  ? __warn+0xf3/0x380
[   26.016683]  ? report_bug+0x25e/0x4b0
[   26.017067]  ? iommufd_fops_release+0x386/0x420
[   26.017588]  ? report_bug+0x2cb/0x4b0
[   26.018060]  ? iommufd_fops_release+0x386/0x420
[   26.018551]  ? iommufd_fops_release+0x386/0x420
[   26.019031]  ? handle_bug+0x2cd/0x510
[   26.019415]  ? iommufd_fops_release+0x388/0x420
[   26.019884]  ? exc_invalid_op+0x3c/0x80
[   26.020284]  ? asm_exc_invalid_op+0x1f/0x30
[   26.020716]  ? iommufd_fops_release+0x21a/0x420
[   26.021180]  ? iommufd_fops_release+0x386/0x420
[   26.021671]  ? iommufd_fops_release+0x386/0x420
[   26.022152]  ? iommufd_fops_release+0x386/0x420
[   26.022619]  ? locks_remove_file+0x3b4/0x5d0
[   26.023082]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.023577]  ? __memcg_slab_free_hook+0xc1/0x540
[   26.024052]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   26.024639]  ? evm_file_release+0x141/0x220
[   26.025091]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.025608]  __fput+0x41c/0xb70
[   26.025975]  ____fput+0x22/0x30
[   26.026329]  task_work_run+0x19b/0x2b0
[   26.026734]  ? __pfx_task_work_run+0x10/0x10
[   26.027178]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   26.027718]  ? switch_task_namespaces+0xc6/0x110
[   26.028197]  do_exit+0xb0e/0x29d0
[   26.028551]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.029058]  ? __pfx_do_exit+0x10/0x10
[   26.029484]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.030058]  ? __x64_sys_ioctl+0x1ba/0x220
[   26.030486]  make_task_dead+0x181/0x3c0
[   26.030900]  rewind_stack_and_make_dead+0x16/0x20
[   26.031379] RIP: 0033:0x7fbbae23ee5d
[   26.031750] Code: Unable to access opcode bytes at 0x7fbbae23ee33.
[   26.032382] RSP: 002b:00007ffeaeea31e8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.033165] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fbbae23ee5d
[   26.033910] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.034635] RBP: 00007ffeaeea3200 R08: 0000000000000800 R09: 0000000000000800
[   26.035341] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffeaeea3318
[   26.036037] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fbbae4ee000
[   26.036746]  </TASK>
[   26.036985] irq event stamp: 0
[   26.037302] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   26.037945] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   26.038790] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   26.039596] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   26.040244] ---[ end trace 0000000000000000 ]---
[   26.040800] ------------[ cut here ]------------
[   26.041263] WARNING: CPU: 0 PID: 760 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   26.042222] Modules linked in:
[   26.042606] CPU: 0 UID: 0 PID: 760 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.043777] Tainted: [D]=DIE, [W]=WARN
[   26.044158] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.045254] RIP: 0010:iommufd_fops_release+0x392/0x420
[   26.045794] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   26.047606] RSP: 0018:ffff888010757c08 EFLAGS: 00010293
[   26.048131] RAX: 0000000000000000 RBX: ffff8880138cd008 RCX: ffffffff83afe4ca
[   26.048825] RDX: ffff88801375a540 RSI: ffffffff83afe642 RDI: ffff8880138cd0a0
[   26.049560] RBP: ffff888010757cb8 R08: 0000000000000000 R09: 0000000000000000
[   26.050303] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   26.051015] R13: 0000000000000000 R14: ffff888010757c50 R15: 0000000000000000
[   26.051714] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   26.052517] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.053088] CR2: 00000000200006c0 CR3: 0000000007086003 CR4: 0000000000770ef0
[   26.053812] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.054524] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.055240] PKRU: 55555554
[   26.055532] Call Trace:
[   26.055800]  <TASK>
[   26.056034]  ? show_regs+0x6d/0x80
[   26.056398]  ? __warn+0xf3/0x380
[   26.056739]  ? report_bug+0x25e/0x4b0
[   26.057118]  ? iommufd_fops_release+0x392/0x420
[   26.057604]  ? report_bug+0x2cb/0x4b0
[   26.058006]  ? iommufd_fops_release+0x392/0x420
[   26.058473]  ? iommufd_fops_release+0x392/0x420
[   26.058950]  ? handle_bug+0x2cd/0x510
[   26.059332]  ? iommufd_fops_release+0x394/0x420
[   26.059796]  ? exc_invalid_op+0x3c/0x80
[   26.060197]  ? asm_exc_invalid_op+0x1f/0x30
[   26.060627]  ? iommufd_fops_release+0x21a/0x420
[   26.061090]  ? iommufd_fops_release+0x392/0x420
[   26.061577]  ? iommufd_fops_release+0x392/0x420
[   26.062068]  ? iommufd_fops_release+0x392/0x420
[   26.062532]  ? locks_remove_file+0x3b4/0x5d0
[   26.062991]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.063486]  ? __memcg_slab_free_hook+0xc1/0x540
[   26.063958]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   26.064499]  ? evm_file_release+0x141/0x220
[   26.064928]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.065444]  __fput+0x41c/0xb70
[   26.065803]  ____fput+0x22/0x30
[   26.066143]  task_work_run+0x19b/0x2b0
[   26.066536]  ? __pfx_task_work_run+0x10/0x10
[   26.066986]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   26.067523]  ? switch_task_namespaces+0xc6/0x110
[   26.068000]  do_exit+0xb0e/0x29d0
[   26.068358]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.068862]  ? __pfx_do_exit+0x10/0x10
[   26.069267]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.069775]  ? __x64_sys_ioctl+0x1ba/0x220
[   26.070231]  make_task_dead+0x181/0x3c0
[   26.070633]  rewind_stack_and_make_dead+0x16/0x20
[   26.071132] RIP: 0033:0x7fbbae23ee5d
[   26.071511] Code: Unable to access opcode bytes at 0x7fbbae23ee33.
[   26.072131] RSP: 002b:00007ffeaeea31e8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.072870] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fbbae23ee5d
[   26.073591] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.074332] RBP: 00007ffeaeea3200 R08: 0000000000000800 R09: 0000000000000800
[   26.075036] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffeaeea3318
[   26.075733] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fbbae4ee000
[   26.076438]  </TASK>
[   26.076675] irq event stamp: 0
[   26.076992] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   26.077636] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   26.078483] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   26.079290] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   26.079908] ---[ end trace 0000000000000000 ]---
[   26.087233] iommufd_mock iommufd_mock31: Adding to iommu group 31
[   26.088961] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#32] SMP KASAN NOPTI
[   26.090141] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   26.090944] CPU: 0 UID: 0 PID: 761 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.092128] Tainted: [D]=DIE, [W]=WARN
[   26.092506] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.093607] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   26.094192] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   26.095990] RSP: 0018:ffff888021edfb78 EFLAGS: 00010246
[   26.096553] RAX: dffffc0000000000 RBX: ffff888013e5a200 RCX: 1ffffffff0dd8bdc
[   26.097295] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff888012f487fc
[   26.098004] RBP: ffff888021edfbc8 R08: 0000000000000000 R09: 0000000000000000
[   26.098738] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   26.099465] R13: 0000000000000001 R14: ffff888021edfe18 R15: ffff888010524408
[   26.100173] FS:  00007f6985f13600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   26.100973] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.101553] CR2: 00000000200006c0 CR3: 0000000017096001 CR4: 0000000000770ef0
[   26.102263] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.103022] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.103732] PKRU: 55555554
[   26.104022] Call Trace:
[   26.104286]  <TASK>
[   26.104523]  ? show_regs+0x6d/0x80
[   26.104894]  ? die_addr+0x45/0xb0
[   26.105258]  ? exc_general_protection+0x1ad/0x340
[   26.105770]  ? asm_exc_general_protection+0x2b/0x30
[   26.106310]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   26.106918]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   26.107528]  iommufd_device_detach+0x2a/0x2e0
[   26.107992]  iommufd_test+0x2f99/0x5cd0
[   26.108399]  ? do_raw_spin_unlock+0x15c/0x210
[   26.108870]  ? __pfx_iommufd_test+0x10/0x10
[   26.109315]  ? debug_smp_processor_id+0x20/0x30
[   26.109807]  ? rcu_is_watching+0x19/0xc0
[   26.110227]  ? lock_release+0x1ea/0x2c0
[   26.110636]  ? __might_fault+0xf1/0x1b0
[   26.111053]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   26.111614]  iommufd_fops_ioctl+0x38e/0x520
[   26.112054]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.112547]  ? trace_irq_enable+0xd1/0x110
[   26.112988]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.113510]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.114003]  __x64_sys_ioctl+0x1ba/0x220
[   26.114417]  x64_sys_call+0x122e/0x2150
[   26.114826]  do_syscall_64+0x6d/0x150
[   26.115218]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   26.115738] RIP: 0033:0x7f6985c3ee5d
[   26.116117] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   26.117931] RSP: 002b:00007ffed2451718 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.118686] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f6985c3ee5d
[   26.119402] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.120112] RBP: 00007ffed2451730 R08: 0000000000000800 R09: 0000000000000800
[   26.120819] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffed2451848
[   26.121527] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f6985f5c000
[   26.122242]  </TASK>
[   26.122481] Modules linked in:
[   26.122938] ---[ end trace 0000000000000000 ]---
[   26.123495] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   26.124283] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   26.126331] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   26.126876] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   26.127586] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   26.128290] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   26.129000] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   26.129797] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   26.130517] FS:  00007f6985f13600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   26.131344] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.131936] CR2: 00000000200006c0 CR3: 0000000017096001 CR4: 0000000000770ef0
[   26.132656] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.133479] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.134186] PKRU: 55555554
[   26.136627] ------------[ cut here ]------------
[   26.137298] WARNING: CPU: 1 PID: 761 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   26.138577] Modules linked in:
[   26.139011] CPU: 1 UID: 0 PID: 761 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.140388] Tainted: [D]=DIE, [W]=WARN
[   26.140818] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.142124] RIP: 0010:iommufd_fops_release+0x386/0x420
[   26.142759] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   26.144760] RSP: 0018:ffff888021edfc08 EFLAGS: 00010293
[   26.145320] RAX: 0000000000000000 RBX: ffff88801ac35808 RCX: ffffffff83afe4ca
[   26.146188] RDX: ffff888012f48000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   26.146981] RBP: ffff888021edfcb8 R08: 0000000000000000 R09: 0000000000000000
[   26.147805] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   26.148637] R13: 0000000000000000 R14: ffff888021edfc50 R15: 0000000000000000
[   26.149463] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   26.150303] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.151019] CR2: 00007f25f7d83010 CR3: 000000001af88006 CR4: 0000000000770ef0
[   26.151763] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.152591] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.153387] PKRU: 55555554
[   26.153722] Call Trace:
[   26.154044]  <TASK>
[   26.154287]  ? show_regs+0x6d/0x80
[   26.154672]  ? __warn+0xf3/0x380
[   26.155070]  ? report_bug+0x25e/0x4b0
[   26.155557]  ? iommufd_fops_release+0x386/0x420
[   26.156052]  ? report_bug+0x2cb/0x4b0
[   26.156516]  ? iommufd_fops_release+0x386/0x420
[   26.157045]  ? iommufd_fops_release+0x386/0x420
[   26.157592]  ? handle_bug+0x2cd/0x510
[   26.158043]  ? iommufd_fops_release+0x388/0x420
[   26.158579]  ? exc_invalid_op+0x3c/0x80
[   26.159014]  ? asm_exc_invalid_op+0x1f/0x30
[   26.159516]  ? iommufd_fops_release+0x21a/0x420
[   26.160047]  ? iommufd_fops_release+0x386/0x420
[   26.160540]  ? iommufd_fops_release+0x386/0x420
[   26.161081]  ? iommufd_fops_release+0x386/0x420
[   26.161670]  ? locks_remove_file+0x3b4/0x5d0
[   26.162150]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.162718]  ? __memcg_slab_free_hook+0xc1/0x540
[   26.163287]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   26.163998]  ? evm_file_release+0x141/0x220
[   26.164569]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.165241]  __fput+0x41c/0xb70
[   26.165784]  ____fput+0x22/0x30
[   26.166224]  task_work_run+0x19b/0x2b0
[   26.166778]  ? __pfx_task_work_run+0x10/0x10
[   26.167394]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   26.168131]  ? switch_task_namespaces+0xc6/0x110
[   26.168817]  do_exit+0xb0e/0x29d0
[   26.169282]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.170069]  ? __pfx_do_exit+0x10/0x10
[   26.170587]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.171314]  ? __x64_sys_ioctl+0x1ba/0x220
[   26.171873]  make_task_dead+0x181/0x3c0
[   26.172406]  rewind_stack_and_make_dead+0x16/0x20
[   26.173088] RIP: 0033:0x7f6985c3ee5d
[   26.173631] Code: Unable to access opcode bytes at 0x7f6985c3ee33.
[   26.174522] RSP: 002b:00007ffed2451718 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.175603] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f6985c3ee5d
[   26.176535] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.177610] RBP: 00007ffed2451730 R08: 0000000000000800 R09: 0000000000000800
[   26.178618] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffed2451848
[   26.179555] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f6985f5c000
[   26.180572]  </TASK>
[   26.180883] irq event stamp: 0
[   26.181433] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   26.182259] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   26.183430] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   26.184572] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   26.185454] ---[ end trace 0000000000000000 ]---
[   26.186236] ------------[ cut here ]------------
[   26.187128] WARNING: CPU: 1 PID: 761 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   26.188381] Modules linked in:
[   26.188862] CPU: 1 UID: 0 PID: 761 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.190553] Tainted: [D]=DIE, [W]=WARN
[   26.191067] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.192599] RIP: 0010:iommufd_fops_release+0x392/0x420
[   26.193407] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   26.195854] RSP: 0018:ffff888021edfc08 EFLAGS: 00010293
[   26.196329] systemd-journald[145]: Data hash table of /run/log/journal/938775788448454bb5b34822d5730c41/system.journal has a fill level at 75.0 (5259 of 7011 items, 4038656 file size, 767 bytes per hash table item), suggesting rotation.
[   26.196549] RAX: 0000000000000000 RBX: ffff88801ac35808 RCX: ffffffff83afe4ca
[   26.198696] systemd-journald[145]: /run/log/journal/938775788448454bb5b34822d5730c41/system.journal: Journal header limits reached or header out-of-date, rotating.
[   26.199613] RDX: ffff888012f48000 RSI: ffffffff83afe642 RDI: ffff88801ac358a0
[   26.202098] RBP: ffff888021edfcb8 R08: 0000000000000000 R09: 0000000000000000
[   26.203077] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   26.204010] R13: 0000000000000000 R14: ffff888021edfc50 R15: 0000000000000000
[   26.204938] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   26.206065] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.206835] CR2: 00007f25f7d83010 CR3: 0000000007086005 CR4: 0000000000770ef0
[   26.207769] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.208703] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.209691] PKRU: 55555554
[   26.210070] Call Trace:
[   26.210411]  <TASK>
[   26.210726]  ? show_regs+0x6d/0x80
[   26.211204]  ? __warn+0xf3/0x380
[   26.211655]  ? report_bug+0x25e/0x4b0
[   26.212168]  ? iommufd_fops_release+0x392/0x420
[   26.212788]  ? report_bug+0x2cb/0x4b0
[   26.213292]  ? iommufd_fops_release+0x392/0x420
[   26.213963]  ? iommufd_fops_release+0x392/0x420
[   26.214585]  ? handle_bug+0x2cd/0x510
[   26.215192]  ? iommufd_fops_release+0x394/0x420
[   26.215826]  ? exc_invalid_op+0x3c/0x80
[   26.216373]  ? asm_exc_invalid_op+0x1f/0x30
[   26.216960]  ? iommufd_fops_release+0x21a/0x420
[   26.217650]  ? iommufd_fops_release+0x392/0x420
[   26.218414]  ? iommufd_fops_release+0x392/0x420
[   26.219049]  ? iommufd_fops_release+0x392/0x420
[   26.219793]  ? locks_remove_file+0x3b4/0x5d0
[   26.220500]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.221168]  ? __memcg_slab_free_hook+0xc1/0x540
[   26.221892]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   26.222637]  ? evm_file_release+0x141/0x220
[   26.223221]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.223894]  __fput+0x41c/0xb70
[   26.224341]  ____fput+0x22/0x30
[   26.224782]  task_work_run+0x19b/0x2b0
[   26.225316]  ? __pfx_task_work_run+0x10/0x10
[   26.225968]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   26.226711]  ? switch_task_namespaces+0xc6/0x110
[   26.227365]  do_exit+0xb0e/0x29d0
[   26.227863]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.228538]  ? __pfx_do_exit+0x10/0x10
[   26.229057]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.229767]  ? __x64_sys_ioctl+0x1ba/0x220
[   26.230337]  make_task_dead+0x181/0x3c0
[   26.231312]  rewind_stack_and_make_dead+0x16/0x20
[   26.232773] RIP: 0033:0x7f6985c3ee5d
[   26.234137] Code: Unable to access opcode bytes at 0x7f6985c3ee33.
[   26.235975] RSP: 002b:00007ffed2451718 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.238318] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f6985c3ee5d
[   26.240367] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.242546] RBP: 00007ffed2451730 R08: 0000000000000800 R09: 0000000000000800
[   26.244583] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffed2451848
[   26.246772] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f6985f5c000
[   26.248828]  </TASK>
[   26.249964] irq event stamp: 0
[   26.250974] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   26.253180] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   26.256029] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   26.259043] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   26.261600] ---[ end trace 0000000000000000 ]---
[   26.271702] iommufd_mock iommufd_mock32: Adding to iommu group 32
[   26.273536] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#33] SMP KASAN NOPTI
[   26.274688] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   26.275464] CPU: 0 UID: 0 PID: 763 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.276660] Tainted: [D]=DIE, [W]=WARN
[   26.277053] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.278235] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   26.278853] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   26.280727] RSP: 0018:ffff88801f3e7b78 EFLAGS: 00010246
[   26.281284] RAX: dffffc0000000000 RBX: ffff888013e5aa00 RCX: 1ffffffff0dd8bdc
[   26.282028] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff888012f4d27c
[   26.282789] RBP: ffff88801f3e7bc8 R08: 0000000000000000 R09: 0000000000000000
[   26.283564] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   26.284305] R13: 0000000000000001 R14: ffff88801f3e7e18 R15: ffff888010525408
[   26.285046] FS:  00007f52439fe600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   26.285883] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.286488] CR2: 00007f08244207c8 CR3: 000000000fdde003 CR4: 0000000000770ef0
[   26.287292] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.288091] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.288895] PKRU: 55555554
[   26.289219] Call Trace:
[   26.289502]  <TASK>
[   26.289766]  ? show_regs+0x6d/0x80
[   26.290162]  ? die_addr+0x45/0xb0
[   26.290537]  ? exc_general_protection+0x1ad/0x340
[   26.291446]  ? asm_exc_general_protection+0x2b/0x30
[   26.292544]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   26.293090]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   26.293632]  iommufd_device_detach+0x2a/0x2e0
[   26.294108]  iommufd_test+0x2f99/0x5cd0
[   26.294523]  ? do_raw_spin_unlock+0x15c/0x210
[   26.295014]  ? __pfx_iommufd_test+0x10/0x10
[   26.295463]  ? debug_smp_processor_id+0x20/0x30
[   26.295953]  ? rcu_is_watching+0x19/0xc0
[   26.296381]  ? lock_release+0x1ea/0x2c0
[   26.296797]  ? __might_fault+0xf1/0x1b0
[   26.297217]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   26.297787]  iommufd_fops_ioctl+0x38e/0x520
[   26.298240]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.298751]  ? trace_irq_enable+0xd1/0x110
[   26.299203]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.299732]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.300236]  __x64_sys_ioctl+0x1ba/0x220
[   26.300666]  x64_sys_call+0x122e/0x2150
[   26.301091]  do_syscall_64+0x6d/0x150
[   26.301502]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   26.302032] RIP: 0033:0x7f524363ee5d
[   26.302421] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   26.304273] RSP: 002b:00007ffc0ea87fa8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.305049] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f524363ee5d
[   26.305780] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.306507] RBP: 00007ffc0ea87fc0 R08: 0000000000000800 R09: 0000000000000800
[   26.307239] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc0ea880d8
[   26.307970] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f5243a47000
[   26.308709]  </TASK>
[   26.308954] Modules linked in:
[   26.309419] ---[ end trace 0000000000000000 ]---
[   26.309909] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   26.310510] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   26.312357] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   26.312907] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   26.313697] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   26.314430] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   26.315164] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   26.315890] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   26.316620] FS:  00007f52439fe600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   26.317511] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.318111] CR2: 00007f08244207c8 CR3: 000000000fdde003 CR4: 0000000000770ef0
[   26.318853] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.319581] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.320310] PKRU: 55555554
[   26.323381] ------------[ cut here ]------------
[   26.323956] WARNING: CPU: 1 PID: 763 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   26.325059] Modules linked in:
[   26.325500] CPU: 1 UID: 0 PID: 763 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.326758] Tainted: [D]=DIE, [W]=WARN
[   26.327165] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.328330] RIP: 0010:iommufd_fops_release+0x386/0x420
[   26.328884] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   26.330793] RSP: 0018:ffff88801f3e7c08 EFLAGS: 00010293
[   26.331366] RAX: 0000000000000000 RBX: ffff88801ff71008 RCX: ffffffff83afe4ca
[   26.332108] RDX: ffff888012f4ca80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   26.332850] RBP: ffff88801f3e7cb8 R08: 0000000000000000 R09: 0000000000000000
[   26.333614] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   26.334360] R13: 0000000000000000 R14: ffff88801f3e7c50 R15: 0000000000000000
[   26.335200] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   26.336126] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.336730] CR2: 00007f25f8007010 CR3: 0000000007086001 CR4: 0000000000770ef0
[   26.337497] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.338257] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.339024] PKRU: 55555554
[   26.339319] Call Trace:
[   26.339587]  <TASK>
[   26.339825]  ? show_regs+0x6d/0x80
[   26.340199]  ? __warn+0xf3/0x380
[   26.340555]  ? report_bug+0x25e/0x4b0
[   26.340952]  ? iommufd_fops_release+0x386/0x420
[   26.341456]  ? report_bug+0x2cb/0x4b0
[   26.341861]  ? iommufd_fops_release+0x386/0x420
[   26.342345]  ? iommufd_fops_release+0x386/0x420
[   26.342833]  ? handle_bug+0x2cd/0x510
[   26.343229]  ? iommufd_fops_release+0x388/0x420
[   26.343712]  ? exc_invalid_op+0x3c/0x80
[   26.344127]  ? asm_exc_invalid_op+0x1f/0x30
[   26.344573]  ? iommufd_fops_release+0x21a/0x420
[   26.345054]  ? iommufd_fops_release+0x386/0x420
[   26.345568]  ? iommufd_fops_release+0x386/0x420
[   26.346072]  ? iommufd_fops_release+0x386/0x420
[   26.346552]  ? locks_remove_file+0x3b4/0x5d0
[   26.347019]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.347533]  ? __memcg_slab_free_hook+0xc1/0x540
[   26.348024]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   26.348585]  ? evm_file_release+0x141/0x220
[   26.349032]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.349566]  __fput+0x41c/0xb70
[   26.349944]  ____fput+0x22/0x30
[   26.350290]  task_work_run+0x19b/0x2b0
[   26.350701]  ? __pfx_task_work_run+0x10/0x10
[   26.351168]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   26.351728]  ? switch_task_namespaces+0xc6/0x110
[   26.352241]  do_exit+0xb0e/0x29d0
[   26.352620]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.353160]  ? __pfx_do_exit+0x10/0x10
[   26.353600]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.354132]  ? __x64_sys_ioctl+0x1ba/0x220
[   26.354582]  make_task_dead+0x181/0x3c0
[   26.355011]  rewind_stack_and_make_dead+0x16/0x20
[   26.355521] RIP: 0033:0x7f524363ee5d
[   26.355915] Code: Unable to access opcode bytes at 0x7f524363ee33.
[   26.356558] RSP: 002b:00007ffc0ea87fa8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.357374] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f524363ee5d
[   26.358116] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.358867] RBP: 00007ffc0ea87fc0 R08: 0000000000000800 R09: 0000000000000800
[   26.359608] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc0ea880d8
[   26.360351] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f5243a47000
[   26.361100]  </TASK>
[   26.361377] irq event stamp: 0
[   26.361736] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   26.362396] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   26.363257] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   26.364113] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   26.364768] ---[ end trace 0000000000000000 ]---
[   26.365358] ------------[ cut here ]------------
[   26.365865] WARNING: CPU: 1 PID: 763 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   26.366858] Modules linked in:
[   26.367202] CPU: 1 UID: 0 PID: 763 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.368439] Tainted: [D]=DIE, [W]=WARN
[   26.368841] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.370027] RIP: 0010:iommufd_fops_release+0x392/0x420
[   26.370595] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   26.372481] RSP: 0018:ffff88801f3e7c08 EFLAGS: 00010293
[   26.373036] RAX: 0000000000000000 RBX: ffff88801ff71008 RCX: ffffffff83afe4ca
[   26.373799] RDX: ffff888012f4ca80 RSI: ffffffff83afe642 RDI: ffff88801ff710a0
[   26.374552] RBP: ffff88801f3e7cb8 R08: 0000000000000000 R09: 0000000000000000
[   26.375299] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   26.376042] R13: 0000000000000000 R14: ffff88801f3e7c50 R15: 0000000000000000
[   26.376783] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   26.377642] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.378263] CR2: 00007f25f8007010 CR3: 0000000007086001 CR4: 0000000000770ef0
[   26.379015] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.379758] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.380500] PKRU: 55555554
[   26.380803] Call Trace:
[   26.381077]  <TASK>
[   26.381322]  ? show_regs+0x6d/0x80
[   26.381750]  ? __warn+0xf3/0x380
[   26.382115]  ? report_bug+0x25e/0x4b0
[   26.382518]  ? iommufd_fops_release+0x392/0x420
[   26.383023]  ? report_bug+0x2cb/0x4b0
[   26.383430]  ? iommufd_fops_release+0x392/0x420
[   26.383925]  ? iommufd_fops_release+0x392/0x420
[   26.384420]  ? handle_bug+0x2cd/0x510
[   26.384825]  ? iommufd_fops_release+0x394/0x420
[   26.385320]  ? exc_invalid_op+0x3c/0x80
[   26.385797]  ? asm_exc_invalid_op+0x1f/0x30
[   26.386257]  ? iommufd_fops_release+0x21a/0x420
[   26.386754]  ? iommufd_fops_release+0x392/0x420
[   26.387247]  ? iommufd_fops_release+0x392/0x420
[   26.387742]  ? iommufd_fops_release+0x392/0x420
[   26.388234]  ? locks_remove_file+0x3b4/0x5d0
[   26.388707]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.389236]  ? __memcg_slab_free_hook+0xc1/0x540
[   26.389770]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   26.390359]  ? evm_file_release+0x141/0x220
[   26.390820]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.391355]  __fput+0x41c/0xb70
[   26.391714]  ____fput+0x22/0x30
[   26.392068]  task_work_run+0x19b/0x2b0
[   26.392490]  ? __pfx_task_work_run+0x10/0x10
[   26.392961]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   26.393562]  ? switch_task_namespaces+0xc6/0x110
[   26.394075]  do_exit+0xb0e/0x29d0
[   26.394453]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.395011]  ? __pfx_do_exit+0x10/0x10
[   26.395426]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.395941]  ? __x64_sys_ioctl+0x1ba/0x220
[   26.396394]  make_task_dead+0x181/0x3c0
[   26.396818]  rewind_stack_and_make_dead+0x16/0x20
[   26.397354] RIP: 0033:0x7f524363ee5d
[   26.397751] Code: Unable to access opcode bytes at 0x7f524363ee33.
[   26.398396] RSP: 002b:00007ffc0ea87fa8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.399233] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f524363ee5d
[   26.399998] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.400743] RBP: 00007ffc0ea87fc0 R08: 0000000000000800 R09: 0000000000000800
[   26.401563] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc0ea880d8
[   26.402306] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f5243a47000
[   26.403065]  </TASK>
[   26.403317] irq event stamp: 0
[   26.403653] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   26.404315] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   26.405173] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   26.406066] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   26.406731] ---[ end trace 0000000000000000 ]---
[   26.413074] iommufd_mock iommufd_mock33: Adding to iommu group 33
[   26.414128] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#34] SMP KASAN NOPTI
[   26.415412] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   26.416289] CPU: 0 UID: 0 PID: 764 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.417508] Tainted: [D]=DIE, [W]=WARN
[   26.417907] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.419147] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   26.419766] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   26.421650] RSP: 0018:ffff888014eb7b78 EFLAGS: 00010246
[   26.422200] RAX: dffffc0000000000 RBX: ffff888013e5b200 RCX: 1ffffffff0dd8bdc
[   26.422939] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880120d87fc
[   26.423682] RBP: ffff888014eb7bc8 R08: 0000000000000000 R09: 0000000000000000
[   26.424414] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   26.425152] R13: 0000000000000001 R14: ffff888014eb7e18 R15: ffff888010d3dc08
[   26.425889] FS:  00007f9853156600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   26.426717] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.427321] CR2: 00000000200006c0 CR3: 000000001346a005 CR4: 0000000000770ef0
[   26.428078] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.428837] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.429577] PKRU: 55555554
[   26.429875] Call Trace:
[   26.430148]  <TASK>
[   26.430398]  ? show_regs+0x6d/0x80
[   26.430806]  ? die_addr+0x45/0xb0
[   26.431199]  ? exc_general_protection+0x1ad/0x340
[   26.431737]  ? asm_exc_general_protection+0x2b/0x30
[   26.432284]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   26.432853]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   26.433401]  iommufd_device_detach+0x2a/0x2e0
[   26.433880]  iommufd_test+0x2f99/0x5cd0
[   26.434299]  ? do_raw_spin_unlock+0x15c/0x210
[   26.434793]  ? __pfx_iommufd_test+0x10/0x10
[   26.435244]  ? debug_smp_processor_id+0x20/0x30
[   26.435746]  ? rcu_is_watching+0x19/0xc0
[   26.436179]  ? lock_release+0x1ea/0x2c0
[   26.436600]  ? __might_fault+0xf1/0x1b0
[   26.437028]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   26.437604]  iommufd_fops_ioctl+0x38e/0x520
[   26.438062]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.438577]  ? trace_irq_enable+0xd1/0x110
[   26.439042]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.439578]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.440087]  __x64_sys_ioctl+0x1ba/0x220
[   26.440519]  x64_sys_call+0x122e/0x2150
[   26.440936]  do_syscall_64+0x6d/0x150
[   26.441342]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   26.441882] RIP: 0033:0x7f9852e3ee5d
[   26.442274] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   26.444153] RSP: 002b:00007ffc335ecc88 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.444934] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f9852e3ee5d
[   26.445672] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.446406] RBP: 00007ffc335ecca0 R08: 0000000000000800 R09: 0000000000000800
[   26.447151] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc335ecdb8
[   26.447887] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f985319f000
[   26.448667]  </TASK>
[   26.448917] Modules linked in:
[   26.449358] ---[ end trace 0000000000000000 ]---
[   26.449857] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   26.450467] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   26.452344] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   26.452898] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   26.453698] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   26.454999] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   26.456184] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   26.458994] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   26.461406] FS:  00007f9853156600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   26.464051] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.466022] CR2: 00000000200006c0 CR3: 000000001346a005 CR4: 0000000000770ef0
[   26.467300] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.468045] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.468787] PKRU: 55555554
[   26.470110] ------------[ cut here ]------------
[   26.470618] WARNING: CPU: 0 PID: 764 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   26.471786] Modules linked in:
[   26.472140] CPU: 0 UID: 0 PID: 764 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.473626] Tainted: [D]=DIE, [W]=WARN
[   26.474037] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.475220] RIP: 0010:iommufd_fops_release+0x386/0x420
[   26.475776] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   26.477788] RSP: 0018:ffff888014eb7c08 EFLAGS: 00010293
[   26.478353] RAX: 0000000000000000 RBX: ffff88801ac36808 RCX: ffffffff83afe4ca
[   26.479105] RDX: ffff8880120d8000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   26.479850] RBP: ffff888014eb7cb8 R08: 0000000000000000 R09: 0000000000000000
[   26.480597] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   26.481399] R13: 0000000000000000 R14: ffff888014eb7c50 R15: 0000000000000000
[   26.482145] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   26.482980] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.483588] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   26.484343] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.485087] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.485891] PKRU: 55555554
[   26.486195] Call Trace:
[   26.486471]  <TASK>
[   26.486720]  ? show_regs+0x6d/0x80
[   26.487107]  ? __warn+0xf3/0x380
[   26.487475]  ? report_bug+0x25e/0x4b0
[   26.487883]  ? iommufd_fops_release+0x386/0x420
[   26.488378]  ? report_bug+0x2cb/0x4b0
[   26.488786]  ? iommufd_fops_release+0x386/0x420
[   26.489280]  ? iommufd_fops_release+0x386/0x420
[   26.489833]  ? handle_bug+0x2cd/0x510
[   26.490245]  ? iommufd_fops_release+0x388/0x420
[   26.490747]  ? exc_invalid_op+0x3c/0x80
[   26.491174]  ? asm_exc_invalid_op+0x1f/0x30
[   26.491640]  ? iommufd_fops_release+0x21a/0x420
[   26.492137]  ? iommufd_fops_release+0x386/0x420
[   26.492633]  ? iommufd_fops_release+0x386/0x420
[   26.493177]  ? iommufd_fops_release+0x386/0x420
[   26.493743]  ? locks_remove_file+0x3b4/0x5d0
[   26.494224]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.494761]  ? __memcg_slab_free_hook+0xc1/0x540
[   26.495258]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   26.495823]  ? evm_file_release+0x141/0x220
[   26.496272]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.496787]  __fput+0x41c/0xb70
[   26.497140]  ____fput+0x22/0x30
[   26.497542]  task_work_run+0x19b/0x2b0
[   26.497958]  ? __pfx_task_work_run+0x10/0x10
[   26.498419]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   26.498988]  ? switch_task_namespaces+0xc6/0x110
[   26.499485]  do_exit+0xb0e/0x29d0
[   26.499855]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.500380]  ? __pfx_do_exit+0x10/0x10
[   26.500787]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.501285]  ? __x64_sys_ioctl+0x1ba/0x220
[   26.501778]  make_task_dead+0x181/0x3c0
[   26.502198]  rewind_stack_and_make_dead+0x16/0x20
[   26.502697] RIP: 0033:0x7f9852e3ee5d
[   26.503090] Code: Unable to access opcode bytes at 0x7f9852e3ee33.
[   26.503721] RSP: 002b:00007ffc335ecc88 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.504494] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f9852e3ee5d
[   26.505222] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.506006] RBP: 00007ffc335ecca0 R08: 0000000000000800 R09: 0000000000000800
[   26.506744] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc335ecdb8
[   26.507488] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f985319f000
[   26.508245]  </TASK>
[   26.508500] irq event stamp: 0
[   26.508875] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   26.509606] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   26.510472] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   26.511334] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   26.511991] ---[ end trace 0000000000000000 ]---
[   26.512566] ------------[ cut here ]------------
[   26.513047] WARNING: CPU: 0 PID: 764 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   26.514167] Modules linked in:
[   26.514578] CPU: 0 UID: 0 PID: 764 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.515868] Tainted: [D]=DIE, [W]=WARN
[   26.516290] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.517585] RIP: 0010:iommufd_fops_release+0x392/0x420
[   26.518200] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   26.520099] RSP: 0018:ffff888014eb7c08 EFLAGS: 00010293
[   26.520658] RAX: 0000000000000000 RBX: ffff88801ac36808 RCX: ffffffff83afe4ca
[   26.521459] RDX: ffff8880120d8000 RSI: ffffffff83afe642 RDI: ffff88801ac368a0
[   26.522207] RBP: ffff888014eb7cb8 R08: 0000000000000000 R09: 0000000000000000
[   26.522959] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   26.523707] R13: 0000000000000000 R14: ffff888014eb7c50 R15: 0000000000000000
[   26.524503] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   26.525457] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.526114] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   26.526873] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.527620] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.528368] PKRU: 55555554
[   26.528670] Call Trace:
[   26.528946]  <TASK>
[   26.529189]  ? show_regs+0x6d/0x80
[   26.529650]  ? __warn+0xf3/0x380
[   26.530020]  ? report_bug+0x25e/0x4b0
[   26.530474]  ? iommufd_fops_release+0x392/0x420
[   26.530981]  ? report_bug+0x2cb/0x4b0
[   26.531390]  ? iommufd_fops_release+0x392/0x420
[   26.531885]  ? iommufd_fops_release+0x392/0x420
[   26.532380]  ? handle_bug+0x2cd/0x510
[   26.532786]  ? iommufd_fops_release+0x394/0x420
[   26.533281]  ? exc_invalid_op+0x3c/0x80
[   26.533833]  ? asm_exc_invalid_op+0x1f/0x30
[   26.534313]  ? iommufd_fops_release+0x21a/0x420
[   26.534816]  ? iommufd_fops_release+0x392/0x420
[   26.535313]  ? iommufd_fops_release+0x392/0x420
[   26.535807]  ? iommufd_fops_release+0x392/0x420
[   26.536303]  ? locks_remove_file+0x3b4/0x5d0
[   26.536777]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.537305]  ? __memcg_slab_free_hook+0xc1/0x540
[   26.537904]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   26.538479]  ? evm_file_release+0x141/0x220
[   26.538941]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.539468]  __fput+0x41c/0xb70
[   26.539827]  ____fput+0x22/0x30
[   26.540223]  task_work_run+0x19b/0x2b0
[   26.540645]  ? __pfx_task_work_run+0x10/0x10
[   26.541115]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   26.541772]  ? switch_task_namespaces+0xc6/0x110
[   26.542280]  do_exit+0xb0e/0x29d0
[   26.542657]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.543199]  ? __pfx_do_exit+0x10/0x10
[   26.543613]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.544125]  ? __x64_sys_ioctl+0x1ba/0x220
[   26.544575]  make_task_dead+0x181/0x3c0
[   26.545001]  rewind_stack_and_make_dead+0x16/0x20
[   26.545591] RIP: 0033:0x7f9852e3ee5d
[   26.545988] Code: Unable to access opcode bytes at 0x7f9852e3ee33.
[   26.546633] RSP: 002b:00007ffc335ecc88 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.547426] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f9852e3ee5d
[   26.548164] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.548912] RBP: 00007ffc335ecca0 R08: 0000000000000800 R09: 0000000000000800
[   26.549735] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc335ecdb8
[   26.550482] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f985319f000
[   26.551240]  </TASK>
[   26.551493] irq event stamp: 0
[   26.551831] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   26.552488] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   26.553412] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   26.554271] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   26.554936] ---[ end trace 0000000000000000 ]---
[   26.562277] iommufd_mock iommufd_mock34: Adding to iommu group 34
[   26.563228] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#35] SMP KASAN NOPTI
[   26.564537] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   26.565453] CPU: 1 UID: 0 PID: 765 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.566673] Tainted: [D]=DIE, [W]=WARN
[   26.567076] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.568240] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   26.568915] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   26.570878] RSP: 0018:ffff888010fbfb78 EFLAGS: 00010246
[   26.571476] RAX: dffffc0000000000 RBX: ffff88800de5c400 RCX: 1ffffffff0dd8bdd
[   26.572280] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88800fadd27c
[   26.573057] RBP: ffff888010fbfbc8 R08: 0000000000000000 R09: 0000000000000000
[   26.573859] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   26.574643] R13: 0000000000000001 R14: ffff888010fbfe18 R15: ffff888011375c08
[   26.575426] FS:  00007f9c7755d600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   26.576374] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.576979] CR2: 00000000200006c0 CR3: 00000000143ba006 CR4: 0000000000770ef0
[   26.577766] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.578575] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.579366] PKRU: 55555554
[   26.579721] Call Trace:
[   26.579991]  <TASK>
[   26.580231]  ? show_regs+0x6d/0x80
[   26.580608]  ? die_addr+0x45/0xb0
[   26.581022]  ? exc_general_protection+0x1ad/0x340
[   26.581619]  ? asm_exc_general_protection+0x2b/0x30
[   26.582148]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   26.582732]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   26.583312]  iommufd_device_detach+0x2a/0x2e0
[   26.583787]  iommufd_test+0x2f99/0x5cd0
[   26.584250]  ? do_raw_spin_unlock+0x15c/0x210
[   26.584751]  ? __pfx_iommufd_test+0x10/0x10
[   26.585202]  ? debug_smp_processor_id+0x20/0x30
[   26.585746]  ? rcu_is_watching+0x19/0xc0
[   26.586234]  ? lock_release+0x1ea/0x2c0
[   26.586649]  ? __might_fault+0xf1/0x1b0
[   26.587121]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   26.587757]  iommufd_fops_ioctl+0x38e/0x520
[   26.588246]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.588798]  ? trace_irq_enable+0xd1/0x110
[   26.589246]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.589819]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.590376]  __x64_sys_ioctl+0x1ba/0x220
[   26.590809]  x64_sys_call+0x122e/0x2150
[   26.591249]  do_syscall_64+0x6d/0x150
[   26.591718]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   26.592252] RIP: 0033:0x7f9c7723ee5d
[   26.592651] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   26.594740] RSP: 002b:00007ffd851346e8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.595535] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f9c7723ee5d
[   26.596408] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.597157] RBP: 00007ffd85134700 R08: 0000000000000800 R09: 0000000000000800
[   26.597998] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd85134818
[   26.598786] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f9c775a6000
[   26.599613]  </TASK>
[   26.599865] Modules linked in:
[   26.600363] ---[ end trace 0000000000000000 ]---
[   26.600924] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   26.601606] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   26.603718] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   26.604278] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   26.605066] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   26.605924] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   26.606774] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   26.607520] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   26.608374] FS:  00007f9c7755d600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   26.609213] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.609877] CR2: 00000000200006c0 CR3: 00000000143ba006 CR4: 0000000000770ef0
[   26.610630] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.611378] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.612123] PKRU: 55555554
[   26.613830] ------------[ cut here ]------------
[   26.614363] WARNING: CPU: 1 PID: 765 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   26.615416] Modules linked in:
[   26.615779] CPU: 1 UID: 0 PID: 765 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.617034] Tainted: [D]=DIE, [W]=WARN
[   26.617509] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.618679] RIP: 0010:iommufd_fops_release+0x386/0x420
[   26.619242] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   26.621134] RSP: 0018:ffff888010fbfc08 EFLAGS: 00010293
[   26.621749] RAX: 0000000000000000 RBX: ffff88801ff70808 RCX: ffffffff83afe4ca
[   26.622499] RDX: ffff88800fadca80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   26.623248] RBP: ffff888010fbfcb8 R08: 0000000000000000 R09: 0000000000000000
[   26.623996] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   26.624737] R13: 0000000000000000 R14: ffff888010fbfc50 R15: 0000000000000000
[   26.625504] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   26.626346] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.626958] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   26.627701] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.628442] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.629185] PKRU: 55555554
[   26.629511] Call Trace:
[   26.629787]  <TASK>
[   26.630029]  ? show_regs+0x6d/0x80
[   26.630415]  ? __warn+0xf3/0x380
[   26.630786]  ? report_bug+0x25e/0x4b0
[   26.631195]  ? iommufd_fops_release+0x386/0x420
[   26.631692]  ? report_bug+0x2cb/0x4b0
[   26.632097]  ? iommufd_fops_release+0x386/0x420
[   26.632589]  ? iommufd_fops_release+0x386/0x420
[   26.633082]  ? handle_bug+0x2cd/0x510
[   26.633513]  ? iommufd_fops_release+0x388/0x420
[   26.634010]  ? exc_invalid_op+0x3c/0x80
[   26.634435]  ? asm_exc_invalid_op+0x1f/0x30
[   26.634904]  ? iommufd_fops_release+0x21a/0x420
[   26.635398]  ? iommufd_fops_release+0x386/0x420
[   26.635891]  ? iommufd_fops_release+0x386/0x420
[   26.636385]  ? iommufd_fops_release+0x386/0x420
[   26.636877]  ? locks_remove_file+0x3b4/0x5d0
[   26.637372]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.637901]  ? __memcg_slab_free_hook+0xc1/0x540
[   26.638405]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   26.638994]  ? evm_file_release+0x141/0x220
[   26.639506]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.640033]  __fput+0x41c/0xb70
[   26.640393]  ____fput+0x22/0x30
[   26.640747]  task_work_run+0x19b/0x2b0
[   26.641167]  ? __pfx_task_work_run+0x10/0x10
[   26.641660]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   26.642273]  ? switch_task_namespaces+0xc6/0x110
[   26.642786]  do_exit+0xb0e/0x29d0
[   26.643160]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.643704]  ? __pfx_do_exit+0x10/0x10
[   26.644129]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.644698]  ? __x64_sys_ioctl+0x1ba/0x220
[   26.645203]  make_task_dead+0x181/0x3c0
[   26.645654]  rewind_stack_and_make_dead+0x16/0x20
[   26.646171] RIP: 0033:0x7f9c7723ee5d
[   26.646565] Code: Unable to access opcode bytes at 0x7f9c7723ee33.
[   26.647218] RSP: 002b:00007ffd851346e8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.648013] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f9c7723ee5d
[   26.648757] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.649529] RBP: 00007ffd85134700 R08: 0000000000000800 R09: 0000000000000800
[   26.650283] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd85134818
[   26.651041] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f9c775a6000
[   26.651793]  </TASK>
[   26.652046] irq event stamp: 0
[   26.652383] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   26.653042] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   26.653939] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   26.654828] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   26.655490] ---[ end trace 0000000000000000 ]---
[   26.656064] ------------[ cut here ]------------
[   26.656546] WARNING: CPU: 1 PID: 765 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   26.657567] Modules linked in:
[   26.657913] CPU: 1 UID: 0 PID: 765 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.659120] Tainted: [D]=DIE, [W]=WARN
[   26.659514] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.660650] RIP: 0010:iommufd_fops_release+0x392/0x420
[   26.661190] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   26.663061] RSP: 0018:ffff888010fbfc08 EFLAGS: 00010293
[   26.663617] RAX: 0000000000000000 RBX: ffff88801ff70808 RCX: ffffffff83afe4ca
[   26.664344] RDX: ffff88800fadca80 RSI: ffffffff83afe642 RDI: ffff88801ff708a0
[   26.665085] RBP: ffff888010fbfcb8 R08: 0000000000000000 R09: 0000000000000000
[   26.665834] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   26.666584] R13: 0000000000000000 R14: ffff888010fbfc50 R15: 0000000000000000
[   26.667331] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   26.668145] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.668755] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   26.669527] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.670282] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.671032] PKRU: 55555554
[   26.671335] Call Trace:
[   26.671609]  <TASK>
[   26.671854]  ? show_regs+0x6d/0x80
[   26.672235]  ? __warn+0xf3/0x380
[   26.672598]  ? report_bug+0x25e/0x4b0
[   26.673003]  ? iommufd_fops_release+0x392/0x420
[   26.673524]  ? report_bug+0x2cb/0x4b0
[   26.673961]  ? iommufd_fops_release+0x392/0x420
[   26.674453]  ? iommufd_fops_release+0x392/0x420
[   26.674959]  ? handle_bug+0x2cd/0x510
[   26.675365]  ? iommufd_fops_release+0x394/0x420
[   26.675858]  ? exc_invalid_op+0x3c/0x80
[   26.676283]  ? asm_exc_invalid_op+0x1f/0x30
[   26.676741]  ? iommufd_fops_release+0x21a/0x420
[   26.677236]  ? iommufd_fops_release+0x392/0x420
[   26.677754]  ? iommufd_fops_release+0x392/0x420
[   26.678272]  ? iommufd_fops_release+0x392/0x420
[   26.678768]  ? locks_remove_file+0x3b4/0x5d0
[   26.679240]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.679765]  ? __memcg_slab_free_hook+0xc1/0x540
[   26.680268]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   26.680843]  ? evm_file_release+0x141/0x220
[   26.681299]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.681847]  __fput+0x41c/0xb70
[   26.682228]  ____fput+0x22/0x30
[   26.682584]  task_work_run+0x19b/0x2b0
[   26.683006]  ? __pfx_task_work_run+0x10/0x10
[   26.683475]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   26.684052]  ? switch_task_namespaces+0xc6/0x110
[   26.684557]  do_exit+0xb0e/0x29d0
[   26.684931]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.685490]  ? __pfx_do_exit+0x10/0x10
[   26.685931]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.686439]  ? __x64_sys_ioctl+0x1ba/0x220
[   26.686891]  make_task_dead+0x181/0x3c0
[   26.687315]  rewind_stack_and_make_dead+0x16/0x20
[   26.687822] RIP: 0033:0x7f9c7723ee5d
[   26.688216] Code: Unable to access opcode bytes at 0x7f9c7723ee33.
[   26.688859] RSP: 002b:00007ffd851346e8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.689670] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f9c7723ee5d
[   26.690431] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.691177] RBP: 00007ffd85134700 R08: 0000000000000800 R09: 0000000000000800
[   26.691919] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd85134818
[   26.692663] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f9c775a6000
[   26.693438]  </TASK>
[   26.693700] irq event stamp: 0
[   26.694036] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   26.694695] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   26.695552] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   26.696410] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   26.697066] ---[ end trace 0000000000000000 ]---
[   26.703192] iommufd_mock iommufd_mock35: Adding to iommu group 35
[   26.704899] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#36] SMP KASAN NOPTI
[   26.706221] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   26.707070] CPU: 1 UID: 0 PID: 766 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.708497] Tainted: [D]=DIE, [W]=WARN
[   26.708920] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.710226] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   26.710877] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   26.713042] RSP: 0018:ffff888014eb7b78 EFLAGS: 00010246
[   26.713651] RAX: dffffc0000000000 RBX: ffff888013e5b000 RCX: 1ffffffff0dd8bdd
[   26.714471] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88800fadad3c
[   26.715330] RBP: ffff888014eb7bc8 R08: 0000000000000000 R09: 0000000000000000
[   26.716140] R10: 0000000000000000 R11: ffff88806c543ec0 R12: 0000000000000000
[   26.716989] R13: 0000000000000001 R14: ffff888014eb7e18 R15: ffff888013440408
[   26.717790] FS:  00007f4a4d20a600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   26.718759] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.719418] CR2: 000055dee2f4abbc CR3: 000000000ea00001 CR4: 0000000000770ef0
[   26.720282] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.721090] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.721949] PKRU: 55555554
[   26.722273] Call Trace:
[   26.722571]  <TASK>
[   26.722937]  ? show_regs+0x6d/0x80
[   26.723334]  ? die_addr+0x45/0xb0
[   26.723718]  ? exc_general_protection+0x1ad/0x340
[   26.724293]  ? asm_exc_general_protection+0x2b/0x30
[   26.724941]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   26.725541]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   26.726221]  iommufd_device_detach+0x2a/0x2e0
[   26.726754]  iommufd_test+0x2f99/0x5cd0
[   26.727235]  ? do_raw_spin_unlock+0x15c/0x210
[   26.727829]  ? __pfx_iommufd_test+0x10/0x10
[   26.728300]  ? debug_smp_processor_id+0x20/0x30
[   26.728867]  ? rcu_is_watching+0x19/0xc0
[   26.729421]  ? lock_release+0x1ea/0x2c0
[   26.729868]  ? __might_fault+0xf1/0x1b0
[   26.730326]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   26.731060]  iommufd_fops_ioctl+0x38e/0x520
[   26.731548]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.732118]  ? trace_irq_enable+0xd1/0x110
[   26.732712]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.733293]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.733970]  __x64_sys_ioctl+0x1ba/0x220
[   26.734433]  x64_sys_call+0x122e/0x2150
[   26.734891]  do_syscall_64+0x6d/0x150
[   26.735361]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   26.736026] RIP: 0033:0x7f4a4d03ee5d
[   26.736445] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   26.738618] RSP: 002b:00007ffcd1a15c28 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.739446] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f4a4d03ee5d
[   26.740278] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.741012] RBP: 00007ffcd1a15c40 R08: 0000000000000800 R09: 0000000000000800
[   26.741880] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcd1a15d58
[   26.742658] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f4a4d253000
[   26.743404]  </TASK>
[   26.743665] Modules linked in:
[   26.744179] ---[ end trace 0000000000000000 ]---
[   26.744768] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   26.745476] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   26.747515] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   26.748078] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   26.748817] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   26.749654] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   26.750403] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   26.751143] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   26.751901] FS:  00007f4a4d20a600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   26.752763] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.753445] CR2: 000055dee2f4abbc CR3: 000000000ea00001 CR4: 0000000000770ef0
[   26.754217] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.754961] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.755698] PKRU: 55555554
[   26.756672] ------------[ cut here ]------------
[   26.757171] WARNING: CPU: 1 PID: 766 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   26.758199] Modules linked in:
[   26.758585] CPU: 1 UID: 0 PID: 766 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.759814] Tainted: [D]=DIE, [W]=WARN
[   26.760217] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.761474] RIP: 0010:iommufd_fops_release+0x386/0x420
[   26.762124] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   26.764005] RSP: 0018:ffff888014eb7c08 EFLAGS: 00010293
[   26.764559] RAX: 0000000000000000 RBX: ffff88801ac36008 RCX: ffffffff83afe4ca
[   26.765298] RDX: ffff88800fada540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   26.766097] RBP: ffff888014eb7cb8 R08: 0000000000000000 R09: 0000000000000000
[   26.766838] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   26.767574] R13: 0000000000000000 R14: ffff888014eb7c50 R15: 0000000000000000
[   26.768306] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   26.769132] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.769755] CR2: 000055dee2f4abbc CR3: 0000000007086002 CR4: 0000000000770ef0
[   26.770500] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.771241] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.771992] PKRU: 55555554
[   26.772298] Call Trace:
[   26.772581]  <TASK>
[   26.772823]  ? show_regs+0x6d/0x80
[   26.773206]  ? __warn+0xf3/0x380
[   26.773595]  ? report_bug+0x25e/0x4b0
[   26.774003]  ? iommufd_fops_release+0x386/0x420
[   26.774494]  ? report_bug+0x2cb/0x4b0
[   26.774899]  ? iommufd_fops_release+0x386/0x420
[   26.775388]  ? iommufd_fops_release+0x386/0x420
[   26.775873]  ? handle_bug+0x2cd/0x510
[   26.776276]  ? iommufd_fops_release+0x388/0x420
[   26.776765]  ? exc_invalid_op+0x3c/0x80
[   26.777186]  ? asm_exc_invalid_op+0x1f/0x30
[   26.777665]  ? iommufd_fops_release+0x21a/0x420
[   26.778209]  ? iommufd_fops_release+0x386/0x420
[   26.778703]  ? iommufd_fops_release+0x386/0x420
[   26.779202]  ? iommufd_fops_release+0x386/0x420
[   26.779697]  ? locks_remove_file+0x3b4/0x5d0
[   26.780168]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.780691]  ? __memcg_slab_free_hook+0xc1/0x540
[   26.781197]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   26.781795]  ? evm_file_release+0x141/0x220
[   26.782253]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.782778]  __fput+0x41c/0xb70
[   26.783140]  ____fput+0x22/0x30
[   26.783492]  task_work_run+0x19b/0x2b0
[   26.783908]  ? __pfx_task_work_run+0x10/0x10
[   26.784375]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   26.784945]  ? switch_task_namespaces+0xc6/0x110
[   26.785471]  do_exit+0xb0e/0x29d0
[   26.785849]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.786383]  ? __pfx_do_exit+0x10/0x10
[   26.786823]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.787350]  ? __x64_sys_ioctl+0x1ba/0x220
[   26.787803]  make_task_dead+0x181/0x3c0
[   26.788238]  rewind_stack_and_make_dead+0x16/0x20
[   26.788743] RIP: 0033:0x7f4a4d03ee5d
[   26.789132] Code: Unable to access opcode bytes at 0x7f4a4d03ee33.
[   26.789797] RSP: 002b:00007ffcd1a15c28 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.790586] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f4a4d03ee5d
[   26.791328] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.792066] RBP: 00007ffcd1a15c40 R08: 0000000000000800 R09: 0000000000000800
[   26.792810] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcd1a15d58
[   26.793566] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f4a4d253000
[   26.794325]  </TASK>
[   26.794577] irq event stamp: 0
[   26.794915] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   26.795567] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   26.796420] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   26.797279] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   26.797953] ---[ end trace 0000000000000000 ]---
[   26.798549] ------------[ cut here ]------------
[   26.799044] WARNING: CPU: 1 PID: 766 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   26.800023] Modules linked in:
[   26.800368] CPU: 1 UID: 0 PID: 766 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.801619] Tainted: [D]=DIE, [W]=WARN
[   26.802028] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.803189] RIP: 0010:iommufd_fops_release+0x392/0x420
[   26.803737] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   26.805633] RSP: 0018:ffff888014eb7c08 EFLAGS: 00010293
[   26.806188] RAX: 0000000000000000 RBX: ffff88801ac36008 RCX: ffffffff83afe4ca
[   26.806926] RDX: ffff88800fada540 RSI: ffffffff83afe642 RDI: ffff88801ac360a0
[   26.807662] RBP: ffff888014eb7cb8 R08: 0000000000000000 R09: 0000000000000000
[   26.808395] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   26.809133] R13: 0000000000000000 R14: ffff888014eb7c50 R15: 0000000000000000
[   26.809891] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   26.810728] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.811335] CR2: 000055dee2f4abbc CR3: 0000000007086002 CR4: 0000000000770ef0
[   26.812073] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.812807] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.813568] PKRU: 55555554
[   26.813899] Call Trace:
[   26.814173]  <TASK>
[   26.814415]  ? show_regs+0x6d/0x80
[   26.814797]  ? __warn+0xf3/0x380
[   26.815159]  ? report_bug+0x25e/0x4b0
[   26.815559]  ? iommufd_fops_release+0x392/0x420
[   26.816053]  ? report_bug+0x2cb/0x4b0
[   26.816459]  ? iommufd_fops_release+0x392/0x420
[   26.816949]  ? iommufd_fops_release+0x392/0x420
[   26.817460]  ? handle_bug+0x2cd/0x510
[   26.817866]  ? iommufd_fops_release+0x394/0x420
[   26.818358]  ? exc_invalid_op+0x3c/0x80
[   26.818787]  ? asm_exc_invalid_op+0x1f/0x30
[   26.819242]  ? iommufd_fops_release+0x21a/0x420
[   26.819735]  ? iommufd_fops_release+0x392/0x420
[   26.820225]  ? iommufd_fops_release+0x392/0x420
[   26.820716]  ? iommufd_fops_release+0x392/0x420
[   26.821207]  ? locks_remove_file+0x3b4/0x5d0
[   26.821699]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.822264]  ? __memcg_slab_free_hook+0xc1/0x540
[   26.822778]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   26.823350]  ? evm_file_release+0x141/0x220
[   26.823804]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.824331]  __fput+0x41c/0xb70
[   26.824688]  ____fput+0x22/0x30
[   26.825039]  task_work_run+0x19b/0x2b0
[   26.825482]  ? __pfx_task_work_run+0x10/0x10
[   26.825987]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   26.826561]  ? switch_task_namespaces+0xc6/0x110
[   26.827066]  do_exit+0xb0e/0x29d0
[   26.827441]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.827973]  ? __pfx_do_exit+0x10/0x10
[   26.828384]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.828889]  ? __x64_sys_ioctl+0x1ba/0x220
[   26.829363]  make_task_dead+0x181/0x3c0
[   26.829838]  rewind_stack_and_make_dead+0x16/0x20
[   26.830341] RIP: 0033:0x7f4a4d03ee5d
[   26.830740] Code: Unable to access opcode bytes at 0x7f4a4d03ee33.
[   26.831381] RSP: 002b:00007ffcd1a15c28 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.832168] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f4a4d03ee5d
[   26.832903] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.833671] RBP: 00007ffcd1a15c40 R08: 0000000000000800 R09: 0000000000000800
[   26.834459] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcd1a15d58
[   26.835201] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f4a4d253000
[   26.835958]  </TASK>
[   26.836210] irq event stamp: 0
[   26.836551] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   26.837217] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   26.838102] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   26.838972] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   26.839634] ---[ end trace 0000000000000000 ]---
[   26.846031] iommufd_mock iommufd_mock36: Adding to iommu group 36
[   26.847191] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#37] SMP KASAN NOPTI
[   26.848458] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   26.849272] CPU: 1 UID: 0 PID: 767 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.850504] Tainted: [D]=DIE, [W]=WARN
[   26.850909] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.852055] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   26.852661] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   26.854501] RSP: 0018:ffff88801ff2fb78 EFLAGS: 00010246
[   26.855055] RAX: dffffc0000000000 RBX: ffff88800de5d400 RCX: 1ffffffff0dd8bdd
[   26.855785] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff888021582d3c
[   26.856519] RBP: ffff88801ff2fbc8 R08: 0000000000000000 R09: 0000000000000000
[   26.857250] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   26.857984] R13: 0000000000000001 R14: ffff88801ff2fe18 R15: ffff888011377808
[   26.858718] FS:  00007f5b27eeb600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   26.859546] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.860145] CR2: 00000000200006c0 CR3: 000000000ea00004 CR4: 0000000000770ef0
[   26.860882] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.861615] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.862349] PKRU: 55555554
[   26.862647] Call Trace:
[   26.862923]  <TASK>
[   26.863168]  ? show_regs+0x6d/0x80
[   26.863551]  ? die_addr+0x45/0xb0
[   26.863923]  ? exc_general_protection+0x1ad/0x340
[   26.864444]  ? asm_exc_general_protection+0x2b/0x30
[   26.864972]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   26.865520]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   26.866074]  iommufd_device_detach+0x2a/0x2e0
[   26.866558]  iommufd_test+0x2f99/0x5cd0
[   26.866985]  ? do_raw_spin_unlock+0x15c/0x210
[   26.867473]  ? __pfx_iommufd_test+0x10/0x10
[   26.867925]  ? debug_smp_processor_id+0x20/0x30
[   26.868421]  ? rcu_is_watching+0x19/0xc0
[   26.868855]  ? lock_release+0x1ea/0x2c0
[   26.869278]  ? __might_fault+0xf1/0x1b0
[   26.869710]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   26.870293]  iommufd_fops_ioctl+0x38e/0x520
[   26.870761]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.871275]  ? trace_irq_enable+0xd1/0x110
[   26.871734]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.872272]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.872785]  __x64_sys_ioctl+0x1ba/0x220
[   26.873221]  x64_sys_call+0x122e/0x2150
[   26.873642]  do_syscall_64+0x6d/0x150
[   26.874051]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   26.874592] RIP: 0033:0x7f5b27c3ee5d
[   26.875048] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   26.876927] RSP: 002b:00007ffcf67ecac8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.877716] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f5b27c3ee5d
[   26.878461] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.879209] RBP: 00007ffcf67ecae0 R08: 0000000000000800 R09: 0000000000000800
[   26.879952] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcf67ecbf8
[   26.880691] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f5b27f34000
[   26.881444]  </TASK>
[   26.881694] Modules linked in:
[   26.882104] ---[ end trace 0000000000000000 ]---
[   26.882636] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   26.883266] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   26.885174] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   26.885790] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   26.886533] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   26.887309] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   26.888060] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   26.888811] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   26.889651] FS:  00007f5b27eeb600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   26.890576] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.891185] CR2: 00000000200006c0 CR3: 000000000ea00004 CR4: 0000000000770ef0
[   26.891930] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.892673] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.893433] PKRU: 55555554
[   26.894401] ------------[ cut here ]------------
[   26.894907] WARNING: CPU: 1 PID: 767 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   26.895898] Modules linked in:
[   26.896244] CPU: 1 UID: 0 PID: 767 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.897501] Tainted: [D]=DIE, [W]=WARN
[   26.897907] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.899082] RIP: 0010:iommufd_fops_release+0x386/0x420
[   26.899635] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   26.901551] RSP: 0018:ffff88801ff2fc08 EFLAGS: 00010293
[   26.902111] RAX: 0000000000000000 RBX: ffff88801ff70008 RCX: ffffffff83afe4ca
[   26.902855] RDX: ffff888021582540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   26.903594] RBP: ffff88801ff2fcb8 R08: 0000000000000000 R09: 0000000000000000
[   26.904334] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   26.905074] R13: 0000000000000000 R14: ffff88801ff2fc50 R15: 0000000000000000
[   26.905835] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   26.906670] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.907283] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   26.908026] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.908765] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.909525] PKRU: 55555554
[   26.909827] Call Trace:
[   26.910101]  <TASK>
[   26.910344]  ? show_regs+0x6d/0x80
[   26.910730]  ? __warn+0xf3/0x380
[   26.911097]  ? report_bug+0x25e/0x4b0
[   26.911504]  ? iommufd_fops_release+0x386/0x420
[   26.911996]  ? report_bug+0x2cb/0x4b0
[   26.912402]  ? iommufd_fops_release+0x386/0x420
[   26.912894]  ? iommufd_fops_release+0x386/0x420
[   26.913463]  ? handle_bug+0x2cd/0x510
[   26.913872]  ? iommufd_fops_release+0x388/0x420
[   26.914363]  ? exc_invalid_op+0x3c/0x80
[   26.914793]  ? asm_exc_invalid_op+0x1f/0x30
[   26.915250]  ? iommufd_fops_release+0x21a/0x420
[   26.915739]  ? iommufd_fops_release+0x386/0x420
[   26.916233]  ? iommufd_fops_release+0x386/0x420
[   26.916727]  ? iommufd_fops_release+0x386/0x420
[   26.917218]  ? locks_remove_file+0x3b4/0x5d0
[   26.917716]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.918243]  ? __memcg_slab_free_hook+0xc1/0x540
[   26.918754]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   26.919328]  ? evm_file_release+0x141/0x220
[   26.919788]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.920311]  __fput+0x41c/0xb70
[   26.920672]  ____fput+0x22/0x30
[   26.921021]  task_work_run+0x19b/0x2b0
[   26.921462]  ? __pfx_task_work_run+0x10/0x10
[   26.921933]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   26.922509]  ? switch_task_namespaces+0xc6/0x110
[   26.923017]  do_exit+0xb0e/0x29d0
[   26.923391]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.923921]  ? __pfx_do_exit+0x10/0x10
[   26.924333]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.924840]  ? __x64_sys_ioctl+0x1ba/0x220
[   26.925286]  make_task_dead+0x181/0x3c0
[   26.925731]  rewind_stack_and_make_dead+0x16/0x20
[   26.926238] RIP: 0033:0x7f5b27c3ee5d
[   26.926631] Code: Unable to access opcode bytes at 0x7f5b27c3ee33.
[   26.927276] RSP: 002b:00007ffcf67ecac8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.928065] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f5b27c3ee5d
[   26.928804] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.929567] RBP: 00007ffcf67ecae0 R08: 0000000000000800 R09: 0000000000000800
[   26.930312] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcf67ecbf8
[   26.931065] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f5b27f34000
[   26.931816]  </TASK>
[   26.932067] irq event stamp: 0
[   26.932403] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   26.933060] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   26.933942] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   26.934808] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   26.935467] ---[ end trace 0000000000000000 ]---
[   26.936034] ------------[ cut here ]------------
[   26.936524] WARNING: CPU: 1 PID: 767 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   26.937534] Modules linked in:
[   26.937880] CPU: 1 UID: 0 PID: 767 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.939118] Tainted: [D]=DIE, [W]=WARN
[   26.939522] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.940686] RIP: 0010:iommufd_fops_release+0x392/0x420
[   26.941237] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   26.943150] RSP: 0018:ffff88801ff2fc08 EFLAGS: 00010293
[   26.943709] RAX: 0000000000000000 RBX: ffff88801ff70008 RCX: ffffffff83afe4ca
[   26.944454] RDX: ffff888021582540 RSI: ffffffff83afe642 RDI: ffff88801ff700a0
[   26.945196] RBP: ffff88801ff2fcb8 R08: 0000000000000000 R09: 0000000000000000
[   26.945955] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   26.946698] R13: 0000000000000000 R14: ffff88801ff2fc50 R15: 0000000000000000
[   26.947446] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   26.948284] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.948890] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   26.949656] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.950402] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   26.951151] PKRU: 55555554
[   26.951451] Call Trace:
[   26.951727]  <TASK>
[   26.951969]  ? show_regs+0x6d/0x80
[   26.952350]  ? __warn+0xf3/0x380
[   26.952714]  ? report_bug+0x25e/0x4b0
[   26.953116]  ? iommufd_fops_release+0x392/0x420
[   26.953630]  ? report_bug+0x2cb/0x4b0
[   26.954037]  ? iommufd_fops_release+0x392/0x420
[   26.954530]  ? iommufd_fops_release+0x392/0x420
[   26.955027]  ? handle_bug+0x2cd/0x510
[   26.955435]  ? iommufd_fops_release+0x394/0x420
[   26.955928]  ? exc_invalid_op+0x3c/0x80
[   26.956352]  ? asm_exc_invalid_op+0x1f/0x30
[   26.956810]  ? iommufd_fops_release+0x21a/0x420
[   26.957303]  ? iommufd_fops_release+0x392/0x420
[   26.957818]  ? iommufd_fops_release+0x392/0x420
[   26.958315]  ? iommufd_fops_release+0x392/0x420
[   26.958814]  ? locks_remove_file+0x3b4/0x5d0
[   26.959286]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.959813]  ? __memcg_slab_free_hook+0xc1/0x540
[   26.960322]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   26.960898]  ? evm_file_release+0x141/0x220
[   26.961385]  ? __pfx_iommufd_fops_release+0x10/0x10
[   26.961916]  __fput+0x41c/0xb70
[   26.962275]  ____fput+0x22/0x30
[   26.962630]  task_work_run+0x19b/0x2b0
[   26.963049]  ? __pfx_task_work_run+0x10/0x10
[   26.963517]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   26.964091]  ? switch_task_namespaces+0xc6/0x110
[   26.964596]  do_exit+0xb0e/0x29d0
[   26.964971]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   26.965526]  ? __pfx_do_exit+0x10/0x10
[   26.965943]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   26.966454]  ? __x64_sys_ioctl+0x1ba/0x220
[   26.966906]  make_task_dead+0x181/0x3c0
[   26.967331]  rewind_stack_and_make_dead+0x16/0x20
[   26.967836] RIP: 0033:0x7f5b27c3ee5d
[   26.968229] Code: Unable to access opcode bytes at 0x7f5b27c3ee33.
[   26.968871] RSP: 002b:00007ffcf67ecac8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   26.969681] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f5b27c3ee5d
[   26.970425] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   26.971169] RBP: 00007ffcf67ecae0 R08: 0000000000000800 R09: 0000000000000800
[   26.971908] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcf67ecbf8
[   26.972650] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f5b27f34000
[   26.973421]  </TASK>
[   26.973674] irq event stamp: 0
[   26.974009] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   26.974667] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   26.975529] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   26.976385] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   26.977041] ---[ end trace 0000000000000000 ]---
[   26.983766] iommufd_mock iommufd_mock37: Adding to iommu group 37
[   26.985079] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#38] SMP KASAN NOPTI
[   26.986311] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   26.987134] CPU: 0 UID: 0 PID: 768 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   26.988492] Tainted: [D]=DIE, [W]=WARN
[   26.988899] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   26.990042] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   26.990656] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   26.992532] RSP: 0018:ffff888014eb7b78 EFLAGS: 00010246
[   26.993091] RAX: dffffc0000000000 RBX: ffff888013e5bc00 RCX: 1ffffffff0dd8bdc
[   26.993832] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff888012f287fc
[   26.994567] RBP: ffff888014eb7bc8 R08: 0000000000000000 R09: 0000000000000000
[   26.995303] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   26.996032] R13: 0000000000000001 R14: ffff888014eb7e18 R15: ffff888013442408
[   26.996765] FS:  00007f1b5bb03600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   26.997596] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   26.998194] CR2: 00000000200006c0 CR3: 0000000017096003 CR4: 0000000000770ef0
[   26.998937] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   26.999674] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.000410] PKRU: 55555554
[   27.000708] Call Trace:
[   27.000980]  <TASK>
[   27.001226]  ? show_regs+0x6d/0x80
[   27.001611]  ? die_addr+0x45/0xb0
[   27.001981]  ? exc_general_protection+0x1ad/0x340
[   27.002511]  ? asm_exc_general_protection+0x2b/0x30
[   27.003087]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.003680]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   27.004272]  iommufd_device_detach+0x2a/0x2e0
[   27.004771]  iommufd_test+0x2f99/0x5cd0
[   27.005222]  ? do_raw_spin_unlock+0x15c/0x210
[   27.005740]  ? __pfx_iommufd_test+0x10/0x10
[   27.006221]  ? debug_smp_processor_id+0x20/0x30
[   27.006743]  ? rcu_is_watching+0x19/0xc0
[   27.007229]  ? lock_release+0x1ea/0x2c0
[   27.007668]  ? __might_fault+0xf1/0x1b0
[   27.008115]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   27.008808]  iommufd_fops_ioctl+0x38e/0x520
[   27.009282]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.009817]  ? trace_irq_enable+0xd1/0x110
[   27.010295]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.010868]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.011415]  __x64_sys_ioctl+0x1ba/0x220
[   27.011881]  x64_sys_call+0x122e/0x2150
[   27.012323]  do_syscall_64+0x6d/0x150
[   27.012757]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   27.013363] RIP: 0033:0x7f1b5b83ee5d
[   27.013791] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   27.015808] RSP: 002b:00007ffdb1b46be8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.016652] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f1b5b83ee5d
[   27.017466] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.018261] RBP: 00007ffdb1b46c00 R08: 0000000000000800 R09: 0000000000000800
[   27.019043] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffdb1b46d18
[   27.019826] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f1b5bb4c000
[   27.020591]  </TASK>
[   27.020854] Modules linked in:
[   27.021379] ---[ end trace 0000000000000000 ]---
[   27.021964] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.022574] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   27.024536] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   27.025100] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   27.025912] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   27.026720] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   27.027780] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   27.028801] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   27.029605] FS:  00007f1b5bb03600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.030679] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.031294] CR2: 00000000200006c0 CR3: 0000000017096003 CR4: 0000000000770ef0
[   27.032223] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.032984] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.033942] PKRU: 55555554
[   27.035551] ------------[ cut here ]------------
[   27.036049] WARNING: CPU: 0 PID: 768 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   27.037194] Modules linked in:
[   27.037573] CPU: 0 UID: 0 PID: 768 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.038960] Tainted: [D]=DIE, [W]=WARN
[   27.039364] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.040660] RIP: 0010:iommufd_fops_release+0x386/0x420
[   27.041228] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   27.043305] RSP: 0018:ffff888014eb7c08 EFLAGS: 00010293
[   27.043866] RAX: 0000000000000000 RBX: ffff88801ac32808 RCX: ffffffff83afe4ca
[   27.044604] RDX: ffff888012f28000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   27.045365] RBP: ffff888014eb7cb8 R08: 0000000000000000 R09: 0000000000000000
[   27.046107] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   27.046850] R13: 0000000000000000 R14: ffff888014eb7c50 R15: 0000000000000000
[   27.047580] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.048411] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.049015] CR2: 00000000200006c0 CR3: 0000000007086006 CR4: 0000000000770ef0
[   27.049783] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.050551] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.051293] PKRU: 55555554
[   27.051591] Call Trace:
[   27.051863]  <TASK>
[   27.052111]  ? show_regs+0x6d/0x80
[   27.052493]  ? __warn+0xf3/0x380
[   27.052852]  ? report_bug+0x25e/0x4b0
[   27.053264]  ? iommufd_fops_release+0x386/0x420
[   27.053774]  ? report_bug+0x2cb/0x4b0
[   27.054182]  ? iommufd_fops_release+0x386/0x420
[   27.054674]  ? iommufd_fops_release+0x386/0x420
[   27.055170]  ? handle_bug+0x2cd/0x510
[   27.055580]  ? iommufd_fops_release+0x388/0x420
[   27.056071]  ? exc_invalid_op+0x3c/0x80
[   27.056498]  ? asm_exc_invalid_op+0x1f/0x30
[   27.056956]  ? iommufd_fops_release+0x21a/0x420
[   27.057488]  ? iommufd_fops_release+0x386/0x420
[   27.057982]  ? iommufd_fops_release+0x386/0x420
[   27.058472]  ? iommufd_fops_release+0x386/0x420
[   27.058967]  ? locks_remove_file+0x3b4/0x5d0
[   27.059440]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.059961]  ? __memcg_slab_free_hook+0xc1/0x540
[   27.060460]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   27.061027]  ? evm_file_release+0x141/0x220
[   27.061510]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.062114]  __fput+0x41c/0xb70
[   27.062471]  ____fput+0x22/0x30
[   27.062837]  task_work_run+0x19b/0x2b0
[   27.063248]  ? __pfx_task_work_run+0x10/0x10
[   27.063712]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   27.064280]  ? switch_task_namespaces+0xc6/0x110
[   27.064779]  do_exit+0xb0e/0x29d0
[   27.065149]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.065701]  ? __pfx_do_exit+0x10/0x10
[   27.066114]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.066618]  ? __x64_sys_ioctl+0x1ba/0x220
[   27.067070]  make_task_dead+0x181/0x3c0
[   27.067490]  rewind_stack_and_make_dead+0x16/0x20
[   27.067990] RIP: 0033:0x7f1b5b83ee5d
[   27.068381] Code: Unable to access opcode bytes at 0x7f1b5b83ee33.
[   27.069023] RSP: 002b:00007ffdb1b46be8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.069820] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f1b5b83ee5d
[   27.070557] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.071302] RBP: 00007ffdb1b46c00 R08: 0000000000000800 R09: 0000000000000800
[   27.072048] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffdb1b46d18
[   27.072778] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f1b5bb4c000
[   27.073549]  </TASK>
[   27.073804] irq event stamp: 0
[   27.074143] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   27.074811] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   27.075669] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   27.076529] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   27.077180] ---[ end trace 0000000000000000 ]---
[   27.077785] ------------[ cut here ]------------
[   27.078287] WARNING: CPU: 0 PID: 768 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   27.079285] Modules linked in:
[   27.079643] CPU: 0 UID: 0 PID: 768 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.080849] Tainted: [D]=DIE, [W]=WARN
[   27.081246] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.082415] RIP: 0010:iommufd_fops_release+0x392/0x420
[   27.082969] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   27.084837] RSP: 0018:ffff888014eb7c08 EFLAGS: 00010293
[   27.085410] RAX: 0000000000000000 RBX: ffff88801ac32808 RCX: ffffffff83afe4ca
[   27.086153] RDX: ffff888012f28000 RSI: ffffffff83afe642 RDI: ffff88801ac328a0
[   27.086902] RBP: ffff888014eb7cb8 R08: 0000000000000000 R09: 0000000000000000
[   27.087644] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   27.088377] R13: 0000000000000000 R14: ffff888014eb7c50 R15: 0000000000000000
[   27.089114] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.089960] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.090565] CR2: 00000000200006c0 CR3: 0000000007086006 CR4: 0000000000770ef0
[   27.091306] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.092040] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.092772] PKRU: 55555554
[   27.093071] Call Trace:
[   27.093370]  <TASK>
[   27.093617]  ? show_regs+0x6d/0x80
[   27.094000]  ? __warn+0xf3/0x380
[   27.094373]  ? report_bug+0x25e/0x4b0
[   27.094776]  ? iommufd_fops_release+0x392/0x420
[   27.095265]  ? report_bug+0x2cb/0x4b0
[   27.095668]  ? iommufd_fops_release+0x392/0x420
[   27.096160]  ? iommufd_fops_release+0x392/0x420
[   27.096674]  ? handle_bug+0x2cd/0x510
[   27.097090]  ? iommufd_fops_release+0x394/0x420
[   27.097627]  ? exc_invalid_op+0x3c/0x80
[   27.098051]  ? asm_exc_invalid_op+0x1f/0x30
[   27.098507]  ? iommufd_fops_release+0x21a/0x420
[   27.099005]  ? iommufd_fops_release+0x392/0x420
[   27.099498]  ? iommufd_fops_release+0x392/0x420
[   27.099989]  ? iommufd_fops_release+0x392/0x420
[   27.100477]  ? locks_remove_file+0x3b4/0x5d0
[   27.100946]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.101487]  ? __memcg_slab_free_hook+0xc1/0x540
[   27.101987]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   27.102559]  ? evm_file_release+0x141/0x220
[   27.103020]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.103542]  __fput+0x41c/0xb70
[   27.103900]  ____fput+0x22/0x30
[   27.104250]  task_work_run+0x19b/0x2b0
[   27.104668]  ? __pfx_task_work_run+0x10/0x10
[   27.105136]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   27.105732]  ? switch_task_namespaces+0xc6/0x110
[   27.106235]  do_exit+0xb0e/0x29d0
[   27.106612]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.107153]  ? __pfx_do_exit+0x10/0x10
[   27.107567]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.108073]  ? __x64_sys_ioctl+0x1ba/0x220
[   27.108520]  make_task_dead+0x181/0x3c0
[   27.108943]  rewind_stack_and_make_dead+0x16/0x20
[   27.109474] RIP: 0033:0x7f1b5b83ee5d
[   27.109871] Code: Unable to access opcode bytes at 0x7f1b5b83ee33.
[   27.110508] RSP: 002b:00007ffdb1b46be8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.111297] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f1b5b83ee5d
[   27.112030] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.112758] RBP: 00007ffdb1b46c00 R08: 0000000000000800 R09: 0000000000000800
[   27.113512] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffdb1b46d18
[   27.114248] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f1b5bb4c000
[   27.114991]  </TASK>
[   27.115240] irq event stamp: 0
[   27.115575] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   27.116229] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   27.117080] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   27.117949] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   27.118607] ---[ end trace 0000000000000000 ]---
[   27.130074] iommufd_mock iommufd_mock38: Adding to iommu group 38
[   27.131129] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#39] SMP KASAN NOPTI
[   27.132268] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   27.133041] CPU: 1 UID: 0 PID: 769 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.134277] Tainted: [D]=DIE, [W]=WARN
[   27.134780] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.135958] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.136644] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   27.138601] RSP: 0018:ffff88801f33fb78 EFLAGS: 00010246
[   27.139165] RAX: dffffc0000000000 RBX: ffff88800de5d800 RCX: 1ffffffff0dd8bdd
[   27.139978] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff888012f2d27c
[   27.140721] RBP: ffff88801f33fbc8 R08: 0000000000000000 R09: 0000000000000000
[   27.141544] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   27.142352] R13: 0000000000000001 R14: ffff88801f33fe18 R15: ffff8880129b7408
[   27.143095] FS:  00007fdccc774600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   27.144011] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.144616] CR2: 00000000200006c0 CR3: 000000000fdde002 CR4: 0000000000770ef0
[   27.145390] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.146173] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.146936] PKRU: 55555554
[   27.147287] Call Trace:
[   27.147561]  <TASK>
[   27.147810]  ? show_regs+0x6d/0x80
[   27.148229]  ? die_addr+0x45/0xb0
[   27.148643]  ? exc_general_protection+0x1ad/0x340
[   27.149169]  ? asm_exc_general_protection+0x2b/0x30
[   27.149712]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.150357]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   27.150917]  iommufd_device_detach+0x2a/0x2e0
[   27.151425]  iommufd_test+0x2f99/0x5cd0
[   27.151893]  ? do_raw_spin_unlock+0x15c/0x210
[   27.152385]  ? __pfx_iommufd_test+0x10/0x10
[   27.152857]  ? debug_smp_processor_id+0x20/0x30
[   27.153403]  ? rcu_is_watching+0x19/0xc0
[   27.153841]  ? lock_release+0x1ea/0x2c0
[   27.154266]  ? __might_fault+0xf1/0x1b0
[   27.154772]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   27.155354]  iommufd_fops_ioctl+0x38e/0x520
[   27.155901]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.156419]  ? trace_irq_enable+0xd1/0x110
[   27.156879]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.157499]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.158013]  __x64_sys_ioctl+0x1ba/0x220
[   27.158448]  x64_sys_call+0x122e/0x2150
[   27.158912]  do_syscall_64+0x6d/0x150
[   27.159332]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   27.159874] RIP: 0033:0x7fdccc43ee5d
[   27.160291] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   27.162289] RSP: 002b:00007fff58cb7df8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.163081] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fdccc43ee5d
[   27.163896] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.164630] RBP: 00007fff58cb7e10 R08: 0000000000000800 R09: 0000000000000800
[   27.165450] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff58cb7f28
[   27.166185] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fdccc7bd000
[   27.167042]  </TASK>
[   27.167293] Modules linked in:
[   27.167824] ---[ end trace 0000000000000000 ]---
[   27.168323] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.169025] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   27.171094] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   27.171710] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   27.172550] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   27.173461] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   27.174273] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   27.175161] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   27.175917] FS:  00007fdccc774600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   27.176854] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.177595] CR2: 00000000200006c0 CR3: 000000000fdde002 CR4: 0000000000770ef0
[   27.178419] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.179174] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.180025] PKRU: 55555554
[   27.181872] ------------[ cut here ]------------
[   27.182400] WARNING: CPU: 0 PID: 769 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   27.183417] Modules linked in:
[   27.183770] CPU: 0 UID: 0 PID: 769 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.185043] Tainted: [D]=DIE, [W]=WARN
[   27.185459] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.186602] RIP: 0010:iommufd_fops_release+0x386/0x420
[   27.187152] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   27.189001] RSP: 0018:ffff88801f33fc08 EFLAGS: 00010293
[   27.189773] RAX: 0000000000000000 RBX: ffff88801ff76808 RCX: ffffffff83afe4ca
[   27.190507] RDX: ffff888012f2ca80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   27.191243] RBP: ffff88801f33fcb8 R08: 0000000000000000 R09: 0000000000000000
[   27.191970] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   27.192698] R13: 0000000000000000 R14: ffff88801f33fc50 R15: 0000000000000000
[   27.193532] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.194356] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.194958] CR2: 00007f0824480000 CR3: 0000000007086006 CR4: 0000000000770ef0
[   27.195688] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.196464] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.197210] PKRU: 55555554
[   27.197584] Call Trace:
[   27.197865]  <TASK>
[   27.198106]  ? show_regs+0x6d/0x80
[   27.198491]  ? __warn+0xf3/0x380
[   27.198864]  ? report_bug+0x25e/0x4b0
[   27.199275]  ? iommufd_fops_release+0x386/0x420
[   27.199773]  ? report_bug+0x2cb/0x4b0
[   27.200188]  ? iommufd_fops_release+0x386/0x420
[   27.200689]  ? iommufd_fops_release+0x386/0x420
[   27.201184]  ? handle_bug+0x2cd/0x510
[   27.201658]  ? iommufd_fops_release+0x388/0x420
[   27.202162]  ? exc_invalid_op+0x3c/0x80
[   27.202588]  ? asm_exc_invalid_op+0x1f/0x30
[   27.203054]  ? iommufd_fops_release+0x21a/0x420
[   27.203547]  ? iommufd_fops_release+0x386/0x420
[   27.204043]  ? iommufd_fops_release+0x386/0x420
[   27.204538]  ? iommufd_fops_release+0x386/0x420
[   27.205030]  ? locks_remove_file+0x3b4/0x5d0
[   27.205525]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.206055]  ? __memcg_slab_free_hook+0xc1/0x540
[   27.206563]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   27.207147]  ? evm_file_release+0x141/0x220
[   27.207607]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.208130]  __fput+0x41c/0xb70
[   27.208492]  ____fput+0x22/0x30
[   27.208847]  task_work_run+0x19b/0x2b0
[   27.209269]  ? __pfx_task_work_run+0x10/0x10
[   27.209758]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   27.210336]  ? switch_task_namespaces+0xc6/0x110
[   27.210850]  do_exit+0xb0e/0x29d0
[   27.211226]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.211776]  ? __pfx_do_exit+0x10/0x10
[   27.212419]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.212933]  ? __x64_sys_ioctl+0x1ba/0x220
[   27.213411]  make_task_dead+0x181/0x3c0
[   27.213848]  rewind_stack_and_make_dead+0x16/0x20
[   27.214358] RIP: 0033:0x7fdccc43ee5d
[   27.214769] Code: Unable to access opcode bytes at 0x7fdccc43ee33.
[   27.215417] RSP: 002b:00007fff58cb7df8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.216214] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fdccc43ee5d
[   27.216961] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.217732] RBP: 00007fff58cb7e10 R08: 0000000000000800 R09: 0000000000000800
[   27.218476] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff58cb7f28
[   27.219223] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fdccc7bd000
[   27.219974]  </TASK>
[   27.220226] irq event stamp: 0
[   27.220563] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   27.221224] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   27.222105] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   27.222972] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   27.223635] ---[ end trace 0000000000000000 ]---
[   27.224206] ------------[ cut here ]------------
[   27.224702] WARNING: CPU: 0 PID: 769 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   27.225714] Modules linked in:
[   27.226078] CPU: 0 UID: 0 PID: 769 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.227318] Tainted: [D]=DIE, [W]=WARN
[   27.227764] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.228935] RIP: 0010:iommufd_fops_release+0x392/0x420
[   27.229512] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   27.231413] RSP: 0018:ffff88801f33fc08 EFLAGS: 00010293
[   27.231987] RAX: 0000000000000000 RBX: ffff88801ff76808 RCX: ffffffff83afe4ca
[   27.232449] RDX: ffff888012f2ca80 RSI: ffffffff83afe642 RDI: ffff88801ff768a0
[   27.232869] RBP: ffff88801f33fcb8 R08: 0000000000000000 R09: 0000000000000000
[   27.233289] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   27.233728] R13: 0000000000000000 R14: ffff88801f33fc50 R15: 0000000000000000
[   27.234101] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.234509] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.234810] CR2: 00007f0824480000 CR3: 0000000007086006 CR4: 0000000000770ef0
[   27.235173] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.235532] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.235890] PKRU: 55555554
[   27.236036] Call Trace:
[   27.236170]  <TASK>
[   27.236289]  ? show_regs+0x6d/0x80
[   27.236476]  ? __warn+0xf3/0x380
[   27.236653]  ? report_bug+0x25e/0x4b0
[   27.236851]  ? iommufd_fops_release+0x392/0x420
[   27.237091]  ? report_bug+0x2cb/0x4b0
[   27.237286]  ? iommufd_fops_release+0x392/0x420
[   27.237538]  ? iommufd_fops_release+0x392/0x420
[   27.237779]  ? handle_bug+0x2cd/0x510
[   27.237977]  ? iommufd_fops_release+0x394/0x420
[   27.238218]  ? exc_invalid_op+0x3c/0x80
[   27.238424]  ? asm_exc_invalid_op+0x1f/0x30
[   27.238646]  ? iommufd_fops_release+0x21a/0x420
[   27.238890]  ? iommufd_fops_release+0x392/0x420
[   27.239130]  ? iommufd_fops_release+0x392/0x420
[   27.239369]  ? iommufd_fops_release+0x392/0x420
[   27.239611]  ? locks_remove_file+0x3b4/0x5d0
[   27.239843]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.240102]  ? __memcg_slab_free_hook+0xc1/0x540
[   27.240350]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   27.240633]  ? evm_file_release+0x141/0x220
[   27.240858]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.241119]  __fput+0x41c/0xb70
[   27.241295]  ____fput+0x22/0x30
[   27.241483]  task_work_run+0x19b/0x2b0
[   27.241692]  ? __pfx_task_work_run+0x10/0x10
[   27.241922]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   27.242206]  ? switch_task_namespaces+0xc6/0x110
[   27.242455]  do_exit+0xb0e/0x29d0
[   27.242641]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.242908]  ? __pfx_do_exit+0x10/0x10
[   27.243136]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.243387]  ? __x64_sys_ioctl+0x1ba/0x220
[   27.243608]  make_task_dead+0x181/0x3c0
[   27.243818]  rewind_stack_and_make_dead+0x16/0x20
[   27.244068] RIP: 0033:0x7fdccc43ee5d
[   27.244262] Code: Unable to access opcode bytes at 0x7fdccc43ee33.
[   27.244579] RSP: 002b:00007fff58cb7df8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.244968] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fdccc43ee5d
[   27.245346] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.245716] RBP: 00007fff58cb7e10 R08: 0000000000000800 R09: 0000000000000800
[   27.246082] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff58cb7f28
[   27.246448] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fdccc7bd000
[   27.246822]  </TASK>
[   27.246949] irq event stamp: 0
[   27.247119] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   27.247454] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   27.247887] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   27.248321] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   27.248653] ---[ end trace 0000000000000000 ]---
[   27.253291] iommufd_mock iommufd_mock39: Adding to iommu group 39
[   27.254061] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#40] SMP KASAN NOPTI
[   27.254656] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   27.255064] CPU: 0 UID: 0 PID: 770 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.255767] Tainted: [D]=DIE, [W]=WARN
[   27.255971] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.256558] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.256879] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   27.257828] RSP: 0018:ffff8880123efb78 EFLAGS: 00010246
[   27.258108] RAX: dffffc0000000000 RBX: ffff888013e5b600 RCX: 1ffffffff0dd8bdc
[   27.258479] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880215907fc
[   27.258905] RBP: ffff8880123efbc8 R08: 0000000000000000 R09: 0000000000000000
[   27.259282] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   27.259656] R13: 0000000000000001 R14: ffff8880123efe18 R15: ffff888010e20c08
[   27.260030] FS:  00007f8f73617600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.260448] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.260756] CR2: 00000000200006c0 CR3: 000000000fdde001 CR4: 0000000000770ef0
[   27.261129] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.261502] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.261873] PKRU: 55555554
[   27.262023] Call Trace:
[   27.262162]  <TASK>
[   27.262285]  ? show_regs+0x6d/0x80
[   27.262479]  ? die_addr+0x45/0xb0
[   27.262667]  ? exc_general_protection+0x1ad/0x340
[   27.262935]  ? asm_exc_general_protection+0x2b/0x30
[   27.263203]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.263479]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   27.263755]  iommufd_device_detach+0x2a/0x2e0
[   27.263998]  iommufd_test+0x2f99/0x5cd0
[   27.264210]  ? do_raw_spin_unlock+0x15c/0x210
[   27.264453]  ? __pfx_iommufd_test+0x10/0x10
[   27.264737]  ? debug_smp_processor_id+0x20/0x30
[   27.264998]  ? rcu_is_watching+0x19/0xc0
[   27.265224]  ? lock_release+0x1ea/0x2c0
[   27.265444]  ? __might_fault+0xf1/0x1b0
[   27.265667]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   27.265967]  iommufd_fops_ioctl+0x38e/0x520
[   27.266205]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.266471]  ? trace_irq_enable+0xd1/0x110
[   27.266715]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.266994]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.267261]  __x64_sys_ioctl+0x1ba/0x220
[   27.267488]  x64_sys_call+0x122e/0x2150
[   27.267706]  do_syscall_64+0x6d/0x150
[   27.267919]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   27.268207] RIP: 0033:0x7f8f7343ee5d
[   27.268411] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   27.269382] RSP: 002b:00007ffcf5459178 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.269790] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f8f7343ee5d
[   27.270170] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.270552] RBP: 00007ffcf5459190 R08: 0000000000000800 R09: 0000000000000800
[   27.270938] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcf54592a8
[   27.271320] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f8f73660000
[   27.271708]  </TASK>
[   27.271836] Modules linked in:
[   27.272129] ---[ end trace 0000000000000000 ]---
[   27.272388] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.272710] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   27.273749] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   27.274041] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   27.274428] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   27.274821] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   27.275204] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   27.275588] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   27.275971] FS:  00007f8f73617600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.276403] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.276716] CR2: 00000000200006c0 CR3: 000000000fdde001 CR4: 0000000000770ef0
[   27.277099] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.277516] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.277901] PKRU: 55555554
[   27.278948] ------------[ cut here ]------------
[   27.279232] WARNING: CPU: 0 PID: 770 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   27.279850] Modules linked in:
[   27.280034] CPU: 0 UID: 0 PID: 770 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.280680] Tainted: [D]=DIE, [W]=WARN
[   27.280892] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.281510] RIP: 0010:iommufd_fops_release+0x386/0x420
[   27.281797] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   27.282776] RSP: 0018:ffff8880123efc08 EFLAGS: 00010293
[   27.283064] RAX: 0000000000000000 RBX: ffff888021439808 RCX: ffffffff83afe4ca
[   27.283445] RDX: ffff888021590000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   27.283828] RBP: ffff8880123efcb8 R08: 0000000000000000 R09: 0000000000000000
[   27.284210] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   27.284592] R13: 0000000000000000 R14: ffff8880123efc50 R15: 0000000000000000
[   27.284974] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.285422] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.285738] CR2: 00000000200006c0 CR3: 0000000007086004 CR4: 0000000000770ef0
[   27.286121] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.286502] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.286891] PKRU: 55555554
[   27.287051] Call Trace:
[   27.287196]  <TASK>
[   27.287325]  ? show_regs+0x6d/0x80
[   27.287529]  ? __warn+0xf3/0x380
[   27.287723]  ? report_bug+0x25e/0x4b0
[   27.287939]  ? iommufd_fops_release+0x386/0x420
[   27.288201]  ? report_bug+0x2cb/0x4b0
[   27.288415]  ? iommufd_fops_release+0x386/0x420
[   27.288676]  ? iommufd_fops_release+0x386/0x420
[   27.288937]  ? handle_bug+0x2cd/0x510
[   27.289152]  ? iommufd_fops_release+0x388/0x420
[   27.289427]  ? exc_invalid_op+0x3c/0x80
[   27.289654]  ? asm_exc_invalid_op+0x1f/0x30
[   27.289896]  ? iommufd_fops_release+0x21a/0x420
[   27.290160]  ? iommufd_fops_release+0x386/0x420
[   27.290422]  ? iommufd_fops_release+0x386/0x420
[   27.290684]  ? iommufd_fops_release+0x386/0x420
[   27.290946]  ? locks_remove_file+0x3b4/0x5d0
[   27.291197]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.291475]  ? __memcg_slab_free_hook+0xc1/0x540
[   27.291742]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   27.292048]  ? evm_file_release+0x141/0x220
[   27.292301]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.292579]  __fput+0x41c/0xb70
[   27.292770]  ____fput+0x22/0x30
[   27.292958]  task_work_run+0x19b/0x2b0
[   27.293181]  ? __pfx_task_work_run+0x10/0x10
[   27.293444]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   27.293748]  ? switch_task_namespaces+0xc6/0x110
[   27.294016]  do_exit+0xb0e/0x29d0
[   27.294216]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.294505]  ? __pfx_do_exit+0x10/0x10
[   27.294727]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.294998]  ? __x64_sys_ioctl+0x1ba/0x220
[   27.295236]  make_task_dead+0x181/0x3c0
[   27.295462]  rewind_stack_and_make_dead+0x16/0x20
[   27.295730] RIP: 0033:0x7f8f7343ee5d
[   27.295939] Code: Unable to access opcode bytes at 0x7f8f7343ee33.
[   27.296281] RSP: 002b:00007ffcf5459178 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.296703] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f8f7343ee5d
[   27.297131] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.297586] RBP: 00007ffcf5459190 R08: 0000000000000800 R09: 0000000000000800
[   27.298022] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcf54592a8
[   27.298427] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f8f73660000
[   27.298832]  </TASK>
[   27.298968] irq event stamp: 0
[   27.299149] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   27.299502] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   27.299965] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   27.300420] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   27.300776] ---[ end trace 0000000000000000 ]---
[   27.301084] ------------[ cut here ]------------
[   27.301361] WARNING: CPU: 0 PID: 770 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   27.301954] Modules linked in:
[   27.302137] CPU: 0 UID: 0 PID: 770 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.302789] Tainted: [D]=DIE, [W]=WARN
[   27.303003] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.303619] RIP: 0010:iommufd_fops_release+0x392/0x420
[   27.303911] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   27.304906] RSP: 0018:ffff8880123efc08 EFLAGS: 00010293
[   27.305202] RAX: 0000000000000000 RBX: ffff888021439808 RCX: ffffffff83afe4ca
[   27.305608] RDX: ffff888021590000 RSI: ffffffff83afe642 RDI: ffff8880214398a0
[   27.306009] RBP: ffff8880123efcb8 R08: 0000000000000000 R09: 0000000000000000
[   27.306402] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   27.306798] R13: 0000000000000000 R14: ffff8880123efc50 R15: 0000000000000000
[   27.307190] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.307627] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.307944] CR2: 00000000200006c0 CR3: 0000000007086004 CR4: 0000000000770ef0
[   27.308336] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.308729] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.309131] PKRU: 55555554
[   27.309342] Call Trace:
[   27.309493]  <TASK>
[   27.309623]  ? show_regs+0x6d/0x80
[   27.309828]  ? __warn+0xf3/0x380
[   27.310022]  ? report_bug+0x25e/0x4b0
[   27.310236]  ? iommufd_fops_release+0x392/0x420
[   27.310497]  ? report_bug+0x2cb/0x4b0
[   27.310719]  ? iommufd_fops_release+0x392/0x420
[   27.310982]  ? iommufd_fops_release+0x392/0x420
[   27.311242]  ? handle_bug+0x2cd/0x510
[   27.311458]  ? iommufd_fops_release+0x394/0x420
[   27.311721]  ? exc_invalid_op+0x3c/0x80
[   27.311947]  ? asm_exc_invalid_op+0x1f/0x30
[   27.312191]  ? iommufd_fops_release+0x21a/0x420
[   27.312452]  ? iommufd_fops_release+0x392/0x420
[   27.312713]  ? iommufd_fops_release+0x392/0x420
[   27.312974]  ? iommufd_fops_release+0x392/0x420
[   27.313234]  ? locks_remove_file+0x3b4/0x5d0
[   27.313506]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.313787]  ? __memcg_slab_free_hook+0xc1/0x540
[   27.314053]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   27.314359]  ? evm_file_release+0x141/0x220
[   27.314602]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.314885]  __fput+0x41c/0xb70
[   27.315076]  ____fput+0x22/0x30
[   27.315264]  task_work_run+0x19b/0x2b0
[   27.315485]  ? __pfx_task_work_run+0x10/0x10
[   27.315734]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   27.316038]  ? switch_task_namespaces+0xc6/0x110
[   27.316306]  do_exit+0xb0e/0x29d0
[   27.316505]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.316788]  ? __pfx_do_exit+0x10/0x10
[   27.317008]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.317278]  ? __x64_sys_ioctl+0x1ba/0x220
[   27.317529]  make_task_dead+0x181/0x3c0
[   27.317755]  rewind_stack_and_make_dead+0x16/0x20
[   27.318024] RIP: 0033:0x7f8f7343ee5d
[   27.318233] Code: Unable to access opcode bytes at 0x7f8f7343ee33.
[   27.318582] RSP: 002b:00007ffcf5459178 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.319015] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f8f7343ee5d
[   27.319417] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.319819] RBP: 00007ffcf5459190 R08: 0000000000000800 R09: 0000000000000800
[   27.320223] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcf54592a8
[   27.320627] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f8f73660000
[   27.321035]  </TASK>
[   27.321172] irq event stamp: 0
[   27.321370] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   27.321743] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   27.322211] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   27.322677] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   27.323041] ---[ end trace 0000000000000000 ]---
[   27.328168] iommufd_mock iommufd_mock40: Adding to iommu group 40
[   27.328968] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#41] SMP KASAN NOPTI
[   27.329656] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   27.330125] CPU: 0 UID: 0 PID: 771 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.330834] Tainted: [D]=DIE, [W]=WARN
[   27.331054] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.331799] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.332140] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   27.333180] RSP: 0018:ffff888012a3fb78 EFLAGS: 00010246
[   27.333489] RAX: dffffc0000000000 RBX: ffff888013e5be00 RCX: 1ffffffff0dd8bdc
[   27.333894] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88802158527c
[   27.334299] RBP: ffff888012a3fbc8 R08: 0000000000000000 R09: 0000000000000000
[   27.334703] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   27.335113] R13: 0000000000000001 R14: ffff888012a3fe18 R15: ffff888010e23808
[   27.335523] FS:  00007fcdb5d1b600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.335984] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.336317] CR2: 00000000200006c0 CR3: 0000000012098003 CR4: 0000000000770ef0
[   27.336727] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.337130] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.337540] PKRU: 55555554
[   27.337704] Call Trace:
[   27.337855]  <TASK>
[   27.337990]  ? show_regs+0x6d/0x80
[   27.338202]  ? die_addr+0x45/0xb0
[   27.338405]  ? exc_general_protection+0x1ad/0x340
[   27.338693]  ? asm_exc_general_protection+0x2b/0x30
[   27.338987]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.339288]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   27.339595]  iommufd_device_detach+0x2a/0x2e0
[   27.339863]  iommufd_test+0x2f99/0x5cd0
[   27.340097]  ? do_raw_spin_unlock+0x15c/0x210
[   27.340363]  ? __pfx_iommufd_test+0x10/0x10
[   27.340612]  ? debug_smp_processor_id+0x20/0x30
[   27.340885]  ? rcu_is_watching+0x19/0xc0
[   27.341123]  ? lock_release+0x1ea/0x2c0
[   27.341359]  ? __might_fault+0xf1/0x1b0
[   27.341595]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   27.341914]  iommufd_fops_ioctl+0x38e/0x520
[   27.342164]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.342445]  ? trace_irq_enable+0xd1/0x110
[   27.342696]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.342996]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.343275]  __x64_sys_ioctl+0x1ba/0x220
[   27.343513]  x64_sys_call+0x122e/0x2150
[   27.343742]  do_syscall_64+0x6d/0x150
[   27.343967]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   27.344264] RIP: 0033:0x7fcdb5a3ee5d
[   27.344479] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   27.345520] RSP: 002b:00007ffd1244d4f8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.345946] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fcdb5a3ee5d
[   27.346354] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.346763] RBP: 00007ffd1244d510 R08: 0000000000000800 R09: 0000000000000800
[   27.347169] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd1244d628
[   27.347574] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fcdb5d64000
[   27.347989]  </TASK>
[   27.348125] Modules linked in:
[   27.348397] ---[ end trace 0000000000000000 ]---
[   27.348682] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.349048] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   27.350181] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   27.350508] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   27.350928] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   27.351336] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   27.351758] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   27.352187] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   27.352597] FS:  00007fcdb5d1b600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.353077] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.353452] CR2: 00000000200006c0 CR3: 0000000012098003 CR4: 0000000000770ef0
[   27.353889] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.354294] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.354702] PKRU: 55555554
[   27.355473] ------------[ cut here ]------------
[   27.355766] WARNING: CPU: 0 PID: 771 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   27.356350] Modules linked in:
[   27.356563] CPU: 0 UID: 0 PID: 771 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.357428] Tainted: [D]=DIE, [W]=WARN
[   27.357652] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.358434] RIP: 0010:iommufd_fops_release+0x386/0x420
[   27.358756] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   27.359970] RSP: 0018:ffff888012a3fc08 EFLAGS: 00010293
[   27.360302] RAX: 0000000000000000 RBX: ffff88802143a808 RCX: ffffffff83afe4ca
[   27.360742] RDX: ffff888021584a80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   27.361278] RBP: ffff888012a3fcb8 R08: 0000000000000000 R09: 0000000000000000
[   27.361901] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   27.362383] R13: 0000000000000000 R14: ffff888012a3fc50 R15: 0000000000000000
[   27.362950] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.363476] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.363910] CR2: 00000000200006c0 CR3: 0000000007086006 CR4: 0000000000770ef0
[   27.364473] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.364902] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.365452] PKRU: 55555554
[   27.365626] Call Trace:
[   27.365785]  <TASK>
[   27.365925]  ? show_regs+0x6d/0x80
[   27.366191]  ? __warn+0xf3/0x380
[   27.366487]  ? report_bug+0x25e/0x4b0
[   27.366737]  ? iommufd_fops_release+0x386/0x420
[   27.367122]  ? report_bug+0x2cb/0x4b0
[   27.367358]  ? iommufd_fops_release+0x386/0x420
[   27.367677]  ? iommufd_fops_release+0x386/0x420
[   27.368057]  ? handle_bug+0x2cd/0x510
[   27.368302]  ? iommufd_fops_release+0x388/0x420
[   27.368687]  ? exc_invalid_op+0x3c/0x80
[   27.368937]  ? asm_exc_invalid_op+0x1f/0x30
[   27.369227]  ? iommufd_fops_release+0x21a/0x420
[   27.369622]  ? iommufd_fops_release+0x386/0x420
[   27.369908]  ? iommufd_fops_release+0x386/0x420
[   27.370195]  ? iommufd_fops_release+0x386/0x420
[   27.370513]  ? locks_remove_file+0x3b4/0x5d0
[   27.370885]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.371315]  ? __memcg_slab_free_hook+0xc1/0x540
[   27.371610]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   27.371971]  ? evm_file_release+0x141/0x220
[   27.372324]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.372641]  __fput+0x41c/0xb70
[   27.372946]  ____fput+0x22/0x30
[   27.373152]  task_work_run+0x19b/0x2b0
[   27.373404]  ? __pfx_task_work_run+0x10/0x10
[   27.373792]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   27.374127]  ? switch_task_namespaces+0xc6/0x110
[   27.374419]  do_exit+0xb0e/0x29d0
[   27.374642]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.375068]  ? __pfx_do_exit+0x10/0x10
[   27.375310]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.375692]  ? __x64_sys_ioctl+0x1ba/0x220
[   27.375956]  make_task_dead+0x181/0x3c0
[   27.376293]  rewind_stack_and_make_dead+0x16/0x20
[   27.376594] RIP: 0033:0x7fcdb5a3ee5d
[   27.376828] Code: Unable to access opcode bytes at 0x7fcdb5a3ee33.
[   27.377307] RSP: 002b:00007ffd1244d4f8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.377807] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fcdb5a3ee5d
[   27.378316] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.378775] RBP: 00007ffd1244d510 R08: 0000000000000800 R09: 0000000000000800
[   27.379285] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd1244d628
[   27.379723] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fcdb5d64000
[   27.380151]  </TASK>
[   27.380291] irq event stamp: 0
[   27.380479] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   27.380849] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   27.381388] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   27.381872] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   27.382265] ---[ end trace 0000000000000000 ]---
[   27.382616] ------------[ cut here ]------------
[   27.382910] WARNING: CPU: 0 PID: 771 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   27.383464] Modules linked in:
[   27.383663] CPU: 0 UID: 0 PID: 771 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.384377] Tainted: [D]=DIE, [W]=WARN
[   27.384603] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.385270] RIP: 0010:iommufd_fops_release+0x392/0x420
[   27.385598] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   27.386671] RSP: 0018:ffff888012a3fc08 EFLAGS: 00010293
[   27.386993] RAX: 0000000000000000 RBX: ffff88802143a808 RCX: ffffffff83afe4ca
[   27.387411] RDX: ffff888021584a80 RSI: ffffffff83afe642 RDI: ffff88802143a8a0
[   27.387859] RBP: ffff888012a3fcb8 R08: 0000000000000000 R09: 0000000000000000
[   27.388278] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   27.388701] R13: 0000000000000000 R14: ffff888012a3fc50 R15: 0000000000000000
[   27.389127] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.389625] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.389972] CR2: 00000000200006c0 CR3: 0000000007086006 CR4: 0000000000770ef0
[   27.390387] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.390804] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.391218] PKRU: 55555554
[   27.391386] Call Trace:
[   27.391540]  <TASK>
[   27.391677]  ? show_regs+0x6d/0x80
[   27.391893]  ? __warn+0xf3/0x380
[   27.392097]  ? report_bug+0x25e/0x4b0
[   27.392325]  ? iommufd_fops_release+0x392/0x420
[   27.392602]  ? report_bug+0x2cb/0x4b0
[   27.392828]  ? iommufd_fops_release+0x392/0x420
[   27.393104]  ? iommufd_fops_release+0x392/0x420
[   27.393400]  ? handle_bug+0x2cd/0x510
[   27.393634]  ? iommufd_fops_release+0x394/0x420
[   27.393915]  ? exc_invalid_op+0x3c/0x80
[   27.394153]  ? asm_exc_invalid_op+0x1f/0x30
[   27.394411]  ? iommufd_fops_release+0x21a/0x420
[   27.394687]  ? iommufd_fops_release+0x392/0x420
[   27.394968]  ? iommufd_fops_release+0x392/0x420
[   27.395253]  ? iommufd_fops_release+0x392/0x420
[   27.395539]  ? locks_remove_file+0x3b4/0x5d0
[   27.395816]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.396123]  ? __memcg_slab_free_hook+0xc1/0x540
[   27.396410]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   27.396738]  ? evm_file_release+0x141/0x220
[   27.397012]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.397320]  __fput+0x41c/0xb70
[   27.397545]  ____fput+0x22/0x30
[   27.397750]  task_work_run+0x19b/0x2b0
[   27.397984]  ? __pfx_task_work_run+0x10/0x10
[   27.398253]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   27.398601]  ? switch_task_namespaces+0xc6/0x110
[   27.398894]  do_exit+0xb0e/0x29d0
[   27.399108]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.399429]  ? __pfx_do_exit+0x10/0x10
[   27.399662]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.399952]  ? __x64_sys_ioctl+0x1ba/0x220
[   27.400205]  make_task_dead+0x181/0x3c0
[   27.400445]  rewind_stack_and_make_dead+0x16/0x20
[   27.400732] RIP: 0033:0x7fcdb5a3ee5d
[   27.400954] Code: Unable to access opcode bytes at 0x7fcdb5a3ee33.
[   27.401350] RSP: 002b:00007ffd1244d4f8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.401857] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fcdb5a3ee5d
[   27.402314] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.402786] RBP: 00007ffd1244d510 R08: 0000000000000800 R09: 0000000000000800
[   27.403240] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd1244d628
[   27.403706] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fcdb5d64000
[   27.404173]  </TASK>
[   27.404336] irq event stamp: 0
[   27.404548] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   27.404958] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   27.405514] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   27.406035] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   27.406429] ---[ end trace 0000000000000000 ]---
[   27.413193] iommufd_mock iommufd_mock41: Adding to iommu group 41
[   27.413934] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#42] SMP KASAN NOPTI
[   27.414723] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   27.415192] CPU: 0 UID: 0 PID: 772 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.415924] Tainted: [D]=DIE, [W]=WARN
[   27.416162] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.416851] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.417218] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   27.418337] RSP: 0018:ffff8880123efb78 EFLAGS: 00010246
[   27.418666] RAX: dffffc0000000000 RBX: ffff888013e5ae00 RCX: 1ffffffff0dd8bdc
[   27.419134] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801156ad3c
[   27.419585] RBP: ffff8880123efbc8 R08: 0000000000000000 R09: 0000000000000000
[   27.420035] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   27.420483] R13: 0000000000000001 R14: ffff8880123efe18 R15: ffff888010bb7c08
[   27.420931] FS:  00007f24ac045600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.421432] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.421789] CR2: 00000000200006c0 CR3: 000000000fdde005 CR4: 0000000000770ef0
[   27.422231] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.422669] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.423110] PKRU: 55555554
[   27.423288] Call Trace:
[   27.423450]  <TASK>
[   27.423595]  ? show_regs+0x6d/0x80
[   27.423823]  ? die_addr+0x45/0xb0
[   27.424045]  ? exc_general_protection+0x1ad/0x340
[   27.424358]  ? asm_exc_general_protection+0x2b/0x30
[   27.424672]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.424997]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   27.425324]  iommufd_device_detach+0x2a/0x2e0
[   27.425612]  iommufd_test+0x2f99/0x5cd0
[   27.425863]  ? do_raw_spin_unlock+0x15c/0x210
[   27.426150]  ? __pfx_iommufd_test+0x10/0x10
[   27.426419]  ? debug_smp_processor_id+0x20/0x30
[   27.426717]  ? rcu_is_watching+0x19/0xc0
[   27.426974]  ? lock_release+0x1ea/0x2c0
[   27.427224]  ? __might_fault+0xf1/0x1b0
[   27.427477]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   27.427818]  iommufd_fops_ioctl+0x38e/0x520
[   27.428090]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.428393]  ? trace_irq_enable+0xd1/0x110
[   27.428664]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.428982]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.429284]  __x64_sys_ioctl+0x1ba/0x220
[   27.429542]  x64_sys_call+0x122e/0x2150
[   27.429790]  do_syscall_64+0x6d/0x150
[   27.430044]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   27.430365] RIP: 0033:0x7f24abe3ee5d
[   27.430601] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   27.431720] RSP: 002b:00007ffd3845e7c8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.432185] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f24abe3ee5d
[   27.432623] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.433061] RBP: 00007ffd3845e7e0 R08: 0000000000000800 R09: 0000000000000800
[   27.433499] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd3845e8f8
[   27.433936] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f24ac08e000
[   27.434380]  </TASK>
[   27.434527] Modules linked in:
[   27.434852] ---[ end trace 0000000000000000 ]---
[   27.435150] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.435515] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   27.436639] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   27.436967] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   27.437506] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   27.437950] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   27.438399] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   27.438847] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   27.439292] FS:  00007f24ac045600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.439787] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.440144] CR2: 00000000200006c0 CR3: 000000000fdde005 CR4: 0000000000770ef0
[   27.440587] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.441025] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.441510] PKRU: 55555554
[   27.442497] ------------[ cut here ]------------
[   27.442808] WARNING: CPU: 0 PID: 772 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   27.443558] Modules linked in:
[   27.443769] CPU: 0 UID: 0 PID: 772 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.444634] Tainted: [D]=DIE, [W]=WARN
[   27.444882] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.445732] RIP: 0010:iommufd_fops_release+0x386/0x420
[   27.446073] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   27.447226] RSP: 0018:ffff8880123efc08 EFLAGS: 00010293
[   27.447678] RAX: 0000000000000000 RBX: ffff88802143d808 RCX: ffffffff83afe4ca
[   27.448120] RDX: ffff88801156a540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   27.448682] RBP: ffff8880123efcb8 R08: 0000000000000000 R09: 0000000000000000
[   27.449138] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   27.450001] R13: 0000000000000000 R14: ffff8880123efc50 R15: 0000000000000000
[   27.450499] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.451112] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.451480] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   27.451928] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.452365] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.452803] PKRU: 55555554
[   27.452980] Call Trace:
[   27.453143]  <TASK>
[   27.453287]  ? show_regs+0x6d/0x80
[   27.453540]  ? __warn+0xf3/0x380
[   27.453762]  ? report_bug+0x25e/0x4b0
[   27.454004]  ? iommufd_fops_release+0x386/0x420
[   27.454297]  ? report_bug+0x2cb/0x4b0
[   27.454537]  ? iommufd_fops_release+0x386/0x420
[   27.454833]  ? iommufd_fops_release+0x386/0x420
[   27.455126]  ? handle_bug+0x2cd/0x510
[   27.455367]  ? iommufd_fops_release+0x388/0x420
[   27.455661]  ? exc_invalid_op+0x3c/0x80
[   27.455912]  ? asm_exc_invalid_op+0x1f/0x30
[   27.456185]  ? iommufd_fops_release+0x21a/0x420
[   27.456477]  ? iommufd_fops_release+0x386/0x420
[   27.456769]  ? iommufd_fops_release+0x386/0x420
[   27.457061]  ? iommufd_fops_release+0x386/0x420
[   27.457367]  ? locks_remove_file+0x3b4/0x5d0
[   27.457672]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.458041]  ? __memcg_slab_free_hook+0xc1/0x540
[   27.458343]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   27.458684]  ? evm_file_release+0x141/0x220
[   27.458960]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.459273]  __fput+0x41c/0xb70
[   27.459487]  ____fput+0x22/0x30
[   27.459697]  task_work_run+0x19b/0x2b0
[   27.459945]  ? __pfx_task_work_run+0x10/0x10
[   27.460226]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   27.460571]  ? switch_task_namespaces+0xc6/0x110
[   27.460871]  do_exit+0xb0e/0x29d0
[   27.461095]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.461428]  ? __pfx_do_exit+0x10/0x10
[   27.461680]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.461984]  ? __x64_sys_ioctl+0x1ba/0x220
[   27.462253]  make_task_dead+0x181/0x3c0
[   27.462506]  rewind_stack_and_make_dead+0x16/0x20
[   27.462813] RIP: 0033:0x7f24abe3ee5d
[   27.463048] Code: Unable to access opcode bytes at 0x7f24abe3ee33.
[   27.463430] RSP: 002b:00007ffd3845e7c8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.463896] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f24abe3ee5d
[   27.464335] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.464775] RBP: 00007ffd3845e7e0 R08: 0000000000000800 R09: 0000000000000800
[   27.465211] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd3845e8f8
[   27.465667] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f24ac08e000
[   27.466114]  </TASK>
[   27.466263] irq event stamp: 0
[   27.466463] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   27.466858] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   27.467368] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   27.467874] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   27.468266] ---[ end trace 0000000000000000 ]---
[   27.468613] ------------[ cut here ]------------
[   27.468907] WARNING: CPU: 0 PID: 772 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   27.469507] Modules linked in:
[   27.469728] CPU: 0 UID: 0 PID: 772 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.470465] Tainted: [D]=DIE, [W]=WARN
[   27.470709] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.471400] RIP: 0010:iommufd_fops_release+0x392/0x420
[   27.471728] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   27.472843] RSP: 0018:ffff8880123efc08 EFLAGS: 00010293
[   27.473174] RAX: 0000000000000000 RBX: ffff88802143d808 RCX: ffffffff83afe4ca
[   27.473629] RDX: ffff88801156a540 RSI: ffffffff83afe642 RDI: ffff88802143d8a0
[   27.474070] RBP: ffff8880123efcb8 R08: 0000000000000000 R09: 0000000000000000
[   27.474509] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   27.474951] R13: 0000000000000000 R14: ffff8880123efc50 R15: 0000000000000000
[   27.475395] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.475890] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.476248] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   27.476689] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.477128] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.477588] PKRU: 55555554
[   27.477768] Call Trace:
[   27.477933]  <TASK>
[   27.478082]  ? show_regs+0x6d/0x80
[   27.478309]  ? __warn+0xf3/0x380
[   27.478525]  ? report_bug+0x25e/0x4b0
[   27.478767]  ? iommufd_fops_release+0x392/0x420
[   27.479064]  ? report_bug+0x2cb/0x4b0
[   27.479305]  ? iommufd_fops_release+0x392/0x420
[   27.479599]  ? iommufd_fops_release+0x392/0x420
[   27.479891]  ? handle_bug+0x2cd/0x510
[   27.480132]  ? iommufd_fops_release+0x394/0x420
[   27.480426]  ? exc_invalid_op+0x3c/0x80
[   27.480677]  ? asm_exc_invalid_op+0x1f/0x30
[   27.480947]  ? iommufd_fops_release+0x21a/0x420
[   27.481239]  ? iommufd_fops_release+0x392/0x420
[   27.481545]  ? iommufd_fops_release+0x392/0x420
[   27.481842]  ? iommufd_fops_release+0x392/0x420
[   27.482136]  ? locks_remove_file+0x3b4/0x5d0
[   27.482416]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.482732]  ? __memcg_slab_free_hook+0xc1/0x540
[   27.483034]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   27.483514]  ? evm_file_release+0x141/0x220
[   27.483786]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.484098]  __fput+0x41c/0xb70
[   27.484312]  ____fput+0x22/0x30
[   27.484521]  task_work_run+0x19b/0x2b0
[   27.484769]  ? __pfx_task_work_run+0x10/0x10
[   27.485047]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   27.485404]  ? switch_task_namespaces+0xc6/0x110
[   27.485708]  do_exit+0xb0e/0x29d0
[   27.485933]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.486254]  ? __pfx_do_exit+0x10/0x10
[   27.486499]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.486807]  ? __x64_sys_ioctl+0x1ba/0x220
[   27.487072]  make_task_dead+0x181/0x3c0
[   27.487323]  rewind_stack_and_make_dead+0x16/0x20
[   27.487624] RIP: 0033:0x7f24abe3ee5d
[   27.487856] Code: Unable to access opcode bytes at 0x7f24abe3ee33.
[   27.488236] RSP: 002b:00007ffd3845e7c8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.488702] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f24abe3ee5d
[   27.489140] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.489595] RBP: 00007ffd3845e7e0 R08: 0000000000000800 R09: 0000000000000800
[   27.490055] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd3845e8f8
[   27.490500] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f24ac08e000
[   27.490954]  </TASK>
[   27.491104] irq event stamp: 0
[   27.491303] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   27.491695] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   27.492203] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   27.492709] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   27.493106] ---[ end trace 0000000000000000 ]---
[   27.497946] iommufd_mock iommufd_mock42: Adding to iommu group 42
[   27.498712] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#43] SMP KASAN NOPTI
[   27.499423] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   27.499901] CPU: 0 UID: 0 PID: 773 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.500658] Tainted: [D]=DIE, [W]=WARN
[   27.500919] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.501714] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.502090] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   27.503211] RSP: 0018:ffff888012a3fb78 EFLAGS: 00010246
[   27.503540] RAX: dffffc0000000000 RBX: ffff888013e5ac00 RCX: 1ffffffff0dd8bdc
[   27.503979] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801156d27c
[   27.504417] RBP: ffff888012a3fbc8 R08: 0000000000000000 R09: 0000000000000000
[   27.504856] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   27.505294] R13: 0000000000000001 R14: ffff888012a3fe18 R15: ffff88801075ac08
[   27.505735] FS:  00007facf2234600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.506230] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.506588] CR2: 00000000200006c0 CR3: 000000001c886006 CR4: 0000000000770ef0
[   27.507032] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.507471] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.507909] PKRU: 55555554
[   27.508086] Call Trace:
[   27.508249]  <TASK>
[   27.508393]  ? show_regs+0x6d/0x80
[   27.508621]  ? die_addr+0x45/0xb0
[   27.508848]  ? exc_general_protection+0x1ad/0x340
[   27.509159]  ? asm_exc_general_protection+0x2b/0x30
[   27.509478]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.509804]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   27.510131]  iommufd_device_detach+0x2a/0x2e0
[   27.510417]  iommufd_test+0x2f99/0x5cd0
[   27.510669]  ? do_raw_spin_unlock+0x15c/0x210
[   27.510961]  ? __pfx_iommufd_test+0x10/0x10
[   27.511231]  ? debug_smp_processor_id+0x20/0x30
[   27.511526]  ? rcu_is_watching+0x19/0xc0
[   27.511785]  ? lock_release+0x1ea/0x2c0
[   27.512036]  ? __might_fault+0xf1/0x1b0
[   27.512289]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   27.512632]  iommufd_fops_ioctl+0x38e/0x520
[   27.512905]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.513210]  ? trace_irq_enable+0xd1/0x110
[   27.513492]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.513814]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.514119]  __x64_sys_ioctl+0x1ba/0x220
[   27.514377]  x64_sys_call+0x122e/0x2150
[   27.514627]  do_syscall_64+0x6d/0x150
[   27.514877]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   27.515198] RIP: 0033:0x7facf203ee5d
[   27.515433] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   27.516547] RSP: 002b:00007ffe115445b8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.517015] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007facf203ee5d
[   27.517454] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.517893] RBP: 00007ffe115445d0 R08: 0000000000000800 R09: 0000000000000800
[   27.518332] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe115446e8
[   27.518772] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007facf227d000
[   27.519221]  </TASK>
[   27.519370] Modules linked in:
[   27.519640] ---[ end trace 0000000000000000 ]---
[   27.519938] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.520305] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   27.521470] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   27.521805] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   27.522244] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   27.522681] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   27.523125] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   27.523587] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   27.524151] FS:  00007facf2234600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.524715] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.525081] CR2: 00000000200006c0 CR3: 000000001c886006 CR4: 0000000000770ef0
[   27.525538] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.525981] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.526419] PKRU: 55555554
[   27.527289] ------------[ cut here ]------------
[   27.527585] WARNING: CPU: 0 PID: 773 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   27.528168] Modules linked in:
[   27.528416] CPU: 0 UID: 0 PID: 773 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.529205] Tainted: [D]=DIE, [W]=WARN
[   27.529468] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.530180] RIP: 0010:iommufd_fops_release+0x386/0x420
[   27.530559] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   27.531849] RSP: 0018:ffff888012a3fc08 EFLAGS: 00010293
[   27.532186] RAX: 0000000000000000 RBX: ffff888021e9f008 RCX: ffffffff83afe4ca
[   27.532728] RDX: ffff88801156ca80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   27.533187] RBP: ffff888012a3fcb8 R08: 0000000000000000 R09: 0000000000000000
[   27.534231] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   27.534664] R13: 0000000000000000 R14: ffff888012a3fc50 R15: 0000000000000000
[   27.535136] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.535717] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.536198] CR2: 00000000200006c0 CR3: 0000000007086003 CR4: 0000000000770ef0
[   27.536643] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.537181] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.537726] PKRU: 55555554
[   27.537907] Call Trace:
[   27.538067]  <TASK>
[   27.538213]  ? show_regs+0x6d/0x80
[   27.538438]  ? __warn+0xf3/0x380
[   27.538650]  ? report_bug+0x25e/0x4b0
[   27.538891]  ? iommufd_fops_release+0x386/0x420
[   27.539178]  ? report_bug+0x2cb/0x4b0
[   27.539414]  ? iommufd_fops_release+0x386/0x420
[   27.539706]  ? iommufd_fops_release+0x386/0x420
[   27.540022]  ? handle_bug+0x2cd/0x510
[   27.540264]  ? iommufd_fops_release+0x388/0x420
[   27.540555]  ? exc_invalid_op+0x3c/0x80
[   27.540808]  ? asm_exc_invalid_op+0x1f/0x30
[   27.541079]  ? iommufd_fops_release+0x21a/0x420
[   27.541420]  ? iommufd_fops_release+0x386/0x420
[   27.541719]  ? iommufd_fops_release+0x386/0x420
[   27.542013]  ? iommufd_fops_release+0x386/0x420
[   27.542304]  ? locks_remove_file+0x3b4/0x5d0
[   27.542586]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.542893]  ? __memcg_slab_free_hook+0xc1/0x540
[   27.543192]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   27.543530]  ? evm_file_release+0x141/0x220
[   27.543802]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.544113]  __fput+0x41c/0xb70
[   27.544326]  ____fput+0x22/0x30
[   27.544535]  task_work_run+0x19b/0x2b0
[   27.544782]  ? __pfx_task_work_run+0x10/0x10
[   27.545059]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   27.545414]  ? switch_task_namespaces+0xc6/0x110
[   27.545715]  do_exit+0xb0e/0x29d0
[   27.545937]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.546254]  ? __pfx_do_exit+0x10/0x10
[   27.546498]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.546804]  ? __x64_sys_ioctl+0x1ba/0x220
[   27.547069]  make_task_dead+0x181/0x3c0
[   27.547319]  rewind_stack_and_make_dead+0x16/0x20
[   27.547619] RIP: 0033:0x7facf203ee5d
[   27.547852] Code: Unable to access opcode bytes at 0x7facf203ee33.
[   27.548234] RSP: 002b:00007ffe115445b8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.548701] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007facf203ee5d
[   27.549139] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.549587] RBP: 00007ffe115445d0 R08: 0000000000000800 R09: 0000000000000800
[   27.550024] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe115446e8
[   27.550460] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007facf227d000
[   27.550909]  </TASK>
[   27.551059] irq event stamp: 0
[   27.551258] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   27.551649] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   27.552187] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   27.552735] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   27.553151] ---[ end trace 0000000000000000 ]---
[   27.553549] ------------[ cut here ]------------
[   27.553868] WARNING: CPU: 0 PID: 773 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   27.554537] Modules linked in:
[   27.554766] CPU: 0 UID: 0 PID: 773 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.555563] Tainted: [D]=DIE, [W]=WARN
[   27.555835] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.556573] RIP: 0010:iommufd_fops_release+0x392/0x420
[   27.556921] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   27.558133] RSP: 0018:ffff888012a3fc08 EFLAGS: 00010293
[   27.558487] RAX: 0000000000000000 RBX: ffff888021e9f008 RCX: ffffffff83afe4ca
[   27.558925] RDX: ffff88801156ca80 RSI: ffffffff83afe642 RDI: ffff888021e9f0a0
[   27.559356] RBP: ffff888012a3fcb8 R08: 0000000000000000 R09: 0000000000000000
[   27.559784] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   27.560214] R13: 0000000000000000 R14: ffff888012a3fc50 R15: 0000000000000000
[   27.560645] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.561132] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.561497] CR2: 00000000200006c0 CR3: 0000000007086003 CR4: 0000000000770ef0
[   27.561933] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.562368] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.562806] PKRU: 55555554
[   27.562985] Call Trace:
[   27.563146]  <TASK>
[   27.563290]  ? show_regs+0x6d/0x80
[   27.563517]  ? __warn+0xf3/0x380
[   27.563732]  ? report_bug+0x25e/0x4b0
[   27.563968]  ? iommufd_fops_release+0x392/0x420
[   27.564256]  ? report_bug+0x2cb/0x4b0
[   27.564493]  ? iommufd_fops_release+0x392/0x420
[   27.564783]  ? iommufd_fops_release+0x392/0x420
[   27.565069]  ? handle_bug+0x2cd/0x510
[   27.565306]  ? iommufd_fops_release+0x394/0x420
[   27.565612]  ? exc_invalid_op+0x3c/0x80
[   27.565865]  ? asm_exc_invalid_op+0x1f/0x30
[   27.566134]  ? iommufd_fops_release+0x21a/0x420
[   27.566444]  ? iommufd_fops_release+0x392/0x420
[   27.566759]  ? iommufd_fops_release+0x392/0x420
[   27.567071]  ? iommufd_fops_release+0x392/0x420
[   27.567379]  ? locks_remove_file+0x3b4/0x5d0
[   27.567676]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.568008]  ? __memcg_slab_free_hook+0xc1/0x540
[   27.568325]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   27.568685]  ? evm_file_release+0x141/0x220
[   27.568972]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.569301]  __fput+0x41c/0xb70
[   27.569542]  ____fput+0x22/0x30
[   27.569765]  task_work_run+0x19b/0x2b0
[   27.570027]  ? __pfx_task_work_run+0x10/0x10
[   27.570319]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   27.570678]  ? switch_task_namespaces+0xc6/0x110
[   27.570999]  do_exit+0xb0e/0x29d0
[   27.571378]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.571908]  ? __pfx_do_exit+0x10/0x10
[   27.572318]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.572819]  ? __x64_sys_ioctl+0x1ba/0x220
[   27.573261]  make_task_dead+0x181/0x3c0
[   27.573702]  rewind_stack_and_make_dead+0x16/0x20
[   27.574202] RIP: 0033:0x7facf203ee5d
[   27.574589] Code: Unable to access opcode bytes at 0x7facf203ee33.
[   27.575226] RSP: 002b:00007ffe115445b8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.576002] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007facf203ee5d
[   27.576730] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.577477] RBP: 00007ffe115445d0 R08: 0000000000000800 R09: 0000000000000800
[   27.578205] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe115446e8
[   27.578962] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007facf227d000
[   27.579714]  </TASK>
[   27.579967] irq event stamp: 0
[   27.580304] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   27.580968] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   27.581856] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   27.582731] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   27.583322] ---[ end trace 0000000000000000 ]---
[   27.595681] iommufd_mock iommufd_mock43: Adding to iommu group 43
[   27.596575] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#44] SMP KASAN NOPTI
[   27.597765] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   27.598567] CPU: 0 UID: 0 PID: 774 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.600333] Tainted: [D]=DIE, [W]=WARN
[   27.600718] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.601808] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.602385] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   27.604153] RSP: 0018:ffff8880123efb78 EFLAGS: 00010246
[   27.604678] RAX: dffffc0000000000 RBX: ffff888013e5a000 RCX: 1ffffffff0dd8bdc
[   27.605372] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880115687fc
[   27.606067] RBP: ffff8880123efbc8 R08: 0000000000000000 R09: 0000000000000000
[   27.606763] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   27.607458] R13: 0000000000000001 R14: ffff8880123efe18 R15: ffff8880126a2008
[   27.608152] FS:  00007ffbab886600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.608937] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.609506] CR2: 00007f0825926000 CR3: 0000000013ac2001 CR4: 0000000000770ef0
[   27.610203] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.610903] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.611599] PKRU: 55555554
[   27.611881] Call Trace:
[   27.612141]  <TASK>
[   27.612380]  ? show_regs+0x6d/0x80
[   27.612755]  ? die_addr+0x45/0xb0
[   27.613117]  ? exc_general_protection+0x1ad/0x340
[   27.613628]  ? asm_exc_general_protection+0x2b/0x30
[   27.614142]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.614675]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   27.615211]  iommufd_device_detach+0x2a/0x2e0
[   27.615677]  iommufd_test+0x2f99/0x5cd0
[   27.616088]  ? do_raw_spin_unlock+0x15c/0x210
[   27.616557]  ? __pfx_iommufd_test+0x10/0x10
[   27.616996]  ? debug_smp_processor_id+0x20/0x30
[   27.617476]  ? rcu_is_watching+0x19/0xc0
[   27.617904]  ? lock_release+0x1ea/0x2c0
[   27.618302]  ? __might_fault+0xf1/0x1b0
[   27.618712]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   27.619259]  iommufd_fops_ioctl+0x38e/0x520
[   27.619693]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.620176]  ? trace_irq_enable+0xd1/0x110
[   27.620606]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.621112]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.621592]  __x64_sys_ioctl+0x1ba/0x220
[   27.622001]  x64_sys_call+0x122e/0x2150
[   27.622397]  do_syscall_64+0x6d/0x150
[   27.622786]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   27.623300] RIP: 0033:0x7ffbab63ee5d
[   27.623671] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   27.625434] RSP: 002b:00007ffff9c59118 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.626175] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007ffbab63ee5d
[   27.626875] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.627572] RBP: 00007ffff9c59130 R08: 0000000000000800 R09: 0000000000000800
[   27.628268] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffff9c59248
[   27.628962] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007ffbab8cf000
[   27.629667]  </TASK>
[   27.629903] Modules linked in:
[   27.630377] ---[ end trace 0000000000000000 ]---
[   27.630851] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.631445] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   27.633254] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   27.633876] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   27.634591] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   27.635316] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   27.636030] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   27.636748] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   27.637480] FS:  00007ffbab886600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.638270] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.638847] CR2: 00007f0825926000 CR3: 0000000013ac2001 CR4: 0000000000770ef0
[   27.639548] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.640250] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.640953] PKRU: 55555554
[   27.642375] ------------[ cut here ]------------
[   27.642898] WARNING: CPU: 0 PID: 774 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   27.644161] Modules linked in:
[   27.644566] CPU: 0 UID: 0 PID: 774 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.645808] Tainted: [D]=DIE, [W]=WARN
[   27.646223] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.647410] RIP: 0010:iommufd_fops_release+0x386/0x420
[   27.648112] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   27.650374] RSP: 0018:ffff8880123efc08 EFLAGS: 00010293
[   27.650949] RAX: 0000000000000000 RBX: ffff888012ddd008 RCX: ffffffff83afe4ca
[   27.651654] RDX: ffff888011568000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   27.652390] RBP: ffff8880123efcb8 R08: 0000000000000000 R09: 0000000000000000
[   27.653170] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   27.654130] R13: 0000000000000000 R14: ffff8880123efc50 R15: 0000000000000000
[   27.654889] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.655793] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.656408] CR2: 00007f0825926000 CR3: 0000000007086003 CR4: 0000000000770ef0
[   27.657285] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.658011] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.658728] PKRU: 55555554
[   27.659013] Call Trace:
[   27.659273]  <TASK>
[   27.659503]  ? show_regs+0x6d/0x80
[   27.659868]  ? __warn+0xf3/0x380
[   27.660215]  ? report_bug+0x25e/0x4b0
[   27.660652]  ? iommufd_fops_release+0x386/0x420
[   27.661297]  ? report_bug+0x2cb/0x4b0
[   27.661705]  ? iommufd_fops_release+0x386/0x420
[   27.662175]  ? iommufd_fops_release+0x386/0x420
[   27.662642]  ? handle_bug+0x2cd/0x510
[   27.663059]  ? iommufd_fops_release+0x388/0x420
[   27.663728]  ? exc_invalid_op+0x3c/0x80
[   27.664138]  ? asm_exc_invalid_op+0x1f/0x30
[   27.664573]  ? iommufd_fops_release+0x21a/0x420
[   27.665039]  ? iommufd_fops_release+0x386/0x420
[   27.665525]  ? iommufd_fops_release+0x386/0x420
[   27.666015]  ? iommufd_fops_release+0x386/0x420
[   27.666489]  ? locks_remove_file+0x3b4/0x5d0
[   27.666946]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.667448]  ? __memcg_slab_free_hook+0xc1/0x540
[   27.667928]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   27.668478]  ? evm_file_release+0x141/0x220
[   27.668917]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.669534]  __fput+0x41c/0xb70
[   27.670019]  ____fput+0x22/0x30
[   27.670359]  task_work_run+0x19b/0x2b0
[   27.670764]  ? __pfx_task_work_run+0x10/0x10
[   27.671211]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   27.671760]  ? switch_task_namespaces+0xc6/0x110
[   27.672288]  do_exit+0xb0e/0x29d0
[   27.672852]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.673388]  ? __pfx_do_exit+0x10/0x10
[   27.673789]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.674287]  ? __x64_sys_ioctl+0x1ba/0x220
[   27.674716]  make_task_dead+0x181/0x3c0
[   27.675160]  rewind_stack_and_make_dead+0x16/0x20
[   27.675704] RIP: 0033:0x7ffbab63ee5d
[   27.676077] Code: Unable to access opcode bytes at 0x7ffbab63ee33.
[   27.676906] RSP: 002b:00007ffff9c59118 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.677661] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007ffbab63ee5d
[   27.678349] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.679042] RBP: 00007ffff9c59130 R08: 0000000000000800 R09: 0000000000000800
[   27.679729] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffff9c59248
[   27.680414] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007ffbab8cf000
[   27.681217]  </TASK>
[   27.681638] irq event stamp: 0
[   27.681956] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   27.682568] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   27.683370] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   27.684165] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   27.684772] ---[ end trace 0000000000000000 ]---
[   27.685305] ------------[ cut here ]------------
[   27.685842] WARNING: CPU: 0 PID: 774 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   27.686934] Modules linked in:
[   27.687266] CPU: 0 UID: 0 PID: 774 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.688426] Tainted: [D]=DIE, [W]=WARN
[   27.688851] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.690106] RIP: 0010:iommufd_fops_release+0x392/0x420
[   27.690622] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   27.692371] RSP: 0018:ffff8880123efc08 EFLAGS: 00010293
[   27.692888] RAX: 0000000000000000 RBX: ffff888012ddd008 RCX: ffffffff83afe4ca
[   27.693637] RDX: ffff888011568000 RSI: ffffffff83afe642 RDI: ffff888012ddd0a0
[   27.694329] RBP: ffff8880123efcb8 R08: 0000000000000000 R09: 0000000000000000
[   27.695018] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   27.695703] R13: 0000000000000000 R14: ffff8880123efc50 R15: 0000000000000000
[   27.696392] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.697164] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.697744] CR2: 00007f0825926000 CR3: 0000000007086003 CR4: 0000000000770ef0
[   27.698435] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.699128] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.699813] PKRU: 55555554
[   27.700093] Call Trace:
[   27.700349]  <TASK>
[   27.700577]  ? show_regs+0x6d/0x80
[   27.700934]  ? __warn+0xf3/0x380
[   27.701273]  ? report_bug+0x25e/0x4b0
[   27.701668]  ? iommufd_fops_release+0x392/0x420
[   27.702127]  ? report_bug+0x2cb/0x4b0
[   27.702504]  ? iommufd_fops_release+0x392/0x420
[   27.702965]  ? iommufd_fops_release+0x392/0x420
[   27.703422]  ? handle_bug+0x2cd/0x510
[   27.703800]  ? iommufd_fops_release+0x394/0x420
[   27.704278]  ? exc_invalid_op+0x3c/0x80
[   27.704683]  ? asm_exc_invalid_op+0x1f/0x30
[   27.705121]  ? iommufd_fops_release+0x21a/0x420
[   27.705637]  ? iommufd_fops_release+0x392/0x420
[   27.706118]  ? iommufd_fops_release+0x392/0x420
[   27.706596]  ? iommufd_fops_release+0x392/0x420
[   27.707083]  ? locks_remove_file+0x3b4/0x5d0
[   27.707554]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.708050]  ? __memcg_slab_free_hook+0xc1/0x540
[   27.708522]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   27.709059]  ? evm_file_release+0x141/0x220
[   27.709517]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.710007]  __fput+0x41c/0xb70
[   27.710341]  ____fput+0x22/0x30
[   27.710670]  task_work_run+0x19b/0x2b0
[   27.711064]  ? __pfx_task_work_run+0x10/0x10
[   27.711500]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   27.712031]  ? switch_task_namespaces+0xc6/0x110
[   27.712501]  do_exit+0xb0e/0x29d0
[   27.712850]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.713363]  ? __pfx_do_exit+0x10/0x10
[   27.713751]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.714223]  ? __x64_sys_ioctl+0x1ba/0x220
[   27.714639]  make_task_dead+0x181/0x3c0
[   27.715037]  rewind_stack_and_make_dead+0x16/0x20
[   27.715507] RIP: 0033:0x7ffbab63ee5d
[   27.715872] Code: Unable to access opcode bytes at 0x7ffbab63ee33.
[   27.716468] RSP: 002b:00007ffff9c59118 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.717196] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007ffbab63ee5d
[   27.717900] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.718587] RBP: 00007ffff9c59130 R08: 0000000000000800 R09: 0000000000000800
[   27.719280] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffff9c59248
[   27.719965] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007ffbab8cf000
[   27.720658]  </TASK>
[   27.720892] irq event stamp: 0
[   27.721204] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   27.721852] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   27.722662] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   27.723479] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   27.724113] ---[ end trace 0000000000000000 ]---
[   27.734007] iommufd_mock iommufd_mock44: Adding to iommu group 44
[   27.737450] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#45] SMP KASAN NOPTI
[   27.739054] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   27.740133] CPU: 1 UID: 0 PID: 775 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.741875] Tainted: [D]=DIE, [W]=WARN
[   27.742393] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.744052] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.744917] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   27.747539] RSP: 0018:ffff888021ef7b78 EFLAGS: 00010246
[   27.748330] RAX: dffffc0000000000 RBX: ffff88800de5d000 RCX: 1ffffffff0dd8bdd
[   27.749299] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88802159527c
[   27.750316] RBP: ffff888021ef7bc8 R08: 0000000000000000 R09: 0000000000000000
[   27.751343] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   27.752395] R13: 0000000000000001 R14: ffff888021ef7e18 R15: ffff888013963c08
[   27.753439] FS:  00007f38d4eec600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   27.754661] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.755584] CR2: 00000000200006c0 CR3: 00000000171ba004 CR4: 0000000000770ef0
[   27.756567] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.757642] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.758693] PKRU: 55555554
[   27.759210] Call Trace:
[   27.759546]  <TASK>
[   27.759854]  ? show_regs+0x6d/0x80
[   27.760440]  ? die_addr+0x45/0xb0
[   27.760899]  ? exc_general_protection+0x1ad/0x340
[   27.761711]  ? asm_exc_general_protection+0x2b/0x30
[   27.762391]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.763200]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   27.764034]  iommufd_device_detach+0x2a/0x2e0
[   27.764629]  iommufd_test+0x2f99/0x5cd0
[   27.765300]  ? __rb_insert_augmented+0x1f4/0x9d0
[   27.765942]  ? __pfx_iommufd_test+0x10/0x10
[   27.766645]  ? debug_smp_processor_id+0x20/0x30
[   27.767311]  ? rcu_is_watching+0x19/0xc0
[   27.767997]  ? lock_release+0x1ea/0x2c0
[   27.768563]  ? __might_fault+0xf1/0x1b0
[   27.769257]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   27.770166]  iommufd_fops_ioctl+0x38e/0x520
[   27.770747]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.771533]  ? trace_irq_enable+0xd1/0x110
[   27.772113]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.772953]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.773717]  __x64_sys_ioctl+0x1ba/0x220
[   27.774262]  x64_sys_call+0x122e/0x2150
[   27.774926]  do_syscall_64+0x6d/0x150
[   27.775436]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   27.776259] RIP: 0033:0x7f38d4c3ee5d
[   27.776751] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   27.779136] RSP: 002b:00007ffce15eaf88 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.780117] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f38d4c3ee5d
[   27.781035] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.781955] RBP: 00007ffce15eafa0 R08: 0000000000000800 R09: 0000000000000800
[   27.782880] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffce15eb0b8
[   27.783795] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f38d4f35000
[   27.784723]  </TASK>
[   27.785029] Modules linked in:
[   27.785572] ---[ end trace 0000000000000000 ]---
[   27.786191] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.786955] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   27.789546] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   27.790249] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   27.791182] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   27.792121] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   27.793053] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   27.794060] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   27.795089] FS:  00007f38d4eec600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   27.796453] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.797253] CR2: 00000000200006c0 CR3: 00000000171ba004 CR4: 0000000000770ef0
[   27.798508] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.799495] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.800695] PKRU: 55555554
[   27.802800] ------------[ cut here ]------------
[   27.803549] WARNING: CPU: 1 PID: 775 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   27.805047] Modules linked in:
[   27.805733] CPU: 1 UID: 0 PID: 775 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.807521] Tainted: [D]=DIE, [W]=WARN
[   27.808063] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.809626] RIP: 0010:iommufd_fops_release+0x386/0x420
[   27.810323] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   27.812723] RSP: 0018:ffff888021ef7c08 EFLAGS: 00010293
[   27.813467] RAX: 0000000000000000 RBX: ffff888012ddb808 RCX: ffffffff83afe4ca
[   27.814444] RDX: ffff888021594a80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   27.815383] RBP: ffff888021ef7cb8 R08: 0000000000000000 R09: 0000000000000000
[   27.816311] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   27.817234] R13: 0000000000000000 R14: ffff888021ef7c50 R15: 0000000000000000
[   27.818186] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   27.819248] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.820003] CR2: 00007f25f80b9000 CR3: 0000000007086004 CR4: 0000000000770ef0
[   27.820931] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.821880] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.822827] PKRU: 55555554
[   27.823199] Call Trace:
[   27.823537]  <TASK>
[   27.823836]  ? show_regs+0x6d/0x80
[   27.824309]  ? __warn+0xf3/0x380
[   27.824763]  ? report_bug+0x25e/0x4b0
[   27.825285]  ? iommufd_fops_release+0x386/0x420
[   27.825943]  ? report_bug+0x2cb/0x4b0
[   27.826495]  ? iommufd_fops_release+0x386/0x420
[   27.827118]  ? iommufd_fops_release+0x386/0x420
[   27.827729]  ? handle_bug+0x2cd/0x510
[   27.828234]  ? iommufd_fops_release+0x388/0x420
[   27.828866]  ? exc_invalid_op+0x3c/0x80
[   27.829437]  ? asm_exc_invalid_op+0x1f/0x30
[   27.830036]  ? iommufd_fops_release+0x21a/0x420
[   27.830653]  ? iommufd_fops_release+0x386/0x420
[   27.831289]  ? iommufd_fops_release+0x386/0x420
[   27.831913]  ? iommufd_fops_release+0x386/0x420
[   27.832533]  ? locks_remove_file+0x3b4/0x5d0
[   27.833130]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.833809]  ? __memcg_slab_free_hook+0xc1/0x540
[   27.834451]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   27.835177]  ? evm_file_release+0x141/0x220
[   27.835742]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.836393]  __fput+0x41c/0xb70
[   27.836833]  ____fput+0x22/0x30
[   27.837268]  task_work_run+0x19b/0x2b0
[   27.837811]  ? __pfx_task_work_run+0x10/0x10
[   27.838423]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   27.839141]  ? switch_task_namespaces+0xc6/0x110
[   27.839766]  do_exit+0xb0e/0x29d0
[   27.840227]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.840889]  ? __pfx_do_exit+0x10/0x10
[   27.841430]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.842088]  ? __x64_sys_ioctl+0x1ba/0x220
[   27.842643]  make_task_dead+0x181/0x3c0
[   27.843173]  rewind_stack_and_make_dead+0x16/0x20
[   27.843800] RIP: 0033:0x7f38d4c3ee5d
[   27.844287] Code: Unable to access opcode bytes at 0x7f38d4c3ee33.
[   27.845090] RSP: 002b:00007ffce15eaf88 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.846111] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f38d4c3ee5d
[   27.847084] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.848022] RBP: 00007ffce15eafa0 R08: 0000000000000800 R09: 0000000000000800
[   27.848955] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffce15eb0b8
[   27.849918] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f38d4f35000
[   27.850881]  </TASK>
[   27.851193] irq event stamp: 0
[   27.851614] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   27.852440] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   27.853543] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   27.854623] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   27.855457] ---[ end trace 0000000000000000 ]---
[   27.856164] ------------[ cut here ]------------
[   27.856780] WARNING: CPU: 1 PID: 775 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   27.858055] Modules linked in:
[   27.858488] CPU: 1 UID: 0 PID: 775 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.860042] Tainted: [D]=DIE, [W]=WARN
[   27.860547] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.862042] RIP: 0010:iommufd_fops_release+0x392/0x420
[   27.862745] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   27.865137] RSP: 0018:ffff888021ef7c08 EFLAGS: 00010293
[   27.865858] RAX: 0000000000000000 RBX: ffff888012ddb808 RCX: ffffffff83afe4ca
[   27.866802] RDX: ffff888021594a80 RSI: ffffffff83afe642 RDI: ffff888012ddb8a0
[   27.867739] RBP: ffff888021ef7cb8 R08: 0000000000000000 R09: 0000000000000000
[   27.868673] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   27.869631] R13: 0000000000000000 R14: ffff888021ef7c50 R15: 0000000000000000
[   27.870566] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   27.871623] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.872385] CR2: 00007f25f80b9000 CR3: 0000000007086004 CR4: 0000000000770ef0
[   27.873356] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.874295] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.875235] PKRU: 55555554
[   27.875612] Call Trace:
[   27.875954]  <TASK>
[   27.876258]  ? show_regs+0x6d/0x80
[   27.876733]  ? __warn+0xf3/0x380
[   27.877185]  ? report_bug+0x25e/0x4b0
[   27.877711]  ? iommufd_fops_release+0x392/0x420
[   27.878327]  ? report_bug+0x2cb/0x4b0
[   27.878838]  ? iommufd_fops_release+0x392/0x420
[   27.879452]  ? iommufd_fops_release+0x392/0x420
[   27.880067]  ? handle_bug+0x2cd/0x510
[   27.880571]  ? iommufd_fops_release+0x394/0x420
[   27.881184]  ? exc_invalid_op+0x3c/0x80
[   27.881735]  ? asm_exc_invalid_op+0x1f/0x30
[   27.882306]  ? iommufd_fops_release+0x21a/0x420
[   27.882927]  ? iommufd_fops_release+0x392/0x420
[   27.883540]  ? iommufd_fops_release+0x392/0x420
[   27.884154]  ? iommufd_fops_release+0x392/0x420
[   27.884765]  ? locks_remove_file+0x3b4/0x5d0
[   27.885373]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.886029]  ? __memcg_slab_free_hook+0xc1/0x540
[   27.886654]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   27.887378]  ? evm_file_release+0x141/0x220
[   27.887945]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.888600]  __fput+0x41c/0xb70
[   27.889041]  ____fput+0x22/0x30
[   27.889507]  task_work_run+0x19b/0x2b0
[   27.890039]  ? __pfx_task_work_run+0x10/0x10
[   27.890625]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   27.891351]  ? switch_task_namespaces+0xc6/0x110
[   27.891985]  do_exit+0xb0e/0x29d0
[   27.892450]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.893121]  ? __pfx_do_exit+0x10/0x10
[   27.893662]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.894305]  ? __x64_sys_ioctl+0x1ba/0x220
[   27.895314]  make_task_dead+0x181/0x3c0
[   27.896544]  rewind_stack_and_make_dead+0x16/0x20
[   27.898025] RIP: 0033:0x7f38d4c3ee5d
[   27.899138] Code: Unable to access opcode bytes at 0x7f38d4c3ee33.
[   27.900398] RSP: 002b:00007ffce15eaf88 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.901639] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f38d4c3ee5d
[   27.902782] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.903923] RBP: 00007ffce15eafa0 R08: 0000000000000800 R09: 0000000000000800
[   27.905066] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffce15eb0b8
[   27.906246] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f38d4f35000
[   27.907405]  </TASK>
[   27.907792] irq event stamp: 0
[   27.908310] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   27.909315] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   27.910691] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   27.912060] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   27.913100] ---[ end trace 0000000000000000 ]---
[   27.923144] iommufd_mock iommufd_mock45: Adding to iommu group 45
[   27.924759] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#46] SMP KASAN NOPTI
[   27.926376] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   27.927502] CPU: 0 UID: 0 PID: 776 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.929156] Tainted: [D]=DIE, [W]=WARN
[   27.929752] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.931044] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.931462] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   27.932688] RSP: 0018:ffff8880123efb78 EFLAGS: 00010246
[   27.933039] RAX: dffffc0000000000 RBX: ffff888013e5b400 RCX: 1ffffffff0dd8bdc
[   27.933524] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff888021592d3c
[   27.933993] RBP: ffff8880123efbc8 R08: 0000000000000000 R09: 0000000000000000
[   27.934452] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   27.934903] R13: 0000000000000001 R14: ffff8880123efe18 R15: ffff8880126a1c08
[   27.935337] FS:  00007fa223efc600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.935824] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.936177] CR2: 00000000200006c0 CR3: 0000000011d5a006 CR4: 0000000000770ef0
[   27.936573] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.936963] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.937359] PKRU: 55555554
[   27.937529] Call Trace:
[   27.937677]  <TASK>
[   27.937812]  ? show_regs+0x6d/0x80
[   27.938017]  ? die_addr+0x45/0xb0
[   27.938214]  ? exc_general_protection+0x1ad/0x340
[   27.938492]  ? asm_exc_general_protection+0x2b/0x30
[   27.938784]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.939075]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   27.939372]  iommufd_device_detach+0x2a/0x2e0
[   27.939628]  iommufd_test+0x2f99/0x5cd0
[   27.939851]  ? do_raw_spin_unlock+0x15c/0x210
[   27.940110]  ? __pfx_iommufd_test+0x10/0x10
[   27.940353]  ? debug_smp_processor_id+0x20/0x30
[   27.940614]  ? rcu_is_watching+0x19/0xc0
[   27.940842]  ? lock_release+0x1ea/0x2c0
[   27.941065]  ? __might_fault+0xf1/0x1b0
[   27.941290]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   27.941616]  iommufd_fops_ioctl+0x38e/0x520
[   27.941860]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.942132]  ? trace_irq_enable+0xd1/0x110
[   27.942374]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.942656]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.942940]  __x64_sys_ioctl+0x1ba/0x220
[   27.943169]  x64_sys_call+0x122e/0x2150
[   27.943391]  do_syscall_64+0x6d/0x150
[   27.943606]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   27.943888] RIP: 0033:0x7fa223c3ee5d
[   27.944097] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   27.945091] RSP: 002b:00007ffff8d5a928 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.945531] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fa223c3ee5d
[   27.945928] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.946315] RBP: 00007ffff8d5a940 R08: 0000000000000800 R09: 0000000000000800
[   27.946712] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffff8d5aa58
[   27.947104] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fa223f45000
[   27.947498]  </TASK>
[   27.947630] Modules linked in:
[   27.947984] ---[ end trace 0000000000000000 ]---
[   27.948287] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   27.948616] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   27.949633] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   27.949929] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   27.950323] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   27.950730] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   27.951153] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   27.951582] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   27.951977] FS:  00007fa223efc600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.952424] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.952751] CR2: 00000000200006c0 CR3: 0000000011d5a006 CR4: 0000000000770ef0
[   27.953166] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.953577] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.953969] PKRU: 55555554
[   27.954612] ------------[ cut here ]------------
[   27.954895] WARNING: CPU: 0 PID: 776 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   27.955460] Modules linked in:
[   27.955659] CPU: 0 UID: 0 PID: 776 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.956404] Tainted: [D]=DIE, [W]=WARN
[   27.956641] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.957278] RIP: 0010:iommufd_fops_release+0x386/0x420
[   27.957600] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   27.958607] RSP: 0018:ffff8880123efc08 EFLAGS: 00010293
[   27.958910] RAX: 0000000000000000 RBX: ffff888021e9b008 RCX: ffffffff83afe4ca
[   27.959309] RDX: ffff888021592540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   27.959709] RBP: ffff8880123efcb8 R08: 0000000000000000 R09: 0000000000000000
[   27.960111] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   27.960518] R13: 0000000000000000 R14: ffff8880123efc50 R15: 0000000000000000
[   27.960928] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.961605] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.961932] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   27.962326] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.962725] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.963115] PKRU: 55555554
[   27.963275] Call Trace:
[   27.963420]  <TASK>
[   27.963551]  ? show_regs+0x6d/0x80
[   27.963757]  ? __warn+0xf3/0x380
[   27.963951]  ? report_bug+0x25e/0x4b0
[   27.964169]  ? iommufd_fops_release+0x386/0x420
[   27.964431]  ? report_bug+0x2cb/0x4b0
[   27.964648]  ? iommufd_fops_release+0x386/0x420
[   27.964912]  ? iommufd_fops_release+0x386/0x420
[   27.965180]  ? handle_bug+0x2cd/0x510
[   27.965437]  ? iommufd_fops_release+0x388/0x420
[   27.965701]  ? exc_invalid_op+0x3c/0x80
[   27.965926]  ? asm_exc_invalid_op+0x1f/0x30
[   27.966168]  ? iommufd_fops_release+0x21a/0x420
[   27.966428]  ? iommufd_fops_release+0x386/0x420
[   27.966690]  ? iommufd_fops_release+0x386/0x420
[   27.966956]  ? iommufd_fops_release+0x386/0x420
[   27.967218]  ? locks_remove_file+0x3b4/0x5d0
[   27.967468]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.967746]  ? __memcg_slab_free_hook+0xc1/0x540
[   27.968014]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   27.968319]  ? evm_file_release+0x141/0x220
[   27.968563]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.968844]  __fput+0x41c/0xb70
[   27.969041]  ____fput+0x22/0x30
[   27.969230]  task_work_run+0x19b/0x2b0
[   27.969498]  ? __pfx_task_work_run+0x10/0x10
[   27.969747]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   27.970051]  ? switch_task_namespaces+0xc6/0x110
[   27.970318]  do_exit+0xb0e/0x29d0
[   27.970517]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.970806]  ? __pfx_do_exit+0x10/0x10
[   27.971026]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.971296]  ? __x64_sys_ioctl+0x1ba/0x220
[   27.971537]  make_task_dead+0x181/0x3c0
[   27.971770]  rewind_stack_and_make_dead+0x16/0x20
[   27.972055] RIP: 0033:0x7fa223c3ee5d
[   27.972276] Code: Unable to access opcode bytes at 0x7fa223c3ee33.
[   27.972621] RSP: 002b:00007ffff8d5a928 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.973052] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fa223c3ee5d
[   27.973505] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.973900] RBP: 00007ffff8d5a940 R08: 0000000000000800 R09: 0000000000000800
[   27.974289] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffff8d5aa58
[   27.974684] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fa223f45000
[   27.975088]  </TASK>
[   27.975222] irq event stamp: 0
[   27.975402] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   27.975756] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   27.976212] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   27.976669] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   27.977017] ---[ end trace 0000000000000000 ]---
[   27.977381] ------------[ cut here ]------------
[   27.977641] WARNING: CPU: 0 PID: 776 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   27.978169] Modules linked in:
[   27.978353] CPU: 0 UID: 0 PID: 776 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   27.979001] Tainted: [D]=DIE, [W]=WARN
[   27.979213] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   27.979828] RIP: 0010:iommufd_fops_release+0x392/0x420
[   27.980119] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   27.981115] RSP: 0018:ffff8880123efc08 EFLAGS: 00010293
[   27.981461] RAX: 0000000000000000 RBX: ffff888021e9b008 RCX: ffffffff83afe4ca
[   27.981853] RDX: ffff888021592540 RSI: ffffffff83afe642 RDI: ffff888021e9b0a0
[   27.982245] RBP: ffff8880123efcb8 R08: 0000000000000000 R09: 0000000000000000
[   27.982640] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   27.983037] R13: 0000000000000000 R14: ffff8880123efc50 R15: 0000000000000000
[   27.983431] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   27.983885] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   27.984212] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   27.984617] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   27.985022] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   27.985489] PKRU: 55555554
[   27.985650] Call Trace:
[   27.985796]  <TASK>
[   27.985925]  ? show_regs+0x6d/0x80
[   27.986127]  ? __warn+0xf3/0x380
[   27.986319]  ? report_bug+0x25e/0x4b0
[   27.986532]  ? iommufd_fops_release+0x392/0x420
[   27.986793]  ? report_bug+0x2cb/0x4b0
[   27.987007]  ? iommufd_fops_release+0x392/0x420
[   27.987285]  ? iommufd_fops_release+0x392/0x420
[   27.987543]  ? handle_bug+0x2cd/0x510
[   27.987762]  ? iommufd_fops_release+0x394/0x420
[   27.988024]  ? exc_invalid_op+0x3c/0x80
[   27.988252]  ? asm_exc_invalid_op+0x1f/0x30
[   27.988495]  ? iommufd_fops_release+0x21a/0x420
[   27.988758]  ? iommufd_fops_release+0x392/0x420
[   27.989023]  ? iommufd_fops_release+0x392/0x420
[   27.989286]  ? iommufd_fops_release+0x392/0x420
[   27.989594]  ? locks_remove_file+0x3b4/0x5d0
[   27.989842]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.990116]  ? __memcg_slab_free_hook+0xc1/0x540
[   27.990386]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   27.990739]  ? evm_file_release+0x141/0x220
[   27.991028]  ? __pfx_iommufd_fops_release+0x10/0x10
[   27.991339]  __fput+0x41c/0xb70
[   27.991548]  ____fput+0x22/0x30
[   27.991758]  task_work_run+0x19b/0x2b0
[   27.991996]  ? __pfx_task_work_run+0x10/0x10
[   27.992266]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   27.992596]  ? switch_task_namespaces+0xc6/0x110
[   27.992896]  do_exit+0xb0e/0x29d0
[   27.993108]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   27.993474]  ? __pfx_do_exit+0x10/0x10
[   27.993710]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   27.993998]  ? __x64_sys_ioctl+0x1ba/0x220
[   27.994254]  make_task_dead+0x181/0x3c0
[   27.994494]  rewind_stack_and_make_dead+0x16/0x20
[   27.994789] RIP: 0033:0x7fa223c3ee5d
[   27.995012] Code: Unable to access opcode bytes at 0x7fa223c3ee33.
[   27.995373] RSP: 002b:00007ffff8d5a928 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   27.995815] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fa223c3ee5d
[   27.996233] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   27.996672] RBP: 00007ffff8d5a940 R08: 0000000000000800 R09: 0000000000000800
[   27.997112] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffff8d5aa58
[   27.997600] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fa223f45000
[   27.998045]  </TASK>
[   27.998194] irq event stamp: 0
[   27.998393] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   27.998785] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   27.999294] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   27.999801] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.000189] ---[ end trace 0000000000000000 ]---
[   28.005652] iommufd_mock iommufd_mock46: Adding to iommu group 46
[   28.006275] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#47] SMP KASAN NOPTI
[   28.007005] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   28.007479] CPU: 0 UID: 0 PID: 777 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.008164] Tainted: [D]=DIE, [W]=WARN
[   28.008390] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.009043] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.009388] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.010433] RSP: 0018:ffff88801c9b7b78 EFLAGS: 00010246
[   28.010748] RAX: dffffc0000000000 RBX: ffff888013e5b800 RCX: 1ffffffff0dd8bdc
[   28.011159] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801c8b07fc
[   28.011571] RBP: ffff88801c9b7bc8 R08: 0000000000000000 R09: 0000000000000000
[   28.011983] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   28.012395] R13: 0000000000000001 R14: ffff88801c9b7e18 R15: ffff8880126a2808
[   28.012805] FS:  00007f917e27c600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.013272] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.013608] CR2: 00000000200006c0 CR3: 0000000011d5a005 CR4: 0000000000770ef0
[   28.014022] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.014431] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.014845] PKRU: 55555554
[   28.015012] Call Trace:
[   28.015164]  <TASK>
[   28.015301]  ? show_regs+0x6d/0x80
[   28.015515]  ? die_addr+0x45/0xb0
[   28.015723]  ? exc_general_protection+0x1ad/0x340
[   28.016017]  ? asm_exc_general_protection+0x2b/0x30
[   28.016313]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.016618]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   28.016926]  iommufd_device_detach+0x2a/0x2e0
[   28.017194]  iommufd_test+0x2f99/0x5cd0
[   28.017430]  ? do_raw_spin_unlock+0x15c/0x210
[   28.017699]  ? __pfx_iommufd_test+0x10/0x10
[   28.017952]  ? debug_smp_processor_id+0x20/0x30
[   28.018228]  ? rcu_is_watching+0x19/0xc0
[   28.018471]  ? lock_release+0x1ea/0x2c0
[   28.018719]  ? __might_fault+0xf1/0x1b0
[   28.018976]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   28.019320]  iommufd_fops_ioctl+0x38e/0x520
[   28.019582]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.019880]  ? trace_irq_enable+0xd1/0x110
[   28.020145]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.020458]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.020750]  __x64_sys_ioctl+0x1ba/0x220
[   28.020997]  x64_sys_call+0x122e/0x2150
[   28.021239]  do_syscall_64+0x6d/0x150
[   28.021467]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   28.021768] RIP: 0033:0x7f917e03ee5d
[   28.021988] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   28.023050] RSP: 002b:00007fff5239a018 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.023488] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f917e03ee5d
[   28.023898] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.024308] RBP: 00007fff5239a030 R08: 0000000000000800 R09: 0000000000000800
[   28.024718] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff5239a148
[   28.025126] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f917e2c5000
[   28.025542]  </TASK>
[   28.025680] Modules linked in:
[   28.025957] ---[ end trace 0000000000000000 ]---
[   28.026234] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.026573] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.027619] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   28.027927] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   28.028339] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   28.028749] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   28.029161] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   28.029584] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   28.029996] FS:  00007f917e27c600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.030458] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.030798] CR2: 00000000200006c0 CR3: 0000000011d5a005 CR4: 0000000000770ef0
[   28.031210] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.031622] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.032031] PKRU: 55555554
[   28.032626] ------------[ cut here ]------------
[   28.032923] WARNING: CPU: 0 PID: 777 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   28.033531] Modules linked in:
[   28.033730] CPU: 0 UID: 0 PID: 777 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.034419] Tainted: [D]=DIE, [W]=WARN
[   28.034645] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.035297] RIP: 0010:iommufd_fops_release+0x386/0x420
[   28.035604] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   28.036645] RSP: 0018:ffff88801c9b7c08 EFLAGS: 00010293
[   28.036955] RAX: 0000000000000000 RBX: ffff888021e9d008 RCX: ffffffff83afe4ca
[   28.037388] RDX: ffff88801c8b0000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   28.037808] RBP: ffff88801c9b7cb8 R08: 0000000000000000 R09: 0000000000000000
[   28.038221] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.038636] R13: 0000000000000000 R14: ffff88801c9b7c50 R15: 0000000000000000
[   28.039052] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.039512] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.039849] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   28.040262] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.040676] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.041088] PKRU: 55555554
[   28.041256] Call Trace:
[   28.041424]  <TASK>
[   28.041564]  ? show_regs+0x6d/0x80
[   28.041789]  ? __warn+0xf3/0x380
[   28.041995]  ? report_bug+0x25e/0x4b0
[   28.042220]  ? iommufd_fops_release+0x386/0x420
[   28.042499]  ? report_bug+0x2cb/0x4b0
[   28.042733]  ? iommufd_fops_release+0x386/0x420
[   28.043010]  ? iommufd_fops_release+0x386/0x420
[   28.043287]  ? handle_bug+0x2cd/0x510
[   28.043514]  ? iommufd_fops_release+0x388/0x420
[   28.043792]  ? exc_invalid_op+0x3c/0x80
[   28.044035]  ? asm_exc_invalid_op+0x1f/0x30
[   28.044297]  ? iommufd_fops_release+0x21a/0x420
[   28.044571]  ? iommufd_fops_release+0x386/0x420
[   28.044844]  ? iommufd_fops_release+0x386/0x420
[   28.045121]  ? iommufd_fops_release+0x386/0x420
[   28.045417]  ? locks_remove_file+0x3b4/0x5d0
[   28.045686]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.045985]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.046273]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.046598]  ? evm_file_release+0x141/0x220
[   28.046857]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.047152]  __fput+0x41c/0xb70
[   28.047352]  ____fput+0x22/0x30
[   28.047551]  task_work_run+0x19b/0x2b0
[   28.047787]  ? __pfx_task_work_run+0x10/0x10
[   28.048051]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.048371]  ? switch_task_namespaces+0xc6/0x110
[   28.048654]  do_exit+0xb0e/0x29d0
[   28.048867]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.049168]  ? __pfx_do_exit+0x10/0x10
[   28.049425]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.049720]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.049976]  make_task_dead+0x181/0x3c0
[   28.050212]  rewind_stack_and_make_dead+0x16/0x20
[   28.050497] RIP: 0033:0x7f917e03ee5d
[   28.050722] Code: Unable to access opcode bytes at 0x7f917e03ee33.
[   28.051090] RSP: 002b:00007fff5239a018 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.051535] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f917e03ee5d
[   28.051951] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.052429] RBP: 00007fff5239a030 R08: 0000000000000800 R09: 0000000000000800
[   28.053200] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff5239a148
[   28.053655] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f917e2c5000
[   28.054108]  </TASK>
[   28.054288] irq event stamp: 0
[   28.054539] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.055060] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.055566] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.056080] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.056490] ---[ end trace 0000000000000000 ]---
[   28.056889] ------------[ cut here ]------------
[   28.057293] WARNING: CPU: 0 PID: 777 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   28.057908] Modules linked in:
[   28.058166] CPU: 0 UID: 0 PID: 777 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.058991] Tainted: [D]=DIE, [W]=WARN
[   28.059239] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.060001] RIP: 0010:iommufd_fops_release+0x392/0x420
[   28.060441] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   28.061724] RSP: 0018:ffff88801c9b7c08 EFLAGS: 00010293
[   28.062056] RAX: 0000000000000000 RBX: ffff888021e9d008 RCX: ffffffff83afe4ca
[   28.062508] RDX: ffff88801c8b0000 RSI: ffffffff83afe642 RDI: ffff888021e9d0a0
[   28.063077] RBP: ffff88801c9b7cb8 R08: 0000000000000000 R09: 0000000000000000
[   28.063515] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.064015] R13: 0000000000000000 R14: ffff88801c9b7c50 R15: 0000000000000000
[   28.064552] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.065104] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.065542] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   28.065986] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.066428] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.066874] PKRU: 55555554
[   28.067053] Call Trace:
[   28.067216]  <TASK>
[   28.067360]  ? show_regs+0x6d/0x80
[   28.067588]  ? __warn+0xf3/0x380
[   28.067803]  ? report_bug+0x25e/0x4b0
[   28.068046]  ? iommufd_fops_release+0x392/0x420
[   28.068340]  ? report_bug+0x2cb/0x4b0
[   28.068581]  ? iommufd_fops_release+0x392/0x420
[   28.068873]  ? iommufd_fops_release+0x392/0x420
[   28.069165]  ? handle_bug+0x2cd/0x510
[   28.069443]  ? iommufd_fops_release+0x394/0x420
[   28.069741]  ? exc_invalid_op+0x3c/0x80
[   28.069993]  ? asm_exc_invalid_op+0x1f/0x30
[   28.070264]  ? iommufd_fops_release+0x21a/0x420
[   28.070558]  ? iommufd_fops_release+0x392/0x420
[   28.070856]  ? iommufd_fops_release+0x392/0x420
[   28.071175]  ? iommufd_fops_release+0x392/0x420
[   28.071497]  ? locks_remove_file+0x3b4/0x5d0
[   28.071828]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.072153]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.072466]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.072823]  ? evm_file_release+0x141/0x220
[   28.073113]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.073470]  __fput+0x41c/0xb70
[   28.073698]  ____fput+0x22/0x30
[   28.073925]  task_work_run+0x19b/0x2b0
[   28.074173]  ? __pfx_task_work_run+0x10/0x10
[   28.074450]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.074802]  ? switch_task_namespaces+0xc6/0x110
[   28.075104]  do_exit+0xb0e/0x29d0
[   28.075331]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.075649]  ? __pfx_do_exit+0x10/0x10
[   28.075896]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.076199]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.076466]  make_task_dead+0x181/0x3c0
[   28.076720]  rewind_stack_and_make_dead+0x16/0x20
[   28.077022] RIP: 0033:0x7f917e03ee5d
[   28.077257] Code: Unable to access opcode bytes at 0x7f917e03ee33.
[   28.077656] RSP: 002b:00007fff5239a018 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.078139] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f917e03ee5d
[   28.078594] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.079036] RBP: 00007fff5239a030 R08: 0000000000000800 R09: 0000000000000800
[   28.079479] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff5239a148
[   28.079920] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f917e2c5000
[   28.080368]  </TASK>
[   28.080520] irq event stamp: 0
[   28.080722] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.081116] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.081652] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.082212] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.082607] ---[ end trace 0000000000000000 ]---
[   28.088023] iommufd_mock iommufd_mock47: Adding to iommu group 47
[   28.088749] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#48] SMP KASAN NOPTI
[   28.089585] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   28.090085] CPU: 0 UID: 0 PID: 778 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.090872] Tainted: [D]=DIE, [W]=WARN
[   28.091128] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.091863] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.092264] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.093454] RSP: 0018:ffff88801117fb78 EFLAGS: 00010246
[   28.093804] RAX: dffffc0000000000 RBX: ffff888013e5a400 RCX: 1ffffffff0dd8bdc
[   28.094271] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801c8b527c
[   28.094744] RBP: ffff88801117fbc8 R08: 0000000000000000 R09: 0000000000000000
[   28.095211] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   28.095679] R13: 0000000000000001 R14: ffff88801117fe18 R15: ffff888015198008
[   28.096146] FS:  00007faef8465600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.096670] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.097052] CR2: 00000000200006c0 CR3: 0000000011d5a002 CR4: 0000000000770ef0
[   28.097521] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.097988] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.098456] PKRU: 55555554
[   28.098645] Call Trace:
[   28.098822]  <TASK>
[   28.098976]  ? show_regs+0x6d/0x80
[   28.099219]  ? die_addr+0x45/0xb0
[   28.099455]  ? exc_general_protection+0x1ad/0x340
[   28.099787]  ? asm_exc_general_protection+0x2b/0x30
[   28.100122]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.100467]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   28.100815]  iommufd_device_detach+0x2a/0x2e0
[   28.101120]  iommufd_test+0x2f99/0x5cd0
[   28.101386]  ? do_raw_spin_unlock+0x15c/0x210
[   28.101694]  ? __pfx_iommufd_test+0x10/0x10
[   28.101982]  ? debug_smp_processor_id+0x20/0x30
[   28.102294]  ? rcu_is_watching+0x19/0xc0
[   28.102568]  ? lock_release+0x1ea/0x2c0
[   28.102839]  ? __might_fault+0xf1/0x1b0
[   28.103109]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   28.103477]  iommufd_fops_ioctl+0x38e/0x520
[   28.103766]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.104094]  ? trace_irq_enable+0xd1/0x110
[   28.104387]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.104731]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.105057]  __x64_sys_ioctl+0x1ba/0x220
[   28.105338]  x64_sys_call+0x122e/0x2150
[   28.105607]  do_syscall_64+0x6d/0x150
[   28.105866]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   28.106210] RIP: 0033:0x7faef823ee5d
[   28.106460] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   28.107672] RSP: 002b:00007ffc51aa3798 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.108178] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007faef823ee5d
[   28.108651] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.109122] RBP: 00007ffc51aa37b0 R08: 0000000000000800 R09: 0000000000000800
[   28.109595] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc51aa38c8
[   28.110064] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007faef84ae000
[   28.110538]  </TASK>
[   28.110695] Modules linked in:
[   28.111034] ---[ end trace 0000000000000000 ]---
[   28.111349] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.111784] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.112823] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   28.113137] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   28.113656] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   28.114070] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   28.114482] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   28.114920] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   28.115392] FS:  00007faef8465600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.115976] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.116362] CR2: 00000000200006c0 CR3: 0000000011d5a002 CR4: 0000000000770ef0
[   28.116828] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.117298] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.117885] PKRU: 55555554
[   28.118808] ------------[ cut here ]------------
[   28.119123] WARNING: CPU: 0 PID: 778 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   28.119739] Modules linked in:
[   28.119990] CPU: 0 UID: 0 PID: 778 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.122053] Tainted: [D]=DIE, [W]=WARN
[   28.122597] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.123441] RIP: 0010:iommufd_fops_release+0x386/0x420
[   28.123792] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   28.124996] RSP: 0018:ffff88801117fc08 EFLAGS: 00010293
[   28.125404] RAX: 0000000000000000 RBX: ffff888021e9b808 RCX: ffffffff83afe4ca
[   28.125874] RDX: ffff88801c8b4a80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   28.126346] RBP: ffff88801117fcb8 R08: 0000000000000000 R09: 0000000000000000
[   28.126820] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.127299] R13: 0000000000000000 R14: ffff88801117fc50 R15: 0000000000000000
[   28.127776] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.128308] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.128684] CR2: 00000000200006c0 CR3: 0000000007086005 CR4: 0000000000770ef0
[   28.129147] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.129675] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.130162] PKRU: 55555554
[   28.130350] Call Trace:
[   28.130525]  <TASK>
[   28.130677]  ? show_regs+0x6d/0x80
[   28.130921]  ? __warn+0xf3/0x380
[   28.131150]  ? report_bug+0x25e/0x4b0
[   28.131405]  ? iommufd_fops_release+0x386/0x420
[   28.131714]  ? report_bug+0x2cb/0x4b0
[   28.131968]  ? iommufd_fops_release+0x386/0x420
[   28.132285]  ? iommufd_fops_release+0x386/0x420
[   28.132598]  ? handle_bug+0x2cd/0x510
[   28.132859]  ? iommufd_fops_release+0x388/0x420
[   28.133176]  ? exc_invalid_op+0x3c/0x80
[   28.133463]  ? asm_exc_invalid_op+0x1f/0x30
[   28.133760]  ? iommufd_fops_release+0x21a/0x420
[   28.134072]  ? iommufd_fops_release+0x386/0x420
[   28.134379]  ? iommufd_fops_release+0x386/0x420
[   28.134688]  ? iommufd_fops_release+0x386/0x420
[   28.135003]  ? locks_remove_file+0x3b4/0x5d0
[   28.135299]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.135630]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.135948]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.136326]  ? evm_file_release+0x141/0x220
[   28.136614]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.136944]  __fput+0x41c/0xb70
[   28.137167]  ____fput+0x22/0x30
[   28.137400]  task_work_run+0x19b/0x2b0
[   28.137661]  ? __pfx_task_work_run+0x10/0x10
[   28.137954]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.138311]  ? switch_task_namespaces+0xc6/0x110
[   28.138638]  do_exit+0xb0e/0x29d0
[   28.138877]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.139231]  ? __pfx_do_exit+0x10/0x10
[   28.139503]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.139824]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.140105]  make_task_dead+0x181/0x3c0
[   28.140371]  rewind_stack_and_make_dead+0x16/0x20
[   28.140684] RIP: 0033:0x7faef823ee5d
[   28.140932] Code: Unable to access opcode bytes at 0x7faef823ee33.
[   28.141348] RSP: 002b:00007ffc51aa3798 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.141858] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007faef823ee5d
[   28.142332] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.142797] RBP: 00007ffc51aa37b0 R08: 0000000000000800 R09: 0000000000000800
[   28.143260] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc51aa38c8
[   28.143724] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007faef84ae000
[   28.144206]  </TASK>
[   28.144363] irq event stamp: 0
[   28.144572] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.144997] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.145553] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.146088] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.146503] ---[ end trace 0000000000000000 ]---
[   28.146875] ------------[ cut here ]------------
[   28.147242] WARNING: CPU: 0 PID: 778 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   28.147918] Modules linked in:
[   28.148145] CPU: 0 UID: 0 PID: 778 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.148935] Tainted: [D]=DIE, [W]=WARN
[   28.149189] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.149930] RIP: 0010:iommufd_fops_release+0x392/0x420
[   28.150276] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   28.151490] RSP: 0018:ffff88801117fc08 EFLAGS: 00010293
[   28.151836] RAX: 0000000000000000 RBX: ffff888021e9b808 RCX: ffffffff83afe4ca
[   28.152295] RDX: ffff88801c8b4a80 RSI: ffffffff83afe642 RDI: ffff888021e9b8a0
[   28.152758] RBP: ffff88801117fcb8 R08: 0000000000000000 R09: 0000000000000000
[   28.153226] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.153714] R13: 0000000000000000 R14: ffff88801117fc50 R15: 0000000000000000
[   28.154186] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.154712] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.155096] CR2: 00000000200006c0 CR3: 0000000007086005 CR4: 0000000000770ef0
[   28.155561] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.156036] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.156511] PKRU: 55555554
[   28.156704] Call Trace:
[   28.156879]  <TASK>
[   28.157030]  ? show_regs+0x6d/0x80
[   28.157268]  ? __warn+0xf3/0x380
[   28.157509]  ? report_bug+0x25e/0x4b0
[   28.157762]  ? iommufd_fops_release+0x392/0x420
[   28.158069]  ? report_bug+0x2cb/0x4b0
[   28.158322]  ? iommufd_fops_release+0x392/0x420
[   28.158637]  ? iommufd_fops_release+0x392/0x420
[   28.158949]  ? handle_bug+0x2cd/0x510
[   28.159209]  ? iommufd_fops_release+0x394/0x420
[   28.159524]  ? exc_invalid_op+0x3c/0x80
[   28.159794]  ? asm_exc_invalid_op+0x1f/0x30
[   28.160085]  ? iommufd_fops_release+0x21a/0x420
[   28.160401]  ? iommufd_fops_release+0x392/0x420
[   28.160713]  ? iommufd_fops_release+0x392/0x420
[   28.161026]  ? iommufd_fops_release+0x392/0x420
[   28.161351]  ? locks_remove_file+0x3b4/0x5d0
[   28.161649]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.161981]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.162302]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.162661]  ? evm_file_release+0x141/0x220
[   28.162949]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.163275]  __fput+0x41c/0xb70
[   28.163499]  ____fput+0x22/0x30
[   28.163718]  task_work_run+0x19b/0x2b0
[   28.163979]  ? __pfx_task_work_run+0x10/0x10
[   28.164281]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.164642]  ? switch_task_namespaces+0xc6/0x110
[   28.164976]  do_exit+0xb0e/0x29d0
[   28.165221]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.165573]  ? __pfx_do_exit+0x10/0x10
[   28.165838]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.166160]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.166446]  make_task_dead+0x181/0x3c0
[   28.166716]  rewind_stack_and_make_dead+0x16/0x20
[   28.167046] RIP: 0033:0x7faef823ee5d
[   28.167292] Code: Unable to access opcode bytes at 0x7faef823ee33.
[   28.167699] RSP: 002b:00007ffc51aa3798 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.168197] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007faef823ee5d
[   28.168658] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.169122] RBP: 00007ffc51aa37b0 R08: 0000000000000800 R09: 0000000000000800
[   28.169600] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc51aa38c8
[   28.170070] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007faef84ae000
[   28.170543]  </TASK>
[   28.170708] irq event stamp: 0
[   28.170919] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.171337] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.171877] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.172416] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.172834] ---[ end trace 0000000000000000 ]---
[   28.178847] iommufd_mock iommufd_mock48: Adding to iommu group 48
[   28.179551] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#49] SMP KASAN NOPTI
[   28.180289] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   28.180786] CPU: 0 UID: 0 PID: 779 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.181571] Tainted: [D]=DIE, [W]=WARN
[   28.181824] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.182561] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.183034] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.184212] RSP: 0018:ffff8880123efb78 EFLAGS: 00010246
[   28.184562] RAX: dffffc0000000000 RBX: ffff888013e5ba00 RCX: 1ffffffff0dd8bdc
[   28.185027] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801729d27c
[   28.185491] RBP: ffff8880123efbc8 R08: 0000000000000000 R09: 0000000000000000
[   28.185962] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   28.186431] R13: 0000000000000001 R14: ffff8880123efe18 R15: ffff88800dfe9408
[   28.186899] FS:  00007f4069f7b600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.187425] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.187806] CR2: 00000000200006c0 CR3: 000000001cb7e005 CR4: 0000000000770ef0
[   28.188280] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.188747] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.189216] PKRU: 55555554
[   28.189405] Call Trace:
[   28.189580]  <TASK>
[   28.189734]  ? show_regs+0x6d/0x80
[   28.189978]  ? die_addr+0x45/0xb0
[   28.190215]  ? exc_general_protection+0x1ad/0x340
[   28.190547]  ? asm_exc_general_protection+0x2b/0x30
[   28.190889]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.191240]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   28.191590]  iommufd_device_detach+0x2a/0x2e0
[   28.191897]  iommufd_test+0x2f99/0x5cd0
[   28.192164]  ? do_raw_spin_unlock+0x15c/0x210
[   28.192472]  ? __pfx_iommufd_test+0x10/0x10
[   28.192760]  ? debug_smp_processor_id+0x20/0x30
[   28.193078]  ? rcu_is_watching+0x19/0xc0
[   28.193355]  ? lock_release+0x1ea/0x2c0
[   28.193627]  ? __might_fault+0xf1/0x1b0
[   28.193906]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   28.194279]  iommufd_fops_ioctl+0x38e/0x520
[   28.194573]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.194909]  ? trace_irq_enable+0xd1/0x110
[   28.195206]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.195550]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.195874]  __x64_sys_ioctl+0x1ba/0x220
[   28.196149]  x64_sys_call+0x122e/0x2150
[   28.196416]  do_syscall_64+0x6d/0x150
[   28.196675]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   28.197018] RIP: 0033:0x7f4069c3ee5d
[   28.197269] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   28.198461] RSP: 002b:00007ffcb12c06f8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.198966] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f4069c3ee5d
[   28.199435] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.199905] RBP: 00007ffcb12c0710 R08: 0000000000000800 R09: 0000000000000800
[   28.200375] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcb12c0828
[   28.200846] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f4069fc4000
[   28.201324]  </TASK>
[   28.201483] Modules linked in:
[   28.201863] ---[ end trace 0000000000000000 ]---
[   28.202180] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.202567] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.203760] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   28.204112] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   28.204583] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   28.205051] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   28.205600] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   28.206073] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   28.206539] FS:  00007f4069f7b600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.207072] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.207457] CR2: 00000000200006c0 CR3: 000000001cb7e005 CR4: 0000000000770ef0
[   28.207928] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.208396] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.208868] PKRU: 55555554
[   28.210134] ------------[ cut here ]------------
[   28.210487] WARNING: CPU: 0 PID: 779 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   28.211274] Modules linked in:
[   28.211503] CPU: 0 UID: 0 PID: 779 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.212408] Tainted: [D]=DIE, [W]=WARN
[   28.212671] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.213478] RIP: 0010:iommufd_fops_release+0x386/0x420
[   28.213910] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   28.215122] RSP: 0018:ffff8880123efc08 EFLAGS: 00010293
[   28.215489] RAX: 0000000000000000 RBX: ffff888021e9e008 RCX: ffffffff83afe4ca
[   28.216087] RDX: ffff88801729ca80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   28.216570] RBP: ffff8880123efcb8 R08: 0000000000000000 R09: 0000000000000000
[   28.217160] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.217661] R13: 0000000000000000 R14: ffff8880123efc50 R15: 0000000000000000
[   28.218144] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.218728] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.219193] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   28.219678] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.220200] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.220745] PKRU: 55555554
[   28.220943] Call Trace:
[   28.221122]  <TASK>
[   28.221289]  ? show_regs+0x6d/0x80
[   28.221639]  ? __warn+0xf3/0x380
[   28.221880]  ? report_bug+0x25e/0x4b0
[   28.222145]  ? iommufd_fops_release+0x386/0x420
[   28.222467]  ? report_bug+0x2cb/0x4b0
[   28.222735]  ? iommufd_fops_release+0x386/0x420
[   28.223095]  ? iommufd_fops_release+0x386/0x420
[   28.223478]  ? handle_bug+0x2cd/0x510
[   28.223745]  ? iommufd_fops_release+0x388/0x420
[   28.224105]  ? exc_invalid_op+0x3c/0x80
[   28.224435]  ? asm_exc_invalid_op+0x1f/0x30
[   28.224732]  ? iommufd_fops_release+0x21a/0x420
[   28.225053]  ? iommufd_fops_release+0x386/0x420
[   28.225413]  ? iommufd_fops_release+0x386/0x420
[   28.225827]  ? iommufd_fops_release+0x386/0x420
[   28.226160]  ? locks_remove_file+0x3b4/0x5d0
[   28.226474]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.226830]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.227167]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.227566]  ? evm_file_release+0x141/0x220
[   28.227964]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.228316]  __fput+0x41c/0xb70
[   28.228558]  ____fput+0x22/0x30
[   28.228793]  task_work_run+0x19b/0x2b0
[   28.229109]  ? __pfx_task_work_run+0x10/0x10
[   28.229504]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.229890]  ? switch_task_namespaces+0xc6/0x110
[   28.230226]  do_exit+0xb0e/0x29d0
[   28.230469]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.230874]  ? __pfx_do_exit+0x10/0x10
[   28.231195]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.231526]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.231818]  make_task_dead+0x181/0x3c0
[   28.232093]  rewind_stack_and_make_dead+0x16/0x20
[   28.232515] RIP: 0033:0x7f4069c3ee5d
[   28.232772] Code: Unable to access opcode bytes at 0x7f4069c3ee33.
[   28.233190] RSP: 002b:00007ffcb12c06f8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.233805] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f4069c3ee5d
[   28.234288] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.234777] RBP: 00007ffcb12c0710 R08: 0000000000000800 R09: 0000000000000800
[   28.235374] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcb12c0828
[   28.235857] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f4069fc4000
[   28.236346]  </TASK>
[   28.236510] irq event stamp: 0
[   28.236823] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.237253] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.237822] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.238480] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.238912] ---[ end trace 0000000000000000 ]---
[   28.239287] ------------[ cut here ]------------
[   28.239624] WARNING: CPU: 0 PID: 779 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   28.240337] Modules linked in:
[   28.240564] CPU: 0 UID: 0 PID: 779 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.241471] Tainted: [D]=DIE, [W]=WARN
[   28.241736] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.242530] RIP: 0010:iommufd_fops_release+0x392/0x420
[   28.242939] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   28.244313] RSP: 0018:ffff8880123efc08 EFLAGS: 00010293
[   28.244704] RAX: 0000000000000000 RBX: ffff888021e9e008 RCX: ffffffff83afe4ca
[   28.245271] RDX: ffff88801729ca80 RSI: ffffffff83afe642 RDI: ffff888021e9e0a0
[   28.245861] RBP: ffff8880123efcb8 R08: 0000000000000000 R09: 0000000000000000
[   28.246344] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.246901] R13: 0000000000000000 R14: ffff8880123efc50 R15: 0000000000000000
[   28.247466] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.248026] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.248468] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   28.249034] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.249531] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.250093] PKRU: 55555554
[   28.250290] Call Trace:
[   28.250468]  <TASK>
[   28.250626]  ? show_regs+0x6d/0x80
[   28.250959]  ? __warn+0xf3/0x380
[   28.251200]  ? report_bug+0x25e/0x4b0
[   28.251463]  ? iommufd_fops_release+0x392/0x420
[   28.251859]  ? report_bug+0x2cb/0x4b0
[   28.252124]  ? iommufd_fops_release+0x392/0x420
[   28.252527]  ? iommufd_fops_release+0x392/0x420
[   28.252850]  ? handle_bug+0x2cd/0x510
[   28.253115]  ? iommufd_fops_release+0x394/0x420
[   28.253531]  ? exc_invalid_op+0x3c/0x80
[   28.253811]  ? asm_exc_invalid_op+0x1f/0x30
[   28.254109]  ? iommufd_fops_release+0x21a/0x420
[   28.254505]  ? iommufd_fops_release+0x392/0x420
[   28.254833]  ? iommufd_fops_release+0x392/0x420
[   28.255159]  ? iommufd_fops_release+0x392/0x420
[   28.255559]  ? locks_remove_file+0x3b4/0x5d0
[   28.255868]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.256288]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.256619]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.257068]  ? evm_file_release+0x141/0x220
[   28.257387]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.257733]  __fput+0x41c/0xb70
[   28.258056]  ____fput+0x22/0x30
[   28.258288]  task_work_run+0x19b/0x2b0
[   28.258571]  ? __pfx_task_work_run+0x10/0x10
[   28.258989]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.259376]  ? switch_task_namespaces+0xc6/0x110
[   28.259803]  do_exit+0xb0e/0x29d0
[   28.260057]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.260497]  ? __pfx_do_exit+0x10/0x10
[   28.260775]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.261113]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.261528]  make_task_dead+0x181/0x3c0
[   28.261908]  rewind_stack_and_make_dead+0x16/0x20
[   28.262359] RIP: 0033:0x7f4069c3ee5d
[   28.262632] Code: Unable to access opcode bytes at 0x7f4069c3ee33.
[   28.263069] RSP: 002b:00007ffcb12c06f8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.263601] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f4069c3ee5d
[   28.264105] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.264603] RBP: 00007ffcb12c0710 R08: 0000000000000800 R09: 0000000000000800
[   28.265099] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcb12c0828
[   28.265650] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f4069fc4000
[   28.266159]  </TASK>
[   28.266336] irq event stamp: 0
[   28.266566] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.267007] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.267581] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.268148] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.268591] ---[ end trace 0000000000000000 ]---
[   28.276981] iommufd_mock iommufd_mock49: Adding to iommu group 49
[   28.277567] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#50] SMP KASAN NOPTI
[   28.278353] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   28.278871] CPU: 0 UID: 0 PID: 780 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.279675] Tainted: [D]=DIE, [W]=WARN
[   28.279942] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.280702] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.281109] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.282367] RSP: 0018:ffff888020d47b78 EFLAGS: 00010246
[   28.282737] RAX: dffffc0000000000 RBX: ffff888013e5a800 RCX: 1ffffffff0dd8bdc
[   28.283224] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801c8b2d3c
[   28.283705] RBP: ffff888020d47bc8 R08: 0000000000000000 R09: 0000000000000000
[   28.284190] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   28.284678] R13: 0000000000000001 R14: ffff888020d47e18 R15: ffff88800dfeb008
[   28.285166] FS:  00007f79253ad600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.285711] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.286106] CR2: 00000000200006c0 CR3: 000000001cb7e006 CR4: 0000000000770ef0
[   28.286594] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.287083] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.287568] PKRU: 55555554
[   28.287765] Call Trace:
[   28.287946]  <TASK>
[   28.288107]  ? show_regs+0x6d/0x80
[   28.288360]  ? die_addr+0x45/0xb0
[   28.288605]  ? exc_general_protection+0x1ad/0x340
[   28.288948]  ? asm_exc_general_protection+0x2b/0x30
[   28.289298]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.289656]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   28.290031]  iommufd_device_detach+0x2a/0x2e0
[   28.290364]  iommufd_test+0x2f99/0x5cd0
[   28.290653]  ? do_raw_spin_unlock+0x15c/0x210
[   28.290988]  ? __pfx_iommufd_test+0x10/0x10
[   28.291293]  ? debug_smp_processor_id+0x20/0x30
[   28.291630]  ? rcu_is_watching+0x19/0xc0
[   28.291928]  ? lock_release+0x1ea/0x2c0
[   28.292211]  ? __might_fault+0xf1/0x1b0
[   28.292504]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   28.292898]  iommufd_fops_ioctl+0x38e/0x520
[   28.293211]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.293559]  ? trace_irq_enable+0xd1/0x110
[   28.293870]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.294235]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.294581]  __x64_sys_ioctl+0x1ba/0x220
[   28.294880]  x64_sys_call+0x122e/0x2150
[   28.295164]  do_syscall_64+0x6d/0x150
[   28.295440]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   28.295809] RIP: 0033:0x7f792503ee5d
[   28.296066] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   28.297301] RSP: 002b:00007ffec6f6e318 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.297815] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f792503ee5d
[   28.298301] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.298789] RBP: 00007ffec6f6e330 R08: 0000000000000800 R09: 0000000000000800
[   28.299270] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffec6f6e448
[   28.299750] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f79253f6000
[   28.300238]  </TASK>
[   28.300401] Modules linked in:
[   28.300749] ---[ end trace 0000000000000000 ]---
[   28.301075] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.301547] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.302786] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   28.303147] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   28.303626] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   28.304113] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   28.304600] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   28.305083] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   28.305613] FS:  00007f79253ad600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.306168] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.306560] CR2: 00000000200006c0 CR3: 000000001cb7e006 CR4: 0000000000770ef0
[   28.307048] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.307529] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.308010] PKRU: 55555554
[   28.309695] ------------[ cut here ]------------
[   28.310030] WARNING: CPU: 1 PID: 780 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   28.310656] Modules linked in:
[   28.310873] CPU: 1 UID: 0 PID: 780 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.311648] Tainted: [D]=DIE, [W]=WARN
[   28.311903] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.312631] RIP: 0010:iommufd_fops_release+0x386/0x420
[   28.312977] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   28.314223] RSP: 0018:ffff888020d47c08 EFLAGS: 00010293
[   28.314578] RAX: 0000000000000000 RBX: ffff888021e9e808 RCX: ffffffff83afe4ca
[   28.315050] RDX: ffff88801c8b2540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   28.315646] RBP: ffff888020d47cb8 R08: 0000000000000000 R09: 0000000000000000
[   28.316218] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.316683] R13: 0000000000000000 R14: ffff888020d47c50 R15: 0000000000000000
[   28.317152] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   28.317720] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.318104] CR2: 00007f25f812f000 CR3: 000000001af88001 CR4: 0000000000770ef0
[   28.318574] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.319046] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.319515] PKRU: 55555554
[   28.319706] Call Trace:
[   28.319878]  <TASK>
[   28.320030]  ? show_regs+0x6d/0x80
[   28.320275]  ? __warn+0xf3/0x380
[   28.320505]  ? report_bug+0x25e/0x4b0
[   28.320763]  ? iommufd_fops_release+0x386/0x420
[   28.321113]  ? report_bug+0x2cb/0x4b0
[   28.321470]  ? iommufd_fops_release+0x386/0x420
[   28.321852]  ? iommufd_fops_release+0x386/0x420
[   28.322166]  ? handle_bug+0x2cd/0x510
[   28.322424]  ? iommufd_fops_release+0x388/0x420
[   28.322740]  ? exc_invalid_op+0x3c/0x80
[   28.323008]  ? asm_exc_invalid_op+0x1f/0x30
[   28.323296]  ? iommufd_fops_release+0x21a/0x420
[   28.323605]  ? iommufd_fops_release+0x386/0x420
[   28.323915]  ? iommufd_fops_release+0x386/0x420
[   28.324228]  ? iommufd_fops_release+0x386/0x420
[   28.324537]  ? locks_remove_file+0x3b4/0x5d0
[   28.324835]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.325168]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.325541]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.325925]  ? evm_file_release+0x141/0x220
[   28.326284]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.326736]  __fput+0x41c/0xb70
[   28.326969]  ____fput+0x22/0x30
[   28.327194]  task_work_run+0x19b/0x2b0
[   28.327462]  ? __pfx_task_work_run+0x10/0x10
[   28.327762]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.328127]  ? switch_task_namespaces+0xc6/0x110
[   28.328454]  do_exit+0xb0e/0x29d0
[   28.328718]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.329100]  ? __pfx_do_exit+0x10/0x10
[   28.329502]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.329825]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.330109]  make_task_dead+0x181/0x3c0
[   28.330376]  rewind_stack_and_make_dead+0x16/0x20
[   28.330721] RIP: 0033:0x7f792503ee5d
[   28.331001] Code: Unable to access opcode bytes at 0x7f792503ee33.
[   28.331508] RSP: 002b:00007ffec6f6e318 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.332060] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f792503ee5d
[   28.332627] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.333134] RBP: 00007ffec6f6e330 R08: 0000000000000800 R09: 0000000000000800
[   28.333727] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffec6f6e448
[   28.334245] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f79253f6000
[   28.334810]  </TASK>
[   28.334971] irq event stamp: 0
[   28.335219] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.335726] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.336312] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.336937] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.337427] ---[ end trace 0000000000000000 ]---
[   28.337873] ------------[ cut here ]------------
[   28.338191] WARNING: CPU: 1 PID: 780 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   28.338944] Modules linked in:
[   28.339202] CPU: 1 UID: 0 PID: 780 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.340112] Tainted: [D]=DIE, [W]=WARN
[   28.340409] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.341275] RIP: 0010:iommufd_fops_release+0x392/0x420
[   28.341772] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   28.343170] RSP: 0018:ffff888020d47c08 EFLAGS: 00010293
[   28.343650] RAX: 0000000000000000 RBX: ffff888021e9e808 RCX: ffffffff83afe4ca
[   28.344155] RDX: ffff88801c8b2540 RSI: ffffffff83afe642 RDI: ffff888021e9e8a0
[   28.344674] RBP: ffff888020d47cb8 R08: 0000000000000000 R09: 0000000000000000
[   28.345271] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.345921] R13: 0000000000000000 R14: ffff888020d47c50 R15: 0000000000000000
[   28.346421] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   28.347093] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.347511] CR2: 00007f25f812f000 CR3: 000000001af88001 CR4: 0000000000770ef0
[   28.348059] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.348544] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.349116] PKRU: 55555554
[   28.349308] Call Trace:
[   28.349522]  <TASK>
[   28.349698]  ? show_regs+0x6d/0x80
[   28.350028]  ? __warn+0xf3/0x380
[   28.350265]  ? report_bug+0x25e/0x4b0
[   28.350525]  ? iommufd_fops_release+0x392/0x420
[   28.350874]  ? report_bug+0x2cb/0x4b0
[   28.351203]  ? iommufd_fops_release+0x392/0x420
[   28.351543]  ? iommufd_fops_release+0x392/0x420
[   28.351912]  ? handle_bug+0x2cd/0x510
[   28.352173]  ? iommufd_fops_release+0x394/0x420
[   28.352497]  ? exc_invalid_op+0x3c/0x80
[   28.352815]  ? asm_exc_invalid_op+0x1f/0x30
[   28.353107]  ? iommufd_fops_release+0x21a/0x420
[   28.353439]  ? iommufd_fops_release+0x392/0x420
[   28.353753]  ? iommufd_fops_release+0x392/0x420
[   28.354067]  ? iommufd_fops_release+0x392/0x420
[   28.354382]  ? locks_remove_file+0x3b4/0x5d0
[   28.354682]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.355016]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.355334]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.355694]  ? evm_file_release+0x141/0x220
[   28.355981]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.356312]  __fput+0x41c/0xb70
[   28.356540]  ____fput+0x22/0x30
[   28.356763]  task_work_run+0x19b/0x2b0
[   28.357027]  ? __pfx_task_work_run+0x10/0x10
[   28.357343]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.357709]  ? switch_task_namespaces+0xc6/0x110
[   28.358033]  do_exit+0xb0e/0x29d0
[   28.358271]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.358607]  ? __pfx_do_exit+0x10/0x10
[   28.358874]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.359198]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.359483]  make_task_dead+0x181/0x3c0
[   28.359750]  rewind_stack_and_make_dead+0x16/0x20
[   28.360071] RIP: 0033:0x7f792503ee5d
[   28.360325] Code: Unable to access opcode bytes at 0x7f792503ee33.
[   28.360738] RSP: 002b:00007ffec6f6e318 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.361253] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f792503ee5d
[   28.361758] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.362248] RBP: 00007ffec6f6e330 R08: 0000000000000800 R09: 0000000000000800
[   28.362739] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffec6f6e448
[   28.363219] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f79253f6000
[   28.363710]  </TASK>
[   28.363873] irq event stamp: 0
[   28.364091] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.364515] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.365071] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.365641] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.366074] ---[ end trace 0000000000000000 ]---
[   28.370938] iommufd_mock iommufd_mock50: Adding to iommu group 50
[   28.372250] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#51] SMP KASAN NOPTI
[   28.372990] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   28.373490] CPU: 1 UID: 0 PID: 781 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.374263] Tainted: [D]=DIE, [W]=WARN
[   28.374517] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.375254] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.375641] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.376827] RSP: 0018:ffff888026d2fb78 EFLAGS: 00010246
[   28.377172] RAX: dffffc0000000000 RBX: ffff88800de5ce00 RCX: 1ffffffff0dd8bdd
[   28.377640] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801729ad3c
[   28.378105] RBP: ffff888026d2fbc8 R08: 0000000000000000 R09: 0000000000000000
[   28.378571] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   28.379039] R13: 0000000000000001 R14: ffff888026d2fe18 R15: ffff888014e23008
[   28.379504] FS:  00007f99a8c30600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   28.380027] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.380409] CR2: 00000000200006c0 CR3: 000000001cb7e006 CR4: 0000000000770ef0
[   28.380879] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.381344] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.381809] PKRU: 55555554
[   28.381998] Call Trace:
[   28.382171]  <TASK>
[   28.382325]  ? show_regs+0x6d/0x80
[   28.382568]  ? die_addr+0x45/0xb0
[   28.382808]  ? exc_general_protection+0x1ad/0x340
[   28.383141]  ? asm_exc_general_protection+0x2b/0x30
[   28.383479]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.383823]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   28.384171]  iommufd_device_detach+0x2a/0x2e0
[   28.384475]  iommufd_test+0x2f99/0x5cd0
[   28.384741]  ? do_raw_spin_unlock+0x15c/0x210
[   28.385047]  ? __pfx_iommufd_test+0x10/0x10
[   28.385335]  ? debug_smp_processor_id+0x20/0x30
[   28.385647]  ? rcu_is_watching+0x19/0xc0
[   28.385921]  ? lock_release+0x1ea/0x2c0
[   28.386187]  ? __might_fault+0xf1/0x1b0
[   28.386453]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   28.386819]  iommufd_fops_ioctl+0x38e/0x520
[   28.387108]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.387430]  ? trace_irq_enable+0xd1/0x110
[   28.387715]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.388064]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.388393]  __x64_sys_ioctl+0x1ba/0x220
[   28.388673]  x64_sys_call+0x122e/0x2150
[   28.388943]  do_syscall_64+0x6d/0x150
[   28.389206]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   28.389554] RIP: 0033:0x7f99a8a3ee5d
[   28.389810] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   28.391029] RSP: 002b:00007ffcad68afd8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.391538] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f99a8a3ee5d
[   28.392001] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.392464] RBP: 00007ffcad68aff0 R08: 0000000000000800 R09: 0000000000000800
[   28.392927] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcad68b108
[   28.393393] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f99a8c79000
[   28.393864]  </TASK>
[   28.394023] Modules linked in:
[   28.394320] ---[ end trace 0000000000000000 ]---
[   28.394653] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.395057] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.396339] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   28.396706] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   28.397174] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   28.397720] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   28.398193] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   28.398661] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   28.399129] FS:  00007f99a8c30600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   28.399651] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.400033] CR2: 00000000200006c0 CR3: 000000001cb7e006 CR4: 0000000000770ef0
[   28.400502] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.400968] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.401489] PKRU: 55555554
[   28.402204] ------------[ cut here ]------------
[   28.402556] WARNING: CPU: 0 PID: 781 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   28.403223] Modules linked in:
[   28.403455] CPU: 0 UID: 0 PID: 781 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.404272] Tainted: [D]=DIE, [W]=WARN
[   28.404541] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.405665] RIP: 0010:iommufd_fops_release+0x386/0x420
[   28.406052] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   28.407352] RSP: 0018:ffff888026d2fc08 EFLAGS: 00010293
[   28.407734] RAX: 0000000000000000 RBX: ffff888012ddf808 RCX: ffffffff83afe4ca
[   28.408243] RDX: ffff88801729a540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   28.408749] RBP: ffff888026d2fcb8 R08: 0000000000000000 R09: 0000000000000000
[   28.409247] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.409791] R13: 0000000000000000 R14: ffff888026d2fc50 R15: 0000000000000000
[   28.410295] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.410857] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.411260] CR2: 00007f25f813c000 CR3: 0000000007086004 CR4: 0000000000770ef0
[   28.411758] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.412254] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.412750] PKRU: 55555554
[   28.412945] Call Trace:
[   28.413123]  <TASK>
[   28.413281]  ? show_regs+0x6d/0x80
[   28.413572]  ? __warn+0xf3/0x380
[   28.413817]  ? report_bug+0x25e/0x4b0
[   28.414082]  ? iommufd_fops_release+0x386/0x420
[   28.414402]  ? report_bug+0x2cb/0x4b0
[   28.414668]  ? iommufd_fops_release+0x386/0x420
[   28.414993]  ? iommufd_fops_release+0x386/0x420
[   28.415314]  ? handle_bug+0x2cd/0x510
[   28.415579]  ? iommufd_fops_release+0x388/0x420
[   28.415901]  ? exc_invalid_op+0x3c/0x80
[   28.416178]  ? asm_exc_invalid_op+0x1f/0x30
[   28.416475]  ? iommufd_fops_release+0x21a/0x420
[   28.416796]  ? iommufd_fops_release+0x386/0x420
[   28.417115]  ? iommufd_fops_release+0x386/0x420
[   28.417487]  ? iommufd_fops_release+0x386/0x420
[   28.417816]  ? locks_remove_file+0x3b4/0x5d0
[   28.418126]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.418466]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.418798]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.419174]  ? evm_file_release+0x141/0x220
[   28.419472]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.419814]  __fput+0x41c/0xb70
[   28.420049]  ____fput+0x22/0x30
[   28.420280]  task_work_run+0x19b/0x2b0
[   28.420552]  ? __pfx_task_work_run+0x10/0x10
[   28.420859]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.421234]  ? switch_task_namespaces+0xc6/0x110
[   28.421608]  do_exit+0xb0e/0x29d0
[   28.421861]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.422212]  ? __pfx_do_exit+0x10/0x10
[   28.422482]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.422821]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.423113]  make_task_dead+0x181/0x3c0
[   28.423388]  rewind_stack_and_make_dead+0x16/0x20
[   28.423718] RIP: 0033:0x7f99a8a3ee5d
[   28.423975] Code: Unable to access opcode bytes at 0x7f99a8a3ee33.
[   28.424393] RSP: 002b:00007ffcad68afd8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.424905] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f99a8a3ee5d
[   28.425434] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.425923] RBP: 00007ffcad68aff0 R08: 0000000000000800 R09: 0000000000000800
[   28.426406] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcad68b108
[   28.426906] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f99a8c79000
[   28.427411]  </TASK>
[   28.427579] irq event stamp: 0
[   28.427804] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.428247] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.428822] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.429436] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.429867] ---[ end trace 0000000000000000 ]---
[   28.430239] ------------[ cut here ]------------
[   28.430561] WARNING: CPU: 0 PID: 781 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   28.431208] Modules linked in:
[   28.431434] CPU: 0 UID: 0 PID: 781 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.432232] Tainted: [D]=DIE, [W]=WARN
[   28.432495] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.433254] RIP: 0010:iommufd_fops_release+0x392/0x420
[   28.433659] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   28.434893] RSP: 0018:ffff888026d2fc08 EFLAGS: 00010293
[   28.435255] RAX: 0000000000000000 RBX: ffff888012ddf808 RCX: ffffffff83afe4ca
[   28.435736] RDX: ffff88801729a540 RSI: ffffffff83afe642 RDI: ffff888012ddf8a0
[   28.436216] RBP: ffff888026d2fcb8 R08: 0000000000000000 R09: 0000000000000000
[   28.436698] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.437178] R13: 0000000000000000 R14: ffff888026d2fc50 R15: 0000000000000000
[   28.437697] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.438242] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.438636] CR2: 00007f25f813c000 CR3: 0000000007086004 CR4: 0000000000770ef0
[   28.439122] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.439604] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.440086] PKRU: 55555554
[   28.440280] Call Trace:
[   28.440458]  <TASK>
[   28.440615]  ? show_regs+0x6d/0x80
[   28.440864]  ? __warn+0xf3/0x380
[   28.441100]  ? report_bug+0x25e/0x4b0
[   28.441399]  ? iommufd_fops_release+0x392/0x420
[   28.441723]  ? report_bug+0x2cb/0x4b0
[   28.441986]  ? iommufd_fops_release+0x392/0x420
[   28.442321]  ? iommufd_fops_release+0x392/0x420
[   28.442649]  ? handle_bug+0x2cd/0x510
[   28.442923]  ? iommufd_fops_release+0x394/0x420
[   28.443251]  ? exc_invalid_op+0x3c/0x80
[   28.443535]  ? asm_exc_invalid_op+0x1f/0x30
[   28.443842]  ? iommufd_fops_release+0x21a/0x420
[   28.444168]  ? iommufd_fops_release+0x392/0x420
[   28.444498]  ? iommufd_fops_release+0x392/0x420
[   28.444829]  ? iommufd_fops_release+0x392/0x420
[   28.445160]  ? locks_remove_file+0x3b4/0x5d0
[   28.445519]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.445872]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.446212]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.446599]  ? evm_file_release+0x141/0x220
[   28.446910]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.447263]  __fput+0x41c/0xb70
[   28.447501]  ____fput+0x22/0x30
[   28.447737]  task_work_run+0x19b/0x2b0
[   28.448020]  ? __pfx_task_work_run+0x10/0x10
[   28.448336]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.448722]  ? switch_task_namespaces+0xc6/0x110
[   28.449061]  do_exit+0xb0e/0x29d0
[   28.449311]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.449711]  ? __pfx_do_exit+0x10/0x10
[   28.449991]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.450335]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.450637]  make_task_dead+0x181/0x3c0
[   28.450922]  rewind_stack_and_make_dead+0x16/0x20
[   28.451261] RIP: 0033:0x7f99a8a3ee5d
[   28.451527] Code: Unable to access opcode bytes at 0x7f99a8a3ee33.
[   28.451957] RSP: 002b:00007ffcad68afd8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.452485] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f99a8a3ee5d
[   28.452981] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.453522] RBP: 00007ffcad68aff0 R08: 0000000000000800 R09: 0000000000000800
[   28.454020] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcad68b108
[   28.454522] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f99a8c79000
[   28.455025]  </TASK>
[   28.455193] irq event stamp: 0
[   28.455418] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.455859] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.456431] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.457004] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.457490] ---[ end trace 0000000000000000 ]---
[   28.462617] iommufd_mock iommufd_mock51: Adding to iommu group 51
[   28.463262] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#52] SMP KASAN NOPTI
[   28.464024] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   28.464538] CPU: 0 UID: 0 PID: 782 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.465338] Tainted: [D]=DIE, [W]=WARN
[   28.465602] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.466359] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.466762] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.467973] RSP: 0018:ffff88801ff57b78 EFLAGS: 00010246
[   28.468333] RAX: dffffc0000000000 RBX: ffff888013e5a600 RCX: 1ffffffff0dd8bdc
[   28.468815] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880172987fc
[   28.469295] RBP: ffff88801ff57bc8 R08: 0000000000000000 R09: 0000000000000000
[   28.469777] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   28.470257] R13: 0000000000000001 R14: ffff88801ff57e18 R15: ffff88800dfebc08
[   28.470742] FS:  00007fe70cf5c600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.471281] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.471673] CR2: 00000000200006c0 CR3: 000000001fe14006 CR4: 0000000000770ef0
[   28.472156] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.472636] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.473119] PKRU: 55555554
[   28.473313] Call Trace:
[   28.473504]  <TASK>
[   28.473668]  ? show_regs+0x6d/0x80
[   28.473927]  ? die_addr+0x45/0xb0
[   28.474179]  ? exc_general_protection+0x1ad/0x340
[   28.474528]  ? asm_exc_general_protection+0x2b/0x30
[   28.474888]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.475258]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   28.475627]  iommufd_device_detach+0x2a/0x2e0
[   28.475953]  iommufd_test+0x2f99/0x5cd0
[   28.476238]  ? do_raw_spin_unlock+0x15c/0x210
[   28.476563]  ? __pfx_iommufd_test+0x10/0x10
[   28.476870]  ? debug_smp_processor_id+0x20/0x30
[   28.477204]  ? rcu_is_watching+0x19/0xc0
[   28.477496]  ? lock_release+0x1ea/0x2c0
[   28.477781]  ? __might_fault+0xf1/0x1b0
[   28.478069]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   28.478460]  iommufd_fops_ioctl+0x38e/0x520
[   28.478772]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.479116]  ? trace_irq_enable+0xd1/0x110
[   28.479424]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.479781]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.480122]  __x64_sys_ioctl+0x1ba/0x220
[   28.480414]  x64_sys_call+0x122e/0x2150
[   28.480693]  do_syscall_64+0x6d/0x150
[   28.480965]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   28.481321] RIP: 0033:0x7fe70cc3ee5d
[   28.481587] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   28.482844] RSP: 002b:00007ffd5ee82ea8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.483355] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fe70cc3ee5d
[   28.483836] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.484316] RBP: 00007ffd5ee82ec0 R08: 0000000000000800 R09: 0000000000000800
[   28.484797] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd5ee82fd8
[   28.485279] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fe70cfa5000
[   28.485767]  </TASK>
[   28.485929] Modules linked in:
[   28.486319] ---[ end trace 0000000000000000 ]---
[   28.486645] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.487049] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.488272] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   28.488634] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   28.489120] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   28.489614] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   28.490100] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   28.490583] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   28.491067] FS:  00007fe70cf5c600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.491610] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.492000] CR2: 00000000200006c0 CR3: 000000001fe14006 CR4: 0000000000770ef0
[   28.492483] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.492965] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.493457] PKRU: 55555554
[   28.494079] ------------[ cut here ]------------
[   28.494408] WARNING: CPU: 0 PID: 782 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   28.495015] Modules linked in:
[   28.495238] CPU: 0 UID: 0 PID: 782 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.496062] Tainted: [D]=DIE, [W]=WARN
[   28.496330] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.497112] RIP: 0010:iommufd_fops_release+0x386/0x420
[   28.497500] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   28.498760] RSP: 0018:ffff88801ff57c08 EFLAGS: 00010293
[   28.499134] RAX: 0000000000000000 RBX: ffff888021757008 RCX: ffffffff83afe4ca
[   28.499634] RDX: ffff888017298000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   28.500129] RBP: ffff88801ff57cb8 R08: 0000000000000000 R09: 0000000000000000
[   28.500625] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.501118] R13: 0000000000000000 R14: ffff88801ff57c50 R15: 0000000000000000
[   28.501627] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.502185] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.502589] CR2: 00000000200006c0 CR3: 0000000007086004 CR4: 0000000000770ef0
[   28.503096] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.503591] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.504081] PKRU: 55555554
[   28.504284] Call Trace:
[   28.504468]  <TASK>
[   28.504632]  ? show_regs+0x6d/0x80
[   28.504889]  ? __warn+0xf3/0x380
[   28.505131]  ? report_bug+0x25e/0x4b0
[   28.505420]  ? iommufd_fops_release+0x386/0x420
[   28.505757]  ? report_bug+0x2cb/0x4b0
[   28.506028]  ? iommufd_fops_release+0x386/0x420
[   28.506359]  ? iommufd_fops_release+0x386/0x420
[   28.506687]  ? handle_bug+0x2cd/0x510
[   28.506964]  ? iommufd_fops_release+0x388/0x420
[   28.507289]  ? exc_invalid_op+0x3c/0x80
[   28.507565]  ? asm_exc_invalid_op+0x1f/0x30
[   28.507863]  ? iommufd_fops_release+0x21a/0x420
[   28.508184]  ? iommufd_fops_release+0x386/0x420
[   28.508504]  ? iommufd_fops_release+0x386/0x420
[   28.508825]  ? iommufd_fops_release+0x386/0x420
[   28.509145]  ? locks_remove_file+0x3b4/0x5d0
[   28.509467]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.509809]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.510137]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.510509]  ? evm_file_release+0x141/0x220
[   28.510810]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.511151]  __fput+0x41c/0xb70
[   28.511386]  ____fput+0x22/0x30
[   28.511616]  task_work_run+0x19b/0x2b0
[   28.511889]  ? __pfx_task_work_run+0x10/0x10
[   28.512195]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.512569]  ? switch_task_namespaces+0xc6/0x110
[   28.512898]  do_exit+0xb0e/0x29d0
[   28.513143]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.513507]  ? __pfx_do_exit+0x10/0x10
[   28.513778]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.514110]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.514402]  make_task_dead+0x181/0x3c0
[   28.514678]  rewind_stack_and_make_dead+0x16/0x20
[   28.515014] RIP: 0033:0x7fe70cc3ee5d
[   28.515271] Code: Unable to access opcode bytes at 0x7fe70cc3ee33.
[   28.515689] RSP: 002b:00007ffd5ee82ea8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.516199] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fe70cc3ee5d
[   28.516679] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.517160] RBP: 00007ffd5ee82ec0 R08: 0000000000000800 R09: 0000000000000800
[   28.517656] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd5ee82fd8
[   28.518142] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fe70cfa5000
[   28.518632]  </TASK>
[   28.518803] irq event stamp: 0
[   28.519022] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.519451] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.520006] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.520586] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.521021] ---[ end trace 0000000000000000 ]---
[   28.521426] ------------[ cut here ]------------
[   28.521758] WARNING: CPU: 0 PID: 782 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   28.522425] Modules linked in:
[   28.522656] CPU: 0 UID: 0 PID: 782 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.523481] Tainted: [D]=DIE, [W]=WARN
[   28.523749] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.524523] RIP: 0010:iommufd_fops_release+0x392/0x420
[   28.524891] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   28.526165] RSP: 0018:ffff88801ff57c08 EFLAGS: 00010293
[   28.526540] RAX: 0000000000000000 RBX: ffff888021757008 RCX: ffffffff83afe4ca
[   28.527040] RDX: ffff888017298000 RSI: ffffffff83afe642 RDI: ffff8880217570a0
[   28.527537] RBP: ffff88801ff57cb8 R08: 0000000000000000 R09: 0000000000000000
[   28.528033] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.528531] R13: 0000000000000000 R14: ffff88801ff57c50 R15: 0000000000000000
[   28.529022] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.529596] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.530000] CR2: 00000000200006c0 CR3: 0000000007086004 CR4: 0000000000770ef0
[   28.530498] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.530991] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.531484] PKRU: 55555554
[   28.531684] Call Trace:
[   28.531866]  <TASK>
[   28.532028]  ? show_regs+0x6d/0x80
[   28.532276]  ? __warn+0xf3/0x380
[   28.532512]  ? report_bug+0x25e/0x4b0
[   28.532775]  ? iommufd_fops_release+0x392/0x420
[   28.533095]  ? report_bug+0x2cb/0x4b0
[   28.533373]  ? iommufd_fops_release+0x392/0x420
[   28.533694]  ? iommufd_fops_release+0x392/0x420
[   28.534014]  ? handle_bug+0x2cd/0x510
[   28.534277]  ? iommufd_fops_release+0x394/0x420
[   28.534599]  ? exc_invalid_op+0x3c/0x80
[   28.534881]  ? asm_exc_invalid_op+0x1f/0x30
[   28.535181]  ? iommufd_fops_release+0x21a/0x420
[   28.535498]  ? iommufd_fops_release+0x392/0x420
[   28.535819]  ? iommufd_fops_release+0x392/0x420
[   28.536140]  ? iommufd_fops_release+0x392/0x420
[   28.536459]  ? locks_remove_file+0x3b4/0x5d0
[   28.536765]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.537107]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.537448]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.537822]  ? evm_file_release+0x141/0x220
[   28.538122]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.538463]  __fput+0x41c/0xb70
[   28.538697]  ____fput+0x22/0x30
[   28.538931]  task_work_run+0x19b/0x2b0
[   28.539203]  ? __pfx_task_work_run+0x10/0x10
[   28.539507]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.539881]  ? switch_task_namespaces+0xc6/0x110
[   28.540210]  do_exit+0xb0e/0x29d0
[   28.540454]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.540802]  ? __pfx_do_exit+0x10/0x10
[   28.541071]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.541418]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.541712]  make_task_dead+0x181/0x3c0
[   28.541986]  rewind_stack_and_make_dead+0x16/0x20
[   28.542314] RIP: 0033:0x7fe70cc3ee5d
[   28.542570] Code: Unable to access opcode bytes at 0x7fe70cc3ee33.
[   28.542992] RSP: 002b:00007ffd5ee82ea8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.543502] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fe70cc3ee5d
[   28.543984] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.544464] RBP: 00007ffd5ee82ec0 R08: 0000000000000800 R09: 0000000000000800
[   28.544945] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd5ee82fd8
[   28.545449] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fe70cfa5000
[   28.545953]  </TASK>
[   28.546121] irq event stamp: 0
[   28.546348] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.546792] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.547363] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.547934] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.548377] ---[ end trace 0000000000000000 ]---
[   28.552782] iommufd_mock iommufd_mock52: Adding to iommu group 52
[   28.553795] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#53] SMP KASAN NOPTI
[   28.554557] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   28.555077] CPU: 0 UID: 0 PID: 783 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.555878] Tainted: [D]=DIE, [W]=WARN
[   28.556139] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.556897] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.557298] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.558523] RSP: 0018:ffff88801ff5fb78 EFLAGS: 00010246
[   28.558891] RAX: dffffc0000000000 RBX: ffff88801fe15e00 RCX: 1ffffffff0dd8bdc
[   28.559372] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff888012e72d3c
[   28.559850] RBP: ffff88801ff5fbc8 R08: 0000000000000000 R09: 0000000000000000
[   28.560329] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   28.560808] R13: 0000000000000001 R14: ffff88801ff5fe18 R15: ffff88800fde4c08
[   28.561288] FS:  00007f76fb8db600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.561830] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.562221] CR2: 00000000200006c0 CR3: 0000000013842004 CR4: 0000000000770ef0
[   28.562712] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.563192] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.563671] PKRU: 55555554
[   28.563866] Call Trace:
[   28.564043]  <TASK>
[   28.564201]  ? show_regs+0x6d/0x80
[   28.564451]  ? die_addr+0x45/0xb0
[   28.564692]  ? exc_general_protection+0x1ad/0x340
[   28.565033]  ? asm_exc_general_protection+0x2b/0x30
[   28.565378]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.565735]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   28.566094]  iommufd_device_detach+0x2a/0x2e0
[   28.566410]  iommufd_test+0x2f99/0x5cd0
[   28.566686]  ? do_raw_spin_unlock+0x15c/0x210
[   28.567006]  ? __pfx_iommufd_test+0x10/0x10
[   28.567301]  ? debug_smp_processor_id+0x20/0x30
[   28.567642]  ? rcu_is_watching+0x19/0xc0
[   28.567935]  ? lock_release+0x1ea/0x2c0
[   28.568221]  ? __might_fault+0xf1/0x1b0
[   28.568509]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   28.568893]  iommufd_fops_ioctl+0x38e/0x520
[   28.569201]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.569547]  ? trace_irq_enable+0xd1/0x110
[   28.569852]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.570209]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.570553]  __x64_sys_ioctl+0x1ba/0x220
[   28.570852]  x64_sys_call+0x122e/0x2150
[   28.571124]  do_syscall_64+0x6d/0x150
[   28.571388]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   28.571739] RIP: 0033:0x7f76fb63ee5d
[   28.571994] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   28.573213] RSP: 002b:00007ffca8bea9f8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.573725] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f76fb63ee5d
[   28.574205] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.574684] RBP: 00007ffca8beaa10 R08: 0000000000000800 R09: 0000000000000800
[   28.575195] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffca8beab28
[   28.575715] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f76fb924000
[   28.576239]  </TASK>
[   28.576416] Modules linked in:
[   28.576688] ---[ end trace 0000000000000000 ]---
[   28.577038] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.577505] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.578885] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   28.579268] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   28.579781] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   28.580279] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   28.580804] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   28.581484] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   28.581990] FS:  00007f76fb8db600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.582557] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.582975] CR2: 00000000200006c0 CR3: 0000000013842004 CR4: 0000000000770ef0
[   28.583485] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.584000] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.584525] PKRU: 55555554
[   28.585995] ------------[ cut here ]------------
[   28.586339] WARNING: CPU: 0 PID: 783 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   28.587073] Modules linked in:
[   28.587305] CPU: 0 UID: 0 PID: 783 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.588228] Tainted: [D]=DIE, [W]=WARN
[   28.588494] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.589252] RIP: 0010:iommufd_fops_release+0x386/0x420
[   28.589636] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   28.590878] RSP: 0018:ffff88801ff5fc08 EFLAGS: 00010293
[   28.591241] RAX: 0000000000000000 RBX: ffff888021753008 RCX: ffffffff83afe4ca
[   28.591722] RDX: ffff888012e72540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   28.592206] RBP: ffff88801ff5fcb8 R08: 0000000000000000 R09: 0000000000000000
[   28.592689] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.593173] R13: 0000000000000000 R14: ffff88801ff5fc50 R15: 0000000000000000
[   28.593673] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.594215] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.594607] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   28.595095] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.595577] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.596059] PKRU: 55555554
[   28.596254] Call Trace:
[   28.596432]  <TASK>
[   28.596589]  ? show_regs+0x6d/0x80
[   28.596840]  ? __warn+0xf3/0x380
[   28.597079]  ? report_bug+0x25e/0x4b0
[   28.597356]  ? iommufd_fops_release+0x386/0x420
[   28.597679]  ? report_bug+0x2cb/0x4b0
[   28.597943]  ? iommufd_fops_release+0x386/0x420
[   28.598264]  ? iommufd_fops_release+0x386/0x420
[   28.598585]  ? handle_bug+0x2cd/0x510
[   28.598853]  ? iommufd_fops_release+0x388/0x420
[   28.599174]  ? exc_invalid_op+0x3c/0x80
[   28.599452]  ? asm_exc_invalid_op+0x1f/0x30
[   28.599750]  ? iommufd_fops_release+0x21a/0x420
[   28.600072]  ? iommufd_fops_release+0x386/0x420
[   28.600394]  ? iommufd_fops_release+0x386/0x420
[   28.600716]  ? iommufd_fops_release+0x386/0x420
[   28.601038]  ? locks_remove_file+0x3b4/0x5d0
[   28.601363]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.601729]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.602065]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.602453]  ? evm_file_release+0x141/0x220
[   28.602773]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.603126]  __fput+0x41c/0xb70
[   28.603369]  ____fput+0x22/0x30
[   28.603607]  task_work_run+0x19b/0x2b0
[   28.603888]  ? __pfx_task_work_run+0x10/0x10
[   28.604205]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.604593]  ? switch_task_namespaces+0xc6/0x110
[   28.604931]  do_exit+0xb0e/0x29d0
[   28.605184]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.605557]  ? __pfx_do_exit+0x10/0x10
[   28.605839]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.606182]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.606486]  make_task_dead+0x181/0x3c0
[   28.606774]  rewind_stack_and_make_dead+0x16/0x20
[   28.607115] RIP: 0033:0x7f76fb63ee5d
[   28.607379] Code: Unable to access opcode bytes at 0x7f76fb63ee33.
[   28.607813] RSP: 002b:00007ffca8bea9f8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.608342] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f76fb63ee5d
[   28.608841] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.609349] RBP: 00007ffca8beaa10 R08: 0000000000000800 R09: 0000000000000800
[   28.609853] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffca8beab28
[   28.610350] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f76fb924000
[   28.610894]  </TASK>
[   28.611046] irq event stamp: 0
[   28.611248] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.611630] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.612127] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.612623] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.613003] ---[ end trace 0000000000000000 ]---
[   28.613371] ------------[ cut here ]------------
[   28.613657] WARNING: CPU: 0 PID: 783 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   28.614224] Modules linked in:
[   28.614425] CPU: 0 UID: 0 PID: 783 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.615138] Tainted: [D]=DIE, [W]=WARN
[   28.615372] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.616040] RIP: 0010:iommufd_fops_release+0x392/0x420
[   28.616356] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   28.617455] RSP: 0018:ffff88801ff5fc08 EFLAGS: 00010293
[   28.617775] RAX: 0000000000000000 RBX: ffff888021753008 RCX: ffffffff83afe4ca
[   28.618200] RDX: ffff888012e72540 RSI: ffffffff83afe642 RDI: ffff8880217530a0
[   28.618627] RBP: ffff88801ff5fcb8 R08: 0000000000000000 R09: 0000000000000000
[   28.619057] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.619482] R13: 0000000000000000 R14: ffff88801ff5fc50 R15: 0000000000000000
[   28.619909] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.620389] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.620740] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   28.621171] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.621612] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.622042] PKRU: 55555554
[   28.622216] Call Trace:
[   28.622375]  <TASK>
[   28.622516]  ? show_regs+0x6d/0x80
[   28.622742]  ? __warn+0xf3/0x380
[   28.622952]  ? report_bug+0x25e/0x4b0
[   28.623185]  ? iommufd_fops_release+0x392/0x420
[   28.623470]  ? report_bug+0x2cb/0x4b0
[   28.623704]  ? iommufd_fops_release+0x392/0x420
[   28.623989]  ? iommufd_fops_release+0x392/0x420
[   28.624276]  ? handle_bug+0x2cd/0x510
[   28.624512]  ? iommufd_fops_release+0x394/0x420
[   28.624800]  ? exc_invalid_op+0x3c/0x80
[   28.625045]  ? asm_exc_invalid_op+0x1f/0x30
[   28.625309]  ? iommufd_fops_release+0x21a/0x420
[   28.625608]  ? iommufd_fops_release+0x392/0x420
[   28.625894]  ? iommufd_fops_release+0x392/0x420
[   28.626178]  ? iommufd_fops_release+0x392/0x420
[   28.626461]  ? locks_remove_file+0x3b4/0x5d0
[   28.626739]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.627044]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.627336]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.627663]  ? evm_file_release+0x141/0x220
[   28.627918]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.628213]  __fput+0x41c/0xb70
[   28.628416]  ____fput+0x22/0x30
[   28.628615]  task_work_run+0x19b/0x2b0
[   28.628852]  ? __pfx_task_work_run+0x10/0x10
[   28.629117]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.629453]  ? switch_task_namespaces+0xc6/0x110
[   28.629742]  do_exit+0xb0e/0x29d0
[   28.629771] systemd-journald[145]: Data hash table of /run/log/journal/938775788448454bb5b34822d5730c41/system.journal has a fill level at 75.0 (5259 of 7011 items, 4038656 file size, 767 bytes per hash table item), suggesting rotation.
[   28.629953]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.631296] systemd-journald[145]: /run/log/journal/938775788448454bb5b34822d5730c41/system.journal: Journal header limits reached or header out-of-date, rotating.
[   28.631576]  ? __pfx_do_exit+0x10/0x10
[   28.632728]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.633018]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.633271]  make_task_dead+0x181/0x3c0
[   28.633521]  rewind_stack_and_make_dead+0x16/0x20
[   28.633810] RIP: 0033:0x7f76fb63ee5d
[   28.634030] Code: Unable to access opcode bytes at 0x7f76fb63ee33.
[   28.634393] RSP: 002b:00007ffca8bea9f8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.634843] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f76fb63ee5d
[   28.635258] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.635673] RBP: 00007ffca8beaa10 R08: 0000000000000800 R09: 0000000000000800
[   28.636089] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffca8beab28
[   28.636508] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f76fb924000
[   28.636932]  </TASK>
[   28.637076] irq event stamp: 0
[   28.637266] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.637644] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.638130] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.638611] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.638982] ---[ end trace 0000000000000000 ]---
[   28.643663] iommufd_mock iommufd_mock53: Adding to iommu group 53
[   28.644431] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#54] SMP KASAN NOPTI
[   28.645226] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   28.645668] CPU: 0 UID: 0 PID: 785 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.646350] Tainted: [D]=DIE, [W]=WARN
[   28.646574] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.647227] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.647572] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.648617] RSP: 0018:ffff88801a4ffb78 EFLAGS: 00010246
[   28.648927] RAX: dffffc0000000000 RBX: ffff88801fe14e00 RCX: 1ffffffff0dd8bdc
[   28.649339] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801a5c87fc
[   28.649749] RBP: ffff88801a4ffbc8 R08: 0000000000000000 R09: 0000000000000000
[   28.650162] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   28.650581] R13: 0000000000000001 R14: ffff88801a4ffe18 R15: ffff88800fde5408
[   28.651000] FS:  00007fca3bfb1600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.651478] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.651823] CR2: 00000000200006c0 CR3: 0000000013842005 CR4: 0000000000770ef0
[   28.652243] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.652667] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.653096] PKRU: 55555554
[   28.653267] Call Trace:
[   28.653423]  <TASK>
[   28.653564]  ? show_regs+0x6d/0x80
[   28.653781]  ? die_addr+0x45/0xb0
[   28.653992]  ? exc_general_protection+0x1ad/0x340
[   28.654290]  ? asm_exc_general_protection+0x2b/0x30
[   28.654591]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.654905]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   28.655222]  iommufd_device_detach+0x2a/0x2e0
[   28.655494]  iommufd_test+0x2f99/0x5cd0
[   28.655729]  ? do_raw_spin_unlock+0x15c/0x210
[   28.656004]  ? __pfx_iommufd_test+0x10/0x10
[   28.656259]  ? debug_smp_processor_id+0x20/0x30
[   28.656541]  ? rcu_is_watching+0x19/0xc0
[   28.656787]  ? lock_release+0x1ea/0x2c0
[   28.657023]  ? __might_fault+0xf1/0x1b0
[   28.657263]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   28.657585]  iommufd_fops_ioctl+0x38e/0x520
[   28.657841]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.658128]  ? trace_irq_enable+0xd1/0x110
[   28.658382]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.658681]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.658970]  __x64_sys_ioctl+0x1ba/0x220
[   28.659219]  x64_sys_call+0x122e/0x2150
[   28.659453]  do_syscall_64+0x6d/0x150
[   28.659677]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   28.659974] RIP: 0033:0x7fca3bc3ee5d
[   28.660192] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   28.661230] RSP: 002b:00007ffd37e5cb58 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.661674] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fca3bc3ee5d
[   28.662087] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.662498] RBP: 00007ffd37e5cb70 R08: 0000000000000800 R09: 0000000000000800
[   28.662911] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd37e5cc88
[   28.663321] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fca3bffa000
[   28.663738]  </TASK>
[   28.663877] Modules linked in:
[   28.664196] ---[ end trace 0000000000000000 ]---
[   28.664474] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.664814] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.665899] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   28.666210] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   28.666620] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   28.667038] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   28.667452] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   28.667862] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   28.668272] FS:  00007fca3bfb1600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.668732] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.669068] CR2: 00000000200006c0 CR3: 0000000013842005 CR4: 0000000000770ef0
[   28.669498] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.669911] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.670320] PKRU: 55555554
[   28.671102] ------------[ cut here ]------------
[   28.671382] WARNING: CPU: 0 PID: 785 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   28.671975] Modules linked in:
[   28.672170] CPU: 0 UID: 0 PID: 785 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.672957] Tainted: [D]=DIE, [W]=WARN
[   28.673183] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.673857] RIP: 0010:iommufd_fops_release+0x386/0x420
[   28.674172] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   28.675230] RSP: 0018:ffff88801a4ffc08 EFLAGS: 00010293
[   28.675536] RAX: 0000000000000000 RBX: ffff888021750008 RCX: ffffffff83afe4ca
[   28.675944] RDX: ffff88801a5c8000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   28.676350] RBP: ffff88801a4ffcb8 R08: 0000000000000000 R09: 0000000000000000
[   28.676757] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.677164] R13: 0000000000000000 R14: ffff88801a4ffc50 R15: 0000000000000000
[   28.677621] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.678080] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.678413] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   28.678826] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.679232] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.679638] PKRU: 55555554
[   28.679805] Call Trace:
[   28.679957]  <TASK>
[   28.680091]  ? show_regs+0x6d/0x80
[   28.680304]  ? __warn+0xf3/0x380
[   28.680507]  ? report_bug+0x25e/0x4b0
[   28.680733]  ? iommufd_fops_release+0x386/0x420
[   28.681006]  ? report_bug+0x2cb/0x4b0
[   28.681230]  ? iommufd_fops_release+0x386/0x420
[   28.681548]  ? iommufd_fops_release+0x386/0x420
[   28.681822]  ? handle_bug+0x2cd/0x510
[   28.682049]  ? iommufd_fops_release+0x388/0x420
[   28.682320]  ? exc_invalid_op+0x3c/0x80
[   28.682555]  ? asm_exc_invalid_op+0x1f/0x30
[   28.682812]  ? iommufd_fops_release+0x21a/0x420
[   28.683084]  ? iommufd_fops_release+0x386/0x420
[   28.683358]  ? iommufd_fops_release+0x386/0x420
[   28.683632]  ? iommufd_fops_release+0x386/0x420
[   28.683904]  ? locks_remove_file+0x3b4/0x5d0
[   28.684166]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.684456]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.684737]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.685054]  ? evm_file_release+0x141/0x220
[   28.685307]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.685650]  __fput+0x41c/0xb70
[   28.685851]  ____fput+0x22/0x30
[   28.686047]  task_work_run+0x19b/0x2b0
[   28.686281]  ? __pfx_task_work_run+0x10/0x10
[   28.686541]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.686868]  ? switch_task_namespaces+0xc6/0x110
[   28.687148]  do_exit+0xb0e/0x29d0
[   28.687356]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.687652]  ? __pfx_do_exit+0x10/0x10
[   28.687881]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.688164]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.688414]  make_task_dead+0x181/0x3c0
[   28.688649]  rewind_stack_and_make_dead+0x16/0x20
[   28.688928] RIP: 0033:0x7fca3bc3ee5d
[   28.689146] Code: Unable to access opcode bytes at 0x7fca3bc3ee33.
[   28.689573] RSP: 002b:00007ffd37e5cb58 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.690013] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fca3bc3ee5d
[   28.690421] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.690836] RBP: 00007ffd37e5cb70 R08: 0000000000000800 R09: 0000000000000800
[   28.691243] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd37e5cc88
[   28.691651] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fca3bffa000
[   28.692064]  </TASK>
[   28.692205] irq event stamp: 0
[   28.692391] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.692753] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.693226] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.693744] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.694110] ---[ end trace 0000000000000000 ]---
[   28.694434] ------------[ cut here ]------------
[   28.694708] WARNING: CPU: 0 PID: 785 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   28.695254] Modules linked in:
[   28.695448] CPU: 0 UID: 0 PID: 785 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.696123] Tainted: [D]=DIE, [W]=WARN
[   28.696345] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.696983] RIP: 0010:iommufd_fops_release+0x392/0x420
[   28.697287] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   28.698368] RSP: 0018:ffff88801a4ffc08 EFLAGS: 00010293
[   28.698755] RAX: 0000000000000000 RBX: ffff888021750008 RCX: ffffffff83afe4ca
[   28.699189] RDX: ffff88801a5c8000 RSI: ffffffff83afe642 RDI: ffff8880217500a0
[   28.699603] RBP: ffff88801a4ffcb8 R08: 0000000000000000 R09: 0000000000000000
[   28.700021] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.700445] R13: 0000000000000000 R14: ffff88801a4ffc50 R15: 0000000000000000
[   28.700866] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.701377] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.701724] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   28.702142] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.702573] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.702988] PKRU: 55555554
[   28.703155] Call Trace:
[   28.703312]  <TASK>
[   28.703451]  ? show_regs+0x6d/0x80
[   28.703673]  ? __warn+0xf3/0x380
[   28.703884]  ? report_bug+0x25e/0x4b0
[   28.704115]  ? iommufd_fops_release+0x392/0x420
[   28.704406]  ? report_bug+0x2cb/0x4b0
[   28.704650]  ? iommufd_fops_release+0x392/0x420
[   28.704946]  ? iommufd_fops_release+0x392/0x420
[   28.705249]  ? handle_bug+0x2cd/0x510
[   28.705499]  ? iommufd_fops_release+0x394/0x420
[   28.705791]  ? exc_invalid_op+0x3c/0x80
[   28.706034]  ? asm_exc_invalid_op+0x1f/0x30
[   28.706292]  ? iommufd_fops_release+0x21a/0x420
[   28.706564]  ? iommufd_fops_release+0x392/0x420
[   28.706837]  ? iommufd_fops_release+0x392/0x420
[   28.707104]  ? iommufd_fops_release+0x392/0x420
[   28.707391]  ? locks_remove_file+0x3b4/0x5d0
[   28.707667]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.707984]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.708279]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.708604]  ? evm_file_release+0x141/0x220
[   28.708878]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.709192]  __fput+0x41c/0xb70
[   28.709414]  ____fput+0x22/0x30
[   28.709617]  task_work_run+0x19b/0x2b0
[   28.709854]  ? __pfx_task_work_run+0x10/0x10
[   28.710114]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.710430]  ? switch_task_namespaces+0xc6/0x110
[   28.710718]  do_exit+0xb0e/0x29d0
[   28.710936]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.711239]  ? __pfx_do_exit+0x10/0x10
[   28.711480]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.711763]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.712011]  make_task_dead+0x181/0x3c0
[   28.712241]  rewind_stack_and_make_dead+0x16/0x20
[   28.712539] RIP: 0033:0x7fca3bc3ee5d
[   28.712773] Code: Unable to access opcode bytes at 0x7fca3bc3ee33.
[   28.713158] RSP: 002b:00007ffd37e5cb58 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.713618] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fca3bc3ee5d
[   28.714031] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.714440] RBP: 00007ffd37e5cb70 R08: 0000000000000800 R09: 0000000000000800
[   28.714865] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd37e5cc88
[   28.715298] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fca3bffa000
[   28.715739]  </TASK>
[   28.715883] irq event stamp: 0
[   28.716077] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.716466] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.716964] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.717486] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.717925] ---[ end trace 0000000000000000 ]---
[   28.725298] iommufd_mock iommufd_mock54: Adding to iommu group 54
[   28.727618] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#55] SMP KASAN NOPTI
[   28.728549] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   28.729128] CPU: 1 UID: 0 PID: 786 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.730086] Tainted: [D]=DIE, [W]=WARN
[   28.730359] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.731173] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.731618] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.732926] RSP: 0018:ffff888027257b78 EFLAGS: 00010246
[   28.733282] RAX: dffffc0000000000 RBX: ffff888012288e00 RCX: 1ffffffff0dd8bdd
[   28.733794] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801a5cad3c
[   28.734322] RBP: ffff888027257bc8 R08: 0000000000000000 R09: 0000000000000000
[   28.734827] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   28.735337] R13: 0000000000000001 R14: ffff888027257e18 R15: ffff88801538c408
[   28.735872] FS:  00007faf422b4600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   28.736467] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.736886] CR2: 00000000200006c0 CR3: 00000000118e6002 CR4: 0000000000770ef0
[   28.737408] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.737949] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.738477] PKRU: 55555554
[   28.738674] Call Trace:
[   28.738853]  <TASK>
[   28.739031]  ? show_regs+0x6d/0x80
[   28.739308]  ? die_addr+0x45/0xb0
[   28.739547]  ? exc_general_protection+0x1ad/0x340
[   28.739933]  ? asm_exc_general_protection+0x2b/0x30
[   28.740274]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.740711]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   28.741077]  iommufd_device_detach+0x2a/0x2e0
[   28.741436]  iommufd_test+0x2f99/0x5cd0
[   28.741705]  ? do_raw_spin_unlock+0x15c/0x210
[   28.742083]  ? __pfx_iommufd_test+0x10/0x10
[   28.742381]  ? debug_smp_processor_id+0x20/0x30
[   28.742765]  ? rcu_is_watching+0x19/0xc0
[   28.743041]  ? lock_release+0x1ea/0x2c0
[   28.743375]  ? __might_fault+0xf1/0x1b0
[   28.743649]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   28.744086]  iommufd_fops_ioctl+0x38e/0x520
[   28.744385]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.744773]  ? trace_irq_enable+0xd1/0x110
[   28.745084]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.745460]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.745804]  __x64_sys_ioctl+0x1ba/0x220
[   28.746124]  x64_sys_call+0x122e/0x2150
[   28.746420]  do_syscall_64+0x6d/0x150
[   28.746682]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   28.747116] RIP: 0033:0x7faf4203ee5d
[   28.747371] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   28.748723] RSP: 002b:00007fffb0621428 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.749302] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007faf4203ee5d
[   28.749782] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.750337] RBP: 00007fffb0621440 R08: 0000000000000800 R09: 0000000000000800
[   28.750867] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fffb0621558
[   28.751368] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007faf422fd000
[   28.751913]  </TASK>
[   28.752069] Modules linked in:
[   28.752355] ---[ end trace 0000000000000000 ]---
[   28.752726] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.753170] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.754489] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   28.754885] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   28.755391] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   28.755899] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   28.756413] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   28.756917] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   28.757503] FS:  00007faf422b4600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   28.758036] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.758481] CR2: 00000000200006c0 CR3: 00000000118e6002 CR4: 0000000000770ef0
[   28.758967] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.759490] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.760019] PKRU: 55555554
[   28.761811] ------------[ cut here ]------------
[   28.762100] WARNING: CPU: 0 PID: 786 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   28.762654] Modules linked in:
[   28.762856] CPU: 0 UID: 0 PID: 786 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.763539] Tainted: [D]=DIE, [W]=WARN
[   28.763762] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.764408] RIP: 0010:iommufd_fops_release+0x386/0x420
[   28.764716] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   28.765911] RSP: 0018:ffff888027257c08 EFLAGS: 00010293
[   28.766226] RAX: 0000000000000000 RBX: ffff8880138c9808 RCX: ffffffff83afe4ca
[   28.766639] RDX: ffff88801a5ca540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   28.767055] RBP: ffff888027257cb8 R08: 0000000000000000 R09: 0000000000000000
[   28.767467] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.767878] R13: 0000000000000000 R14: ffff888027257c50 R15: 0000000000000000
[   28.768289] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.768754] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.769090] CR2: 00007f08201d9008 CR3: 0000000007086002 CR4: 0000000000770ef0
[   28.769569] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.769983] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.770396] PKRU: 55555554
[   28.770563] Call Trace:
[   28.770721]  <TASK>
[   28.770857]  ? show_regs+0x6d/0x80
[   28.771071]  ? __warn+0xf3/0x380
[   28.771274]  ? report_bug+0x25e/0x4b0
[   28.771500]  ? iommufd_fops_release+0x386/0x420
[   28.771774]  ? report_bug+0x2cb/0x4b0
[   28.771999]  ? iommufd_fops_release+0x386/0x420
[   28.772273]  ? iommufd_fops_release+0x386/0x420
[   28.772547]  ? handle_bug+0x2cd/0x510
[   28.772774]  ? iommufd_fops_release+0x388/0x420
[   28.773050]  ? exc_invalid_op+0x3c/0x80
[   28.773285]  ? asm_exc_invalid_op+0x1f/0x30
[   28.773575]  ? iommufd_fops_release+0x21a/0x420
[   28.773851]  ? iommufd_fops_release+0x386/0x420
[   28.774126]  ? iommufd_fops_release+0x386/0x420
[   28.774401]  ? iommufd_fops_release+0x386/0x420
[   28.774676]  ? locks_remove_file+0x3b4/0x5d0
[   28.774944]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.775236]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.775517]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.775837]  ? evm_file_release+0x141/0x220
[   28.776093]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.776385]  __fput+0x41c/0xb70
[   28.776584]  ____fput+0x22/0x30
[   28.776782]  task_work_run+0x19b/0x2b0
[   28.777016]  ? __pfx_task_work_run+0x10/0x10
[   28.777277]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.777609]  ? switch_task_namespaces+0xc6/0x110
[   28.777894]  do_exit+0xb0e/0x29d0
[   28.778104]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.778403]  ? __pfx_do_exit+0x10/0x10
[   28.778634]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.778931]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.779183]  make_task_dead+0x181/0x3c0
[   28.779417]  rewind_stack_and_make_dead+0x16/0x20
[   28.779698] RIP: 0033:0x7faf4203ee5d
[   28.779916] Code: Unable to access opcode bytes at 0x7faf4203ee33.
[   28.780271] RSP: 002b:00007fffb0621428 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.780704] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007faf4203ee5d
[   28.781112] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.781536] RBP: 00007fffb0621440 R08: 0000000000000800 R09: 0000000000000800
[   28.781953] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fffb0621558
[   28.782405] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007faf422fd000
[   28.782825]  </TASK>
[   28.782966] irq event stamp: 0
[   28.783152] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.783520] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.783997] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.784480] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.784859] ---[ end trace 0000000000000000 ]---
[   28.785184] ------------[ cut here ]------------
[   28.785476] WARNING: CPU: 0 PID: 786 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   28.786067] Modules linked in:
[   28.786260] CPU: 0 UID: 0 PID: 786 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.786948] Tainted: [D]=DIE, [W]=WARN
[   28.787173] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.787821] RIP: 0010:iommufd_fops_release+0x392/0x420
[   28.788128] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   28.789178] RSP: 0018:ffff888027257c08 EFLAGS: 00010293
[   28.789504] RAX: 0000000000000000 RBX: ffff8880138c9808 RCX: ffffffff83afe4ca
[   28.789954] RDX: ffff88801a5ca540 RSI: ffffffff83afe642 RDI: ffff8880138c98a0
[   28.790374] RBP: ffff888027257cb8 R08: 0000000000000000 R09: 0000000000000000
[   28.790793] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.791204] R13: 0000000000000000 R14: ffff888027257c50 R15: 0000000000000000
[   28.791616] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   28.792081] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.792417] CR2: 00007f08201d9008 CR3: 0000000007086002 CR4: 0000000000770ef0
[   28.792832] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.793245] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.793672] PKRU: 55555554
[   28.793844] Call Trace:
[   28.794011]  <TASK>
[   28.794152]  ? show_regs+0x6d/0x80
[   28.794366]  ? __warn+0xf3/0x380
[   28.794569]  ? report_bug+0x25e/0x4b0
[   28.794801]  ? iommufd_fops_release+0x392/0x420
[   28.795076]  ? report_bug+0x2cb/0x4b0
[   28.795303]  ? iommufd_fops_release+0x392/0x420
[   28.795576]  ? iommufd_fops_release+0x392/0x420
[   28.795850]  ? handle_bug+0x2cd/0x510
[   28.796076]  ? iommufd_fops_release+0x394/0x420
[   28.796351]  ? exc_invalid_op+0x3c/0x80
[   28.796587]  ? asm_exc_invalid_op+0x1f/0x30
[   28.796842]  ? iommufd_fops_release+0x21a/0x420
[   28.797117]  ? iommufd_fops_release+0x392/0x420
[   28.797411]  ? iommufd_fops_release+0x392/0x420
[   28.797706]  ? iommufd_fops_release+0x392/0x420
[   28.797988]  ? locks_remove_file+0x3b4/0x5d0
[   28.798249]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.798538]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.798821]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.799141]  ? evm_file_release+0x141/0x220
[   28.799393]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.799683]  __fput+0x41c/0xb70
[   28.799882]  ____fput+0x22/0x30
[   28.800077]  task_work_run+0x19b/0x2b0
[   28.800308]  ? __pfx_task_work_run+0x10/0x10
[   28.800565]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.800882]  ? switch_task_namespaces+0xc6/0x110
[   28.801163]  do_exit+0xb0e/0x29d0
[   28.801392]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.801693]  ? __pfx_do_exit+0x10/0x10
[   28.801927]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.802211]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.802460]  make_task_dead+0x181/0x3c0
[   28.802695]  rewind_stack_and_make_dead+0x16/0x20
[   28.802981] RIP: 0033:0x7faf4203ee5d
[   28.803198] Code: Unable to access opcode bytes at 0x7faf4203ee33.
[   28.803553] RSP: 002b:00007fffb0621428 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.803992] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007faf4203ee5d
[   28.804401] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.804810] RBP: 00007fffb0621440 R08: 0000000000000800 R09: 0000000000000800
[   28.805217] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fffb0621558
[   28.805639] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007faf422fd000
[   28.806069]  </TASK>
[   28.806209] irq event stamp: 0
[   28.806395] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.806764] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.807236] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.807709] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.808072] ---[ end trace 0000000000000000 ]---
[   28.815796] iommufd_mock iommufd_mock55: Adding to iommu group 55
[   28.817112] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#56] SMP KASAN NOPTI
[   28.817870] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   28.818385] CPU: 1 UID: 0 PID: 787 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.819146] Tainted: [D]=DIE, [W]=WARN
[   28.819404] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.820171] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.820590] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.821903] RSP: 0018:ffff888026ef7b78 EFLAGS: 00010246
[   28.822254] RAX: dffffc0000000000 RBX: ffff888012288c00 RCX: 1ffffffff0dd8bdd
[   28.822717] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880125ead3c
[   28.823171] RBP: ffff888026ef7bc8 R08: 0000000000000000 R09: 0000000000000000
[   28.823631] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   28.824080] R13: 0000000000000001 R14: ffff888026ef7e18 R15: ffff888010525c08
[   28.824533] FS:  00007f5abc5aa600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   28.825048] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.825421] CR2: 00000000200006c0 CR3: 0000000013ad4004 CR4: 0000000000770ef0
[   28.825879] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.826337] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.826802] PKRU: 55555554
[   28.826991] Call Trace:
[   28.827161]  <TASK>
[   28.827312]  ? show_regs+0x6d/0x80
[   28.827550]  ? die_addr+0x45/0xb0
[   28.827781]  ? exc_general_protection+0x1ad/0x340
[   28.828103]  ? asm_exc_general_protection+0x2b/0x30
[   28.828431]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.828773]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   28.829111]  iommufd_device_detach+0x2a/0x2e0
[   28.829409]  iommufd_test+0x2f99/0x5cd0
[   28.829673]  ? do_raw_spin_unlock+0x15c/0x210
[   28.829975]  ? __pfx_iommufd_test+0x10/0x10
[   28.830257]  ? debug_smp_processor_id+0x20/0x30
[   28.830564]  ? rcu_is_watching+0x19/0xc0
[   28.830840]  ? lock_release+0x1ea/0x2c0
[   28.831102]  ? __might_fault+0xf1/0x1b0
[   28.831365]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   28.831726]  iommufd_fops_ioctl+0x38e/0x520
[   28.832009]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.832320]  ? trace_irq_enable+0xd1/0x110
[   28.832598]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.832926]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.833243]  __x64_sys_ioctl+0x1ba/0x220
[   28.833512]  x64_sys_call+0x122e/0x2150
[   28.833774]  do_syscall_64+0x6d/0x150
[   28.834030]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   28.834370] RIP: 0033:0x7f5abc23ee5d
[   28.834618] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   28.835822] RSP: 002b:00007ffcbbd48778 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.836322] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f5abc23ee5d
[   28.836782] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.837243] RBP: 00007ffcbbd48790 R08: 0000000000000800 R09: 0000000000000800
[   28.837705] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcbbd488a8
[   28.838168] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f5abc5f3000
[   28.838637]  </TASK>
[   28.838797] Modules linked in:
[   28.839088] ---[ end trace 0000000000000000 ]---
[   28.839427] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.839835] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.841116] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   28.841531] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   28.842002] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   28.842472] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   28.842946] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   28.843415] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   28.843881] FS:  00007f5abc5aa600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   28.844409] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.844791] CR2: 00000000200006c0 CR3: 0000000013ad4004 CR4: 0000000000770ef0
[   28.845258] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.845781] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.846263] PKRU: 55555554
[   28.847291] ------------[ cut here ]------------
[   28.847624] WARNING: CPU: 1 PID: 787 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   28.848272] Modules linked in:
[   28.848498] CPU: 1 UID: 0 PID: 787 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.849285] Tainted: [D]=DIE, [W]=WARN
[   28.849563] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.850312] RIP: 0010:iommufd_fops_release+0x386/0x420
[   28.850669] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   28.852051] RSP: 0018:ffff888026ef7c08 EFLAGS: 00010293
[   28.852483] RAX: 0000000000000000 RBX: ffff8880138cd008 RCX: ffffffff83afe4ca
[   28.852989] RDX: ffff8880125ea540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   28.853593] RBP: ffff888026ef7cb8 R08: 0000000000000000 R09: 0000000000000000
[   28.854101] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.854664] R13: 0000000000000000 R14: ffff888026ef7c50 R15: 0000000000000000
[   28.855250] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   28.855818] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.856291] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   28.856876] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.857456] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.858017] PKRU: 55555554
[   28.858224] Call Trace:
[   28.858436]  <TASK>
[   28.858657]  ? show_regs+0x6d/0x80
[   28.858910]  ? __warn+0xf3/0x380
[   28.859182]  ? report_bug+0x25e/0x4b0
[   28.859516]  ? iommufd_fops_release+0x386/0x420
[   28.859863]  ? report_bug+0x2cb/0x4b0
[   28.860136]  ? iommufd_fops_release+0x386/0x420
[   28.860505]  ? iommufd_fops_release+0x386/0x420
[   28.860883]  ? handle_bug+0x2cd/0x510
[   28.861160]  ? iommufd_fops_release+0x388/0x420
[   28.861548]  ? exc_invalid_op+0x3c/0x80
[   28.861904]  ? asm_exc_invalid_op+0x1f/0x30
[   28.862214]  ? iommufd_fops_release+0x21a/0x420
[   28.862636]  ? iommufd_fops_release+0x386/0x420
[   28.862976]  ? iommufd_fops_release+0x386/0x420
[   28.863393]  ? iommufd_fops_release+0x386/0x420
[   28.863727]  ? locks_remove_file+0x3b4/0x5d0
[   28.864132]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.864488]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.864925]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.865310]  ? evm_file_release+0x141/0x220
[   28.865703]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.866056]  __fput+0x41c/0xb70
[   28.866340]  ____fput+0x22/0x30
[   28.866574]  task_work_run+0x19b/0x2b0
[   28.866863]  ? __pfx_task_work_run+0x10/0x10
[   28.867265]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.867645]  ? switch_task_namespaces+0xc6/0x110
[   28.868038]  do_exit+0xb0e/0x29d0
[   28.868275]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.868682]  ? __pfx_do_exit+0x10/0x10
[   28.868946]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.869389]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.869676]  make_task_dead+0x181/0x3c0
[   28.869981]  rewind_stack_and_make_dead+0x16/0x20
[   28.870325] RIP: 0033:0x7f5abc23ee5d
[   28.870582] Code: Unable to access opcode bytes at 0x7f5abc23ee33.
[   28.871053] RSP: 002b:00007ffcbbd48778 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.871622] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f5abc23ee5d
[   28.872099] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.872631] RBP: 00007ffcbbd48790 R08: 0000000000000800 R09: 0000000000000800
[   28.873180] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcbbd488a8
[   28.873692] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f5abc5f3000
[   28.874204]  </TASK>
[   28.874373] irq event stamp: 0
[   28.874643] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.875066] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.875675] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.876286] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.876762] ---[ end trace 0000000000000000 ]---
[   28.877126] ------------[ cut here ]------------
[   28.877514] WARNING: CPU: 1 PID: 787 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   28.878166] Modules linked in:
[   28.878426] CPU: 1 UID: 0 PID: 787 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.879277] Tainted: [D]=DIE, [W]=WARN
[   28.879531] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.880338] RIP: 0010:iommufd_fops_release+0x392/0x420
[   28.880775] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   28.882106] RSP: 0018:ffff888026ef7c08 EFLAGS: 00010293
[   28.882494] RAX: 0000000000000000 RBX: ffff8880138cd008 RCX: ffffffff83afe4ca
[   28.883058] RDX: ffff8880125ea540 RSI: ffffffff83afe642 RDI: ffff8880138cd0a0
[   28.883559] RBP: ffff888026ef7cb8 R08: 0000000000000000 R09: 0000000000000000
[   28.884097] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.884647] R13: 0000000000000000 R14: ffff888026ef7c50 R15: 0000000000000000
[   28.885125] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   28.885724] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.886108] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   28.886580] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.887115] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.887584] PKRU: 55555554
[   28.887774] Call Trace:
[   28.887948]  <TASK>
[   28.888115]  ? show_regs+0x6d/0x80
[   28.888403]  ? __warn+0xf3/0x380
[   28.888632]  ? report_bug+0x25e/0x4b0
[   28.888888]  ? iommufd_fops_release+0x392/0x420
[   28.889203]  ? report_bug+0x2cb/0x4b0
[   28.889472]  ? iommufd_fops_release+0x392/0x420
[   28.889858]  ? iommufd_fops_release+0x392/0x420
[   28.890170]  ? handle_bug+0x2cd/0x510
[   28.890426]  ? iommufd_fops_release+0x394/0x420
[   28.890747]  ? exc_invalid_op+0x3c/0x80
[   28.891075]  ? asm_exc_invalid_op+0x1f/0x30
[   28.891364]  ? iommufd_fops_release+0x21a/0x420
[   28.891675]  ? iommufd_fops_release+0x392/0x420
[   28.891986]  ? iommufd_fops_release+0x392/0x420
[   28.892318]  ? iommufd_fops_release+0x392/0x420
[   28.892670]  ? locks_remove_file+0x3b4/0x5d0
[   28.892966]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.893299]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.893642]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.894065]  ? evm_file_release+0x141/0x220
[   28.894351]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.894687]  __fput+0x41c/0xb70
[   28.894918]  ____fput+0x22/0x30
[   28.895148]  task_work_run+0x19b/0x2b0
[   28.895472]  ? __pfx_task_work_run+0x10/0x10
[   28.895769]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.896133]  ? switch_task_namespaces+0xc6/0x110
[   28.896462]  do_exit+0xb0e/0x29d0
[   28.896754]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.897092]  ? __pfx_do_exit+0x10/0x10
[   28.897378]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.897701]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.898047]  make_task_dead+0x181/0x3c0
[   28.898315]  rewind_stack_and_make_dead+0x16/0x20
[   28.898641] RIP: 0033:0x7f5abc23ee5d
[   28.898895] Code: Unable to access opcode bytes at 0x7f5abc23ee33.
[   28.899310] RSP: 002b:00007ffcbbd48778 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.899813] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f5abc23ee5d
[   28.900292] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.900771] RBP: 00007ffcbbd48790 R08: 0000000000000800 R09: 0000000000000800
[   28.901250] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcbbd488a8
[   28.901740] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f5abc5f3000
[   28.902223]  </TASK>
[   28.902386] irq event stamp: 0
[   28.902604] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.903028] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.903648] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.904198] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.904692] ---[ end trace 0000000000000000 ]---
[   28.910694] iommufd_mock iommufd_mock56: Adding to iommu group 56
[   28.912302] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#57] SMP KASAN NOPTI
[   28.913160] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   28.913717] CPU: 1 UID: 0 PID: 788 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.914502] Tainted: [D]=DIE, [W]=WARN
[   28.914765] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.915568] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.916015] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.917274] RSP: 0018:ffff8880160a7b78 EFLAGS: 00010246
[   28.917629] RAX: dffffc0000000000 RBX: ffff888012288000 RCX: 1ffffffff0dd8bdd
[   28.918100] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880215807fc
[   28.918574] RBP: ffff8880160a7bc8 R08: 0000000000000000 R09: 0000000000000000
[   28.919051] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   28.919525] R13: 0000000000000001 R14: ffff8880160a7e18 R15: ffff888014e65c08
[   28.919999] FS:  00007f5ef4879600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   28.920524] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.920905] CR2: 00000000200006c0 CR3: 00000000138d8002 CR4: 0000000000770ef0
[   28.921374] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.921844] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.922315] PKRU: 55555554
[   28.922506] Call Trace:
[   28.922681]  <TASK>
[   28.922824]  ? show_regs+0x6d/0x80
[   28.923063]  ? die_addr+0x45/0xb0
[   28.923298]  ? exc_general_protection+0x1ad/0x340
[   28.923627]  ? asm_exc_general_protection+0x2b/0x30
[   28.923959]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.924302]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   28.924648]  iommufd_device_detach+0x2a/0x2e0
[   28.924952]  iommufd_test+0x2f99/0x5cd0
[   28.925217]  ? do_raw_spin_unlock+0x15c/0x210
[   28.925521]  ? __pfx_iommufd_test+0x10/0x10
[   28.925806]  ? debug_smp_processor_id+0x20/0x30
[   28.926116]  ? rcu_is_watching+0x19/0xc0
[   28.926388]  ? lock_release+0x1ea/0x2c0
[   28.926653]  ? __might_fault+0xf1/0x1b0
[   28.926926]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   28.927289]  iommufd_fops_ioctl+0x38e/0x520
[   28.927577]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.927898]  ? trace_irq_enable+0xd1/0x110
[   28.928185]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.928522]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.928842]  __x64_sys_ioctl+0x1ba/0x220
[   28.929129]  x64_sys_call+0x122e/0x2150
[   28.929392]  do_syscall_64+0x6d/0x150
[   28.929652]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   28.929994] RIP: 0033:0x7f5ef463ee5d
[   28.930244] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   28.931437] RSP: 002b:00007fff078ab3c8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.931936] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f5ef463ee5d
[   28.932404] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.932875] RBP: 00007fff078ab3e0 R08: 0000000000000800 R09: 0000000000000800
[   28.933338] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff078ab4f8
[   28.933800] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f5ef48c2000
[   28.934270]  </TASK>
[   28.934431] Modules linked in:
[   28.934689] ---[ end trace 0000000000000000 ]---
[   28.935118] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   28.935567] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   28.936857] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   28.937204] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   28.937757] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   28.938227] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   28.938697] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   28.939169] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   28.939635] FS:  00007f5ef4879600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   28.940159] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.940538] CR2: 00000000200006c0 CR3: 00000000138d8002 CR4: 0000000000770ef0
[   28.941006] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.941526] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.941994] PKRU: 55555554
[   28.942637] ------------[ cut here ]------------
[   28.942958] WARNING: CPU: 1 PID: 788 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   28.943577] Modules linked in:
[   28.943795] CPU: 1 UID: 0 PID: 788 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.944564] Tainted: [D]=DIE, [W]=WARN
[   28.944816] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.945863] RIP: 0010:iommufd_fops_release+0x386/0x420
[   28.946213] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   28.947396] RSP: 0018:ffff8880160a7c08 EFLAGS: 00010293
[   28.947748] RAX: 0000000000000000 RBX: ffff8880138c9008 RCX: ffffffff83afe4ca
[   28.948219] RDX: ffff888021580000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   28.948684] RBP: ffff8880160a7cb8 R08: 0000000000000000 R09: 0000000000000000
[   28.949151] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.949664] R13: 0000000000000000 R14: ffff8880160a7c50 R15: 0000000000000000
[   28.950134] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   28.950656] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.951041] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   28.951510] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.951974] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.952439] PKRU: 55555554
[   28.952629] Call Trace:
[   28.952801]  <TASK>
[   28.952954]  ? show_regs+0x6d/0x80
[   28.953193]  ? __warn+0xf3/0x380
[   28.953474]  ? report_bug+0x25e/0x4b0
[   28.953741]  ? iommufd_fops_release+0x386/0x420
[   28.954052]  ? report_bug+0x2cb/0x4b0
[   28.954307]  ? iommufd_fops_release+0x386/0x420
[   28.954617]  ? iommufd_fops_release+0x386/0x420
[   28.954928]  ? handle_bug+0x2cd/0x510
[   28.955183]  ? iommufd_fops_release+0x388/0x420
[   28.955489]  ? exc_invalid_op+0x3c/0x80
[   28.955756]  ? asm_exc_invalid_op+0x1f/0x30
[   28.956044]  ? iommufd_fops_release+0x21a/0x420
[   28.956356]  ? iommufd_fops_release+0x386/0x420
[   28.956664]  ? iommufd_fops_release+0x386/0x420
[   28.956973]  ? iommufd_fops_release+0x386/0x420
[   28.957282]  ? locks_remove_file+0x3b4/0x5d0
[   28.957612]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.957949]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.958266]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.958627]  ? evm_file_release+0x141/0x220
[   28.958919]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.959250]  __fput+0x41c/0xb70
[   28.959476]  ____fput+0x22/0x30
[   28.959700]  task_work_run+0x19b/0x2b0
[   28.959962]  ? __pfx_task_work_run+0x10/0x10
[   28.960256]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.960615]  ? switch_task_namespaces+0xc6/0x110
[   28.960936]  do_exit+0xb0e/0x29d0
[   28.961171]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.961522]  ? __pfx_do_exit+0x10/0x10
[   28.961785]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.962107]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.962388]  make_task_dead+0x181/0x3c0
[   28.962653]  rewind_stack_and_make_dead+0x16/0x20
[   28.962974] RIP: 0033:0x7f5ef463ee5d
[   28.963217] Code: Unable to access opcode bytes at 0x7f5ef463ee33.
[   28.963617] RSP: 002b:00007fff078ab3c8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.964115] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f5ef463ee5d
[   28.964576] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.965040] RBP: 00007fff078ab3e0 R08: 0000000000000800 R09: 0000000000000800
[   28.965516] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff078ab4f8
[   28.965983] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f5ef48c2000
[   28.966455]  </TASK>
[   28.966613] irq event stamp: 0
[   28.966830] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.967242] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.967774] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.968309] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.968719] ---[ end trace 0000000000000000 ]---
[   28.969081] ------------[ cut here ]------------
[   28.969407] WARNING: CPU: 1 PID: 788 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   28.970025] Modules linked in:
[   28.970242] CPU: 1 UID: 0 PID: 788 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   28.971009] Tainted: [D]=DIE, [W]=WARN
[   28.971261] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   28.971984] RIP: 0010:iommufd_fops_release+0x392/0x420
[   28.972326] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   28.973517] RSP: 0018:ffff8880160a7c08 EFLAGS: 00010293
[   28.973865] RAX: 0000000000000000 RBX: ffff8880138c9008 RCX: ffffffff83afe4ca
[   28.974327] RDX: ffff888021580000 RSI: ffffffff83afe642 RDI: ffff8880138c90a0
[   28.974795] RBP: ffff8880160a7cb8 R08: 0000000000000000 R09: 0000000000000000
[   28.975258] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   28.975721] R13: 0000000000000000 R14: ffff8880160a7c50 R15: 0000000000000000
[   28.976184] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   28.976706] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   28.977083] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   28.977565] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   28.978026] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   28.978490] PKRU: 55555554
[   28.978678] Call Trace:
[   28.978853]  <TASK>
[   28.979005]  ? show_regs+0x6d/0x80
[   28.979242]  ? __warn+0xf3/0x380
[   28.979469]  ? report_bug+0x25e/0x4b0
[   28.979722]  ? iommufd_fops_release+0x392/0x420
[   28.980030]  ? report_bug+0x2cb/0x4b0
[   28.980284]  ? iommufd_fops_release+0x392/0x420
[   28.980593]  ? iommufd_fops_release+0x392/0x420
[   28.980900]  ? handle_bug+0x2cd/0x510
[   28.981152]  ? iommufd_fops_release+0x394/0x420
[   28.981480]  ? exc_invalid_op+0x3c/0x80
[   28.981748]  ? asm_exc_invalid_op+0x1f/0x30
[   28.982035]  ? iommufd_fops_release+0x21a/0x420
[   28.982343]  ? iommufd_fops_release+0x392/0x420
[   28.982652]  ? iommufd_fops_release+0x392/0x420
[   28.982976]  ? iommufd_fops_release+0x392/0x420
[   28.983287]  ? locks_remove_file+0x3b4/0x5d0
[   28.983580]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.983908]  ? __memcg_slab_free_hook+0xc1/0x540
[   28.984221]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   28.984579]  ? evm_file_release+0x141/0x220
[   28.984864]  ? __pfx_iommufd_fops_release+0x10/0x10
[   28.985192]  __fput+0x41c/0xb70
[   28.985436]  ____fput+0x22/0x30
[   28.985660]  task_work_run+0x19b/0x2b0
[   28.985920]  ? __pfx_task_work_run+0x10/0x10
[   28.986213]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   28.986572]  ? switch_task_namespaces+0xc6/0x110
[   28.986891]  do_exit+0xb0e/0x29d0
[   28.987124]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   28.987459]  ? __pfx_do_exit+0x10/0x10
[   28.987717]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   28.988036]  ? __x64_sys_ioctl+0x1ba/0x220
[   28.988315]  make_task_dead+0x181/0x3c0
[   28.988579]  rewind_stack_and_make_dead+0x16/0x20
[   28.988897] RIP: 0033:0x7f5ef463ee5d
[   28.989141] Code: Unable to access opcode bytes at 0x7f5ef463ee33.
[   28.989558] RSP: 002b:00007fff078ab3c8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   28.990050] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f5ef463ee5d
[   28.990514] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   28.990981] RBP: 00007fff078ab3e0 R08: 0000000000000800 R09: 0000000000000800
[   28.991445] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff078ab4f8
[   28.991905] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f5ef48c2000
[   28.992373]  </TASK>
[   28.992531] irq event stamp: 0
[   28.992741] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   28.993150] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   28.993708] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   28.994246] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   28.994657] ---[ end trace 0000000000000000 ]---
[   28.999461] iommufd_mock iommufd_mock57: Adding to iommu group 57
[   29.000112] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#58] SMP KASAN NOPTI
[   29.000805] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   29.001271] CPU: 0 UID: 0 PID: 789 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.002000] Tainted: [D]=DIE, [W]=WARN
[   29.002238] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.002936] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.003300] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   29.004417] RSP: 0018:ffff8880172bfb78 EFLAGS: 00010246
[   29.004746] RAX: dffffc0000000000 RBX: ffff88801fe14c00 RCX: 1ffffffff0dd8bdc
[   29.005185] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880113c2d3c
[   29.005622] RBP: ffff8880172bfbc8 R08: 0000000000000000 R09: 0000000000000000
[   29.006061] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   29.006497] R13: 0000000000000001 R14: ffff8880172bfe18 R15: ffff888010524808
[   29.006939] FS:  00007f3a10273600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.007434] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.007791] CR2: 00000000200006c0 CR3: 000000001fa94005 CR4: 0000000000770ef0
[   29.008231] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.008669] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.009106] PKRU: 55555554
[   29.009285] Call Trace:
[   29.009448]  <TASK>
[   29.009591]  ? show_regs+0x6d/0x80
[   29.009819]  ? die_addr+0x45/0xb0
[   29.010041]  ? exc_general_protection+0x1ad/0x340
[   29.010352]  ? asm_exc_general_protection+0x2b/0x30
[   29.010666]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.010995]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   29.011323]  iommufd_device_detach+0x2a/0x2e0
[   29.011610]  iommufd_test+0x2f99/0x5cd0
[   29.011862]  ? do_raw_spin_unlock+0x15c/0x210
[   29.012149]  ? __pfx_iommufd_test+0x10/0x10
[   29.012420]  ? debug_smp_processor_id+0x20/0x30
[   29.012714]  ? rcu_is_watching+0x19/0xc0
[   29.012974]  ? lock_release+0x1ea/0x2c0
[   29.013224]  ? __might_fault+0xf1/0x1b0
[   29.013480]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   29.013823]  iommufd_fops_ioctl+0x38e/0x520
[   29.014096]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.014403]  ? trace_irq_enable+0xd1/0x110
[   29.014682]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.015007]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.015309]  __x64_sys_ioctl+0x1ba/0x220
[   29.015568]  x64_sys_call+0x122e/0x2150
[   29.015817]  do_syscall_64+0x6d/0x150
[   29.016058]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   29.016375] RIP: 0033:0x7f3a1003ee5d
[   29.016609] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   29.017718] RSP: 002b:00007fff62b751c8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.018184] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f3a1003ee5d
[   29.018620] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.019063] RBP: 00007fff62b751e0 R08: 0000000000000800 R09: 0000000000000800
[   29.019502] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff62b752f8
[   29.019936] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f3a102bc000
[   29.020378]  </TASK>
[   29.020526] Modules linked in:
[   29.020809] ---[ end trace 0000000000000000 ]---
[   29.021107] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.021480] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   29.022600] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   29.022934] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   29.023371] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   29.023804] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   29.024237] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   29.024671] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   29.025105] FS:  00007f3a10273600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.025609] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.025973] CR2: 00000000200006c0 CR3: 000000001fa94005 CR4: 0000000000770ef0
[   29.026412] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.026855] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.027297] PKRU: 55555554
[   29.027874] ------------[ cut here ]------------
[   29.028173] WARNING: CPU: 0 PID: 789 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   29.028762] Modules linked in:
[   29.028969] CPU: 0 UID: 0 PID: 789 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.029720] Tainted: [D]=DIE, [W]=WARN
[   29.029963] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.030656] RIP: 0010:iommufd_fops_release+0x386/0x420
[   29.030989] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   29.032113] RSP: 0018:ffff8880172bfc08 EFLAGS: 00010293
[   29.032447] RAX: 0000000000000000 RBX: ffff888021751808 RCX: ffffffff83afe4ca
[   29.032890] RDX: ffff8880113c2540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   29.033345] RBP: ffff8880172bfcb8 R08: 0000000000000000 R09: 0000000000000000
[   29.033787] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   29.034227] R13: 0000000000000000 R14: ffff8880172bfc50 R15: 0000000000000000
[   29.034668] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.035172] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.035532] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   29.035974] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.036412] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.036852] PKRU: 55555554
[   29.037030] Call Trace:
[   29.037193]  <TASK>
[   29.037351]  ? show_regs+0x6d/0x80
[   29.037581]  ? __warn+0xf3/0x380
[   29.037799]  ? report_bug+0x25e/0x4b0
[   29.038042]  ? iommufd_fops_release+0x386/0x420
[   29.038336]  ? report_bug+0x2cb/0x4b0
[   29.038577]  ? iommufd_fops_release+0x386/0x420
[   29.038873]  ? iommufd_fops_release+0x386/0x420
[   29.039166]  ? handle_bug+0x2cd/0x510
[   29.039408]  ? iommufd_fops_release+0x388/0x420
[   29.039702]  ? exc_invalid_op+0x3c/0x80
[   29.039954]  ? asm_exc_invalid_op+0x1f/0x30
[   29.040227]  ? iommufd_fops_release+0x21a/0x420
[   29.040520]  ? iommufd_fops_release+0x386/0x420
[   29.040820]  ? iommufd_fops_release+0x386/0x420
[   29.041112]  ? iommufd_fops_release+0x386/0x420
[   29.041420]  ? locks_remove_file+0x3b4/0x5d0
[   29.041705]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.042017]  ? __memcg_slab_free_hook+0xc1/0x540
[   29.042313]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   29.042654]  ? evm_file_release+0x141/0x220
[   29.042932]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.043243]  __fput+0x41c/0xb70
[   29.043457]  ____fput+0x22/0x30
[   29.043666]  task_work_run+0x19b/0x2b0
[   29.043914]  ? __pfx_task_work_run+0x10/0x10
[   29.044192]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   29.044532]  ? switch_task_namespaces+0xc6/0x110
[   29.044831]  do_exit+0xb0e/0x29d0
[   29.045052]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.045391]  ? __pfx_do_exit+0x10/0x10
[   29.045640]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.045944]  ? __x64_sys_ioctl+0x1ba/0x220
[   29.046211]  make_task_dead+0x181/0x3c0
[   29.046461]  rewind_stack_and_make_dead+0x16/0x20
[   29.047287] RIP: 0033:0x7f3a1003ee5d
[   29.047525] Code: Unable to access opcode bytes at 0x7f3a1003ee33.
[   29.047907] RSP: 002b:00007fff62b751c8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.048374] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f3a1003ee5d
[   29.048812] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.049252] RBP: 00007fff62b751e0 R08: 0000000000000800 R09: 0000000000000800
[   29.049715] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff62b752f8
[   29.050232] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f3a102bc000
[   29.050695]  </TASK>
[   29.050855] irq event stamp: 0
[   29.051056] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   29.051444] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   29.051954] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   29.052464] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   29.052852] ---[ end trace 0000000000000000 ]---
[   29.053202] ------------[ cut here ]------------
[   29.053508] WARNING: CPU: 0 PID: 789 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   29.054110] Modules linked in:
[   29.054321] CPU: 0 UID: 0 PID: 789 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.055049] Tainted: [D]=DIE, [W]=WARN
[   29.055287] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.055971] RIP: 0010:iommufd_fops_release+0x392/0x420
[   29.056299] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   29.057521] RSP: 0018:ffff8880172bfc08 EFLAGS: 00010293
[   29.057846] RAX: 0000000000000000 RBX: ffff888021751808 RCX: ffffffff83afe4ca
[   29.058269] RDX: ffff8880113c2540 RSI: ffffffff83afe642 RDI: ffff8880217518a0
[   29.058690] RBP: ffff8880172bfcb8 R08: 0000000000000000 R09: 0000000000000000
[   29.059117] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   29.059541] R13: 0000000000000000 R14: ffff8880172bfc50 R15: 0000000000000000
[   29.059963] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.060436] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.060782] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   29.061208] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.061649] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.062083] PKRU: 55555554
[   29.062255] Call Trace:
[   29.062412]  <TASK>
[   29.062552]  ? show_regs+0x6d/0x80
[   29.062778]  ? __warn+0xf3/0x380
[   29.062986]  ? report_bug+0x25e/0x4b0
[   29.063216]  ? iommufd_fops_release+0x392/0x420
[   29.063497]  ? report_bug+0x2cb/0x4b0
[   29.063727]  ? iommufd_fops_release+0x392/0x420
[   29.064007]  ? iommufd_fops_release+0x392/0x420
[   29.064287]  ? handle_bug+0x2cd/0x510
[   29.064518]  ? iommufd_fops_release+0x394/0x420
[   29.064801]  ? exc_invalid_op+0x3c/0x80
[   29.065042]  ? asm_exc_invalid_op+0x1f/0x30
[   29.065302]  ? iommufd_fops_release+0x21a/0x420
[   29.065599]  ? iommufd_fops_release+0x392/0x420
[   29.065885]  ? iommufd_fops_release+0x392/0x420
[   29.066172]  ? iommufd_fops_release+0x392/0x420
[   29.066454]  ? locks_remove_file+0x3b4/0x5d0
[   29.066727]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.067027]  ? __memcg_slab_free_hook+0xc1/0x540
[   29.067314]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   29.067640]  ? evm_file_release+0x141/0x220
[   29.067902]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.068202]  __fput+0x41c/0xb70
[   29.068406]  ____fput+0x22/0x30
[   29.068609]  task_work_run+0x19b/0x2b0
[   29.068846]  ? __pfx_task_work_run+0x10/0x10
[   29.069115]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   29.069456]  ? switch_task_namespaces+0xc6/0x110
[   29.069756]  do_exit+0xb0e/0x29d0
[   29.069978]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.070287]  ? __pfx_do_exit+0x10/0x10
[   29.070523]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.070819]  ? __x64_sys_ioctl+0x1ba/0x220
[   29.071076]  make_task_dead+0x181/0x3c0
[   29.071318]  rewind_stack_and_make_dead+0x16/0x20
[   29.071606] RIP: 0033:0x7f3a1003ee5d
[   29.071830] Code: Unable to access opcode bytes at 0x7f3a1003ee33.
[   29.072196] RSP: 002b:00007fff62b751c8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.072644] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f3a1003ee5d
[   29.073066] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.073503] RBP: 00007fff62b751e0 R08: 0000000000000800 R09: 0000000000000800
[   29.073934] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff62b752f8
[   29.074360] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f3a102bc000
[   29.074795]  </TASK>
[   29.074939] irq event stamp: 0
[   29.075131] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   29.075505] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   29.075992] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   29.076478] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   29.076852] ---[ end trace 0000000000000000 ]---
[   29.082807] iommufd_mock iommufd_mock58: Adding to iommu group 58
[   29.083741] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#59] SMP KASAN NOPTI
[   29.084962] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   29.085740] CPU: 0 UID: 0 PID: 790 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.086921] Tainted: [D]=DIE, [W]=WARN
[   29.087275] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.088314] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.088769] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   29.090149] RSP: 0018:ffff88801f03fb78 EFLAGS: 00010246
[   29.090522] RAX: dffffc0000000000 RBX: ffff88801fe14000 RCX: 1ffffffff0dd8bdc
[   29.091008] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880162b07fc
[   29.091477] RBP: ffff88801f03fbc8 R08: 0000000000000000 R09: 0000000000000000
[   29.091945] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   29.092425] R13: 0000000000000001 R14: ffff88801f03fe18 R15: ffff88800ff36408
[   29.092959] FS:  00007f1936353600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.093492] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.093874] CR2: 00000000200006c0 CR3: 0000000013ad4004 CR4: 0000000000770ef0
[   29.094345] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.094816] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.095284] PKRU: 55555554
[   29.095474] Call Trace:
[   29.095647]  <TASK>
[   29.095801]  ? show_regs+0x6d/0x80
[   29.096043]  ? die_addr+0x45/0xb0
[   29.096279]  ? exc_general_protection+0x1ad/0x340
[   29.096610]  ? asm_exc_general_protection+0x2b/0x30
[   29.096952]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.097302]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   29.097652]  iommufd_device_detach+0x2a/0x2e0
[   29.097966]  iommufd_test+0x2f99/0x5cd0
[   29.098240]  ? do_raw_spin_unlock+0x15c/0x210
[   29.098548]  ? __pfx_iommufd_test+0x10/0x10
[   29.098840]  ? debug_smp_processor_id+0x20/0x30
[   29.099160]  ? rcu_is_watching+0x19/0xc0
[   29.099441]  ? lock_release+0x1ea/0x2c0
[   29.099712]  ? __might_fault+0xf1/0x1b0
[   29.099991]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   29.100362]  iommufd_fops_ioctl+0x38e/0x520
[   29.100657]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.100986]  ? trace_irq_enable+0xd1/0x110
[   29.101278]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.101623]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.101951]  __x64_sys_ioctl+0x1ba/0x220
[   29.102234]  x64_sys_call+0x122e/0x2150
[   29.102503]  do_syscall_64+0x6d/0x150
[   29.102769]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   29.103114] RIP: 0033:0x7f193603ee5d
[   29.103366] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   29.104572] RSP: 002b:00007ffddf959c18 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.105079] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f193603ee5d
[   29.105557] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.106031] RBP: 00007ffddf959c30 R08: 0000000000000800 R09: 0000000000000800
[   29.106501] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffddf959d48
[   29.107064] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f193639c000
[   29.107588]  </TASK>
[   29.107758] Modules linked in:
[   29.108070] ---[ end trace 0000000000000000 ]---
[   29.108411] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.108829] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   29.110119] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   29.110456] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   29.110910] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   29.111355] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   29.111796] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   29.112212] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   29.112629] FS:  00007f1936353600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.113100] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.113455] CR2: 00000000200006c0 CR3: 0000000013ad4004 CR4: 0000000000770ef0
[   29.113883] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.114302] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.114726] PKRU: 55555554
[   29.115306] ------------[ cut here ]------------
[   29.115598] WARNING: CPU: 0 PID: 790 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   29.116165] Modules linked in:
[   29.116365] CPU: 0 UID: 0 PID: 790 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.117068] Tainted: [D]=DIE, [W]=WARN
[   29.117299] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.117988] RIP: 0010:iommufd_fops_release+0x386/0x420
[   29.118307] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   29.119386] RSP: 0018:ffff88801f03fc08 EFLAGS: 00010293
[   29.119703] RAX: 0000000000000000 RBX: ffff888021754808 RCX: ffffffff83afe4ca
[   29.120128] RDX: ffff8880162b0000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   29.120552] RBP: ffff88801f03fcb8 R08: 0000000000000000 R09: 0000000000000000
[   29.120976] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   29.121415] R13: 0000000000000000 R14: ffff88801f03fc50 R15: 0000000000000000
[   29.121841] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.122318] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.122664] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   29.123096] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.123521] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.123944] PKRU: 55555554
[   29.124116] Call Trace:
[   29.124274]  <TASK>
[   29.124414]  ? show_regs+0x6d/0x80
[   29.124635]  ? __warn+0xf3/0x380
[   29.124844]  ? report_bug+0x25e/0x4b0
[   29.125078]  ? iommufd_fops_release+0x386/0x420
[   29.125387]  ? report_bug+0x2cb/0x4b0
[   29.125620]  ? iommufd_fops_release+0x386/0x420
[   29.125901]  ? iommufd_fops_release+0x386/0x420
[   29.126183]  ? handle_bug+0x2cd/0x510
[   29.126417]  ? iommufd_fops_release+0x388/0x420
[   29.126699]  ? exc_invalid_op+0x3c/0x80
[   29.126954]  ? asm_exc_invalid_op+0x1f/0x30
[   29.127216]  ? iommufd_fops_release+0x21a/0x420
[   29.127497]  ? iommufd_fops_release+0x386/0x420
[   29.127780]  ? iommufd_fops_release+0x386/0x420
[   29.128063]  ? iommufd_fops_release+0x386/0x420
[   29.128342]  ? locks_remove_file+0x3b4/0x5d0
[   29.128614]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.128913]  ? __memcg_slab_free_hook+0xc1/0x540
[   29.129202]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   29.129546]  ? evm_file_release+0x141/0x220
[   29.129810]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.130114]  __fput+0x41c/0xb70
[   29.130319]  ____fput+0x22/0x30
[   29.130523]  task_work_run+0x19b/0x2b0
[   29.130769]  ? __pfx_task_work_run+0x10/0x10
[   29.131041]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   29.131372]  ? switch_task_namespaces+0xc6/0x110
[   29.131664]  do_exit+0xb0e/0x29d0
[   29.131880]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.132189]  ? __pfx_do_exit+0x10/0x10
[   29.132428]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.132721]  ? __x64_sys_ioctl+0x1ba/0x220
[   29.132978]  make_task_dead+0x181/0x3c0
[   29.133223]  rewind_stack_and_make_dead+0x16/0x20
[   29.133528] RIP: 0033:0x7f193603ee5d
[   29.133762] Code: Unable to access opcode bytes at 0x7f193603ee33.
[   29.134132] RSP: 002b:00007ffddf959c18 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.134585] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f193603ee5d
[   29.135016] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.135442] RBP: 00007ffddf959c30 R08: 0000000000000800 R09: 0000000000000800
[   29.135868] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffddf959d48
[   29.136293] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f193639c000
[   29.136726]  </TASK>
[   29.136871] irq event stamp: 0
[   29.137064] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   29.137459] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   29.137956] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   29.138451] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   29.138834] ---[ end trace 0000000000000000 ]---
[   29.139163] ------------[ cut here ]------------
[   29.139445] WARNING: CPU: 0 PID: 790 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   29.140016] Modules linked in:
[   29.140217] CPU: 0 UID: 0 PID: 790 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.140923] Tainted: [D]=DIE, [W]=WARN
[   29.141156] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.141840] RIP: 0010:iommufd_fops_release+0x392/0x420
[   29.142158] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   29.143256] RSP: 0018:ffff88801f03fc08 EFLAGS: 00010293
[   29.143573] RAX: 0000000000000000 RBX: ffff888021754808 RCX: ffffffff83afe4ca
[   29.143991] RDX: ffff8880162b0000 RSI: ffffffff83afe642 RDI: ffff8880217548a0
[   29.144409] RBP: ffff88801f03fcb8 R08: 0000000000000000 R09: 0000000000000000
[   29.144828] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   29.145248] R13: 0000000000000000 R14: ffff88801f03fc50 R15: 0000000000000000
[   29.145688] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.146162] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.146504] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   29.146928] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.147349] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.147767] PKRU: 55555554
[   29.147937] Call Trace:
[   29.148092]  <TASK>
[   29.148231]  ? show_regs+0x6d/0x80
[   29.148449]  ? __warn+0xf3/0x380
[   29.148658]  ? report_bug+0x25e/0x4b0
[   29.148888]  ? iommufd_fops_release+0x392/0x420
[   29.149166]  ? report_bug+0x2cb/0x4b0
[   29.149410]  ? iommufd_fops_release+0x392/0x420
[   29.149692]  ? iommufd_fops_release+0x392/0x420
[   29.149972]  ? handle_bug+0x2cd/0x510
[   29.150202]  ? iommufd_fops_release+0x394/0x420
[   29.150483]  ? exc_invalid_op+0x3c/0x80
[   29.150727]  ? asm_exc_invalid_op+0x1f/0x30
[   29.150988]  ? iommufd_fops_release+0x21a/0x420
[   29.151268]  ? iommufd_fops_release+0x392/0x420
[   29.151547]  ? iommufd_fops_release+0x392/0x420
[   29.151826]  ? iommufd_fops_release+0x392/0x420
[   29.152104]  ? locks_remove_file+0x3b4/0x5d0
[   29.152370]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.152666]  ? __memcg_slab_free_hook+0xc1/0x540
[   29.152950]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   29.153274]  ? evm_file_release+0x141/0x220
[   29.153548]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.153847]  __fput+0x41c/0xb70
[   29.154052]  ____fput+0x22/0x30
[   29.154255]  task_work_run+0x19b/0x2b0
[   29.154494]  ? __pfx_task_work_run+0x10/0x10
[   29.154765]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   29.155093]  ? switch_task_namespaces+0xc6/0x110
[   29.155379]  do_exit+0xb0e/0x29d0
[   29.155591]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.155894]  ? __pfx_do_exit+0x10/0x10
[   29.156132]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.156421]  ? __x64_sys_ioctl+0x1ba/0x220
[   29.156675]  make_task_dead+0x181/0x3c0
[   29.156915]  rewind_stack_and_make_dead+0x16/0x20
[   29.157203] RIP: 0033:0x7f193603ee5d
[   29.157440] Code: Unable to access opcode bytes at 0x7f193603ee33.
[   29.157806] RSP: 002b:00007ffddf959c18 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.158256] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f193603ee5d
[   29.158677] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.159105] RBP: 00007ffddf959c30 R08: 0000000000000800 R09: 0000000000000800
[   29.159767] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffddf959d48
[   29.160458] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f193639c000
[   29.160935]  </TASK>
[   29.161081] irq event stamp: 0
[   29.161380] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   29.161739] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   29.162203] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   29.162733] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   29.163173] ---[ end trace 0000000000000000 ]---
[   29.167540] iommufd_mock iommufd_mock59: Adding to iommu group 59
[   29.168255] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#60] SMP KASAN NOPTI
[   29.168997] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   29.169437] CPU: 0 UID: 0 PID: 791 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.170103] Tainted: [D]=DIE, [W]=WARN
[   29.170323] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.170962] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.171299] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   29.172317] RSP: 0018:ffff8880172bfb78 EFLAGS: 00010246
[   29.172619] RAX: dffffc0000000000 RBX: ffff88801fe15400 RCX: 1ffffffff0dd8bdc
[   29.173022] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff888012f4d27c
[   29.173422] RBP: ffff8880172bfbc8 R08: 0000000000000000 R09: 0000000000000000
[   29.173824] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   29.174226] R13: 0000000000000001 R14: ffff8880172bfe18 R15: ffff888011f09008
[   29.174629] FS:  00007fb8f3027600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.175086] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.175415] CR2: 00000000200006c0 CR3: 00000000138d8003 CR4: 0000000000770ef0
[   29.175819] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.176222] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.176624] PKRU: 55555554
[   29.176786] Call Trace:
[   29.176935]  <TASK>
[   29.177067]  ? show_regs+0x6d/0x80
[   29.177277]  ? die_addr+0x45/0xb0
[   29.177480]  ? exc_general_protection+0x1ad/0x340
[   29.177767]  ? asm_exc_general_protection+0x2b/0x30
[   29.178057]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.178358]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   29.178659]  iommufd_device_detach+0x2a/0x2e0
[   29.178927]  iommufd_test+0x2f99/0x5cd0
[   29.179162]  ? do_raw_spin_unlock+0x15c/0x210
[   29.179425]  ? __pfx_iommufd_test+0x10/0x10
[   29.179674]  ? debug_smp_processor_id+0x20/0x30
[   29.179945]  ? rcu_is_watching+0x19/0xc0
[   29.180183]  ? lock_release+0x1ea/0x2c0
[   29.180413]  ? __might_fault+0xf1/0x1b0
[   29.180648]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   29.180965]  iommufd_fops_ioctl+0x38e/0x520
[   29.181217]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.181498]  ? trace_irq_enable+0xd1/0x110
[   29.181748]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.182050]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.182326]  __x64_sys_ioctl+0x1ba/0x220
[   29.182561]  x64_sys_call+0x122e/0x2150
[   29.182791]  do_syscall_64+0x6d/0x150
[   29.183011]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   29.183303] RIP: 0033:0x7fb8f2e3ee5d
[   29.183515] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   29.184525] RSP: 002b:00007fff946b7668 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.184950] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fb8f2e3ee5d
[   29.185348] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.185746] RBP: 00007fff946b7680 R08: 0000000000000800 R09: 0000000000000800
[   29.186144] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff946b7798
[   29.186542] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fb8f3070000
[   29.186952]  </TASK>
[   29.187089] Modules linked in:
[   29.187386] ---[ end trace 0000000000000000 ]---
[   29.187658] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.187991] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   29.189015] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   29.189319] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   29.189804] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   29.190210] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   29.190613] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   29.191018] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   29.191421] FS:  00007fb8f3027600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.191876] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.192208] CR2: 00000000200006c0 CR3: 00000000138d8003 CR4: 0000000000770ef0
[   29.192613] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.193018] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.193489] PKRU: 55555554
[   29.194812] ------------[ cut here ]------------
[   29.195325] WARNING: CPU: 1 PID: 791 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   29.196193] Modules linked in:
[   29.196488] CPU: 1 UID: 0 PID: 791 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.197578] Tainted: [D]=DIE, [W]=WARN
[   29.197870] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.198715] RIP: 0010:iommufd_fops_release+0x386/0x420
[   29.199112] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   29.200401] RSP: 0018:ffff8880172bfc08 EFLAGS: 00010293
[   29.200768] RAX: 0000000000000000 RBX: ffff888021752008 RCX: ffffffff83afe4ca
[   29.201255] RDX: ffff888012f4ca80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   29.201830] RBP: ffff8880172bfcb8 R08: 0000000000000000 R09: 0000000000000000
[   29.202351] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   29.202862] R13: 0000000000000000 R14: ffff8880172bfc50 R15: 0000000000000000
[   29.203364] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   29.203958] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.204420] CR2: 00007f0825a30000 CR3: 000000001af88005 CR4: 0000000000770ef0
[   29.204919] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.205478] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.206054] PKRU: 55555554
[   29.206251] Call Trace:
[   29.206450]  <TASK>
[   29.206650]  ? show_regs+0x6d/0x80
[   29.206914]  ? __warn+0xf3/0x380
[   29.207173]  ? report_bug+0x25e/0x4b0
[   29.207542]  ? iommufd_fops_release+0x386/0x420
[   29.207883]  ? report_bug+0x2cb/0x4b0
[   29.208215]  ? iommufd_fops_release+0x386/0x420
[   29.208558]  ? iommufd_fops_release+0x386/0x420
[   29.208952]  ? handle_bug+0x2cd/0x510
[   29.209243]  ? iommufd_fops_release+0x388/0x420
[   29.209692]  ? exc_invalid_op+0x3c/0x80
[   29.209988]  ? asm_exc_invalid_op+0x1f/0x30
[   29.210356]  ? iommufd_fops_release+0x21a/0x420
[   29.210696]  ? iommufd_fops_release+0x386/0x420
[   29.211103]  ? iommufd_fops_release+0x386/0x420
[   29.211443]  ? iommufd_fops_release+0x386/0x420
[   29.211844]  ? locks_remove_file+0x3b4/0x5d0
[   29.212186]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.212598]  ? __memcg_slab_free_hook+0xc1/0x540
[   29.212948]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   29.213437]  ? evm_file_release+0x141/0x220
[   29.213754]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.214198]  __fput+0x41c/0xb70
[   29.214451]  ____fput+0x22/0x30
[   29.214702]  task_work_run+0x19b/0x2b0
[   29.215074]  ? __pfx_task_work_run+0x10/0x10
[   29.215405]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   29.215881]  ? switch_task_namespaces+0xc6/0x110
[   29.216233]  do_exit+0xb0e/0x29d0
[   29.216550]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.216931]  ? __pfx_do_exit+0x10/0x10
[   29.217295]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.217703]  ? __x64_sys_ioctl+0x1ba/0x220
[   29.218069]  make_task_dead+0x181/0x3c0
[   29.218342]  rewind_stack_and_make_dead+0x16/0x20
[   29.218773] RIP: 0033:0x7fb8f2e3ee5d
[   29.219059] Code: Unable to access opcode bytes at 0x7fb8f2e3ee33.
[   29.219648] RSP: 002b:00007fff946b7668 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.220286] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fb8f2e3ee5d
[   29.220809] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.221457] RBP: 00007fff946b7680 R08: 0000000000000800 R09: 0000000000000800
[   29.222046] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff946b7798
[   29.222615] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fb8f3070000
[   29.223137]  </TASK>
[   29.223362] irq event stamp: 0
[   29.223629] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   29.224156] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   29.224755] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   29.225421] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   29.225921] ---[ end trace 0000000000000000 ]---
[   29.226386] ------------[ cut here ]------------
[   29.226758] WARNING: CPU: 1 PID: 791 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   29.227478] Modules linked in:
[   29.227724] CPU: 1 UID: 0 PID: 791 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.228680] Tainted: [D]=DIE, [W]=WARN
[   29.229003] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.229879] RIP: 0010:iommufd_fops_release+0x392/0x420
[   29.230279] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   29.231710] RSP: 0018:ffff8880172bfc08 EFLAGS: 00010293
[   29.232132] RAX: 0000000000000000 RBX: ffff888021752008 RCX: ffffffff83afe4ca
[   29.232691] RDX: ffff888012f4ca80 RSI: ffffffff83afe642 RDI: ffff8880217520a0
[   29.233230] RBP: ffff8880172bfcb8 R08: 0000000000000000 R09: 0000000000000000
[   29.233816] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   29.234376] R13: 0000000000000000 R14: ffff8880172bfc50 R15: 0000000000000000
[   29.234960] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   29.235575] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.236037] CR2: 00007f0825a30000 CR3: 000000001af88005 CR4: 0000000000770ef0
[   29.236604] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.237128] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.237669] PKRU: 55555554
[   29.237935] Call Trace:
[   29.238131]  <TASK>
[   29.238302]  ? show_regs+0x6d/0x80
[   29.238581]  ? __warn+0xf3/0x380
[   29.238849]  ? report_bug+0x25e/0x4b0
[   29.239162]  ? iommufd_fops_release+0x392/0x420
[   29.239537]  ? report_bug+0x2cb/0x4b0
[   29.239825]  ? iommufd_fops_release+0x392/0x420
[   29.240170]  ? iommufd_fops_release+0x392/0x420
[   29.240562]  ? handle_bug+0x2cd/0x510
[   29.240841]  ? iommufd_fops_release+0x394/0x420
[   29.241187]  ? exc_invalid_op+0x3c/0x80
[   29.241498]  ? asm_exc_invalid_op+0x1f/0x30
[   29.241867]  ? iommufd_fops_release+0x21a/0x420
[   29.242216]  ? iommufd_fops_release+0x392/0x420
[   29.242570]  ? iommufd_fops_release+0x392/0x420
[   29.242928]  ? iommufd_fops_release+0x392/0x420
[   29.243332]  ? locks_remove_file+0x3b4/0x5d0
[   29.243664]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.244032]  ? __memcg_slab_free_hook+0xc1/0x540
[   29.244381]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   29.244789]  ? evm_file_release+0x141/0x220
[   29.245116]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.245510]  __fput+0x41c/0xb70
[   29.245762]  ____fput+0x22/0x30
[   29.246011]  task_work_run+0x19b/0x2b0
[   29.246312]  ? __pfx_task_work_run+0x10/0x10
[   29.246644]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   29.247066]  ? switch_task_namespaces+0xc6/0x110
[   29.247427]  do_exit+0xb0e/0x29d0
[   29.247688]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.248065]  ? __pfx_do_exit+0x10/0x10
[   29.248340]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.248691]  ? __x64_sys_ioctl+0x1ba/0x220
[   29.248979]  make_task_dead+0x181/0x3c0
[   29.249252]  rewind_stack_and_make_dead+0x16/0x20
[   29.249623] RIP: 0033:0x7fb8f2e3ee5d
[   29.249886] Code: Unable to access opcode bytes at 0x7fb8f2e3ee33.
[   29.250302] RSP: 002b:00007fff946b7668 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.250861] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fb8f2e3ee5d
[   29.251301] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.251736] RBP: 00007fff946b7680 R08: 0000000000000800 R09: 0000000000000800
[   29.252172] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff946b7798
[   29.252610] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fb8f3070000
[   29.253055]  </TASK>
[   29.253204] irq event stamp: 0
[   29.253457] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   29.253863] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   29.254369] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   29.254877] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   29.255266] ---[ end trace 0000000000000000 ]---
[   29.260046] iommufd_mock iommufd_mock60: Adding to iommu group 60
[   29.261392] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#61] SMP KASAN NOPTI
[   29.262138] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   29.262602] CPU: 1 UID: 0 PID: 792 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.263328] Tainted: [D]=DIE, [W]=WARN
[   29.263567] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.264252] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.264613] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   29.265723] RSP: 0018:ffff88801227fb78 EFLAGS: 00010246
[   29.266050] RAX: dffffc0000000000 RBX: ffff888012289400 RCX: 1ffffffff0dd8bdd
[   29.266487] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff888012f487fc
[   29.266927] RBP: ffff88801227fbc8 R08: 0000000000000000 R09: 0000000000000000
[   29.267362] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   29.267797] R13: 0000000000000001 R14: ffff88801227fe18 R15: ffff888013443808
[   29.268233] FS:  00007f3f5dce4600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   29.268724] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.269080] CR2: 00000000200006c0 CR3: 00000000138d8003 CR4: 0000000000770ef0
[   29.269520] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.269954] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.270388] PKRU: 55555554
[   29.270565] Call Trace:
[   29.270730]  <TASK>
[   29.270873]  ? show_regs+0x6d/0x80
[   29.271099]  ? die_addr+0x45/0xb0
[   29.271320]  ? exc_general_protection+0x1ad/0x340
[   29.271629]  ? asm_exc_general_protection+0x2b/0x30
[   29.271943]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.272267]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   29.272593]  iommufd_device_detach+0x2a/0x2e0
[   29.272877]  iommufd_test+0x2f99/0x5cd0
[   29.273128]  ? do_raw_spin_unlock+0x15c/0x210
[   29.273417]  ? __pfx_iommufd_test+0x10/0x10
[   29.273685]  ? debug_smp_processor_id+0x20/0x30
[   29.273978]  ? rcu_is_watching+0x19/0xc0
[   29.274238]  ? lock_release+0x1ea/0x2c0
[   29.274489]  ? __might_fault+0xf1/0x1b0
[   29.274754]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   29.275092]  iommufd_fops_ioctl+0x38e/0x520
[   29.275360]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.275660]  ? trace_irq_enable+0xd1/0x110
[   29.275927]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.276240]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.276539]  __x64_sys_ioctl+0x1ba/0x220
[   29.276795]  x64_sys_call+0x122e/0x2150
[   29.277041]  do_syscall_64+0x6d/0x150
[   29.277278]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   29.277592] RIP: 0033:0x7f3f5da3ee5d
[   29.277821] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   29.278918] RSP: 002b:00007ffd1f6ad208 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.279376] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f3f5da3ee5d
[   29.279807] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.280236] RBP: 00007ffd1f6ad220 R08: 0000000000000800 R09: 0000000000000800
[   29.280667] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd1f6ad338
[   29.281096] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f3f5dd2d000
[   29.281533]  </TASK>
[   29.281680] Modules linked in:
[   29.281912] ---[ end trace 0000000000000000 ]---
[   29.282204] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.282564] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   29.283667] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   29.283995] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   29.284427] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   29.284861] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   29.285292] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   29.285742] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   29.286180] FS:  00007f3f5dce4600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   29.286671] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.287035] CR2: 00000000200006c0 CR3: 00000000138d8003 CR4: 0000000000770ef0
[   29.287467] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.287896] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.288332] PKRU: 55555554
[   29.288975] ------------[ cut here ]------------
[   29.289280] WARNING: CPU: 1 PID: 792 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   29.289886] Modules linked in:
[   29.290096] CPU: 1 UID: 0 PID: 792 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.290836] Tainted: [D]=DIE, [W]=WARN
[   29.291075] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.291757] RIP: 0010:iommufd_fops_release+0x386/0x420
[   29.292080] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   29.293189] RSP: 0018:ffff88801227fc08 EFLAGS: 00010293
[   29.293536] RAX: 0000000000000000 RBX: ffff8880138ce008 RCX: ffffffff83afe4ca
[   29.294007] RDX: ffff888012f48000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   29.294439] RBP: ffff88801227fcb8 R08: 0000000000000000 R09: 0000000000000000
[   29.294878] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   29.295312] R13: 0000000000000000 R14: ffff88801227fc50 R15: 0000000000000000
[   29.295744] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   29.296230] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.296585] CR2: 00000000200006c0 CR3: 0000000007086005 CR4: 0000000000770ef0
[   29.297021] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.297472] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.297940] PKRU: 55555554
[   29.298118] Call Trace:
[   29.298279]  <TASK>
[   29.298422]  ? show_regs+0x6d/0x80
[   29.298651]  ? __warn+0xf3/0x380
[   29.298871]  ? report_bug+0x25e/0x4b0
[   29.299111]  ? iommufd_fops_release+0x386/0x420
[   29.299400]  ? report_bug+0x2cb/0x4b0
[   29.299639]  ? iommufd_fops_release+0x386/0x420
[   29.299931]  ? iommufd_fops_release+0x386/0x420
[   29.300223]  ? handle_bug+0x2cd/0x510
[   29.300468]  ? iommufd_fops_release+0x388/0x420
[   29.300763]  ? exc_invalid_op+0x3c/0x80
[   29.301016]  ? asm_exc_invalid_op+0x1f/0x30
[   29.301288]  ? iommufd_fops_release+0x21a/0x420
[   29.301599]  ? iommufd_fops_release+0x386/0x420
[   29.301906]  ? iommufd_fops_release+0x386/0x420
[   29.302205]  ? iommufd_fops_release+0x386/0x420
[   29.302512]  ? locks_remove_file+0x3b4/0x5d0
[   29.302795]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.303107]  ? __memcg_slab_free_hook+0xc1/0x540
[   29.303405]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   29.303745]  ? evm_file_release+0x141/0x220
[   29.304015]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.304324]  __fput+0x41c/0xb70
[   29.304537]  ____fput+0x22/0x30
[   29.304746]  task_work_run+0x19b/0x2b0
[   29.304995]  ? __pfx_task_work_run+0x10/0x10
[   29.305271]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   29.305633]  ? switch_task_namespaces+0xc6/0x110
[   29.305941]  do_exit+0xb0e/0x29d0
[   29.306172]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.306495]  ? __pfx_do_exit+0x10/0x10
[   29.306743]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.307045]  ? __x64_sys_ioctl+0x1ba/0x220
[   29.307310]  make_task_dead+0x181/0x3c0
[   29.307561]  rewind_stack_and_make_dead+0x16/0x20
[   29.307861] RIP: 0033:0x7f3f5da3ee5d
[   29.308093] Code: Unable to access opcode bytes at 0x7f3f5da3ee33.
[   29.308472] RSP: 002b:00007ffd1f6ad208 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.308939] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f3f5da3ee5d
[   29.309394] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.309852] RBP: 00007ffd1f6ad220 R08: 0000000000000800 R09: 0000000000000800
[   29.310289] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd1f6ad338
[   29.310737] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f3f5dd2d000
[   29.311182]  </TASK>
[   29.311330] irq event stamp: 0
[   29.311530] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   29.311919] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   29.312427] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   29.312934] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   29.313342] ---[ end trace 0000000000000000 ]---
[   29.313688] ------------[ cut here ]------------
[   29.313984] WARNING: CPU: 1 PID: 792 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   29.314574] Modules linked in:
[   29.314783] CPU: 1 UID: 0 PID: 792 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.315499] Tainted: [D]=DIE, [W]=WARN
[   29.315736] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.316412] RIP: 0010:iommufd_fops_release+0x392/0x420
[   29.316736] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   29.317858] RSP: 0018:ffff88801227fc08 EFLAGS: 00010293
[   29.318194] RAX: 0000000000000000 RBX: ffff8880138ce008 RCX: ffffffff83afe4ca
[   29.318634] RDX: ffff888012f48000 RSI: ffffffff83afe642 RDI: ffff8880138ce0a0
[   29.319072] RBP: ffff88801227fcb8 R08: 0000000000000000 R09: 0000000000000000
[   29.319503] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   29.319936] R13: 0000000000000000 R14: ffff88801227fc50 R15: 0000000000000000
[   29.320368] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   29.320857] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.321210] CR2: 00000000200006c0 CR3: 0000000007086005 CR4: 0000000000770ef0
[   29.321662] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.322126] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.322560] PKRU: 55555554
[   29.322741] Call Trace:
[   29.322902]  <TASK>
[   29.323045]  ? show_regs+0x6d/0x80
[   29.323269]  ? __warn+0xf3/0x380
[   29.323482]  ? report_bug+0x25e/0x4b0
[   29.323717]  ? iommufd_fops_release+0x392/0x420
[   29.324005]  ? report_bug+0x2cb/0x4b0
[   29.324242]  ? iommufd_fops_release+0x392/0x420
[   29.324529]  ? iommufd_fops_release+0x392/0x420
[   29.324817]  ? handle_bug+0x2cd/0x510
[   29.325056]  ? iommufd_fops_release+0x394/0x420
[   29.325362]  ? exc_invalid_op+0x3c/0x80
[   29.325632]  ? asm_exc_invalid_op+0x1f/0x30
[   29.325916]  ? iommufd_fops_release+0x21a/0x420
[   29.326212]  ? iommufd_fops_release+0x392/0x420
[   29.326499]  ? iommufd_fops_release+0x392/0x420
[   29.326792]  ? iommufd_fops_release+0x392/0x420
[   29.327080]  ? locks_remove_file+0x3b4/0x5d0
[   29.327355]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.327661]  ? __memcg_slab_free_hook+0xc1/0x540
[   29.327956]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   29.328294]  ? evm_file_release+0x141/0x220
[   29.328560]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.328866]  __fput+0x41c/0xb70
[   29.329076]  ____fput+0x22/0x30
[   29.329283]  task_work_run+0x19b/0x2b0
[   29.329548]  ? __pfx_task_work_run+0x10/0x10
[   29.329843]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   29.330201]  ? switch_task_namespaces+0xc6/0x110
[   29.330498]  do_exit+0xb0e/0x29d0
[   29.330725]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.331037]  ? __pfx_do_exit+0x10/0x10
[   29.331274]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.331562]  ? __x64_sys_ioctl+0x1ba/0x220
[   29.331816]  make_task_dead+0x181/0x3c0
[   29.332055]  rewind_stack_and_make_dead+0x16/0x20
[   29.332343] RIP: 0033:0x7f3f5da3ee5d
[   29.332566] Code: Unable to access opcode bytes at 0x7f3f5da3ee33.
[   29.332931] RSP: 002b:00007ffd1f6ad208 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.333392] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f3f5da3ee5d
[   29.333831] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.334250] RBP: 00007ffd1f6ad220 R08: 0000000000000800 R09: 0000000000000800
[   29.334666] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd1f6ad338
[   29.335096] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f3f5dd2d000
[   29.335519]  </TASK>
[   29.335660] irq event stamp: 0
[   29.335851] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   29.336221] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   29.336702] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   29.337187] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   29.337576] ---[ end trace 0000000000000000 ]---
[   29.342994] iommufd_mock iommufd_mock61: Adding to iommu group 61
[   29.343574] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#62] SMP KASAN NOPTI
[   29.344277] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   29.344760] CPU: 0 UID: 0 PID: 793 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.345487] Tainted: [D]=DIE, [W]=WARN
[   29.345719] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.346393] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.346758] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   29.347842] RSP: 0018:ffff88801feffb78 EFLAGS: 00010246
[   29.348162] RAX: dffffc0000000000 RBX: ffff88801fe15800 RCX: 1ffffffff0dd8bdc
[   29.348591] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880162b2d3c
[   29.349022] RBP: ffff88801feffbc8 R08: 0000000000000000 R09: 0000000000000000
[   29.349448] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   29.349876] R13: 0000000000000001 R14: ffff88801feffe18 R15: ffff88801291d408
[   29.350315] FS:  00007fe5f40c5600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.350811] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.351162] CR2: 00000000200006c0 CR3: 0000000016352002 CR4: 0000000000770ef0
[   29.351594] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.352021] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.352449] PKRU: 55555554
[   29.352622] Call Trace:
[   29.352780]  <TASK>
[   29.352921]  ? show_regs+0x6d/0x80
[   29.353141]  ? die_addr+0x45/0xb0
[   29.353357]  ? exc_general_protection+0x1ad/0x340
[   29.353659]  ? asm_exc_general_protection+0x2b/0x30
[   29.353965]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.354282]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   29.354600]  iommufd_device_detach+0x2a/0x2e0
[   29.354883]  iommufd_test+0x2f99/0x5cd0
[   29.355134]  ? do_raw_spin_unlock+0x15c/0x210
[   29.355436]  ? __pfx_iommufd_test+0x10/0x10
[   29.355721]  ? debug_smp_processor_id+0x20/0x30
[   29.356044]  ? rcu_is_watching+0x19/0xc0
[   29.356567]  ? lock_release+0x1ea/0x2c0
[   29.357029]  ? __might_fault+0xf1/0x1b0
[   29.357492]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   29.358085]  iommufd_fops_ioctl+0x38e/0x520
[   29.358552]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.359079]  ? trace_irq_enable+0xd1/0x110
[   29.359545]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.360091]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.360606]  __x64_sys_ioctl+0x1ba/0x220
[   29.361045]  x64_sys_call+0x122e/0x2150
[   29.361478]  do_syscall_64+0x6d/0x150
[   29.361891]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   29.362441] RIP: 0033:0x7fe5f3e3ee5d
[   29.362846] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   29.364747] RSP: 002b:00007fff3f8a3ba8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.365545] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fe5f3e3ee5d
[   29.366294] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.367046] RBP: 00007fff3f8a3bc0 R08: 0000000000000800 R09: 0000000000000800
[   29.367799] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff3f8a3cd8
[   29.368553] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fe5f410e000
[   29.369310]  </TASK>
[   29.369564] Modules linked in:
[   29.370038] ---[ end trace 0000000000000000 ]---
[   29.370602] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.371287] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   29.373161] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   29.373727] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   29.374461] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   29.375199] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   29.375930] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   29.376659] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   29.377419] FS:  00007fe5f40c5600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.378287] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.378891] CR2: 00000000200006c0 CR3: 0000000016352002 CR4: 0000000000770ef0
[   29.379622] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.380352] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.381079] PKRU: 55555554
[   29.382049] ------------[ cut here ]------------
[   29.382548] WARNING: CPU: 0 PID: 793 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   29.383544] Modules linked in:
[   29.383896] CPU: 0 UID: 0 PID: 793 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.385136] Tainted: [D]=DIE, [W]=WARN
[   29.385577] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.386786] RIP: 0010:iommufd_fops_release+0x386/0x420
[   29.387339] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   29.389232] RSP: 0018:ffff88801feffc08 EFLAGS: 00010293
[   29.389817] RAX: 0000000000000000 RBX: ffff888021754008 RCX: ffffffff83afe4ca
[   29.390589] RDX: ffff8880162b2540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   29.391345] RBP: ffff88801feffcb8 R08: 0000000000000000 R09: 0000000000000000
[   29.392093] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   29.392840] R13: 0000000000000000 R14: ffff88801feffc50 R15: 0000000000000000
[   29.393630] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.394500] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.395113] CR2: 00000000200006c0 CR3: 0000000007086003 CR4: 0000000000770ef0
[   29.395864] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.396612] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.397385] PKRU: 55555554
[   29.397717] Call Trace:
[   29.397995]  <TASK>
[   29.398241]  ? show_regs+0x6d/0x80
[   29.398628]  ? __warn+0xf3/0x380
[   29.399002]  ? report_bug+0x25e/0x4b0
[   29.399415]  ? iommufd_fops_release+0x386/0x420
[   29.399917]  ? report_bug+0x2cb/0x4b0
[   29.400324]  ? iommufd_fops_release+0x386/0x420
[   29.400822]  ? iommufd_fops_release+0x386/0x420
[   29.401317]  ? handle_bug+0x2cd/0x510
[   29.401770]  ? iommufd_fops_release+0x388/0x420
[   29.402274]  ? exc_invalid_op+0x3c/0x80
[   29.402702]  ? asm_exc_invalid_op+0x1f/0x30
[   29.403179]  ? iommufd_fops_release+0x21a/0x420
[   29.403676]  ? iommufd_fops_release+0x386/0x420
[   29.404170]  ? iommufd_fops_release+0x386/0x420
[   29.404665]  ? iommufd_fops_release+0x386/0x420
[   29.405160]  ? locks_remove_file+0x3b4/0x5d0
[   29.405658]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.406198]  ? __memcg_slab_free_hook+0xc1/0x540
[   29.406711]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   29.407289]  ? evm_file_release+0x141/0x220
[   29.407749]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.408281]  __fput+0x41c/0xb70
[   29.408645]  ____fput+0x22/0x30
[   29.409003]  task_work_run+0x19b/0x2b0
[   29.409465]  ? __pfx_task_work_run+0x10/0x10
[   29.409960]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   29.410541]  ? switch_task_namespaces+0xc6/0x110
[   29.411058]  do_exit+0xb0e/0x29d0
[   29.411436]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.411974]  ? __pfx_do_exit+0x10/0x10
[   29.412389]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.412899]  ? __x64_sys_ioctl+0x1ba/0x220
[   29.413373]  make_task_dead+0x181/0x3c0
[   29.413827]  rewind_stack_and_make_dead+0x16/0x20
[   29.414354] RIP: 0033:0x7fe5f3e3ee5d
[   29.414771] Code: Unable to access opcode bytes at 0x7fe5f3e3ee33.
[   29.415445] RSP: 002b:00007fff3f8a3ba8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.416378] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fe5f3e3ee5d
[   29.417358] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.418101] RBP: 00007fff3f8a3bc0 R08: 0000000000000800 R09: 0000000000000800
[   29.418849] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff3f8a3cd8
[   29.419575] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fe5f410e000
[   29.420310]  </TASK>
[   29.420557] irq event stamp: 0
[   29.420888] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   29.421560] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   29.422412] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   29.423258] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   29.423901] ---[ end trace 0000000000000000 ]---
[   29.424464] ------------[ cut here ]------------
[   29.424944] WARNING: CPU: 0 PID: 793 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   29.425932] Modules linked in:
[   29.426287] CPU: 0 UID: 0 PID: 793 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.427493] Tainted: [D]=DIE, [W]=WARN
[   29.427887] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.429045] RIP: 0010:iommufd_fops_release+0x392/0x420
[   29.429617] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   29.431526] RSP: 0018:ffff88801feffc08 EFLAGS: 00010293
[   29.432085] RAX: 0000000000000000 RBX: ffff888021754008 RCX: ffffffff83afe4ca
[   29.432827] RDX: ffff8880162b2540 RSI: ffffffff83afe642 RDI: ffff8880217540a0
[   29.433592] RBP: ffff88801feffcb8 R08: 0000000000000000 R09: 0000000000000000
[   29.434342] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   29.435096] R13: 0000000000000000 R14: ffff88801feffc50 R15: 0000000000000000
[   29.435833] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.436667] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.437274] CR2: 00000000200006c0 CR3: 0000000007086003 CR4: 0000000000770ef0
[   29.438037] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.438808] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.439546] PKRU: 55555554
[   29.439850] Call Trace:
[   29.440124]  <TASK>
[   29.440368]  ? show_regs+0x6d/0x80
[   29.440753]  ? __warn+0xf3/0x380
[   29.441115]  ? report_bug+0x25e/0x4b0
[   29.441541]  ? iommufd_fops_release+0x392/0x420
[   29.442064]  ? report_bug+0x2cb/0x4b0
[   29.442470]  ? iommufd_fops_release+0x392/0x420
[   29.442968]  ? iommufd_fops_release+0x392/0x420
[   29.443460]  ? handle_bug+0x2cd/0x510
[   29.443868]  ? iommufd_fops_release+0x394/0x420
[   29.444363]  ? exc_invalid_op+0x3c/0x80
[   29.444787]  ? asm_exc_invalid_op+0x1f/0x30
[   29.445245]  ? iommufd_fops_release+0x21a/0x420
[   29.445763]  ? iommufd_fops_release+0x392/0x420
[   29.446277]  ? iommufd_fops_release+0x392/0x420
[   29.446776]  ? iommufd_fops_release+0x392/0x420
[   29.447269]  ? locks_remove_file+0x3b4/0x5d0
[   29.447743]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.448270]  ? __memcg_slab_free_hook+0xc1/0x540
[   29.448775]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   29.449372]  ? evm_file_release+0x141/0x220
[   29.449839]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.450367]  __fput+0x41c/0xb70
[   29.450732]  ____fput+0x22/0x30
[   29.451089]  task_work_run+0x19b/0x2b0
[   29.451506]  ? __pfx_task_work_run+0x10/0x10
[   29.451977]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   29.452555]  ? switch_task_namespaces+0xc6/0x110
[   29.453061]  do_exit+0xb0e/0x29d0
[   29.453468]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.454025]  ? __pfx_do_exit+0x10/0x10
[   29.454440]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.454958]  ? __x64_sys_ioctl+0x1ba/0x220
[   29.455409]  make_task_dead+0x181/0x3c0
[   29.455836]  rewind_stack_and_make_dead+0x16/0x20
[   29.456344] RIP: 0033:0x7fe5f3e3ee5d
[   29.456739] Code: Unable to access opcode bytes at 0x7fe5f3e3ee33.
[   29.457406] RSP: 002b:00007fff3f8a3ba8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.458211] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fe5f3e3ee5d
[   29.458960] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.459702] RBP: 00007fff3f8a3bc0 R08: 0000000000000800 R09: 0000000000000800
[   29.460445] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff3f8a3cd8
[   29.461187] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fe5f410e000
[   29.461960]  </TASK>
[   29.462221] irq event stamp: 0
[   29.462557] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   29.463223] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   29.464082] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   29.464933] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   29.465611] ---[ end trace 0000000000000000 ]---
[   29.475030] iommufd_mock iommufd_mock62: Adding to iommu group 62
[   29.476697] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#63] SMP KASAN NOPTI
[   29.478039] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   29.478908] CPU: 1 UID: 0 PID: 794 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.480269] Tainted: [D]=DIE, [W]=WARN
[   29.480761] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.482051] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.482721] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   29.484831] RSP: 0018:ffff888021c6fb78 EFLAGS: 00010246
[   29.485475] RAX: dffffc0000000000 RBX: ffff888012289800 RCX: 1ffffffff0dd8bdd
[   29.486269] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff888012f287fc
[   29.487092] RBP: ffff888021c6fbc8 R08: 0000000000000000 R09: 0000000000000000
[   29.487934] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   29.488751] R13: 0000000000000001 R14: ffff888021c6fe18 R15: ffff888014fe3808
[   29.489517] FS:  00007f0bf45b6600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   29.490445] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.491100] CR2: 00000000200006c0 CR3: 00000000110de003 CR4: 0000000000770ef0
[   29.491889] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.492724] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.493564] PKRU: 55555554
[   29.493888] Call Trace:
[   29.494166]  <TASK>
[   29.494413]  ? show_regs+0x6d/0x80
[   29.494833]  ? die_addr+0x45/0xb0
[   29.495329]  ? exc_general_protection+0x1ad/0x340
[   29.495858]  ? asm_exc_general_protection+0x2b/0x30
[   29.496477]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.497042]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   29.497688]  iommufd_device_detach+0x2a/0x2e0
[   29.498176]  iommufd_test+0x2f99/0x5cd0
[   29.498618]  ? do_raw_spin_unlock+0x15c/0x210
[   29.499189]  ? __pfx_iommufd_test+0x10/0x10
[   29.499649]  ? debug_smp_processor_id+0x20/0x30
[   29.500218]  ? rcu_is_watching+0x19/0xc0
[   29.500654]  ? lock_release+0x1ea/0x2c0
[   29.501148]  ? __might_fault+0xf1/0x1b0
[   29.501583]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   29.502219]  iommufd_fops_ioctl+0x38e/0x520
[   29.502713]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.503263]  ? trace_irq_enable+0xd1/0x110
[   29.503794]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.504351]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.504938]  __x64_sys_ioctl+0x1ba/0x220
[   29.505379]  x64_sys_call+0x122e/0x2150
[   29.505872]  do_syscall_64+0x6d/0x150
[   29.506284]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   29.506912] RIP: 0033:0x7f0bf423ee5d
[   29.507309] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   29.509360] RSP: 002b:00007ffe036bc898 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.510185] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f0bf423ee5d
[   29.510998] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.511830] RBP: 00007ffe036bc8b0 R08: 0000000000000800 R09: 0000000000000800
[   29.512611] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe036bc9c8
[   29.513396] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f0bf45ff000
[   29.514241]  </TASK>
[   29.514496] Modules linked in:
[   29.514915] ---[ end trace 0000000000000000 ]---
[   29.515489] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.516130] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   29.518206] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   29.518883] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   29.519631] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   29.520473] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   29.521313] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   29.522078] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   29.522907] FS:  00007f0bf45b6600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   29.523831] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.524440] CR2: 00000000200006c0 CR3: 00000000110de003 CR4: 0000000000770ef0
[   29.525283] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.526120] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.526892] PKRU: 55555554
[   29.534936] ------------[ cut here ]------------
[   29.535496] WARNING: CPU: 1 PID: 794 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   29.536688] Modules linked in:
[   29.537114] CPU: 1 UID: 0 PID: 794 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.538454] Tainted: [D]=DIE, [W]=WARN
[   29.538941] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.540229] RIP: 0010:iommufd_fops_release+0x386/0x420
[   29.540789] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   29.542940] RSP: 0018:ffff888021c6fc08 EFLAGS: 00010293
[   29.543515] RAX: 0000000000000000 RBX: ffff888010ce8808 RCX: ffffffff83afe4ca
[   29.544339] RDX: ffff888012f28000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   29.545178] RBP: ffff888021c6fcb8 R08: 0000000000000000 R09: 0000000000000000
[   29.545986] R10: 0000000000000000 R11: ffff88806c543ec0 R12: 0000000000000000
[   29.546742] R13: 0000000000000000 R14: ffff888021c6fc50 R15: 0000000000000000
[   29.547486] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   29.548320] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.548930] CR2: 00007f25f7cb4018 CR3: 000000001af88001 CR4: 0000000000770ef0
[   29.549735] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.550484] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.551249] PKRU: 55555554
[   29.551557] Call Trace:
[   29.551838]  <TASK>
[   29.552090]  ? show_regs+0x6d/0x80
[   29.552480]  ? __warn+0xf3/0x380
[   29.552845]  ? report_bug+0x25e/0x4b0
[   29.553249]  ? iommufd_fops_release+0x386/0x420
[   29.553799]  ? report_bug+0x2cb/0x4b0
[   29.554206]  ? iommufd_fops_release+0x386/0x420
[   29.554692]  ? iommufd_fops_release+0x386/0x420
[   29.555193]  ? handle_bug+0x2cd/0x510
[   29.555602]  ? iommufd_fops_release+0x388/0x420
[   29.556100]  ? exc_invalid_op+0x3c/0x80
[   29.556520]  ? asm_exc_invalid_op+0x1f/0x30
[   29.556981]  ? iommufd_fops_release+0x21a/0x420
[   29.557542]  ? iommufd_fops_release+0x386/0x420
[   29.558044]  ? iommufd_fops_release+0x386/0x420
[   29.558537]  ? iommufd_fops_release+0x386/0x420
[   29.559033]  ? locks_remove_file+0x3b4/0x5d0
[   29.559509]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.560035]  ? __schedule+0xe9b/0x3680
[   29.560452]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   29.561031]  ? evm_file_release+0x141/0x220
[   29.561543]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.562073]  __fput+0x41c/0xb70
[   29.562438]  ____fput+0x22/0x30
[   29.562794]  task_work_run+0x19b/0x2b0
[   29.563215]  ? __pfx_task_work_run+0x10/0x10
[   29.563681]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   29.564252]  ? switch_task_namespaces+0xc6/0x110
[   29.564754]  do_exit+0xb0e/0x29d0
[   29.565126]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.565716]  ? __pfx_do_exit+0x10/0x10
[   29.566132]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.566640]  ? __x64_sys_ioctl+0x1ba/0x220
[   29.567095]  make_task_dead+0x181/0x3c0
[   29.567518]  rewind_stack_and_make_dead+0x16/0x20
[   29.568029] RIP: 0033:0x7f0bf423ee5d
[   29.568425] Code: Unable to access opcode bytes at 0x7f0bf423ee33.
[   29.569070] RSP: 002b:00007ffe036bc898 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.569918] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f0bf423ee5d
[   29.570700] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.571454] RBP: 00007ffe036bc8b0 R08: 0000000000000800 R09: 0000000000000800
[   29.572221] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe036bc9c8
[   29.573009] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f0bf45ff000
[   29.573815]  </TASK>
[   29.574068] irq event stamp: 0
[   29.574405] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   29.575069] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   29.575924] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   29.576780] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   29.577456] ---[ end trace 0000000000000000 ]---
[   29.578034] ------------[ cut here ]------------
[   29.578528] WARNING: CPU: 1 PID: 794 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   29.579525] Modules linked in:
[   29.579871] CPU: 1 UID: 0 PID: 794 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.581117] Tainted: [D]=DIE, [W]=WARN
[   29.581550] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.582723] RIP: 0010:iommufd_fops_release+0x392/0x420
[   29.583280] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   29.585182] RSP: 0018:ffff888021c6fc08 EFLAGS: 00010293
[   29.585758] RAX: 0000000000000000 RBX: ffff888010ce8808 RCX: ffffffff83afe4ca
[   29.586501] RDX: ffff888012f28000 RSI: ffffffff83afe642 RDI: ffff888010ce88a0
[   29.587243] RBP: ffff888021c6fcb8 R08: 0000000000000000 R09: 0000000000000000
[   29.587985] R10: 0000000000000000 R11: ffff88806c543ec0 R12: 0000000000000000
[   29.588728] R13: 0000000000000000 R14: ffff888021c6fc50 R15: 0000000000000000
[   29.589493] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   29.590340] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.590938] CR2: 00007f25f7cb4018 CR3: 000000001af88001 CR4: 0000000000770ef0
[   29.591675] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.592421] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.593169] PKRU: 55555554
[   29.593491] Call Trace:
[   29.593772]  <TASK>
[   29.594018]  ? show_regs+0x6d/0x80
[   29.594403]  ? __warn+0xf3/0x380
[   29.594775]  ? report_bug+0x25e/0x4b0
[   29.595183]  ? iommufd_fops_release+0x392/0x420
[   29.595679]  ? report_bug+0x2cb/0x4b0
[   29.596085]  ? iommufd_fops_release+0x392/0x420
[   29.596584]  ? iommufd_fops_release+0x392/0x420
[   29.597080]  ? handle_bug+0x2cd/0x510
[   29.597512]  ? iommufd_fops_release+0x394/0x420
[   29.598012]  ? exc_invalid_op+0x3c/0x80
[   29.598439]  ? asm_exc_invalid_op+0x1f/0x30
[   29.598906]  ? iommufd_fops_release+0x21a/0x420
[   29.599401]  ? iommufd_fops_release+0x392/0x420
[   29.599895]  ? iommufd_fops_release+0x392/0x420
[   29.600392]  ? iommufd_fops_release+0x392/0x420
[   29.600886]  ? locks_remove_file+0x3b4/0x5d0
[   29.601394]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.601929]  ? __schedule+0xe9b/0x3680
[   29.602348]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   29.602932]  ? evm_file_release+0x141/0x220
[   29.603390]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.603917]  __fput+0x41c/0xb70
[   29.604277]  ____fput+0x22/0x30
[   29.604631]  task_work_run+0x19b/0x2b0
[   29.605053]  ? __pfx_task_work_run+0x10/0x10
[   29.605547]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   29.606127]  ? switch_task_namespaces+0xc6/0x110
[   29.606638]  do_exit+0xb0e/0x29d0
[   29.607019]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.607556]  ? __pfx_do_exit+0x10/0x10
[   29.607974]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.608484]  ? __x64_sys_ioctl+0x1ba/0x220
[   29.608934]  make_task_dead+0x181/0x3c0
[   29.609379]  rewind_stack_and_make_dead+0x16/0x20
[   29.609892] RIP: 0033:0x7f0bf423ee5d
[   29.610287] Code: Unable to access opcode bytes at 0x7f0bf423ee33.
[   29.610934] RSP: 002b:00007ffe036bc898 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.611711] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f0bf423ee5d
[   29.612439] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.613164] RBP: 00007ffe036bc8b0 R08: 0000000000000800 R09: 0000000000000800
[   29.613913] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe036bc9c8
[   29.614644] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f0bf45ff000
[   29.615385]  </TASK>
[   29.615632] irq event stamp: 0
[   29.615962] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   29.616608] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   29.617469] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   29.618310] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   29.618963] ---[ end trace 0000000000000000 ]---
[   29.625995] iommufd_mock iommufd_mock63: Adding to iommu group 63
[   29.627070] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#64] SMP KASAN NOPTI
[   29.628375] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   29.629230] CPU: 0 UID: 0 PID: 795 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.630449] Tainted: [D]=DIE, [W]=WARN
[   29.630853] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.631996] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.632599] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   29.634442] RSP: 0018:ffff88801f14fb78 EFLAGS: 00010246
[   29.634997] RAX: dffffc0000000000 RBX: ffff88801fe14400 RCX: 1ffffffff0dd8bdc
[   29.635723] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff888012f2d27c
[   29.636448] RBP: ffff88801f14fbc8 R08: 0000000000000000 R09: 0000000000000000
[   29.637172] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   29.637898] R13: 0000000000000001 R14: ffff88801f14fe18 R15: ffff88801291f008
[   29.638622] FS:  00007ff6c6044600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.639442] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.640036] CR2: 00000000200006c0 CR3: 0000000016352005 CR4: 0000000000770ef0
[   29.640765] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.641490] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.642235] PKRU: 55555554
[   29.642535] Call Trace:
[   29.642816]  <TASK>
[   29.643059]  ? show_regs+0x6d/0x80
[   29.643445]  ? die_addr+0x45/0xb0
[   29.643821]  ? exc_general_protection+0x1ad/0x340
[   29.644350]  ? asm_exc_general_protection+0x2b/0x30
[   29.644883]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.645433]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   29.645988]  iommufd_device_detach+0x2a/0x2e0
[   29.646474]  iommufd_test+0x2f99/0x5cd0
[   29.646905]  ? do_raw_spin_unlock+0x15c/0x210
[   29.647394]  ? __pfx_iommufd_test+0x10/0x10
[   29.647861]  ? debug_smp_processor_id+0x20/0x30
[   29.648388]  ? rcu_is_watching+0x19/0xc0
[   29.649005]  ? lock_release+0x1ea/0x2c0
[   29.649495]  ? __might_fault+0xf1/0x1b0
[   29.649953]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   29.650566]  iommufd_fops_ioctl+0x38e/0x520
[   29.650941]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.651213]  ? trace_irq_enable+0xd1/0x110
[   29.651449]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.651722]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.651983]  __x64_sys_ioctl+0x1ba/0x220
[   29.652204]  x64_sys_call+0x122e/0x2150
[   29.652419]  do_syscall_64+0x6d/0x150
[   29.652628]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   29.652899] RIP: 0033:0x7ff6c5e3ee5d
[   29.653102] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   29.654048] RSP: 002b:00007ffc348ca5d8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.654446] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007ff6c5e3ee5d
[   29.654831] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.655203] RBP: 00007ffc348ca5f0 R08: 0000000000000800 R09: 0000000000000800
[   29.655579] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc348ca708
[   29.655951] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007ff6c608d000
[   29.656330]  </TASK>
[   29.656456] Modules linked in:
[   29.656676] ---[ end trace 0000000000000000 ]---
[   29.656934] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.657248] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   29.658216] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   29.658500] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   29.658913] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   29.659354] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   29.659733] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   29.660103] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   29.660470] FS:  00007ff6c6044600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.660884] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.661185] CR2: 00000000200006c0 CR3: 0000000016352005 CR4: 0000000000770ef0
[   29.661567] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.661939] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.662309] PKRU: 55555554
[   29.662851] ------------[ cut here ]------------
[   29.663108] WARNING: CPU: 0 PID: 795 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   29.663614] Modules linked in:
[   29.663791] CPU: 0 UID: 0 PID: 795 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.664419] Tainted: [D]=DIE, [W]=WARN
[   29.664623] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.665222] RIP: 0010:iommufd_fops_release+0x386/0x420
[   29.665523] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   29.666462] RSP: 0018:ffff88801f14fc08 EFLAGS: 00010293
[   29.666747] RAX: 0000000000000000 RBX: ffff88801ac32808 RCX: ffffffff83afe4ca
[   29.667117] RDX: ffff888012f2ca80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   29.667486] RBP: ffff88801f14fcb8 R08: 0000000000000000 R09: 0000000000000000
[   29.667856] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   29.668225] R13: 0000000000000000 R14: ffff88801f14fc50 R15: 0000000000000000
[   29.668596] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.669010] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.669312] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   29.669696] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.670072] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.670446] PKRU: 55555554
[   29.670602] Call Trace:
[   29.670745]  <TASK>
[   29.670870]  ? show_regs+0x6d/0x80
[   29.671062]  ? __warn+0xf3/0x380
[   29.671248]  ? report_bug+0x25e/0x4b0
[   29.671501]  ? iommufd_fops_release+0x386/0x420
[   29.671797]  ? report_bug+0x2cb/0x4b0
[   29.672158]  ? iommufd_fops_release+0x386/0x420
[   29.672409]  ? iommufd_fops_release+0x386/0x420
[   29.672657]  ? handle_bug+0x2cd/0x510
[   29.672939]  ? iommufd_fops_release+0x388/0x420
[   29.673296]  ? exc_invalid_op+0x3c/0x80
[   29.673528]  ? asm_exc_invalid_op+0x1f/0x30
[   29.673759]  ? iommufd_fops_release+0x21a/0x420
[   29.674027]  ? iommufd_fops_release+0x386/0x420
[   29.674329]  ? iommufd_fops_release+0x386/0x420
[   29.674681]  ? iommufd_fops_release+0x386/0x420
[   29.674936]  ? locks_remove_file+0x3b4/0x5d0
[   29.675180]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.675444]  ? __memcg_slab_free_hook+0xc1/0x540
[   29.675701]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   29.675990]  ? evm_file_release+0x141/0x220
[   29.676219]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.676529]  __fput+0x41c/0xb70
[   29.676816]  ____fput+0x22/0x30
[   29.676994]  task_work_run+0x19b/0x2b0
[   29.677206]  ? __pfx_task_work_run+0x10/0x10
[   29.677506]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   29.677899]  ? switch_task_namespaces+0xc6/0x110
[   29.678157]  do_exit+0xb0e/0x29d0
[   29.678347]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.678614]  ? __pfx_do_exit+0x10/0x10
[   29.678888]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.679147]  ? __x64_sys_ioctl+0x1ba/0x220
[   29.679467]  make_task_dead+0x181/0x3c0
[   29.679697]  rewind_stack_and_make_dead+0x16/0x20
[   29.679987] RIP: 0033:0x7ff6c5e3ee5d
[   29.680291] Code: Unable to access opcode bytes at 0x7ff6c5e3ee33.
[   29.680617] RSP: 002b:00007ffc348ca5d8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.681165] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007ff6c5e3ee5d
[   29.681556] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.681969] RBP: 00007ffc348ca5f0 R08: 0000000000000800 R09: 0000000000000800
[   29.682443] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc348ca708
[   29.682822] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007ff6c608d000
[   29.683195]  </TASK>
[   29.683321] irq event stamp: 0
[   29.683538] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   29.683973] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   29.684415] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   29.684974] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   29.685306] ---[ end trace 0000000000000000 ]---
[   29.685668] ------------[ cut here ]------------
[   29.686018] WARNING: CPU: 0 PID: 795 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   29.686520] Modules linked in:
[   29.686710] CPU: 0 UID: 0 PID: 795 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.687460] Tainted: [D]=DIE, [W]=WARN
[   29.687665] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.688296] RIP: 0010:iommufd_fops_release+0x392/0x420
[   29.688680] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   29.689804] RSP: 0018:ffff88801f14fc08 EFLAGS: 00010293
[   29.690085] RAX: 0000000000000000 RBX: ffff88801ac32808 RCX: ffffffff83afe4ca
[   29.690459] RDX: ffff888012f2ca80 RSI: ffffffff83afe642 RDI: ffff88801ac328a0
[   29.690836] RBP: ffff88801f14fcb8 R08: 0000000000000000 R09: 0000000000000000
[   29.691212] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   29.691581] R13: 0000000000000000 R14: ffff88801f14fc50 R15: 0000000000000000
[   29.691950] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.692364] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.692667] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   29.693038] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.693422] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.693795] PKRU: 55555554
[   29.693946] Call Trace:
[   29.694083]  <TASK>
[   29.694207]  ? show_regs+0x6d/0x80
[   29.694400]  ? __warn+0xf3/0x380
[   29.694581]  ? report_bug+0x25e/0x4b0
[   29.694790]  ? iommufd_fops_release+0x392/0x420
[   29.695039]  ? report_bug+0x2cb/0x4b0
[   29.695244]  ? iommufd_fops_release+0x392/0x420
[   29.695489]  ? iommufd_fops_release+0x392/0x420
[   29.695736]  ? handle_bug+0x2cd/0x510
[   29.695937]  ? iommufd_fops_release+0x394/0x420
[   29.696185]  ? exc_invalid_op+0x3c/0x80
[   29.696397]  ? asm_exc_invalid_op+0x1f/0x30
[   29.696626]  ? iommufd_fops_release+0x21a/0x420
[   29.696875]  ? iommufd_fops_release+0x392/0x420
[   29.697122]  ? iommufd_fops_release+0x392/0x420
[   29.697383]  ? iommufd_fops_release+0x392/0x420
[   29.697630]  ? locks_remove_file+0x3b4/0x5d0
[   29.697865]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.698128]  ? __memcg_slab_free_hook+0xc1/0x540
[   29.698379]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   29.698666]  ? evm_file_release+0x141/0x220
[   29.698897]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.699159]  __fput+0x41c/0xb70
[   29.699340]  ____fput+0x22/0x30
[   29.699517]  task_work_run+0x19b/0x2b0
[   29.699724]  ? __pfx_task_work_run+0x10/0x10
[   29.699960]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   29.700247]  ? switch_task_namespaces+0xc6/0x110
[   29.700500]  do_exit+0xb0e/0x29d0
[   29.700687]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.700955]  ? __pfx_do_exit+0x10/0x10
[   29.701163]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.701430]  ? __x64_sys_ioctl+0x1ba/0x220
[   29.701660]  make_task_dead+0x181/0x3c0
[   29.701873]  rewind_stack_and_make_dead+0x16/0x20
[   29.702131] RIP: 0033:0x7ff6c5e3ee5d
[   29.702327] Code: Unable to access opcode bytes at 0x7ff6c5e3ee33.
[   29.702650] RSP: 002b:00007ffc348ca5d8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.703050] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007ff6c5e3ee5d
[   29.703414] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.703777] RBP: 00007ffc348ca5f0 R08: 0000000000000800 R09: 0000000000000800
[   29.704139] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc348ca708
[   29.704501] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007ff6c608d000
[   29.704872]  </TASK>
[   29.704996] irq event stamp: 0
[   29.705164] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   29.705499] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   29.705916] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   29.706332] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   29.706654] ---[ end trace 0000000000000000 ]---
[   29.711384] iommufd_mock iommufd_mock64: Adding to iommu group 64
[   29.712048] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#65] SMP KASAN NOPTI
[   29.712633] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   29.713090] CPU: 0 UID: 0 PID: 796 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.713805] Tainted: [D]=DIE, [W]=WARN
[   29.714005] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.714580] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.714891] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   29.715819] RSP: 0018:ffff88800faa7b78 EFLAGS: 00010246
[   29.716094] RAX: dffffc0000000000 RBX: ffff88801fe15a00 RCX: 1ffffffff0dd8bdc
[   29.716463] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880215907fc
[   29.716830] RBP: ffff88800faa7bc8 R08: 0000000000000000 R09: 0000000000000000
[   29.717197] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   29.717575] R13: 0000000000000001 R14: ffff88800faa7e18 R15: ffff88801291ec08
[   29.717943] FS:  00007fa3f8127600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.718359] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.718658] CR2: 00000000200006c0 CR3: 0000000016352004 CR4: 0000000000770ef0
[   29.719031] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.719395] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.719762] PKRU: 55555554
[   29.719911] Call Trace:
[   29.720047]  <TASK>
[   29.720169]  ? show_regs+0x6d/0x80
[   29.720359]  ? die_addr+0x45/0xb0
[   29.720545]  ? exc_general_protection+0x1ad/0x340
[   29.720804]  ? asm_exc_general_protection+0x2b/0x30
[   29.721071]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.721346]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   29.721628]  iommufd_device_detach+0x2a/0x2e0
[   29.721869]  iommufd_test+0x2f99/0x5cd0
[   29.722079]  ? do_raw_spin_unlock+0x15c/0x210
[   29.722320]  ? __pfx_iommufd_test+0x10/0x10
[   29.722549]  ? debug_smp_processor_id+0x20/0x30
[   29.722801]  ? rcu_is_watching+0x19/0xc0
[   29.723016]  ? lock_release+0x1ea/0x2c0
[   29.723226]  ? __might_fault+0xf1/0x1b0
[   29.723439]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   29.723727]  iommufd_fops_ioctl+0x38e/0x520
[   29.723957]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.724212]  ? trace_irq_enable+0xd1/0x110
[   29.724441]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.724709]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.724966]  __x64_sys_ioctl+0x1ba/0x220
[   29.725185]  x64_sys_call+0x122e/0x2150
[   29.725402]  do_syscall_64+0x6d/0x150
[   29.725606]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   29.725876] RIP: 0033:0x7fa3f7e3ee5d
[   29.726071] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   29.727009] RSP: 002b:00007ffe8cea93b8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.727403] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fa3f7e3ee5d
[   29.727770] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.728136] RBP: 00007ffe8cea93d0 R08: 0000000000000800 R09: 0000000000000800
[   29.728504] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe8cea94e8
[   29.728869] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fa3f8170000
[   29.729241]  </TASK>
[   29.729370] Modules linked in:
[   29.729633] ---[ end trace 0000000000000000 ]---
[   29.729910] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.730249] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   29.731271] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   29.731557] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   29.731953] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   29.732350] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   29.732748] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   29.733159] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   29.733618] FS:  00007fa3f8127600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   29.734086] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.734401] CR2: 00000000200006c0 CR3: 0000000016352004 CR4: 0000000000770ef0
[   29.734796] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.735171] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.735539] PKRU: 55555554
[   29.737001] ------------[ cut here ]------------
[   29.737753] WARNING: CPU: 1 PID: 796 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   29.739110] Modules linked in:
[   29.739565] CPU: 1 UID: 0 PID: 796 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.741133] Tainted: [D]=DIE, [W]=WARN
[   29.741693] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.743053] RIP: 0010:iommufd_fops_release+0x386/0x420
[   29.743684] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   29.745886] RSP: 0018:ffff88800faa7c08 EFLAGS: 00010293
[   29.746521] RAX: 0000000000000000 RBX: ffff88801ac36808 RCX: ffffffff83afe4ca
[   29.747347] RDX: ffff888021590000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   29.748227] RBP: ffff88800faa7cb8 R08: 0000000000000000 R09: 0000000000000000
[   29.749045] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   29.749924] R13: 0000000000000000 R14: ffff88800faa7c50 R15: 0000000000000000
[   29.750666] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   29.751511] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.752124] CR2: 00007f25f7ccd000 CR3: 0000000007086002 CR4: 0000000000770ef0
[   29.752885] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.753725] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.754490] PKRU: 55555554
[   29.754803] Call Trace:
[   29.755081]  <TASK>
[   29.755334]  ? show_regs+0x6d/0x80
[   29.755760]  ? __warn+0xf3/0x380
[   29.756131]  ? report_bug+0x25e/0x4b0
[   29.756545]  ? iommufd_fops_release+0x386/0x420
[   29.757046]  ? report_bug+0x2cb/0x4b0
[   29.757519]  ? iommufd_fops_release+0x386/0x420
[   29.758023]  ? iommufd_fops_release+0x386/0x420
[   29.758525]  ? handle_bug+0x2cd/0x510
[   29.758942]  ? iommufd_fops_release+0x388/0x420
[   29.759437]  ? exc_invalid_op+0x3c/0x80
[   29.759858]  ? asm_exc_invalid_op+0x1f/0x30
[   29.760314]  ? iommufd_fops_release+0x21a/0x420
[   29.760808]  ? iommufd_fops_release+0x386/0x420
[   29.761318]  ? iommufd_fops_release+0x386/0x420
[   29.761885]  ? iommufd_fops_release+0x386/0x420
[   29.762377]  ? locks_remove_file+0x3b4/0x5d0
[   29.762853]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.763385]  ? __memcg_slab_free_hook+0xc1/0x540
[   29.763903]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   29.764490]  ? evm_file_release+0x141/0x220
[   29.764953]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.765548]  __fput+0x41c/0xb70
[   29.765920]  ____fput+0x22/0x30
[   29.766277]  task_work_run+0x19b/0x2b0
[   29.766698]  ? __pfx_task_work_run+0x10/0x10
[   29.767183]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   29.767768]  ? switch_task_namespaces+0xc6/0x110
[   29.768278]  do_exit+0xb0e/0x29d0
[   29.768660]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.769210]  ? __pfx_do_exit+0x10/0x10
[   29.769691]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.770223]  ? __x64_sys_ioctl+0x1ba/0x220
[   29.770675]  make_task_dead+0x181/0x3c0
[   29.771106]  rewind_stack_and_make_dead+0x16/0x20
[   29.771618] RIP: 0033:0x7fa3f7e3ee5d
[   29.772016] Code: Unable to access opcode bytes at 0x7fa3f7e3ee33.
[   29.772674] RSP: 002b:00007ffe8cea93b8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.773544] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fa3f7e3ee5d
[   29.774303] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.775063] RBP: 00007ffe8cea93d0 R08: 0000000000000800 R09: 0000000000000800
[   29.775824] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe8cea94e8
[   29.776576] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fa3f8170000
[   29.777404]  </TASK>
[   29.777665] irq event stamp: 0
[   29.778054] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   29.778751] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   29.779621] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   29.780499] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   29.781210] ---[ end trace 0000000000000000 ]---
[   29.781880] ------------[ cut here ]------------
[   29.782430] WARNING: CPU: 1 PID: 796 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   29.783421] Modules linked in:
[   29.783763] CPU: 1 UID: 0 PID: 796 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.784980] Tainted: [D]=DIE, [W]=WARN
[   29.785451] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.786631] RIP: 0010:iommufd_fops_release+0x392/0x420
[   29.787194] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   29.789085] RSP: 0018:ffff88800faa7c08 EFLAGS: 00010293
[   29.789710] RAX: 0000000000000000 RBX: ffff88801ac36808 RCX: ffffffff83afe4ca
[   29.790456] RDX: ffff888021590000 RSI: ffffffff83afe642 RDI: ffff88801ac368a0
[   29.791206] RBP: ffff88800faa7cb8 R08: 0000000000000000 R09: 0000000000000000
[   29.791950] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   29.792694] R13: 0000000000000000 R14: ffff88800faa7c50 R15: 0000000000000000
[   29.793506] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   29.794339] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.794942] CR2: 00007f25f7ccd000 CR3: 0000000007086002 CR4: 0000000000770ef0
[   29.795702] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.796468] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.797235] PKRU: 55555554
[   29.797618] Call Trace:
[   29.797918]  <TASK>
[   29.798169]  ? show_regs+0x6d/0x80
[   29.798564]  ? __warn+0xf3/0x380
[   29.798948]  ? report_bug+0x25e/0x4b0
[   29.799367]  ? iommufd_fops_release+0x392/0x420
[   29.799876]  ? report_bug+0x2cb/0x4b0
[   29.800288]  ? iommufd_fops_release+0x392/0x420
[   29.800795]  ? iommufd_fops_release+0x392/0x420
[   29.801303]  ? handle_bug+0x2cd/0x510
[   29.801785]  ? iommufd_fops_release+0x394/0x420
[   29.802326]  ? exc_invalid_op+0x3c/0x80
[   29.802771]  ? asm_exc_invalid_op+0x1f/0x30
[   29.803239]  ? iommufd_fops_release+0x21a/0x420
[   29.803744]  ? iommufd_fops_release+0x392/0x420
[   29.804253]  ? iommufd_fops_release+0x392/0x420
[   29.804757]  ? iommufd_fops_release+0x392/0x420
[   29.805263]  ? locks_remove_file+0x3b4/0x5d0
[   29.805810]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.806377]  ? __memcg_slab_free_hook+0xc1/0x540
[   29.806901]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   29.807495]  ? evm_file_release+0x141/0x220
[   29.807967]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.808514]  __fput+0x41c/0xb70
[   29.808884]  ____fput+0x22/0x30
[   29.809245]  task_work_run+0x19b/0x2b0
[   29.809734]  ? __pfx_task_work_run+0x10/0x10
[   29.810253]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   29.810865]  ? switch_task_namespaces+0xc6/0x110
[   29.811386]  do_exit+0xb0e/0x29d0
[   29.811777]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.812335]  ? __pfx_do_exit+0x10/0x10
[   29.812770]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.813308]  ? __x64_sys_ioctl+0x1ba/0x220
[   29.813850]  make_task_dead+0x181/0x3c0
[   29.814303]  rewind_stack_and_make_dead+0x16/0x20
[   29.814834] RIP: 0033:0x7fa3f7e3ee5d
[   29.815244] Code: Unable to access opcode bytes at 0x7fa3f7e3ee33.
[   29.815908] RSP: 002b:00007ffe8cea93b8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.816718] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fa3f7e3ee5d
[   29.817550] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.818329] RBP: 00007ffe8cea93d0 R08: 0000000000000800 R09: 0000000000000800
[   29.819102] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffe8cea94e8
[   29.819867] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fa3f8170000
[   29.820647]  </TASK>
[   29.820906] irq event stamp: 0
[   29.821255] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   29.821998] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   29.822908] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   29.823790] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   29.824462] ---[ end trace 0000000000000000 ]---
[   29.831583] iommufd_mock iommufd_mock65: Adding to iommu group 65
[   29.833886] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#66] SMP KASAN NOPTI
[   29.835206] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   29.836042] CPU: 1 UID: 0 PID: 797 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.837350] Tainted: [D]=DIE, [W]=WARN
[   29.837766] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.838965] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.839615] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   29.841547] RSP: 0018:ffff888021cb7b78 EFLAGS: 00010246
[   29.842104] RAX: dffffc0000000000 RBX: ffff888012288400 RCX: 1ffffffff0dd8bdd
[   29.842847] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88802158527c
[   29.843582] RBP: ffff888021cb7bc8 R08: 0000000000000000 R09: 0000000000000000
[   29.844339] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   29.845088] R13: 0000000000000001 R14: ffff888021cb7e18 R15: ffff888014fe1408
[   29.845823] FS:  00007f0d016b6600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   29.846671] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.847290] CR2: 00000000200006c0 CR3: 0000000016352005 CR4: 0000000000770ef0
[   29.848046] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.848811] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.849579] PKRU: 55555554
[   29.849887] Call Trace:
[   29.850177]  <TASK>
[   29.850429]  ? show_regs+0x6d/0x80
[   29.850832]  ? die_addr+0x45/0xb0
[   29.851220]  ? exc_general_protection+0x1ad/0x340
[   29.851770]  ? asm_exc_general_protection+0x2b/0x30
[   29.852327]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.852902]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   29.853475]  iommufd_device_detach+0x2a/0x2e0
[   29.853977]  iommufd_test+0x2f99/0x5cd0
[   29.854419]  ? do_raw_spin_unlock+0x15c/0x210
[   29.854934]  ? __pfx_iommufd_test+0x10/0x10
[   29.855413]  ? debug_smp_processor_id+0x20/0x30
[   29.855943]  ? rcu_is_watching+0x19/0xc0
[   29.856403]  ? lock_release+0x1ea/0x2c0
[   29.856848]  ? __might_fault+0xf1/0x1b0
[   29.857296]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   29.857902]  iommufd_fops_ioctl+0x38e/0x520
[   29.858383]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.858923]  ? trace_irq_enable+0xd1/0x110
[   29.859418]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.860032]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.860576]  __x64_sys_ioctl+0x1ba/0x220
[   29.861062]  x64_sys_call+0x122e/0x2150
[   29.861501]  do_syscall_64+0x6d/0x150
[   29.861925]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   29.862480] RIP: 0033:0x7f0d0143ee5d
[   29.862895] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   29.864846] RSP: 002b:00007ffcafaa9fd8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.865636] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f0d0143ee5d
[   29.866371] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.867116] RBP: 00007ffcafaa9ff0 R08: 0000000000000800 R09: 0000000000000800
[   29.867853] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcafaaa108
[   29.868594] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f0d016ff000
[   29.869340]  </TASK>
[   29.869588] Modules linked in:
[   29.870004] ---[ end trace 0000000000000000 ]---
[   29.870501] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.871114] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   29.872991] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   29.873603] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   29.874349] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   29.875104] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   29.875845] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   29.876580] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   29.877438] FS:  00007f0d016b6600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   29.878294] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.878924] CR2: 00000000200006c0 CR3: 0000000016352005 CR4: 0000000000770ef0
[   29.879679] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.880434] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.881190] PKRU: 55555554
[   29.882519] ------------[ cut here ]------------
[   29.883051] WARNING: CPU: 1 PID: 797 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   29.884101] Modules linked in:
[   29.884467] CPU: 1 UID: 0 PID: 797 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.885919] Tainted: [D]=DIE, [W]=WARN
[   29.886333] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.887509] RIP: 0010:iommufd_fops_release+0x386/0x420
[   29.888066] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   29.889985] RSP: 0018:ffff888021cb7c08 EFLAGS: 00010293
[   29.890550] RAX: 0000000000000000 RBX: ffff888010ced008 RCX: ffffffff83afe4ca
[   29.891298] RDX: ffff888021584a80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   29.892049] RBP: ffff888021cb7cb8 R08: 0000000000000000 R09: 0000000000000000
[   29.892793] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   29.893562] R13: 0000000000000000 R14: ffff888021cb7c50 R15: 0000000000000000
[   29.894310] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   29.895152] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.895757] CR2: 00000000200006c0 CR3: 0000000007086003 CR4: 0000000000770ef0
[   29.896520] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.897279] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.898077] PKRU: 55555554
[   29.898388] Call Trace:
[   29.898671]  <TASK>
[   29.898927]  ? show_regs+0x6d/0x80
[   29.899321]  ? __warn+0xf3/0x380
[   29.899686]  ? report_bug+0x25e/0x4b0
[   29.900090]  ? iommufd_fops_release+0x386/0x420
[   29.900581]  ? report_bug+0x2cb/0x4b0
[   29.900985]  ? iommufd_fops_release+0x386/0x420
[   29.901497]  ? iommufd_fops_release+0x386/0x420
[   29.902005]  ? handle_bug+0x2cd/0x510
[   29.902415]  ? iommufd_fops_release+0x388/0x420
[   29.902918]  ? exc_invalid_op+0x3c/0x80
[   29.903341]  ? asm_exc_invalid_op+0x1f/0x30
[   29.903798]  ? iommufd_fops_release+0x21a/0x420
[   29.904290]  ? iommufd_fops_release+0x386/0x420
[   29.904784]  ? iommufd_fops_release+0x386/0x420
[   29.905277]  ? iommufd_fops_release+0x386/0x420
[   29.905793]  ? locks_remove_file+0x3b4/0x5d0
[   29.906271]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.906806]  ? __memcg_slab_free_hook+0xc1/0x540
[   29.907313]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   29.907885]  ? evm_file_release+0x141/0x220
[   29.908345]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.908874]  __fput+0x41c/0xb70
[   29.909235]  ____fput+0x22/0x30
[   29.909616]  task_work_run+0x19b/0x2b0
[   29.910037]  ? __pfx_task_work_run+0x10/0x10
[   29.910506]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   29.911088]  ? switch_task_namespaces+0xc6/0x110
[   29.911592]  do_exit+0xb0e/0x29d0
[   29.911965]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.912518]  ? __pfx_do_exit+0x10/0x10
[   29.912941]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.913487]  ? __x64_sys_ioctl+0x1ba/0x220
[   29.913947]  make_task_dead+0x181/0x3c0
[   29.914382]  rewind_stack_and_make_dead+0x16/0x20
[   29.914905] RIP: 0033:0x7f0d0143ee5d
[   29.915313] Code: Unable to access opcode bytes at 0x7f0d0143ee33.
[   29.915973] RSP: 002b:00007ffcafaa9fd8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.916780] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f0d0143ee5d
[   29.917565] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.918324] RBP: 00007ffcafaa9ff0 R08: 0000000000000800 R09: 0000000000000800
[   29.919093] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcafaaa108
[   29.919833] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f0d016ff000
[   29.920586]  </TASK>
[   29.920838] irq event stamp: 0
[   29.921179] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   29.921864] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   29.922739] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   29.923600] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   29.924258] ---[ end trace 0000000000000000 ]---
[   29.924834] ------------[ cut here ]------------
[   29.925355] WARNING: CPU: 1 PID: 797 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   29.926352] Modules linked in:
[   29.926701] CPU: 1 UID: 0 PID: 797 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.928099] Tainted: [D]=DIE, [W]=WARN
[   29.928505] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.929846] RIP: 0010:iommufd_fops_release+0x392/0x420
[   29.930408] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   29.932465] RSP: 0018:ffff888021cb7c08 EFLAGS: 00010293
[   29.933029] RAX: 0000000000000000 RBX: ffff888010ced008 RCX: ffffffff83afe4ca
[   29.933931] RDX: ffff888021584a80 RSI: ffffffff83afe642 RDI: ffff888010ced0a0
[   29.934688] RBP: ffff888021cb7cb8 R08: 0000000000000000 R09: 0000000000000000
[   29.935519] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   29.936342] R13: 0000000000000000 R14: ffff888021cb7c50 R15: 0000000000000000
[   29.937152] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   29.938083] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.938689] CR2: 00000000200006c0 CR3: 0000000007086003 CR4: 0000000000770ef0
[   29.939505] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.940246] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.941050] PKRU: 55555554
[   29.941372] Call Trace:
[   29.941697]  <TASK>
[   29.941975]  ? show_regs+0x6d/0x80
[   29.942357]  ? __warn+0xf3/0x380
[   29.942724]  ? report_bug+0x25e/0x4b0
[   29.943128]  ? iommufd_fops_release+0x392/0x420
[   29.943657]  ? report_bug+0x2cb/0x4b0
[   29.944083]  ? iommufd_fops_release+0x392/0x420
[   29.944573]  ? iommufd_fops_release+0x392/0x420
[   29.945081]  ? handle_bug+0x2cd/0x510
[   29.945564]  ? iommufd_fops_release+0x394/0x420
[   29.946061]  ? exc_invalid_op+0x3c/0x80
[   29.946484]  ? asm_exc_invalid_op+0x1f/0x30
[   29.946965]  ? iommufd_fops_release+0x21a/0x420
[   29.947520]  ? iommufd_fops_release+0x392/0x420
[   29.948014]  ? iommufd_fops_release+0x392/0x420
[   29.948600]  ? iommufd_fops_release+0x392/0x420
[   29.949247]  ? locks_remove_file+0x3b4/0x5d0
[   29.949742]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.950270]  ? __memcg_slab_free_hook+0xc1/0x540
[   29.950935]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   29.951507]  ? evm_file_release+0x141/0x220
[   29.951958]  ? __pfx_iommufd_fops_release+0x10/0x10
[   29.952614]  __fput+0x41c/0xb70
[   29.952974]  ____fput+0x22/0x30
[   29.953351]  task_work_run+0x19b/0x2b0
[   29.953772]  ? __pfx_task_work_run+0x10/0x10
[   29.954300]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   29.954958]  ? switch_task_namespaces+0xc6/0x110
[   29.955465]  do_exit+0xb0e/0x29d0
[   29.955859]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   29.956479]  ? __pfx_do_exit+0x10/0x10
[   29.956892]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   29.957548]  ? __x64_sys_ioctl+0x1ba/0x220
[   29.958008]  make_task_dead+0x181/0x3c0
[   29.958442]  rewind_stack_and_make_dead+0x16/0x20
[   29.958968] RIP: 0033:0x7f0d0143ee5d
[   29.959497] Code: Unable to access opcode bytes at 0x7f0d0143ee33.
[   29.960149] RSP: 002b:00007ffcafaa9fd8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   29.961063] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f0d0143ee5d
[   29.961847] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   29.962612] RBP: 00007ffcafaa9ff0 R08: 0000000000000800 R09: 0000000000000800
[   29.963523] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcafaaa108
[   29.964265] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f0d016ff000
[   29.965143]  </TASK>
[   29.965419] irq event stamp: 0
[   29.965762] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   29.966473] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   29.967410] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   29.968390] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   29.969050] ---[ end trace 0000000000000000 ]---
[   29.976514] iommufd_mock iommufd_mock66: Adding to iommu group 66
[   29.978247] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#67] SMP KASAN NOPTI
[   29.979778] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   29.980805] CPU: 1 UID: 0 PID: 798 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   29.982481] Tainted: [D]=DIE, [W]=WARN
[   29.983005] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   29.984563] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   29.985342] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   29.987931] RSP: 0018:ffff8880215f7b78 EFLAGS: 00010246
[   29.988637] RAX: dffffc0000000000 RBX: ffff888012289a00 RCX: 1ffffffff0dd8bdd
[   29.989577] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff888021582d3c
[   29.990512] RBP: ffff8880215f7bc8 R08: 0000000000000000 R09: 0000000000000000
[   29.991456] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   29.992393] R13: 0000000000000001 R14: ffff8880215f7e18 R15: ffff888014fe0408
[   29.993330] FS:  00007fc03c04b600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   29.994385] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   29.995170] CR2: 00000000200006c0 CR3: 000000001c87c001 CR4: 0000000000770ef0
[   29.996124] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   29.997093] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   29.998061] PKRU: 55555554
[   29.998449] Call Trace:
[   29.998806]  <TASK>
[   29.999112]  ? show_regs+0x6d/0x80
[   29.999597]  ? die_addr+0x45/0xb0
[   30.000066]  ? exc_general_protection+0x1ad/0x340
[   30.000724]  ? asm_exc_general_protection+0x2b/0x30
[   30.001393]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.002085]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   30.002820]  iommufd_device_detach+0x2a/0x2e0
[   30.003440]  iommufd_test+0x2f99/0x5cd0
[   30.003981]  ? do_raw_spin_unlock+0x15c/0x210
[   30.004600]  ? __pfx_iommufd_test+0x10/0x10
[   30.005182]  ? debug_smp_processor_id+0x20/0x30
[   30.005810]  ? rcu_is_watching+0x19/0xc0
[   30.006356]  ? lock_release+0x1ea/0x2c0
[   30.006868]  ? __might_fault+0xf1/0x1b0
[   30.007304]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   30.007889]  iommufd_fops_ioctl+0x38e/0x520
[   30.008352]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.008871]  ? trace_irq_enable+0xd1/0x110
[   30.009333]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.009880]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.010394]  __x64_sys_ioctl+0x1ba/0x220
[   30.010845]  x64_sys_call+0x122e/0x2150
[   30.011270]  do_syscall_64+0x6d/0x150
[   30.011681]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   30.012229] RIP: 0033:0x7fc03be3ee5d
[   30.012629] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   30.014567] RSP: 002b:00007ffd65b785c8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.015401] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fc03be3ee5d
[   30.016171] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.016943] RBP: 00007ffd65b785e0 R08: 0000000000000800 R09: 0000000000000800
[   30.017691] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd65b786f8
[   30.018435] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fc03c094000
[   30.019201]  </TASK>
[   30.019455] Modules linked in:
[   30.019911] ---[ end trace 0000000000000000 ]---
[   30.020420] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.021041] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   30.023095] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   30.023704] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   30.024469] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   30.025221] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   30.026047] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   30.026806] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   30.027568] FS:  00007fc03c04b600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   30.028428] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.029047] CR2: 00000000200006c0 CR3: 000000001c87c001 CR4: 0000000000770ef0
[   30.029895] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.030661] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.031438] PKRU: 55555554
[   30.032999] ------------[ cut here ]------------
[   30.034518] WARNING: CPU: 0 PID: 798 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   30.035707] Modules linked in:
[   30.036071] CPU: 0 UID: 0 PID: 798 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.037459] Tainted: [D]=DIE, [W]=WARN
[   30.037959] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.039153] RIP: 0010:iommufd_fops_release+0x386/0x420
[   30.039711] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   30.041708] RSP: 0018:ffff8880215f7c08 EFLAGS: 00010293
[   30.042362] RAX: 0000000000000000 RBX: ffff888015339008 RCX: ffffffff83afe4ca
[   30.043117] RDX: ffff888021582540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   30.043858] RBP: ffff8880215f7cb8 R08: 0000000000000000 R09: 0000000000000000
[   30.044597] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   30.045435] R13: 0000000000000000 R14: ffff8880215f7c50 R15: 0000000000000000
[   30.046274] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   30.047123] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.047727] CR2: 00007f25f7ce8000 CR3: 0000000007086005 CR4: 0000000000770ef0
[   30.048472] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.049212] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.050067] PKRU: 55555554
[   30.050479] Call Trace:
[   30.050767]  <TASK>
[   30.051021]  ? show_regs+0x6d/0x80
[   30.051415]  ? __warn+0xf3/0x380
[   30.051792]  ? report_bug+0x25e/0x4b0
[   30.052226]  ? iommufd_fops_release+0x386/0x420
[   30.052767]  ? report_bug+0x2cb/0x4b0
[   30.053205]  ? iommufd_fops_release+0x386/0x420
[   30.053847]  ? iommufd_fops_release+0x386/0x420
[   30.054597]  ? handle_bug+0x2cd/0x510
[   30.055051]  ? iommufd_fops_release+0x388/0x420
[   30.055579]  ? exc_invalid_op+0x3c/0x80
[   30.056013]  ? asm_exc_invalid_op+0x1f/0x30
[   30.056505]  ? iommufd_fops_release+0x21a/0x420
[   30.057029]  ? iommufd_fops_release+0x386/0x420
[   30.057662]  ? iommufd_fops_release+0x386/0x420
[   30.058300]  ? iommufd_fops_release+0x386/0x420
[   30.058820]  ? locks_remove_file+0x3b4/0x5d0
[   30.059314]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.059880]  ? __memcg_slab_free_hook+0xc1/0x540
[   30.060402]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   30.060993]  ? evm_file_release+0x141/0x220
[   30.061576]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.062340]  __fput+0x41c/0xb70
[   30.062748]  ____fput+0x22/0x30
[   30.063118]  task_work_run+0x19b/0x2b0
[   30.063586]  ? __pfx_task_work_run+0x10/0x10
[   30.064130]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   30.064722]  ? switch_task_namespaces+0xc6/0x110
[   30.065240]  do_exit+0xb0e/0x29d0
[   30.065708]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.066453]  ? __pfx_do_exit+0x10/0x10
[   30.066896]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.067421]  ? __x64_sys_ioctl+0x1ba/0x220
[   30.067888]  make_task_dead+0x181/0x3c0
[   30.068329]  rewind_stack_and_make_dead+0x16/0x20
[   30.068850] RIP: 0033:0x7fc03be3ee5d
[   30.069258] Code: Unable to access opcode bytes at 0x7fc03be3ee33.
[   30.069975] RSP: 002b:00007ffd65b785c8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.071054] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fc03be3ee5d
[   30.071835] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.072649] RBP: 00007ffd65b785e0 R08: 0000000000000800 R09: 0000000000000800
[   30.073499] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd65b786f8
[   30.074413] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fc03c094000
[   30.075257]  </TASK>
[   30.075530] irq event stamp: 0
[   30.075893] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   30.076611] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   30.077614] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   30.078683] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   30.079369] ---[ end trace 0000000000000000 ]---
[   30.079961] ------------[ cut here ]------------
[   30.080462] WARNING: CPU: 0 PID: 798 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   30.081510] Modules linked in:
[   30.081979] CPU: 0 UID: 0 PID: 798 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.083247] Tainted: [D]=DIE, [W]=WARN
[   30.083659] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.084849] RIP: 0010:iommufd_fops_release+0x392/0x420
[   30.085462] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   30.087546] RSP: 0018:ffff8880215f7c08 EFLAGS: 00010293
[   30.088118] RAX: 0000000000000000 RBX: ffff888015339008 RCX: ffffffff83afe4ca
[   30.088865] RDX: ffff888021582540 RSI: ffffffff83afe642 RDI: ffff8880153390a0
[   30.089650] RBP: ffff8880215f7cb8 R08: 0000000000000000 R09: 0000000000000000
[   30.090617] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   30.091369] R13: 0000000000000000 R14: ffff8880215f7c50 R15: 0000000000000000
[   30.092113] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   30.092944] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.093597] CR2: 00007f25f7ce8000 CR3: 0000000007086005 CR4: 0000000000770ef0
[   30.094445] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.095197] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.095940] PKRU: 55555554
[   30.096242] Call Trace:
[   30.096516]  <TASK>
[   30.096760]  ? show_regs+0x6d/0x80
[   30.097144]  ? __warn+0xf3/0x380
[   30.097548]  ? report_bug+0x25e/0x4b0
[   30.098115]  ? iommufd_fops_release+0x392/0x420
[   30.098628]  ? report_bug+0x2cb/0x4b0
[   30.099054]  ? iommufd_fops_release+0x392/0x420
[   30.099552]  ? iommufd_fops_release+0x392/0x420
[   30.100050]  ? handle_bug+0x2cd/0x510
[   30.100461]  ? iommufd_fops_release+0x394/0x420
[   30.100956]  ? exc_invalid_op+0x3c/0x80
[   30.101431]  ? asm_exc_invalid_op+0x1f/0x30
[   30.102066]  ? iommufd_fops_release+0x21a/0x420
[   30.102577]  ? iommufd_fops_release+0x392/0x420
[   30.103088]  ? iommufd_fops_release+0x392/0x420
[   30.103589]  ? iommufd_fops_release+0x392/0x420
[   30.104088]  ? locks_remove_file+0x3b4/0x5d0
[   30.104570]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.105109]  ? __memcg_slab_free_hook+0xc1/0x540
[   30.105667]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   30.106376]  ? evm_file_release+0x141/0x220
[   30.106856]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.107386]  __fput+0x41c/0xb70
[   30.107754]  ____fput+0x22/0x30
[   30.108112]  task_work_run+0x19b/0x2b0
[   30.108538]  ? __pfx_task_work_run+0x10/0x10
[   30.109003]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   30.109620]  ? switch_task_namespaces+0xc6/0x110
[   30.110119]  do_exit+0xb0e/0x29d0
[   30.110494]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.111042]  ? __pfx_do_exit+0x10/0x10
[   30.111462]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.111979]  ? __x64_sys_ioctl+0x1ba/0x220
[   30.112434]  make_task_dead+0x181/0x3c0
[   30.112856]  rewind_stack_and_make_dead+0x16/0x20
[   30.113411] RIP: 0033:0x7fc03be3ee5d
[   30.113807] Code: Unable to access opcode bytes at 0x7fc03be3ee33.
[   30.114452] RSP: 002b:00007ffd65b785c8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.115249] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fc03be3ee5d
[   30.115993] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.116737] RBP: 00007ffd65b785e0 R08: 0000000000000800 R09: 0000000000000800
[   30.117499] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd65b786f8
[   30.118237] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fc03c094000
[   30.119000]  </TASK>
[   30.119248] irq event stamp: 0
[   30.119578] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   30.120224] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   30.121073] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   30.121957] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   30.122610] ---[ end trace 0000000000000000 ]---
[   30.128242] iommufd_mock iommufd_mock67: Adding to iommu group 67
[   30.129328] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#68] SMP KASAN NOPTI
[   30.130641] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   30.131474] CPU: 0 UID: 0 PID: 799 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.132677] Tainted: [D]=DIE, [W]=WARN
[   30.133072] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.134218] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.134836] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   30.136685] RSP: 0018:ffff88801a5d7b78 EFLAGS: 00010246
[   30.137236] RAX: dffffc0000000000 RBX: ffff88801fe14800 RCX: 1ffffffff0dd8bdc
[   30.137965] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801156d27c
[   30.138691] RBP: ffff88801a5d7bc8 R08: 0000000000000000 R09: 0000000000000000
[   30.139422] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   30.140148] R13: 0000000000000001 R14: ffff88801a5d7e18 R15: ffff888013443008
[   30.140882] FS:  00007fd090749600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   30.141699] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.142310] CR2: 00000000200006c0 CR3: 000000001c87c002 CR4: 0000000000770ef0
[   30.143064] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.143807] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.144558] PKRU: 55555554
[   30.144866] Call Trace:
[   30.145146]  <TASK>
[   30.145394]  ? show_regs+0x6d/0x80
[   30.145786]  ? die_addr+0x45/0xb0
[   30.146164]  ? exc_general_protection+0x1ad/0x340
[   30.146697]  ? asm_exc_general_protection+0x2b/0x30
[   30.147246]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.147802]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   30.148342]  iommufd_device_detach+0x2a/0x2e0
[   30.148817]  iommufd_test+0x2f99/0x5cd0
[   30.149231]  ? do_raw_spin_unlock+0x15c/0x210
[   30.149708]  ? __pfx_iommufd_test+0x10/0x10
[   30.150156]  ? debug_smp_processor_id+0x20/0x30
[   30.150643]  ? rcu_is_watching+0x19/0xc0
[   30.151076]  ? lock_release+0x1ea/0x2c0
[   30.151493]  ? __might_fault+0xf1/0x1b0
[   30.151916]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   30.152481]  iommufd_fops_ioctl+0x38e/0x520
[   30.152933]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.153437]  ? trace_irq_enable+0xd1/0x110
[   30.153887]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.154414]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.154923]  __x64_sys_ioctl+0x1ba/0x220
[   30.155346]  x64_sys_call+0x122e/0x2150
[   30.155758]  do_syscall_64+0x6d/0x150
[   30.156157]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   30.156686] RIP: 0033:0x7fd09043ee5d
[   30.157072] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   30.158954] RSP: 002b:00007ffd5fbfa998 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.159741] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fd09043ee5d
[   30.160485] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.161251] RBP: 00007ffd5fbfa9b0 R08: 0000000000000800 R09: 0000000000000800
[   30.162002] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd5fbfaac8
[   30.162750] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fd090792000
[   30.163522]  </TASK>
[   30.163791] Modules linked in:
[   30.164355] ---[ end trace 0000000000000000 ]---
[   30.164905] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.165596] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   30.167488] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   30.168048] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   30.168797] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   30.169622] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   30.170367] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   30.171122] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   30.171871] FS:  00007fd090749600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   30.172710] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.173319] CR2: 00000000200006c0 CR3: 000000001c87c002 CR4: 0000000000770ef0
[   30.174132] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.174879] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.175624] PKRU: 55555554
[   30.176650] ------------[ cut here ]------------
[   30.177166] WARNING: CPU: 0 PID: 799 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   30.178235] Modules linked in:
[   30.178587] CPU: 0 UID: 0 PID: 799 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.179833] Tainted: [D]=DIE, [W]=WARN
[   30.180242] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.181434] RIP: 0010:iommufd_fops_release+0x386/0x420
[   30.181993] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   30.183924] RSP: 0018:ffff88801a5d7c08 EFLAGS: 00010293
[   30.184562] RAX: 0000000000000000 RBX: ffff888015338808 RCX: ffffffff83afe4ca
[   30.185599] RDX: ffff88801156ca80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   30.186348] RBP: ffff88801a5d7cb8 R08: 0000000000000000 R09: 0000000000000000
[   30.187140] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   30.188113] R13: 0000000000000000 R14: ffff88801a5d7c50 R15: 0000000000000000
[   30.188877] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   30.189757] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.190366] CR2: 00000000200006c0 CR3: 0000000007086005 CR4: 0000000000770ef0
[   30.191119] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.191865] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.192757] PKRU: 55555554
[   30.193294] Call Trace:
[   30.193616]  <TASK>
[   30.193863]  ? show_regs+0x6d/0x80
[   30.194249]  ? __warn+0xf3/0x380
[   30.194618]  ? report_bug+0x25e/0x4b0
[   30.195035]  ? iommufd_fops_release+0x386/0x420
[   30.195519]  ? report_bug+0x2cb/0x4b0
[   30.195915]  ? iommufd_fops_release+0x386/0x420
[   30.196429]  ? iommufd_fops_release+0x386/0x420
[   30.197004]  ? handle_bug+0x2cd/0x510
[   30.197563]  ? iommufd_fops_release+0x388/0x420
[   30.198081]  ? exc_invalid_op+0x3c/0x80
[   30.198518]  ? asm_exc_invalid_op+0x1f/0x30
[   30.198990]  ? iommufd_fops_release+0x21a/0x420
[   30.199494]  ? iommufd_fops_release+0x386/0x420
[   30.200001]  ? iommufd_fops_release+0x386/0x420
[   30.200518]  ? iommufd_fops_release+0x386/0x420
[   30.201143]  ? locks_remove_file+0x3b4/0x5d0
[   30.201778]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.202333]  ? __memcg_slab_free_hook+0xc1/0x540
[   30.202866]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   30.203491]  ? evm_file_release+0x141/0x220
[   30.203962]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.204507]  __fput+0x41c/0xb70
[   30.204882]  ____fput+0x22/0x30
[   30.205351]  task_work_run+0x19b/0x2b0
[   30.205954]  ? __pfx_task_work_run+0x10/0x10
[   30.206447]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   30.207036]  ? switch_task_namespaces+0xc6/0x110
[   30.207561]  do_exit+0xb0e/0x29d0
[   30.207961]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.208534]  ? __pfx_do_exit+0x10/0x10
[   30.208989]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.209665]  ? __x64_sys_ioctl+0x1ba/0x220
[   30.210265]  make_task_dead+0x181/0x3c0
[   30.210723]  rewind_stack_and_make_dead+0x16/0x20
[   30.211221] RIP: 0033:0x7fd09043ee5d
[   30.211713] Code: Unable to access opcode bytes at 0x7fd09043ee33.
[   30.212585] RSP: 002b:00007ffd5fbfa998 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.213470] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fd09043ee5d
[   30.214261] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.215051] RBP: 00007ffd5fbfa9b0 R08: 0000000000000800 R09: 0000000000000800
[   30.215798] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd5fbfaac8
[   30.216633] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fd090792000
[   30.217581]  </TASK>
[   30.217845] irq event stamp: 0
[   30.218189] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   30.218846] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   30.219685] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   30.220647] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   30.221452] ---[ end trace 0000000000000000 ]---
[   30.222020] ------------[ cut here ]------------
[   30.222499] WARNING: CPU: 0 PID: 799 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   30.223508] Modules linked in:
[   30.223903] CPU: 0 UID: 0 PID: 799 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.225374] Tainted: [D]=DIE, [W]=WARN
[   30.225807] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.227005] RIP: 0010:iommufd_fops_release+0x392/0x420
[   30.227636] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   30.229782] RSP: 0018:ffff88801a5d7c08 EFLAGS: 00010293
[   30.230367] RAX: 0000000000000000 RBX: ffff888015338808 RCX: ffffffff83afe4ca
[   30.231167] RDX: ffff88801156ca80 RSI: ffffffff83afe642 RDI: ffff8880153388a0
[   30.232165] RBP: ffff88801a5d7cb8 R08: 0000000000000000 R09: 0000000000000000
[   30.232909] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   30.233658] R13: 0000000000000000 R14: ffff88801a5d7c50 R15: 0000000000000000
[   30.234386] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   30.235330] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.236078] CR2: 00000000200006c0 CR3: 0000000007086005 CR4: 0000000000770ef0
[   30.236839] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.237622] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.238472] PKRU: 55555554
[   30.238901] Call Trace:
[   30.239175]  <TASK>
[   30.239413]  ? show_regs+0x6d/0x80
[   30.239785]  ? __warn+0xf3/0x380
[   30.240174]  ? report_bug+0x25e/0x4b0
[   30.240707]  ? iommufd_fops_release+0x392/0x420
[   30.241320]  ? report_bug+0x2cb/0x4b0
[   30.241906]  ? iommufd_fops_release+0x392/0x420
[   30.242392]  ? iommufd_fops_release+0x392/0x420
[   30.242882]  ? handle_bug+0x2cd/0x510
[   30.243281]  ? iommufd_fops_release+0x394/0x420
[   30.243768]  ? exc_invalid_op+0x3c/0x80
[   30.244183]  ? asm_exc_invalid_op+0x1f/0x30
[   30.244632]  ? iommufd_fops_release+0x21a/0x420
[   30.245171]  ? iommufd_fops_release+0x392/0x420
[   30.245884]  ? iommufd_fops_release+0x392/0x420
[   30.246387]  ? iommufd_fops_release+0x392/0x420
[   30.246892]  ? locks_remove_file+0x3b4/0x5d0
[   30.247367]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.247896]  ? __memcg_slab_free_hook+0xc1/0x540
[   30.248406]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   30.249040]  ? evm_file_release+0x141/0x220
[   30.249527]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.250061]  __fput+0x41c/0xb70
[   30.250425]  ____fput+0x22/0x30
[   30.250785]  task_work_run+0x19b/0x2b0
[   30.251205]  ? __pfx_task_work_run+0x10/0x10
[   30.251678]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   30.252259]  ? switch_task_namespaces+0xc6/0x110
[   30.252771]  do_exit+0xb0e/0x29d0
[   30.253150]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.253716]  ? __pfx_do_exit+0x10/0x10
[   30.254139]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.254655]  ? __x64_sys_ioctl+0x1ba/0x220
[   30.255117]  make_task_dead+0x181/0x3c0
[   30.255544]  rewind_stack_and_make_dead+0x16/0x20
[   30.256055] RIP: 0033:0x7fd09043ee5d
[   30.256449] Code: Unable to access opcode bytes at 0x7fd09043ee33.
[   30.257098] RSP: 002b:00007ffd5fbfa998 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.257913] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fd09043ee5d
[   30.258665] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.259646] RBP: 00007ffd5fbfa9b0 R08: 0000000000000800 R09: 0000000000000800
[   30.260370] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd5fbfaac8
[   30.261096] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fd090792000
[   30.261850]  </TASK>
[   30.262098] irq event stamp: 0
[   30.262426] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   30.263073] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   30.263924] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   30.264775] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   30.265458] ---[ end trace 0000000000000000 ]---
[   30.278791] iommufd_mock iommufd_mock68: Adding to iommu group 68
[   30.280411] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#69] SMP KASAN NOPTI
[   30.281589] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   30.282461] CPU: 0 UID: 0 PID: 800 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.283670] Tainted: [D]=DIE, [W]=WARN
[   30.284064] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.285227] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.285850] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   30.287715] RSP: 0018:ffff8880215f7b78 EFLAGS: 00010246
[   30.288267] RAX: dffffc0000000000 RBX: ffff88801fe14600 RCX: 1ffffffff0dd8bdc
[   30.288997] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880120d87fc
[   30.289725] RBP: ffff8880215f7bc8 R08: 0000000000000000 R09: 0000000000000000
[   30.290448] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   30.292183] R13: 0000000000000001 R14: ffff8880215f7e18 R15: ffff88801111b408
[   30.292904] FS:  00007f3a40728600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   30.293711] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.294298] CR2: 000055ded6c5ad48 CR3: 00000000214b4006 CR4: 0000000000770ef0
[   30.295025] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.295742] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.296457] PKRU: 55555554
[   30.296749] Call Trace:
[   30.297015]  <TASK>
[   30.297253]  ? show_regs+0x6d/0x80
[   30.297628]  ? die_addr+0x45/0xb0
[   30.297992]  ? exc_general_protection+0x1ad/0x340
[   30.298505]  ? asm_exc_general_protection+0x2b/0x30
[   30.299028]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.299561]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   30.300113]  iommufd_device_detach+0x2a/0x2e0
[   30.300595]  iommufd_test+0x2f99/0x5cd0
[   30.301018]  ? do_raw_spin_unlock+0x15c/0x210
[   30.301501]  ? __pfx_iommufd_test+0x10/0x10
[   30.301954]  ? debug_smp_processor_id+0x20/0x30
[   30.302452]  ? rcu_is_watching+0x19/0xc0
[   30.302893]  ? lock_release+0x1ea/0x2c0
[   30.303316]  ? __might_fault+0xf1/0x1b0
[   30.303745]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   30.304319]  iommufd_fops_ioctl+0x38e/0x520
[   30.304778]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.305288]  ? trace_irq_enable+0xd1/0x110
[   30.305745]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.306280]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.306799]  __x64_sys_ioctl+0x1ba/0x220
[   30.307233]  x64_sys_call+0x122e/0x2150
[   30.307651]  do_syscall_64+0x6d/0x150
[   30.308056]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   30.308595] RIP: 0033:0x7f3a4043ee5d
[   30.308984] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   30.310865] RSP: 002b:00007ffd0bbcf618 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.311649] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f3a4043ee5d
[   30.312386] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.313123] RBP: 00007ffd0bbcf630 R08: 0000000000000800 R09: 0000000000000800
[   30.313857] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd0bbcf748
[   30.314594] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f3a40771000
[   30.315347]  </TASK>
[   30.315595] Modules linked in:
[   30.316221] ---[ end trace 0000000000000000 ]---
[   30.316735] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.317347] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   30.319199] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   30.319751] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   30.320488] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   30.321223] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   30.321968] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   30.322695] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   30.323432] FS:  00007f3a40728600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   30.324246] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.324839] CR2: 000055ded6c5ad48 CR3: 00000000214b4006 CR4: 0000000000770ef0
[   30.325600] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.326325] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.327054] PKRU: 55555554
[   30.328431] ------------[ cut here ]------------
[   30.328921] WARNING: CPU: 0 PID: 800 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   30.329888] Modules linked in:
[   30.330231] CPU: 0 UID: 0 PID: 800 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.331435] Tainted: [D]=DIE, [W]=WARN
[   30.331829] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.333205] RIP: 0010:iommufd_fops_release+0x386/0x420
[   30.333792] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   30.335643] RSP: 0018:ffff8880215f7c08 EFLAGS: 00010293
[   30.336196] RAX: 0000000000000000 RBX: ffff888010ce8008 RCX: ffffffff83afe4ca
[   30.336934] RDX: ffff8880120d8000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   30.337696] RBP: ffff8880215f7cb8 R08: 0000000000000000 R09: 0000000000000000
[   30.338442] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   30.339455] R13: 0000000000000000 R14: ffff8880215f7c50 R15: 0000000000000000
[   30.340203] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   30.341037] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.341666] CR2: 000055ded6c5ad48 CR3: 0000000007086001 CR4: 0000000000770ef0
[   30.342417] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.343163] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.343963] PKRU: 55555554
[   30.344315] Call Trace:
[   30.344714]  <TASK>
[   30.344959]  ? show_regs+0x6d/0x80
[   30.345373]  ? __warn+0xf3/0x380
[   30.345760]  ? report_bug+0x25e/0x4b0
[   30.346189]  ? iommufd_fops_release+0x386/0x420
[   30.346691]  ? report_bug+0x2cb/0x4b0
[   30.347120]  ? iommufd_fops_release+0x386/0x420
[   30.347679]  ? iommufd_fops_release+0x386/0x420
[   30.348265]  ? handle_bug+0x2cd/0x510
[   30.348818]  ? iommufd_fops_release+0x388/0x420
[   30.349316]  ? exc_invalid_op+0x3c/0x80
[   30.349775]  ? asm_exc_invalid_op+0x1f/0x30
[   30.350234]  ? iommufd_fops_release+0x21a/0x420
[   30.350742]  ? iommufd_fops_release+0x386/0x420
[   30.351228]  ? iommufd_fops_release+0x386/0x420
[   30.351725]  ? iommufd_fops_release+0x386/0x420
[   30.352204]  ? locks_remove_file+0x3b4/0x5d0
[   30.352666]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.353179]  ? __memcg_slab_free_hook+0xc1/0x540
[   30.353796]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   30.354571]  ? evm_file_release+0x141/0x220
[   30.355122]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.355660]  __fput+0x41c/0xb70
[   30.356022]  ____fput+0x22/0x30
[   30.356381]  task_work_run+0x19b/0x2b0
[   30.356805]  ? __pfx_task_work_run+0x10/0x10
[   30.357290]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   30.357892]  ? switch_task_namespaces+0xc6/0x110
[   30.358452]  do_exit+0xb0e/0x29d0
[   30.358920]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.359592]  ? __pfx_do_exit+0x10/0x10
[   30.360020]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.360546]  ? __x64_sys_ioctl+0x1ba/0x220
[   30.361004]  make_task_dead+0x181/0x3c0
[   30.361462]  rewind_stack_and_make_dead+0x16/0x20
[   30.361989] RIP: 0033:0x7f3a4043ee5d
[   30.362393] Code: Unable to access opcode bytes at 0x7f3a4043ee33.
[   30.363065] RSP: 002b:00007ffd0bbcf618 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.363876] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f3a4043ee5d
[   30.364686] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.365680] RBP: 00007ffd0bbcf630 R08: 0000000000000800 R09: 0000000000000800
[   30.366464] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd0bbcf748
[   30.367316] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f3a40771000
[   30.368264]  </TASK>
[   30.368525] irq event stamp: 0
[   30.368870] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   30.369580] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   30.370480] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   30.371387] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   30.372074] ---[ end trace 0000000000000000 ]---
[   30.372665] ------------[ cut here ]------------
[   30.373177] WARNING: CPU: 0 PID: 800 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   30.374601] Modules linked in:
[   30.374983] CPU: 0 UID: 0 PID: 800 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.376215] Tainted: [D]=DIE, [W]=WARN
[   30.376616] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.377846] RIP: 0010:iommufd_fops_release+0x392/0x420
[   30.378517] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   30.380555] RSP: 0018:ffff8880215f7c08 EFLAGS: 00010293
[   30.381101] RAX: 0000000000000000 RBX: ffff888010ce8008 RCX: ffffffff83afe4ca
[   30.381841] RDX: ffff8880120d8000 RSI: ffffffff83afe642 RDI: ffff888010ce80a0
[   30.382592] RBP: ffff8880215f7cb8 R08: 0000000000000000 R09: 0000000000000000
[   30.383349] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   30.384208] R13: 0000000000000000 R14: ffff8880215f7c50 R15: 0000000000000000
[   30.385083] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   30.385947] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.386561] CR2: 000055ded6c5ad48 CR3: 0000000007086001 CR4: 0000000000770ef0
[   30.387330] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.388092] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.389001] PKRU: 55555554
[   30.389455] Call Trace:
[   30.389749]  <TASK>
[   30.390003]  ? show_regs+0x6d/0x80
[   30.390406]  ? __warn+0xf3/0x380
[   30.390790]  ? report_bug+0x25e/0x4b0
[   30.391280]  ? iommufd_fops_release+0x392/0x420
[   30.391867]  ? report_bug+0x2cb/0x4b0
[   30.392357]  ? iommufd_fops_release+0x392/0x420
[   30.393023]  ? iommufd_fops_release+0x392/0x420
[   30.393537]  ? handle_bug+0x2cd/0x510
[   30.393946]  ? iommufd_fops_release+0x394/0x420
[   30.394440]  ? exc_invalid_op+0x3c/0x80
[   30.394869]  ? asm_exc_invalid_op+0x1f/0x30
[   30.395325]  ? iommufd_fops_release+0x21a/0x420
[   30.395816]  ? iommufd_fops_release+0x392/0x420
[   30.396307]  ? iommufd_fops_release+0x392/0x420
[   30.396799]  ? iommufd_fops_release+0x392/0x420
[   30.397290]  ? locks_remove_file+0x3b4/0x5d0
[   30.397910]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.398565]  ? __memcg_slab_free_hook+0xc1/0x540
[   30.399080]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   30.399656]  ? evm_file_release+0x141/0x220
[   30.400116]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.400639]  __fput+0x41c/0xb70
[   30.401001]  ____fput+0x22/0x30
[   30.401421]  task_work_run+0x19b/0x2b0
[   30.401881]  ? __pfx_task_work_run+0x10/0x10
[   30.402364]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   30.402946]  ? switch_task_namespaces+0xc6/0x110
[   30.403579]  do_exit+0xb0e/0x29d0
[   30.404101]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.404628]  ? __pfx_do_exit+0x10/0x10
[   30.405034]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.405557]  ? __x64_sys_ioctl+0x1ba/0x220
[   30.405996]  make_task_dead+0x181/0x3c0
[   30.406410]  rewind_stack_and_make_dead+0x16/0x20
[   30.406915] RIP: 0033:0x7f3a4043ee5d
[   30.407300] Code: Unable to access opcode bytes at 0x7f3a4043ee33.
[   30.407927] RSP: 002b:00007ffd0bbcf618 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.408990] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f3a4043ee5d
[   30.409734] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.410455] RBP: 00007ffd0bbcf630 R08: 0000000000000800 R09: 0000000000000800
[   30.411183] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffd0bbcf748
[   30.411902] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f3a40771000
[   30.412626]  </TASK>
[   30.412869] irq event stamp: 0
[   30.413239] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   30.414079] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   30.414902] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   30.415662] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   30.416430] ---[ end trace 0000000000000000 ]---
[   30.423538] iommufd_mock iommufd_mock69: Adding to iommu group 69
[   30.424668] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#70] SMP KASAN NOPTI
[   30.425918] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   30.426737] CPU: 0 UID: 0 PID: 801 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.427973] Tainted: [D]=DIE, [W]=WARN
[   30.428491] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.429688] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.430291] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   30.432141] RSP: 0018:ffff88801fd1fb78 EFLAGS: 00010246
[   30.432685] RAX: dffffc0000000000 RBX: ffff88801fe14200 RCX: 1ffffffff0dd8bdc
[   30.433407] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801375ad3c
[   30.434128] RBP: ffff88801fd1fbc8 R08: 0000000000000000 R09: 0000000000000000
[   30.434864] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   30.435589] R13: 0000000000000001 R14: ffff88801fd1fe18 R15: ffff888011119408
[   30.436326] FS:  00007f66d01f2600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   30.437156] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.437761] CR2: 00000000200006c0 CR3: 0000000016352003 CR4: 0000000000770ef0
[   30.438506] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.439254] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.439995] PKRU: 55555554
[   30.440296] Call Trace:
[   30.440571]  <TASK>
[   30.440815]  ? show_regs+0x6d/0x80
[   30.441204]  ? die_addr+0x45/0xb0
[   30.441581]  ? exc_general_protection+0x1ad/0x340
[   30.442107]  ? asm_exc_general_protection+0x2b/0x30
[   30.442628]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.443172]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   30.443712]  iommufd_device_detach+0x2a/0x2e0
[   30.444183]  iommufd_test+0x2f99/0x5cd0
[   30.444598]  ? do_raw_spin_unlock+0x15c/0x210
[   30.445072]  ? __pfx_iommufd_test+0x10/0x10
[   30.445519]  ? debug_smp_processor_id+0x20/0x30
[   30.446005]  ? rcu_is_watching+0x19/0xc0
[   30.446430]  ? lock_release+0x1ea/0x2c0
[   30.446849]  ? __might_fault+0xf1/0x1b0
[   30.447268]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   30.447836]  iommufd_fops_ioctl+0x38e/0x520
[   30.448293]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.448799]  ? trace_irq_enable+0xd1/0x110
[   30.449252]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.449786]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.450285]  __x64_sys_ioctl+0x1ba/0x220
[   30.450715]  x64_sys_call+0x122e/0x2150
[   30.451128]  do_syscall_64+0x6d/0x150
[   30.451528]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   30.452058] RIP: 0033:0x7f66cfe3ee5d
[   30.452443] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   30.454277] RSP: 002b:00007ffc59d67df8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.455052] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f66cfe3ee5d
[   30.455772] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.456494] RBP: 00007ffc59d67e10 R08: 0000000000000800 R09: 0000000000000800
[   30.457215] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc59d67f28
[   30.457937] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f66d023b000
[   30.458668]  </TASK>
[   30.458917] Modules linked in:
[   30.459456] ---[ end trace 0000000000000000 ]---
[   30.459945] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.460542] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   30.462448] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   30.463005] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   30.463727] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   30.464451] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   30.465199] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   30.465991] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   30.466743] FS:  00007f66d01f2600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   30.467578] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.468185] CR2: 00000000200006c0 CR3: 0000000016352003 CR4: 0000000000770ef0
[   30.468929] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.469721] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.470486] PKRU: 55555554
[   30.471923] ------------[ cut here ]------------
[   30.472427] WARNING: CPU: 0 PID: 801 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   30.473455] Modules linked in:
[   30.473803] CPU: 0 UID: 0 PID: 801 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.475020] Tainted: [D]=DIE, [W]=WARN
[   30.475416] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.476768] RIP: 0010:iommufd_fops_release+0x386/0x420
[   30.477315] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   30.479849] RSP: 0018:ffff88801fd1fc08 EFLAGS: 00010293
[   30.480401] RAX: 0000000000000000 RBX: ffff88801533d808 RCX: ffffffff83afe4ca
[   30.481128] RDX: ffff88801375a540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   30.481877] RBP: ffff88801fd1fcb8 R08: 0000000000000000 R09: 0000000000000000
[   30.482602] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   30.483335] R13: 0000000000000000 R14: ffff88801fd1fc50 R15: 0000000000000000
[   30.484060] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   30.484879] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.485494] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   30.486226] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.486968] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.487713] PKRU: 55555554
[   30.488013] Call Trace:
[   30.488289]  <TASK>
[   30.488534]  ? show_regs+0x6d/0x80
[   30.488920]  ? __warn+0xf3/0x380
[   30.489287]  ? report_bug+0x25e/0x4b0
[   30.489716]  ? iommufd_fops_release+0x386/0x420
[   30.490213]  ? report_bug+0x2cb/0x4b0
[   30.490623]  ? iommufd_fops_release+0x386/0x420
[   30.491123]  ? iommufd_fops_release+0x386/0x420
[   30.491618]  ? handle_bug+0x2cd/0x510
[   30.492028]  ? iommufd_fops_release+0x388/0x420
[   30.492525]  ? exc_invalid_op+0x3c/0x80
[   30.492953]  ? asm_exc_invalid_op+0x1f/0x30
[   30.493432]  ? iommufd_fops_release+0x21a/0x420
[   30.493939]  ? iommufd_fops_release+0x386/0x420
[   30.494458]  ? iommufd_fops_release+0x386/0x420
[   30.494975]  ? iommufd_fops_release+0x386/0x420
[   30.495465]  ? locks_remove_file+0x3b4/0x5d0
[   30.495934]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.496454]  ? __memcg_slab_free_hook+0xc1/0x540
[   30.496952]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   30.497527]  ? evm_file_release+0x141/0x220
[   30.497984]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.498504]  __fput+0x41c/0xb70
[   30.498866]  ____fput+0x22/0x30
[   30.499216]  task_work_run+0x19b/0x2b0
[   30.499631]  ? __pfx_task_work_run+0x10/0x10
[   30.500098]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   30.500662]  ? switch_task_namespaces+0xc6/0x110
[   30.501161]  do_exit+0xb0e/0x29d0
[   30.501563]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.502101]  ? __pfx_do_exit+0x10/0x10
[   30.502512]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.503022]  ? __x64_sys_ioctl+0x1ba/0x220
[   30.503465]  make_task_dead+0x181/0x3c0
[   30.503884]  rewind_stack_and_make_dead+0x16/0x20
[   30.504394] RIP: 0033:0x7f66cfe3ee5d
[   30.504793] Code: Unable to access opcode bytes at 0x7f66cfe3ee33.
[   30.505501] RSP: 002b:00007ffc59d67df8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.506362] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f66cfe3ee5d
[   30.507117] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.507900] RBP: 00007ffc59d67e10 R08: 0000000000000800 R09: 0000000000000800
[   30.508623] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc59d67f28
[   30.509419] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f66d023b000
[   30.510213]  </TASK>
[   30.510478] irq event stamp: 0
[   30.510834] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   30.511472] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   30.512305] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   30.513138] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   30.513826] ---[ end trace 0000000000000000 ]---
[   30.514436] ------------[ cut here ]------------
[   30.514978] WARNING: CPU: 0 PID: 801 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   30.515984] Modules linked in:
[   30.516333] CPU: 0 UID: 0 PID: 801 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.517594] Tainted: [D]=DIE, [W]=WARN
[   30.518012] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.519250] RIP: 0010:iommufd_fops_release+0x392/0x420
[   30.519831] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   30.521836] RSP: 0018:ffff88801fd1fc08 EFLAGS: 00010293
[   30.522405] RAX: 0000000000000000 RBX: ffff88801533d808 RCX: ffffffff83afe4ca
[   30.523162] RDX: ffff88801375a540 RSI: ffffffff83afe642 RDI: ffff88801533d8a0
[   30.523882] RBP: ffff88801fd1fcb8 R08: 0000000000000000 R09: 0000000000000000
[   30.524617] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   30.525358] R13: 0000000000000000 R14: ffff88801fd1fc50 R15: 0000000000000000
[   30.526080] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   30.526908] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.527500] CR2: 00000000200006c0 CR3: 0000000007086001 CR4: 0000000000770ef0
[   30.528242] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.528990] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.529777] PKRU: 55555554
[   30.530099] Call Trace:
[   30.530386]  <TASK>
[   30.530639]  ? show_regs+0x6d/0x80
[   30.531051]  ? __warn+0xf3/0x380
[   30.531425]  ? report_bug+0x25e/0x4b0
[   30.531836]  ? iommufd_fops_release+0x392/0x420
[   30.532340]  ? report_bug+0x2cb/0x4b0
[   30.532758]  ? iommufd_fops_release+0x392/0x420
[   30.533249]  ? iommufd_fops_release+0x392/0x420
[   30.533761]  ? handle_bug+0x2cd/0x510
[   30.534191]  ? iommufd_fops_release+0x394/0x420
[   30.534700]  ? exc_invalid_op+0x3c/0x80
[   30.535139]  ? asm_exc_invalid_op+0x1f/0x30
[   30.535598]  ? iommufd_fops_release+0x21a/0x420
[   30.536088]  ? iommufd_fops_release+0x392/0x420
[   30.536570]  ? iommufd_fops_release+0x392/0x420
[   30.537074]  ? iommufd_fops_release+0x392/0x420
[   30.537620]  ? locks_remove_file+0x3b4/0x5d0
[   30.538146]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.538728]  ? __memcg_slab_free_hook+0xc1/0x540
[   30.539232]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   30.539806]  ? evm_file_release+0x141/0x220
[   30.540262]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.540785]  __fput+0x41c/0xb70
[   30.541143]  ____fput+0x22/0x30
[   30.541529]  task_work_run+0x19b/0x2b0
[   30.541976]  ? __pfx_task_work_run+0x10/0x10
[   30.542465]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   30.543046]  ? switch_task_namespaces+0xc6/0x110
[   30.543539]  do_exit+0xb0e/0x29d0
[   30.543903]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.544421]  ? __pfx_do_exit+0x10/0x10
[   30.544824]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.545347]  ? __x64_sys_ioctl+0x1ba/0x220
[   30.545788]  make_task_dead+0x181/0x3c0
[   30.546201]  rewind_stack_and_make_dead+0x16/0x20
[   30.546697] RIP: 0033:0x7f66cfe3ee5d
[   30.547092] Code: Unable to access opcode bytes at 0x7f66cfe3ee33.
[   30.547721] RSP: 002b:00007ffc59d67df8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.548493] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f66cfe3ee5d
[   30.549217] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.549959] RBP: 00007ffc59d67e10 R08: 0000000000000800 R09: 0000000000000800
[   30.550731] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc59d67f28
[   30.551484] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f66d023b000
[   30.552223]  </TASK>
[   30.552478] irq event stamp: 0
[   30.552807] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   30.553468] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   30.554314] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   30.555152] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   30.555807] ---[ end trace 0000000000000000 ]---
[   30.563554] iommufd_mock iommufd_mock70: Adding to iommu group 70
[   30.564305] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#71] SMP KASAN NOPTI
[   30.565373] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   30.566144] CPU: 0 UID: 0 PID: 802 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.567415] Tainted: [D]=DIE, [W]=WARN
[   30.567809] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.568949] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.569555] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   30.571399] RSP: 0018:ffff8880215f7b78 EFLAGS: 00010246
[   30.571941] RAX: dffffc0000000000 RBX: ffff88801fe14a00 RCX: 1ffffffff0dd8bdc
[   30.572674] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801375d27c
[   30.573416] RBP: ffff8880215f7bc8 R08: 0000000000000000 R09: 0000000000000000
[   30.574161] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   30.574910] R13: 0000000000000001 R14: ffff8880215f7e18 R15: ffff888011118008
[   30.575648] FS:  00007f1a993f6600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   30.576483] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.577086] CR2: 00000000200006c0 CR3: 00000000214b4004 CR4: 0000000000770ef0
[   30.577831] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.578573] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.579315] PKRU: 55555554
[   30.579630] Call Trace:
[   30.579914]  <TASK>
[   30.580168]  ? show_regs+0x6d/0x80
[   30.580566]  ? die_addr+0x45/0xb0
[   30.580949]  ? exc_general_protection+0x1ad/0x340
[   30.581480]  ? asm_exc_general_protection+0x2b/0x30
[   30.582013]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.582566]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   30.583118]  iommufd_device_detach+0x2a/0x2e0
[   30.583593]  iommufd_test+0x2f99/0x5cd0
[   30.584008]  ? do_raw_spin_unlock+0x15c/0x210
[   30.584485]  ? __pfx_iommufd_test+0x10/0x10
[   30.584932]  ? debug_smp_processor_id+0x20/0x30
[   30.585421]  ? rcu_is_watching+0x19/0xc0
[   30.585849]  ? lock_release+0x1ea/0x2c0
[   30.586264]  ? __might_fault+0xf1/0x1b0
[   30.586686]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   30.587258]  iommufd_fops_ioctl+0x38e/0x520
[   30.587709]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.588211]  ? trace_irq_enable+0xd1/0x110
[   30.588658]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.589186]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.589680]  __x64_sys_ioctl+0x1ba/0x220
[   30.590106]  x64_sys_call+0x122e/0x2150
[   30.590522]  do_syscall_64+0x6d/0x150
[   30.590934]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   30.591464] RIP: 0033:0x7f1a9903ee5d
[   30.591850] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   30.593694] RSP: 002b:00007ffde12b7a08 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.594462] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f1a9903ee5d
[   30.595197] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.595933] RBP: 00007ffde12b7a20 R08: 0000000000000800 R09: 0000000000000800
[   30.596680] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffde12b7b38
[   30.597424] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f1a9943f000
[   30.598175]  </TASK>
[   30.598428] Modules linked in:
[   30.598880] ---[ end trace 0000000000000000 ]---
[   30.599376] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.599993] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   30.601986] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   30.602546] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   30.603296] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   30.604047] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   30.604794] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   30.605569] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   30.606320] FS:  00007f1a993f6600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   30.607165] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.607770] CR2: 00000000200006c0 CR3: 00000000214b4004 CR4: 0000000000770ef0
[   30.608514] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.609251] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.610004] PKRU: 55555554
[   30.611389] ------------[ cut here ]------------
[   30.611884] WARNING: CPU: 0 PID: 802 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   30.612853] Modules linked in:
[   30.613193] CPU: 0 UID: 0 PID: 802 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.614442] Tainted: [D]=DIE, [W]=WARN
[   30.614848] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.616139] RIP: 0010:iommufd_fops_release+0x386/0x420
[   30.616690] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   30.618645] RSP: 0018:ffff8880215f7c08 EFLAGS: 00010293
[   30.619207] RAX: 0000000000000000 RBX: ffff88801533a008 RCX: ffffffff83afe4ca
[   30.619970] RDX: ffff88801375ca80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   30.620697] RBP: ffff8880215f7cb8 R08: 0000000000000000 R09: 0000000000000000
[   30.621445] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   30.622171] R13: 0000000000000000 R14: ffff8880215f7c50 R15: 0000000000000000
[   30.622923] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   30.623764] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.624369] CR2: 00000000200006c0 CR3: 0000000007086005 CR4: 0000000000770ef0
[   30.625112] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.625896] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.626638] PKRU: 55555554
[   30.626944] Call Trace:
[   30.627220]  <TASK>
[   30.627465]  ? show_regs+0x6d/0x80
[   30.627853]  ? __warn+0xf3/0x380
[   30.628216]  ? report_bug+0x25e/0x4b0
[   30.628624]  ? iommufd_fops_release+0x386/0x420
[   30.629120]  ? report_bug+0x2cb/0x4b0
[   30.629563]  ? iommufd_fops_release+0x386/0x420
[   30.630105]  ? iommufd_fops_release+0x386/0x420
[   30.630606]  ? handle_bug+0x2cd/0x510
[   30.630984]  ? iommufd_fops_release+0x388/0x420
[   30.631475]  ? exc_invalid_op+0x3c/0x80
[   30.631902]  ? asm_exc_invalid_op+0x1f/0x30
[   30.632360]  ? iommufd_fops_release+0x21a/0x420
[   30.632851]  ? iommufd_fops_release+0x386/0x420
[   30.633363]  ? iommufd_fops_release+0x386/0x420
[   30.633840]  ? iommufd_fops_release+0x386/0x420
[   30.634327]  ? locks_remove_file+0x3b4/0x5d0
[   30.634805]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.635326]  ? __memcg_slab_free_hook+0xc1/0x540
[   30.635822]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   30.636392]  ? evm_file_release+0x141/0x220
[   30.636845]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.637382]  __fput+0x41c/0xb70
[   30.637700]  ____fput+0x22/0x30
[   30.638033]  task_work_run+0x19b/0x2b0
[   30.638447]  ? __pfx_task_work_run+0x10/0x10
[   30.638916]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   30.639481]  ? switch_task_namespaces+0xc6/0x110
[   30.639980]  do_exit+0xb0e/0x29d0
[   30.640353]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.640882]  ? __pfx_do_exit+0x10/0x10
[   30.641293]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.641811]  ? __x64_sys_ioctl+0x1ba/0x220
[   30.642245]  make_task_dead+0x181/0x3c0
[   30.642664]  rewind_stack_and_make_dead+0x16/0x20
[   30.643172] RIP: 0033:0x7f1a9903ee5d
[   30.643561] Code: Unable to access opcode bytes at 0x7f1a9903ee33.
[   30.644197] RSP: 002b:00007ffde12b7a08 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.644975] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f1a9903ee5d
[   30.645731] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.646481] RBP: 00007ffde12b7a20 R08: 0000000000000800 R09: 0000000000000800
[   30.647217] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffde12b7b38
[   30.647943] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f1a9943f000
[   30.648678]  </TASK>
[   30.648924] irq event stamp: 0
[   30.649254] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   30.649920] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   30.650786] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   30.651601] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   30.652243] ---[ end trace 0000000000000000 ]---
[   30.652819] ------------[ cut here ]------------
[   30.653296] WARNING: CPU: 0 PID: 802 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   30.654287] Modules linked in:
[   30.654676] CPU: 0 UID: 0 PID: 802 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.655887] Tainted: [D]=DIE, [W]=WARN
[   30.656279] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.657441] RIP: 0010:iommufd_fops_release+0x392/0x420
[   30.658021] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   30.659891] RSP: 0018:ffff8880215f7c08 EFLAGS: 00010293
[   30.660446] RAX: 0000000000000000 RBX: ffff88801533a008 RCX: ffffffff83afe4ca
[   30.661202] RDX: ffff88801375ca80 RSI: ffffffff83afe642 RDI: ffff88801533a0a0
[   30.661990] RBP: ffff8880215f7cb8 R08: 0000000000000000 R09: 0000000000000000
[   30.662804] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   30.663575] R13: 0000000000000000 R14: ffff8880215f7c50 R15: 0000000000000000
[   30.664321] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   30.665197] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.665869] CR2: 00000000200006c0 CR3: 0000000007086005 CR4: 0000000000770ef0
[   30.666694] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.667487] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.668281] PKRU: 55555554
[   30.668597] Call Trace:
[   30.668885]  <TASK>
[   30.669139]  ? show_regs+0x6d/0x80
[   30.669557]  ? __warn+0xf3/0x380
[   30.669957]  ? report_bug+0x25e/0x4b0
[   30.670402]  ? iommufd_fops_release+0x392/0x420
[   30.670950]  ? report_bug+0x2cb/0x4b0
[   30.671371]  ? iommufd_fops_release+0x392/0x420
[   30.671877]  ? iommufd_fops_release+0x392/0x420
[   30.672378]  ? handle_bug+0x2cd/0x510
[   30.672788]  ? iommufd_fops_release+0x394/0x420
[   30.673304]  ? exc_invalid_op+0x3c/0x80
[   30.673794]  ? asm_exc_invalid_op+0x1f/0x30
[   30.674285]  ? iommufd_fops_release+0x21a/0x420
[   30.674814]  ? iommufd_fops_release+0x392/0x420
[   30.675310]  ? iommufd_fops_release+0x392/0x420
[   30.675815]  ? iommufd_fops_release+0x392/0x420
[   30.676384]  ? locks_remove_file+0x3b4/0x5d0
[   30.676854]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.677408]  ? __memcg_slab_free_hook+0xc1/0x540
[   30.677942]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   30.678549]  ? evm_file_release+0x141/0x220
[   30.679020]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.679548]  __fput+0x41c/0xb70
[   30.679910]  ____fput+0x22/0x30
[   30.680264]  task_work_run+0x19b/0x2b0
[   30.680683]  ? __pfx_task_work_run+0x10/0x10
[   30.681153]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   30.681749]  ? switch_task_namespaces+0xc6/0x110
[   30.682279]  do_exit+0xb0e/0x29d0
[   30.682693]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.683192]  ? __pfx_do_exit+0x10/0x10
[   30.683605]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.684115]  ? __x64_sys_ioctl+0x1ba/0x220
[   30.684565]  make_task_dead+0x181/0x3c0
[   30.684986]  rewind_stack_and_make_dead+0x16/0x20
[   30.685517] RIP: 0033:0x7f1a9903ee5d
[   30.685930] Code: Unable to access opcode bytes at 0x7f1a9903ee33.
[   30.686614] RSP: 002b:00007ffde12b7a08 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.687411] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f1a9903ee5d
[   30.688149] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.688889] RBP: 00007ffde12b7a20 R08: 0000000000000800 R09: 0000000000000800
[   30.689675] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffde12b7b38
[   30.690469] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f1a9943f000
[   30.691230]  </TASK>
[   30.691474] irq event stamp: 0
[   30.691829] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   30.692508] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   30.693373] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   30.694282] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   30.694965] ---[ end trace 0000000000000000 ]---
[   30.706806] iommufd_mock iommufd_mock71: Adding to iommu group 71
[   30.709101] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#72] SMP KASAN NOPTI
[   30.710574] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   30.711459] CPU: 1 UID: 0 PID: 803 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.712800] Tainted: [D]=DIE, [W]=WARN
[   30.713243] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.714505] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.715194] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   30.717379] RSP: 0018:ffff88801cac7b78 EFLAGS: 00010246
[   30.717960] RAX: dffffc0000000000 RBX: ffff888012288800 RCX: 1ffffffff0dd8bdd
[   30.718815] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880115687fc
[   30.719603] RBP: ffff88801cac7bc8 R08: 0000000000000000 R09: 0000000000000000
[   30.720422] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   30.721209] R13: 0000000000000001 R14: ffff88801cac7e18 R15: ffff88801209c408
[   30.722036] FS:  00007fbed684d600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   30.722920] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.723606] CR2: 00000000200006c0 CR3: 00000000217d4003 CR4: 0000000000770ef0
[   30.724396] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.725218] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.726084] PKRU: 55555554
[   30.726384] Call Trace:
[   30.726658]  <TASK>
[   30.726906]  ? show_regs+0x6d/0x80
[   30.727337]  ? die_addr+0x45/0xb0
[   30.727799]  ? exc_general_protection+0x1ad/0x340
[   30.728324]  ? asm_exc_general_protection+0x2b/0x30
[   30.728884]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.729515]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   30.730070]  iommufd_device_detach+0x2a/0x2e0
[   30.730620]  iommufd_test+0x2f99/0x5cd0
[   30.731207]  ? do_raw_spin_unlock+0x15c/0x210
[   30.731712]  ? __pfx_iommufd_test+0x10/0x10
[   30.732222]  ? debug_smp_processor_id+0x20/0x30
[   30.732828]  ? rcu_is_watching+0x19/0xc0
[   30.733267]  ? lock_release+0x1ea/0x2c0
[   30.734062]  ? __might_fault+0xf1/0x1b0
[   30.735555]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   30.737623]  iommufd_fops_ioctl+0x38e/0x520
[   30.739504]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.741787]  ? trace_irq_enable+0xd1/0x110
[   30.743481]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.745372]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.747206]  __x64_sys_ioctl+0x1ba/0x220
[   30.748748]  x64_sys_call+0x122e/0x2150
[   30.750254]  do_syscall_64+0x6d/0x150
[   30.751095]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   30.751728] RIP: 0033:0x7fbed663ee5d
[   30.752122] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   30.754169] RSP: 002b:00007fff5447fe78 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.755184] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fbed663ee5d
[   30.755937] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.756688] RBP: 00007fff5447fe90 R08: 0000000000000800 R09: 0000000000000800
[   30.757442] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff5447ffa8
[   30.758198] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fbed6896000
[   30.759069]  </TASK>
[   30.759445] Modules linked in:
[   30.759848] ---[ end trace 0000000000000000 ]---
[   30.760343] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.760953] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   30.763091] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   30.763645] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   30.764382] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   30.765117] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   30.765870] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   30.766675] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   30.767582] FS:  00007fbed684d600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   30.768410] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.769013] CR2: 00000000200006c0 CR3: 00000000217d4003 CR4: 0000000000770ef0
[   30.769772] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.770539] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.771479] PKRU: 55555554
[   30.779363] ------------[ cut here ]------------
[   30.780057] WARNING: CPU: 1 PID: 803 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   30.781049] Modules linked in:
[   30.781486] CPU: 1 UID: 0 PID: 803 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.782721] Tainted: [D]=DIE, [W]=WARN
[   30.783203] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.784486] RIP: 0010:iommufd_fops_release+0x386/0x420
[   30.785038] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   30.787038] RSP: 0018:ffff88801cac7c08 EFLAGS: 00010293
[   30.787632] RAX: 0000000000000000 RBX: ffff888010cee808 RCX: ffffffff83afe4ca
[   30.788525] RDX: ffff888011568000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   30.789266] RBP: ffff88801cac7cb8 R08: 0000000000000000 R09: 0000000000000000
[   30.790076] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   30.790822] R13: 0000000000000000 R14: ffff88801cac7c50 R15: 0000000000000000
[   30.791600] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   30.792605] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.793210] CR2: 00007f25f7d5d030 CR3: 0000000007086006 CR4: 0000000000770ef0
[   30.794024] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.794769] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.795532] PKRU: 55555554
[   30.795920] Call Trace:
[   30.796194]  <TASK>
[   30.796436]  ? show_regs+0x6d/0x80
[   30.796818]  ? __warn+0xf3/0x380
[   30.797229]  ? report_bug+0x25e/0x4b0
[   30.797789]  ? iommufd_fops_release+0x386/0x420
[   30.798286]  ? report_bug+0x2cb/0x4b0
[   30.798714]  ? iommufd_fops_release+0x386/0x420
[   30.799299]  ? iommufd_fops_release+0x386/0x420
[   30.799801]  ? handle_bug+0x2cd/0x510
[   30.800240]  ? iommufd_fops_release+0x388/0x420
[   30.800859]  ? exc_invalid_op+0x3c/0x80
[   30.801293]  ? asm_exc_invalid_op+0x1f/0x30
[   30.801849]  ? iommufd_fops_release+0x21a/0x420
[   30.802457]  ? iommufd_fops_release+0x386/0x420
[   30.802980]  ? iommufd_fops_release+0x386/0x420
[   30.803597]  ? iommufd_fops_release+0x386/0x420
[   30.804100]  ? locks_remove_file+0x3b4/0x5d0
[   30.804608]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.805250]  ? __memcg_slab_free_hook+0xc1/0x540
[   30.805817]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   30.806473]  ? evm_file_release+0x141/0x220
[   30.807036]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.807571]  __fput+0x41c/0xb70
[   30.807978]  ____fput+0x22/0x30
[   30.808426]  task_work_run+0x19b/0x2b0
[   30.808854]  ? __pfx_task_work_run+0x10/0x10
[   30.809379]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   30.810103]  ? switch_task_namespaces+0xc6/0x110
[   30.810619]  do_exit+0xb0e/0x29d0
[   30.811069]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.811731]  ? __pfx_do_exit+0x10/0x10
[   30.812153]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.812733]  ? __x64_sys_ioctl+0x1ba/0x220
[   30.813296]  make_task_dead+0x181/0x3c0
[   30.813788]  rewind_stack_and_make_dead+0x16/0x20
[   30.814368] RIP: 0033:0x7fbed663ee5d
[   30.814889] Code: Unable to access opcode bytes at 0x7fbed663ee33.
[   30.815545] RSP: 002b:00007fff5447fe78 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.816504] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fbed663ee5d
[   30.817261] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.818081] RBP: 00007fff5447fe90 R08: 0000000000000800 R09: 0000000000000800
[   30.818847] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff5447ffa8
[   30.819604] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fbed6896000
[   30.820367]  </TASK>
[   30.820624] irq event stamp: 0
[   30.820968] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   30.821720] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   30.822601] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   30.823477] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   30.824154] ---[ end trace 0000000000000000 ]---
[   30.824753] ------------[ cut here ]------------
[   30.825280] WARNING: CPU: 1 PID: 803 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   30.826553] Modules linked in:
[   30.826986] CPU: 1 UID: 0 PID: 803 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.828268] Tainted: [D]=DIE, [W]=WARN
[   30.828686] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.830010] RIP: 0010:iommufd_fops_release+0x392/0x420
[   30.830611] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   30.832599] RSP: 0018:ffff88801cac7c08 EFLAGS: 00010293
[   30.833191] RAX: 0000000000000000 RBX: ffff888010cee808 RCX: ffffffff83afe4ca
[   30.834084] RDX: ffff888011568000 RSI: ffffffff83afe642 RDI: ffff888010cee8a0
[   30.834916] RBP: ffff88801cac7cb8 R08: 0000000000000000 R09: 0000000000000000
[   30.835702] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   30.836477] R13: 0000000000000000 R14: ffff88801cac7c50 R15: 0000000000000000
[   30.837264] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   30.838214] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.838894] CR2: 00007f25f7d5d030 CR3: 0000000007086006 CR4: 0000000000770ef0
[   30.839670] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.840427] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.841189] PKRU: 55555554
[   30.841567] Call Trace:
[   30.841891]  <TASK>
[   30.842140]  ? show_regs+0x6d/0x80
[   30.842532]  ? __warn+0xf3/0x380
[   30.842910]  ? report_bug+0x25e/0x4b0
[   30.843324]  ? iommufd_fops_release+0x392/0x420
[   30.843835]  ? report_bug+0x2cb/0x4b0
[   30.844258]  ? iommufd_fops_release+0x392/0x420
[   30.844771]  ? iommufd_fops_release+0x392/0x420
[   30.845291]  ? handle_bug+0x2cd/0x510
[   30.845805]  ? iommufd_fops_release+0x394/0x420
[   30.846372]  ? exc_invalid_op+0x3c/0x80
[   30.846814]  ? asm_exc_invalid_op+0x1f/0x30
[   30.847291]  ? iommufd_fops_release+0x21a/0x420
[   30.847796]  ? iommufd_fops_release+0x392/0x420
[   30.848315]  ? iommufd_fops_release+0x392/0x420
[   30.848827]  ? iommufd_fops_release+0x392/0x420
[   30.849400]  ? locks_remove_file+0x3b4/0x5d0
[   30.849940]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.850488]  ? __memcg_slab_free_hook+0xc1/0x540
[   30.851013]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   30.851613]  ? evm_file_release+0x141/0x220
[   30.852085]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.852627]  __fput+0x41c/0xb70
[   30.852993]  ____fput+0x22/0x30
[   30.853433]  task_work_run+0x19b/0x2b0
[   30.853868]  ? __pfx_task_work_run+0x10/0x10
[   30.854352]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   30.854954]  ? switch_task_namespaces+0xc6/0x110
[   30.855478]  do_exit+0xb0e/0x29d0
[   30.855864]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.856421]  ? __pfx_do_exit+0x10/0x10
[   30.856848]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.857440]  ? __x64_sys_ioctl+0x1ba/0x220
[   30.857991]  make_task_dead+0x181/0x3c0
[   30.858426]  rewind_stack_and_make_dead+0x16/0x20
[   30.858947] RIP: 0033:0x7fbed663ee5d
[   30.859352] Code: Unable to access opcode bytes at 0x7fbed663ee33.
[   30.860007] RSP: 002b:00007fff5447fe78 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.860813] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fbed663ee5d
[   30.861631] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.862392] RBP: 00007fff5447fe90 R08: 0000000000000800 R09: 0000000000000800
[   30.863151] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff5447ffa8
[   30.863907] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007fbed6896000
[   30.864672]  </TASK>
[   30.864929] irq event stamp: 0
[   30.865273] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   30.865997] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   30.866884] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   30.867758] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   30.868429] ---[ end trace 0000000000000000 ]---
[   30.874612] iommufd_mock iommufd_mock72: Adding to iommu group 72
[   30.875727] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#73] SMP KASAN NOPTI
[   30.877091] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   30.877919] CPU: 1 UID: 0 PID: 804 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.879161] Tainted: [D]=DIE, [W]=WARN
[   30.879562] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.880722] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.881335] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   30.883212] RSP: 0018:ffff888026c2fb78 EFLAGS: 00010246
[   30.883766] RAX: dffffc0000000000 RBX: ffff888012288600 RCX: 1ffffffff0dd8bdd
[   30.884503] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880137a527c
[   30.885240] RBP: ffff888026c2fbc8 R08: 0000000000000000 R09: 0000000000000000
[   30.885978] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   30.886721] R13: 0000000000000001 R14: ffff888026c2fe18 R15: ffff888012add008
[   30.887461] FS:  00007f1d149f0600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   30.888292] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.888895] CR2: 00000000200006c0 CR3: 00000000217d4003 CR4: 0000000000770ef0
[   30.889657] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.890413] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.891174] PKRU: 55555554
[   30.891481] Call Trace:
[   30.891762]  <TASK>
[   30.892011]  ? show_regs+0x6d/0x80
[   30.892402]  ? die_addr+0x45/0xb0
[   30.892785]  ? exc_general_protection+0x1ad/0x340
[   30.893321]  ? asm_exc_general_protection+0x2b/0x30
[   30.893865]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.894424]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   30.894992]  iommufd_device_detach+0x2a/0x2e0
[   30.895486]  iommufd_test+0x2f99/0x5cd0
[   30.895922]  ? do_raw_spin_unlock+0x15c/0x210
[   30.896421]  ? __pfx_iommufd_test+0x10/0x10
[   30.896886]  ? debug_smp_processor_id+0x20/0x30
[   30.897396]  ? rcu_is_watching+0x19/0xc0
[   30.897842]  ? lock_release+0x1ea/0x2c0
[   30.898276]  ? __might_fault+0xf1/0x1b0
[   30.898719]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   30.899312]  iommufd_fops_ioctl+0x38e/0x520
[   30.899780]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.900306]  ? trace_irq_enable+0xd1/0x110
[   30.900773]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.901324]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.901843]  __x64_sys_ioctl+0x1ba/0x220
[   30.902288]  x64_sys_call+0x122e/0x2150
[   30.902717]  do_syscall_64+0x6d/0x150
[   30.903133]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   30.903671] RIP: 0033:0x7f1d1463ee5d
[   30.904063] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   30.905931] RSP: 002b:00007ffcfc4b3bc8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.906723] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f1d1463ee5d
[   30.907459] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.908196] RBP: 00007ffcfc4b3be0 R08: 0000000000000800 R09: 0000000000000800
[   30.908934] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcfc4b3cf8
[   30.909671] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f1d14a39000
[   30.910421]  </TASK>
[   30.910670] Modules linked in:
[   30.911068] ---[ end trace 0000000000000000 ]---
[   30.911563] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   30.912169] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   30.914095] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   30.914654] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   30.915396] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   30.916150] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   30.916901] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   30.917685] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   30.918441] FS:  00007f1d149f0600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   30.919295] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.919909] CR2: 00000000200006c0 CR3: 00000000217d4003 CR4: 0000000000770ef0
[   30.920670] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.921450] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.922207] PKRU: 55555554
[   30.923211] ------------[ cut here ]------------
[   30.923724] WARNING: CPU: 1 PID: 804 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   30.924734] Modules linked in:
[   30.925087] CPU: 1 UID: 0 PID: 804 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.926370] Tainted: [D]=DIE, [W]=WARN
[   30.926789] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.927977] RIP: 0010:iommufd_fops_release+0x386/0x420
[   30.928539] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   30.930487] RSP: 0018:ffff888026c2fc08 EFLAGS: 00010293
[   30.931061] RAX: 0000000000000000 RBX: ffff888010cea808 RCX: ffffffff83afe4ca
[   30.931815] RDX: ffff8880137a4a80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   30.932575] RBP: ffff888026c2fcb8 R08: 0000000000000000 R09: 0000000000000000
[   30.933364] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   30.934120] R13: 0000000000000000 R14: ffff888026c2fc50 R15: 0000000000000000
[   30.934881] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   30.935730] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.936349] CR2: 00000000200006c0 CR3: 0000000007086006 CR4: 0000000000770ef0
[   30.937111] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.937892] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.938649] PKRU: 55555554
[   30.938961] Call Trace:
[   30.939240]  <TASK>
[   30.939490]  ? show_regs+0x6d/0x80
[   30.939878]  ? __warn+0xf3/0x380
[   30.940250]  ? report_bug+0x25e/0x4b0
[   30.940664]  ? iommufd_fops_release+0x386/0x420
[   30.941164]  ? report_bug+0x2cb/0x4b0
[   30.941603]  ? iommufd_fops_release+0x386/0x420
[   30.942109]  ? iommufd_fops_release+0x386/0x420
[   30.942610]  ? handle_bug+0x2cd/0x510
[   30.943034]  ? iommufd_fops_release+0x388/0x420
[   30.943539]  ? exc_invalid_op+0x3c/0x80
[   30.943972]  ? asm_exc_invalid_op+0x1f/0x30
[   30.944436]  ? iommufd_fops_release+0x21a/0x420
[   30.944936]  ? iommufd_fops_release+0x386/0x420
[   30.945463]  ? iommufd_fops_release+0x386/0x420
[   30.945967]  ? iommufd_fops_release+0x386/0x420
[   30.946470]  ? locks_remove_file+0x3b4/0x5d0
[   30.946960]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.947499]  ? __memcg_slab_free_hook+0xc1/0x540
[   30.948009]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   30.948592]  ? evm_file_release+0x141/0x220
[   30.949056]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.949615]  __fput+0x41c/0xb70
[   30.949983]  ____fput+0x22/0x30
[   30.950341]  task_work_run+0x19b/0x2b0
[   30.950770]  ? __pfx_task_work_run+0x10/0x10
[   30.951247]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   30.951832]  ? switch_task_namespaces+0xc6/0x110
[   30.952347]  do_exit+0xb0e/0x29d0
[   30.952728]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.953275]  ? __pfx_do_exit+0x10/0x10
[   30.953723]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.954248]  ? __x64_sys_ioctl+0x1ba/0x220
[   30.954712]  make_task_dead+0x181/0x3c0
[   30.955144]  rewind_stack_and_make_dead+0x16/0x20
[   30.955660] RIP: 0033:0x7f1d1463ee5d
[   30.956058] Code: Unable to access opcode bytes at 0x7f1d1463ee33.
[   30.956710] RSP: 002b:00007ffcfc4b3bc8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   30.957540] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f1d1463ee5d
[   30.958300] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   30.959060] RBP: 00007ffcfc4b3be0 R08: 0000000000000800 R09: 0000000000000800
[   30.959815] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcfc4b3cf8
[   30.960566] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f1d14a39000
[   30.961356]  </TASK>
[   30.961617] irq event stamp: 0
[   30.961963] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   30.962637] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   30.963512] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   30.964381] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   30.965047] ---[ end trace 0000000000000000 ]---
[   30.965654] ------------[ cut here ]------------
[   30.966154] WARNING: CPU: 1 PID: 804 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   30.967155] Modules linked in:
[   30.967505] CPU: 1 UID: 0 PID: 804 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   30.968751] Tainted: [D]=DIE, [W]=WARN
[   30.969159] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   30.970370] RIP: 0010:iommufd_fops_release+0x392/0x420
[   30.970942] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   30.972861] RSP: 0018:ffff888026c2fc08 EFLAGS: 00010293
[   30.973450] RAX: 0000000000000000 RBX: ffff888010cea808 RCX: ffffffff83afe4ca
[   30.974206] RDX: ffff8880137a4a80 RSI: ffffffff83afe642 RDI: ffff888010cea8a0
[   30.974964] RBP: ffff888026c2fcb8 R08: 0000000000000000 R09: 0000000000000000
[   30.975720] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   30.976475] R13: 0000000000000000 R14: ffff888026c2fc50 R15: 0000000000000000
[   30.977230] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   30.978104] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   30.978729] CR2: 00000000200006c0 CR3: 0000000007086006 CR4: 0000000000770ef0
[   30.979486] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   30.980240] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   30.980995] PKRU: 55555554
[   30.981300] Call Trace:
[   30.981603]  <TASK>
[   30.981851]  ? show_regs+0x6d/0x80
[   30.982241]  ? __warn+0xf3/0x380
[   30.982613]  ? report_bug+0x25e/0x4b0
[   30.983034]  ? iommufd_fops_release+0x392/0x420
[   30.983537]  ? report_bug+0x2cb/0x4b0
[   30.983950]  ? iommufd_fops_release+0x392/0x420
[   30.984450]  ? iommufd_fops_release+0x392/0x420
[   30.984951]  ? handle_bug+0x2cd/0x510
[   30.985388]  ? iommufd_fops_release+0x394/0x420
[   30.985893]  ? exc_invalid_op+0x3c/0x80
[   30.986325]  ? asm_exc_invalid_op+0x1f/0x30
[   30.986790]  ? iommufd_fops_release+0x21a/0x420
[   30.987290]  ? iommufd_fops_release+0x392/0x420
[   30.987791]  ? iommufd_fops_release+0x392/0x420
[   30.988292]  ? iommufd_fops_release+0x392/0x420
[   30.988790]  ? locks_remove_file+0x3b4/0x5d0
[   30.989277]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.989855]  ? __memcg_slab_free_hook+0xc1/0x540
[   30.990467]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   30.991066]  ? evm_file_release+0x141/0x220
[   30.991536]  ? __pfx_iommufd_fops_release+0x10/0x10
[   30.992073]  __fput+0x41c/0xb70
[   30.992440]  ____fput+0x22/0x30
[   30.992801]  task_work_run+0x19b/0x2b0
[   30.993231]  ? __pfx_task_work_run+0x10/0x10
[   30.993745]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   30.994407]  ? switch_task_namespaces+0xc6/0x110
[   30.994933]  do_exit+0xb0e/0x29d0
[   30.995316]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   30.995865]  ? __pfx_do_exit+0x10/0x10
[   30.996294]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   30.996825]  ? __x64_sys_ioctl+0x1ba/0x220
[   30.997291]  make_task_dead+0x181/0x3c0
[   30.997768]  rewind_stack_and_make_dead+0x16/0x20
[   30.998340] RIP: 0033:0x7f1d1463ee5d
[   30.998747] Code: Unable to access opcode bytes at 0x7f1d1463ee33.
[   30.999403] RSP: 002b:00007ffcfc4b3bc8 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   31.000209] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f1d1463ee5d
[   31.000965] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   31.001749] RBP: 00007ffcfc4b3be0 R08: 0000000000000800 R09: 0000000000000800
[   31.002511] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffcfc4b3cf8
[   31.003269] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f1d14a39000
[   31.004038]  </TASK>
[   31.004292] irq event stamp: 0
[   31.004635] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   31.005305] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   31.006206] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   31.007083] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   31.007753] ---[ end trace 0000000000000000 ]---
[   31.014449] iommufd_mock iommufd_mock73: Adding to iommu group 73
[   31.015599] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#74] SMP KASAN NOPTI
[   31.016858] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   31.017687] CPU: 1 UID: 0 PID: 805 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   31.018924] Tainted: [D]=DIE, [W]=WARN
[   31.019325] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   31.020486] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   31.021098] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   31.022989] RSP: 0018:ffff88801117fb78 EFLAGS: 00010246
[   31.023543] RAX: dffffc0000000000 RBX: ffff888012288200 RCX: 1ffffffff0dd8bdd
[   31.024305] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880120b87fc
[   31.025061] RBP: ffff88801117fbc8 R08: 0000000000000000 R09: 0000000000000000
[   31.025816] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   31.026572] R13: 0000000000000001 R14: ffff88801117fe18 R15: ffff888012adc808
[   31.027333] FS:  00007f3f99f85600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   31.028182] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   31.028799] CR2: 00000000200006c0 CR3: 00000000217d4006 CR4: 0000000000770ef0
[   31.029556] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   31.030314] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   31.031071] PKRU: 55555554
[   31.031378] Call Trace:
[   31.031658]  <TASK>
[   31.031906]  ? show_regs+0x6d/0x80
[   31.032298]  ? die_addr+0x45/0xb0
[   31.032682]  ? exc_general_protection+0x1ad/0x340
[   31.033216]  ? asm_exc_general_protection+0x2b/0x30
[   31.033762]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   31.034320]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   31.034886]  iommufd_device_detach+0x2a/0x2e0
[   31.035379]  iommufd_test+0x2f99/0x5cd0
[   31.035811]  ? do_raw_spin_unlock+0x15c/0x210
[   31.036305]  ? __pfx_iommufd_test+0x10/0x10
[   31.036769]  ? debug_smp_processor_id+0x20/0x30
[   31.037276]  ? rcu_is_watching+0x19/0xc0
[   31.037721]  ? lock_release+0x1ea/0x2c0
[   31.038154]  ? __might_fault+0xf1/0x1b0
[   31.038594]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   31.039191]  iommufd_fops_ioctl+0x38e/0x520
[   31.039662]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   31.040187]  ? trace_irq_enable+0xd1/0x110
[   31.040654]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   31.041202]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   31.041722]  __x64_sys_ioctl+0x1ba/0x220
[   31.042164]  x64_sys_call+0x122e/0x2150
[   31.042594]  do_syscall_64+0x6d/0x150
[   31.043012]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   31.043567] RIP: 0033:0x7f3f99c3ee5d
[   31.043969] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   31.045896] RSP: 002b:00007fff60096458 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   31.046697] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f3f99c3ee5d
[   31.047460] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   31.048216] RBP: 00007fff60096470 R08: 0000000000000800 R09: 0000000000000800
[   31.048974] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff60096588
[   31.049732] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f3f99fce000
[   31.050501]  </TASK>
[   31.050760] Modules linked in:
[   31.051392] ---[ end trace 0000000000000000 ]---
[   31.051904] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   31.052532] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   31.054477] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   31.055056] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   31.055813] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   31.056571] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   31.057351] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   31.058108] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   31.058869] FS:  00007f3f99f85600(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   31.059716] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   31.060335] CR2: 00000000200006c0 CR3: 00000000217d4006 CR4: 0000000000770ef0
[   31.061091] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   31.061869] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   31.062625] PKRU: 55555554
[   31.063606] ------------[ cut here ]------------
[   31.064117] WARNING: CPU: 1 PID: 805 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   31.065127] Modules linked in:
[   31.065537] CPU: 1 UID: 0 PID: 805 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   31.066849] Tainted: [D]=DIE, [W]=WARN
[   31.067263] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   31.068452] RIP: 0010:iommufd_fops_release+0x386/0x420
[   31.069017] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   31.070978] RSP: 0018:ffff88801117fc08 EFLAGS: 00010293
[   31.071546] RAX: 0000000000000000 RBX: ffff888010ce9008 RCX: ffffffff83afe4ca
[   31.072304] RDX: ffff8880120b8000 RSI: ffffffff83afe636 RDI: 0000000000000005
[   31.073243] RBP: ffff88801117fcb8 R08: 0000000000000000 R09: 0000000000000000
[   31.074029] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   31.074896] R13: 0000000000000000 R14: ffff88801117fc50 R15: 0000000000000000
[   31.075797] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   31.076647] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   31.077405] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   31.078149] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   31.078945] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   31.079772] PKRU: 55555554
[   31.080072] Call Trace:
[   31.080392]  <TASK>
[   31.080715]  ? show_regs+0x6d/0x80
[   31.081098]  ? __warn+0xf3/0x380
[   31.081487]  ? report_bug+0x25e/0x4b0
[   31.081896]  ? iommufd_fops_release+0x386/0x420
[   31.082429]  ? report_bug+0x2cb/0x4b0
[   31.082935]  ? iommufd_fops_release+0x386/0x420
[   31.083427]  ? iommufd_fops_release+0x386/0x420
[   31.083964]  ? handle_bug+0x2cd/0x510
[   31.084473]  ? iommufd_fops_release+0x388/0x420
[   31.084967]  ? exc_invalid_op+0x3c/0x80
[   31.085441]  ? asm_exc_invalid_op+0x1f/0x30
[   31.086006]  ? iommufd_fops_release+0x21a/0x420
[   31.086496]  ? iommufd_fops_release+0x386/0x420
[   31.086996]  ? iommufd_fops_release+0x386/0x420
[   31.087557]  ? iommufd_fops_release+0x386/0x420
[   31.088165]  ? locks_remove_file+0x3b4/0x5d0
[   31.088649]  ? __pfx_iommufd_fops_release+0x10/0x10
[   31.089232]  ? __memcg_slab_free_hook+0xc1/0x540
[   31.089874]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   31.090464]  ? evm_file_release+0x141/0x220
[   31.090970]  ? __pfx_iommufd_fops_release+0x10/0x10
[   31.091611]  __fput+0x41c/0xb70
[   31.091978]  ____fput+0x22/0x30
[   31.092335]  task_work_run+0x19b/0x2b0
[   31.092824]  ? __pfx_task_work_run+0x10/0x10
[   31.093431]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   31.094018]  ? switch_task_namespaces+0xc6/0x110
[   31.094534]  do_exit+0xb0e/0x29d0
[   31.095003]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   31.095698]  ? __pfx_do_exit+0x10/0x10
[   31.096174]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   31.096693]  ? __x64_sys_ioctl+0x1ba/0x220
[   31.097150]  make_task_dead+0x181/0x3c0
[   31.097607]  rewind_stack_and_make_dead+0x16/0x20
[   31.098126] RIP: 0033:0x7f3f99c3ee5d
[   31.098524] Code: Unable to access opcode bytes at 0x7f3f99c3ee33.
[   31.099257] RSP: 002b:00007fff60096458 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   31.100224] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f3f99c3ee5d
[   31.100979] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   31.101751] RBP: 00007fff60096470 R08: 0000000000000800 R09: 0000000000000800
[   31.102509] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff60096588
[   31.103268] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f3f99fce000
[   31.104081]  </TASK>
[   31.104437] irq event stamp: 0
[   31.104781] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   31.105479] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   31.106494] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   31.107373] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   31.108185] ---[ end trace 0000000000000000 ]---
[   31.108772] ------------[ cut here ]------------
[   31.109302] WARNING: CPU: 1 PID: 805 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   31.110451] Modules linked in:
[   31.110813] CPU: 1 UID: 0 PID: 805 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   31.112224] Tainted: [D]=DIE, [W]=WARN
[   31.112672] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   31.114033] RIP: 0010:iommufd_fops_release+0x392/0x420
[   31.114699] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   31.116779] RSP: 0018:ffff88801117fc08 EFLAGS: 00010293
[   31.117365] RAX: 0000000000000000 RBX: ffff888010ce9008 RCX: ffffffff83afe4ca
[   31.118271] RDX: ffff8880120b8000 RSI: ffffffff83afe642 RDI: ffff888010ce90a0
[   31.119030] RBP: ffff88801117fcb8 R08: 0000000000000000 R09: 0000000000000000
[   31.119838] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   31.120688] R13: 0000000000000000 R14: ffff88801117fc50 R15: 0000000000000000
[   31.121514] FS:  0000000000000000(0000) GS:ffff8880e3684000(0000) knlGS:0000000000000000
[   31.122467] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   31.123148] CR2: 00000000200006c0 CR3: 0000000007086002 CR4: 0000000000770ef0
[   31.123999] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   31.124898] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   31.125681] PKRU: 55555554
[   31.125987] Call Trace:
[   31.126307]  <TASK>
[   31.126565]  ? show_regs+0x6d/0x80
[   31.127157]  ? __warn+0xf3/0x380
[   31.127540]  ? report_bug+0x25e/0x4b0
[   31.127954]  ? iommufd_fops_release+0x392/0x420
[   31.128458]  ? report_bug+0x2cb/0x4b0
[   31.128868]  ? iommufd_fops_release+0x392/0x420
[   31.129488]  ? iommufd_fops_release+0x392/0x420
[   31.130109]  ? handle_bug+0x2cd/0x510
[   31.130523]  ? iommufd_fops_release+0x394/0x420
[   31.131037]  ? exc_invalid_op+0x3c/0x80
[   31.131470]  ? asm_exc_invalid_op+0x1f/0x30
[   31.131934]  ? iommufd_fops_release+0x21a/0x420
[   31.132435]  ? iommufd_fops_release+0x392/0x420
[   31.132935]  ? iommufd_fops_release+0x392/0x420
[   31.133459]  ? iommufd_fops_release+0x392/0x420
[   31.133963]  ? locks_remove_file+0x3b4/0x5d0
[   31.134445]  ? __pfx_iommufd_fops_release+0x10/0x10
[   31.135032]  ? __memcg_slab_free_hook+0xc1/0x540
[   31.135641]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   31.136227]  ? evm_file_release+0x141/0x220
[   31.136690]  ? __pfx_iommufd_fops_release+0x10/0x10
[   31.137228]  __fput+0x41c/0xb70
[   31.137629]  ____fput+0x22/0x30
[   31.137995]  task_work_run+0x19b/0x2b0
[   31.138421]  ? __pfx_task_work_run+0x10/0x10
[   31.138903]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   31.139486]  ? switch_task_namespaces+0xc6/0x110
[   31.140004]  do_exit+0xb0e/0x29d0
[   31.140387]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   31.141046]  ? __pfx_do_exit+0x10/0x10
[   31.141546]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   31.142069]  ? __x64_sys_ioctl+0x1ba/0x220
[   31.142525]  make_task_dead+0x181/0x3c0
[   31.142936]  rewind_stack_and_make_dead+0x16/0x20
[   31.143386] RIP: 0033:0x7f3f99c3ee5d
[   31.143739] Code: Unable to access opcode bytes at 0x7f3f99c3ee33.
[   31.144524] RSP: 002b:00007fff60096458 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   31.145389] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f3f99c3ee5d
[   31.146146] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   31.146904] RBP: 00007fff60096470 R08: 0000000000000800 R09: 0000000000000800
[   31.147657] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff60096588
[   31.148532] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f3f99fce000
[   31.149384]  </TASK>
[   31.149645] irq event stamp: 0
[   31.149987] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   31.150653] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   31.151529] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   31.152525] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   31.153193] ---[ end trace 0000000000000000 ]---
[   31.160711] iommufd_mock iommufd_mock74: Adding to iommu group 74
[   31.163663] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#75] SMP KASAN NOPTI
[   31.165007] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   31.165784] CPU: 0 UID: 0 PID: 806 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   31.166996] Tainted: [D]=DIE, [W]=WARN
[   31.167391] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   31.168531] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   31.169135] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   31.170984] RSP: 0018:ffff88801f02fb78 EFLAGS: 00010246
[   31.171530] RAX: dffffc0000000000 RBX: ffff88801fe15200 RCX: 1ffffffff0dd8bdc
[   31.172257] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff8880120bad3c
[   31.172983] RBP: ffff88801f02fbc8 R08: 0000000000000000 R09: 0000000000000000
[   31.173707] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   31.174432] R13: 0000000000000001 R14: ffff88801f02fe18 R15: ffff8880124c1408
[   31.175164] FS:  00007f5173e28600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   31.175981] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   31.176572] CR2: 00000000200006c0 CR3: 0000000014148001 CR4: 0000000000770ef0
[   31.177301] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   31.178055] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   31.178804] PKRU: 55555554
[   31.179105] Call Trace:
[   31.179381]  <TASK>
[   31.179624]  ? show_regs+0x6d/0x80
[   31.180009]  ? die_addr+0x45/0xb0
[   31.180383]  ? exc_general_protection+0x1ad/0x340
[   31.180912]  ? asm_exc_general_protection+0x2b/0x30
[   31.181446]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   31.181997]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   31.182551]  iommufd_device_detach+0x2a/0x2e0
[   31.183039]  iommufd_test+0x2f99/0x5cd0
[   31.183462]  ? do_raw_spin_unlock+0x15c/0x210
[   31.183950]  ? __pfx_iommufd_test+0x10/0x10
[   31.184414]  ? debug_smp_processor_id+0x20/0x30
[   31.184911]  ? rcu_is_watching+0x19/0xc0
[   31.185349]  ? lock_release+0x1ea/0x2c0
[   31.185775]  ? __might_fault+0xf1/0x1b0
[   31.186207]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   31.186793]  iommufd_fops_ioctl+0x38e/0x520
[   31.187254]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   31.187771]  ? trace_irq_enable+0xd1/0x110
[   31.188233]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   31.188774]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   31.189287]  __x64_sys_ioctl+0x1ba/0x220
[   31.189727]  x64_sys_call+0x122e/0x2150
[   31.190153]  do_syscall_64+0x6d/0x150
[   31.190614]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   31.191166] RIP: 0033:0x7f5173c3ee5d
[   31.191562] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   31.193471] RSP: 002b:00007fff02108458 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   31.194284] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f5173c3ee5d
[   31.195047] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   31.195804] RBP: 00007fff02108470 R08: 0000000000000800 R09: 0000000000000800
[   31.196574] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff02108588
[   31.197333] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f5173e71000
[   31.198102]  </TASK>
[   31.198356] Modules linked in:
[   31.198885] ---[ end trace 0000000000000000 ]---
[   31.199528] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   31.200265] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   31.202014] systemd-journald[145]: Data hash table of /run/log/journal/938775788448454bb5b34822d5730c41/system.journal has a fill level at 75.0 (5260 of 7011 items, 4038656 file size, 767 bytes per hash table item), suggesting rotation.
[   31.202274] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   31.204435] systemd-journald[145]: /run/log/journal/938775788448454bb5b34822d5730c41/system.journal: Journal header limits reached or header out-of-date, rotating.
[   31.204973] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   31.207305] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   31.208051] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   31.208793] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   31.209593] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   31.210342] FS:  00007f5173e28600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   31.211191] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   31.211797] CR2: 00000000200006c0 CR3: 0000000014148001 CR4: 0000000000770ef0
[   31.212553] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   31.213296] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   31.214092] PKRU: 55555554
[   31.216508] ------------[ cut here ]------------
[   31.217063] WARNING: CPU: 0 PID: 806 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   31.218210] Modules linked in:
[   31.218617] CPU: 0 UID: 0 PID: 806 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   31.220022] Tainted: [D]=DIE, [W]=WARN
[   31.220425] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   31.221636] RIP: 0010:iommufd_fops_release+0x386/0x420
[   31.222180] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   31.224032] RSP: 0018:ffff88801f02fc08 EFLAGS: 00010293
[   31.224576] RAX: 0000000000000000 RBX: ffff88801533a808 RCX: ffffffff83afe4ca
[   31.225302] RDX: ffff8880120ba540 RSI: ffffffff83afe636 RDI: 0000000000000005
[   31.226090] RBP: ffff88801f02fcb8 R08: 0000000000000000 R09: 0000000000000000
[   31.226833] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   31.227559] R13: 0000000000000000 R14: ffff88801f02fc50 R15: 0000000000000000
[   31.228288] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   31.229105] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   31.229781] CR2: 00000000200006c0 CR3: 0000000007086005 CR4: 0000000000770ef0
[   31.230533] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   31.231322] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   31.232075] PKRU: 55555554
[   31.232379] Call Trace:
[   31.232654]  <TASK>
[   31.232900]  ? show_regs+0x6d/0x80
[   31.233287]  ? __warn+0xf3/0x380
[   31.233686]  ? report_bug+0x25e/0x4b0
[   31.234101]  ? iommufd_fops_release+0x386/0x420
[   31.234601]  ? report_bug+0x2cb/0x4b0
[   31.235020]  ? iommufd_fops_release+0x386/0x420
[   31.235521]  ? iommufd_fops_release+0x386/0x420
[   31.236017]  ? handle_bug+0x2cd/0x510
[   31.236427]  ? iommufd_fops_release+0x388/0x420
[   31.236923]  ? exc_invalid_op+0x3c/0x80
[   31.237377]  ? asm_exc_invalid_op+0x1f/0x30
[   31.237843]  ? iommufd_fops_release+0x21a/0x420
[   31.238341]  ? iommufd_fops_release+0x386/0x420
[   31.238849]  ? iommufd_fops_release+0x386/0x420
[   31.239344]  ? iommufd_fops_release+0x386/0x420
[   31.239837]  ? locks_remove_file+0x3b4/0x5d0
[   31.240316]  ? __pfx_iommufd_fops_release+0x10/0x10
[   31.240845]  ? __memcg_slab_free_hook+0xc1/0x540
[   31.241373]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   31.241958]  ? evm_file_release+0x141/0x220
[   31.242421]  ? __pfx_iommufd_fops_release+0x10/0x10
[   31.242958]  __fput+0x41c/0xb70
[   31.243325]  ____fput+0x22/0x30
[   31.243680]  task_work_run+0x19b/0x2b0
[   31.244102]  ? __pfx_task_work_run+0x10/0x10
[   31.244573]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   31.245152]  ? switch_task_namespaces+0xc6/0x110
[   31.245745]  do_exit+0xb0e/0x29d0
[   31.246129]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   31.246673]  ? __pfx_do_exit+0x10/0x10
[   31.247101]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   31.247620]  ? __x64_sys_ioctl+0x1ba/0x220
[   31.248077]  make_task_dead+0x181/0x3c0
[   31.248507]  rewind_stack_and_make_dead+0x16/0x20
[   31.249020] RIP: 0033:0x7f5173c3ee5d
[   31.249464] Code: Unable to access opcode bytes at 0x7f5173c3ee33.
[   31.250117] RSP: 002b:00007fff02108458 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   31.250927] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f5173c3ee5d
[   31.251671] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   31.252415] RBP: 00007fff02108470 R08: 0000000000000800 R09: 0000000000000800
[   31.253171] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff02108588
[   31.253941] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f5173e71000
[   31.254702]  </TASK>
[   31.254969] irq event stamp: 0
[   31.255304] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   31.255962] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   31.256819] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   31.257706] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   31.258368] ---[ end trace 0000000000000000 ]---
[   31.258948] ------------[ cut here ]------------
[   31.259439] WARNING: CPU: 0 PID: 806 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   31.260433] Modules linked in:
[   31.260786] CPU: 0 UID: 0 PID: 806 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   31.262039] Tainted: [D]=DIE, [W]=WARN
[   31.262440] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   31.263611] RIP: 0010:iommufd_fops_release+0x392/0x420
[   31.264159] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   31.266080] RSP: 0018:ffff88801f02fc08 EFLAGS: 00010293
[   31.266642] RAX: 0000000000000000 RBX: ffff88801533a808 RCX: ffffffff83afe4ca
[   31.267388] RDX: ffff8880120ba540 RSI: ffffffff83afe642 RDI: ffff88801533a8a0
[   31.268124] RBP: ffff88801f02fcb8 R08: 0000000000000000 R09: 0000000000000000
[   31.268863] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   31.269623] R13: 0000000000000000 R14: ffff88801f02fc50 R15: 0000000000000000
[   31.270363] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   31.271198] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   31.271803] CR2: 00000000200006c0 CR3: 0000000007086005 CR4: 0000000000770ef0
[   31.272546] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   31.273282] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   31.274049] PKRU: 55555554
[   31.274351] Call Trace:
[   31.274628]  <TASK>
[   31.274875]  ? show_regs+0x6d/0x80
[   31.275260]  ? __warn+0xf3/0x380
[   31.275623]  ? report_bug+0x25e/0x4b0
[   31.276027]  ? iommufd_fops_release+0x392/0x420
[   31.276520]  ? report_bug+0x2cb/0x4b0
[   31.276926]  ? iommufd_fops_release+0x392/0x420
[   31.277436]  ? iommufd_fops_release+0x392/0x420
[   31.277928]  ? handle_bug+0x2cd/0x510
[   31.278334]  ? iommufd_fops_release+0x394/0x420
[   31.278833]  ? exc_invalid_op+0x3c/0x80
[   31.279255]  ? asm_exc_invalid_op+0x1f/0x30
[   31.279709]  ? iommufd_fops_release+0x21a/0x420
[   31.280199]  ? iommufd_fops_release+0x392/0x420
[   31.280691]  ? iommufd_fops_release+0x392/0x420
[   31.281181]  ? iommufd_fops_release+0x392/0x420
[   31.281689]  ? locks_remove_file+0x3b4/0x5d0
[   31.282160]  ? __pfx_iommufd_fops_release+0x10/0x10
[   31.282681]  ? __memcg_slab_free_hook+0xc1/0x540
[   31.283186]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   31.283756]  ? evm_file_release+0x141/0x220
[   31.284211]  ? __pfx_iommufd_fops_release+0x10/0x10
[   31.284739]  __fput+0x41c/0xb70
[   31.285095]  ____fput+0x22/0x30
[   31.285464]  task_work_run+0x19b/0x2b0
[   31.285882]  ? __pfx_task_work_run+0x10/0x10
[   31.286350]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   31.286927]  ? switch_task_namespaces+0xc6/0x110
[   31.287431]  do_exit+0xb0e/0x29d0
[   31.287804]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   31.288339]  ? __pfx_do_exit+0x10/0x10
[   31.288753]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   31.289263]  ? __x64_sys_ioctl+0x1ba/0x220
[   31.289729]  make_task_dead+0x181/0x3c0
[   31.290157]  rewind_stack_and_make_dead+0x16/0x20
[   31.290667] RIP: 0033:0x7f5173c3ee5d
[   31.291058] Code: Unable to access opcode bytes at 0x7f5173c3ee33.
[   31.291698] RSP: 002b:00007fff02108458 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   31.292483] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f5173c3ee5d
[   31.293223] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   31.293980] RBP: 00007fff02108470 R08: 0000000000000800 R09: 0000000000000800
[   31.294726] R10: 0000000000000800 R11: 0000000000000213 R12: 00007fff02108588
[   31.295467] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f5173e71000
[   31.296216]  </TASK>
[   31.296466] irq event stamp: 0
[   31.296802] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   31.297478] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   31.298332] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   31.299189] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   31.299846] ---[ end trace 0000000000000000 ]---
[   31.309616] iommufd_mock iommufd_mock75: Adding to iommu group 75
[   31.313677] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#76] SMP KASAN NOPTI
[   31.314934] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   31.315801] CPU: 0 UID: 0 PID: 808 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   31.316985] Tainted: [D]=DIE, [W]=WARN
[   31.317356] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   31.318415] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   31.318994] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   31.320884] RSP: 0018:ffff88801f3f7b78 EFLAGS: 00010246
[   31.321412] RAX: dffffc0000000000 RBX: ffff88801fe15000 RCX: 1ffffffff0dd8bdc
[   31.322133] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801c8b527c
[   31.322862] RBP: ffff88801f3f7bc8 R08: 0000000000000000 R09: 0000000000000000
[   31.323586] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   31.324317] R13: 0000000000000001 R14: ffff88801f3f7e18 R15: ffff888015251808
[   31.325047] FS:  00007f885d2af600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   31.325849] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   31.326455] CR2: 00000000200006c0 CR3: 000000001ae9e003 CR4: 0000000000770ef0
[   31.327189] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   31.327913] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   31.328632] PKRU: 55555554
[   31.328922] Call Trace:
[   31.329185]  <TASK>
[   31.329418]  ? show_regs+0x6d/0x80
[   31.329786]  ? die_addr+0x45/0xb0
[   31.330152]  ? exc_general_protection+0x1ad/0x340
[   31.330663]  ? asm_exc_general_protection+0x2b/0x30
[   31.331179]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   31.331716]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   31.332255]  iommufd_device_detach+0x2a/0x2e0
[   31.332737]  iommufd_test+0x2f99/0x5cd0
[   31.333161]  ? do_raw_spin_unlock+0x15c/0x210
[   31.333650]  ? __pfx_iommufd_test+0x10/0x10
[   31.334087]  ? debug_smp_processor_id+0x20/0x30
[   31.334593]  ? rcu_is_watching+0x19/0xc0
[   31.335041]  ? lock_release+0x1ea/0x2c0
[   31.335471]  ? __might_fault+0xf1/0x1b0
[   31.335904]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   31.336490]  iommufd_fops_ioctl+0x38e/0x520
[   31.336932]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   31.337414]  ? trace_irq_enable+0xd1/0x110
[   31.337884]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   31.338438]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   31.338969]  __x64_sys_ioctl+0x1ba/0x220
[   31.339405]  x64_sys_call+0x122e/0x2150
[   31.339821]  do_syscall_64+0x6d/0x150
[   31.340248]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   31.340810] RIP: 0033:0x7f885d03ee5d
[   31.341219] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64 89 01 48
[   31.342981] RSP: 002b:00007ffc5bcba638 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   31.343713] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f885d03ee5d
[   31.344403] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   31.345095] RBP: 00007ffc5bcba650 R08: 0000000000000800 R09: 0000000000000800
[   31.345784] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc5bcba768
[   31.346476] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f885d2f8000
[   31.347175]  </TASK>
[   31.347408] Modules linked in:
[   31.347864] ---[ end trace 0000000000000000 ]---
[   31.348331] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   31.348898] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   31.350786] RSP: 0018:ffff8880172cfb78 EFLAGS: 00010246
[   31.351313] RAX: dffffc0000000000 RBX: ffff88801206bc00 RCX: ffff8880172cfa64
[   31.352073] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff88801f98d27c
[   31.352745] RBP: ffff8880172cfbc8 R08: 0000000000000001 R09: 0000000000000001
[   31.353533] R10: 0000000000000001 R11: ffff88801f98d8d8 R12: 0000000000000000
[   31.354214] R13: 0000000000000001 R14: ffff8880172cfe18 R15: ffff88800fefd408
[   31.354896] FS:  00007f885d2af600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   31.355654] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   31.356205] CR2: 00000000200006c0 CR3: 000000001ae9e003 CR4: 0000000000770ef0
[   31.356880] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   31.357641] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   31.358340] PKRU: 55555554
[   31.359924] ------------[ cut here ]------------
[   31.360384] WARNING: CPU: 0 PID: 808 at drivers/iommu/iommufd/main.c:265 iommufd_fops_release+0x386/0x420
[   31.361363] Modules linked in:
[   31.361837] CPU: 0 UID: 0 PID: 808 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   31.362978] Tainted: [D]=DIE, [W]=WARN
[   31.363367] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   31.364605] RIP: 0010:iommufd_fops_release+0x386/0x420
[   31.365143] Code: 8b 45 d0 65 48 2b 05 f1 59 3a 05 75 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd <0f> 0b e9 bd fe ff ff e8 1e d6 d7 fd 0f 0b e9 f4 fe ff ff e8 b2 4f
[   31.366949] RSP: 0018:ffff88801f3f7c08 EFLAGS: 00010293
[   31.367472] RAX: 0000000000000000 RBX: ffff88801533b808 RCX: ffffffff83afe4ca
[   31.368170] RDX: ffff88801c8b4a80 RSI: ffffffff83afe636 RDI: 0000000000000005
[   31.368860] RBP: ffff88801f3f7cb8 R08: 0000000000000000 R09: 0000000000000000
[   31.369577] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   31.370274] R13: 0000000000000000 R14: ffff88801f3f7c50 R15: 0000000000000000
[   31.370976] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   31.371758] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   31.372327] CR2: 00000000200006c0 CR3: 0000000007086006 CR4: 0000000000770ef0
[   31.373024] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   31.373740] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   31.374437] PKRU: 55555554
[   31.374725] Call Trace:
[   31.374983]  <TASK>
[   31.375212]  ? show_regs+0x6d/0x80
[   31.375571]  ? __warn+0xf3/0x380
[   31.375917]  ? report_bug+0x25e/0x4b0
[   31.376299]  ? iommufd_fops_release+0x386/0x420
[   31.376764]  ? report_bug+0x2cb/0x4b0
[   31.377145]  ? iommufd_fops_release+0x386/0x420
[   31.377629]  ? iommufd_fops_release+0x386/0x420
[   31.378092]  ? handle_bug+0x2cd/0x510
[   31.378474]  ? iommufd_fops_release+0x388/0x420
[   31.378944]  ? exc_invalid_op+0x3c/0x80
[   31.379344]  ? asm_exc_invalid_op+0x1f/0x30
[   31.379772]  ? iommufd_fops_release+0x21a/0x420
[   31.380231]  ? iommufd_fops_release+0x386/0x420
[   31.380695]  ? iommufd_fops_release+0x386/0x420
[   31.381159]  ? iommufd_fops_release+0x386/0x420
[   31.381638]  ? locks_remove_file+0x3b4/0x5d0
[   31.382087]  ? __pfx_iommufd_fops_release+0x10/0x10
[   31.382577]  ? __memcg_slab_free_hook+0xc1/0x540
[   31.383054]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   31.383597]  ? evm_file_release+0x141/0x220
[   31.384030]  ? __pfx_iommufd_fops_release+0x10/0x10
[   31.384526]  __fput+0x41c/0xb70
[   31.384861]  ____fput+0x22/0x30
[   31.385193]  task_work_run+0x19b/0x2b0
[   31.385606]  ? __pfx_task_work_run+0x10/0x10
[   31.386048]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   31.386588]  ? switch_task_namespaces+0xc6/0x110
[   31.387070]  do_exit+0xb0e/0x29d0
[   31.387421]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   31.387924]  ? __pfx_do_exit+0x10/0x10
[   31.388315]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   31.388794]  ? __x64_sys_ioctl+0x1ba/0x220
[   31.389218]  make_task_dead+0x181/0x3c0
[   31.389637]  rewind_stack_and_make_dead+0x16/0x20
[   31.390146] RIP: 0033:0x7f885d03ee5d
[   31.390518] Code: Unable to access opcode bytes at 0x7f885d03ee33.
[   31.391126] RSP: 002b:00007ffc5bcba638 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   31.391866] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f885d03ee5d
[   31.392559] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   31.393255] RBP: 00007ffc5bcba650 R08: 0000000000000800 R09: 0000000000000800
[   31.393974] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc5bcba768
[   31.394710] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f885d2f8000
[   31.395413]  </TASK>
[   31.395648] irq event stamp: 0
[   31.395965] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   31.396583] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   31.397405] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   31.398217] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   31.398839] ---[ end trace 0000000000000000 ]---
[   31.399384] ------------[ cut here ]------------
[   31.399845] WARNING: CPU: 0 PID: 808 at drivers/iommu/iommufd/main.c:268 iommufd_fops_release+0x392/0x420
[   31.400768] Modules linked in:
[   31.401093] CPU: 0 UID: 0 PID: 808 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   31.402303] Tainted: [D]=DIE, [W]=WARN
[   31.402685] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   31.403795] RIP: 0010:iommufd_fops_release+0x392/0x420
[   31.404315] Code: 76 48 81 c4 88 00 00 00 31 c0 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc e8 2a d6 d7 fd 0f 0b e9 bd fe ff ff e8 1e d6 d7 fd <0f> 0b e9 f4 fe ff ff e8 b2 4f 43 fe e9 f7 fd ff ff 48 89 85 50 ff
[   31.406107] RSP: 0018:ffff88801f3f7c08 EFLAGS: 00010293
[   31.406633] RAX: 0000000000000000 RBX: ffff88801533b808 RCX: ffffffff83afe4ca
[   31.407337] RDX: ffff88801c8b4a80 RSI: ffffffff83afe642 RDI: ffff88801533b8a0
[   31.408034] RBP: ffff88801f3f7cb8 R08: 0000000000000000 R09: 0000000000000000
[   31.408728] R10: 0000000000000000 R11: 0000000000000009 R12: 0000000000000000
[   31.409440] R13: 0000000000000000 R14: ffff88801f3f7c50 R15: 0000000000000000
[   31.410140] FS:  0000000000000000(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   31.410929] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   31.411499] CR2: 00000000200006c0 CR3: 0000000007086006 CR4: 0000000000770ef0
[   31.412196] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   31.412893] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   31.413614] PKRU: 55555554
[   31.413936] Call Trace:
[   31.414198]  <TASK>
[   31.414428]  ? show_regs+0x6d/0x80
[   31.414794]  ? __warn+0xf3/0x380
[   31.415134]  ? report_bug+0x25e/0x4b0
[   31.415516]  ? iommufd_fops_release+0x392/0x420
[   31.415981]  ? report_bug+0x2cb/0x4b0
[   31.416366]  ? iommufd_fops_release+0x392/0x420
[   31.416832]  ? iommufd_fops_release+0x392/0x420
[   31.417293]  ? handle_bug+0x2cd/0x510
[   31.417700]  ? iommufd_fops_release+0x394/0x420
[   31.418170]  ? exc_invalid_op+0x3c/0x80
[   31.418569]  ? asm_exc_invalid_op+0x1f/0x30
[   31.419002]  ? iommufd_fops_release+0x21a/0x420
[   31.419466]  ? iommufd_fops_release+0x392/0x420
[   31.419927]  ? iommufd_fops_release+0x392/0x420
[   31.420392]  ? iommufd_fops_release+0x392/0x420
[   31.420855]  ? locks_remove_file+0x3b4/0x5d0
[   31.421303]  ? __pfx_iommufd_fops_release+0x10/0x10
[   31.421827]  ? __memcg_slab_free_hook+0xc1/0x540
[   31.422301]  ? __sanitizer_cov_trace_const_cmp2+0x1c/0x30
[   31.422848]  ? evm_file_release+0x141/0x220
[   31.423281]  ? __pfx_iommufd_fops_release+0x10/0x10
[   31.423776]  __fput+0x41c/0xb70
[   31.424116]  ____fput+0x22/0x30
[   31.424449]  task_work_run+0x19b/0x2b0
[   31.424841]  ? __pfx_task_work_run+0x10/0x10
[   31.425284]  ? __sanitizer_cov_trace_const_cmp4+0x1a/0x20
[   31.425870]  ? switch_task_namespaces+0xc6/0x110
[   31.426351]  do_exit+0xb0e/0x29d0
[   31.426701]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   31.427213]  ? __pfx_do_exit+0x10/0x10
[   31.427600]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   31.428078]  ? __x64_sys_ioctl+0x1ba/0x220
[   31.428499]  make_task_dead+0x181/0x3c0
[   31.428898]  rewind_stack_and_make_dead+0x16/0x20
[   31.429404] RIP: 0033:0x7f885d03ee5d
[   31.429778] Code: Unable to access opcode bytes at 0x7f885d03ee33.
[   31.430387] RSP: 002b:00007ffc5bcba638 EFLAGS: 00000213 ORIG_RAX: 0000000000000010
[   31.431129] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f885d03ee5d
[   31.431829] RDX: 0000000020000300 RSI: 0000000000003ba0 RDI: 0000000000000003
[   31.432526] RBP: 00007ffc5bcba650 R08: 0000000000000800 R09: 0000000000000800
[   31.433219] R10: 0000000000000800 R11: 0000000000000213 R12: 00007ffc5bcba768
[   31.433938] R13: 0000000000401136 R14: 0000000000403e08 R15: 00007f885d2f8000
[   31.434648]  </TASK>
[   31.434890] irq event stamp: 0
[   31.435206] hardirqs last  enabled at (0): [<0000000000000000>] 0x0
[   31.435827] hardirqs last disabled at (0): [<ffffffff8146a49f>] copy_process+0x1cff/0x69c0
[   31.436637] softirqs last  enabled at (0): [<ffffffff8146a4ec>] copy_process+0x1d4c/0x69c0
[   31.437474] softirqs last disabled at (0): [<0000000000000000>] 0x0
[   31.438096] ---[ end trace 0000000000000000 ]---
[   31.445378] iommufd_mock iommufd_mock76: Adding to iommu group 76
[   31.446451] Oops: general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#77] SMP KASAN NOPTI
[   31.447991] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
[   31.448794] CPU: 0 UID: 0 PID: 809 Comm: repro Tainted: G      D W           6.14.0-next-20250325-eb4bc4b07f66 #1 PREEMPT(voluntary) 
[   31.449956] Tainted: [D]=DIE, [W]=WARN
[   31.450323] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014
[   31.451398] RIP: 0010:iommufd_hw_pagetable_detach+0x8a/0x4d0
[   31.451961] Code: 00 00 00 44 89 ee 48 89 c7 48 89 75 c8 48 89 45 c0 e8 ca 55 17 02 48 89 c2 49 89 c4 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 99 03 00 00 48 b8 00 00 00 00 00 fc ff df 4d 8b
[   31.453671] RSP: 0018:ffff88802705fb78 EFLAGS: 00010246
[   31.454177] RAX: dffffc0000000000 RBX: ffff88801fe15c00 RCX: 1ffffffff0dd8bdc
[   31.454858] RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffff88801729d27c
[   31.455529] RBP: ffff88802705fbc8 R08: 0000000000000000 R09: 0000000000000000
[   31.456202] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   31.456873] R13: 0000000000000001 R14: ffff88802705fe18 R15: ffff888015253408
[   31.457544] FS:  00007f5d8cd28600(0000) GS:ffff8880e3584000(0000) knlGS:0000000000000000
[   31.458311] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   31.458872] CR2: 00000000200006c0 CR3: 00000000216aa002 CR4: 0000000000770ef0
[   31.459569] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   31.460262] DR3: 0000000000000000 DR6: 00000000ffff07f0 DR7: 0000000000000400
[   31.460949] PKRU: 55555554
[   31.461229] Call Trace:
[   31.461487]  <TASK>
[   31.461717]  ? show_regs+0x6d/0x80
[   31.462078]  ? die_addr+0x45/0xb0
[   31.462427]  ? exc_general_protection+0x1ad/0x340
[   31.462926]  ? asm_exc_general_protection+0x2b/0x30
[   31.463427]  ? iommufd_hw_pagetable_detach+0x8a/0x4d0
[   31.463943]  ? iommufd_hw_pagetable_detach+0x76/0x4d0
[   31.464460]  iommufd_device_detach+0x2a/0x2e0
[   31.464916]  iommufd_test+0x2f99/0x5cd0
[   31.465312]  ? do_raw_spin_unlock+0x15c/0x210
[   31.465777]  ? __pfx_iommufd_test+0x10/0x10
[   31.466231]  ? debug_smp_processor_id+0x20/0x30
[   31.466761]  ? rcu_is_watching+0x19/0xc0
[   31.467191]  ? lock_release+0x1ea/0x2c0
[   31.467590]  ? __might_fault+0xf1/0x1b0
[   31.467998]  ? __sanitizer_cov_trace_const_cmp8+0x1c/0x30
[   31.468536]  iommufd_fops_ioctl+0x38e/0x520
[   31.468975]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   31.469531]  ? trace_irq_enable+0xd1/0x110
[   31.469951]  ? ktime_get_coarse_real_ts64+0xb6/0x100
[   31.470442]  ? __pfx_iommufd_fops_ioctl+0x10/0x10
[   31.470915]  __x64_sys_ioctl+0x1ba/0x220
[   31.471311]  x64_sys_call+0x122e/0x2150
[   31.471695]  do_syscall_64+0x6d/0x150
[   31.472068]  entry_SYSCALL_64_after_hwframe+0x76/0x7e
[   31.472560] RIP: 0033:0x7f5d8ca3ee5d
[   31.472922] Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 93 af 1b 00 f7 d8 64